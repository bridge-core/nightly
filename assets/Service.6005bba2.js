var Cl=Object.defineProperty;var Al=(Oe,xe,Ue)=>xe in Oe?Cl(Oe,xe,{enumerable:!0,configurable:!0,writable:!0,value:Ue}):Oe[xe]=Ue;var P=(Oe,xe,Ue)=>(Al(Oe,typeof xe!="symbol"?xe+"":xe,Ue),Ue);(function(){"use strict";const Oe=Symbol("Comlink.proxy"),xe=Symbol("Comlink.endpoint"),Ue=Symbol("Comlink.releaseProxy"),sr=Symbol("Comlink.thrown"),ei=i=>typeof i=="object"&&i!==null||typeof i=="function",Jn={canHandle:i=>ei(i)&&i[Oe],serialize(i){const{port1:e,port2:t}=new MessageChannel;return ur(i,e),[t,[t]]},deserialize(i){return i.start(),Xn(i)}},Vn={canHandle:i=>ei(i)&&sr in i,serialize({value:i}){let e;return i instanceof Error?e={isError:!0,value:{message:i.message,name:i.name,stack:i.stack}}:e={isError:!1,value:i},[e,[]]},deserialize(i){throw i.isError?Object.assign(new Error(i.value.message),i.value):i.value}},rt=new Map([["proxy",Jn],["throw",Vn]]);function ur(i,e=self){e.addEventListener("message",function t(r){if(!r||!r.data)return;const{id:n,type:s,path:u}=Object.assign({path:[]},r.data),a=(r.data.argumentList||[]).map(ze);let o;try{const l=u.slice(0,-1).reduce((c,f)=>c[f],i),h=u.reduce((c,f)=>c[f],i);switch(s){case 0:o=h;break;case 1:l[u.slice(-1)[0]]=ze(r.data.value),o=!0;break;case 2:o=h.apply(l,a);break;case 3:{const c=new h(...a);o=Zn(c)}break;case 4:{const{port1:c,port2:f}=new MessageChannel;ur(i,f),o=Yn(c,[c])}break;case 5:o=void 0;break}}catch(l){o={value:l,[sr]:0}}Promise.resolve(o).catch(l=>({value:l,[sr]:0})).then(l=>{const[h,c]=or(l);e.postMessage(Object.assign(Object.assign({},h),{id:n}),c),s===5&&(e.removeEventListener("message",t),ti(e))})}),e.start&&e.start()}function Kn(i){return i.constructor.name==="MessagePort"}function ti(i){Kn(i)&&i.close()}function Xn(i,e){return ar(i,[],e)}function Rt(i){if(i)throw new Error("Proxy has been released and is not useable")}function ar(i,e=[],t=function(){}){let r=!1;const n=new Proxy(t,{get(s,u){if(Rt(r),u===Ue)return()=>it(i,{type:5,path:e.map(a=>a.toString())}).then(()=>{ti(i),r=!0});if(u==="then"){if(e.length===0)return{then:()=>n};const a=it(i,{type:0,path:e.map(o=>o.toString())}).then(ze);return a.then.bind(a)}return ar(i,[...e,u])},set(s,u,a){Rt(r);const[o,l]=or(a);return it(i,{type:1,path:[...e,u].map(h=>h.toString()),value:o},l).then(ze)},apply(s,u,a){Rt(r);const o=e[e.length-1];if(o===xe)return it(i,{type:4}).then(ze);if(o==="bind")return ar(i,e.slice(0,-1));const[l,h]=ri(a);return it(i,{type:2,path:e.map(c=>c.toString()),argumentList:l},h).then(ze)},construct(s,u){Rt(r);const[a,o]=ri(u);return it(i,{type:3,path:e.map(l=>l.toString()),argumentList:a},o).then(ze)}});return n}function Qn(i){return Array.prototype.concat.apply([],i)}function ri(i){const e=i.map(or);return[e.map(t=>t[0]),Qn(e.map(t=>t[1]))]}const ii=new WeakMap;function Yn(i,e){return ii.set(i,e),i}function Zn(i){return Object.assign(i,{[Oe]:!0})}function or(i){for(const[e,t]of rt)if(t.canHandle(i)){const[r,n]=t.serialize(i);return[{type:3,name:e,value:r},n]}return[{type:0,value:i},ii.get(i)||[]]}function ze(i){switch(i.type){case 3:return rt.get(i.name).deserialize(i.value);case 0:return i.value}}function it(i,e,t){return new Promise(r=>{const n=es();i.addEventListener("message",function s(u){!u.data||!u.data.id||u.data.id!==n||(i.removeEventListener("message",s),r(u.data))}),i.start&&i.start(),i.postMessage(Object.assign({id:n},e),t)})}function es(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Tt,ts=new Uint8Array(16);function rs(){if(!Tt&&(Tt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Tt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Tt(ts)}var is=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ns(i){return typeof i=="string"&&is.test(i)}for(var re=[],lr=0;lr<256;++lr)re.push((lr+256).toString(16).substr(1));function ss(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(re[i[e+0]]+re[i[e+1]]+re[i[e+2]]+re[i[e+3]]+"-"+re[i[e+4]]+re[i[e+5]]+"-"+re[i[e+6]]+re[i[e+7]]+"-"+re[i[e+8]]+re[i[e+9]]+"-"+re[i[e+10]]+re[i[e+11]]+re[i[e+12]]+re[i[e+13]]+re[i[e+14]]+re[i[e+15]]).toLowerCase();if(!ns(t))throw TypeError("Stringified UUID is invalid");return t}function us(i,e,t){i=i||{};var r=i.random||(i.rng||rs)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var n=0;n<16;++n)e[t+n]=r[n];return e}return ss(r)}class ni{constructor(){P(this,"listeners",new Set)}get hasListeners(){return this.listeners.size>0}dispatch(e){this.listeners.forEach(t=>t(e))}on(e,t=!0){if(this.listeners.add(e),t)return{dispose:()=>{this.off(e)}}}off(e){this.listeners.delete(e)}once(e,t=!1){const r=n=>{e(n),this.off(r)};return this.on(r,t)}disposeListeners(){this.listeners=new Set}}class We extends ni{constructor(t=1){super();P(this,"firedTimes",0);P(this,"data");this.needsToFireAmount=t}get fired(){return new Promise(t=>this.once(t,!1))}get hasFired(){return this.firedTimes>=this.needsToFireAmount}setFiredTimes(t){this.firedTimes=t}resetSignal(){this.data=void 0,this.firedTimes=0}dispatch(t){if(this.firedTimes<this.needsToFireAmount&&this.firedTimes++,this.data=t,this.hasFired)return super.dispatch(t)}on(t,r=!0){return this.hasFired&&t(this.data),super.on(t,r)}}function as(){if(!(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent))||!indexedDB.databases)return Promise.resolve();let e;return new Promise(t=>{const r=()=>indexedDB.databases().finally(t);e=setInterval(r,100),r()}).finally(()=>clearInterval(e))}function Pe(i){return new Promise((e,t)=>{i.oncomplete=i.onsuccess=()=>e(i.result),i.onabort=i.onerror=()=>t(i.error)})}function cr(i,e){const t=as().then(()=>{const r=indexedDB.open(i);return r.onupgradeneeded=()=>r.result.createObjectStore(e),Pe(r)});return(r,n)=>t.then(s=>n(s.transaction(e,r).objectStore(e)))}let hr;function Ge(){return hr||(hr=cr("keyval-store","keyval")),hr}function fr(i,e=Ge()){return e("readonly",t=>Pe(t.get(i)))}function dr(i,e,t=Ge()){return t("readwrite",r=>(r.put(e,i),Pe(r.transaction)))}function os(i,e=Ge()){return e("readwrite",t=>(i.forEach(r=>t.put(r[1],r[0])),Pe(t.transaction)))}function ls(i,e=Ge()){return e("readonly",t=>Promise.all(i.map(r=>Pe(t.get(r)))))}function cs(i,e=Ge()){return e("readwrite",t=>(t.delete(i),Pe(t.transaction)))}function hs(i=Ge()){return i("readwrite",e=>(e.clear(),Pe(e.transaction)))}function fs(i,e){return i("readonly",t=>(t.openCursor().onsuccess=function(){!this.result||(e(this.result),this.result.continue())},Pe(t.transaction)))}function ds(i=Ge()){const e=[];return fs(i,t=>e.push(t.key)).then(()=>e)}const ps=cr("virtual-fs","virtual-fs-store"),gs=i=>fr(i,ps);class dt{constructor(e="virtual-fs"){P(this,"store");this.storeName=e,this.store=cr(e,`${e}-store`)}set(e,t){return dr(e,t,this.store)}get(e){return fr(e,this.store)}del(e){return cs(e,this.store)}setMany(e){return os(e,this.store)}getMany(e){return ls(e,this.store)}clear(){return hs(this.store)}async has(e){return await gs(e)!==void 0}keys(){return ds(this.store)}}class si{constructor(e,t,r=[],n=us()){P(this,"_idbWrapper",null);P(this,"parent",null);P(this,"isVirtual",!0);P(this,"setupDone",new We);this._name=t,this.basePath=r,this.uuid=n,e===null?this._idbWrapper=new dt:e instanceof dt?this._idbWrapper=e:this.parent=e}get path(){return this.parent?this.parent.path.concat(this.name):this.basePath}get hasParentContext(){return this.path.length>1}get idbKey(){return this.path.length===0?this._name:this.path.join("/")}get idbWrapper(){return this._idbWrapper===null?this.parent.idbWrapper:this._idbWrapper}get name(){return this._name}getParent(){return this.parent}async isSameEntry(e){return e.idbKey===this.idbKey}async queryPermission(e){return"granted"}async requestPermission(e){return"granted"}}const Ds=new TextEncoder,ui=Symbol("writeMethod");class ms{constructor(e){P(this,"tmpData",new Uint8Array);P(this,"cursorOffset",0);P(this,"locked",!1);this.fileHandle=e}async write(e){let t;if(typeof e=="string")t=Ds.encode(e);else if(e instanceof Blob)t=await e.arrayBuffer().then(r=>new Uint8Array(r));else if("type"in e){if(e.type==="seek")return await this.seek(e.position);if(e.type==="truncate")return await this.truncate(e.size);if(e.type==="write")return e.position&&await this.seek(e.position),await this.write(e.data);throw new Error(`Unknown data type: ${e.type}`)}else ArrayBuffer.isView(e)?t=new Uint8Array(e.buffer):t=new Uint8Array(e);this.tmpData=new Uint8Array([...this.tmpData.slice(0,this.cursorOffset),...t]),this.cursorOffset=this.tmpData.length}async seek(e){this.cursorOffset=Math.floor(e)}async truncate(e){this.tmpData=this.tmpData.slice(0,e),this.cursorOffset>e&&(this.cursorOffset=e)}async close(){await this.fileHandle[ui](this.tmpData)}async abort(){throw new Error("WriteStream was aborted")}getWriter(){}}class Ee extends si{constructor(t,r,n,s=!1,u){super(t,r,u);P(this,"kind","file");P(this,"isFile",!0);P(this,"isDirectory",!1);P(this,"fileData");this.inMemory=s,n?this.setup(n):this.setupDone.dispatch()}get isFileStoredInMemory(){return this.fileData!==void 0}moveData(){if(!this.fileData)throw new Error(`No file data to move to IDB for file "${this.name}"`);const t=this.fileData;return this.fileData=void 0,this.inMemory=!1,t}async setup(t){this.fileData=t;const r=this.path.join("/").startsWith("data/packages");if(this.inMemory||r&&t.length<5e4)return this.inMemory=!0,this.setupDone.dispatch();(!r||globalThis.document)&&await this.updateIdb(t),this.setupDone.dispatch()}async updateIdb(t){await this.idbWrapper.set(this.idbKey,t),this.fileData=void 0}async loadFromIdb(){if(this.fileData)return this.fileData;let t=await this.idbWrapper.get(this.idbKey);if(t===void 0)throw console.log(this.parent),new Error(`File not found: "${this.path.join("/")}"`);return t}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"file",name:this.name,path:this.path,fileData:this.fileData}}static deserialize(t){return new Ee(t.idbWrapper?new dt(t.idbWrapper):null,t.name,t.fileData,t.fileData!==void 0,t.path)}async isSameEntry(t){return this.parent===null?!1:super.isSameEntry(t)}async removeSelf(t=!0){await this.idbWrapper.del(this.idbKey),this.parent&&t&&this.parent.deleteChild(this.name)}async getFile(){const t=await this.loadFromIdb();return new File([t],this.name)}async createWritable(){return new ms(this)}async[ui](t){this.inMemory?this.fileData=t:await this.updateIdb(t)}}class he extends si{constructor(t,r,n,s=!1,u=[]){super(t,r,u);P(this,"kind","directory");P(this,"isDirectory",!0);P(this,"isFile",!1);this.children=n,this.updateIdb(s)}get isDirectoryInMemory(){return this.children!==void 0}async moveToIdb(){const t=this.allInMemoryChildren();this.idbWrapper.setMany(t.map(r=>[r.idbKey,r.moveData()]))}moveData(){if(!this.children)throw new Error(`No directory data to move to IDB for directory "${this.name}"`);const t=[...this.children.values()].map(r=>r.name);return this.children=void 0,t}allInMemoryChildren(){if(!this.children)return[];const t=[this];for(const r of this.children.values())r instanceof he?r.isDirectoryInMemory&&t.push(...r.allInMemoryChildren()):r.isFileStoredInMemory&&t.push(r);return t}async updateIdb(t=!1){t&&await this.idbWrapper.clear(),!this.children&&!await this.hasChildren()&&await this.idbWrapper.set(this.idbKey,[]),this.setupDone.dispatch()}async addChild(t){await this.has(t.name)||(this.children?this.children.set(t.name,t):await this.idbWrapper.set(this.idbKey,[...await this.fromIdb(),t.name]))}async fromIdb(){var t;return(t=await this.idbWrapper.get(this.idbKey))!=null?t:[]}async getChildren(){return this.children?[...this.children.values()]:await Promise.all((await this.fromIdb()).map(t=>this.getChild(t)).filter(t=>t!==void 0))}getChildPath(t){return this.path.concat(t).join("/")}async getChild(t){if(this.children)return this.children.get(t);if(await this.has(t)){const r=await this.idbWrapper.get(this.getChildPath(t));if(r instanceof Uint8Array)return new Ee(this,t);if(Array.isArray(r))return new he(this,t)}}async deleteChild(t){this.children?this.children.delete(t):await this.idbWrapper.set(this.idbKey,(await this.fromIdb()).filter(r=>r!==t))}async hasChildren(){return this.children?this.children.size>0:(await this.fromIdb()).length>0}async has(t){return this.children?this.children.has(t):(await this.fromIdb()).includes(t)}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"directory",name:this.name,path:this.path,children:this.children?[...this.children.values()].map(t=>t.serialize()):void 0}}static deserialize(t,r=null){var s;const n=new he(r||new dt(t.idbWrapper),t.name,void 0,!1,t.path);for(const u of(s=t.children)!=null?s:[])u.kind==="directory"?n.addChild(he.deserialize(u,n)):n.addChild(new Ee(n,u.name,u.fileData));return n}async getDirectoryHandle(t,{create:r}={}){let n=await this.getChild(t);if(n&&n.kind==="file")throw new Error(`TypeMismatch: Expected directory with name "${t}", found file`);if(!n)if(r)n=new he(this,t,this.children?new Map:void 0),await n.setupDone.fired,await this.addChild(n);else throw new Error(`No file with the name ${t} exists in this folder`);return n}async getFileHandle(t,{create:r,initialData:n}={}){let s=await this.getChild(t);if(s&&s.kind==="directory")throw new Error(`TypeMismatch: Expected file with name "${t}", found directory`);if(!s)if(r)s=new Ee(this,t,n!=null?n:new Uint8Array),await s.setupDone.fired,await this.addChild(s);else throw new Error(`No file with the name ${t} exists in this folder`);return s}async removeEntry(t,{recursive:r}={}){const n=await this.getChild(t);if(n){if(n.kind==="directory"&&!r&&await n.hasChildren())throw new Error('Cannot remove directory with children without "recursive" option being set to true')}else throw new Error(`No entry with the name ${t} exists in this folder`);await n.removeSelf(),await this.deleteChild(t)}async resolve(t){const r=[t.name];let n=t.getParent();for(;n!==null&&!await n.isSameEntry(this);)r.unshift(n.name),n=n.getParent();return n===null?null:r}async removeSelf(t=!0){const r=await this.getChildren();for(const n of r)await n.removeSelf(!1);this.children||await this.idbWrapper.del(this.idbKey),this.parent&&t&&this.parent.deleteChild(this.name)}[Symbol.asyncIterator](){return this.entries()}keys(){return this.children?this.children.keys():{childNamesPromise:this.fromIdb(),[Symbol.asyncIterator](){return{i:0,childNamesPromise:this.childNamesPromise,async next(){const t=await this.childNamesPromise;return this.i<t.length?{done:!1,value:t[this.i++]}:{done:!0}}}}}}entries(){return this.children?this.children.entries():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const t=await this.childrenPromise;return this.i<t.length?{done:!1,value:[t[this.i].name,t[this.i++]]}:{done:!0}}}}}}values(){return this.children?this.children.values():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const t=await this.childrenPromise;return this.i<t.length?{done:!1,value:t[this.i++]}:{done:!0}}}}}}getEntries(){return this.values()}getDirectory(t,r={}){return this.getDirectoryHandle(t,r)}getFile(t,r={}){return this.getFileHandle(t,r)}}rt.set("VirtualFileHandle",{canHandle:i=>i instanceof Ee,serialize:i=>[i.serialize(),[]],deserialize:i=>new Ee(null,i.name,i.fileData)}),rt.set("VirtualDirectoryHandle",{canHandle:i=>i instanceof he,serialize:i=>[i.serialize(),[]],deserialize:i=>he.deserialize(i)}),rt.set("VirtualDirectoryHandleArray",{canHandle:i=>Array.isArray(i)&&i.every(({directory:e})=>e instanceof he),serialize:i=>[i.map(({directory:e,...t})=>({directory:e.serialize(),...t})),[]],deserialize:i=>i.map(({directory:e,...t})=>({directory:he.deserialize(e),...t}))}),rt.set("VirtualFileHandleArray",{canHandle:i=>Array.isArray(i)&&i.every(({fileHandle:e})=>e instanceof Ee),serialize:i=>[i.map(({fileHandle:e,...t})=>({fileHandle:e.serialize(),...t})),[]],deserialize:i=>i.map(({fileHandle:e,...t})=>({fileHandle:Ee.deserialize(e),...t}))});var Es=Object.defineProperty,ys=Object.defineProperties,ws=Object.getOwnPropertyDescriptors,ai=Object.getOwnPropertySymbols,Cs=Object.prototype.hasOwnProperty,As=Object.prototype.propertyIsEnumerable,oi=(i,e,t)=>e in i?Es(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,nt=(i,e)=>{for(var t in e||(e={}))Cs.call(e,t)&&oi(i,t,e[t]);if(ai)for(var t of ai(e))As.call(e,t)&&oi(i,t,e[t]);return i},$t=(i,e)=>ys(i,ws(e));function li(i,e){for(var t=0,r=i.length-1;r>=0;r--){var n=i[r];n==="."?i.splice(r,1):n===".."?(i.splice(r,1),t++):t&&(i.splice(r,1),t--)}if(e)for(;t--;t)i.unshift("..");return i}var vs=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,pr=function(i){return vs.exec(i).slice(1)};function Ot(){for(var i="",e=!1,t=arguments.length-1;t>=-1&&!e;t--){var r=t>=0?arguments[t]:"/";if(typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)continue;i=r+"/"+i,e=r.charAt(0)==="/"}return i=li(mr(i.split("/"),function(n){return!!n}),!e).join("/"),(e?"/":"")+i||"."}function gr(i){var e=Dr(i),t=bs(i,-1)==="/";return i=li(mr(i.split("/"),function(r){return!!r}),!e).join("/"),!i&&!e&&(i="."),i&&t&&(i+="/"),(e?"/":"")+i}function Dr(i){return i.charAt(0)==="/"}function ci(){var i=Array.prototype.slice.call(arguments,0);return gr(mr(i,function(e,t){if(typeof e!="string")throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function hi(i,e){i=Ot(i).substr(1),e=Ot(e).substr(1);function t(l){for(var h=0;h<l.length&&l[h]==="";h++);for(var c=l.length-1;c>=0&&l[c]==="";c--);return h>c?[]:l.slice(h,c-h+1)}for(var r=t(i.split("/")),n=t(e.split("/")),s=Math.min(r.length,n.length),u=s,a=0;a<s;a++)if(r[a]!==n[a]){u=a;break}for(var o=[],a=u;a<r.length;a++)o.push("..");return o=o.concat(n.slice(u)),o.join("/")}var fi="/",di=":";function pi(i){var e=pr(i),t=e[0],r=e[1];return!t&&!r?".":(r&&(r=r.substr(0,r.length-1)),t+r)}function gi(i,e){var t=pr(i)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t}function Di(i){return pr(i)[3]}var Fs={extname:Di,basename:gi,dirname:pi,sep:fi,delimiter:di,relative:hi,join:ci,isAbsolute:Dr,normalize:gr,resolve:Ot};function mr(i,e){if(i.filter)return i.filter(e);for(var t=[],r=0;r<i.length;r++)e(i[r],r,i)&&t.push(i[r]);return t}var bs="ab".substr(-1)==="b"?function(i,e,t){return i.substr(e,t)}:function(i,e,t){return e<0&&(e=i.length+e),i.substr(e,t)},Er=Object.freeze({__proto__:null,resolve:Ot,normalize:gr,isAbsolute:Dr,join:ci,relative:hi,sep:fi,delimiter:di,dirname:pi,basename:gi,extname:Di,default:Fs});function mi(){throw new Error("setTimeout has not been defined")}function Ei(){throw new Error("clearTimeout has not been defined")}var Ne=mi,Ie=Ei,st;typeof window<"u"?st=window:typeof self<"u"?st=self:st={},typeof st.setTimeout=="function"&&(Ne=setTimeout),typeof st.clearTimeout=="function"&&(Ie=clearTimeout);function yi(i){if(Ne===setTimeout)return setTimeout(i,0);if((Ne===mi||!Ne)&&setTimeout)return Ne=setTimeout,setTimeout(i,0);try{return Ne(i,0)}catch{try{return Ne.call(null,i,0)}catch{return Ne.call(this,i,0)}}}function xs(i){if(Ie===clearTimeout)return clearTimeout(i);if((Ie===Ei||!Ie)&&clearTimeout)return Ie=clearTimeout,clearTimeout(i);try{return Ie(i)}catch{try{return Ie.call(null,i)}catch{return Ie.call(this,i)}}}var _e=[],ut=!1,qe,Pt=-1;function _s(){!ut||!qe||(ut=!1,qe.length?_e=qe.concat(_e):Pt=-1,_e.length&&wi())}function wi(){if(!ut){var i=yi(_s);ut=!0;for(var e=_e.length;e;){for(qe=_e,_e=[];++Pt<e;)qe&&qe[Pt].run();Pt=-1,e=_e.length}qe=null,ut=!1,xs(i)}}function Ss(i){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];_e.push(new Ci(i,e)),_e.length===1&&!ut&&yi(wi)}function Ci(i,e){this.fun=i,this.array=e}Ci.prototype.run=function(){this.fun.apply(null,this.array)};var ks="browser",Bs="browser",Rs=!0,Ts=[],$s="",Os={},Ps={},Ns={};function Je(){}var Is=Je,Ls=Je,Ms=Je,Hs=Je,js=Je,Us=Je,zs=Je;function Ws(i){throw new Error("process.binding is not supported")}function Gs(){return"/"}function qs(i){throw new Error("process.chdir is not supported")}function Js(){return 0}var at=st.performance||{},Vs=at.now||at.mozNow||at.msNow||at.oNow||at.webkitNow||function(){return new Date().getTime()};function Ks(i){var e=Vs.call(at)*.001,t=Math.floor(e),r=Math.floor(e%1*1e9);return i&&(t=t-i[0],r=r-i[1],r<0&&(t--,r+=1e9)),[t,r]}var Xs=new Date;function Qs(){var i=new Date,e=i-Xs;return e/1e3}var Ys={nextTick:Ss,title:ks,browser:Rs,env:{NODE_ENV:"production"},argv:Ts,version:$s,versions:Os,on:Is,addListener:Ls,once:Ms,off:Hs,removeListener:js,removeAllListeners:Us,emit:zs,binding:Ws,cwd:Gs,chdir:qs,umask:Js,hrtime:Ks,platform:Bs,release:Ps,config:Ns,uptime:Qs};function Zs(i,e,t){return t={path:e,exports:{},require:function(r,n){return eu(r,n==null?t.path:n)}},i(t,t.exports),t.exports}function eu(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}const ye="\\\\/",Ai=`[^${ye}]`,Se="\\.",tu="\\+",ru="\\?",Nt="\\/",iu="(?=.)",vi="[^/]",yr=`(?:${Nt}|$)`,Fi=`(?:^|${Nt})`,wr=`${Se}{1,2}${yr}`,nu=`(?!${Se})`,su=`(?!${Fi}${wr})`,uu=`(?!${Se}{0,1}${yr})`,au=`(?!${wr})`,ou=`[^.${Nt}]`,lu=`${vi}*?`,bi={DOT_LITERAL:Se,PLUS_LITERAL:tu,QMARK_LITERAL:ru,SLASH_LITERAL:Nt,ONE_CHAR:iu,QMARK:vi,END_ANCHOR:yr,DOTS_SLASH:wr,NO_DOT:nu,NO_DOTS:su,NO_DOT_SLASH:uu,NO_DOTS_SLASH:au,QMARK_NO_DOT:ou,STAR:lu,START_ANCHOR:Fi},cu=$t(nt({},bi),{SLASH_LITERAL:`[${ye}]`,QMARK:Ai,STAR:`${Ai}*?`,DOTS_SLASH:`${Se}{1,2}(?:[${ye}]|$)`,NO_DOT:`(?!${Se})`,NO_DOTS:`(?!(?:^|[${ye}])${Se}{1,2}(?:[${ye}]|$))`,NO_DOT_SLASH:`(?!${Se}{0,1}(?:[${ye}]|$))`,NO_DOTS_SLASH:`(?!${Se}{1,2}(?:[${ye}]|$))`,QMARK_NO_DOT:`[^.${ye}]`,START_ANCHOR:`(?:^|[${ye}])`,END_ANCHOR:`(?:[${ye}]|$)`}),hu={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};var Ve={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:hu,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:Er.sep,extglobChars(i){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${i.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(i){return i===!0?cu:bi}},ee=Zs(function(i,e){const{REGEX_BACKSLASH:t,REGEX_REMOVE_BACKSLASH:r,REGEX_SPECIAL_CHARS:n,REGEX_SPECIAL_CHARS_GLOBAL:s}=Ve;e.isObject=u=>u!==null&&typeof u=="object"&&!Array.isArray(u),e.hasRegexChars=u=>n.test(u),e.isRegexChar=u=>u.length===1&&e.hasRegexChars(u),e.escapeRegex=u=>u.replace(s,"\\$1"),e.toPosixSlashes=u=>u.replace(t,"/"),e.removeBackslashes=u=>u.replace(r,a=>a==="\\"?"":a),e.supportsLookbehinds=()=>{const u=Ys.version.slice(1).split(".").map(Number);return u.length===3&&u[0]>=9||u[0]===8&&u[1]>=10},e.isWindows=u=>u&&typeof u.windows=="boolean"?u.windows:Er.sep==="\\",e.escapeLast=(u,a,o)=>{const l=u.lastIndexOf(a,o);return l===-1?u:u[l-1]==="\\"?e.escapeLast(u,a,l-1):`${u.slice(0,l)}\\${u.slice(l)}`},e.removePrefix=(u,a={})=>{let o=u;return o.startsWith("./")&&(o=o.slice(2),a.prefix="./"),o},e.wrapOutput=(u,a={},o={})=>{const l=o.contains?"":"^",h=o.contains?"":"$";let c=`${l}(?:${u})${h}`;return a.negated===!0&&(c=`(?:^(?!${c}).*$)`),c}});const{CHAR_ASTERISK:Cr,CHAR_AT:fu,CHAR_BACKWARD_SLASH:pt,CHAR_COMMA:du,CHAR_DOT:Ar,CHAR_EXCLAMATION_MARK:vr,CHAR_FORWARD_SLASH:xi,CHAR_LEFT_CURLY_BRACE:Fr,CHAR_LEFT_PARENTHESES:br,CHAR_LEFT_SQUARE_BRACKET:pu,CHAR_PLUS:gu,CHAR_QUESTION_MARK:_i,CHAR_RIGHT_CURLY_BRACE:Du,CHAR_RIGHT_PARENTHESES:Si,CHAR_RIGHT_SQUARE_BRACKET:mu}=Ve,ki=i=>i===xi||i===pt,Bi=i=>{i.isPrefix!==!0&&(i.depth=i.isGlobstar?1/0:1)};var Eu=(i,e)=>{const t=e||{},r=i.length-1,n=t.parts===!0||t.scanToEnd===!0,s=[],u=[],a=[];let o=i,l=-1,h=0,c=0,f=!1,g=!1,v=!1,C=!1,d=!1,p=!1,w=!1,F=!1,A=!1,b=!1,x=0,B,_,R={value:"",depth:0,isGlob:!1};const J=()=>l>=r,E=()=>o.charCodeAt(l+1),j=()=>(B=_,o.charCodeAt(++l));for(;l<r;){_=j();let ne;if(_===pt){w=R.backslashes=!0,_=j(),_===Fr&&(p=!0);continue}if(p===!0||_===Fr){for(x++;J()!==!0&&(_=j());){if(_===pt){w=R.backslashes=!0,j();continue}if(_===Fr){x++;continue}if(p!==!0&&_===Ar&&(_=j())===Ar){if(f=R.isBrace=!0,v=R.isGlob=!0,b=!0,n===!0)continue;break}if(p!==!0&&_===du){if(f=R.isBrace=!0,v=R.isGlob=!0,b=!0,n===!0)continue;break}if(_===Du&&(x--,x===0)){p=!1,f=R.isBrace=!0,b=!0;break}}if(n===!0)continue;break}if(_===xi){if(s.push(l),u.push(R),R={value:"",depth:0,isGlob:!1},b===!0)continue;if(B===Ar&&l===h+1){h+=2;continue}c=l+1;continue}if(t.noext!==!0&&(_===gu||_===fu||_===Cr||_===_i||_===vr)===!0&&E()===br){if(v=R.isGlob=!0,C=R.isExtglob=!0,b=!0,_===vr&&l===h&&(A=!0),n===!0){for(;J()!==!0&&(_=j());){if(_===pt){w=R.backslashes=!0,_=j();continue}if(_===Si){v=R.isGlob=!0,b=!0;break}}continue}break}if(_===Cr){if(B===Cr&&(d=R.isGlobstar=!0),v=R.isGlob=!0,b=!0,n===!0)continue;break}if(_===_i){if(v=R.isGlob=!0,b=!0,n===!0)continue;break}if(_===pu){for(;J()!==!0&&(ne=j());){if(ne===pt){w=R.backslashes=!0,j();continue}if(ne===mu){g=R.isBracket=!0,v=R.isGlob=!0,b=!0;break}}if(n===!0)continue;break}if(t.nonegate!==!0&&_===vr&&l===h){F=R.negated=!0,h++;continue}if(t.noparen!==!0&&_===br){if(v=R.isGlob=!0,n===!0){for(;J()!==!0&&(_=j());){if(_===br){w=R.backslashes=!0,_=j();continue}if(_===Si){b=!0;break}}continue}break}if(v===!0){if(b=!0,n===!0)continue;break}}t.noext===!0&&(C=!1,v=!1);let I=o,de="",m="";h>0&&(de=o.slice(0,h),o=o.slice(h),c-=h),I&&v===!0&&c>0?(I=o.slice(0,c),m=o.slice(c)):v===!0?(I="",m=o):I=o,I&&I!==""&&I!=="/"&&I!==o&&ki(I.charCodeAt(I.length-1))&&(I=I.slice(0,-1)),t.unescape===!0&&(m&&(m=ee.removeBackslashes(m)),I&&w===!0&&(I=ee.removeBackslashes(I)));const D={prefix:de,input:i,start:h,base:I,glob:m,isBrace:f,isBracket:g,isGlob:v,isExtglob:C,isGlobstar:d,negated:F,negatedExtglob:A};if(t.tokens===!0&&(D.maxDepth=0,ki(_)||u.push(R),D.tokens=u),t.parts===!0||t.tokens===!0){let ne;for(let H=0;H<s.length;H++){const ce=ne?ne+1:h,se=s[H],ae=i.slice(ce,se);t.tokens&&(H===0&&h!==0?(u[H].isPrefix=!0,u[H].value=de):u[H].value=ae,Bi(u[H]),D.maxDepth+=u[H].depth),(H!==0||ae!=="")&&a.push(ae),ne=se}if(ne&&ne+1<i.length){const H=i.slice(ne+1);a.push(H),t.tokens&&(u[u.length-1].value=H,Bi(u[u.length-1]),D.maxDepth+=u[u.length-1].depth)}D.slashes=s,D.parts=a}return D};const{MAX_LENGTH:It,POSIX_REGEX_SOURCE:yu,REGEX_NON_SPECIAL_CHARS:wu,REGEX_SPECIAL_CHARS_BACKREF:Cu,REPLACEMENTS:Ri}=Ve,Au=(i,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...i,e);i.sort();const t=`[${i.join("-")}]`;try{new RegExp(t)}catch{return i.map(n=>ee.escapeRegex(n)).join("..")}return t},ot=(i,e)=>`Missing ${i}: "${e}" - use "\\\\${e}" to match literal characters`,Ti=(i,e)=>{if(typeof i!="string")throw new TypeError("Expected a string");i=Ri[i]||i;const t=nt({},e),r=typeof t.maxLength=="number"?Math.min(It,t.maxLength):It;let n=i.length;if(n>r)throw new SyntaxError(`Input length: ${n}, exceeds maximum allowed length: ${r}`);const s={type:"bos",value:"",output:t.prepend||""},u=[s],a=t.capture?"":"?:",o=ee.isWindows(e),l=Ve.globChars(o),h=Ve.extglobChars(l),{DOT_LITERAL:c,PLUS_LITERAL:f,SLASH_LITERAL:g,ONE_CHAR:v,DOTS_SLASH:C,NO_DOT:d,NO_DOT_SLASH:p,NO_DOTS_SLASH:w,QMARK:F,QMARK_NO_DOT:A,STAR:b,START_ANCHOR:x}=l,B=k=>`(${a}(?:(?!${x}${k.dot?C:c}).)*?)`,_=t.dot?"":d,R=t.dot?F:A;let J=t.bash===!0?B(t):b;t.capture&&(J=`(${J})`),typeof t.noext=="boolean"&&(t.noextglob=t.noext);const E={input:i,index:-1,start:0,dot:t.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:u};i=ee.removePrefix(i,E),n=i.length;const j=[],I=[],de=[];let m=s,D;const ne=()=>E.index===n-1,H=E.peek=(k=1)=>i[E.index+k],ce=E.advance=()=>i[++E.index]||"",se=()=>i.slice(E.index+1),ae=(k="",V=0)=>{E.consumed+=k,E.index+=V},Fe=k=>{E.output+=k.output!=null?k.output:k.value,ae(k.value)},Bt=()=>{let k=1;for(;H()==="!"&&(H(2)!=="("||H(3)==="?");)ce(),E.start++,k++;return k%2===0?!1:(E.negated=!0,E.start++,!0)},je=k=>{E[k]++,de.push(k)},be=k=>{E[k]--,de.pop()},N=k=>{if(m.type==="globstar"){const V=E.braces>0&&(k.type==="comma"||k.type==="brace"),S=k.extglob===!0||j.length&&(k.type==="pipe"||k.type==="paren");k.type!=="slash"&&k.type!=="paren"&&!V&&!S&&(E.output=E.output.slice(0,-m.output.length),m.type="star",m.value="*",m.output=J,E.output+=m.output)}if(j.length&&k.type!=="paren"&&(j[j.length-1].inner+=k.value),(k.value||k.output)&&Fe(k),m&&m.type==="text"&&k.type==="text"){m.value+=k.value,m.output=(m.output||"")+k.value;return}k.prev=m,u.push(k),m=k},tt=(k,V)=>{const S=$t(nt({},h[V]),{conditions:1,inner:""});S.prev=m,S.parens=E.parens,S.output=E.output;const L=(t.capture?"(":"")+S.open;je("parens"),N({type:k,value:V,output:E.output?"":v}),N({type:"paren",extglob:!0,value:ce(),output:L}),j.push(S)},ir=k=>{let V=k.close+(t.capture?")":""),S;if(k.type==="negate"){let L=J;k.inner&&k.inner.length>1&&k.inner.includes("/")&&(L=B(t)),(L!==J||ne()||/^\)+$/.test(se()))&&(V=k.close=`)$))${L}`),k.inner.includes("*")&&(S=se())&&/^\.[^\\/.]+$/.test(S)&&(V=k.close=`)${S})${L})`),k.prev.type==="bos"&&(E.negatedExtglob=!0)}N({type:"paren",extglob:!0,value:D,output:V}),be("parens")};if(t.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(i)){let k=!1,V=i.replace(Cu,(S,L,Y,le,Z,Zr)=>le==="\\"?(k=!0,S):le==="?"?L?L+le+(Z?F.repeat(Z.length):""):Zr===0?R+(Z?F.repeat(Z.length):""):F.repeat(Y.length):le==="."?c.repeat(Y.length):le==="*"?L?L+le+(Z?J:""):J:L?S:`\\${S}`);return k===!0&&(t.unescape===!0?V=V.replace(/\\/g,""):V=V.replace(/\\+/g,S=>S.length%2===0?"\\\\":S?"\\":"")),V===i&&t.contains===!0?(E.output=i,E):(E.output=ee.wrapOutput(V,E,e),E)}for(;!ne();){if(D=ce(),D==="\0")continue;if(D==="\\"){const S=H();if(S==="/"&&t.bash!==!0||S==="."||S===";")continue;if(!S){D+="\\",N({type:"text",value:D});continue}const L=/^\\+/.exec(se());let Y=0;if(L&&L[0].length>2&&(Y=L[0].length,E.index+=Y,Y%2!==0&&(D+="\\")),t.unescape===!0?D=ce():D+=ce(),E.brackets===0){N({type:"text",value:D});continue}}if(E.brackets>0&&(D!=="]"||m.value==="["||m.value==="[^")){if(t.posix!==!1&&D===":"){const S=m.value.slice(1);if(S.includes("[")&&(m.posix=!0,S.includes(":"))){const L=m.value.lastIndexOf("["),Y=m.value.slice(0,L),le=m.value.slice(L+2),Z=yu[le];if(Z){m.value=Y+Z,E.backtrack=!0,ce(),!s.output&&u.indexOf(m)===1&&(s.output=v);continue}}}(D==="["&&H()!==":"||D==="-"&&H()==="]")&&(D=`\\${D}`),D==="]"&&(m.value==="["||m.value==="[^")&&(D=`\\${D}`),t.posix===!0&&D==="!"&&m.value==="["&&(D="^"),m.value+=D,Fe({value:D});continue}if(E.quotes===1&&D!=='"'){D=ee.escapeRegex(D),m.value+=D,Fe({value:D});continue}if(D==='"'){E.quotes=E.quotes===1?0:1,t.keepQuotes===!0&&N({type:"text",value:D});continue}if(D==="("){je("parens"),N({type:"paren",value:D});continue}if(D===")"){if(E.parens===0&&t.strictBrackets===!0)throw new SyntaxError(ot("opening","("));const S=j[j.length-1];if(S&&E.parens===S.parens+1){ir(j.pop());continue}N({type:"paren",value:D,output:E.parens?")":"\\)"}),be("parens");continue}if(D==="["){if(t.nobracket===!0||!se().includes("]")){if(t.nobracket!==!0&&t.strictBrackets===!0)throw new SyntaxError(ot("closing","]"));D=`\\${D}`}else je("brackets");N({type:"bracket",value:D});continue}if(D==="]"){if(t.nobracket===!0||m&&m.type==="bracket"&&m.value.length===1){N({type:"text",value:D,output:`\\${D}`});continue}if(E.brackets===0){if(t.strictBrackets===!0)throw new SyntaxError(ot("opening","["));N({type:"text",value:D,output:`\\${D}`});continue}be("brackets");const S=m.value.slice(1);if(m.posix!==!0&&S[0]==="^"&&!S.includes("/")&&(D=`/${D}`),m.value+=D,Fe({value:D}),t.literalBrackets===!1||ee.hasRegexChars(S))continue;const L=ee.escapeRegex(m.value);if(E.output=E.output.slice(0,-m.value.length),t.literalBrackets===!0){E.output+=L,m.value=L;continue}m.value=`(${a}${L}|${m.value})`,E.output+=m.value;continue}if(D==="{"&&t.nobrace!==!0){je("braces");const S={type:"brace",value:D,output:"(",outputIndex:E.output.length,tokensIndex:E.tokens.length};I.push(S),N(S);continue}if(D==="}"){const S=I[I.length-1];if(t.nobrace===!0||!S){N({type:"text",value:D,output:D});continue}let L=")";if(S.dots===!0){const Y=u.slice(),le=[];for(let Z=Y.length-1;Z>=0&&(u.pop(),Y[Z].type!=="brace");Z--)Y[Z].type!=="dots"&&le.unshift(Y[Z].value);L=Au(le,t),E.backtrack=!0}if(S.comma!==!0&&S.dots!==!0){const Y=E.output.slice(0,S.outputIndex),le=E.tokens.slice(S.tokensIndex);S.value=S.output="\\{",D=L="\\}",E.output=Y;for(const Z of le)E.output+=Z.output||Z.value}N({type:"brace",value:D,output:L}),be("braces"),I.pop();continue}if(D==="|"){j.length>0&&j[j.length-1].conditions++,N({type:"text",value:D});continue}if(D===","){let S=D;const L=I[I.length-1];L&&de[de.length-1]==="braces"&&(L.comma=!0,S="|"),N({type:"comma",value:D,output:S});continue}if(D==="/"){if(m.type==="dot"&&E.index===E.start+1){E.start=E.index+1,E.consumed="",E.output="",u.pop(),m=s;continue}N({type:"slash",value:D,output:g});continue}if(D==="."){if(E.braces>0&&m.type==="dot"){m.value==="."&&(m.output=c);const S=I[I.length-1];m.type="dots",m.output+=D,m.value+=D,S.dots=!0;continue}if(E.braces+E.parens===0&&m.type!=="bos"&&m.type!=="slash"){N({type:"text",value:D,output:c});continue}N({type:"dot",value:D,output:c});continue}if(D==="?"){if(!(m&&m.value==="(")&&t.noextglob!==!0&&H()==="("&&H(2)!=="?"){tt("qmark",D);continue}if(m&&m.type==="paren"){const L=H();let Y=D;if(L==="<"&&!ee.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(m.value==="("&&!/[!=<:]/.test(L)||L==="<"&&!/<([!=]|\w+>)/.test(se()))&&(Y=`\\${D}`),N({type:"text",value:D,output:Y});continue}if(t.dot!==!0&&(m.type==="slash"||m.type==="bos")){N({type:"qmark",value:D,output:A});continue}N({type:"qmark",value:D,output:F});continue}if(D==="!"){if(t.noextglob!==!0&&H()==="("&&(H(2)!=="?"||!/[!=<:]/.test(H(3)))){tt("negate",D);continue}if(t.nonegate!==!0&&E.index===0){Bt();continue}}if(D==="+"){if(t.noextglob!==!0&&H()==="("&&H(2)!=="?"){tt("plus",D);continue}if(m&&m.value==="("||t.regex===!1){N({type:"plus",value:D,output:f});continue}if(m&&(m.type==="bracket"||m.type==="paren"||m.type==="brace")||E.parens>0){N({type:"plus",value:D});continue}N({type:"plus",value:f});continue}if(D==="@"){if(t.noextglob!==!0&&H()==="("&&H(2)!=="?"){N({type:"at",extglob:!0,value:D,output:""});continue}N({type:"text",value:D});continue}if(D!=="*"){(D==="$"||D==="^")&&(D=`\\${D}`);const S=wu.exec(se());S&&(D+=S[0],E.index+=S[0].length),N({type:"text",value:D});continue}if(m&&(m.type==="globstar"||m.star===!0)){m.type="star",m.star=!0,m.value+=D,m.output=J,E.backtrack=!0,E.globstar=!0,ae(D);continue}let k=se();if(t.noextglob!==!0&&/^\([^?]/.test(k)){tt("star",D);continue}if(m.type==="star"){if(t.noglobstar===!0){ae(D);continue}const S=m.prev,L=S.prev,Y=S.type==="slash"||S.type==="bos",le=L&&(L.type==="star"||L.type==="globstar");if(t.bash===!0&&(!Y||k[0]&&k[0]!=="/")){N({type:"star",value:D,output:""});continue}const Z=E.braces>0&&(S.type==="comma"||S.type==="brace"),Zr=j.length&&(S.type==="pipe"||S.type==="paren");if(!Y&&S.type!=="paren"&&!Z&&!Zr){N({type:"star",value:D,output:""});continue}for(;k.slice(0,3)==="/**";){const nr=i[E.index+4];if(nr&&nr!=="/")break;k=k.slice(3),ae("/**",3)}if(S.type==="bos"&&ne()){m.type="globstar",m.value+=D,m.output=B(t),E.output=m.output,E.globstar=!0,ae(D);continue}if(S.type==="slash"&&S.prev.type!=="bos"&&!le&&ne()){E.output=E.output.slice(0,-(S.output+m.output).length),S.output=`(?:${S.output}`,m.type="globstar",m.output=B(t)+(t.strictSlashes?")":"|$)"),m.value+=D,E.globstar=!0,E.output+=S.output+m.output,ae(D);continue}if(S.type==="slash"&&S.prev.type!=="bos"&&k[0]==="/"){const nr=k[1]!==void 0?"|$":"";E.output=E.output.slice(0,-(S.output+m.output).length),S.output=`(?:${S.output}`,m.type="globstar",m.output=`${B(t)}${g}|${g}${nr})`,m.value+=D,E.output+=S.output+m.output,E.globstar=!0,ae(D+ce()),N({type:"slash",value:"/",output:""});continue}if(S.type==="bos"&&k[0]==="/"){m.type="globstar",m.value+=D,m.output=`(?:^|${g}|${B(t)}${g})`,E.output=m.output,E.globstar=!0,ae(D+ce()),N({type:"slash",value:"/",output:""});continue}E.output=E.output.slice(0,-m.output.length),m.type="globstar",m.output=B(t),m.value+=D,E.output+=m.output,E.globstar=!0,ae(D);continue}const V={type:"star",value:D,output:J};if(t.bash===!0){V.output=".*?",(m.type==="bos"||m.type==="slash")&&(V.output=_+V.output),N(V);continue}if(m&&(m.type==="bracket"||m.type==="paren")&&t.regex===!0){V.output=D,N(V);continue}(E.index===E.start||m.type==="slash"||m.type==="dot")&&(m.type==="dot"?(E.output+=p,m.output+=p):t.dot===!0?(E.output+=w,m.output+=w):(E.output+=_,m.output+=_),H()!=="*"&&(E.output+=v,m.output+=v)),N(V)}for(;E.brackets>0;){if(t.strictBrackets===!0)throw new SyntaxError(ot("closing","]"));E.output=ee.escapeLast(E.output,"["),be("brackets")}for(;E.parens>0;){if(t.strictBrackets===!0)throw new SyntaxError(ot("closing",")"));E.output=ee.escapeLast(E.output,"("),be("parens")}for(;E.braces>0;){if(t.strictBrackets===!0)throw new SyntaxError(ot("closing","}"));E.output=ee.escapeLast(E.output,"{"),be("braces")}if(t.strictSlashes!==!0&&(m.type==="star"||m.type==="bracket")&&N({type:"maybe_slash",value:"",output:`${g}?`}),E.backtrack===!0){E.output="";for(const k of E.tokens)E.output+=k.output!=null?k.output:k.value,k.suffix&&(E.output+=k.suffix)}return E};Ti.fastpaths=(i,e)=>{const t=nt({},e),r=typeof t.maxLength=="number"?Math.min(It,t.maxLength):It,n=i.length;if(n>r)throw new SyntaxError(`Input length: ${n}, exceeds maximum allowed length: ${r}`);i=Ri[i]||i;const s=ee.isWindows(e),{DOT_LITERAL:u,SLASH_LITERAL:a,ONE_CHAR:o,DOTS_SLASH:l,NO_DOT:h,NO_DOTS:c,NO_DOTS_SLASH:f,STAR:g,START_ANCHOR:v}=Ve.globChars(s),C=t.dot?c:h,d=t.dot?f:h,p=t.capture?"":"?:",w={negated:!1,prefix:""};let F=t.bash===!0?".*?":g;t.capture&&(F=`(${F})`);const A=_=>_.noglobstar===!0?F:`(${p}(?:(?!${v}${_.dot?l:u}).)*?)`,b=_=>{switch(_){case"*":return`${C}${o}${F}`;case".*":return`${u}${o}${F}`;case"*.*":return`${C}${F}${u}${o}${F}`;case"*/*":return`${C}${F}${a}${o}${d}${F}`;case"**":return C+A(t);case"**/*":return`(?:${C}${A(t)}${a})?${d}${o}${F}`;case"**/*.*":return`(?:${C}${A(t)}${a})?${d}${F}${u}${o}${F}`;case"**/.*":return`(?:${C}${A(t)}${a})?${u}${o}${F}`;default:{const R=/^(.*?)\.(\w+)$/.exec(_);if(!R)return;const J=b(R[1]);return J?J+u+R[2]:void 0}}},x=ee.removePrefix(i,w);let B=b(x);return B&&t.strictSlashes!==!0&&(B+=`${a}?`),B};var xr=Ti;const vu=i=>i&&typeof i=="object"&&!Array.isArray(i),K=(i,e,t=!1)=>{if(Array.isArray(i)){const h=i.map(f=>K(f,e,t));return f=>{for(const g of h){const v=g(f);if(v)return v}return!1}}const r=vu(i)&&i.tokens&&i.input;if(i===""||typeof i!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");const n=e||{},s=ee.isWindows(e),u=r?K.compileRe(i,e):K.makeRe(i,e,!1,!0),a=u.state;delete u.state;let o=()=>!1;if(n.ignore){const h=$t(nt({},e),{ignore:null,onMatch:null,onResult:null});o=K(n.ignore,h,t)}const l=(h,c=!1)=>{const{isMatch:f,match:g,output:v}=K.test(h,u,e,{glob:i,posix:s}),C={glob:i,state:a,regex:u,posix:s,input:h,output:v,match:g,isMatch:f};return typeof n.onResult=="function"&&n.onResult(C),f===!1?(C.isMatch=!1,c?C:!1):o(h)?(typeof n.onIgnore=="function"&&n.onIgnore(C),C.isMatch=!1,c?C:!1):(typeof n.onMatch=="function"&&n.onMatch(C),c?C:!0)};return t&&(l.state=a),l};K.test=(i,e,t,{glob:r,posix:n}={})=>{if(typeof i!="string")throw new TypeError("Expected input to be a string");if(i==="")return{isMatch:!1,output:""};const s=t||{},u=s.format||(n?ee.toPosixSlashes:null);let a=i===r,o=a&&u?u(i):i;return a===!1&&(o=u?u(i):i,a=o===r),(a===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?a=K.matchBase(i,e,t,n):a=e.exec(o)),{isMatch:Boolean(a),match:a,output:o}},K.matchBase=(i,e,t,r=ee.isWindows(t))=>(e instanceof RegExp?e:K.makeRe(e,t)).test(Er.basename(i)),K.isMatch=(i,e,t)=>K(e,t)(i),K.parse=(i,e)=>Array.isArray(i)?i.map(t=>K.parse(t,e)):xr(i,$t(nt({},e),{fastpaths:!1})),K.scan=(i,e)=>Eu(i,e),K.compileRe=(i,e,t=!1,r=!1)=>{if(t===!0)return i.output;const n=e||{},s=n.contains?"":"^",u=n.contains?"":"$";let a=`${s}(?:${i.output})${u}`;i&&i.negated===!0&&(a=`^(?!${a}).*$`);const o=K.toRegex(a,e);return r===!0&&(o.state=i),o},K.makeRe=(i,e={},t=!1,r=!1)=>{if(!i||typeof i!="string")throw new TypeError("Expected a non-empty string");let n={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(i[0]==="."||i[0]==="*")&&(n.output=xr.fastpaths(i,e)),n.output||(n=xr(i,e)),K.compileRe(n,e,t,r)},K.toRegex=(i,e)=>{try{const t=e||{};return new RegExp(i,t.flags||(t.nocase?"i":""))}catch(t){if(e&&e.debug===!0)throw t;return/$^/}},K.constants=Ve;var Fu=K,bu=Fu;function Lt(i,e){return Array.isArray(e)?e.some(t=>Lt(i,t)):bu(e)(i)}function gt(i,e,t){var r,n;if(e===void 0)return;if(i.length===0)return t(e);if(typeof e!="object"||e===null)return;const s=i.shift();if(s==="**"){for(;i.length>0&&i[0]==="*";)i.shift();const u=["**",...i].join("/"),a=new Set;$i("",e,a);for(const o of a)Lt(o,u)&&gt(o.split("/"),e,t)}else if(s.startsWith("*")){let u;s.length>=1&&(u=new RegExp((n=(r=s.match(/(\*{)(.+)(})/))==null?void 0:r[2])!=null?n:".*"));for(const a in e)u&&a.match(u)!==null&&gt([...i],e[a],t)}else gt(i,e[s],t)}function $i(i,e,t){for(const r in e)t.add(`${i}${r}`),typeof e[r]=="object"&&$i(`${i}${r}/`,e[r],t)}function xu(i,e,t){const r=i.length===0||i==="/"?[]:i.split("/");return gt(r,e,t)}function Oi(i,e,t){const r=i.length===0||i==="/"?[]:i.split("/");if(r.length===0)return;const n=r.pop();gt(r,e,s=>{if(typeof s=="object")if(n==="*")for(const u in s)s[u]=t(s[u]);else s[n]!==void 0&&(s[n]=t(s[n]))})}function _u(i,e){let t=!1;for(const r of e)if(xu(r,i,()=>t=!0),t)return!0;return!1}function Dt(i,e){if(Array.isArray(i)&&Array.isArray(e))return i.concat(e);if(Array.isArray(i))return i.concat([e]);if(Array.isArray(e))return e.concat([i]);if(typeof e!="object")return e;let t={};for(const r in i)e[r]===void 0?t[r]=i[r]:t[r]=Dt(i[r],e[r]);for(const r in e)i[r]===void 0&&(t[r]=e[r]);return t}function Su(i,e,t){if(e.length===0)return i;let r=i;for(let n=0;n<e.length;n++){if(r===void 0)return t;r=r[e[n]]}return r}function ku(i){return Array.from(i).map(e=>("00"+e.toString(16)).slice(-2)).join("")}async function Bu(i){return new Uint8Array(await crypto.subtle.digest("sha-1",i))}const Ru=new TextEncoder;async function _r(i){const e=Ru.encode(i);if(!e)return"";const t=await Bu(e);return ku(t)}function Tu(i,e){const t=Pi(i),r=Pi(e),n=t.pop(),s=r.pop(),u=Li(t,r);return u!==0?u:n&&s?Li(n.split("."),s.split(".")):n||s?n?-1:1:0}const $u=(i,e,t)=>{Iu(t);const r=Tu(i,e);return Mi[t].includes(r)},Ou=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Pi=i=>{if(typeof i!="string")throw new TypeError("Invalid argument expected string");const e=i.match(Ou);if(!e)throw new Error(`Invalid argument not valid semver ('${i}' received)`);return e.shift(),e},Ni=i=>i==="*"||i==="x"||i==="X",Ii=i=>{const e=parseInt(i,10);return isNaN(e)?i:e},Pu=(i,e)=>typeof i!=typeof e?[String(i),String(e)]:[i,e],Nu=(i,e)=>{if(Ni(i)||Ni(e))return 0;const[t,r]=Pu(Ii(i),Ii(e));return t>r?1:t<r?-1:0},Li=(i,e)=>{for(let t=0;t<Math.max(i.length,e.length);t++){const r=Nu(i[t]||0,e[t]||0);if(r!==0)return r}return 0},Mi={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]},Hi=Object.keys(Mi),Iu=i=>{if(typeof i!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof i}`);if(Hi.indexOf(i)===-1)throw new Error(`Invalid operator, expected one of ${Hi.join("|")}`)};function Lu(i){return i==="true"?!0:i==="false"?!1:i==="null"?null:i==="undefined"?void 0:Mu(i)?Number(i):typeof i=="string"&&i.startsWith('"')&&i.endsWith('"')?i.slice(1,-1):i}function Mu(i){return!isNaN(Number(i))}function ji(i){let e=0,t=0,r=!1,n=0,s=0,u="",a=[];for(;n<i.length;){if(i[n]==="^"&&u[0]==="^"||i[n]==="~"&&u[0]==="~")a.push({startColumn:s,endColumn:n,word:u}),s=n+1,u=i[n];else if(i[n]==='"')u+=i[n],r&&(a.push({startColumn:s,endColumn:n,word:u}),s=n+1,u=""),r=!r;else if(i[n]===" "||i[n]==="	"){if(r){u+=i[n],n++;continue}e===0&&t===0&&u!==""&&(a.push({startColumn:s,endColumn:n,word:u}),s=n+1,u="")}else i[n]==="{"?e++:i[n]==="}"?e--:i[n]==="["?t++:i[n]==="]"&&t--,i[n].trim()!==""&&(u+=i[n]);n++}return a.push({startColumn:s,endColumn:n,word:u}),{tokens:a}}function we(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function Ui(i,e){for(var t="",r=0,n=-1,s=0,u,a=0;a<=i.length;++a){if(a<i.length)u=i.charCodeAt(a);else{if(u===47)break;u=47}if(u===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var o=t.lastIndexOf("/");if(o!==t.length-1){o===-1?(t="",r=0):(t=t.slice(0,o),r=t.length-1-t.lastIndexOf("/")),n=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+i.slice(n+1,a):t=i.slice(n+1,a),r=a-n-1;n=a,s=0}else u===46&&s!==-1?++s:s=-1}return t}function Hu(i,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+i+r:r}var lt={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),we(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=Ui(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(we(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=Ui(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return we(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];we(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":lt.normalize(e)},relative:function(e,t){if(we(e),we(t),e===t||(e=lt.resolve(e),t=lt.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,u=1;u<t.length&&t.charCodeAt(u)===47;++u);for(var a=t.length,o=a-u,l=s<o?s:o,h=-1,c=0;c<=l;++c){if(c===l){if(o>l){if(t.charCodeAt(u+c)===47)return t.slice(u+c+1);if(c===0)return t.slice(u+c)}else s>l&&(e.charCodeAt(r+c)===47?h=c:c===0&&(h=0));break}var f=e.charCodeAt(r+c),g=t.charCodeAt(u+c);if(f!==g)break;f===47&&(h=c)}var v="";for(c=r+h+1;c<=n;++c)(c===n||e.charCodeAt(c)===47)&&(v.length===0?v+="..":v+="/..");return v.length>0?v+t.slice(u+h):(u+=h,t.charCodeAt(u)===47&&++u,t.slice(u))},_makeLong:function(e){return e},dirname:function(e){if(we(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,u=e.length-1;u>=1;--u)if(t=e.charCodeAt(u),t===47){if(!s){n=u;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');we(e);var r=0,n=-1,s=!0,u;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,o=-1;for(u=e.length-1;u>=0;--u){var l=e.charCodeAt(u);if(l===47){if(!s){r=u+1;break}}else o===-1&&(s=!1,o=u+1),a>=0&&(l===t.charCodeAt(a)?--a===-1&&(n=u):(a=-1,n=o))}return r===n?n=o:n===-1&&(n=e.length),e.slice(r,n)}else{for(u=e.length-1;u>=0;--u)if(e.charCodeAt(u)===47){if(!s){r=u+1;break}}else n===-1&&(s=!1,n=u+1);return n===-1?"":e.slice(r,n)}},extname:function(e){we(e);for(var t=-1,r=0,n=-1,s=!0,u=0,a=e.length-1;a>=0;--a){var o=e.charCodeAt(a);if(o===47){if(!s){r=a+1;break}continue}n===-1&&(s=!1,n=a+1),o===46?t===-1?t=a:u!==1&&(u=1):t!==-1&&(u=-1)}return t===-1||n===-1||u===0||u===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Hu("/",e)},parse:function(e){we(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var u=-1,a=0,o=-1,l=!0,h=e.length-1,c=0;h>=s;--h){if(r=e.charCodeAt(h),r===47){if(!l){a=h+1;break}continue}o===-1&&(l=!1,o=h+1),r===46?u===-1?u=h:c!==1&&(c=1):u!==-1&&(c=-1)}return u===-1||o===-1||c===0||c===1&&u===o-1&&u===a+1?o!==-1&&(a===0&&n?t.base=t.name=e.slice(1,o):t.base=t.name=e.slice(a,o)):(a===0&&n?(t.name=e.slice(1,u),t.base=e.slice(1,o)):(t.name=e.slice(a,u),t.base=e.slice(a,o)),t.ext=e.slice(u,o)),a>0?t.dir=e.slice(0,a-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};lt.posix=lt;var $=lt,ju=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,Uu=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,zu=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Sr={Space_Separator:ju,ID_Start:Uu,ID_Continue:zu},X={isSpaceSeparator(i){return typeof i=="string"&&Sr.Space_Separator.test(i)},isIdStartChar(i){return typeof i=="string"&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||i==="$"||i==="_"||Sr.ID_Start.test(i))},isIdContinueChar(i){return typeof i=="string"&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||i>="0"&&i<="9"||i==="$"||i==="_"||i==="\u200C"||i==="\u200D"||Sr.ID_Continue.test(i))},isDigit(i){return typeof i=="string"&&/[0-9]/.test(i)},isHexDigit(i){return typeof i=="string"&&/[0-9A-Fa-f]/.test(i)}};let kr,oe,ke,Mt,Le,De,te,Br,mt;var Wu=function(e,t){kr=String(e),oe="start",ke=[],Mt=0,Le=1,De=0,te=void 0,Br=void 0,mt=void 0;do te=Gu(),Vu[oe]();while(te.type!=="eof");return typeof t=="function"?zi({"":mt},"",t):mt};function zi(i,e,t){const r=i[e];if(r!=null&&typeof r=="object")for(const n in r){const s=zi(r,n,t);s===void 0?delete r[n]:r[n]=s}return t.call(i,e,r)}let O,T,Et,Be,M;function Gu(){for(O="default",T="",Et=!1,Be=1;;){M=Re();const i=Wi[O]();if(i)return i}}function Re(){if(kr[Mt])return String.fromCodePoint(kr.codePointAt(Mt))}function y(){const i=Re();return i===`
`?(Le++,De=0):i?De+=i.length:De++,i&&(Mt+=i.length),i}const Wi={default(){switch(M){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":y();return;case"/":y(),O="comment";return;case void 0:return y(),z("eof")}if(X.isSpaceSeparator(M)){y();return}return Wi[oe]()},comment(){switch(M){case"*":y(),O="multiLineComment";return;case"/":y(),O="singleLineComment";return}throw W(y())},multiLineComment(){switch(M){case"*":y(),O="multiLineCommentAsterisk";return;case void 0:throw W(y())}y()},multiLineCommentAsterisk(){switch(M){case"*":y();return;case"/":y(),O="default";return;case void 0:throw W(y())}y(),O="multiLineComment"},singleLineComment(){switch(M){case`
`:case"\r":case"\u2028":case"\u2029":y(),O="default";return;case void 0:return y(),z("eof")}y()},value(){switch(M){case"{":case"[":return z("punctuator",y());case"n":return y(),Ke("ull"),z("null",null);case"t":return y(),Ke("rue"),z("boolean",!0);case"f":return y(),Ke("alse"),z("boolean",!1);case"-":case"+":y()==="-"&&(Be=-1),O="sign";return;case".":T=y(),O="decimalPointLeading";return;case"0":T=y(),O="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":T=y(),O="decimalInteger";return;case"I":return y(),Ke("nfinity"),z("numeric",1/0);case"N":return y(),Ke("aN"),z("numeric",NaN);case'"':case"'":Et=y()==='"',T="",O="string";return}throw W(y())},identifierNameStartEscape(){if(M!=="u")throw W(y());y();const i=Rr();switch(i){case"$":case"_":break;default:if(!X.isIdStartChar(i))throw Gi();break}T+=i,O="identifierName"},identifierName(){switch(M){case"$":case"_":case"\u200C":case"\u200D":T+=y();return;case"\\":y(),O="identifierNameEscape";return}if(X.isIdContinueChar(M)){T+=y();return}return z("identifier",T)},identifierNameEscape(){if(M!=="u")throw W(y());y();const i=Rr();switch(i){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!X.isIdContinueChar(i))throw Gi();break}T+=i,O="identifierName"},sign(){switch(M){case".":T=y(),O="decimalPointLeading";return;case"0":T=y(),O="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":T=y(),O="decimalInteger";return;case"I":return y(),Ke("nfinity"),z("numeric",Be*(1/0));case"N":return y(),Ke("aN"),z("numeric",NaN)}throw W(y())},zero(){switch(M){case".":T+=y(),O="decimalPoint";return;case"e":case"E":T+=y(),O="decimalExponent";return;case"x":case"X":T+=y(),O="hexadecimal";return}return z("numeric",Be*0)},decimalInteger(){switch(M){case".":T+=y(),O="decimalPoint";return;case"e":case"E":T+=y(),O="decimalExponent";return}if(X.isDigit(M)){T+=y();return}return z("numeric",Be*Number(T))},decimalPointLeading(){if(X.isDigit(M)){T+=y(),O="decimalFraction";return}throw W(y())},decimalPoint(){switch(M){case"e":case"E":T+=y(),O="decimalExponent";return}if(X.isDigit(M)){T+=y(),O="decimalFraction";return}return z("numeric",Be*Number(T))},decimalFraction(){switch(M){case"e":case"E":T+=y(),O="decimalExponent";return}if(X.isDigit(M)){T+=y();return}return z("numeric",Be*Number(T))},decimalExponent(){switch(M){case"+":case"-":T+=y(),O="decimalExponentSign";return}if(X.isDigit(M)){T+=y(),O="decimalExponentInteger";return}throw W(y())},decimalExponentSign(){if(X.isDigit(M)){T+=y(),O="decimalExponentInteger";return}throw W(y())},decimalExponentInteger(){if(X.isDigit(M)){T+=y();return}return z("numeric",Be*Number(T))},hexadecimal(){if(X.isHexDigit(M)){T+=y(),O="hexadecimalInteger";return}throw W(y())},hexadecimalInteger(){if(X.isHexDigit(M)){T+=y();return}return z("numeric",Be*Number(T))},string(){switch(M){case"\\":y(),T+=qu();return;case'"':if(Et)return y(),z("string",T);T+=y();return;case"'":if(!Et)return y(),z("string",T);T+=y();return;case`
`:case"\r":throw W(y());case"\u2028":case"\u2029":Ku(M);break;case void 0:throw W(y())}T+=y()},start(){switch(M){case"{":case"[":return z("punctuator",y())}O="value"},beforePropertyName(){switch(M){case"$":case"_":T=y(),O="identifierName";return;case"\\":y(),O="identifierNameStartEscape";return;case"}":return z("punctuator",y());case'"':case"'":Et=y()==='"',O="string";return}if(X.isIdStartChar(M)){T+=y(),O="identifierName";return}throw W(y())},afterPropertyName(){if(M===":")return z("punctuator",y());throw W(y())},beforePropertyValue(){O="value"},afterPropertyValue(){switch(M){case",":case"}":return z("punctuator",y())}throw W(y())},beforeArrayValue(){if(M==="]")return z("punctuator",y());O="value"},afterArrayValue(){switch(M){case",":case"]":return z("punctuator",y())}throw W(y())},end(){throw W(y())}};function z(i,e){return{type:i,value:e,line:Le,column:De}}function Ke(i){for(const e of i){if(Re()!==e)throw W(y());y()}}function qu(){switch(Re()){case"b":return y(),"\b";case"f":return y(),"\f";case"n":return y(),`
`;case"r":return y(),"\r";case"t":return y(),"	";case"v":return y(),"\v";case"0":if(y(),X.isDigit(Re()))throw W(y());return"\0";case"x":return y(),Ju();case"u":return y(),Rr();case`
`:case"\u2028":case"\u2029":return y(),"";case"\r":return y(),Re()===`
`&&y(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw W(y());case void 0:throw W(y())}return y()}function Ju(){let i="",e=Re();if(!X.isHexDigit(e)||(i+=y(),e=Re(),!X.isHexDigit(e)))throw W(y());return i+=y(),String.fromCodePoint(parseInt(i,16))}function Rr(){let i="",e=4;for(;e-- >0;){const t=Re();if(!X.isHexDigit(t))throw W(y());i+=y()}return String.fromCodePoint(parseInt(i,16))}const Vu={start(){if(te.type==="eof")throw Xe();Tr()},beforePropertyName(){switch(te.type){case"identifier":case"string":Br=te.value,oe="afterPropertyName";return;case"punctuator":Ht();return;case"eof":throw Xe()}},afterPropertyName(){if(te.type==="eof")throw Xe();oe="beforePropertyValue"},beforePropertyValue(){if(te.type==="eof")throw Xe();Tr()},beforeArrayValue(){if(te.type==="eof")throw Xe();if(te.type==="punctuator"&&te.value==="]"){Ht();return}Tr()},afterPropertyValue(){if(te.type==="eof")throw Xe();switch(te.value){case",":oe="beforePropertyName";return;case"}":Ht()}},afterArrayValue(){if(te.type==="eof")throw Xe();switch(te.value){case",":oe="beforeArrayValue";return;case"]":Ht()}},end(){}};function Tr(){let i;switch(te.type){case"punctuator":switch(te.value){case"{":i={};break;case"[":i=[];break}break;case"null":case"boolean":case"numeric":case"string":i=te.value;break}if(mt===void 0)mt=i;else{const e=ke[ke.length-1];Array.isArray(e)?e.push(i):e[Br]=i}if(i!==null&&typeof i=="object")ke.push(i),Array.isArray(i)?oe="beforeArrayValue":oe="beforePropertyName";else{const e=ke[ke.length-1];e==null?oe="end":Array.isArray(e)?oe="afterArrayValue":oe="afterPropertyValue"}}function Ht(){ke.pop();const i=ke[ke.length-1];i==null?oe="end":Array.isArray(i)?oe="afterArrayValue":oe="afterPropertyValue"}function W(i){return jt(i===void 0?`JSON5: invalid end of input at ${Le}:${De}`:`JSON5: invalid character '${qi(i)}' at ${Le}:${De}`)}function Xe(){return jt(`JSON5: invalid end of input at ${Le}:${De}`)}function Gi(){return De-=5,jt(`JSON5: invalid identifier character at ${Le}:${De}`)}function Ku(i){console.warn(`JSON5: '${qi(i)}' in strings is not valid ECMAScript; consider escaping`)}function qi(i){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[i])return e[i];if(i<" "){const t=i.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return i}function jt(i){const e=new SyntaxError(i);return e.lineNumber=Le,e.columnNumber=De,e}var Xu=function(e,t,r){const n=[];let s="",u,a,o="",l;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(r=t.space,l=t.quote,t=t.replacer),typeof t=="function")a=t;else if(Array.isArray(t)){u=[];for(const C of t){let d;typeof C=="string"?d=C:(typeof C=="number"||C instanceof String||C instanceof Number)&&(d=String(C)),d!==void 0&&u.indexOf(d)<0&&u.push(d)}}return r instanceof Number?r=Number(r):r instanceof String&&(r=String(r)),typeof r=="number"?r>0&&(r=Math.min(10,Math.floor(r)),o="          ".substr(0,r)):typeof r=="string"&&(o=r.substr(0,10)),h("",{"":e});function h(C,d){let p=d[C];switch(p!=null&&(typeof p.toJSON5=="function"?p=p.toJSON5(C):typeof p.toJSON=="function"&&(p=p.toJSON(C))),a&&(p=a.call(d,C,p)),p instanceof Number?p=Number(p):p instanceof String?p=String(p):p instanceof Boolean&&(p=p.valueOf()),p){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof p=="string")return c(p);if(typeof p=="number")return String(p);if(typeof p=="object")return Array.isArray(p)?v(p):f(p)}function c(C){const d={"'":.1,'"':.2},p={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let w="";for(let A=0;A<C.length;A++){const b=C[A];switch(b){case"'":case'"':d[b]++,w+=b;continue;case"\0":if(X.isDigit(C[A+1])){w+="\\x00";continue}}if(p[b]){w+=p[b];continue}if(b<" "){let x=b.charCodeAt(0).toString(16);w+="\\x"+("00"+x).substring(x.length);continue}w+=b}const F=l||Object.keys(d).reduce((A,b)=>d[A]<d[b]?A:b);return w=w.replace(new RegExp(F,"g"),p[F]),F+w+F}function f(C){if(n.indexOf(C)>=0)throw TypeError("Converting circular structure to JSON5");n.push(C);let d=s;s=s+o;let p=u||Object.keys(C),w=[];for(const A of p){const b=h(A,C);if(b!==void 0){let x=g(A)+":";o!==""&&(x+=" "),x+=b,w.push(x)}}let F;if(w.length===0)F="{}";else{let A;if(o==="")A=w.join(","),F="{"+A+"}";else{let b=`,
`+s;A=w.join(b),F=`{
`+s+A+`,
`+d+"}"}}return n.pop(),s=d,F}function g(C){if(C.length===0)return c(C);const d=String.fromCodePoint(C.codePointAt(0));if(!X.isIdStartChar(d))return c(C);for(let p=d.length;p<C.length;p++)if(!X.isIdContinueChar(String.fromCodePoint(C.codePointAt(p))))return c(C);return C}function v(C){if(n.indexOf(C)>=0)throw TypeError("Converting circular structure to JSON5");n.push(C);let d=s;s=s+o;let p=[];for(let F=0;F<C.length;F++){const A=h(String(F),C);p.push(A!==void 0?A:"null")}let w;if(p.length===0)w="[]";else if(o===""){let F=p.join(",");w="["+F+"]"}else{let F=`,
`+s,A=p.join(F);w=`[
`+s+A+`,
`+d+"]"}return n.pop(),s=d,w}},Ce={parse:Wu,stringify:Xu};const Ji={behaviorPack:"./BP",resourcePack:"./RP",skinPack:"./SP",worldTemplate:"./WT"};class Qu{constructor(e){this.basePath=e,this.data={}}async refreshConfig(){this.data=await this.readConfig()}async setup(){await this.refreshConfig()}get(){return this.data}getRelativePackRoot(e){var t,r;return(r=(t=this.data.packs)==null?void 0:t[e])!=null?r:Ji[e]}getAbsolutePackRoot(e){return this.resolvePackPath(e)}resolvePackPath(e,t){return!t&&!e?this.basePath:!e&&t?$.join(this.basePath,t):!t&&e?$.join(this.basePath,this.getRelativePackRoot(e)):$.join(this.basePath,`${this.getRelativePackRoot(e)}/${t}`)}getAvailablePackPaths(){var e;const t=[];for(const r of Object.keys((e=this.data.packs)!=null?e:{}))t.push(this.resolvePackPath(r));return t}getAvailablePacks(){var e;const t={};for(const r in(e=this.data.packs)!=null?e:{})t[r]=this.resolvePackPath(r);return t}async save(){await this.writeConfig(this.data)}}class Yu{constructor(e){this.projectConfig=e,this.packTypes=[],this.extensionPackTypes=new Set}setProjectConfig(e){this.projectConfig=e}get all(){return this.packTypes.concat(...Array.from(this.extensionPackTypes.values()))}getFromId(e){return this.all.find(t=>t.id===e)}get(e){var t,r;const n=(r=(t=this.projectConfig)==null?void 0:t.getAvailablePacks())!=null?r:Ji;for(const s in n)if(e.startsWith(n[s]))return this.getFromId(s)}getId(e){var t,r;return(r=(t=this.get(e))==null?void 0:t.id)!=null?r:"unknown"}addExtensionPackType(e){return this.extensionPackTypes.add(e),{dispose:()=>this.extensionPackTypes.delete(e)}}}class Zu{constructor(e,t){this.projectConfig=e,this.isMatch=t,this.pluginFileTypes=new Set,this._fileTypes=[]}get fileTypes(){return this._fileTypes}set fileTypes(e){this._fileTypes=e.sort((t,r)=>t.add==="post"&&r.add!=="post"?1:t.add!=="post"&&r.add==="post"||t.add==="pre"&&r.add!=="pre"?-1:t.add!=="pre"&&r.add==="pre"?1:0)}get all(){return this.fileTypes.concat([...this.pluginFileTypes.values()])}setProjectConfig(e){this.projectConfig=e}addPluginFileType(e){return this.pluginFileTypes.add(e),{dispose:()=>this.pluginFileTypes.delete(e)}}getPluginFileTypes(){return[...this.pluginFileTypes.values()]}setPluginFileTypes(e=[]){this.pluginFileTypes.clear(),e.forEach(t=>this.pluginFileTypes.add(t))}get(e,t,r=!0){var n,s,u,a,o,l,h,c,f,g,v,C,d;const p=e?$.extname(e):null;if(!!p)for(const w of this.all){if(t!==void 0&&t===w.id)return w;if(!e)continue;const F=((n=w.detect)==null?void 0:n.packType)===void 0?[]:Array.isArray((s=w.detect)==null?void 0:s.packType)?(u=w.detect)==null?void 0:u.packType:[(a=w.detect)==null?void 0:a.packType],A=(o=w.detect)==null?void 0:o.fileExtensions,b=!!((l=w.detect)!=null&&l.scope),x=Array.isArray((h=w.detect)==null?void 0:h.scope)?(c=w.detect)==null?void 0:c.scope:[(f=w.detect)==null?void 0:f.scope],B=!!((g=w.detect)!=null&&g.matcher),_=Array.isArray((v=w.detect)==null?void 0:v.matcher)?(C=w.detect)==null?void 0:C.matcher:[(d=w.detect)==null?void 0:d.matcher];if(!(r&&A&&!A.includes(p)))if(b){if(this.prefixMatchers(F,x).some(R=>e.startsWith(R)))return w}else if(B){const R=this.prefixMatchers(F,_.filter(E=>!E.startsWith("!"))),J=this.prefixMatchers(F,_.filter(E=>E.startsWith("!")).map(E=>E.slice(1)));if(this.isMatch(e,R)&&!this.isMatch(e,J))return w}else throw console.log(w),new Error('Invalid file definition, no "detect" properties')}}prefixMatchers(e,t){if(!this.projectConfig)return[];if(e.length===0)return t.map(n=>this.projectConfig.resolvePackPath(void 0,n));const r=[];for(const n of e)for(const s of t)r.push(this.projectConfig.resolvePackPath(n,s));return r}getIds(){const e=[];for(const t of this.all)e.push(t.id);return e}async guessFolder(e){var t;const r=(h,c)=>{var f,g;let v=Array.isArray(h)?h[0]:h;v.endsWith("/")||(v+="/");const C=(g=(f=this.projectConfig)==null?void 0:f.getAbsolutePackRoot(c))!=null?g:"./unknown";return $.join(C,v)},n=`.${e.name.split(".").pop()}`,s=this.all.filter(({detect:h})=>{var c;return!h||!h.scope?!1:(c=h.fileExtensions)==null?void 0:c.includes(n)}),u=s.length===1,a=n!==".json"&&s.length>0;if(u||a){const{detect:h}=s[0];return r(h.scope,Array.isArray(h.packType)?h.packType[0]:(t=h.packType)!=null?t:"behaviorPack")}if(n!==".json")return null;const o=await e.getFile();let l;try{l=Ce.parse(await o.text())}catch{return null}for(const{type:h,detect:c}of s){if(typeof h=="string"&&h!=="json")continue;const{scope:f,fileContent:g,packType:v="behaviorPack"}=c!=null?c:{};if(!(!f||!g)&&!!_u(l,g))return r(f,Array.isArray(v)?v[0]:v)}return null}getId(e){var t,r;return(r=(t=this.get(e))==null?void 0:t.id)!=null?r:"unknown"}isJsonFile(e){var t,r;const n=(r=(t=this.get(e))==null?void 0:t.meta)==null?void 0:r.language;return n?n==="json":e.endsWith(".json")}}class ea extends Zu{constructor(t){super(t,Lt);P(this,"ready",new We);P(this,"lCacheFiles",{});P(this,"lCacheFilesLoaded",new We);P(this,"packSpiderFiles",{});P(this,"packSpiderFilesLoaded",new We)}setProjectConfig(t){this.projectConfig=t}async setup(t){this.fileTypes.length>0||(await t.fired,this.fileTypes=await t.readJSON("data/packages/minecraftBedrock/fileDefinitions.json"),this.loadLightningCache(t),this.loadPackSpider(t),this.ready.dispatch())}getMonacoSchemaEntries(){return this.fileTypes.map(({detect:t={},schema:r})=>{if(!t.matcher)return null;const n=(t==null?void 0:t.packType)===void 0?[]:Array.isArray(t==null?void 0:t.packType)?t==null?void 0:t.packType:[t==null?void 0:t.packType];return{fileMatch:this.prefixMatchers(n,Array.isArray(t.matcher)?[...t.matcher]:[t.matcher]).map(s=>encodeURI(s).replaceAll(/;|,|@|&|=|\+|\$|\.|!|'|\(|\)|#/g,"*")),uri:r}}).filter(t=>t!==null).flat()}async loadLightningCache(t){var s;const r=await t.readJSON("data/packages/minecraftBedrock/lightningCaches.json"),n=u=>Object.entries(r).find(([a])=>a.endsWith(u));for(const u of this.fileTypes){if(!u.lightningCache)continue;const[a,o]=(s=n(u.lightningCache))!=null?s:[];if(!a)throw new Error(`Lightning cache file "${u.lightningCache}" for file type "${u.id}" not found`);this.lCacheFiles[u.lightningCache]=o}this.lCacheFilesLoaded.dispatch()}async getLightningCache(t){var n,s;const{lightningCache:r}=(n=this.get(t))!=null?n:{};return r?(await this.lCacheFilesLoaded.fired,(s=this.lCacheFiles[r])!=null?s:[]):[]}async loadPackSpider(t){const r=await t.readJSON("data/packages/minecraftBedrock/packSpiders.json");this.packSpiderFiles=Object.fromEntries(this.fileTypes.map(({id:n,packSpider:s})=>{if(!!s)return[n,r[`file:///data/packages/minecraftBedrock/packSpider/${s}`]]}).filter(n=>n!==void 0)),this.packSpiderFilesLoaded.dispatch()}async getPackSpiderData(){return await this.packSpiderFilesLoaded.fired,this.packSpiderFiles}}const ta="/";var Vi={},ra=function(i,e,t,r,n){var s=Vi[e]||(Vi[e]=URL.createObjectURL(new Blob([i],{type:"text/javascript"}))),u=new Worker(s);return u.onerror=function(a){return n(a.error,null)},u.onmessage=function(a){return n(null,a.data)},u.postMessage(t,r),u},ue=Uint8Array,Ae=Uint16Array,yt=Uint32Array,$r=new ue([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Or=new ue([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ki=new ue([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xi=function(i,e){for(var t=new Ae(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];for(var n=new yt(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)n[s]=s-t[r]<<5|r;return[t,n]},Qi=Xi($r,2),Pr=Qi[0],ia=Qi[1];Pr[28]=258,ia[258]=28;for(var na=Xi(Or,0),Yi=na[0],Ut=new Ae(32768),G=0;G<32768;++G){var Me=(G&43690)>>>1|(G&21845)<<1;Me=(Me&52428)>>>2|(Me&13107)<<2,Me=(Me&61680)>>>4|(Me&3855)<<4,Ut[G]=((Me&65280)>>>8|(Me&255)<<8)>>>1}for(var ct=function(i,e,t){for(var r=i.length,n=0,s=new Ae(e);n<r;++n)++s[i[n]-1];var u=new Ae(e);for(n=0;n<e;++n)u[n]=u[n-1]+s[n-1]<<1;var a;if(t){a=new Ae(1<<e);var o=15-e;for(n=0;n<r;++n)if(i[n])for(var l=n<<4|i[n],h=e-i[n],c=u[i[n]-1]++<<h,f=c|(1<<h)-1;c<=f;++c)a[Ut[c]>>>o]=l}else for(a=new Ae(r),n=0;n<r;++n)i[n]&&(a[n]=Ut[u[i[n]-1]++]>>>15-i[n]);return a},wt=new ue(288),G=0;G<144;++G)wt[G]=8;for(var G=144;G<256;++G)wt[G]=9;for(var G=256;G<280;++G)wt[G]=7;for(var G=280;G<288;++G)wt[G]=8;for(var Zi=new ue(32),G=0;G<32;++G)Zi[G]=5;var en=ct(wt,9,1),tn=ct(Zi,5,1),zt=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},pe=function(i,e,t){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(e&7)&t},Wt=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},rn=function(i){return(i/8|0)+(i&7&&1)},Gt=function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var r=new(i instanceof Ae?Ae:i instanceof yt?yt:ue)(t-e);return r.set(i.subarray(e,t)),r},nn=function(i,e,t){var r=i.length;if(!r||t&&!t.l&&r<5)return e||new ue(0);var n=!e||t,s=!t||t.i;t||(t={}),e||(e=new ue(r*3));var u=function(N){var tt=e.length;if(N>tt){var ir=new ue(Math.max(tt*2,N));ir.set(e),e=ir}},a=t.f||0,o=t.p||0,l=t.b||0,h=t.l,c=t.d,f=t.m,g=t.n,v=r*8;do{if(!h){t.f=a=pe(i,o,1);var C=pe(i,o+1,3);if(o+=3,C)if(C==1)h=en,c=tn,f=9,g=5;else if(C==2){var F=pe(i,o,31)+257,A=pe(i,o+10,15)+4,b=F+pe(i,o+5,31)+1;o+=14;for(var x=new ue(b),B=new ue(19),_=0;_<A;++_)B[Ki[_]]=pe(i,o+_*3,7);o+=A*3;for(var R=zt(B),J=(1<<R)-1,E=ct(B,R,1),_=0;_<b;){var j=E[pe(i,o,J)];o+=j&15;var d=j>>>4;if(d<16)x[_++]=d;else{var I=0,de=0;for(d==16?(de=3+pe(i,o,3),o+=2,I=x[_-1]):d==17?(de=3+pe(i,o,7),o+=3):d==18&&(de=11+pe(i,o,127),o+=7);de--;)x[_++]=I}}var m=x.subarray(0,F),D=x.subarray(F);f=zt(m),g=zt(D),h=ct(m,f,1),c=ct(D,g,1)}else throw"invalid block type";else{var d=rn(o)+4,p=i[d-4]|i[d-3]<<8,w=d+p;if(w>r){if(s)throw"unexpected EOF";break}n&&u(l+p),e.set(i.subarray(d,w),l),t.b=l+=p,t.p=o=w*8;continue}if(o>v){if(s)throw"unexpected EOF";break}}n&&u(l+131072);for(var ne=(1<<f)-1,H=(1<<g)-1,ce=o;;ce=o){var I=h[Wt(i,o)&ne],se=I>>>4;if(o+=I&15,o>v){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(se<256)e[l++]=se;else if(se==256){ce=o,h=null;break}else{var ae=se-254;if(se>264){var _=se-257,Fe=$r[_];ae=pe(i,o,(1<<Fe)-1)+Pr[_],o+=Fe}var Bt=c[Wt(i,o)&H],je=Bt>>>4;if(!Bt)throw"invalid distance";o+=Bt&15;var D=Yi[je];if(je>3){var Fe=Or[je];D+=Wt(i,o)&(1<<Fe)-1,o+=Fe}if(o>v){if(s)throw"unexpected EOF";break}n&&u(l+131072);for(var be=l+ae;l<be;l+=4)e[l]=e[l-D],e[l+1]=e[l+1-D],e[l+2]=e[l+2-D],e[l+3]=e[l+3-D];l=be}}t.l=h,t.p=ce,t.b=l,h&&(a=1,t.m=f,t.d=c,t.n=g)}while(!a);return l==e.length?e:Gt(e,0,l)},sa=new ue(0),ua=function(i,e){var t={};for(var r in i)t[r]=i[r];for(var r in e)t[r]=e[r];return t},sn=function(i,e,t){for(var r=i(),n=i.toString(),s=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/ /g,"").split(","),u=0;u<r.length;++u){var a=r[u],o=s[u];if(typeof a=="function"){e+=";"+o+"=";var l=a.toString();if(a.prototype)if(l.indexOf("[native code]")!=-1){var h=l.indexOf(" ",8)+1;e+=l.slice(h,l.indexOf("(",h))}else{e+=l;for(var c in a.prototype)e+=";"+o+".prototype."+c+"="+a.prototype[c].toString()}else e+=l}else t[o]=a}return[e,t]},qt=[],aa=function(i){var e=[];for(var t in i)(i[t]instanceof ue||i[t]instanceof Ae||i[t]instanceof yt)&&e.push((i[t]=new i[t].constructor(i[t])).buffer);return e},oa=function(i,e,t,r){var n;if(!qt[t]){for(var s="",u={},a=i.length-1,o=0;o<a;++o)n=sn(i[o],s,u),s=n[0],u=n[1];qt[t]=sn(i[a],s,u)}var l=ua({},qt[t][1]);return ra(qt[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,l,aa(l),r)},la=function(){return[ue,Ae,yt,$r,Or,Ki,Pr,Yi,en,tn,Ut,ct,zt,pe,Wt,rn,Gt,nn,Ir,un,an]},un=function(i){return postMessage(i,[i.buffer])},an=function(i){return i&&i.size&&new ue(i.size)},ca=function(i,e,t,r,n,s){var u=oa(t,r,n,function(a,o){u.terminate(),s(a,o)});return u.postMessage([i,e],e.consume?[i.buffer]:[]),function(){u.terminate()}},ve=function(i,e){return i[e]|i[e+1]<<8},me=function(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24)>>>0},Nr=function(i,e){return me(i,e)+me(i,e+4)*4294967296};function ha(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ca(i,e,[la],function(r){return un(Ir(r.data[0],an(r.data[1])))},1,t)}function Ir(i,e){return nn(i,e)}var Lr=typeof TextDecoder<"u"&&new TextDecoder,fa=0;try{Lr.decode(sa,{stream:!0}),fa=1}catch{}var da=function(i){for(var e="",t=0;;){var r=i[t++],n=(r>127)+(r>223)+(r>239);if(t+n>i.length)return[e,Gt(i,t-1)];n?n==3?(r=((r&15)<<18|(i[t++]&63)<<12|(i[t++]&63)<<6|i[t++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):n&1?e+=String.fromCharCode((r&31)<<6|i[t++]&63):e+=String.fromCharCode((r&15)<<12|(i[t++]&63)<<6|i[t++]&63):e+=String.fromCharCode(r)}};function pa(i,e){if(e){for(var t="",r=0;r<i.length;r+=16384)t+=String.fromCharCode.apply(null,i.subarray(r,r+16384));return t}else{if(Lr)return Lr.decode(i);var n=da(i),s=n[0],u=n[1];if(u.length)throw"invalid utf-8 data";return s}}var ga=function(i,e){return e+30+ve(i,e+26)+ve(i,e+28)},Da=function(i,e,t){var r=ve(i,e+28),n=pa(i.subarray(e+46,e+46+r),!(ve(i,e+8)&2048)),s=e+46+r,u=me(i,e+20),a=t&&u==4294967295?ma(i,s):[u,me(i,e+24),me(i,e+42)],o=a[0],l=a[1],h=a[2];return[ve(i,e+10),o,l,n,s+ve(i,e+30)+ve(i,e+32),h]},ma=function(i,e){for(;ve(i,e)!=1;e+=4+ve(i,e+2));return[Nr(i,e+12),Nr(i,e+4),Nr(i,e+20)]};function Ea(i,e){if(typeof e!="function")throw"no callback";for(var t=[],r=function(){for(var f=0;f<t.length;++f)t[f]()},n={},s=i.length-22;me(i,s)!=101010256;--s)if(!s||i.length-s>65558){e("invalid zip file",null);return}var u=ve(i,s+8);u||e(null,{});var a=u,o=me(i,s+16),l=o==4294967295;if(l){if(s=me(i,s-12),me(i,s)!=101075792){e("invalid zip file",null);return}a=u=me(i,s+32),o=me(i,s+48)}for(var h=function(f){var g=Da(i,o,l),v=g[0],C=g[1],d=g[2],p=g[3],w=g[4],F=g[5],A=ga(i,F);o=w;var b=function(B,_){B?(r(),e(B,null)):(n[p]=_,--u||e(null,n))};if(!v)b(null,Gt(i,A,A+C));else if(v==8){var x=i.subarray(A,A+C);if(C<32e4)try{b(null,Ir(x,new ue(d)))}catch(B){b(B,null)}else t.push(ha(x,{size:d},b))}else b("unknown compression type "+v,null)},c=0;c<a;++c)h();return r}const Mr=$.dirname,ya=$.join;$.extname;const on=$.basename;$.resolve,$.relative;async function Hr(i,e,t=new Set,r=""){for await(const n of i.values()){const s=r.length===0?n.name:`${r}/${n.name}`;if(n.kind==="file"){if(n.name[0]===".")continue;await e(n,s,i)}else n.kind==="directory"&&!t.has(s)&&await Hr(n,e,t,s)}}async function wa(){return typeof(await(await navigator.storage.getDirectory()).getFileHandle("bridge-supports-writable-test",{create:!0})).createWritable=="function"}async function ln(){var i;return typeof((i=navigator.storage)==null?void 0:i.getDirectory)!="function"||!await wa()?new he(null,"bridgeFolder",void 0):await navigator.storage.getDirectory()}class Jt extends We{constructor(t){super();P(this,"_baseDirectory");t&&this.setup(t)}get baseDirectory(){return this._baseDirectory}setup(t){this._baseDirectory=t,this.hasFired||this.dispatch()}async getDirectoryHandle(t,{create:r,createOnce:n}={}){if(t===""||t===".")return this.baseDirectory;let s=this.baseDirectory;const u=t.split(/\\|\//g);u[0]==="."&&u.shift(),u[0]==="extensions"&&(u[0]="~local",u.splice(1,0,"extensions")),u[0]==="~local"&&(s=await ln(),u.shift());for(const a of u){try{s=await s.getDirectoryHandle(a,{create:n||r})}catch{throw new Error(`Failed to access "${t}": Directory does not exist`)}n&&(n=!1,r=!1)}return s}async getFileHandle(t,r=!1){if(t.length===0)throw new Error("Error: filePath is empty");const n=await this.getDirectoryHandle(Mr(t),{create:r});try{return await n.getFileHandle(on(t),{create:r})}catch{throw new Error(`File does not exist: "${t}"`)}}async pathTo(t){const r=await ln();if(t instanceof Ee&&!(r instanceof he))return;let n=await r.resolve(t).then(s=>s==null?void 0:s.join("/"));return n?n="~local/"+n:n=await this.baseDirectory.resolve(t).then(s=>s==null?void 0:s.join("/")),n}async mkdir(t,{recursive:r}={}){await this.getDirectoryHandle(t,{create:!0})}async readdir(t,{withFileTypes:r}={}){const n=await this.getDirectoryHandle(t),s=[];for await(const u of n.values())u.kind==="file"&&u.name===".DS_Store"||(r?s.push(u):s.push(u.name));return s}async readFilesFromDir(t,r=this.getDirectoryHandle(t)){r=await r;const n=[];for await(const s of r.values())s.kind==="file"&&s.name===".DS_Store"||(s.kind==="file"?n.push({name:s.name,kind:s.kind,path:`${t}/${s.name}`}):s.kind==="directory"&&n.push(...await this.readFilesFromDir(`${t}/${s.name}`,s)));return n}readFile(t){return this.getFileHandle(t).then(r=>r.getFile())}async unlink(t){if(t.length===0)throw new Error("Error: filePath is empty");const r=t.split(/\\|\//g),n=r.pop();let s;try{s=await this.getDirectoryHandle(r.join("/"))}catch{return}try{await s.removeEntry(n,{recursive:!0})}catch{}}async writeFile(t,r){const n=await this.getFileHandle(t,!0);return await this.write(n,r),n}async write(t,r){const n=await t.createWritable({keepExistingData:!1});await n.write(r),await n.close()}async readJSON(t){const r=await this.readFile(t);try{return await Ce.parse(await r.text())}catch{throw new Error(`Invalid JSON: ${t}`)}}async readJsonHandle(t){const r=await t.getFile();try{return await Ce.parse(await r.text())}catch{throw new Error(`Invalid JSON: ${t.name}`)}}writeJSON(t,r,n=!1){return this.writeFile(t,JSON.stringify(r,null,n?"	":void 0))}async move(t,r){if(await this.fileExists(t))await this.copyFile(t,r);else if(await this.directoryExists(t))await this.copyFolder(t,r);else throw new Error(`File or folder does not exist: ${t}`);await this.unlink(t)}async copyFile(t,r){const n=await this.getFileHandle(t,!1),s=await this.getFileHandle(r,!0);return await this.copyFileHandle(n,s)}async copyFileHandle(t,r){return await this.write(r,await t.getFile()),r}async copyFolder(t,r){const n=await this.getDirectoryHandle(t,{create:!1});await Hr(n,async(s,u)=>{await this.copyFileHandle(s,await this.getFileHandle(ya(r,u),!0))})}async copyFolderByHandle(t,r){const n=new Jt(r);await Hr(t,async(s,u)=>{await this.copyFileHandle(s,await n.getFileHandle(u,!0))})}loadFileHandleAsDataUrl(t){return new Promise(async(r,n)=>{const s=new FileReader;try{const u=await t.getFile();s.addEventListener("load",()=>{r(s.result)}),s.addEventListener("error",n),s.readAsDataURL(u)}catch{n(`File does not exist: "${t.name}"`)}})}async fileExists(t){try{return await this.getFileHandle(t),!0}catch{return!1}}async directoryExists(t){try{return await this.getDirectoryHandle(t),!0}catch{return!1}}async getDirectoryHandlesFromGlob(t,r="."){const n=t.split(/\/|\\/g),s=new Set([await this.getDirectoryHandle(r)]);for(const u of n){if(u==="*")for(const a of[...s.values()]){s.delete(a);for await(const o of a.values())o.kind==="directory"&&s.add(o)}else{if(u==="**")return console.warn('"**" is not supported yet'),[];for(const a of[...s.values()]){s.delete(a);try{s.add(await a.getDirectoryHandle(u))}catch{}}}if(s.size===0)return[]}return[...s.values()]}}const cn=1185286;function Ca(i){return new Promise(e=>{typeof requestIdleCallback=="function"?requestIdleCallback(async()=>{await i(),e()}):setTimeout(async()=>{await i(),e()},10)})}var Aa=JSON.parse('{"name":"bridge","version":"2.3.3","private":true,"scripts":{"dev":"vite","dev:force":"vite --force","dev:host":"vite --host","serve":"vite preview","check":"tsc --project tsconfig.json --noEmit","build":"node ./scripts/build.mjs && node ./scripts/buildApp.mjs","build:nightly":"node ./scripts/build.mjs && node ./scripts/buildApp.mjs --nightly"},"dependencies":{"@mdi/font":"^6.9.96","@types/lz-string":"^1.3.34","bridge-common-utils":"^0.3.3","bridge-iframe-api":"^0.4.7","bridge-js-runtime":"^0.3.4","bridge-model-viewer":"^0.7.7","buffer":"^6.0.3","color-convert":"^2.0.1","comlink":"^4.3.0","compare-versions":"^3.6.0","core-js":"^3.6.5","dash-compiler":"^0.9.29","escape-string-regexp":"^5.0.0","fflate":"^0.6.7","idb-keyval":"^5.1.3","is-glob":"^4.0.1","json5":"^2.1.3","jsonc-parser":"^3.0.0","lodash-es":"^4.17.20","lz-string":"^1.4.4","mc-project-core":"^0.3.21","molang":"^1.13.11","monaco-editor":"^0.33.0","path-browserify":"^1.0.1","prismarine-nbt":"^1.6.0","quick-score":"^0.0.13","tga-js":"^1.1.1","three":"^0.139.2","uuid":"^8.3.1","vue":"^2.7.8","vue-template-compiler":"^2.7.8","vuedraggable":"^2.24.3","vuetify":"^2.6.7","wintersky":"^1.1.0"},"devDependencies":{"@types/color-convert":"^2.0.0","@types/is-glob":"^4.0.1","@types/json5":"0.0.30","@types/lodash-es":"^4.17.4","@types/lodash.debounce":"^4.0.6","@types/node":"^14.17.9","@types/three":"^0.127.1","@types/uuid":"^8.3.0","@types/wicg-file-system-access":"^2020.9.5","@vitejs/plugin-vue2":"^1.1.2","markdown-it":"^12.3.2","node-fetch":"^2.6.7","prettier":"^2.2.1","sass":"^1.19.0","typescript":"^4.4.3","vite":"^3.1.2","vite-plugin-ejs":"^1.4.3","vite-plugin-pwa":"^0.12.3","vite-plugin-vue2":"^2.0.2"}}');const hn=Aa.version;class va extends Jt{constructor(t=!1){super();P(this,"_virtualFileSystem");this.isMainLoader=t}get virtualFileSystem(){if(!this._virtualFileSystem)throw new Error("DataLoader: virtualFileSystem is not initialized");return this._virtualFileSystem}async loadData(t=!1){if(this.hasFired){console.warn("This dataLoader instance already loaded data. You called loadData() twice.");return}let r=await fr("savedDataForVersion");t&&(r=void 0,await dr("savedDataForVersion",void 0));const n=r?$u(hn,r,"="):!1;this.isMainLoader&&console.log(n?"[APP] Data saved; restoring from cache...":"[APP] Latest data not saved; fetching now..."),console.time("[App] Data");const s=this.isMainLoader&&!n;if(this._virtualFileSystem=new he(new dt("data-fs"),"bridgeFolder",n?void 0:new Map,s),await this._virtualFileSystem.setupDone.fired,n){this.setup(this._virtualFileSystem),console.timeEnd("[App] Data");return}const u=await fetch(ta+"packages.zip").then(h=>h.arrayBuffer());if(u.byteLength!==cn)throw new Error(`Error: Data package was larger than the expected size of ${cn} bytes; got ${u.byteLength} bytes`);const a=await new Promise((h,c)=>Ea(new Uint8Array(u),async(f,g)=>{if(f)return c(f);h(g)})),l={".":await this._virtualFileSystem.getDirectoryHandle("data",{create:!0})};for(const h in a){const c=on(h),f=Mr(h);if(h.endsWith("/")){const g=await l[f].getDirectoryHandle(c,{create:!0});l[h.slice(0,-1)]=g}else await l[f].getFileHandle(c,{create:!0,initialData:a[h]})}this.setup(this._virtualFileSystem),console.timeEnd("[App] Data"),this.isMainLoader&&!t&&Ca(async()=>{await this._virtualFileSystem.moveToIdb(),await dr("savedDataForVersion",hn)})}}const Fa={"!":"BANG","&":"AND","(":"LEFT_PARENT",")":"RIGHT_PARENT","*":"ASTERISK","+":"PLUS",",":"COMMA","-":"MINUS","/":"SLASH",":":"COLON",";":"SEMICOLON","<":"SMALLER","=":"EQUALS",">":"GREATER","?":"QUESTION","[":"ARRAY_LEFT","]":"ARRAY_RIGHT","{":"CURLY_LEFT","|":"OR","}":"CURLY_RIGHT"},fn=new Set(["return","continue","break","for_each","loop","false","true"]);class Ct{constructor(e,t,r,n){this.type=e,this.text=t,this.startColumn=r,this.startLine=n}getType(){return this.type}getText(){return this.text}getPosition(){return{startColumn:this.startColumn,startLineNumber:this.startLine,endColumn:this.startColumn+this.text.length,endLineNumber:this.startLine}}}class dn{constructor(e){this.i=0,this.currentColumn=0,this.currentLine=0,this.lastColumns=0,this.keywordTokens=e?new Set([...fn,...e]):fn}init(e){this.currentLine=0,this.currentColumn=0,this.lastColumns=0,this.i=0,this.expression=e}next(){for(this.currentColumn=this.i-this.lastColumns;this.i<this.expression.length&&(this.expression[this.i]===" "||this.expression[this.i]==="	"||this.expression[this.i]===`
`);)this.expression[this.i]===`
`&&(this.currentLine++,this.currentColumn=0,this.lastColumns=this.i+1),this.i++;if(this.expression[this.i]==="#"){const t=this.expression.indexOf(`
`,this.i+1);return this.i=t===-1?this.expression.length:t,this.currentLine++,this.lastColumns=this.i+1,this.currentColumn=0,this.next()}let e=Fa[this.expression[this.i]];if(e)return new Ct(e,this.expression[this.i++],this.currentColumn,this.currentLine);if(this.isLetter(this.expression[this.i])||this.expression[this.i]==="_"){let t=this.i+1;for(;t<this.expression.length&&(this.isLetter(this.expression[t])||this.isNumber(this.expression[t])||this.expression[t]==="_"||this.expression[t]===".");)t++;const r=this.expression.substring(this.i,t).toLowerCase();return this.i=t,new Ct(this.keywordTokens.has(r)?r.toUpperCase():"NAME",r,this.currentColumn,this.currentLine)}if(this.isNumber(this.expression[this.i])||this.expression[this.i]==="."){let t=this.i+1,r=this.expression[this.i]===".";for(;t<this.expression.length&&(this.isNumber(this.expression[t])||this.expression[t]==="."&&!r);)this.expression[t]==="."&&(r=!0),t++;const n=new Ct("NUMBER",this.expression.substring(this.i,t),this.currentColumn,this.currentLine),s=r&&this.expression[t]==="f";return this.i=s?t+1:t,n}if(this.expression[this.i]==="'"){let t=this.i+1;for(;t<this.expression.length&&this.expression[t]!=="'";)t++;t++;const r=new Ct("STRING",this.expression.substring(this.i,t),this.currentColumn,this.currentLine);return this.i=t,r}return this.hasNext()?(this.i++,this.next()):new Ct("EOF","",this.currentColumn,this.currentLine)}hasNext(){return this.i<this.expression.length}isLetter(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumber(e){return e>="0"&&e<="9"}}const ba=(i,e,t)=>typeof i!="number"||Number.isNaN(i)?e:i>t?t:i<e?e:i,xa=(i,e,t)=>{let r=0;for(;0<i;)r+=pn(e,t);return r},_a=(i,e,t)=>{let r=0;for(;0<i;)r+=gn(e,t);return r},Sa=i=>3*i**2-2*i**3,ka=(i,e,t)=>(t<0?t=0:t>1&&(t=1),i+(e-i)*t),Ba=(i,e,t)=>{const r=n=>((n+180)%360+180)%360;if((i=r(i))>(e=r(e))){let n=i;i=e,e=n}return e-i>180?r(e+t*(360-(e-i))):i+t*(e-i)},Ra=(i,e)=>i%e,pn=(i,e)=>i+Math.random()*(e-i),gn=(i,e)=>Math.round(i+Math.random()*(e-i)),Ta=i=>((i=((i%=360)+360)%360)>179&&(i-=360),i),$a=i=>{const e=i?1:Math.PI/180;return{"math.abs":Math.abs,"math.acos":t=>Math.acos(t)/e,"math.asin":t=>Math.asin(t)/e,"math.atan":t=>Math.atan(t)/e,"math.atan2":(t,r)=>Math.atan2(t,r)/e,"math.ceil":Math.ceil,"math.clamp":ba,"math.cos":t=>Math.cos(t*e),"math.die_roll":xa,"math.die_roll_integer":_a,"math.exp":Math.exp,"math.floor":Math.floor,"math.hermite_blend":Sa,"math.lerp":ka,"math.lerp_rotate":Ba,"math.ln":Math.log,"math.max":Math.max,"math.min":Math.min,"math.min_angle":Ta,"math.mod":Ra,"math.pi":Math.PI,"math.pow":Math.pow,"math.random":pn,"math.random_integer":gn,"math.round":Math.round,"math.sin":t=>Math.sin(t*e),"math.sqrt":Math.sqrt,"math.trunc":Math.trunc}},Oa={"query.in_range":(i,e,t)=>typeof i!="number"||typeof e!="number"||typeof t!="number"?(console.error('"query.in_range": value, min and max must be numbers'),!1):i>=e&&i<=t,"query.all":(i,...e)=>e.every(t=>t===i),"query.any":(i,...e)=>e.some(t=>t===i),"query.count":i=>Array.isArray(i)?i.length:1},Dn=i=>({...$a(i),...Oa});class jr{constructor(e,t){var r;if(this.config=t,!e)throw new Error("Provided environment must be an object");this.env={...Dn((r=t.useRadians)!=null?r:!1),"query.self":()=>this.env,...t.isFlat?e:this.flattenEnv(e)}}updateConfig({variableHandler:e,convertUndefined:t,useRadians:r}){t!==void 0&&(this.config.convertUndefined=t),typeof e=="function"&&(this.config.variableHandler=e),!!this.config.useRadians!=!!r&&(this.env=Object.assign(this.env,Dn(!!r)))}get(){return this.env}flattenEnv(e,t="",r={}){for(let n in e){let s=n;if(n[1]===".")switch(n[0]){case"q":s="query"+n.substring(1,n.length);break;case"t":s="temp"+n.substring(1,n.length);break;case"v":s="variable"+n.substring(1,n.length);break;case"c":s="context"+n.substring(1,n.length);break;case"f":s="function"+n.substring(1,n.length)}e[n].__isContext?r[`${t}${s}`]=e[n].env:typeof e[n]!="object"||Array.isArray(e[n])?r[`${t}${s}`]=e[n]:this.flattenEnv(e[n],`${t}${n}.`,r)}return r}setAt(e,t){if(e[1]===".")switch(e[0]){case"q":e="query"+e.substring(1,e.length);break;case"t":e="temp"+e.substring(1,e.length);break;case"v":e="variable"+e.substring(1,e.length);break;case"c":e="context"+e.substring(1,e.length);break;case"f":e="function"+e.substring(1,e.length)}return this.env[e]=t}getFrom(e){var r,n,s;if(e[1]===".")switch(e[0]){case"q":e="query"+e.substring(1,e.length);break;case"t":e="temp"+e.substring(1,e.length);break;case"v":e="variable"+e.substring(1,e.length);break;case"c":e="context"+e.substring(1,e.length);break;case"f":e="function"+e.substring(1,e.length)}const t=(s=this.env[e])!=null?s:(n=(r=this.config).variableHandler)==null?void 0:n.call(r,e,this.env);return t===void 0&&this.config.convertUndefined?0:t}}class Q{toString(){return""+this.eval()}walk(e,t=new Set){var n;let r=(n=e(this))!=null?n:this;return r.iterate(e,t),r}iterate(e,t){var r;for(let n=0;n<this.allExpressions.length;n++){const s=this.allExpressions[n];if(t.has(s))continue;t.add(s);const u=(r=e(s))!=null?r:s;u!==s&&t.has(u)||(t.add(u),this.setExpressionAt(n,u),u.iterate(e,t))}}some(e){return this.allExpressions.some(t=>e(t)||t.some(e))}}class ht extends Q{constructor(){super(...arguments),this.type="VoidExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return 0}toString(){return""}}class ie extends Q{constructor(e,t,r,n){super(),this.left=e,this.right=t,this.operator=r,this.evalHelper=n,this.type="GenericOperatorExpression"}get allExpressions(){return[this.left,this.right]}setExpressionAt(e,t){e===0?this.left=t:e===1&&(this.right=t)}isStatic(){return this.left.isStatic()&&this.right.isStatic()}eval(){return this.evalHelper(this.left,this.right)}toString(){return`${this.left.toString()}${this.operator}${this.right.toString()}`}}const Pa=(i,e)=>{const t=i.eval(),r=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof r!="number"&&typeof r!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} + ${r}"`);return t+r},Na=(i,e)=>{const t=i.eval(),r=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof r!="number"&&typeof r!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} - ${r}"`);return t-r},Ia=(i,e)=>{const t=i.eval(),r=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof r!="number"&&typeof r!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} / ${r}"`);return t/r},La=(i,e)=>{const t=i.eval(),r=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof r!="number"&&typeof r!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} * ${r}"`);return t*r},Ma=(i,e)=>{if(i.setPointer)return i.setPointer(e.eval()),0;throw Error("Cannot assign to "+i.type)};class At{constructor(e=0){this.precedence=e}parse(e,t,r){const n=e.parseExpression(this.precedence),s=r.getText();switch(s){case"+":return new ie(t,n,s,Pa);case"-":return new ie(t,n,s,Na);case"*":return new ie(t,n,s,La);case"/":return new ie(t,n,s,Ia);case"=":return new ie(t,n,"=",Ma);default:throw new Error("Operator not implemented")}}}var q;(function(i){i[i.SCOPE=1]="SCOPE",i[i.STATEMENT=2]="STATEMENT",i[i.ASSIGNMENT=3]="ASSIGNMENT",i[i.CONDITIONAL=4]="CONDITIONAL",i[i.ARRAY_ACCESS=5]="ARRAY_ACCESS",i[i.NULLISH_COALESCING=6]="NULLISH_COALESCING",i[i.AND=7]="AND",i[i.OR=8]="OR",i[i.EQUALS_COMPARE=9]="EQUALS_COMPARE",i[i.COMPARE=10]="COMPARE",i[i.SUM=11]="SUM",i[i.PRODUCT=12]="PRODUCT",i[i.EXPONENT=13]="EXPONENT",i[i.PREFIX=14]="PREFIX",i[i.POSTFIX=15]="POSTFIX",i[i.FUNCTION=16]="FUNCTION"})(q||(q={}));class mn extends Q{constructor(e,t){super(),this.tokenType=e,this.expression=t,this.type="PrefixExpression"}get allExpressions(){return[this.expression]}setExpressionAt(e,t){this.expression=t}isStatic(){return this.expression.isStatic()}eval(){const e=this.expression.eval();if(typeof e!="number")throw new Error(`Cannot use "${this.tokenType}" operator in front of ${typeof e} "${e}"`);switch(this.tokenType){case"MINUS":return-e;case"BANG":return!e}}toString(){switch(this.tokenType){case"MINUS":return"-"+this.expression.toString();case"BANG":return"!"+this.expression.toString()}throw new Error(`Unknown prefix operator: "${this.tokenType}"`)}}class En{constructor(e=0){this.precedence=e}parse(e,t){return new mn(t.getType(),e.parseExpression(this.precedence))}}class Ur extends Q{constructor(e){super(),this.value=e,this.type="NumberExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.value}toString(){const e=""+this.value;return e.startsWith("0.")?e.slice(1):e}}class Ha{constructor(e=0){this.precedence=e}parse(e,t){return new Ur(Number(t.getText()))}}class vt extends Q{constructor(e,t,r=!1){super(),this.executionEnv=e,this.name=t,this.isFunctionCall=r,this.type="NameExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!1}setPointer(e){this.executionEnv.setAt(this.name,e)}setFunctionCall(e=!0){this.isFunctionCall=e}setName(e){this.name=e}setExecutionEnv(e){this.executionEnv=e}eval(){const e=this.executionEnv.getFrom(this.name);return this.isFunctionCall||typeof e!="function"?e:e()}toString(){return this.name}}class ja extends Q{constructor(e,t){super(),this.leftExpr=e,this.rightExpr=t,this.type="NameExpression"}get allExpressions(){return[this.leftExpr,this.rightExpr]}setExpressionAt(e,t){if(!(t instanceof vt))throw new Error('Cannot use context switch operator "->" on '+t.type);e===0?this.leftExpr=t:e===1&&(this.rightExpr=t)}isStatic(){return!1}eval(){const e=this.leftExpr.eval();return typeof e!="object"?0:(this.rightExpr.setExecutionEnv(new jr(e,this.rightExpr.executionEnv.config)),this.rightExpr.eval())}toString(){return`${this.leftExpr.toString()}->${this.rightExpr.toString()}`}}class Ua{constructor(e=0){this.precedence=e}parse(e,t){const r=new vt(e.executionEnv,t.getText()),n=[e.lookAhead(0),e.lookAhead(1)];if(n[0].getType()==="MINUS"&&n[1].getType()==="GREATER"){e.consume("MINUS"),e.consume("GREATER");const s=e.parseExpression(q.FUNCTION-1);if(s.type!=="NameExpression"&&s.type!=="FunctionExpression")throw new Error('Cannot use context switch operator "->" on '+s.type);return new ja(r,s)}return r}}class Te extends Q{constructor(e,t){super(),this.expression=e,this.brackets=t,this.type="GroupExpression"}get allExpressions(){return[this.expression]}setExpressionAt(e,t){this.expression=t}isStatic(){return this.expression.isStatic()}get isReturn(){return this.expression.isReturn}get isBreak(){return this.expression.isBreak}get isContinue(){return this.expression.isContinue}eval(){return this.expression.eval()}toString(){return`${this.brackets[0]}${this.expression.toString()}${this.brackets[1]}`}}class za{constructor(e=0){this.precedence=e}parse(e,t){const r=e.parseExpression(this.precedence);return e.consume("RIGHT_PARENT"),e.config.keepGroups?new Te(r,"()"):r}}class Qe extends Q{constructor(e){super(),this.expression=e,this.type="ReturnExpression",this.isReturn=!0}get allExpressions(){return[this.expression]}setExpressionAt(e,t){this.expression=t}isStatic(){return!1}eval(){return this.expression.eval()}toString(){return"return "+this.expression.toString()}}class Wa{constructor(e=0){this.precedence=e}parse(e,t){const r=e.parseExpression(q.STATEMENT+1);return new Qe(e.match("SEMICOLON",!1)?r:new Ur(0))}}class Ye extends Q{constructor(e,t=!1){super(),this.value=e,this.isReturn=t,this.type="StaticExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.value}toString(){let e=this.value;return typeof e=="string"&&(e=`'${e}'`),this.isReturn?"return "+e:""+e}}class ge extends Q{constructor(e){super(),this.expressions=e,this.type="StatementExpression",this.didReturn=void 0,this.wasLoopBroken=!1,this.wasLoopContinued=!1}get allExpressions(){return this.expressions}setExpressionAt(e,t){this.expressions[e]=t}get isReturn(){if(this.didReturn!==void 0)return this.didReturn;let e=0;for(;e<this.expressions.length;){const t=this.expressions[e];if(t.isBreak||t.isContinue)return!1;if(t.isReturn)return this.didReturn=!0,!0;e++}return this.didReturn=!1,!1}get isBreak(){return!!this.wasLoopBroken&&(this.wasLoopBroken=!1,!0)}get isContinue(){return!!this.wasLoopContinued&&(this.wasLoopContinued=!1,!0)}isStatic(){let e=0;for(;e<this.expressions.length;){if(!this.expressions[e].isStatic())return!1;e++}return!0}eval(){this.didReturn=!1,this.wasLoopBroken=!1,this.wasLoopContinued=!1;let e=0;for(;e<this.expressions.length;){let t=this.expressions[e].eval();if(this.expressions[e].isReturn)return this.didReturn=!0,t;if(this.expressions[e].isContinue)return void(this.wasLoopContinued=!0);if(this.expressions[e].isBreak)return void(this.wasLoopBroken=!0);e++}return 0}toString(){let e="";for(const t of this.expressions){if(t instanceof ht||t instanceof Ye&&!t.isReturn)continue;const r=t.toString();r&&(e+=r+";")}return e}}class Ga{constructor(e=0){this.precedence=e}findReEntryPoint(e){let t=1,r=e.lookAhead(0).getType();for(;r!=="EOF"&&(r=="CURLY_RIGHT"?t--:r==="CURLY_LEFT"&&t++,t!==0);)e.consume(),r=e.lookAhead(0).getType()}parse(e,t,r){if(e.config.useOptimizer&&(t.isStatic()&&(t=new Ye(t.eval(),t.isReturn)),e.config.earlyReturnsSkipParsing&&t.isReturn))return e.config.earlyReturnsSkipTokenization||this.findReEntryPoint(e),new ge([t]);const n=[t];if(!e.match("CURLY_RIGHT",!1))do{let s=e.parseExpression(this.precedence);if(e.config.useOptimizer){if(s.isStatic()){if(e.config.useAgressiveStaticOptimizer&&!s.isReturn)continue;s=new Ye(s.eval(),s.isReturn)}if(e.config.earlyReturnsSkipParsing&&(s.isBreak||s.isContinue||s.isReturn))return n.push(s),e.config.earlyReturnsSkipTokenization||this.findReEntryPoint(e),new ge(n)}n.push(s)}while(e.match("SEMICOLON")&&!e.match("EOF")&&!e.match("CURLY_RIGHT",!1));return e.match("SEMICOLON"),new ge(n)}}class Vt extends Q{constructor(e){super(),this.name=e,this.type="StringExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.name.substring(1,this.name.length-1)}toString(){return this.name}}class qa{constructor(e=0){this.precedence=e}parse(e,t){return new Vt(t.getText())}}class yn extends Q{constructor(e,t){super(),this.name=e,this.args=t,this.type="FunctionExpression"}get allExpressions(){return[this.name,...this.args]}setExpressionAt(e,t){e===0?this.name=t:e>0&&(this.args[e-1]=t)}setExecutionEnv(e){this.name.setExecutionEnv(e)}get executionEnv(){return this.name.executionEnv}isStatic(){return!1}eval(){const e=[];let t=0;for(;t<this.args.length;)e.push(this.args[t++].eval());const r=this.name.eval();if(typeof r!="function")throw new Error(this.name.toString()+" is not callable!");return r(...e)}toString(){let e=this.name.toString()+"(";for(let t=0;t<this.args.length;t++)e+=`${this.args[t].toString()}${t+1<this.args.length?",":""}`;return e+")"}}class Ja{constructor(e=0){this.precedence=e}parse(e,t,r){const n=[];if(!t.setFunctionCall)throw new Error(t.type+" is not callable!");if(t.setFunctionCall(!0),!e.match("RIGHT_PARENT")){do n.push(e.parseExpression());while(e.match("COMMA"));e.consume("RIGHT_PARENT")}return new yn(t,n)}}class wn extends Q{constructor(e,t){super(),this.name=e,this.lookup=t,this.type="ArrayAccessExpression"}get allExpressions(){return[this.name,this.lookup]}setExpressionAt(e,t){e===0?this.name=t:e===1&&(this.lookup=t)}isStatic(){return!1}setPointer(e){this.name.eval()[this.lookup.eval()]=e}eval(){return this.name.eval()[this.lookup.eval()]}toString(){return`${this.name.toString()}[${this.lookup.toString()}]`}}class Va{constructor(e=0){this.precedence=e}parse(e,t,r){const n=e.parseExpression(this.precedence-1);if(!t.setPointer)throw new Error(`"${t.type}" is not an array`);if(!e.match("ARRAY_RIGHT"))throw new Error(`No closing bracket for opening bracket "[${n.eval()}"`);return new wn(t,n)}}class Ka{constructor(e=0){this.precedence=e}parse(e,t){let r=e.parseExpression(this.precedence);return e.config.useOptimizer&&e.config.earlyReturnsSkipTokenization&&r.isReturn?e.match("CURLY_RIGHT"):e.consume("CURLY_RIGHT"),e.config.keepGroups?new Te(r,"{}"):r}}class Cn extends Q{constructor(e,t){super(),this.count=e,this.expression=t,this.type="LoopExpression"}get allExpressions(){return[this.count,this.expression]}get isNoopLoop(){return this.count.isStatic()&&this.count.eval()===0}setExpressionAt(e,t){e===0?this.count=t:e===1&&(this.expression=t)}get isReturn(){return!this.isNoopLoop&&this.expression.isReturn}isStatic(){return this.count.isStatic()&&this.expression.isStatic()}eval(){const e=Number(this.count.eval());if(e===0)return 0;if(Number.isNaN(e))throw new Error(`First loop() argument must be of type number, received "${typeof this.count.eval()}"`);if(e>1024)throw new Error(`Cannot loop more than 1024x times, received "${e}"`);let t=0;for(;t<e;){t++;const r=this.expression.eval();if(this.expression.isBreak)break;if(!this.expression.isContinue&&this.expression.isReturn)return r}return 0}toString(){return this.isNoopLoop?"":`loop(${this.count.toString()},${this.expression.toString()})`}}class Xa{constructor(e=0){this.precedence=e}parse(e,t){e.consume("LEFT_PARENT");const r=[];if(e.match("RIGHT_PARENT"))throw new Error("loop() called without arguments");do r.push(e.parseExpression());while(e.match("COMMA"));if(e.consume("RIGHT_PARENT"),r.length!==2)throw new Error("There must be exactly two loop() arguments; found "+r.length);return new Cn(r[0],r[1])}}class An extends Q{constructor(e,t,r){if(super(),this.variable=e,this.arrayExpression=t,this.expression=r,this.type="ForEachExpression",!this.variable.setPointer)throw new Error(`First for_each() argument must be a variable, received "${typeof this.variable.eval()}"`)}get isReturn(){return this.expression.isReturn}get allExpressions(){return[this.variable,this.arrayExpression,this.expression]}setExpressionAt(e,t){e===0?this.variable=t:e===1?this.arrayExpression=t:e===2&&(this.expression=t)}isStatic(){return this.variable.isStatic()&&this.arrayExpression.isStatic()&&this.expression.isStatic()}eval(){var r,n;const e=this.arrayExpression.eval();if(!Array.isArray(e))throw new Error(`Second for_each() argument must be an array, received "${typeof e}"`);let t=0;for(;t<e.length;){(n=(r=this.variable).setPointer)==null||n.call(r,e[t++]);const s=this.expression.eval();if(this.expression.isBreak)break;if(!this.expression.isContinue&&this.expression.isReturn)return s}return 0}toString(){return`for_each(${this.variable.toString()},${this.arrayExpression.toString()},${this.expression.toString()})`}}class Qa{constructor(e=0){this.precedence=e}parse(e,t){e.consume("LEFT_PARENT");const r=[];if(e.match("RIGHT_PARENT"))throw new Error("for_each() called without arguments");do r.push(e.parseExpression());while(e.match("COMMA"));if(e.consume("RIGHT_PARENT"),r.length!==3)throw new Error("There must be exactly three for_each() arguments; found "+r.length);return new An(r[0],r[1],r[2])}}class vn extends Q{constructor(){super(),this.type="ContinueExpression",this.isContinue=!0}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!1}eval(){return 0}toString(){return"continue"}}class Ya{constructor(e=0){this.precedence=e}parse(e,t){return new vn}}class Fn extends Q{constructor(){super(),this.type="BreakExpression",this.isBreak=!0}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!1}eval(){return 0}isString(){return"break"}}class Za{constructor(e=0){this.precedence=e}parse(e,t){return new Fn}}class bn extends Q{constructor(e){super(),this.value=e,this.type="BooleanExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.value}}class xn{constructor(e=0){this.precedence=e}parse(e,t){return new bn(t.getText()==="true")}}class eo{constructor(e=0){this.precedence=e}parse(e,t,r){return new ie(t,e.parseExpression(this.precedence),"==",(n,s)=>n.eval()===s.eval())}}class to{constructor(e=0){this.precedence=e}parse(e,t,r){if(e.match("EQUALS"))return new ie(t,e.parseExpression(this.precedence),"!=",(n,s)=>n.eval()!==s.eval());throw new Error("! was used as a binary operator")}}class ro{constructor(e=0){this.precedence=e}parse(e,t,r){if(e.match("AND"))return new ie(t,e.parseExpression(this.precedence),"&&",(n,s)=>n.eval()&&s.eval());throw new Error('"&" not followed by another "&"')}}class io{constructor(e=0){this.precedence=e}parse(e,t,r){if(e.match("OR"))return new ie(t,e.parseExpression(this.precedence),"||",(n,s)=>n.eval()||s.eval());throw new Error('"|" not followed by another "|"')}}class no{constructor(e=0){this.precedence=e}parse(e,t,r){return e.match("EQUALS")?new ie(t,e.parseExpression(this.precedence),"<=",(n,s)=>n.eval()<=s.eval()):new ie(t,e.parseExpression(this.precedence),"<",(n,s)=>n.eval()<s.eval())}}class so{constructor(e=0){this.precedence=e}parse(e,t,r){return e.match("EQUALS")?new ie(t,e.parseExpression(this.precedence),">=",(n,s)=>n.eval()>=s.eval()):new ie(t,e.parseExpression(this.precedence),">",(n,s)=>n.eval()>s.eval())}}class zr extends Q{constructor(e,t,r){super(),this.leftExpression=e,this.thenExpression=t,this.elseExpression=r,this.type="TernaryExpression"}get allExpressions(){return this.leftExpression.isStatic()?[this.leftExpression,this.leftExpression.eval()?this.thenExpression:this.elseExpression]:[this.leftExpression,this.thenExpression,this.elseExpression]}setExpressionAt(e,t){e===0?this.leftExpression=t:e===1?this.thenExpression=t:e===2&&(this.elseExpression=t)}get isReturn(){return this.leftResult===void 0?this.thenExpression.isReturn&&this.elseExpression.isReturn:this.leftResult?this.thenExpression.isReturn:this.elseExpression.isReturn}get hasReturn(){return this.thenExpression.isReturn||this.elseExpression.isReturn}get isContinue(){return this.leftResult===void 0?this.thenExpression.isContinue&&this.elseExpression.isContinue:this.leftResult?this.thenExpression.isContinue:this.elseExpression.isContinue}get isBreak(){return this.leftResult===void 0?this.thenExpression.isBreak&&this.elseExpression.isBreak:this.leftResult?this.thenExpression.isBreak:this.elseExpression.isBreak}isStatic(){return this.leftExpression.isStatic()&&this.thenExpression.isStatic()&&this.elseExpression.isStatic()}eval(){return this.leftResult=this.leftExpression.eval(),this.leftResult?this.thenExpression.eval():this.elseExpression.eval()}toString(){return this.elseExpression instanceof ht?`${this.leftExpression.toString()}?${this.thenExpression.toString()}`:`${this.leftExpression.toString()}?${this.thenExpression.toString()}:${this.elseExpression.toString()}`}}const uo=new class{constructor(i=0){this.precedence=i,this.exprName="Ternary"}parse(i,e,t){let r,n=i.parseExpression(this.precedence-1);return r=i.match("COLON")?i.parseExpression(this.precedence-1):new ht,i.config.useOptimizer&&e.isStatic()?e.eval()?n:r:new zr(e,n,r)}}(q.CONDITIONAL);class ao{constructor(e=0){this.precedence=e}parse(e,t,r){return e.match("QUESTION")?new ie(t,e.parseExpression(this.precedence),"??",(n,s)=>{var u;return(u=n.eval())!=null?u:s.eval()}):uo.parse(e,t,r)}}class _n extends class{constructor(e){this.config=e,this.prefixParselets=new Map,this.infixParselets=new Map,this.readTokens=[],this.tokenIterator=new dn}updateConfig(e){this.config=e}init(e){this.tokenIterator.init(e),this.readTokens=[]}setTokenizer(e){this.tokenIterator=e}setExecutionEnvironment(e){this.executionEnv=e}parseExpression(e=0){let t=this.consume();if(t.getType()==="EOF")return new ht;const r=this.prefixParselets.get(t.getType());if(!r)throw new Error(`Cannot parse ${t.getType()} expression "${t.getType()}"`);let n=r.parse(this,t);return this.parseInfixExpression(n,e)}parseInfixExpression(e,t=0){let r;for(;this.getPrecedence()>t;){r=this.consume();let n=r.getType();n!=="EQUALS"||this.match("EQUALS")||(n="ASSIGN");const s=this.infixParselets.get(n);if(!s)throw new Error(`Unknown infix parselet: "${n}"`);e=s.parse(this,e,r)}return e}getPrecedence(){var t;const e=this.infixParselets.get(this.lookAhead(0).getType());return(t=e==null?void 0:e.precedence)!=null?t:0}consume(e){const t=this.lookAhead(0);if(e&&t.getType()!==e)throw new Error(`Expected token "${e}" and found "${t.getType()}"`);return this.readTokens.shift(),t}match(e,t=!0){return this.lookAhead(0).getType()===e&&(t&&this.consume(),!0)}lookAhead(e){for(;e>=this.readTokens.length;)this.readTokens.push(this.tokenIterator.next());return this.readTokens[e]}registerInfix(e,t){this.infixParselets.set(e,t)}registerPrefix(e,t){this.prefixParselets.set(e,t)}getInfix(e){return this.infixParselets.get(e)}getPrefix(e){return this.prefixParselets.get(e)}}{constructor(e){super(e),this.registerPrefix("NAME",new Ua),this.registerPrefix("STRING",new qa),this.registerPrefix("NUMBER",new Ha),this.registerPrefix("TRUE",new xn(q.PREFIX)),this.registerPrefix("FALSE",new xn(q.PREFIX)),this.registerPrefix("RETURN",new Wa),this.registerPrefix("CONTINUE",new Ya),this.registerPrefix("BREAK",new Za),this.registerPrefix("LOOP",new Xa),this.registerPrefix("FOR_EACH",new Qa),this.registerInfix("QUESTION",new ao(q.CONDITIONAL)),this.registerPrefix("LEFT_PARENT",new za),this.registerInfix("LEFT_PARENT",new Ja(q.FUNCTION)),this.registerInfix("ARRAY_LEFT",new Va(q.ARRAY_ACCESS)),this.registerPrefix("CURLY_LEFT",new Ka(q.SCOPE)),this.registerInfix("SEMICOLON",new Ga(q.STATEMENT)),this.registerPrefix("MINUS",new En(q.PREFIX)),this.registerPrefix("BANG",new En(q.PREFIX)),this.registerInfix("PLUS",new At(q.SUM)),this.registerInfix("MINUS",new At(q.SUM)),this.registerInfix("ASTERISK",new At(q.PRODUCT)),this.registerInfix("SLASH",new At(q.PRODUCT)),this.registerInfix("EQUALS",new eo(q.EQUALS_COMPARE)),this.registerInfix("BANG",new to(q.EQUALS_COMPARE)),this.registerInfix("GREATER",new so(q.COMPARE)),this.registerInfix("SMALLER",new no(q.COMPARE)),this.registerInfix("AND",new ro(q.AND)),this.registerInfix("OR",new io(q.OR)),this.registerInfix("ASSIGN",new At(q.ASSIGNMENT))}}class oo{constructor(e=0){this.precedence=e}parse(e,t){if(e.consume("LEFT_PARENT"),e.match("RIGHT_PARENT"))throw new Error("function() called without arguments");let r,n,s=[];do{const u=e.parseExpression();if(u instanceof Vt)n?s.push(u.eval()):n=u.eval();else{if(!(u instanceof ge||u instanceof Te))throw new Error(`Unexpected expresion: found "${u.constructor.name}"`);r=u}}while(e.match("COMMA"));if(e.consume("RIGHT_PARENT"),!n)throw new Error(`Missing function() name (argument 1); found "${n}"`);if(!r)throw new Error(`Missing function() body (argument ${s.length+2})`);if(e.lookAhead(0).getType()!=="SEMICOLON")throw new Error("Missing semicolon after function expression");return new lo(e.functions,n,s,r)}}class lo extends Q{constructor(e,t,r,n){super(),this.functionBody=n,this.type="CustomFunctionExpression",e.set(t.toLowerCase(),[r,n instanceof Te?n.allExpressions[0].toString():n.toString()])}get allExpressions(){return[this.functionBody]}setExpressionAt(e,t){this.functionBody=t}get isReturn(){return!1}isStatic(){return!0}eval(){return 0}}class Wr{constructor(e={},t={}){this.config=t,this.expressionCache={},this.totalCacheEntries=0,t.useOptimizer===void 0&&(this.config.useOptimizer=!0),t.useCache===void 0&&(this.config.useCache=!0),t.earlyReturnsSkipParsing===void 0&&(this.config.earlyReturnsSkipParsing=!0),t.earlyReturnsSkipTokenization===void 0&&(this.config.earlyReturnsSkipTokenization=!0),t.convertUndefined===void 0&&(this.config.convertUndefined=!1),this.parser=new _n({...this.config,tokenizer:void 0}),this.updateExecutionEnv(e,t.assumeFlatEnvironment)}updateConfig(e){(e=Object.assign(this.config,e)).tokenizer&&this.parser.setTokenizer(e.tokenizer),this.parser.updateConfig({...this.config,tokenizer:void 0}),this.executionEnvironment.updateConfig(e)}updateExecutionEnv(e,t=!1){this.executionEnvironment=new jr(e,{useRadians:this.config.useRadians,convertUndefined:this.config.convertUndefined,isFlat:t,variableHandler:this.config.variableHandler}),this.parser.setExecutionEnvironment(this.executionEnvironment)}clearCache(){this.expressionCache={},this.totalCacheEntries=0}execute(e){this.parser.setExecutionEnvironment(this.executionEnvironment);const t=this.parse(e).eval();return t===void 0?0:typeof t=="boolean"?Number(t):t}executeAndCatch(e){try{return this.execute(e)}catch{return 0}}parse(e){var r,n,s;if((r=this.config.useCache)==null||r){const u=this.expressionCache[e];if(u)return u}this.parser.init(e);let t=this.parser.parseExpression();return((n=this.config.useOptimizer)!=null?n:1)&&t.isStatic()&&(t=new Ye(t.eval())),((s=this.config.useCache)==null||s)&&(this.totalCacheEntries>(this.config.maxCacheSize||256)&&this.clearCache(),this.expressionCache[e]=t,this.totalCacheEntries++),t}resolveStatic(e){return e=(e=e.walk(t=>{if(!(t instanceof Vt))return t.isStatic()?new Ye(t.eval()):void 0})).walk(t=>{if(t instanceof ie)switch(t.operator){case"+":case"-":{const r=t.allExpressions.find(n=>n.isStatic()&&n.eval()===0);if(r)return t.allExpressions.find(n=>n!==r);break}case"*":if(t.allExpressions.find(r=>r.isStatic()&&r.eval()===0))return new Ye(0);case"*":case"/":{const r=t.allExpressions.find(n=>n.isStatic()&&n.eval()===1);if(r)return t.allExpressions.find(n=>n!==r);break}}})}getParser(){return this.parser}}class co extends _n{constructor(e){super(e),this.functions=new Map,this.classes=new Map,this.registerPrefix("FUNCTION",new oo)}reset(){this.functions.clear()}}class ho{constructor(e){this.parser=new co({useCache:!1,useOptimizer:!0,useAgressiveStaticOptimizer:!0,keepGroups:!0,earlyReturnsSkipParsing:!1,earlyReturnsSkipTokenization:!1}),this.parser.setExecutionEnvironment(new jr(this.parser,e)),this.parser.setTokenizer(new dn(new Set(["function"])))}get functions(){return this.parser.functions}parse(e){return this.parser.init(e.replace(/\"/g,"'")),this.parser.parseExpression()}transform(e){const t=new Wr({},{useCache:!1,keepGroups:!0,useOptimizer:!0,useAgressiveStaticOptimizer:!0,earlyReturnsSkipParsing:!0,earlyReturnsSkipTokenization:!1});let r=0,n=t.parse(e),s=!1;n instanceof ge&&(s=!0);let u=!1;n=n.walk(o=>{var C;if(o.type!=="FunctionExpression")return;const l=o.name.name.replace(/(f|function)\./g,""),h=o.args;let[c,f]=(C=this.functions.get(l))!=null?C:[];if(!f||!c)return;f=f.replace(/(a|arg)\.(\w+)/g,(d,p,w)=>{var F,A;return((A=(F=h[c.indexOf(w)])==null?void 0:F.toString())!=null?A:"0").replace(/(t|temp)\./,"outer_temp.")});let g=function(d){if(d instanceof Qe)return new Te(d.allExpressions[0],"()");if(!(d instanceof ge)||d.allExpressions.length>1)return d;const p=d.allExpressions[0];return p instanceof Qe?new Te(p.allExpressions[0],"()"):d}(t.parse(f));if(g instanceof ge){const d=g.allExpressions.some(w=>w instanceof Qe),p=d||g.some(w=>w instanceof Qe);g=t.parse(`({${f}}+${p?d?"t.return_value":"(t.return_value??0)":"0"})`),u=!0}const v=new Map;return g=g.walk(d=>{if(d instanceof vt){let p=d.toString().split(".");const w=p.shift(),[F,...A]=p,b=A.length>0?"."+A.join("."):"";if(w==="t"||w==="temp"){let x=v.get(F);x||(x="t.__scvar"+r++,v.set(F,x)),d.setName(`${x}${b}`)}else w==="outer_temp"&&d.setName(`t.${F}${b}`)}else{if(d instanceof Qe){const p=new vt(t.getParser().executionEnv,"t.return_value"),w=d.allExpressions[0];return new ie(p,w,"=",()=>{p.setPointer(w.eval())})}if(d instanceof ge){const p=[];for(let w=0;w<d.allExpressions.length;w++){const F=d.allExpressions[w];if(F instanceof zr&&F.hasReturn){fo(F,d.allExpressions.slice(w+1)),p.push(F);break}if(F.isReturn){p.push(F);break}p.push(F)}return new ge(p)}}}),g});const a=t.parse(n.toString());return t.resolveStatic(a),!s&&u?`return ${a.toString()};`:a.toString()}reset(){this.functions.clear()}}function fo(i,e){if(i.isReturn)return;const t=i.allExpressions[2].isReturn?1:2,r=i.allExpressions[t];r instanceof ht||(r instanceof Te&&r.allExpressions[0]instanceof ge?e.unshift(...r.allExpressions):e.unshift(r)),e.length>0&&i.setExpressionAt(t,new Te(new ge(e),"{}"))}var Sn=Object.freeze({__proto__:null,ArrayAccessExpression:wn,BooleanExpression:bn,BreakExpression:Fn,ContinueExpression:vn,ForEachExpression:An,FunctionExpression:yn,GenericOperatorExpression:ie,GroupExpression:Te,LoopExpression:Cn,NameExpression:vt,NumberExpression:Ur,PostfixExpression:class extends Q{constructor(i,e){super(),this.expression=i,this.tokenType=e,this.type="PostfixExpression"}get allExpressions(){return[this.expression]}setExpressionAt(i,e){this.expression=e}isStatic(){return this.expression.isStatic()}eval(){this.tokenType}},PrefixExpression:mn,ReturnExpression:Qe,StatementExpression:ge,StaticExpression:Ye,StringExpression:Vt,TernaryExpression:zr,VoidExpression:ht});let U,kn=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});kn.decode();let Kt=null;function Xt(){return(Kt===null||Kt.buffer!==U.memory.buffer)&&(Kt=new Uint8Array(U.memory.buffer)),Kt}function Qt(i,e){return kn.decode(Xt().subarray(i,i+e))}const $e=new Array(32).fill(void 0);$e.push(void 0,null,!0,!1);let Ft=$e.length;function He(i){Ft===$e.length&&$e.push($e.length+1);const e=Ft;return Ft=$e[e],$e[e]=i,e}function bt(i){return $e[i]}let Ze=0,Yt=new TextEncoder("utf-8");const po=typeof Yt.encodeInto=="function"?function(i,e){return Yt.encodeInto(i,e)}:function(i,e){const t=Yt.encode(i);return e.set(t),{read:i.length,written:t.length}};function xt(i,e,t){if(t===void 0){const a=Yt.encode(i),o=e(a.length);return Xt().subarray(o,o+a.length).set(a),Ze=a.length,o}let r=i.length,n=e(r);const s=Xt();let u=0;for(;u<r;u++){const a=i.charCodeAt(u);if(a>127)break;s[n+u]=a}if(u!==r){u!==0&&(i=i.slice(u)),n=t(n,r,r=u+i.length*3);const a=Xt().subarray(n+u,n+r);u+=po(i,a).written}return Ze=u,n}let Zt=null;function fe(){return(Zt===null||Zt.buffer!==U.memory.buffer)&&(Zt=new Int32Array(U.memory.buffer)),Zt}function go(i){i<36||($e[i]=Ft,Ft=i)}function et(i){const e=bt(i);return go(i),e}function Do(i,e){try{const a=U.__wbindgen_add_to_stack_pointer(-16);var t=xt(i,U.__wbindgen_malloc,U.__wbindgen_realloc),r=Ze;U.minifySync(a,t,r,He(e));var n=fe()[a/4+0],s=fe()[a/4+1],u=fe()[a/4+2];if(u)throw et(s);return et(n)}finally{U.__wbindgen_add_to_stack_pointer(16)}}function mo(i,e){try{const a=U.__wbindgen_add_to_stack_pointer(-16);var t=xt(i,U.__wbindgen_malloc,U.__wbindgen_realloc),r=Ze;U.parseSync(a,t,r,He(e));var n=fe()[a/4+0],s=fe()[a/4+1],u=fe()[a/4+2];if(u)throw et(s);return et(n)}finally{U.__wbindgen_add_to_stack_pointer(16)}}function Bn(i,e,t){try{const o=U.__wbindgen_add_to_stack_pointer(-16);var r=xt(i,U.__wbindgen_malloc,U.__wbindgen_realloc),n=Ze;U.transformSync(o,r,n,He(e),He(t));var s=fe()[o/4+0],u=fe()[o/4+1],a=fe()[o/4+2];if(a)throw et(u);return et(s)}finally{U.__wbindgen_add_to_stack_pointer(16)}}async function Eo(i,e){if(typeof Response=="function"&&i instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(i,e)}catch(r){if(i.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await i.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(i,e);return t instanceof WebAssembly.Instance?{instance:t,module:i}:t}}async function Rn(i){typeof i>"u"&&(i=new URL("/assets/wasm-web_bg.533586ee.wasm",self.location));const e={};e.wbg={},e.wbg.__wbindgen_json_parse=function(n,s){var u=JSON.parse(Qt(n,s));return He(u)},e.wbg.__wbindgen_json_serialize=function(n,s){const u=bt(s);var a=JSON.stringify(u===void 0?null:u),o=xt(a,U.__wbindgen_malloc,U.__wbindgen_realloc),l=Ze;fe()[n/4+1]=l,fe()[n/4+0]=o},e.wbg.__wbindgen_object_drop_ref=function(n){et(n)},e.wbg.__wbindgen_string_new=function(n,s){var u=Qt(n,s);return He(u)},e.wbg.__wbg_new0_57a6a2c2aaed3fc5=function(){var n=new Date;return He(n)},e.wbg.__wbg_getTime_f8ce0ff902444efb=function(n){var s=bt(n).getTime();return s},e.wbg.__wbg_getTimezoneOffset_41211a984662508b=function(n){var s=bt(n).getTimezoneOffset();return s},e.wbg.__wbg_new_693216e109162396=function(){var n=new Error;return He(n)},e.wbg.__wbg_stack_0ddaca5d1abfb52f=function(n,s){var u=bt(s).stack,a=xt(u,U.__wbindgen_malloc,U.__wbindgen_realloc),o=Ze;fe()[n/4+1]=o,fe()[n/4+0]=a},e.wbg.__wbg_error_09919627ac0992f5=function(n,s){try{console.error(Qt(n,s))}finally{U.__wbindgen_free(n,s)}},e.wbg.__wbindgen_throw=function(n,s){throw new Error(Qt(n,s))},(typeof i=="string"||typeof Request=="function"&&i instanceof Request||typeof URL=="function"&&i instanceof URL)&&(i=fetch(i));const{instance:t,module:r}=await Eo(await i,e);return U=t.exports,Rn.__wbindgen_wasm_module=r,U}var yo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function wo(i){for(var e=0,t=0,r=0,n=0,s="",u=0;u<i.length;u++){var a=i[u];if(u>0&&(s+=";"),a.length!==0){for(var o=0,l=[],h=0,c=a;h<c.length;h++){var f=c[h],g=_t(f[0]-o);o=f[0],f.length>1&&(g+=_t(f[1]-e)+_t(f[2]-t)+_t(f[3]-r),e=f[1],t=f[2],r=f[3]),f.length===5&&(g+=_t(f[4]-n),n=f[4]),l.push(g)}s+=l.join(",")}}return s}function _t(i){var e="";i=i<0?-i<<1|1:i<<1;do{var t=i&31;i>>>=5,i>0&&(t|=32),e+=yo[t]}while(i>0);return e}class er{constructor(e){this.bits=e instanceof er?e.bits.slice():[]}add(e){this.bits[e>>5]|=1<<(e&31)}has(e){return!!(this.bits[e>>5]&1<<(e&31))}}class St{constructor(e,t,r){this.start=e,this.end=t,this.original=r,this.intro="",this.outro="",this.content=r,this.storeName=!1,this.edited=!1,Object.defineProperties(this,{previous:{writable:!0,value:null},next:{writable:!0,value:null}})}appendLeft(e){this.outro+=e}appendRight(e){this.intro=this.intro+e}clone(){const e=new St(this.start,this.end,this.original);return e.intro=this.intro,e.outro=this.outro,e.content=this.content,e.storeName=this.storeName,e.edited=this.edited,e}contains(e){return this.start<e&&e<this.end}eachNext(e){let t=this;for(;t;)e(t),t=t.next}eachPrevious(e){let t=this;for(;t;)e(t),t=t.previous}edit(e,t,r){return this.content=e,r||(this.intro="",this.outro=""),this.storeName=t,this.edited=!0,this}prependLeft(e){this.outro=e+this.outro}prependRight(e){this.intro=e+this.intro}split(e){const t=e-this.start,r=this.original.slice(0,t),n=this.original.slice(t);this.original=r;const s=new St(e,this.end,n);return s.outro=this.outro,this.outro="",this.end=e,this.edited?(s.edit("",!1),this.content=""):this.content=r,s.next=this.next,s.next&&(s.next.previous=s),s.previous=this,this.next=s,s}toString(){return this.intro+this.content+this.outro}trimEnd(e){if(this.outro=this.outro.replace(e,""),this.outro.length)return!0;const t=this.content.replace(e,"");if(t.length)return t!==this.content&&this.split(this.start+t.length).edit("",void 0,!0),!0;if(this.edit("",void 0,!0),this.intro=this.intro.replace(e,""),this.intro.length)return!0}trimStart(e){if(this.intro=this.intro.replace(e,""),this.intro.length)return!0;const t=this.content.replace(e,"");if(t.length)return t!==this.content&&(this.split(this.end-t.length),this.edit("",void 0,!0)),!0;if(this.edit("",void 0,!0),this.outro=this.outro.replace(e,""),this.outro.length)return!0}}let Gr=()=>{throw new Error("Unsupported environment: `window.btoa` or `Buffer` should be supported.")};typeof window<"u"&&typeof window.btoa=="function"?Gr=i=>window.btoa(unescape(encodeURIComponent(i))):typeof Buffer=="function"&&(Gr=i=>Buffer.from(i,"utf-8").toString("base64"));class Co{constructor(e){this.version=3,this.file=e.file,this.sources=e.sources,this.sourcesContent=e.sourcesContent,this.names=e.names,this.mappings=wo(e.mappings)}toString(){return JSON.stringify(this)}toUrl(){return"data:application/json;charset=utf-8;base64,"+Gr(this.toString())}}function Ao(i){const e=i.split(`
`),t=e.filter(s=>/^\t+/.test(s)),r=e.filter(s=>/^ {2,}/.test(s));if(t.length===0&&r.length===0)return null;if(t.length>=r.length)return"	";const n=r.reduce((s,u)=>{const a=/^ +/.exec(u)[0].length;return Math.min(a,s)},1/0);return new Array(n+1).join(" ")}function vo(i,e){const t=i.split(/[/\\]/),r=e.split(/[/\\]/);for(t.pop();t[0]===r[0];)t.shift(),r.shift();if(t.length){let n=t.length;for(;n--;)t[n]=".."}return t.concat(r).join("/")}const Fo=Object.prototype.toString;function bo(i){return Fo.call(i)==="[object Object]"}function Tn(i){const e=i.split(`
`),t=[];for(let r=0,n=0;r<e.length;r++)t.push(n),n+=e[r].length+1;return function(n){let s=0,u=t.length;for(;s<u;){const l=s+u>>1;n<t[l]?u=l:s=l+1}const a=s-1,o=n-t[a];return{line:a,column:o}}}class xo{constructor(e){this.hires=e,this.generatedCodeLine=0,this.generatedCodeColumn=0,this.raw=[],this.rawSegments=this.raw[this.generatedCodeLine]=[],this.pending=null}addEdit(e,t,r,n){if(t.length){const s=[this.generatedCodeColumn,e,r.line,r.column];n>=0&&s.push(n),this.rawSegments.push(s)}else this.pending&&this.rawSegments.push(this.pending);this.advance(t),this.pending=null}addUneditedChunk(e,t,r,n,s){let u=t.start,a=!0;for(;u<t.end;)(this.hires||a||s.has(u))&&this.rawSegments.push([this.generatedCodeColumn,e,n.line,n.column]),r[u]===`
`?(n.line+=1,n.column=0,this.generatedCodeLine+=1,this.raw[this.generatedCodeLine]=this.rawSegments=[],this.generatedCodeColumn=0,a=!0):(n.column+=1,this.generatedCodeColumn+=1,a=!1),u+=1;this.pending=null}advance(e){if(!e)return;const t=e.split(`
`);if(t.length>1){for(let r=0;r<t.length-1;r++)this.generatedCodeLine++,this.raw[this.generatedCodeLine]=this.rawSegments=[];this.generatedCodeColumn=0}this.generatedCodeColumn+=t[t.length-1].length}}const kt=`
`,ft={insertLeft:!1,insertRight:!1,storeName:!1};class qr{constructor(e,t={}){const r=new St(0,e.length,e);Object.defineProperties(this,{original:{writable:!0,value:e},outro:{writable:!0,value:""},intro:{writable:!0,value:""},firstChunk:{writable:!0,value:r},lastChunk:{writable:!0,value:r},lastSearchedChunk:{writable:!0,value:r},byStart:{writable:!0,value:{}},byEnd:{writable:!0,value:{}},filename:{writable:!0,value:t.filename},indentExclusionRanges:{writable:!0,value:t.indentExclusionRanges},sourcemapLocations:{writable:!0,value:new er},storedNames:{writable:!0,value:{}},indentStr:{writable:!0,value:Ao(e)}}),this.byStart[0]=r,this.byEnd[e.length]=r}addSourcemapLocation(e){this.sourcemapLocations.add(e)}append(e){if(typeof e!="string")throw new TypeError("outro content must be a string");return this.outro+=e,this}appendLeft(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const r=this.byEnd[e];return r?r.appendLeft(t):this.intro+=t,this}appendRight(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const r=this.byStart[e];return r?r.appendRight(t):this.outro+=t,this}clone(){const e=new qr(this.original,{filename:this.filename});let t=this.firstChunk,r=e.firstChunk=e.lastSearchedChunk=t.clone();for(;t;){e.byStart[r.start]=r,e.byEnd[r.end]=r;const n=t.next,s=n&&n.clone();s&&(r.next=s,s.previous=r,r=s),t=n}return e.lastChunk=r,this.indentExclusionRanges&&(e.indentExclusionRanges=this.indentExclusionRanges.slice()),e.sourcemapLocations=new er(this.sourcemapLocations),e.intro=this.intro,e.outro=this.outro,e}generateDecodedMap(e){e=e||{};const t=0,r=Object.keys(this.storedNames),n=new xo(e.hires),s=Tn(this.original);return this.intro&&n.advance(this.intro),this.firstChunk.eachNext(u=>{const a=s(u.start);u.intro.length&&n.advance(u.intro),u.edited?n.addEdit(t,u.content,a,u.storeName?r.indexOf(u.original):-1):n.addUneditedChunk(t,u,this.original,a,this.sourcemapLocations),u.outro.length&&n.advance(u.outro)}),{file:e.file?e.file.split(/[/\\]/).pop():null,sources:[e.source?vo(e.file||"",e.source):null],sourcesContent:e.includeContent?[this.original]:[null],names:r,mappings:n.raw}}generateMap(e){return new Co(this.generateDecodedMap(e))}getIndentString(){return this.indentStr===null?"	":this.indentStr}indent(e,t){const r=/^[^\r\n]/gm;if(bo(e)&&(t=e,e=void 0),e=e!==void 0?e:this.indentStr||"	",e==="")return this;t=t||{};const n={};t.exclude&&(typeof t.exclude[0]=="number"?[t.exclude]:t.exclude).forEach(h=>{for(let c=h[0];c<h[1];c+=1)n[c]=!0});let s=t.indentStart!==!1;const u=l=>s?`${e}${l}`:(s=!0,l);this.intro=this.intro.replace(r,u);let a=0,o=this.firstChunk;for(;o;){const l=o.end;if(o.edited)n[a]||(o.content=o.content.replace(r,u),o.content.length&&(s=o.content[o.content.length-1]===`
`));else for(a=o.start;a<l;){if(!n[a]){const h=this.original[a];h===`
`?s=!0:h!=="\r"&&s&&(s=!1,a===o.start||(this._splitChunk(o,a),o=o.next),o.prependRight(e))}a+=1}a=o.end,o=o.next}return this.outro=this.outro.replace(r,u),this}insert(){throw new Error("magicString.insert(...) is deprecated. Use prependRight(...) or appendLeft(...)")}insertLeft(e,t){return ft.insertLeft||(console.warn("magicString.insertLeft(...) is deprecated. Use magicString.appendLeft(...) instead"),ft.insertLeft=!0),this.appendLeft(e,t)}insertRight(e,t){return ft.insertRight||(console.warn("magicString.insertRight(...) is deprecated. Use magicString.prependRight(...) instead"),ft.insertRight=!0),this.prependRight(e,t)}move(e,t,r){if(r>=e&&r<=t)throw new Error("Cannot move a selection inside itself");this._split(e),this._split(t),this._split(r);const n=this.byStart[e],s=this.byEnd[t],u=n.previous,a=s.next,o=this.byStart[r];if(!o&&s===this.lastChunk)return this;const l=o?o.previous:this.lastChunk;return u&&(u.next=a),a&&(a.previous=u),l&&(l.next=n),o&&(o.previous=s),n.previous||(this.firstChunk=s.next),s.next||(this.lastChunk=n.previous,this.lastChunk.next=null),n.previous=l,s.next=o||null,l||(this.firstChunk=n),o||(this.lastChunk=s),this}overwrite(e,t,r,n){if(typeof r!="string")throw new TypeError("replacement content must be a string");for(;e<0;)e+=this.original.length;for(;t<0;)t+=this.original.length;if(t>this.original.length)throw new Error("end is out of bounds");if(e===t)throw new Error("Cannot overwrite a zero-length range \u2013 use appendLeft or prependRight instead");this._split(e),this._split(t),n===!0&&(ft.storeName||(console.warn("The final argument to magicString.overwrite(...) should be an options object. See https://github.com/rich-harris/magic-string"),ft.storeName=!0),n={storeName:!0});const s=n!==void 0?n.storeName:!1,u=n!==void 0?n.contentOnly:!1;if(s){const l=this.original.slice(e,t);Object.defineProperty(this.storedNames,l,{writable:!0,value:!0,enumerable:!0})}const a=this.byStart[e],o=this.byEnd[t];if(a){let l=a;for(;l!==o;){if(l.next!==this.byStart[l.end])throw new Error("Cannot overwrite across a split point");l=l.next,l.edit("",!1)}a.edit(r,s,u)}else{const l=new St(e,t,"").edit(r,s);o.next=l,l.previous=o}return this}prepend(e){if(typeof e!="string")throw new TypeError("outro content must be a string");return this.intro=e+this.intro,this}prependLeft(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const r=this.byEnd[e];return r?r.prependLeft(t):this.intro=t+this.intro,this}prependRight(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const r=this.byStart[e];return r?r.prependRight(t):this.outro=t+this.outro,this}remove(e,t){for(;e<0;)e+=this.original.length;for(;t<0;)t+=this.original.length;if(e===t)return this;if(e<0||t>this.original.length)throw new Error("Character is out of bounds");if(e>t)throw new Error("end must be greater than start");this._split(e),this._split(t);let r=this.byStart[e];for(;r;)r.intro="",r.outro="",r.edit(""),r=t>r.end?this.byStart[r.end]:null;return this}lastChar(){if(this.outro.length)return this.outro[this.outro.length-1];let e=this.lastChunk;do{if(e.outro.length)return e.outro[e.outro.length-1];if(e.content.length)return e.content[e.content.length-1];if(e.intro.length)return e.intro[e.intro.length-1]}while(e=e.previous);return this.intro.length?this.intro[this.intro.length-1]:""}lastLine(){let e=this.outro.lastIndexOf(kt);if(e!==-1)return this.outro.substr(e+1);let t=this.outro,r=this.lastChunk;do{if(r.outro.length>0){if(e=r.outro.lastIndexOf(kt),e!==-1)return r.outro.substr(e+1)+t;t=r.outro+t}if(r.content.length>0){if(e=r.content.lastIndexOf(kt),e!==-1)return r.content.substr(e+1)+t;t=r.content+t}if(r.intro.length>0){if(e=r.intro.lastIndexOf(kt),e!==-1)return r.intro.substr(e+1)+t;t=r.intro+t}}while(r=r.previous);return e=this.intro.lastIndexOf(kt),e!==-1?this.intro.substr(e+1)+t:this.intro+t}slice(e=0,t=this.original.length){for(;e<0;)e+=this.original.length;for(;t<0;)t+=this.original.length;let r="",n=this.firstChunk;for(;n&&(n.start>e||n.end<=e);){if(n.start<t&&n.end>=t)return r;n=n.next}if(n&&n.edited&&n.start!==e)throw new Error(`Cannot use replaced character ${e} as slice start anchor.`);const s=n;for(;n;){n.intro&&(s!==n||n.start===e)&&(r+=n.intro);const u=n.start<t&&n.end>=t;if(u&&n.edited&&n.end!==t)throw new Error(`Cannot use replaced character ${t} as slice end anchor.`);const a=s===n?e-n.start:0,o=u?n.content.length+t-n.end:n.content.length;if(r+=n.content.slice(a,o),n.outro&&(!u||n.end===t)&&(r+=n.outro),u)break;n=n.next}return r}snip(e,t){const r=this.clone();return r.remove(0,e),r.remove(t,r.original.length),r}_split(e){if(this.byStart[e]||this.byEnd[e])return;let t=this.lastSearchedChunk;const r=e>t.end;for(;t;){if(t.contains(e))return this._splitChunk(t,e);t=r?this.byStart[t.end]:this.byEnd[t.start]}}_splitChunk(e,t){if(e.edited&&e.content.length){const n=Tn(this.original)(t);throw new Error(`Cannot split a chunk that has already been edited (${n.line}:${n.column} \u2013 "${e.original}")`)}const r=e.split(t);return this.byEnd[t]=e,this.byStart[t]=r,this.byEnd[r.end]=r,e===this.lastChunk&&(this.lastChunk=r),this.lastSearchedChunk=e,!0}toString(){let e=this.intro,t=this.firstChunk;for(;t;)e+=t.toString(),t=t.next;return e+this.outro}isEmpty(){let e=this.firstChunk;do if(e.intro.length&&e.intro.trim()||e.content.length&&e.content.trim()||e.outro.length&&e.outro.trim())return!1;while(e=e.next);return!0}length(){let e=this.firstChunk,t=0;do t+=e.intro.length+e.content.length+e.outro.length;while(e=e.next);return t}trimLines(){return this.trim("[\\r\\n]")}trim(e){return this.trimStart(e).trimEnd(e)}trimEndAborted(e){const t=new RegExp((e||"\\s")+"+$");if(this.outro=this.outro.replace(t,""),this.outro.length)return!0;let r=this.lastChunk;do{const n=r.end,s=r.trimEnd(t);if(r.end!==n&&(this.lastChunk===r&&(this.lastChunk=r.next),this.byEnd[r.end]=r,this.byStart[r.next.start]=r.next,this.byEnd[r.next.end]=r.next),s)return!0;r=r.previous}while(r);return!1}trimEnd(e){return this.trimEndAborted(e),this}trimStartAborted(e){const t=new RegExp("^"+(e||"\\s")+"+");if(this.intro=this.intro.replace(t,""),this.intro.length)return!0;let r=this.firstChunk;do{const n=r.end,s=r.trimStart(t);if(r.end!==n&&(r===this.lastChunk&&(this.lastChunk=r.next),this.byEnd[r.end]=r,this.byStart[r.next.start]=r.next,this.byEnd[r.next.end]=r.next),s)return!0;r=r.next}while(r);return!1}trimStart(e){return this.trimStartAborted(e),this}hasChanged(){return this.original!==this.toString()}replace(e,t){function r(s,u){return typeof t=="string"?t.replace(/\$(\$|&|\d+)/g,(a,o)=>o==="$"?"$":o==="&"?s[0]:+o<s.length?s[+o]:`$${o}`):t(...s,s.index,u,s.groups)}function n(s,u){let a;const o=[];for(;a=s.exec(u);)o.push(a);return o}if(typeof e!="string"&&e.global)n(e,this.original).forEach(u=>{u.index!=null&&this.overwrite(u.index,u.index+u[0].length,r(u,this.original))});else{const s=this.original.match(e);s&&s.index!=null&&this.overwrite(s.index,s.index+s[0].length,r(s,this.original))}return this}}function _o(i,e,t=0){const r=new qr(i),n=(a,o,l)=>r.overwrite(a-t,o-t,l),s=(a,o)=>r.slice(a-t,o-t);let u="";return e.forEach(a=>{if(a.type==="ExportDefaultDeclaration")n(a.span.start,a.span.end,`
___module.__default__ = ${s(a.decl.span.start,a.decl.span.end)};`);else if(a.type==="ExportDefaultExpression")n(a.span.start,a.span.end,`
___module.__default__ = ${s(a.expression.span.start,a.expression.span.end)};`);else if(a.type==="ExportDeclaration")n(a.span.start,a.span.end,s(a.declaration.span.start,a.declaration.span.end)),a.declaration.type==="ClassDeclaration"||a.declaration.type==="FunctionDeclaration"?u+=`
___module.${a.declaration.identifier.value} = ${a.declaration.identifier.value};`:a.declaration.type==="VariableDeclaration"&&a.declaration.declarations.forEach(o=>{u+=`
___module.${o.id.value} = ${o.id.value};`});else if(a.type==="ExportNamedDeclaration"){let o="";for(const{orig:l,exported:h}of a.specifiers)h.value==="default"?o+=`
___module.__default__ = ${l.value};`:o+=`
___module.${h.value} = ${l.value};`;n(a.span.start,a.span.end,o)}else if(a.type==="ImportDeclaration")if(a.specifiers.length===1&&a.specifiers[0].type==="ImportNamespaceSpecifier")n(a.span.start,a.span.end,`
const ${a.specifiers[0].local.value} = await ___require(${a.source.raw});`);else{const o=[];a.specifiers.forEach(h=>{h.type==="ImportDefaultSpecifier"?o.push(`__default__: ${h.local.value}`):h.type==="ImportSpecifier"&&(h.imported||(h.imported=h.local),o.push(`${h.imported.value}: ${h.local.value}`))});const l=o.length===0?`
await ___require(${a.source.raw});`:`
const {${o.join(", ")}} = await ___require(${a.source.raw});`;n(a.span.start,a.span.end,l)}}),r.toString()+u}class So{constructor(e){if(this.evaluatedModules=new Map,this.baseModules=new Map,this.env={},e)for(const[t,r]of e)this.registerModule(t,r)}async run(e,t={},r){return this.env=t,await this.eval(e,r)}clearCache(){this.evaluatedModules.clear()}registerModule(e,t){this.baseModules.set(e,t)}async eval(e,t){const r=this.evaluatedModules.get(e);if(r)return r;const n=$.dirname(e),s=e.endsWith(".js")?"ecmascript":"typescript";if(t||(t=await this.readFile(e).catch(()=>{})),!t)throw new Error(`File "${e}" not found`);if(tr===null)throw new Error("You must call initRuntimes() before using the runtime");await tr;let u=Do(Bn(t,{filename:$.basename(e),jsc:{parser:{syntax:s,preserveAllComments:!1,topLevelAwait:!0},target:"es2020"}}).code,{compress:!1,mangle:!1,format:{beautify:!0}}).code;const{type:a,body:o}=mo(u,{syntax:s,target:"es2022"}),l=o[0].span.start,h=_o(u,o,l),c={};try{await this.runSrc(h,Object.assign({},this.env,{___module:c,___require:f=>this.require(f,n)}))}catch(f){throw new Error(`Error in ${e}: ${f}`)}return this.evaluatedModules.set(e,c),c}async require(e,t){const r=this.baseModules.get(e);if(r)return typeof r=="function"?await r():r;if(e.startsWith("https://")){const u=await(await fetch(e)).text();return await this.eval(e,u)}if(e.startsWith(".")&&(e=$.join(t,e)),e.endsWith(".json")){const s=await this.readFile(e).catch(()=>{});if(s){let u={};try{u=Ce.parse(s)}catch{throw new Error(`File "${e}" contains invalid JSON`)}return{__default__:u,...u}}}const n=[".ts",".js"];for(const s of n){const u=`${e}${s}`;let a=await this.readFile(u).catch(()=>{});if(!!a)return await this.eval(u,a)}throw new Error(`Module "${e}" not found`)}async runSrc(e,t){return new Function(...Object.keys(t),`return (async () => {
${e}
})()`)(...Object.values(t))}}let tr=null;function ko(i){tr=Rn(i).then(()=>null)}/*!
 * is-extglob <https://github.com/jonschlinkert/is-extglob>
 *
 * Copyright (c) 2014-2016, Jon Schlinkert.
 * Licensed under the MIT License.
 */var Bo=function(e){if(typeof e!="string"||e==="")return!1;for(var t;t=/(\\).|([@?!+*]\(.*\))/g.exec(e);){if(t[2])return!0;e=e.slice(t.index+t[0].length)}return!1};/*!
 * is-glob <https://github.com/jonschlinkert/is-glob>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Ro=Bo,$n={"{":"}","(":")","[":"]"},To=function(i){if(i[0]==="!")return!0;for(var e=0,t=-2,r=-2,n=-2,s=-2,u=-2;e<i.length;){if(i[e]==="*"||i[e+1]==="?"&&/[\].+)]/.test(i[e])||r!==-1&&i[e]==="["&&i[e+1]!=="]"&&(r<e&&(r=i.indexOf("]",e)),r>e&&(u===-1||u>r||(u=i.indexOf("\\",e),u===-1||u>r)))||n!==-1&&i[e]==="{"&&i[e+1]!=="}"&&(n=i.indexOf("}",e),n>e&&(u=i.indexOf("\\",e),u===-1||u>n))||s!==-1&&i[e]==="("&&i[e+1]==="?"&&/[:!=]/.test(i[e+2])&&i[e+3]!==")"&&(s=i.indexOf(")",e),s>e&&(u=i.indexOf("\\",e),u===-1||u>s))||t!==-1&&i[e]==="("&&i[e+1]!=="|"&&(t<e&&(t=i.indexOf("|",e)),t!==-1&&i[t+1]!==")"&&(s=i.indexOf(")",t),s>t&&(u=i.indexOf("\\",t),u===-1||u>s))))return!0;if(i[e]==="\\"){var a=i[e+1];e+=2;var o=$n[a];if(o){var l=i.indexOf(o,e);l!==-1&&(e=l+1)}if(i[e]==="!")return!0}else e++}return!1},$o=function(i){if(i[0]==="!")return!0;for(var e=0;e<i.length;){if(/[*?{}()[\]]/.test(i[e]))return!0;if(i[e]==="\\"){var t=i[e+1];e+=2;var r=$n[t];if(r){var n=i.indexOf(r,e);n!==-1&&(e=n+1)}if(i[e]==="!")return!0}else e++}return!1},Oo=function(e,t){if(typeof e!="string"||e==="")return!1;if(Ro(e))return!0;var r=To;return t&&t.strict===!1&&(r=$o),r(e)};class Po extends Qu{constructor(e,t){super($.dirname(t)),this.fileSystem=e,this.configPath=t}readConfig(){return this.fileSystem.readJson(this.configPath)}writeConfig(e){return this.fileSystem.writeJson(this.configPath,e)}}class On{constructor(e,t,r){this.dash=e,this.pluginId=t,this.plugin=r}async runBuildStartHook(){var e,t;try{return await((t=(e=this.plugin).buildStart)==null?void 0:t.call(e))}catch(r){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "buildStart" hook:`,r)}}async runIncludeHook(){var e,t;try{return await((t=(e=this.plugin).include)==null?void 0:t.call(e))}catch(r){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "include" hook:`,r)}}async runTransformPathHook(e){var t,r;try{return await((r=(t=this.plugin).transformPath)==null?void 0:r.call(t,e))}catch(n){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "transformPath" hook for "${e}":`,n)}}async runReadHook(e,t){var r,n;try{return await((n=(r=this.plugin).read)==null?void 0:n.call(r,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "read" hook for "${e}":`,s)}}async runLoadHook(e,t){var r,n;try{return await((n=(r=this.plugin).load)==null?void 0:n.call(r,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "load" hook for "${e}":`,s)}}async runRegisterAliasesHook(e,t){var r,n;try{return await((n=(r=this.plugin).registerAliases)==null?void 0:n.call(r,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "registerAliases" hook for "${e}":`,s)}}async runRequireHook(e,t){var r,n;try{return await((n=(r=this.plugin).require)==null?void 0:n.call(r,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "require" hook for "${e}":`,s)}}async runTransformHook(e,t,r){var n,s;try{return await((s=(n=this.plugin).transform)==null?void 0:s.call(n,e,t,r))}catch(u){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "transform" hook for "${e}":`,u)}}async runFinalizeBuildHook(e,t){var r,n;try{return await((n=(r=this.plugin).finalizeBuild)==null?void 0:n.call(r,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "finalizeBuild" hook for "${e}":`,s)}}async runBuildEndHook(){var e,t;try{return await((t=(e=this.plugin).buildEnd)==null?void 0:t.call(e))}catch(r){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "buildEnd" hook:`,r)}}async runBeforeFileUnlinked(e){var t,r;try{return await((r=(t=this.plugin).beforeFileUnlinked)==null?void 0:r.call(t,e))}catch(n){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "beforeFileUnlinked" hook for "${e}":`,n)}}}const No=({options:i,outputFileSystem:e,hasComMojangDirectory:t,projectConfig:r,projectRoot:n,packType:s})=>{var u;i.buildName||(i.buildName=i.mode==="development"?"dev":"dist"),i.packName||(i.packName="Bridge"),(u=i.rewriteToComMojang)==null||u||(t=!1);const a={behaviorPack:"development_behavior_packs",resourcePack:"development_resource_packs",skinPack:"skin_packs",worldTemplate:"minecraftWorlds"},o=h=>t&&i.mode==="development"?`${a[h]}`:`${n}/builds/${i.buildName}`,l=(h,c)=>`${o(h)}/${i.packName} ${c}`;return{async buildStart(){if(i.mode==="production"||i.buildType==="fullBuild")if(t)for(const h in a){const c=s.getFromId(h);!c||await e.unlink(l(h,c.defaultPackPath)).catch(()=>{})}else await e.unlink(o("BP")).catch(()=>{})},transformPath(h){var c,f;if(!h||h.includes("BP/scripts/gametests/")&&i.mode==="production")return;const g=s==null?void 0:s.get(h);if(!g)return;const v=r.getAbsolutePackRoot(g.id),C=$.relative(v,h);if(["behaviorPack","resourcePack","skinPack","worldTemplate"].includes(g.id))return $.join(l(g.id,(f=(c=i.packNameSuffix)==null?void 0:c[g.id])!=null?f:g.defaultPackPath),C)}}},Pn=({fileType:i,projectConfig:e,requestJsonData:t,options:r,console:n,jsRuntime:s})=>{const u=(f,g)=>e.resolvePackPath(f,g),a=new ho({}),o=f=>f==null?void 0:f.endsWith(".molang"),l=f=>f==null?void 0:f.startsWith(e.resolvePackPath("behaviorPack","scripts/molang/")),h=f=>{var g;return(g=Object.entries(r.include).find(([v])=>(i==null?void 0:i.getId(f))===v))==null?void 0:g[1]};let c=[];return{async buildStart(){r.include=Object.assign(await t("data/packages/minecraftBedrock/location/validMoLang.json"),r.include)},transformPath(f){if(o(f)||l(f))return null},async read(f,g){if((o(f)||l(f))&&g){const v=await g.getFile();return await(v==null?void 0:v.text())}else if(h(f)&&f.endsWith(".json")&&g){const v=await g.getFile();if(!v)return;try{return Ce.parse(await v.text())}catch(C){return r.buildType!=="fileRequest"&&n.error(`Error within file "${f}": ${C}`),{__error__:`Failed to load original file: ${C}`}}}},async load(f,g){if(o(f)&&g)a.parse(g);else if(l(f)){const v=await s.run(f,{console:n},g).catch(C=>(n.error(`Failed to execute Molang AST script "${f}": ${C}`),null));if(!v)return null;typeof v.__default__=="function"&&c.push(v.__default__)}},async require(f){if(h(f))return[u("behaviorPack","scripts/molang/**/*.[jt]s"),u("behaviorPack","molang/**/*.molang"),u("resourcePack","molang/**/*.molang")]},async transform(f,g){const v=h(f);v&&v.length>0&&v.forEach(C=>Oi(C,g,d=>{if(typeof d!="string"||d[0]==="/"||d[0]==="@")return d;if(c.length>0){let p=null;try{p=a.parse(d)}catch(w){r.buildType!=="fileRequest"&&n.error(`Error within file "${f}"; script "${d}": ${w}`)}if(p){for(const w of c)p=p.walk(w);d=p.toString()}}try{return a.transform(d)}catch(p){return r.buildType!=="fileRequest"&&n.error(`Error within file "${f}"; script "${d}": ${p}`),d}}))},finalizeBuild(f,g){if(h(f)&&typeof g!="string")return JSON.stringify(g,null,"	")},buildEnd(){c=[]}}},Io=({fileType:i})=>({registerAliases(e,t){var r,n,s,u;if((i==null?void 0:i.getId(e))==="entity"&&((n=(r=t==null?void 0:t["minecraft:entity"])==null?void 0:r.description)==null?void 0:n.identifier))return[(u=(s=t==null?void 0:t["minecraft:entity"])==null?void 0:s.description)==null?void 0:u.identifier]}});function Lo(i,e){const t=Nn(i),r=Nn(e),n=t.pop(),s=r.pop(),u=Mn(t,r);return u!==0?u:n&&s?Mn(n.split("."),s.split(".")):n||s?n?-1:1:0}const Mo=(i,e,t)=>{zo(t);const r=Lo(i,e);return Hn[t].includes(r)},Ho=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Nn=i=>{if(typeof i!="string")throw new TypeError("Invalid argument expected string");const e=i.match(Ho);if(!e)throw new Error(`Invalid argument not valid semver ('${i}' received)`);return e.shift(),e},In=i=>i==="*"||i==="x"||i==="X",Ln=i=>{const e=parseInt(i,10);return isNaN(e)?i:e},jo=(i,e)=>typeof i!=typeof e?[String(i),String(e)]:[i,e],Uo=(i,e)=>{if(In(i)||In(e))return 0;const[t,r]=jo(Ln(i),Ln(e));return t>r?1:t<r?-1:0},Mn=(i,e)=>{for(let t=0;t<Math.max(i.length,e.length);t++){const r=Uo(i[t]||0,e[t]||0);if(r!==0)return r}return 0},Hn={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]},jn=Object.keys(Hn),zo=i=>{if(typeof i!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof i}`);if(jn.indexOf(i)===-1)throw new Error(`Invalid operator, expected one of ${jn.join("|")}`)},Wo=(i,e)=>({register:t=>{var r;((r=t.type)!=null?r:"entity")===e&&(i.component=({name:n,schema:s,template:u})=>{const a=new t;n(t.component_name),s(Jr(Object.values(a.onPropose())[0])),u((o,{create:l})=>{l(a.onApply(o,"components")[`minecraft:${e}`])})})}});function Jr(i){const e={},t=Object.keys(i);if(t.length===1&&t[0].startsWith("$dynamic.list."))return{type:"array",items:Jr(Object.values(i)[0])};for(const[r,n]of Object.entries(i))r.startsWith("$")||(typeof n=="string"?e[r]=Go(n):Array.isArray(n)?e[r]={enum:n}:n==="object"&&(e[r]=Jr(n)));return{type:"object",properties:e}}function Go(i){switch(i){case"$general.boolean":return{type:"boolean"};case"$general.number":return{type:"integer"};case"$general.decimal":return{type:"number"};default:return{type:["number","integer","string","boolean","object","array"]}}}class qo{constructor(e,t,r,n,s,u){this.console=e,this.fileType=t,this.componentSrc=r,this.mode=n,this.v1Compat=s,this.targetVersion=u,this.animations=[],this.animationControllers=[],this.createOnPlayer=[],this.dialogueScenes={},this.serverFiles=[],this.clientFiles={},this.lifecycleHookCount={activated:0,deactivated:0}}setProjectConfig(e){this.projectConfig=e}get name(){return this._name}async load(e,t,r){let n={component:null};const s=await e.run(t,{defineComponent:l=>l,console:this.console,Bridge:this.v1Compat?Wo(n,this.fileType):void 0}).catch(()=>(this.console.error(`Failed to execute component ${t}`),null));if(!s)return!1;if(typeof s.__default__!="function")if(n.component)s.__default__=n.component;else return this.console.error(`Component ${t} is not a valid component. Expected a function as the default export.`),!1;const u=l=>this._name=l;let a=l=>this.schema=l,o=()=>{};return(!r||r==="server")&&(a=()=>{},o=l=>{this.template=(h,c)=>{try{l(h,c)}catch(f){this.console.log(l.toString()),this.console.error(f)}}}),await s.__default__({name:u,schema:a,template:o}),!0}reset(){this.animations=[],this.animationControllers=[],this.clientFiles={},this.serverFiles=[]}getSchema(){return this.schema}toString(){return this.componentSrc}create(e,t,r=`minecraft:${this.fileType}`,n){var s;const u=r.split("/"),a=u.pop(),o=this.getObjAtLocation(e,[...u]);o[a]=(n?(l,h)=>n(Dt,l,h):Dt)((s=o[a])!=null?s:{},t!=null?t:{})}getObjAtLocation(e,t){let r=e;for(;t.length>0;){const n=t.shift();r[n]===void 0?r[Number(n)]!==void 0?r=r[Number(n)]:(r[n]={},r=r[n]):r=r[n]}return r}async processTemplates(e,t,r){var n,s,u,a,o,l;if(typeof this.template!="function")return;const h=(u=(s=(n=e[`minecraft:${this.fileType}`])==null?void 0:n.description)==null?void 0:s.identifier)!=null?u:"bridge:no_identifier",c=await _r(`${this.name}/${h}`),f=(l=(o=(a=this.projectConfig)==null?void 0:a.get())==null?void 0:o.namespace)!=null?l:"bridge",g=(x,B)=>(this.animations.push([x,B]),this.getShortAnimName("a",c,this.animations.length-1)),v=(x,B)=>(this.animationControllers.push([x,B]),this.getShortAnimName("ac",c,this.animationControllers.length-1)),C=x=>{const B=`loot_tables/bridge/${this.getShortAnimName("lt",c,this.serverFiles.length)}.json`;return this.serverFiles.push([B,x]),B},d=x=>{const B=`trading/bridge/${this.getShortAnimName("tt",c,this.serverFiles.length)}.json`;return this.serverFiles.push([B,x]),B},p=x=>{this.serverFiles.push([`recipes/bridge/${this.getShortAnimName("recipe",c,this.serverFiles.length)}.json`,x])},w=x=>{this.serverFiles.push([`spawn_rules/bridge/${this.getShortAnimName("sr",c,this.serverFiles.length)}.json`,x])},F=(await _r(`${this.name}/${r}`)).slice(0,16),A=x=>this.registerLifecycleHook(e,r,x,F,"activated"),b=x=>this.registerLifecycleHook(e,r,x,F,"deactivated");this.fileType==="entity"?this.template(t!=null?t:{},{mode:this.mode,compilerMode:this.mode,sourceEntity:()=>JSON.parse(JSON.stringify(e)),create:(x,B,_)=>this.create(e,x,B,_),location:r,identifier:h,projectNamespace:f,animationController:v,animation:g,lootTable:C,tradeTable:d,spawnRule:w,dialogueScene:!this.targetVersion||Mo(this.targetVersion,"1.17.10",">=")?(x,B=!0)=>{this.dialogueScenes[c]||(this.dialogueScenes[c]=[]),this.dialogueScenes[c].push(x),x.scene_tag&&B&&A({run_command:{command:[`/dialogue open @s @p ${x.scene_tag}`]}})}:void 0,onActivated:A,onDeactivated:b,client:{create:(x,B="1.10.0")=>{this.clientFiles[`entity/bridge/${c}.json`]={format_version:B,"minecraft:client_entity":Object.assign({description:{identifier:h}},x)}}}}):this.fileType==="item"?this.template(t!=null?t:{},{mode:this.mode,compilerMode:this.mode,sourceItem:()=>JSON.parse(JSON.stringify(e)),create:(x,B,_)=>this.create(e,x,B,_),location:r,identifier:h,projectNamespace:f,lootTable:C,recipe:p,player:{animationController:v,animation:g,create:(x,B,_)=>this.createOnPlayer.push([B!=null?B:"minecraft:entity",x,_])}}):this.fileType==="block"&&this.template(t!=null?t:{},{mode:this.mode,compilerMode:this.mode,sourceBlock:()=>JSON.parse(JSON.stringify(e)),create:(x,B,_)=>this.create(e,x,B,_),lootTable:C,recipe:p,location:r,identifier:h,projectNamespace:f})}async processAdditionalFiles(e,t){var r,n,s,u,a,o;const l=(n=(r=this.projectConfig)==null?void 0:r.getRelativePackRoot("behaviorPack"))!=null?n:"BP",h=(s=this.projectConfig)==null?void 0:s.getRelativePackRoot("resourcePack"),c=(o=(a=(u=t[`minecraft:${this.fileType}`])==null?void 0:u.description)==null?void 0:a.identifier)!=null?o:"bridge:no_identifier",f=await _r(`${this.name}/${c}`),g=`${l}/animations/bridge/${f}.json`,v=`${l}/animation_controllers/bridge/${f}.json`;return c==="minecraft:player"&&this.createOnPlayer.forEach(([C,d,p])=>{this.create(t,d,C,p)}),h||(this.clientFiles={},this.console.error(`[${this.name}] Dash was unable to load the root of your resource pack and therefore cannot generate client files for this component.`)),{[g]:{baseFile:e,fileContent:this.createAnimations(f,t)},[v]:{baseFile:e,fileContent:this.createAnimationControllers(f,t)},[$.join(l,`dialogue/bridge/${f}.json`)]:this.dialogueScenes[f]&&this.dialogueScenes[f].length>0?{baseFile:e,fileContent:JSON.stringify({format_version:this.targetVersion,"minecraft:npc_dialogue":{scenes:this.dialogueScenes[f]}},null,"	")}:void 0,...Object.fromEntries(this.serverFiles.map(([C,d])=>[$.join(l,C),{baseFile:e,fileContent:JSON.stringify(d,null,"	")}])),...Object.fromEntries(Object.entries(this.clientFiles).map(([C,d])=>[$.join(h,C),{baseFile:e,fileContent:JSON.stringify(d,null,"	")}]))}}createAnimations(e,t){if(this.animations.length===0)return;let r=0;const n={format_version:"1.10.0",animations:{}};for(const[s,u]of this.animations){if(!s){r++;continue}const a=this.getAnimName("animation",e,r),o=this.getShortAnimName("a",e,r);n.animations[a]=s,this.create(t,{animations:{[o]:a}},"minecraft:entity/description"),u!==!1&&this.create(t,{scripts:{animate:[u?{[o]:u}:o]}},"minecraft:entity/description"),r++}return JSON.stringify(n,null,"	")}createAnimationControllers(e,t){if(this.animationControllers.length===0)return;let r=0;const n={format_version:"1.10.0",animation_controllers:{}};for(const[s,u]of this.animationControllers){if(!s){r++;continue}const a=this.getAnimName("controller.animation",e,r),o=this.getShortAnimName("ac",e,r);n.animation_controllers[a]=s,this.create(t,{animations:{[o]:a}},"minecraft:entity/description"),u!==!1&&this.create(t,{scripts:{animate:[u?{[o]:u}:o]}},"minecraft:entity/description"),r++}return JSON.stringify(n,null,"	")}getAnimName(e,t,r){return`${e}.${t}_${r}`}getShortAnimName(e,t,r){var n;return`${(n=t.slice(0,16))!=null?n:"bridge_auto"}_${e}_${r}`}registerLifecycleHook(e,t,r,n,s){e[`minecraft:${this.fileType}`].events||(e[`minecraft:${this.fileType}`].events={});const u=e[`minecraft:${this.fileType}`].events;if(s==="activated"&&t===`minecraft:${this.fileType}/components`)u["minecraft:entity_spawned"]||(u["minecraft:entity_spawned"]={}),this.addEventReponse(u["minecraft:entity_spawned"],r);else if(this.fileType==="entity"&&t.startsWith(`minecraft:${this.fileType}/component_groups/`)){const a=t.split("/").pop();this.findComponentGroupReferences(u,s==="activated"?"add":"remove",a).forEach(l=>this.addEventReponse(l,r))}else if(t.startsWith(`minecraft:${this.fileType}/permutations/`)){const a=t.split("/");if(a.pop()!=="components")throw new Error("Invalid component location inside of permutation");const o=this.getObjAtLocation(e,[...a]),l=`bridge:${n}_${s}_${s==="activated"?this.lifecycleHookCount.activated++:this.lifecycleHookCount.deactivated++}`;o.condition&&this.animationControllers.push([{states:{default:{on_entry:[`@s ${l}`]}}},s==="activated"?o.condition:`!(${o.condition})`]),u[l]=r}}addEventReponse(e,t){if(Array.isArray(e.sequence))e.sequence.push(t);else if(Object.keys(e).length===0)Object.assign(e,t);else{let r=Object.assign({},e,{filters:void 0});for(const n in e)n!=="filters"&&(e[n]=void 0);e.sequence=[r,t]}}findComponentGroupReferences(e,t,r){var n,s;let u=[];for(const a in e){const o=e[a];Array.isArray(o.sequence)?u.push(...this.findComponentGroupReferences(o.sequence,t,r)):Array.isArray(o.randomize)?u.push(...this.findComponentGroupReferences(o.randomize,t,r)):((s=(n=o[t])==null?void 0:n.component_groups)!=null?s:[]).includes(r)&&u.push(o)}return u}}function Jo(i){const e=[];for(const[t,r]of i)e.push(...Vo(r,t));return e}function Vo(i,e){const t=[];for(const r in i)r.startsWith("minecraft:")||r.startsWith("tag:")||t.push([r,e]);return t}function Vr({fileType:i,getComponentObjects:e}){const t=new Map;let r={};return({console:n,projectConfig:s,projectRoot:u,compileFiles:a,getAliases:o,options:l,jsRuntime:h,targetVersion:c,fileType:f})=>{const g=(d,p)=>d&&i==="item"&&(f==null?void 0:f.getId(d))==="entity"&&p(d).includes("minecraft:player"),v=d=>l.v1CompatMode?d==null?void 0:d.includes("/components/"):d&&(f==null?void 0:f.getId(d))==="customComponent"&&d.includes(`/${i}/`),C=d=>d&&(f==null?void 0:f.getId(d))===i;return{buildStart(){t.clear(),r={}},transformPath(d){if(v(d)&&l.buildType!=="fileRequest")return null},async read(d,p){if(!p)return r[d]?Ce.parse(r[d].fileContent):void 0;if(v(d)&&d.endsWith(".js")){const w=await p.getFile();return await(w==null?void 0:w.text())}else if(C(d)||g(d,o)){const w=await p.getFile();if(!w)return;try{return Ce.parse(await w.text())}catch(F){return l.buildType!=="fileRequest"&&n.error(`Error within file "${d}": ${F}`),{__error__:`Failed to load original file: ${F}`}}}},async load(d,p){if(v(d)&&typeof p=="string"){const w=new qo(n,i,p,l.mode,!!l.v1CompatMode,c);return w.setProjectConfig(s),await w.load(h,d)?w:p}},async registerAliases(d,p){if(v(d))return[`${i}Component#${p.name}`]},async require(d,p){if(g(d,o))return[`.${s.getRelativePackRoot("behaviorPack")}/components/item/**/*.[jt]s`,`.${s.getRelativePackRoot("behaviorPack")}/items/**/*.json`];if(C(d)){const w=Jo(e(p));return t.set(d,w),w.map(F=>`${i}Component#${F[0]}`)}else if(r[d])return[r[d].baseFile]},async transform(d,p,w={}){var F;if(g(d,o)){const A=Object.entries(w).filter(([b])=>b.startsWith("itemComponent#")).map(([b,x])=>x);for(const b of A){if(!b)return;r=Dt(r,await b.processAdditionalFiles(d,p))}}else if(C(d)){const A=new Set;for(const[b,x]of(F=t.get(d))!=null?F:[]){const B=w[`${i}Component#${b}`];if(!B)continue;const _=Su(p,x.split("/"),{}),R=_[b];delete _[b],await B.processTemplates(p,R,x),A.add(B)}for(const b of A)r=Dt(r,await b.processAdditionalFiles(d,p));for(const b of A)b.reset()}},finalizeBuild(d,p){if(v(d)&&p)return p.toString();if(C(d)||r[d])return JSON.stringify(p,null,"	")},async buildEnd(){if(l.buildType==="fileRequest")return;r=Object.fromEntries(Object.entries(r).filter(([p,w])=>(w==null?void 0:w.fileContent)!==void 0).map(([p,w])=>[$.join(u,p),w]));const d=Object.keys(r);d.length>0&&await a(d),r={}}}}}const Ko=Vr({fileType:"entity",getComponentObjects:i=>{var e,t,r,n,s,u;return[["minecraft:entity/components",(t=(e=i==null?void 0:i["minecraft:entity"])==null?void 0:e.components)!=null?t:{}],...Object.entries((n=(r=i==null?void 0:i["minecraft:entity"])==null?void 0:r.component_groups)!=null?n:{}).map(([a,o])=>[`minecraft:entity/component_groups/${a}`,o]),...((u=(s=i==null?void 0:i["minecraft:entity"])==null?void 0:s.permutations)!=null?u:[]).map((a,o)=>{var l;return[`minecraft:entity/permutations/${o}/components`,(l=a==null?void 0:a.components)!=null?l:{}]})]}}),Xo=Vr({fileType:"item",getComponentObjects:i=>{var e,t;return[["minecraft:item/components",(t=(e=i==null?void 0:i["minecraft:item"])==null?void 0:e.components)!=null?t:{}]]}}),Qo=Vr({fileType:"block",getComponentObjects:i=>{var e,t,r,n;return[["minecraft:block/components",(t=(e=i==null?void 0:i["minecraft:block"])==null?void 0:e.components)!=null?t:{}],...((n=(r=i==null?void 0:i["minecraft:block"])==null?void 0:r.permutations)!=null?n:[]).map((s,u)=>{var a;return[`minecraft:block/permutations/${u}/components`,(a=s.components)!=null?a:{}]})]}});function Kr(i,e,t,r=0){const n=[];for(const s of i){if(!s.startsWith("/")){n.push(s);continue}const[u,...a]=ji(s.slice(1)).tokens.map(({word:l})=>l),o=e[`command#${u}`];if(u==="execute"){let l=4;if(a[l]==="detect"&&(l+=6),a[l]===void 0){n.push(s);continue}const[h,...c]=a.slice(l),f=e[`command#${h}`];if(!(f instanceof Xr)){n.push(s);continue}n.push(...f.process(`${h} ${c.join(" ")}`,e,r+1).map(g=>g.startsWith("/")?`/execute ${a.slice(0,l).join(" ")} ${g.slice(1)}`:g));continue}else if(!(o instanceof Xr)){n.push(s);continue}n.push(...o.process(s,e,r))}return n.filter(s=>t||!s.startsWith("#")).map(s=>s.trim())}const Yo=i=>({register:e=>{i.command=({name:t,schema:r,template:n})=>{t(e.command_name),r([]),n(s=>new e().onApply(s))}}});class Xr{constructor(e,t,r,n){this.console=e,this.commandSrc=t,this.mode=r,this.v1Compat=n}get name(){var e;return(e=this._name)!=null?e:"unknown"}async load(e,t,r){const n={command:null},s=await e.run(t,{console:this.console,defineCommand:l=>l,Bridge:this.v1Compat?Yo(n):void 0}).catch(l=>(this.console.error(`Failed to execute command ${this.name}: ${l}`),null));if(!s)return null;if(typeof s.__default__!="function")if(n.command)s.__default__=n.command;else return this.console.error(`Component ${t} is not a valid component. Expected a function as the default export.`),!1;const u=l=>this._name=l;let a=l=>this.schema=l,o=()=>{};(!r||r==="server")&&(a=()=>{},o=l=>{this.template=(h,c)=>{try{return l(h,c)}catch(f){return this.console.error(f),[]}}}),await s.__default__({name:u,schema:a,template:o})}process(e,t,r){var n;e.startsWith("/")&&(e=e.slice(1));const[s,...u]=ji(e).tokens.map(({word:l})=>l),a=(n=this.template)==null?void 0:n.call(this,u.map(l=>Lu(l)),{compilerMode:this.mode,commandNestingDepth:r,compileCommands:l=>Kr(l.map(h=>h.startsWith("/")?h:`/${h}`),t,!1,r+1).map(h=>h.startsWith("/")?h.slice(1):h)});let o=[];if(typeof a=="string")o=a.split(`
`);else if(Array.isArray(a))o=a.filter(l=>typeof l=="string");else{const l=`Failed to process command ${this._name}; Invalid command template return type: Expected string[] or string, received ${typeof a}`;this.console.error(l),o.push(`# ${l}`)}return o.map(l=>l.startsWith("/")||l.startsWith("#")?l:`/${l}`)}getSchema(){if(this.schema){if(Array.isArray(this.schema))return this.schema.length===0?[{commandName:this.name}]:this.schema.map(e=>({commandName:this.name,...e}))}else return[{commandName:this.name}];return this.schema.commandName||(this.schema.commandName=this.name),[this.schema]}toString(){return this.commandSrc}}const Zo=({projectConfig:i,jsRuntime:e,console:t,fileType:r,requestJsonData:n,options:s})=>{const u=(c,f)=>i.resolvePackPath(c,f),a=c=>c&&r.getId(c)==="customCommand",o=c=>c&&r.getId(c)==="function",l=c=>{var f;return(f=Object.entries(s.include).find(([g])=>r.getId(c)===g))==null?void 0:f[1]},h=c=>{var f,g,v;return(v=(g=(f=r.get(c))==null?void 0:f.meta)==null?void 0:g.commandsUseSlash)!=null?v:!1};return{async buildStart(){s.include=Object.assign(await n("data/packages/minecraftBedrock/location/validCommand.json"),s.include)},transformPath(c){if(a(c)&&s.buildType!=="fileRequest")return null},async read(c,f){if(!!f){if(a(c)&&c.endsWith(".js")){const g=await f.getFile();return await(g==null?void 0:g.text())}else if(o(c)){const g=await f.getFile();return await(g==null?void 0:g.text())}else if(l(c)&&f){const g=await f.getFile();if(!g)return;try{return Ce.parse(await g.text())}catch(v){t.error(v)}}}},async load(c,f){var g;if(a(c)){const v=new Xr(t,f,s.mode,(g=s.v1CompatMode)!=null?g:!1);return await v.load(e,c),v}},async registerAliases(c,f){if(a(c))return[`command#${f.name}`]},async require(c){if(l(c)||o(c))return[u("behaviorPack","commands/**/*.[jt]s"),u("behaviorPack","commands/*.[jt]s")]},async transform(c,f,g={}){const v=l(c);if(v&&v.length>0){const C=h(c);v.forEach(d=>Oi(d,f,p=>{if(!p)return p;p=Array.isArray(p)?p:[p];const w=[];for(const F of p){if(typeof F=="string"){w.push(F);continue}t.error(`The file "${c}" contains invalid commands. Expected type "string" within array but got type "${typeof F}"`)}return Kr(w.map(F=>!C&&!F.startsWith("/")?`/${F}`:F),g,!1).map(F=>C?F:F.slice(1))}))}else if(o(c)){const C=f.split(`
`).map(d=>d.trim()).filter(d=>d!==""&&!d.startsWith("#")).map(d=>`/${d}`);return Kr(C,g,!0).map(d=>d.startsWith("/")?d.slice(1):d).join(`
`)}},finalizeBuild(c,f){if(a(c)&&f)return f.toString();if(l(c)&&typeof f!="string")return JSON.stringify(f,null,"	")}}},el=({options:i})=>({async transformPath(e){if(!!(e!=null&&e.endsWith(".ts")))return`${e.slice(0,-3)}.js`},async read(e,t){if(!e.endsWith(".ts")||!t)return;const r=await t.getFile();return await(r==null?void 0:r.text())},async load(e,t){if(!!e.endsWith(".ts"))return await tr,Bn(t,{filename:$.basename(e),sourceMaps:i!=null&&i.inlineSourceMap?"inline":void 0,jsc:{parser:{syntax:"typescript",preserveAllComments:!1,topLevelAwait:!0},target:"es2020"}}).code},finalizeBuild(e,t){if(e.endsWith(".ts")&&typeof t=="string")return t}}),tl=({options:i,outputFileSystem:e,projectRoot:t,packType:r,fileType:n,console:s})=>{i.packName||(i.packName="bridge project");const u=h=>h.split(/\\|\//g).filter(c=>c!==".."&&c!==".").slice(1).join("/"),a=h=>{const c=r.getId(h),f=$.relative(t,h);if(c==="behaviorPack"||c==="resourcePack"||c==="skinPack")return $.join(t,"builds/dist",c,u(f))},o=h=>{const c=r.getId(h),f=$.relative(t,h);if(c==="worldTemplate")return $.join(t,"builds/dist",u(f));if(c==="behaviorPack"||c==="resourcePack")return $.join(t,"builds/dist",c==="behaviorPack"?"behavior_packs":"resource_packs",i.packName,u(f))},l=h=>n.getId(h)==="worldManifest"?null:o(h);return{async buildStart(){await e.unlink(`${t}/builds/dist`).catch(()=>{})},transformPath(h){if(!!h)switch(i.format){case"mcaddon":return a(h);case"mcworld":return l(h);case"mctemplate":return o(h);default:s.error(`Unknown packaging format: ${i.format}`)}}}},rl=({projectConfig:i,packType:e,options:t})=>{const r=Object.keys(i.getAvailablePacks()),n=Object.fromEntries(r.map(u=>[u,[]])),s=u=>{const a=e.getId(u);if(a!=="unknown")return[a,i.resolvePackPath(a,"contents.json")]};return t.buildType!=="fullBuild"?{}:{include(){return r.map(u=>[i.resolvePackPath(u,"contents.json"),{isVirtual:!0}])},read(u){const a=s(u);if(!a)return;const[o,l]=a;if(u!==l)return n[o]},transformPath(u){if(!u)return;const a=e.getId(u);a!=="unknown"&&n[a].push(u)},finalizeBuild(u){const a=s(u);if(!a)return;const[o,l]=a;if(u!==l)return JSON.stringify(n[o])}}},il=({fileType:i})=>{const e=[];for(const r of i.all)r.formatVersionMap&&e.push(r.id);const t=r=>r&&e.includes(i.getId(r));return{async read(r,n){if(!!n&&t(r)){const s=await n.getFile();if(!s)return;try{return Ce.parse(await s.text())}catch(u){console.error(u)}}},load(r,n){if(t(r))return n},transform(r,n){if(t(r)){const s=i.get(r),u=s==null?void 0:s.formatVersionMap;if(!u)return;const a=n==null?void 0:n.format_version;return a&&u[a]&&(n.format_version=u[a]),n}},finalizeBuild(r,n){if(t(r))return JSON.stringify(n)}}};class Qr{constructor(e,t){this.console=e,this.baseDir=t,this.files=new Map}get hasFiles(){return this.files.size>0}getAll(){return[...this.files.entries()]}get(e){return this.files.get(e)}clear(){this.files.clear()}add(e,t){const r=this.baseDir?$.join(this.baseDir,e):e;if(this.files.has(r)){this.console.warn(`Omitting file "${r}" from collection because it would overwrite a previously generated file!`);return}this.files.set(r,t)}has(e){return this.files.has(e)}addFrom(e){for(const[t,r]of e.getAll())this.add(t,r)}}function nl({generatorPath:i,omitUsedTemplates:e,fileSystem:t,console:r}){return{useTemplate:(n,{omitTemplate:s=!0}={})=>{const u=$.join($.dirname(i),n);return s&&e.add(u),n.endsWith(".json")?t.readJson(u):t.readFile(u).then(a=>a.text())},createCollection:()=>new Qr(r,$.dirname(i))}}const sl=({options:i,fileType:e,console:t,jsRuntime:r,fileSystem:n,compileFiles:s,getFileMetadata:u,unlinkOutputFiles:a,addFileDependencies:o})=>{var l;const h=new Set(["gameTest","customCommand","customComponent","molangAstScript",...(l=i.ignoredFileTypes)!=null?l:[]]),c=A=>e.getId(A),f=A=>{var b;const x=e.get(A,void 0,!1);return x?(b=x.type)!=null?b:"json":"raw"},g=A=>!h.has(c(A))&&(A.endsWith(".js")||A.endsWith(".ts")),v=A=>{var b,x,B,_;return f(A)==="json"?".json":(_=(B=(x=(b=e.get(A,void 0,!1))==null?void 0:b.detect)==null?void 0:x.fileExtensions)==null?void 0:B[0])!=null?_:".txt"},C=A=>A.replace(/\.(js|ts)$/,v(A)),d=new Set,p=new Qr(t),w=new Set,F=new Map;return{buildStart(){p.clear(),d.clear(),w.clear(),F.clear()},transformPath(A){if(A&&g(A))return C(A)},async read(A,b){if(g(A)&&b){const B=await b.getFile();return B?B.text():void 0}const x=p.get(A);if(x)return x},async load(A,b){var x,B;const _=new Set;if(r.registerModule("@bridge/generate",nl({generatorPath:A,fileSystem:n,omitUsedTemplates:_,console:t})),g(A)){if(!b)return null;const R=await r.run(A,{console:t},b).catch(I=>(t.error(`Failed to execute generator script "${A}": ${I}`),null));if(!R)return null;if(!R.__default__)return t.error(`Expected generator script "${A}" to provide file content as default export!`),null;const J=u(A);((x=J.get("unlinkedFiles"))!=null?x:[]).filter(I=>!_.has(I)).forEach(I=>w.add(I)),J.set("unlinkedFiles",[..._]);const j=(B=J.get("generatedFiles"))!=null?B:[];return await a([...j,..._]).catch(()=>{}),F.set(A,_),R.__default__}},require(A){const b=F.get(A);if(b)return[...b]},finalizeBuild(A,b){if(p.get(A))return A.endsWith(".json")&&typeof b!="string"?JSON.stringify(b,null,"	"):b;if(d.has(A))return null;if(g(A)){if(b===null)return null;const x=u(A);return b instanceof Qr?(p.addFrom(b),x.set("generatedFiles",b.getAll().map(([B])=>B)),null):(x.set("generatedFiles",[C(A)]),typeof b=="object"?JSON.stringify(b):b)}},async buildEnd(){r.deleteModule("@bridge/generate"),w.size>0&&await s([...w].filter(A=>!p.has(A)),!1),p.hasFiles&&await s(p.getAll().map(([A])=>A))},async beforeFileUnlinked(A){var b,x;if(g(A)){const B=u(A),_=(b=B.get("unlinkedFiles"))!=null?b:[],R=(x=B.get("generatedFiles"))!=null?x:[];await a(R),await s(_)}}}};class Un extends So{constructor(e,t){super(t),this.fs=e}readFile(e){return this.fs.readFile(e).then(t=>t.text())}deleteModule(e){this.baseModules.delete(e)}}const zn={simpleRewrite:No,rewriteForPackaging:tl,moLang:Pn,molang:Pn,entityIdentifierAlias:Io,customEntityComponents:Ko,customItemComponents:Xo,customBlockComponents:Qo,customCommands:Zo,typeScript:el,contentsFile:rl,formatVersionCorrection:il,generatorScripts:sl};class ul{constructor(e){this.dash=e,this.plugins=[],this.pluginRuntime=new Un(this.dash.fileSystem)}async loadPlugins(e={}){var t,r;this.plugins=[],this.pluginRuntime.clearCache();const n=[...(await this.dash.fileSystem.readdir($.join(this.dash.projectRoot,".bridge/extensions")).catch(()=>[])).map(a=>a.kind==="directory"?$.join(this.dash.projectRoot,".bridge/extensions",a.name):void 0),...(await this.dash.fileSystem.readdir("extensions").catch(()=>[])).map(a=>a.kind==="directory"?$.join("extensions",a.name):void 0)],s={};for(const a of n){if(!a)continue;let o;try{o=await this.dash.fileSystem.readJson($.join(a,"manifest.json"))}catch{continue}if(!!((t=o==null?void 0:o.compiler)!=null&&t.plugins))for(const l in o.compiler.plugins)s[l]=$.join(a,o.compiler.plugins[l])}const u=(r=(await this.getCompilerOptions()).plugins)!=null?r:[];for(const a of u){const o=typeof a=="string"?a:a[0],l=typeof a=="string"?{}:a[1];if(s[o]){const h=await this.pluginRuntime.run(s[o],{console:this.dash.console,...e}).catch(c=>(this.dash.console.error(`Failed to execute plugin ${o}: ${c}`),null));if(!h)continue;typeof h.__default__=="function"?this.plugins.push(new On(this.dash,o,h.__default__(await this.getPluginContext(o,l)))):this.dash.console.error(`Plugin ${o} is invalid: It does not provide a function as a default export.`)}else zn[o]?this.plugins.push(new On(this.dash,o,zn[o](await this.getPluginContext(o,l)))):this.dash.console.error(`Unknown compiler plugin: ${o}`)}}async getCompilerOptions(){var e;const t=await this.dash.getCompilerConfigPath();return t?await this.dash.fileSystem.readJson(t):(e=this.dash.projectConfig.get().compiler)!=null?e:{}}async getPluginContext(e,t={}){const r=this.dash;return{options:{get mode(){return r.getMode()},get buildType(){return r.buildType},...t},jsRuntime:this.dash.jsRuntime,console:this.dash.console,fileSystem:this.dash.fileSystem,outputFileSystem:this.dash.outputFileSystem,projectConfig:this.dash.projectConfig,projectRoot:this.dash.projectRoot,packType:this.dash.packType,fileType:this.dash.fileType,targetVersion:this.dash.projectConfig.get().targetVersion,requestJsonData:this.dash.requestJsonData,getAliases:n=>{var s,u;return[...(u=(s=this.dash.includedFiles.get(n))==null?void 0:s.aliases)!=null?u:[]]},getFileMetadata:n=>{const s=this.dash.includedFiles.get(n);if(!s)throw new Error(`File ${n} to add metadata to not found`);return{get(u){return s.getMetadata(u)},set(u,a){s.addMetadata(u,a)},delete(u){s.deleteMetadata(u)}}},addFileDependencies:(n,s,u=!1)=>{const a=this.dash.includedFiles.get(n);if(!a)throw new Error(`File ${n} to add dependency to not found`);u?a.setRequiredFiles(new Set(s)):s.forEach(o=>a.addRequiredFile(o))},getOutputPath:n=>this.dash.getCompilerOutputPath(n),unlinkOutputFiles:n=>this.dash.unlinkMultiple(n,!1,!0),hasComMojangDirectory:this.dash.fileSystem!==this.dash.outputFileSystem,compileFiles:(n,s=!0)=>this.dash.compileAdditionalFiles(n,s)}}async runBuildStartHooks(){for(const e of this.plugins)await e.runBuildStartHook()}async runIncludeHooks(){let e=[];for(const t of this.plugins){const r=await t.runIncludeHook();Array.isArray(r)&&e.push(...r)}return e}async runTransformPathHooks(e){let t=e;for(const r of this.plugins){const n=await r.runTransformPathHook(t);if(n===null)return null;n!==void 0&&(t=n)}return t}async runReadHooks(e,t){for(const r of this.plugins){const n=await r.runReadHook(e,t);if(n!=null)return n}}async runLoadHooks(e,t){let r=t;for(const n of this.plugins){const s=await n.runLoadHook(e,r);s!==void 0&&(r=s)}return r}async runRegisterAliasesHooks(e,t){const r=new Set;for(const n of this.plugins){const s=await n.runRegisterAliasesHook(e,t);s!=null&&(Array.isArray(s)?s.forEach(u=>r.add(u)):r.add(s))}return r}async runRequireHooks(e,t){const r=new Set;for(const n of this.plugins){const s=await n.runRequireHook(e,t);s!=null&&(Array.isArray(s)?s.forEach(u=>r.add(u)):r.add(s))}return r}async runTransformHooks(e){const t=Object.fromEntries([...e.requiredFiles].map(n=>this.dash.includedFiles.query(n)).flat().map(n=>[[n.filePath,n.data],...[...n.aliases].map(s=>[s,n.data])]).flat());let r=e.data;for(const n of this.plugins){const s=await n.runTransformHook(e.filePath,r,t);s!==void 0&&(r=s)}return r}async runFinalizeBuildHooks(e){for(const t of this.plugins){const r=await t.runFinalizeBuildHook(e.filePath,e.data);if(r!==void 0)return r}}async runBuildEndHooks(){for(const e of this.plugins)await e.runBuildEndHook()}async runBeforeFileUnlinked(e){for(const t of this.plugins)await t.runBeforeFileUnlinked(e)}}class Yr{constructor(e,t,r=!1){this.dash=e,this.filePath=t,this.isVirtual=r,this.isDone=!1,this.requiredFiles=new Set,this.aliases=new Set,this.updateFiles=new Set,this.metadata=new Map,this.outputPath=t,this.isVirtual||this.setDefaultFileHandle()}setFileHandle(e){this.fileHandle=e}setDefaultFileHandle(){this.setFileHandle({getFile:()=>this.dash.fileSystem.readFile(this.filePath).catch(()=>null)})}setOutputPath(e){this.outputPath=e}setReadData(e){this.data=e}setAliases(e){for(const t of e)this.dash.includedFiles.addAlias(t,this);this.aliases=e}setRequiredFiles(e){this.requiredFiles=e}addRequiredFile(e){this.requiredFiles.add(e)}setUpdateFiles(e){this.updateFiles=new Set(e.map(t=>this.dash.includedFiles.get(t)).filter(t=>t!==void 0))}addUpdateFile(e){this.updateFiles.add(e)}removeUpdateFile(e){this.updateFiles.delete(e)}setMetadata(e){typeof e=="object"&&(this.metadata=new Map(Object.entries(e)))}addMetadata(e,t){this.metadata.set(e,t)}deleteMetadata(e){this.metadata.delete(e)}getMetadata(e){return this.metadata.get(e)}getAllMetadata(){return Object.fromEntries(this.metadata.entries())}getHotUpdateChain(){const e=new Set([this]);for(const t of this.updateFiles)t.getHotUpdateChain().forEach(r=>{e.add(r)});return e}filesToLoadForHotUpdate(e=new Set,t=!0){const r=new Set;if(e.has(this))return r;e.add(this);for(const n of this.requiredFiles){const s=this.dash.includedFiles.query(n);for(const u of s)u.filesToLoadForHotUpdate(e,!1).forEach(a=>{r.add(a)})}if(r.add(this),t)for(const n of this.updateFiles)n.filesToLoadForHotUpdate(e,!0).forEach(s=>{r.add(s)});return r}async processAfterLoad(e){if((this.data===null||this.data===void 0)&&(this.isDone=!0,this.filePath!==this.outputPath&&this.outputPath!==null&&!this.isVirtual&&e)){const t=await this.dash.fileSystem.readFile(this.filePath);await this.dash.outputFileSystem.writeFile(this.outputPath,new Uint8Array(await t.arrayBuffer()))}}serialize(){return{isVirtual:this.isVirtual,filePath:this.filePath,aliases:[...this.aliases],requiredFiles:[...this.requiredFiles],updateFiles:[...this.updateFiles].map(e=>e.filePath),metadata:this.metadata.size>0?Object.fromEntries(this.metadata.entries()):void 0}}reset(){this.isDone=!1,this.data=null,this.isVirtual||this.setDefaultFileHandle()}}class al{constructor(e){this.dash=e,this.files=new Map,this.aliases=new Map,this.queryCache=new Map}all(){return[...this.files.values()]}filtered(e){return this.all().filter(t=>e(t))}get(e){var t;return(t=this.aliases.get(e))!=null?t:this.files.get(e)}query(e){if(Oo(e))return this.queryGlob(e);const t=this.aliases.get(e);if(t)return[t];const r=this.files.get(e);return r?[r]:[]}addAlias(e,t){this.aliases.set(e,t)}queryGlob(e){if(this.queryCache.has(e))return this.queryCache.get(e);const t=this.filtered(r=>Lt(r.filePath,e));return this.queryCache.set(e,t),t}async loadAll(){this.queryCache=new Map;const e=new Set,t=this.dash.projectConfig.getAvailablePackPaths();for(const n of t){const s=await this.dash.fileSystem.allFiles(n).catch(u=>(this.dash.console.warn(u),[]));for(const u of s)e.add(u)}const r=await this.dash.plugins.runIncludeHooks();for(const n of r)typeof n=="string"?e.add(n):this.addOne(n[0],n[1].isVirtual);this.add([...e])}addOne(e,t=!1){const r=new Yr(this.dash,e,t);return this.files.set(e,r),r}add(e,t=!1){let r=[];for(const n of e){const s=this.files.get(n);if(s){r.push(s);continue}r.push(new Yr(this.dash,n,t)),this.files.set(n,r[r.length-1])}return r}remove(e){const t=this.files.get(e);if(!!t){this.files.delete(e);for(const r of t.aliases)this.aliases.delete(r)}}async save(e){await this.dash.fileSystem.writeJson(e,this.all().map(t=>t.serialize()))}async load(e){this.removeAll();const t=await this.dash.fileSystem.readJson(e).catch(()=>null),r=[];if(!!t){for(const n of t){const s=new Yr(this.dash,n.filePath,n.isVirtual);s.setAliases(new Set(n.aliases)),s.setRequiredFiles(new Set(n.requiredFiles)),s.setMetadata(n.metadata),r.push(s);for(const u of n.aliases)this.aliases.set(u,s)}this.files=new Map(r.map(n=>[n.filePath,n]));for(let n=0;n<r.length;n++)r[n].setUpdateFiles(t[n].updateFiles)}}resetAll(){for(const e of this.all())e.reset()}removeAll(){this.files=new Map,this.aliases=new Map,this.queryCache=new Map}}class ol{constructor(e){this.dash=e}async run(e,t=!0){for(const r of e)r.isDone||await this.loadFile(r,t);for(const r of e)r.isDone||await this.loadRequiredFiles(r)}async loadFile(e,t=!0){var r;const[n,s]=await Promise.all([this.dash.plugins.runTransformPathHooks(e.filePath),this.dash.plugins.runReadHooks(e.filePath,e.fileHandle)]);if(e.setOutputPath(n),e.setReadData(s),await e.processAfterLoad(t),e.isDone)return;e.setReadData((r=await this.dash.plugins.runLoadHooks(e.filePath,e.data))!=null?r:e.data);const u=await this.dash.plugins.runRegisterAliasesHooks(e.filePath,e.data);e.setAliases(u)}async loadRequiredFiles(e){const t=await this.dash.plugins.runRequireHooks(e.filePath,e.data);e.setRequiredFiles(t)}}class ll{constructor(e){this.dash=e}run(e){const t=new Set;for(const r of e)r.isDone||t.has(r)||this.resolveSingle(r,t);return t}resolveSingle(e,t,r=new Set){const n=this.dash.includedFiles;r.add(e);for(const s of e.requiredFiles){const u=n.query(s);for(const a of u){if(!a){this.dash.console.error(`Undefined file dependency: "${e.filePath}" requires "${s}"`);continue}if(a.addUpdateFile(e),!t.has(a)){if(r.has(a)){this.dash.console.error(`Circular dependency detected: ${a.filePath} is required by ${e.filePath} but also depends on this file.`);continue}this.resolveSingle(a,t,r)}}}t.add(e),r.delete(e)}}function cl(i){return typeof i=="string"||i instanceof Blob||i instanceof File||i instanceof ArrayBuffer||(i==null?void 0:i.buffer)instanceof ArrayBuffer}class hl{constructor(e){this.dash=e}async run(e,t=!1){for(const r of e){if(r.isDone)continue;let n=await this.transformFile(r,!0,t);n!=null&&r.outputPath&&await this.dash.outputFileSystem.writeFile(r.outputPath,n)}}async transformFile(e,t=!1,r=!1){var n;if(r||(e.data=(n=await this.dash.plugins.runTransformHooks(e))!=null?n:e.data),!t)return e.data;let s=await this.dash.plugins.runFinalizeBuildHooks(e);return s===void 0&&(s=e.data),s!=null&&(cl(s)||(this.dash.console.warn(`File "${e.filePath}" was not in a writable format: "${typeof s}". Trying to JSON.stringify(...) it...`,s),s=JSON.stringify(s))),e.isDone=!0,s}}class fl{constructor(e=1){this.total=e,this.current=0,this.onChangeCbs=new Set}get percentage(){return this.current/this.total}onChange(e){return this.onChangeCbs.add(e),{dispose:()=>this.onChangeCbs.delete(e)}}setTotal(e){this.total=e,this.current=0,this.onChangeCbs.forEach(t=>t(this))}updateCurrent(e){this.current=e,this.onChangeCbs.forEach(t=>t(this))}advance(){this.current++,this.onChangeCbs.forEach(e=>e(this))}addToTotal(e){this.total+=e,this.onChangeCbs.forEach(t=>t(this))}}class Wn{constructor(){this._timers=new Map}time(e){if(this._timers.has(e)){this.warn(`Timer "${e}" already exists.`);return}else this._timers.set(e,Date.now())}timeEnd(e){const t=this._timers.get(e);if(t)this._timers.delete(e),this.log(`${e}: ${Date.now()-t}ms`);else{this.warn(`Timer "${e}" does not exist.`);return}}}class dl extends Wn{log(...e){console.log(...e)}error(...e){console.error(...e)}warn(...e){console.warn(...e)}info(...e){console.info(...e)}}class pl{constructor(e,t,r){var n;this.fileSystem=e,this.options=r,this.progress=new fl,this.plugins=new ul(this),this.includedFiles=new al(this),this.loadFiles=new ol(this),this.fileOrderResolver=new ll(this),this.fileTransformer=new hl(this),this.buildType="fullBuild",this.outputFileSystem=t!=null?t:e,this.projectRoot=$.dirname(r.config),this.projectConfig=new Po(e,r.config),this.console=(n=r.console)!=null?n:new dl,this.jsRuntime=new Un(this.fileSystem,[["@molang/expressions",Sn],["@molang/core",{MoLang:Wr}],["molang",{MoLang:Wr,...Sn}],["@bridge/compiler",{mode:r.mode}]]),this.packType=r.packType,this.fileType=r.fileType}getMode(){var e;return(e=this.options.mode)!=null?e:"development"}getCompilerConfigPath(){return this.options.compilerConfig}get requestJsonData(){return this.options.requestJsonData}get dashFilePath(){return $.join(this.projectRoot,`.bridge/.dash.${this.getMode()}.json`)}async setup(e){var t,r,n,s;try{await this.projectConfig.setup()}catch(u){this.console.error("Failed to load project config: "+u)}(t=this.fileType)==null||t.setProjectConfig(this.projectConfig),(r=this.packType)==null||r.setProjectConfig(this.projectConfig),await((n=this.fileType)==null?void 0:n.setup(e)),await((s=this.packType)==null?void 0:s.setup(e)),await this.plugins.loadPlugins(this.options.pluginEnvironment)}async reload(){try{await this.projectConfig.refreshConfig()}catch{}await this.plugins.loadPlugins(this.options.pluginEnvironment)}get isCompilerActivated(){const e=this.projectConfig.get();return e.compiler!==void 0&&Array.isArray(e.compiler.plugins)}async build(){if(this.console.log("Starting compilation..."),!this.isCompilerActivated)return;this.jsRuntime.clearCache(),this.buildType="fullBuild",this.includedFiles.removeAll();const e=Date.now();this.progress.setTotal(7),await this.plugins.runBuildStartHooks(),this.progress.advance(),await this.includedFiles.loadAll(),this.progress.advance(),await this.compileIncludedFiles(),await this.plugins.runBuildEndHooks(),this.progress.advance(),this.getMode()==="development"&&await this.saveDashFile(),this.includedFiles.resetAll(),this.progress.advance(),this.console.log(`Dash compiled ${this.includedFiles.all().length} files in ${Date.now()-e}ms!`)}async updateFiles(e,t=!0){var r;if(!this.isCompilerActivated||e.length===0)return;this.buildType="hotUpdate",this.jsRuntime.clearCache(),this.progress.setTotal(8),this.console.log(`Dash is starting to update ${e.length} files...`),await this.includedFiles.load(this.dashFilePath),await this.plugins.runBuildStartHooks();const n=[];for(const o of e){let l=this.includedFiles.get(o);l||([l]=this.includedFiles.add([o])),n.push(l)}this.progress.advance();const s=[];for(const o of n)s.push(new Set([...o.requiredFiles]));this.progress.advance(),await this.loadFiles.run(n),this.progress.advance();for(let o=0;o<n.length;o++){const l=n[o];[...l.requiredFiles].filter(f=>!s[o].has(f)).forEach(f=>this.includedFiles.query(f).forEach(g=>g.addUpdateFile(l))),[...s[o]].filter(f=>!l.requiredFiles.has(f)).forEach(f=>this.includedFiles.query(f).forEach(g=>g.removeUpdateFile(l)))}this.progress.advance();const u=new Set(n.map(o=>[...o.filesToLoadForHotUpdate()]).flat());this.console.log(`Dash is loading ${u.size} files...`),await this.loadFiles.run([...u.values()].filter(o=>!n.includes(o))),this.progress.advance();const a=new Set(n.map(o=>[...o.getHotUpdateChain()]).flat());for(const o of u)o.isDone||(o.data=(r=await this.plugins.runTransformHooks(o))!=null?r:o.data,a.has(o)||(o.isDone=!0));this.progress.advance(),this.console.log(`Dash is compiling ${a.size} files...`),await this.fileTransformer.run(a,!0),this.progress.advance(),await this.plugins.runBuildEndHooks(),t&&await this.saveDashFile(),this.includedFiles.resetAll(),this.console.log(`Dash finished updating ${a.size} files!`),this.progress.advance()}async compileFile(e,t){var r;if(!this.isCompilerActivated)return[[],t];this.buildType="fileRequest",this.jsRuntime.clearCache(),this.progress.setTotal(7),await this.plugins.runBuildStartHooks(),await this.includedFiles.load(this.dashFilePath);let n=this.includedFiles.get(e);n||([n]=this.includedFiles.add([e])),n.setFileHandle({getFile:async()=>new File([t],$.basename(e))}),await this.loadFiles.loadFile(n,!1),await this.loadFiles.loadRequiredFiles(n),this.progress.advance();const s=n.filesToLoadForHotUpdate();await this.loadFiles.run([...s.values()].filter(a=>n!==a),!1),this.progress.advance();for(const a of s)a.isDone||(a.data=(r=await this.plugins.runTransformHooks(a))!=null?r:a.data);this.progress.advance();const u=await this.fileTransformer.transformFile(n,!0,!0);return this.progress.advance(),await this.includedFiles.load(this.dashFilePath),this.progress.advance(),await this.plugins.runBuildEndHooks(),[[...s].map(a=>a.filePath),u]}async unlinkMultiple(e,t=!0,r=!1){if(!this.isCompilerActivated||e.length===0)return;const n=[];for(const s of e)await this.unlink(s,!1,r).catch(u=>n.push(u));if(n.length>0)throw n[0];t&&await this.saveDashFile()}async unlink(e,t=!0,r=!1){if(!this.isCompilerActivated)return;const n=await this.getCompilerOutputPath(e);!n||n===e||(r||(await this.plugins.runBeforeFileUnlinked(e),this.includedFiles.remove(e)),await this.outputFileSystem.unlink(n),t&&await this.saveDashFile())}async rename(e,t){!this.isCompilerActivated||(await this.unlink(e,!1),await this.updateFiles([t],!1),await this.saveDashFile())}async getCompilerOutputPath(e){var t;if(!this.isCompilerActivated)return;const r=this.includedFiles.get(e);if(r&&r.outputPath!==e)return(t=r.outputPath)!=null?t:void 0;const n=await this.plugins.runTransformPathHooks(e);if(!!n)return n}async getFileMetadata(e){if(!this.isCompilerActivated)return;const t=this.includedFiles.get(e);return t?t.getAllMetadata():null}async getFileDependencies(e){if(!this.isCompilerActivated)return[];await this.includedFiles.load(this.dashFilePath);const t=this.includedFiles.get(e);return t?[...t.filesToLoadForHotUpdate()].map(r=>r.isVirtual?r.outputPath:r.filePath).filter(r=>r!==null&&r!==e):[]}async saveDashFile(){await this.includedFiles.save(this.dashFilePath)}async compileIncludedFiles(e=this.includedFiles.all()){await this.loadFiles.run(e),this.progress.advance();const t=this.fileOrderResolver.run(e);this.progress.advance(),await this.fileTransformer.run(t),this.progress.advance()}async compileAdditionalFiles(e,t=!0){const r=this.includedFiles.add(e,t);this.progress.addToTotal(3),r.forEach(n=>n.reset()),await this.compileIncludedFiles(r)}}class gl{async allFiles(e){const t=[],r=await this.readdir(e);for(const{name:n,kind:s}of r)s==="directory"?t.push(...await this.allFiles($.join(e,n))):s==="file"&&t.push($.join(e,n));return t}async writeJson(e,t,r=!0){await this.writeFile(e,JSON.stringify(t,null,r?"	":0))}async readJson(e){const t=await this.readFile(e);try{return await Ce.parse(await t.text())}catch{throw new Error(`Invalid JSON: ${e}`)}}watchDirectory(e,t){console.warn("Watching a directory for changes is not supported on this platform!")}}class Dl extends Yu{constructor(t){super(t);P(this,"ready",new We)}async setup(t){this.packTypes.length>0||(await t.fired,this.packTypes=await t.readJSON("data/packages/minecraftBedrock/packDefinitions.json").catch(()=>[]),this.ready.dispatch())}}class Gn extends gl{constructor(t){super();P(this,"internalFs");this.internalFs=new Jt(t)}get internal(){return this.internalFs}readJson(t){return this.internalFs.readJSON(t)}async writeJson(t,r,n){await this.internalFs.writeJSON(t,r,n)}readFile(t){return this.internalFs.readFile(t)}async writeFile(t,r){await this.internalFs.writeFile(t,r)}mkdir(t){return this.internalFs.mkdir(t)}unlink(t){return this.internalFs.unlink(t)}async allFiles(t){return(await this.internalFs.readFilesFromDir(t)).map(r=>r.path)}readdir(t){return this.internalFs.readdir(t,{withFileTypes:!0})}async lastModified(t){return 0}}class ml extends Wn{constructor(){super(...arguments);P(this,"logs",[]);P(this,"changeListeners",[])}getLogs(){return this.logs}basicLog(t,{type:r}={}){switch(r){case"warning":console.warn(t);break;case"error":console.error(t);break;case"info":console.info(t);break;default:console.log(t);break}t instanceof Error&&(t=t.message),this.logs.unshift([typeof t=="string"?t:JSON.stringify(t),{type:r}]),this.logsChanged()}addChangeListener(t){this.changeListeners.push(t)}removeChangeListeners(){this.changeListeners=[]}logsChanged(){this.changeListeners.forEach(t=>t())}clear(){this.logs=[],this.logsChanged()}log(...t){t.forEach(r=>this.basicLog(r))}info(...t){t.forEach(r=>this.basicLog(r,{type:"info"}))}warn(...t){t.forEach(r=>this.basicLog(r,{type:"warning"}))}error(...t){t.forEach(r=>this.basicLog(r,{type:"error"}))}}class El{constructor(){P(this,"listeners",[]);P(this,"isLocked",!1)}lock(){return new Promise(async(e,t)=>{this.isLocked?this.listeners.push(()=>{this.isLocked=!0,e()}):(this.isLocked=!0,e())})}unlock(){if(!this.isLocked)throw new Error("Trying to unlock a mutex that is not locked");this.isLocked=!1,this.listeners.length>0&&this.listeners.shift()()}}var yl="/assets/wasm-web_bg.533586ee.wasm";globalThis.process={cwd:()=>"",env:{}},ko(yl);const rr=new va,qn=new Map;class wl extends ni{constructor(t,r,n){super();P(this,"fileSystem");P(this,"fileType");P(this,"dash");P(this,"isDashFree",new El);P(this,"projectDir");P(this,"isSetup",!1);P(this,"completedStartUp",new We);P(this,"console");this.fileSystem=new Gn(t);const s=r&&n.mode==="development"?new Gn(r):void 0;this.fileType=new ea,this.fileType.setPluginFileTypes(n.pluginFileTypes);let u=qn.get(n.projectName);u||(u=new ml,qn.set(n.projectName,u)),this.console=u,this.dash=new pl(this.fileSystem,s,{config:n.config,compilerConfig:n.compilerConfig,console:u,mode:n.mode,fileType:this.fileType,packType:new Dl,requestJsonData:a=>rr.readJSON(a)}),this.projectDir=Mr(n.config)}getCompilerLogs(){return this.console.getLogs()}clearCompilerLogs(){this.console.clear()}onConsoleUpdate(t){this.console.addChangeListener(t)}removeConsoleListeners(){this.console.removeChangeListeners()}async compileFile(t,r){await this.isDashFree.lock();const[n,s]=await this.dash.compileFile(t,r);return this.isDashFree.unlock(),[n,s!=null?s:r]}async start(t,r){await this.isDashFree.lock();const n=this.fileSystem.internal;await n.fileExists(`${this.projectDir}/.bridge/.restartWatchMode`)||!await n.fileExists(`${this.projectDir}/.bridge/.dash.${this.dash.getMode()}.json`)?await Promise.all([this.build(!1).catch(s=>console.error(s)),n.unlink(`${this.projectDir}/.bridge/.restartWatchMode`).catch(s=>console.error(s))]):(r.length>0&&await this.unlinkMultiple(r,!1),t.length>0&&await this.updateFiles(t,!1)),this.completedStartUp.dispatch(),this.isDashFree.unlock()}async build(t=!0){t&&await this.isDashFree.lock(),this.dispatch(),await this.dash.build(),t&&this.isDashFree.unlock()}async updateFiles(t,r=!0){r&&await this.isDashFree.lock(),this.dispatch(),await this.dash.updateFiles(t),r&&this.isDashFree.unlock()}async unlink(t,r=!0){await this.isDashFree.lock(),await this.dash.unlink(t,r),this.isDashFree.unlock()}async unlinkMultiple(t,r=!0){r&&await this.isDashFree.lock(),await this.dash.unlinkMultiple(t),r&&this.isDashFree.unlock()}async rename(t,r){await this.isDashFree.lock(),this.dispatch(),await this.dash.rename(t,r),this.isDashFree.unlock()}async renameMultiple(t){for(const[r,n]of t)await this.dash.rename(r,n)}getCompilerOutputPath(t){return this.dash.getCompilerOutputPath(t)}getFileDependencies(t){return this.dash.getFileDependencies(t)}async setup(){await this.isDashFree.lock(),rr.hasFired||await rr.loadData(),await this.dash.setup(rr),this.isDashFree.unlock(),this.isSetup=!0}async reloadPlugins(){await this.isDashFree.lock(),await this.dash.reload(),this.isDashFree.unlock()}onProgress(t){const r=this.dash.progress.onChange(n=>{n.percentage===1?(r.dispose(),t(1)):t(n.percentage)})}}ur(wl,self)})();
