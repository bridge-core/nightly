(function(){"use strict";const bn=Symbol("Comlink.proxy"),Bs=Symbol("Comlink.endpoint"),Rs=Symbol("Comlink.releaseProxy"),vr=Symbol("Comlink.thrown"),xn=r=>typeof r=="object"&&r!==null||typeof r=="function",Ts={canHandle:r=>xn(r)&&r[bn],serialize(r){const{port1:e,port2:t}=new MessageChannel;return wr(r,e),[t,[t]]},deserialize(r){return r.start(),Ps(r)}},$s={canHandle:r=>xn(r)&&vr in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},ut=new Map([["proxy",Ts],["throw",$s]]);function wr(r,e=self){e.addEventListener("message",function t(n){if(!n||!n.data)return;const{id:i,type:s,path:u}=Object.assign({path:[]},n.data),a=(n.data.argumentList||[]).map(ze);let o;try{const l=u.slice(0,-1).reduce((c,f)=>c[f],r),h=u.reduce((c,f)=>c[f],r);switch(s){case 0:o=h;break;case 1:l[u.slice(-1)[0]]=ze(n.data.value),o=!0;break;case 2:o=h.apply(l,a);break;case 3:{const c=new h(...a);o=Ls(c)}break;case 4:{const{port1:c,port2:f}=new MessageChannel;wr(r,f),o=Ns(c,[c])}break;case 5:o=void 0;break}}catch(l){o={value:l,[vr]:0}}Promise.resolve(o).catch(l=>({value:l,[vr]:0})).then(l=>{const[h,c]=Ar(l);e.postMessage(Object.assign(Object.assign({},h),{id:i}),c),s===5&&(e.removeEventListener("message",t),_n(e))})}),e.start&&e.start()}function Os(r){return r.constructor.name==="MessagePort"}function _n(r){Os(r)&&r.close()}function Ps(r,e){return Cr(r,[],e)}function Ht(r){if(r)throw new Error("Proxy has been released and is not useable")}function Cr(r,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(s,u){if(Ht(n),u===Rs)return()=>at(r,{type:5,path:e.map(a=>a.toString())}).then(()=>{_n(r),n=!0});if(u==="then"){if(e.length===0)return{then:()=>i};const a=at(r,{type:0,path:e.map(o=>o.toString())}).then(ze);return a.then.bind(a)}return Cr(r,[...e,u])},set(s,u,a){Ht(n);const[o,l]=Ar(a);return at(r,{type:1,path:[...e,u].map(h=>h.toString()),value:o},l).then(ze)},apply(s,u,a){Ht(n);const o=e[e.length-1];if(o===Bs)return at(r,{type:4}).then(ze);if(o==="bind")return Cr(r,e.slice(0,-1));const[l,h]=Sn(a);return at(r,{type:2,path:e.map(c=>c.toString()),argumentList:l},h).then(ze)},construct(s,u){Ht(n);const[a,o]=Sn(u);return at(r,{type:3,path:e.map(l=>l.toString()),argumentList:a},o).then(ze)}});return i}function Is(r){return Array.prototype.concat.apply([],r)}function Sn(r){const e=r.map(Ar);return[e.map(t=>t[0]),Is(e.map(t=>t[1]))]}const kn=new WeakMap;function Ns(r,e){return kn.set(r,e),r}function Ls(r){return Object.assign(r,{[bn]:!0})}function Ar(r){for(const[e,t]of ut)if(t.canHandle(r)){const[n,i]=t.serialize(r);return[{type:3,name:e,value:n},i]}return[{type:0,value:r},kn.get(r)||[]]}function ze(r){switch(r.type){case 3:return ut.get(r.name).deserialize(r.value);case 0:return r.value}}function at(r,e,t){return new Promise(n=>{const i=Ms();r.addEventListener("message",function s(u){!u.data||!u.data.id||u.data.id!==i||(r.removeEventListener("message",s),n(u.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function Ms(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var jt,Hs=new Uint8Array(16);function js(){if(!jt&&(jt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!jt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return jt(Hs)}var Us=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ws(r){return typeof r=="string"&&Us.test(r)}for(var te=[],Fr=0;Fr<256;++Fr)te.push((Fr+256).toString(16).substr(1));function zs(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(te[r[e+0]]+te[r[e+1]]+te[r[e+2]]+te[r[e+3]]+"-"+te[r[e+4]]+te[r[e+5]]+"-"+te[r[e+6]]+te[r[e+7]]+"-"+te[r[e+8]]+te[r[e+9]]+"-"+te[r[e+10]]+te[r[e+11]]+te[r[e+12]]+te[r[e+13]]+te[r[e+14]]+te[r[e+15]]).toLowerCase();if(!Ws(t))throw TypeError("Stringified UUID is invalid");return t}function Gs(r,e,t){r=r||{};var n=r.random||(r.rng||js)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return zs(n)}class Bn{constructor(){this.listeners=new Set}get hasListeners(){return this.listeners.size>0}dispatch(e){this.listeners.forEach(t=>t(e))}on(e,t=!0){if(this.listeners.add(e),t)return{dispose:()=>{this.off(e)}}}off(e){this.listeners.delete(e)}once(e,t=!1){const n=i=>{e(i),this.off(n)};return this.on(n,t)}disposeListeners(){this.listeners=new Set}}class Ge extends Bn{constructor(e=1){super(),this.needsToFireAmount=e,this.firedTimes=0}get fired(){return new Promise(e=>this.once(e,!1))}get hasFired(){return this.firedTimes>=this.needsToFireAmount}setFiredTimes(e){this.firedTimes=e}resetSignal(){this.data=void 0,this.firedTimes=0}dispatch(e){if(this.firedTimes<this.needsToFireAmount&&this.firedTimes++,this.data=e,this.hasFired)return super.dispatch(e)}on(e,t=!0){return this.hasFired&&e(this.data),super.on(e,t)}}function qs(){if(!(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent))||!indexedDB.databases)return Promise.resolve();let e;return new Promise(t=>{const n=()=>indexedDB.databases().finally(t);e=setInterval(n,100),n()}).finally(()=>clearInterval(e))}function Ie(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function br(r,e){const t=qs().then(()=>{const n=indexedDB.open(r);return n.onupgradeneeded=()=>n.result.createObjectStore(e),Ie(n)});return(n,i)=>t.then(s=>i(s.transaction(e,n).objectStore(e)))}let xr;function qe(){return xr||(xr=br("keyval-store","keyval")),xr}function _r(r,e=qe()){return e("readonly",t=>Ie(t.get(r)))}function Sr(r,e,t=qe()){return t("readwrite",n=>(n.put(e,r),Ie(n.transaction)))}function Js(r,e=qe()){return e("readwrite",t=>(r.forEach(n=>t.put(n[1],n[0])),Ie(t.transaction)))}function Vs(r,e=qe()){return e("readonly",t=>Promise.all(r.map(n=>Ie(t.get(n)))))}function Ks(r,e=qe()){return e("readwrite",t=>(t.delete(r),Ie(t.transaction)))}function Xs(r=qe()){return r("readwrite",e=>(e.clear(),Ie(e.transaction)))}function Qs(r,e){return r("readonly",t=>(t.openCursor().onsuccess=function(){!this.result||(e(this.result),this.result.continue())},Ie(t.transaction)))}function Ys(r=qe()){const e=[];return Qs(r,t=>e.push(t.key)).then(()=>e)}const Zs=br("virtual-fs","virtual-fs-store"),eu=r=>_r(r,Zs);class vt{constructor(e="virtual-fs"){this.storeName=e,this.store=br(e,`${e}-store`)}set(e,t){return Sr(e,t,this.store)}get(e){return _r(e,this.store)}del(e){return Ks(e,this.store)}setMany(e){return Js(e,this.store)}getMany(e){return Vs(e,this.store)}clear(){return Xs(this.store)}async has(e){return await eu(e)!==void 0}keys(){return Ys(this.store)}}class Rn{constructor(e,t,n=[],i=Gs()){this._name=t,this.basePath=n,this.uuid=i,this._idbWrapper=null,this.parent=null,this.isVirtual=!0,this.setupDone=new Ge,e===null?this._idbWrapper=new vt:e instanceof vt?this._idbWrapper=e:this.parent=e}get path(){return this.parent?this.parent.path.concat(this.name):this.basePath}get hasParentContext(){return this.path.length>1}get idbKey(){return this.path.length===0?this._name:this.path.join("/")}get idbWrapper(){return this._idbWrapper===null?this.parent.idbWrapper:this._idbWrapper}get name(){return this._name}getParent(){return this.parent}async isSameEntry(e){return e.idbKey===this.idbKey}async queryPermission(e){return"granted"}async requestPermission(e){return"granted"}}const tu=new TextEncoder,Tn=Symbol("writeMethod");class ru{constructor(e){this.fileHandle=e,this.tmpData=new Uint8Array,this.cursorOffset=0,this.locked=!1}async write(e){let t;if(typeof e=="string")t=tu.encode(e);else if(e instanceof Blob)t=await e.arrayBuffer().then(n=>new Uint8Array(n));else if("type"in e){if(e.type==="seek")return await this.seek(e.position);if(e.type==="truncate")return await this.truncate(e.size);if(e.type==="write")return e.position&&await this.seek(e.position),await this.write(e.data);throw new Error(`Unknown data type: ${e.type}`)}else ArrayBuffer.isView(e)?t=new Uint8Array(e.buffer):t=new Uint8Array(e);this.tmpData=new Uint8Array([...this.tmpData.slice(0,this.cursorOffset),...t]),this.cursorOffset=this.tmpData.length}async seek(e){this.cursorOffset=Math.floor(e)}async truncate(e){this.tmpData=this.tmpData.slice(0,e),this.cursorOffset>e&&(this.cursorOffset=e)}async close(){await this.fileHandle[Tn](this.tmpData)}async abort(){throw new Error("WriteStream was aborted")}getWriter(){}}var kr=function(r,e){return kr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},kr(r,e)};function nu(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");kr(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function $n(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var Br,Ut=[],On=function(){function r(e){this.active=!0,this.effects=[],this.cleanups=[],this.vm=e}return r.prototype.run=function(e){if(this.active)try{return this.on(),e()}finally{this.off()}},r.prototype.on=function(){this.active&&(Ut.push(this),Br=this)},r.prototype.off=function(){this.active&&(Ut.pop(),Br=Ut[Ut.length-1])},r.prototype.stop=function(){this.active&&(this.vm.$destroy(),this.effects.forEach(function(e){return e.stop()}),this.cleanups.forEach(function(e){return e()}),this.active=!1)},r}();(function(r){nu(e,r);function e(t){t===void 0&&(t=!1);var n=this,i=void 0;return lu(function(){i=Hn(Gt())}),n=r.call(this,i)||this,t||iu(n),n}return e})(On);function iu(r,e){var t;if(e=e||Br,e&&e.active){e.effects.push(r);return}var n=(t=Ln())===null||t===void 0?void 0:t.proxy;n&&n.$on("hook:destroyed",function(){return r.stop()})}function su(r){if(!r.scope){var e=new On(r.proxy);r.scope=e,r.proxy.$on("hook:destroyed",function(){return e.stop()})}return r.scope}var Rr=void 0;try{var Je=require("vue");Je&&In(Je)?Rr=Je:Je&&"default"in Je&&In(Je.default)&&(Rr=Je.default)}catch{}var Wt=null,ot=null,zt=!0,Pn="__composition_api_installed__";function In(r){return r&&Ke(r)&&r.name==="Vue"}function uu(r){return Wt&&xe(r,Pn)}function Gt(){return Wt}function au(){var r=Wt||Rr;return r}function ou(r){Wt=r,Object.defineProperty(r,Pn,{configurable:!0,writable:!0,value:!0})}function lu(r){var e=zt;zt=!1;try{r()}finally{zt=e}}function Nn(r){if(!!zt){var e=ot;e==null||e.scope.off(),ot=r,ot==null||ot.scope.on()}}function Ln(){return ot}var Tr=new WeakMap;function qt(r){if(Tr.has(r))return Tr.get(r);var e={proxy:r,update:r.$forceUpdate,type:r.$options,uid:r._uid,emit:r.$emit.bind(r),parent:null,root:null};su(e);var t=["data","props","attrs","refs","vnode","slots"];return t.forEach(function(n){he(e,n,{get:function(){return r["$".concat(n)]}})}),he(e,"isMounted",{get:function(){return r._isMounted}}),he(e,"isUnmounted",{get:function(){return r._isDestroyed}}),he(e,"isDeactivated",{get:function(){return r._inactive}}),he(e,"emitted",{get:function(){return r._events}}),Tr.set(r,e),r.$parent&&(e.parent=qt(r.$parent)),r.$root&&(e.root=qt(r.$root)),e}var cu=function(r){return Object.prototype.toString.call(r)};function Mn(r){return typeof r=="function"&&/native code/.test(r.toString())}var hu=typeof Symbol<"u"&&Mn(Symbol)&&typeof Reflect<"u"&&Mn(Reflect.ownKeys),lt=function(r){return r};function he(r,e,t){var n=t.get,i=t.set;Object.defineProperty(r,e,{enumerable:!0,configurable:!0,get:n||lt,set:i||lt})}function $r(r,e,t,n){Object.defineProperty(r,e,{value:t,enumerable:!!n,writable:!0,configurable:!0})}function xe(r,e){return Object.hasOwnProperty.call(r,e)}function Ve(r){return Array.isArray(r)}var fu=4294967295;function du(r){var e=parseFloat(String(r));return e>=0&&Math.floor(e)===e&&isFinite(r)&&e<=fu}function Jt(r){return r!==null&&typeof r=="object"}function _e(r){return cu(r)==="[object Object]"}function Ke(r){return typeof r=="function"}function Hn(r,e){e===void 0&&(e={});var t=r.config.silent;r.config.silent=!0;var n=new r(e);return r.config.silent=t,n}function pu(r){var e=Gt();return e&&r instanceof e}function gu(r,e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(!!r.$scopedSlots[e])return r.$scopedSlots[e].apply(r,t)}}function Du(r,e){var t;if(!r)t={};else{if(r._normalized)return r._normalized;t={};for(var n in r)r[n]&&n[0]!=="$"&&(t[n]=!0)}for(var n in e)n in t||(t[n]=!0);return t}var wt="composition-api.refKey",jn=new WeakMap,mu=new WeakMap,Eu=new WeakMap;function yu(r,e,t){var n=Gt(),i=n.util;i.warn;var s=i.defineReactive,u=r.__ob__;function a(){u&&Jt(t)&&!xe(t,"__ob__")&&Ir(t)}if(Ve(r)){if(du(e))return r.length=Math.max(r.length,e),r.splice(e,1,t),a(),t;if(e==="length"&&t!==r.length)return r.length=t,u==null||u.dep.notify(),t}return e in r&&!(e in Object.prototype)?(r[e]=t,a(),t):r._isVue||u&&u.vmCount?t:u?(s(u.value,e,t),Gn(r,e,t),a(),u.dep.notify(),t):(r[e]=t,t)}var Un=function(){function r(e){var t=e.get,n=e.set;he(this,"value",{get:t,set:n})}return r}();function Wn(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=new Un(r);t&&(n.effect=!0);var i=Object.seal(n);return e&&Eu.set(i,!0),i}function zn(r){var e;if(le(r))return r;var t=Vn((e={},e[wt]=r,e));return Wn({get:function(){return t[wt]},set:function(n){return t[wt]=n}})}function le(r){return r instanceof Un}function vu(r){if(!_e(r))return r;var e={};for(var t in r)e[t]=wu(r,t);return e}function wu(r,e){e in r||yu(r,e,void 0);var t=r[e];return le(t)?t:Wn({get:function(){return r[e]},set:function(n){return r[e]=n}})}var Or="__v_skip";function ct(r){var e;return Boolean(r&&xe(r,"__ob__")&&typeof r.__ob__=="object"&&((e=r.__ob__)===null||e===void 0?void 0:e[Or]))}function Ct(r){var e;return Boolean(r&&xe(r,"__ob__")&&typeof r.__ob__=="object"&&!(!((e=r.__ob__)===null||e===void 0)&&e[Or]))}function Pr(r){if(!(!_e(r)||ct(r)||Ve(r)||le(r)||pu(r)||jn.has(r))){jn.set(r,!0);for(var e=Object.keys(r),t=0;t<e.length;t++)Gn(r,e[t])}}function Gn(r,e,t){if(e!=="__ob__"&&!ct(r[e])){var n,i,s=Object.getOwnPropertyDescriptor(r,e);if(s){if(s.configurable===!1)return;n=s.get,i=s.set,(!n||i)&&arguments.length===2&&(t=r[e])}Pr(t),he(r,e,{get:function(){var a=n?n.call(r):t;return e!==wt&&le(a)?a.value:a},set:function(a){n&&!i||(e!==wt&&le(t)&&!le(a)?t.value=a:(i&&i.call(r,a),t=a),Pr(a))}})}}function qn(r){var e=au(),t;if(e.observable)t=e.observable(r);else{var n=Hn(e,{data:{$$state:r}});t=n._data.$$state}return xe(t,"__ob__")||Ir(t),t}function Ir(r,e){var t,n;if(e===void 0&&(e=new Set),!(e.has(r)||xe(r,"__ob__")||!Object.isExtensible(r))){$r(r,"__ob__",Cu(r)),e.add(r);try{for(var i=$n(Object.keys(r)),s=i.next();!s.done;s=i.next()){var u=s.value,a=r[u];!(_e(a)||Ve(a))||ct(a)||!Object.isExtensible(a)||Ir(a,e)}}catch(o){t={error:o}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}function Cu(r){return r===void 0&&(r={}),{value:r,dep:{notify:lt,depend:lt,addSub:lt,removeSub:lt}}}function Jn(){return qn({}).__ob__}function Vn(r){if(!Jt(r)||!(_e(r)||Ve(r))||ct(r)||!Object.isExtensible(r))return r;var e=qn(r);return Pr(e),e}function Au(r){if(!(_e(r)||Ve(r))||!Object.isExtensible(r))return r;var e=Jn();return e[Or]=!0,$r(r,"__ob__",e),mu.set(r,!0),r}function Fu(r,e,t){var n=r.__composition_api_state__=r.__composition_api_state__||{};n[e]=t}function bu(r,e){return(r.__composition_api_state__||{})[e]}var Ne={set:Fu,get:bu};function xu(r,e,t){var n=r.$options.props;!(e in r)&&!(n&&xe(n,e))&&(le(t)?he(r,e,{get:function(){return t.value},set:function(i){t.value=i}}):he(r,e,{get:function(){return Ct(t)&&t.__ob__.dep.depend(),t},set:function(i){t=i}}))}function _u(r){var e=Ne.get(r,"rawBindings")||{};if(!(!e||!Object.keys(e).length)){for(var t=r.$refs,n=Ne.get(r,"refs")||[],i=0;i<n.length;i++){var s=n[i],u=e[s];!t[s]&&u&&le(u)&&(u.value=null)}for(var a=Object.keys(t),o=[],i=0;i<a.length;i++){var s=a[i],u=e[s];t[s]&&u&&le(u)&&(u.value=t[s],o.push(s))}Ne.set(r,"refs",o)}}function Kn(r){for(var e=[r._vnode];e.length;){var t=e.pop();if(t&&(t.context&&_u(t.context),t.children))for(var n=0;n<t.children.length;++n)e.push(t.children[n])}}function Xn(r,e){var t,n;if(!!r){var i=Ne.get(r,"attrBindings");if(!(!i&&!e)){if(!i){var s=Vn({});i={ctx:e,data:s},Ne.set(r,"attrBindings",i),he(e,"attrs",{get:function(){return i==null?void 0:i.data},set:function(){}})}var u=r.$attrs,a=function(c){xe(i.data,c)||he(i.data,c,{get:function(){return r.$attrs[c]}})};try{for(var o=$n(Object.keys(u)),l=o.next();!l.done;l=o.next()){var h=l.value;a(h)}}catch(c){t={error:c}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}}}function Qn(r,e){var t=r.$options._parentVnode;if(!!t){for(var n=Ne.get(r,"slots")||[],i=Du(t.data.scopedSlots,r.$slots),s=0;s<n.length;s++){var u=n[s];i[u]||delete e[u]}for(var a=Object.keys(i),s=0;s<a.length;s++){var u=a[s];e[u]||(e[u]=gu(r,u))}Ne.set(r,"slots",a)}}function Nr(r,e,t){var n=Ln();Nn(r);try{return e(r)}catch(i){if(t)t(i);else throw i}finally{Nn(n)}}function Su(r){r.mixin({beforeCreate:e,mounted:function(){Kn(this)},beforeUpdate:function(){Xn(this)},updated:function(){Kn(this)}});function e(){var u=this,a=u.$options,o=a.setup,l=a.render;if(l&&(a.render=function(){for(var c=this,f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];return Nr(qt(u),function(){return l.apply(c,f)})}),!!o&&!!Ke(o)){var h=a.data;a.data=function(){return t(u,u.$props),Ke(h)?h.call(u,u):h||{}}}}function t(u,a){a===void 0&&(a={});var o=u.$options.setup,l=s(u),h=qt(u);h.setupContext=l,$r(a,"__ob__",Jn()),Qn(u,l.slots);var c;if(Nr(h,function(){c=o(a,l)}),!!c){if(Ke(c)){var f=c;u.$options.render=function(){return Qn(u,l.slots),Nr(h,function(){return f()})};return}else if(Jt(c)){Ct(c)&&(c=vu(c)),Ne.set(u,"rawBindings",c);var g=c;Object.keys(g).forEach(function(C){var m=g[C];if(!le(m))if(Ct(m))Ve(m)&&(m=zn(m));else if(Ke(m)){var d=m;m=m.bind(u),Object.keys(d).forEach(function(p){m[p]=d[p]})}else Jt(m)?i(m)&&n(m):m=zn(m);xu(u,C,m)});return}}}function n(u,a){if(a===void 0&&(a=new Set),!a.has(u)&&!(!_e(u)||le(u)||Ct(u)||ct(u))){var o=Gt(),l=o.util.defineReactive;Object.keys(u).forEach(function(h){var c=u[h];l(u,h,c),c&&(a.add(c),n(c,a))})}}function i(u,a){return a===void 0&&(a=new Map),a.has(u)?a.get(u):(a.set(u,!1),Ve(u)&&Ct(u)?(a.set(u,!0),!0):!_e(u)||ct(u)||le(u)?!1:Object.keys(u).some(function(o){return i(u[o],a)}))}function s(u){var a={slots:{}},o=["root","parent","refs","listeners","isServer","ssrContext"],l=["emit"];return o.forEach(function(h){var c="$".concat(h);he(a,h,{get:function(){return u[c]},set:function(){}})}),Xn(u,a),l.forEach(function(h){var c="$".concat(h);he(a,h,{get:function(){return function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];var C=u[c];C.apply(u,f)}}})}),a}}function Yn(r,e){if(!r)return e;if(!e)return r;for(var t,n,i,s=hu?Reflect.ownKeys(r):Object.keys(r),u=0;u<s.length;u++)t=s[u],t!=="__ob__"&&(n=e[t],i=r[t],xe(e,t)?n!==i&&_e(n)&&!le(n)&&_e(i)&&!le(i)&&Yn(i,n):e[t]=i);return e}function ku(r){uu(r)||(r.config.optionMergeStrategies.setup=function(e,t){return function(i,s){return Yn(Ke(e)?e(i,s)||{}:void 0,Ke(t)?t(i,s)||{}:void 0)}},ou(r),Su(r))}var Bu={install:function(r){return ku(r)}};typeof window<"u"&&window.Vue&&window.Vue.use(Bu);class ye extends Rn{constructor(e,t,n,i=!1,s){super(e,t,s),this.inMemory=i,this.kind="file",this.isFile=!0,this.isDirectory=!1,n?this.setup(n):this.setupDone.dispatch()}get isFileStoredInMemory(){return this.fileData!==void 0}moveData(){if(!this.fileData)throw new Error(`No file data to move to IDB for file "${this.name}"`);const e=this.fileData;return this.fileData=void 0,this.inMemory=!1,e}async setup(e){this.fileData=globalThis.document?Au(e):e;const t=this.path.join("/").startsWith("data/packages");if(this.inMemory||t&&e.length<5e4)return this.inMemory=!0,this.setupDone.dispatch();(!t||globalThis.document)&&await this.updateIdb(e),this.setupDone.dispatch()}async updateIdb(e){await this.idbWrapper.set(this.idbKey,e),this.fileData=void 0}async loadFromIdb(){if(this.fileData)return this.fileData;let e=await this.idbWrapper.get(this.idbKey);if(e===void 0)throw console.log(this.parent),new Error(`File not found: "${this.path.join("/")}"`);return e}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"file",name:this.name,path:this.path,fileData:this.fileData}}static deserialize(e){return new ye(e.idbWrapper?new vt(e.idbWrapper):null,e.name,e.fileData,e.fileData!==void 0,e.path)}async isSameEntry(e){return this.parent===null?!1:super.isSameEntry(e)}async removeSelf(e=!0){await this.idbWrapper.del(this.idbKey),this.parent&&e&&this.parent.deleteChild(this.name)}async getFile(){const e=await this.loadFromIdb();return new File([e],this.name)}async createWritable(){return new ru(this)}async[Tn](e){this.inMemory?this.fileData=e:await this.updateIdb(e)}}class fe extends Rn{constructor(e,t,n,i=!1,s=[]){super(e,t,s),this.children=n,this.kind="directory",this.isDirectory=!0,this.isFile=!1,this.updateIdb(i)}get isDirectoryInMemory(){return this.children!==void 0}async moveToIdb(){const e=this.allInMemoryChildren();this.idbWrapper.setMany(e.map(t=>[t.idbKey,t.moveData()]))}moveData(){if(!this.children)throw new Error(`No directory data to move to IDB for directory "${this.name}"`);const e=[...this.children.values()].map(t=>t.name);return this.children=void 0,e}allInMemoryChildren(){if(!this.children)return[];const e=[this];for(const t of this.children.values())t instanceof fe?t.isDirectoryInMemory&&e.push(...t.allInMemoryChildren()):t.isFileStoredInMemory&&e.push(t);return e}async updateIdb(e=!1){e&&await this.idbWrapper.clear(),!this.children&&!await this.hasChildren()&&await this.idbWrapper.set(this.idbKey,[]),this.setupDone.dispatch()}async addChild(e){await this.has(e.name)||(this.children?this.children.set(e.name,e):await this.idbWrapper.set(this.idbKey,[...await this.fromIdb(),e.name]))}async fromIdb(){var e;return(e=await this.idbWrapper.get(this.idbKey))!=null?e:[]}async getChildren(){return this.children?[...this.children.values()]:await Promise.all((await this.fromIdb()).map(e=>this.getChild(e)).filter(e=>e!==void 0))}getChildPath(e){return this.path.concat(e).join("/")}async getChild(e){if(this.children)return this.children.get(e);if(await this.has(e)){const t=await this.idbWrapper.get(this.getChildPath(e));if(t instanceof Uint8Array)return new ye(this,e);if(Array.isArray(t))return new fe(this,e)}}async deleteChild(e){this.children?this.children.delete(e):await this.idbWrapper.set(this.idbKey,(await this.fromIdb()).filter(t=>t!==e))}async hasChildren(){return this.children?this.children.size>0:(await this.fromIdb()).length>0}async has(e){return this.children?this.children.has(e):(await this.fromIdb()).includes(e)}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"directory",name:this.name,path:this.path,children:this.children?[...this.children.values()].map(e=>e.serialize()):void 0}}static deserialize(e,t=null){var i;const n=new fe(t||new vt(e.idbWrapper),e.name,void 0,!1,e.path);for(const s of(i=e.children)!=null?i:[])s.kind==="directory"?n.addChild(fe.deserialize(s,n)):n.addChild(new ye(n,s.name,s.fileData));return n}async getDirectoryHandle(e,{create:t}={}){let n=await this.getChild(e);if(n&&n.kind==="file")throw new Error(`TypeMismatch: Expected directory with name "${e}", found file`);if(!n)if(t)n=new fe(this,e,this.children?new Map:void 0),await n.setupDone.fired,await this.addChild(n);else throw new Error(`No file with the name ${e} exists in this folder`);return n}async getFileHandle(e,{create:t,initialData:n}={}){let i=await this.getChild(e);if(i&&i.kind==="directory")throw new Error(`TypeMismatch: Expected file with name "${e}", found directory`);if(!i)if(t)i=new ye(this,e,n!=null?n:new Uint8Array),await i.setupDone.fired,await this.addChild(i);else throw new Error(`No file with the name ${e} exists in this folder`);return i}async removeEntry(e,{recursive:t}={}){const n=await this.getChild(e);if(n){if(n.kind==="directory"&&!t&&await n.hasChildren())throw new Error('Cannot remove directory with children without "recursive" option being set to true')}else throw new Error(`No entry with the name ${e} exists in this folder`);await n.removeSelf(),await this.deleteChild(e)}async resolve(e){const t=[e.name];let n=e.getParent();for(;n!==null&&!await n.isSameEntry(this);)t.unshift(n.name),n=n.getParent();return n===null?null:t}async removeSelf(e=!0){const t=await this.getChildren();for(const n of t)await n.removeSelf(!1);this.children||await this.idbWrapper.del(this.idbKey),this.parent&&e&&this.parent.deleteChild(this.name)}[Symbol.asyncIterator](){return this.entries()}keys(){return this.children?this.children.keys():{childNamesPromise:this.fromIdb(),[Symbol.asyncIterator](){return{i:0,childNamesPromise:this.childNamesPromise,async next(){const e=await this.childNamesPromise;return this.i<e.length?{done:!1,value:e[this.i++]}:{done:!0}}}}}}entries(){return this.children?this.children.entries():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const e=await this.childrenPromise;return this.i<e.length?{done:!1,value:[e[this.i].name,e[this.i++]]}:{done:!0}}}}}}values(){return this.children?this.children.values():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const e=await this.childrenPromise;return this.i<e.length?{done:!1,value:e[this.i++]}:{done:!0}}}}}}getEntries(){return this.values()}getDirectory(e,t={}){return this.getDirectoryHandle(e,t)}getFile(e,t={}){return this.getFileHandle(e,t)}}ut.set("VirtualFileHandle",{canHandle:r=>r instanceof ye,serialize:r=>[r.serialize(),[]],deserialize:r=>new ye(null,r.name,r.fileData)}),ut.set("VirtualDirectoryHandle",{canHandle:r=>r instanceof fe,serialize:r=>[r.serialize(),[]],deserialize:r=>fe.deserialize(r)}),ut.set("VirtualDirectoryHandleArray",{canHandle:r=>Array.isArray(r)&&r.every(({directory:e})=>e instanceof fe),serialize:r=>[r.map(({directory:e,...t})=>({directory:e.serialize(),...t})),[]],deserialize:r=>r.map(({directory:e,...t})=>({directory:fe.deserialize(e),...t}))}),ut.set("VirtualFileHandleArray",{canHandle:r=>Array.isArray(r)&&r.every(({fileHandle:e})=>e instanceof ye),serialize:r=>[r.map(({fileHandle:e,...t})=>({fileHandle:e.serialize(),...t})),[]],deserialize:r=>r.map(({fileHandle:e,...t})=>({fileHandle:ye.deserialize(e),...t}))});var Ru=Object.defineProperty,Tu=Object.defineProperties,$u=Object.getOwnPropertyDescriptors,Zn=Object.getOwnPropertySymbols,Ou=Object.prototype.hasOwnProperty,Pu=Object.prototype.propertyIsEnumerable,ei=(r,e,t)=>e in r?Ru(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ht=(r,e)=>{for(var t in e||(e={}))Ou.call(e,t)&&ei(r,t,e[t]);if(Zn)for(var t of Zn(e))Pu.call(e,t)&&ei(r,t,e[t]);return r},Vt=(r,e)=>Tu(r,$u(e));function ti(r,e){for(var t=0,n=r.length-1;n>=0;n--){var i=r[n];i==="."?r.splice(n,1):i===".."?(r.splice(n,1),t++):t&&(r.splice(n,1),t--)}if(e)for(;t--;t)r.unshift("..");return r}var Iu=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Lr=function(r){return Iu.exec(r).slice(1)};function Kt(){for(var r="",e=!1,t=arguments.length-1;t>=-1&&!e;t--){var n=t>=0?arguments[t]:"/";if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)continue;r=n+"/"+r,e=n.charAt(0)==="/"}return r=ti(jr(r.split("/"),function(i){return!!i}),!e).join("/"),(e?"/":"")+r||"."}function Mr(r){var e=Hr(r),t=Lu(r,-1)==="/";return r=ti(jr(r.split("/"),function(n){return!!n}),!e).join("/"),!r&&!e&&(r="."),r&&t&&(r+="/"),(e?"/":"")+r}function Hr(r){return r.charAt(0)==="/"}function ri(){var r=Array.prototype.slice.call(arguments,0);return Mr(jr(r,function(e,t){if(typeof e!="string")throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function ni(r,e){r=Kt(r).substr(1),e=Kt(e).substr(1);function t(l){for(var h=0;h<l.length&&l[h]==="";h++);for(var c=l.length-1;c>=0&&l[c]==="";c--);return h>c?[]:l.slice(h,c-h+1)}for(var n=t(r.split("/")),i=t(e.split("/")),s=Math.min(n.length,i.length),u=s,a=0;a<s;a++)if(n[a]!==i[a]){u=a;break}for(var o=[],a=u;a<n.length;a++)o.push("..");return o=o.concat(i.slice(u)),o.join("/")}var ii="/",si=":";function ui(r){var e=Lr(r),t=e[0],n=e[1];return!t&&!n?".":(n&&(n=n.substr(0,n.length-1)),t+n)}function ai(r,e){var t=Lr(r)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t}function oi(r){return Lr(r)[3]}var Nu={extname:oi,basename:ai,dirname:ui,sep:ii,delimiter:si,relative:ni,join:ri,isAbsolute:Hr,normalize:Mr,resolve:Kt};function jr(r,e){if(r.filter)return r.filter(e);for(var t=[],n=0;n<r.length;n++)e(r[n],n,r)&&t.push(r[n]);return t}var Lu="ab".substr(-1)==="b"?function(r,e,t){return r.substr(e,t)}:function(r,e,t){return e<0&&(e=r.length+e),r.substr(e,t)},Ur=Object.freeze({__proto__:null,resolve:Kt,normalize:Mr,isAbsolute:Hr,join:ri,relative:ni,sep:ii,delimiter:si,dirname:ui,basename:ai,extname:oi,default:Nu});function li(){throw new Error("setTimeout has not been defined")}function ci(){throw new Error("clearTimeout has not been defined")}var Le=li,Me=ci,ft;typeof window<"u"?ft=window:typeof self<"u"?ft=self:ft={},typeof ft.setTimeout=="function"&&(Le=setTimeout),typeof ft.clearTimeout=="function"&&(Me=clearTimeout);function hi(r){if(Le===setTimeout)return setTimeout(r,0);if((Le===li||!Le)&&setTimeout)return Le=setTimeout,setTimeout(r,0);try{return Le(r,0)}catch{try{return Le.call(null,r,0)}catch{return Le.call(this,r,0)}}}function Mu(r){if(Me===clearTimeout)return clearTimeout(r);if((Me===ci||!Me)&&clearTimeout)return Me=clearTimeout,clearTimeout(r);try{return Me(r)}catch{try{return Me.call(null,r)}catch{return Me.call(this,r)}}}var Se=[],dt=!1,Xe,Xt=-1;function Hu(){!dt||!Xe||(dt=!1,Xe.length?Se=Xe.concat(Se):Xt=-1,Se.length&&fi())}function fi(){if(!dt){var r=hi(Hu);dt=!0;for(var e=Se.length;e;){for(Xe=Se,Se=[];++Xt<e;)Xe&&Xe[Xt].run();Xt=-1,e=Se.length}Xe=null,dt=!1,Mu(r)}}function ju(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];Se.push(new di(r,e)),Se.length===1&&!dt&&hi(fi)}function di(r,e){this.fun=r,this.array=e}di.prototype.run=function(){this.fun.apply(null,this.array)};var Uu="browser",Wu="browser",zu=!0,Gu=[],qu="",Ju={},Vu={},Ku={};function Qe(){}var Xu=Qe,Qu=Qe,Yu=Qe,Zu=Qe,ea=Qe,ta=Qe,ra=Qe;function na(r){throw new Error("process.binding is not supported")}function ia(){return"/"}function sa(r){throw new Error("process.chdir is not supported")}function ua(){return 0}var pt=ft.performance||{},aa=pt.now||pt.mozNow||pt.msNow||pt.oNow||pt.webkitNow||function(){return new Date().getTime()};function oa(r){var e=aa.call(pt)*.001,t=Math.floor(e),n=Math.floor(e%1*1e9);return r&&(t=t-r[0],n=n-r[1],n<0&&(t--,n+=1e9)),[t,n]}var la=new Date;function ca(){var r=new Date,e=r-la;return e/1e3}var ha={nextTick:ju,title:Uu,browser:zu,env:{NODE_ENV:"production"},argv:Gu,version:qu,versions:Ju,on:Xu,addListener:Qu,once:Yu,off:Zu,removeListener:ea,removeAllListeners:ta,emit:ra,binding:na,cwd:ia,chdir:sa,umask:ua,hrtime:oa,platform:Wu,release:Vu,config:Ku,uptime:ca};function fa(r,e,t){return t={path:e,exports:{},require:function(n,i){return da(n,i==null?t.path:i)}},r(t,t.exports),t.exports}function da(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}const ve="\\\\/",pi=`[^${ve}]`,ke="\\.",pa="\\+",ga="\\?",Qt="\\/",Da="(?=.)",gi="[^/]",Wr=`(?:${Qt}|$)`,Di=`(?:^|${Qt})`,zr=`${ke}{1,2}${Wr}`,ma=`(?!${ke})`,Ea=`(?!${Di}${zr})`,ya=`(?!${ke}{0,1}${Wr})`,va=`(?!${zr})`,wa=`[^.${Qt}]`,Ca=`${gi}*?`,mi={DOT_LITERAL:ke,PLUS_LITERAL:pa,QMARK_LITERAL:ga,SLASH_LITERAL:Qt,ONE_CHAR:Da,QMARK:gi,END_ANCHOR:Wr,DOTS_SLASH:zr,NO_DOT:ma,NO_DOTS:Ea,NO_DOT_SLASH:ya,NO_DOTS_SLASH:va,QMARK_NO_DOT:wa,STAR:Ca,START_ANCHOR:Di},Aa=Vt(ht({},mi),{SLASH_LITERAL:`[${ve}]`,QMARK:pi,STAR:`${pi}*?`,DOTS_SLASH:`${ke}{1,2}(?:[${ve}]|$)`,NO_DOT:`(?!${ke})`,NO_DOTS:`(?!(?:^|[${ve}])${ke}{1,2}(?:[${ve}]|$))`,NO_DOT_SLASH:`(?!${ke}{0,1}(?:[${ve}]|$))`,NO_DOTS_SLASH:`(?!${ke}{1,2}(?:[${ve}]|$))`,QMARK_NO_DOT:`[^.${ve}]`,START_ANCHOR:`(?:^|[${ve}])`,END_ANCHOR:`(?:[${ve}]|$)`}),Fa={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};var Ye={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:Fa,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:Ur.sep,extglobChars(r){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${r.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(r){return r===!0?Aa:mi}},Z=fa(function(r,e){const{REGEX_BACKSLASH:t,REGEX_REMOVE_BACKSLASH:n,REGEX_SPECIAL_CHARS:i,REGEX_SPECIAL_CHARS_GLOBAL:s}=Ye;e.isObject=u=>u!==null&&typeof u=="object"&&!Array.isArray(u),e.hasRegexChars=u=>i.test(u),e.isRegexChar=u=>u.length===1&&e.hasRegexChars(u),e.escapeRegex=u=>u.replace(s,"\\$1"),e.toPosixSlashes=u=>u.replace(t,"/"),e.removeBackslashes=u=>u.replace(n,a=>a==="\\"?"":a),e.supportsLookbehinds=()=>{const u=ha.version.slice(1).split(".").map(Number);return u.length===3&&u[0]>=9||u[0]===8&&u[1]>=10},e.isWindows=u=>u&&typeof u.windows=="boolean"?u.windows:Ur.sep==="\\",e.escapeLast=(u,a,o)=>{const l=u.lastIndexOf(a,o);return l===-1?u:u[l-1]==="\\"?e.escapeLast(u,a,l-1):`${u.slice(0,l)}\\${u.slice(l)}`},e.removePrefix=(u,a={})=>{let o=u;return o.startsWith("./")&&(o=o.slice(2),a.prefix="./"),o},e.wrapOutput=(u,a={},o={})=>{const l=o.contains?"":"^",h=o.contains?"":"$";let c=`${l}(?:${u})${h}`;return a.negated===!0&&(c=`(?:^(?!${c}).*$)`),c}});const{CHAR_ASTERISK:Gr,CHAR_AT:ba,CHAR_BACKWARD_SLASH:At,CHAR_COMMA:xa,CHAR_DOT:qr,CHAR_EXCLAMATION_MARK:Jr,CHAR_FORWARD_SLASH:Ei,CHAR_LEFT_CURLY_BRACE:Vr,CHAR_LEFT_PARENTHESES:Kr,CHAR_LEFT_SQUARE_BRACKET:_a,CHAR_PLUS:Sa,CHAR_QUESTION_MARK:yi,CHAR_RIGHT_CURLY_BRACE:ka,CHAR_RIGHT_PARENTHESES:vi,CHAR_RIGHT_SQUARE_BRACKET:Ba}=Ye,wi=r=>r===Ei||r===At,Ci=r=>{r.isPrefix!==!0&&(r.depth=r.isGlobstar?1/0:1)};var Ra=(r,e)=>{const t=e||{},n=r.length-1,i=t.parts===!0||t.scanToEnd===!0,s=[],u=[],a=[];let o=r,l=-1,h=0,c=0,f=!1,g=!1,C=!1,m=!1,d=!1,p=!1,w=!1,F=!1,A=!1,b=!1,x=0,B,_,R={value:"",depth:0,isGlob:!1};const q=()=>l>=n,y=()=>o.charCodeAt(l+1),H=()=>(B=_,o.charCodeAt(++l));for(;l<n;){_=H();let ne;if(_===At){w=R.backslashes=!0,_=H(),_===Vr&&(p=!0);continue}if(p===!0||_===Vr){for(x++;q()!==!0&&(_=H());){if(_===At){w=R.backslashes=!0,H();continue}if(_===Vr){x++;continue}if(p!==!0&&_===qr&&(_=H())===qr){if(f=R.isBrace=!0,C=R.isGlob=!0,b=!0,i===!0)continue;break}if(p!==!0&&_===xa){if(f=R.isBrace=!0,C=R.isGlob=!0,b=!0,i===!0)continue;break}if(_===ka&&(x--,x===0)){p=!1,f=R.isBrace=!0,b=!0;break}}if(i===!0)continue;break}if(_===Ei){if(s.push(l),u.push(R),R={value:"",depth:0,isGlob:!1},b===!0)continue;if(B===qr&&l===h+1){h+=2;continue}c=l+1;continue}if(t.noext!==!0&&(_===Sa||_===ba||_===Gr||_===yi||_===Jr)===!0&&y()===Kr){if(C=R.isGlob=!0,m=R.isExtglob=!0,b=!0,_===Jr&&l===h&&(A=!0),i===!0){for(;q()!==!0&&(_=H());){if(_===At){w=R.backslashes=!0,_=H();continue}if(_===vi){C=R.isGlob=!0,b=!0;break}}continue}break}if(_===Gr){if(B===Gr&&(d=R.isGlobstar=!0),C=R.isGlob=!0,b=!0,i===!0)continue;break}if(_===yi){if(C=R.isGlob=!0,b=!0,i===!0)continue;break}if(_===_a){for(;q()!==!0&&(ne=H());){if(ne===At){w=R.backslashes=!0,H();continue}if(ne===Ba){g=R.isBracket=!0,C=R.isGlob=!0,b=!0;break}}if(i===!0)continue;break}if(t.nonegate!==!0&&_===Jr&&l===h){F=R.negated=!0,h++;continue}if(t.noparen!==!0&&_===Kr){if(C=R.isGlob=!0,i===!0){for(;q()!==!0&&(_=H());){if(_===Kr){w=R.backslashes=!0,_=H();continue}if(_===vi){b=!0;break}}continue}break}if(C===!0){if(b=!0,i===!0)continue;break}}t.noext===!0&&(m=!1,C=!1);let I=o,pe="",E="";h>0&&(pe=o.slice(0,h),o=o.slice(h),c-=h),I&&C===!0&&c>0?(I=o.slice(0,c),E=o.slice(c)):C===!0?(I="",E=o):I=o,I&&I!==""&&I!=="/"&&I!==o&&wi(I.charCodeAt(I.length-1))&&(I=I.slice(0,-1)),t.unescape===!0&&(E&&(E=Z.removeBackslashes(E)),I&&w===!0&&(I=Z.removeBackslashes(I)));const D={prefix:pe,input:r,start:h,base:I,glob:E,isBrace:f,isBracket:g,isGlob:C,isExtglob:m,isGlobstar:d,negated:F,negatedExtglob:A};if(t.tokens===!0&&(D.maxDepth=0,wi(_)||u.push(R),D.tokens=u),t.parts===!0||t.tokens===!0){let ne;for(let M=0;M<s.length;M++){const ce=ne?ne+1:h,ie=s[M],ue=r.slice(ce,ie);t.tokens&&(M===0&&h!==0?(u[M].isPrefix=!0,u[M].value=pe):u[M].value=ue,Ci(u[M]),D.maxDepth+=u[M].depth),(M!==0||ue!=="")&&a.push(ue),ne=ie}if(ne&&ne+1<r.length){const M=r.slice(ne+1);a.push(M),t.tokens&&(u[u.length-1].value=M,Ci(u[u.length-1]),D.maxDepth+=u[u.length-1].depth)}D.slashes=s,D.parts=a}return D};const{MAX_LENGTH:Yt,POSIX_REGEX_SOURCE:Ta,REGEX_NON_SPECIAL_CHARS:$a,REGEX_SPECIAL_CHARS_BACKREF:Oa,REPLACEMENTS:Ai}=Ye,Pa=(r,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...r,e);r.sort();const t=`[${r.join("-")}]`;try{new RegExp(t)}catch{return r.map(i=>Z.escapeRegex(i)).join("..")}return t},gt=(r,e)=>`Missing ${r}: "${e}" - use "\\\\${e}" to match literal characters`,Fi=(r,e)=>{if(typeof r!="string")throw new TypeError("Expected a string");r=Ai[r]||r;const t=ht({},e),n=typeof t.maxLength=="number"?Math.min(Yt,t.maxLength):Yt;let i=r.length;if(i>n)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${n}`);const s={type:"bos",value:"",output:t.prepend||""},u=[s],a=t.capture?"":"?:",o=Z.isWindows(e),l=Ye.globChars(o),h=Ye.extglobChars(l),{DOT_LITERAL:c,PLUS_LITERAL:f,SLASH_LITERAL:g,ONE_CHAR:C,DOTS_SLASH:m,NO_DOT:d,NO_DOT_SLASH:p,NO_DOTS_SLASH:w,QMARK:F,QMARK_NO_DOT:A,STAR:b,START_ANCHOR:x}=l,B=k=>`(${a}(?:(?!${x}${k.dot?m:c}).)*?)`,_=t.dot?"":d,R=t.dot?F:A;let q=t.bash===!0?B(t):b;t.capture&&(q=`(${q})`),typeof t.noext=="boolean"&&(t.noextglob=t.noext);const y={input:r,index:-1,start:0,dot:t.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:u};r=Z.removePrefix(r,y),i=r.length;const H=[],I=[],pe=[];let E=s,D;const ne=()=>y.index===i-1,M=y.peek=(k=1)=>r[y.index+k],ce=y.advance=()=>r[++y.index]||"",ie=()=>r.slice(y.index+1),ue=(k="",J=0)=>{y.consumed+=k,y.index+=J},Fe=k=>{y.output+=k.output!=null?k.output:k.value,ue(k.value)},Mt=()=>{let k=1;for(;M()==="!"&&(M(2)!=="("||M(3)==="?");)ce(),y.start++,k++;return k%2===0?!1:(y.negated=!0,y.start++,!0)},We=k=>{y[k]++,pe.push(k)},be=k=>{y[k]--,pe.pop()},P=k=>{if(E.type==="globstar"){const J=y.braces>0&&(k.type==="comma"||k.type==="brace"),S=k.extglob===!0||H.length&&(k.type==="pipe"||k.type==="paren");k.type!=="slash"&&k.type!=="paren"&&!J&&!S&&(y.output=y.output.slice(0,-E.output.length),E.type="star",E.value="*",E.output=q,y.output+=E.output)}if(H.length&&k.type!=="paren"&&(H[H.length-1].inner+=k.value),(k.value||k.output)&&Fe(k),E&&E.type==="text"&&k.type==="text"){E.value+=k.value,E.output=(E.output||"")+k.value;return}k.prev=E,u.push(k),E=k},st=(k,J)=>{const S=Vt(ht({},h[J]),{conditions:1,inner:""});S.prev=E,S.parens=y.parens,S.output=y.output;const N=(t.capture?"(":"")+S.open;We("parens"),P({type:k,value:J,output:y.output?"":C}),P({type:"paren",extglob:!0,value:ce(),output:N}),H.push(S)},Er=k=>{let J=k.close+(t.capture?")":""),S;if(k.type==="negate"){let N=q;k.inner&&k.inner.length>1&&k.inner.includes("/")&&(N=B(t)),(N!==q||ne()||/^\)+$/.test(ie()))&&(J=k.close=`)$))${N}`),k.inner.includes("*")&&(S=ie())&&/^\.[^\\/.]+$/.test(S)&&(J=k.close=`)${S})${N})`),k.prev.type==="bos"&&(y.negatedExtglob=!0)}P({type:"paren",extglob:!0,value:D,output:J}),be("parens")};if(t.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(r)){let k=!1,J=r.replace(Oa,(S,N,Q,oe,Y,Fn)=>oe==="\\"?(k=!0,S):oe==="?"?N?N+oe+(Y?F.repeat(Y.length):""):Fn===0?R+(Y?F.repeat(Y.length):""):F.repeat(Q.length):oe==="."?c.repeat(Q.length):oe==="*"?N?N+oe+(Y?q:""):q:N?S:`\\${S}`);return k===!0&&(t.unescape===!0?J=J.replace(/\\/g,""):J=J.replace(/\\+/g,S=>S.length%2===0?"\\\\":S?"\\":"")),J===r&&t.contains===!0?(y.output=r,y):(y.output=Z.wrapOutput(J,y,e),y)}for(;!ne();){if(D=ce(),D==="\0")continue;if(D==="\\"){const S=M();if(S==="/"&&t.bash!==!0||S==="."||S===";")continue;if(!S){D+="\\",P({type:"text",value:D});continue}const N=/^\\+/.exec(ie());let Q=0;if(N&&N[0].length>2&&(Q=N[0].length,y.index+=Q,Q%2!==0&&(D+="\\")),t.unescape===!0?D=ce():D+=ce(),y.brackets===0){P({type:"text",value:D});continue}}if(y.brackets>0&&(D!=="]"||E.value==="["||E.value==="[^")){if(t.posix!==!1&&D===":"){const S=E.value.slice(1);if(S.includes("[")&&(E.posix=!0,S.includes(":"))){const N=E.value.lastIndexOf("["),Q=E.value.slice(0,N),oe=E.value.slice(N+2),Y=Ta[oe];if(Y){E.value=Q+Y,y.backtrack=!0,ce(),!s.output&&u.indexOf(E)===1&&(s.output=C);continue}}}(D==="["&&M()!==":"||D==="-"&&M()==="]")&&(D=`\\${D}`),D==="]"&&(E.value==="["||E.value==="[^")&&(D=`\\${D}`),t.posix===!0&&D==="!"&&E.value==="["&&(D="^"),E.value+=D,Fe({value:D});continue}if(y.quotes===1&&D!=='"'){D=Z.escapeRegex(D),E.value+=D,Fe({value:D});continue}if(D==='"'){y.quotes=y.quotes===1?0:1,t.keepQuotes===!0&&P({type:"text",value:D});continue}if(D==="("){We("parens"),P({type:"paren",value:D});continue}if(D===")"){if(y.parens===0&&t.strictBrackets===!0)throw new SyntaxError(gt("opening","("));const S=H[H.length-1];if(S&&y.parens===S.parens+1){Er(H.pop());continue}P({type:"paren",value:D,output:y.parens?")":"\\)"}),be("parens");continue}if(D==="["){if(t.nobracket===!0||!ie().includes("]")){if(t.nobracket!==!0&&t.strictBrackets===!0)throw new SyntaxError(gt("closing","]"));D=`\\${D}`}else We("brackets");P({type:"bracket",value:D});continue}if(D==="]"){if(t.nobracket===!0||E&&E.type==="bracket"&&E.value.length===1){P({type:"text",value:D,output:`\\${D}`});continue}if(y.brackets===0){if(t.strictBrackets===!0)throw new SyntaxError(gt("opening","["));P({type:"text",value:D,output:`\\${D}`});continue}be("brackets");const S=E.value.slice(1);if(E.posix!==!0&&S[0]==="^"&&!S.includes("/")&&(D=`/${D}`),E.value+=D,Fe({value:D}),t.literalBrackets===!1||Z.hasRegexChars(S))continue;const N=Z.escapeRegex(E.value);if(y.output=y.output.slice(0,-E.value.length),t.literalBrackets===!0){y.output+=N,E.value=N;continue}E.value=`(${a}${N}|${E.value})`,y.output+=E.value;continue}if(D==="{"&&t.nobrace!==!0){We("braces");const S={type:"brace",value:D,output:"(",outputIndex:y.output.length,tokensIndex:y.tokens.length};I.push(S),P(S);continue}if(D==="}"){const S=I[I.length-1];if(t.nobrace===!0||!S){P({type:"text",value:D,output:D});continue}let N=")";if(S.dots===!0){const Q=u.slice(),oe=[];for(let Y=Q.length-1;Y>=0&&(u.pop(),Q[Y].type!=="brace");Y--)Q[Y].type!=="dots"&&oe.unshift(Q[Y].value);N=Pa(oe,t),y.backtrack=!0}if(S.comma!==!0&&S.dots!==!0){const Q=y.output.slice(0,S.outputIndex),oe=y.tokens.slice(S.tokensIndex);S.value=S.output="\\{",D=N="\\}",y.output=Q;for(const Y of oe)y.output+=Y.output||Y.value}P({type:"brace",value:D,output:N}),be("braces"),I.pop();continue}if(D==="|"){H.length>0&&H[H.length-1].conditions++,P({type:"text",value:D});continue}if(D===","){let S=D;const N=I[I.length-1];N&&pe[pe.length-1]==="braces"&&(N.comma=!0,S="|"),P({type:"comma",value:D,output:S});continue}if(D==="/"){if(E.type==="dot"&&y.index===y.start+1){y.start=y.index+1,y.consumed="",y.output="",u.pop(),E=s;continue}P({type:"slash",value:D,output:g});continue}if(D==="."){if(y.braces>0&&E.type==="dot"){E.value==="."&&(E.output=c);const S=I[I.length-1];E.type="dots",E.output+=D,E.value+=D,S.dots=!0;continue}if(y.braces+y.parens===0&&E.type!=="bos"&&E.type!=="slash"){P({type:"text",value:D,output:c});continue}P({type:"dot",value:D,output:c});continue}if(D==="?"){if(!(E&&E.value==="(")&&t.noextglob!==!0&&M()==="("&&M(2)!=="?"){st("qmark",D);continue}if(E&&E.type==="paren"){const N=M();let Q=D;if(N==="<"&&!Z.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(E.value==="("&&!/[!=<:]/.test(N)||N==="<"&&!/<([!=]|\w+>)/.test(ie()))&&(Q=`\\${D}`),P({type:"text",value:D,output:Q});continue}if(t.dot!==!0&&(E.type==="slash"||E.type==="bos")){P({type:"qmark",value:D,output:A});continue}P({type:"qmark",value:D,output:F});continue}if(D==="!"){if(t.noextglob!==!0&&M()==="("&&(M(2)!=="?"||!/[!=<:]/.test(M(3)))){st("negate",D);continue}if(t.nonegate!==!0&&y.index===0){Mt();continue}}if(D==="+"){if(t.noextglob!==!0&&M()==="("&&M(2)!=="?"){st("plus",D);continue}if(E&&E.value==="("||t.regex===!1){P({type:"plus",value:D,output:f});continue}if(E&&(E.type==="bracket"||E.type==="paren"||E.type==="brace")||y.parens>0){P({type:"plus",value:D});continue}P({type:"plus",value:f});continue}if(D==="@"){if(t.noextglob!==!0&&M()==="("&&M(2)!=="?"){P({type:"at",extglob:!0,value:D,output:""});continue}P({type:"text",value:D});continue}if(D!=="*"){(D==="$"||D==="^")&&(D=`\\${D}`);const S=$a.exec(ie());S&&(D+=S[0],y.index+=S[0].length),P({type:"text",value:D});continue}if(E&&(E.type==="globstar"||E.star===!0)){E.type="star",E.star=!0,E.value+=D,E.output=q,y.backtrack=!0,y.globstar=!0,ue(D);continue}let k=ie();if(t.noextglob!==!0&&/^\([^?]/.test(k)){st("star",D);continue}if(E.type==="star"){if(t.noglobstar===!0){ue(D);continue}const S=E.prev,N=S.prev,Q=S.type==="slash"||S.type==="bos",oe=N&&(N.type==="star"||N.type==="globstar");if(t.bash===!0&&(!Q||k[0]&&k[0]!=="/")){P({type:"star",value:D,output:""});continue}const Y=y.braces>0&&(S.type==="comma"||S.type==="brace"),Fn=H.length&&(S.type==="pipe"||S.type==="paren");if(!Q&&S.type!=="paren"&&!Y&&!Fn){P({type:"star",value:D,output:""});continue}for(;k.slice(0,3)==="/**";){const yr=r[y.index+4];if(yr&&yr!=="/")break;k=k.slice(3),ue("/**",3)}if(S.type==="bos"&&ne()){E.type="globstar",E.value+=D,E.output=B(t),y.output=E.output,y.globstar=!0,ue(D);continue}if(S.type==="slash"&&S.prev.type!=="bos"&&!oe&&ne()){y.output=y.output.slice(0,-(S.output+E.output).length),S.output=`(?:${S.output}`,E.type="globstar",E.output=B(t)+(t.strictSlashes?")":"|$)"),E.value+=D,y.globstar=!0,y.output+=S.output+E.output,ue(D);continue}if(S.type==="slash"&&S.prev.type!=="bos"&&k[0]==="/"){const yr=k[1]!==void 0?"|$":"";y.output=y.output.slice(0,-(S.output+E.output).length),S.output=`(?:${S.output}`,E.type="globstar",E.output=`${B(t)}${g}|${g}${yr})`,E.value+=D,y.output+=S.output+E.output,y.globstar=!0,ue(D+ce()),P({type:"slash",value:"/",output:""});continue}if(S.type==="bos"&&k[0]==="/"){E.type="globstar",E.value+=D,E.output=`(?:^|${g}|${B(t)}${g})`,y.output=E.output,y.globstar=!0,ue(D+ce()),P({type:"slash",value:"/",output:""});continue}y.output=y.output.slice(0,-E.output.length),E.type="globstar",E.output=B(t),E.value+=D,y.output+=E.output,y.globstar=!0,ue(D);continue}const J={type:"star",value:D,output:q};if(t.bash===!0){J.output=".*?",(E.type==="bos"||E.type==="slash")&&(J.output=_+J.output),P(J);continue}if(E&&(E.type==="bracket"||E.type==="paren")&&t.regex===!0){J.output=D,P(J);continue}(y.index===y.start||E.type==="slash"||E.type==="dot")&&(E.type==="dot"?(y.output+=p,E.output+=p):t.dot===!0?(y.output+=w,E.output+=w):(y.output+=_,E.output+=_),M()!=="*"&&(y.output+=C,E.output+=C)),P(J)}for(;y.brackets>0;){if(t.strictBrackets===!0)throw new SyntaxError(gt("closing","]"));y.output=Z.escapeLast(y.output,"["),be("brackets")}for(;y.parens>0;){if(t.strictBrackets===!0)throw new SyntaxError(gt("closing",")"));y.output=Z.escapeLast(y.output,"("),be("parens")}for(;y.braces>0;){if(t.strictBrackets===!0)throw new SyntaxError(gt("closing","}"));y.output=Z.escapeLast(y.output,"{"),be("braces")}if(t.strictSlashes!==!0&&(E.type==="star"||E.type==="bracket")&&P({type:"maybe_slash",value:"",output:`${g}?`}),y.backtrack===!0){y.output="";for(const k of y.tokens)y.output+=k.output!=null?k.output:k.value,k.suffix&&(y.output+=k.suffix)}return y};Fi.fastpaths=(r,e)=>{const t=ht({},e),n=typeof t.maxLength=="number"?Math.min(Yt,t.maxLength):Yt,i=r.length;if(i>n)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${n}`);r=Ai[r]||r;const s=Z.isWindows(e),{DOT_LITERAL:u,SLASH_LITERAL:a,ONE_CHAR:o,DOTS_SLASH:l,NO_DOT:h,NO_DOTS:c,NO_DOTS_SLASH:f,STAR:g,START_ANCHOR:C}=Ye.globChars(s),m=t.dot?c:h,d=t.dot?f:h,p=t.capture?"":"?:",w={negated:!1,prefix:""};let F=t.bash===!0?".*?":g;t.capture&&(F=`(${F})`);const A=_=>_.noglobstar===!0?F:`(${p}(?:(?!${C}${_.dot?l:u}).)*?)`,b=_=>{switch(_){case"*":return`${m}${o}${F}`;case".*":return`${u}${o}${F}`;case"*.*":return`${m}${F}${u}${o}${F}`;case"*/*":return`${m}${F}${a}${o}${d}${F}`;case"**":return m+A(t);case"**/*":return`(?:${m}${A(t)}${a})?${d}${o}${F}`;case"**/*.*":return`(?:${m}${A(t)}${a})?${d}${F}${u}${o}${F}`;case"**/.*":return`(?:${m}${A(t)}${a})?${u}${o}${F}`;default:{const R=/^(.*?)\.(\w+)$/.exec(_);if(!R)return;const q=b(R[1]);return q?q+u+R[2]:void 0}}},x=Z.removePrefix(r,w);let B=b(x);return B&&t.strictSlashes!==!0&&(B+=`${a}?`),B};var Xr=Fi;const Ia=r=>r&&typeof r=="object"&&!Array.isArray(r),V=(r,e,t=!1)=>{if(Array.isArray(r)){const h=r.map(f=>V(f,e,t));return f=>{for(const g of h){const C=g(f);if(C)return C}return!1}}const n=Ia(r)&&r.tokens&&r.input;if(r===""||typeof r!="string"&&!n)throw new TypeError("Expected pattern to be a non-empty string");const i=e||{},s=Z.isWindows(e),u=n?V.compileRe(r,e):V.makeRe(r,e,!1,!0),a=u.state;delete u.state;let o=()=>!1;if(i.ignore){const h=Vt(ht({},e),{ignore:null,onMatch:null,onResult:null});o=V(i.ignore,h,t)}const l=(h,c=!1)=>{const{isMatch:f,match:g,output:C}=V.test(h,u,e,{glob:r,posix:s}),m={glob:r,state:a,regex:u,posix:s,input:h,output:C,match:g,isMatch:f};return typeof i.onResult=="function"&&i.onResult(m),f===!1?(m.isMatch=!1,c?m:!1):o(h)?(typeof i.onIgnore=="function"&&i.onIgnore(m),m.isMatch=!1,c?m:!1):(typeof i.onMatch=="function"&&i.onMatch(m),c?m:!0)};return t&&(l.state=a),l};V.test=(r,e,t,{glob:n,posix:i}={})=>{if(typeof r!="string")throw new TypeError("Expected input to be a string");if(r==="")return{isMatch:!1,output:""};const s=t||{},u=s.format||(i?Z.toPosixSlashes:null);let a=r===n,o=a&&u?u(r):r;return a===!1&&(o=u?u(r):r,a=o===n),(a===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?a=V.matchBase(r,e,t,i):a=e.exec(o)),{isMatch:Boolean(a),match:a,output:o}},V.matchBase=(r,e,t,n=Z.isWindows(t))=>(e instanceof RegExp?e:V.makeRe(e,t)).test(Ur.basename(r)),V.isMatch=(r,e,t)=>V(e,t)(r),V.parse=(r,e)=>Array.isArray(r)?r.map(t=>V.parse(t,e)):Xr(r,Vt(ht({},e),{fastpaths:!1})),V.scan=(r,e)=>Ra(r,e),V.compileRe=(r,e,t=!1,n=!1)=>{if(t===!0)return r.output;const i=e||{},s=i.contains?"":"^",u=i.contains?"":"$";let a=`${s}(?:${r.output})${u}`;r&&r.negated===!0&&(a=`^(?!${a}).*$`);const o=V.toRegex(a,e);return n===!0&&(o.state=r),o},V.makeRe=(r,e={},t=!1,n=!1)=>{if(!r||typeof r!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(r[0]==="."||r[0]==="*")&&(i.output=Xr.fastpaths(r,e)),i.output||(i=Xr(r,e)),V.compileRe(i,e,t,n)},V.toRegex=(r,e)=>{try{const t=e||{};return new RegExp(r,t.flags||(t.nocase?"i":""))}catch(t){if(e&&e.debug===!0)throw t;return/$^/}},V.constants=Ye;var Na=V,La=Na;function Zt(r,e){return Array.isArray(e)?e.some(t=>Zt(r,t)):La(e)(r)}function Ft(r,e,t){var n,i;if(e===void 0)return;if(r.length===0)return t(e);if(typeof e!="object"||e===null)return;const s=r.shift();if(s==="**"){for(;r.length>0&&r[0]==="*";)r.shift();const u=["**",...r].join("/"),a=new Set;bi("",e,a);for(const o of a)Zt(o,u)&&Ft(o.split("/"),e,t)}else if(s.startsWith("*")){let u;s.length>=1&&(u=new RegExp((i=(n=s.match(/(\*{)(.+)(})/))==null?void 0:n[2])!=null?i:".*"));for(const a in e)u&&a.match(u)!==null&&Ft([...r],e[a],t)}else Ft(r,e[s],t)}function bi(r,e,t){for(const n in e)t.add(`${r}${n}`),typeof e[n]=="object"&&bi(`${r}${n}/`,e[n],t)}function Ma(r,e,t){const n=r.length===0||r==="/"?[]:r.split("/");return Ft(n,e,t)}function xi(r,e,t){const n=r.length===0||r==="/"?[]:r.split("/");if(n.length===0)return;const i=n.pop();Ft(n,e,s=>{if(typeof s=="object")if(i==="*")for(const u in s)s[u]=t(s[u]);else s[i]!==void 0&&(s[i]=t(s[i]))})}function Ha(r,e){let t=!1;for(const n of e)if(Ma(n,r,()=>t=!0),t)return!0;return!1}function bt(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(Array.isArray(r))return r.concat([e]);if(Array.isArray(e))return e.concat([r]);if(typeof e!="object")return e;let t={};for(const n in r)e[n]===void 0?t[n]=r[n]:t[n]=bt(r[n],e[n]);for(const n in e)r[n]===void 0&&(t[n]=e[n]);return t}function ja(r,e,t){if(e.length===0)return r;let n=r;for(let i=0;i<e.length;i++){if(n===void 0)return t;n=n[e[i]]}return n}function Ua(r){return Array.from(r).map(e=>("00"+e.toString(16)).slice(-2)).join("")}async function Wa(r){return new Uint8Array(await crypto.subtle.digest("sha-1",r))}const za=new TextEncoder;async function Qr(r){const e=za.encode(r);if(!e)return"";const t=await Wa(e);return Ua(t)}function Ga(r){return r==="true"?!0:r==="false"?!1:r==="null"?null:r==="undefined"?void 0:qa(r)?Number(r):typeof r=="string"&&r.startsWith('"')&&r.endsWith('"')?r.slice(1,-1):r}function qa(r){return!isNaN(Number(r))}function _i(r){let e=0,t=0,n=!1,i=0,s=0,u="",a=[];for(;i<r.length;){if(r[i]==="^"&&u[0]==="^"||r[i]==="~"&&u[0]==="~")a.push({startColumn:s,endColumn:i,word:u}),s=i+1,u=r[i];else if(r[i]==='"')u+=r[i],n&&(a.push({startColumn:s,endColumn:i,word:u}),s=i+1,u=""),n=!n;else if(r[i]===" "||r[i]==="	"){if(n){u+=r[i],i++;continue}e===0&&t===0&&u!==""&&(a.push({startColumn:s,endColumn:i,word:u}),s=i+1,u="")}else r[i]==="{"?e++:r[i]==="}"?e--:r[i]==="["?t++:r[i]==="]"&&t--,r[i].trim()!==""&&(u+=r[i]);i++}return a.push({startColumn:s,endColumn:i,word:u}),{tokens:a}}function we(r){if(typeof r!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(r))}function Si(r,e){for(var t="",n=0,i=-1,s=0,u,a=0;a<=r.length;++a){if(a<r.length)u=r.charCodeAt(a);else{if(u===47)break;u=47}if(u===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(t.length<2||n!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var o=t.lastIndexOf("/");if(o!==t.length-1){o===-1?(t="",n=0):(t=t.slice(0,o),n=t.length-1-t.lastIndexOf("/")),i=a,s=0;continue}}else if(t.length===2||t.length===1){t="",n=0,i=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",n=2)}else t.length>0?t+="/"+r.slice(i+1,a):t=r.slice(i+1,a),n=a-i-1;i=a,s=0}else u===46&&s!==-1?++s:s=-1}return t}function Ja(r,e){var t=e.dir||e.root,n=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+n:t+r+n:n}var Dt={resolve:function(){for(var e="",t=!1,n,i=arguments.length-1;i>=-1&&!t;i--){var s;i>=0?s=arguments[i]:(n===void 0&&(n=process.cwd()),s=n),we(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=Si(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(we(e),e.length===0)return".";var t=e.charCodeAt(0)===47,n=e.charCodeAt(e.length-1)===47;return e=Si(e,!t),e.length===0&&!t&&(e="."),e.length>0&&n&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return we(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];we(n),n.length>0&&(e===void 0?e=n:e+="/"+n)}return e===void 0?".":Dt.normalize(e)},relative:function(e,t){if(we(e),we(t),e===t||(e=Dt.resolve(e),t=Dt.resolve(t),e===t))return"";for(var n=1;n<e.length&&e.charCodeAt(n)===47;++n);for(var i=e.length,s=i-n,u=1;u<t.length&&t.charCodeAt(u)===47;++u);for(var a=t.length,o=a-u,l=s<o?s:o,h=-1,c=0;c<=l;++c){if(c===l){if(o>l){if(t.charCodeAt(u+c)===47)return t.slice(u+c+1);if(c===0)return t.slice(u+c)}else s>l&&(e.charCodeAt(n+c)===47?h=c:c===0&&(h=0));break}var f=e.charCodeAt(n+c),g=t.charCodeAt(u+c);if(f!==g)break;f===47&&(h=c)}var C="";for(c=n+h+1;c<=i;++c)(c===i||e.charCodeAt(c)===47)&&(C.length===0?C+="..":C+="/..");return C.length>0?C+t.slice(u+h):(u+=h,t.charCodeAt(u)===47&&++u,t.slice(u))},_makeLong:function(e){return e},dirname:function(e){if(we(e),e.length===0)return".";for(var t=e.charCodeAt(0),n=t===47,i=-1,s=!0,u=e.length-1;u>=1;--u)if(t=e.charCodeAt(u),t===47){if(!s){i=u;break}}else s=!1;return i===-1?n?"/":".":n&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');we(e);var n=0,i=-1,s=!0,u;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,o=-1;for(u=e.length-1;u>=0;--u){var l=e.charCodeAt(u);if(l===47){if(!s){n=u+1;break}}else o===-1&&(s=!1,o=u+1),a>=0&&(l===t.charCodeAt(a)?--a===-1&&(i=u):(a=-1,i=o))}return n===i?i=o:i===-1&&(i=e.length),e.slice(n,i)}else{for(u=e.length-1;u>=0;--u)if(e.charCodeAt(u)===47){if(!s){n=u+1;break}}else i===-1&&(s=!1,i=u+1);return i===-1?"":e.slice(n,i)}},extname:function(e){we(e);for(var t=-1,n=0,i=-1,s=!0,u=0,a=e.length-1;a>=0;--a){var o=e.charCodeAt(a);if(o===47){if(!s){n=a+1;break}continue}i===-1&&(s=!1,i=a+1),o===46?t===-1?t=a:u!==1&&(u=1):t!==-1&&(u=-1)}return t===-1||i===-1||u===0||u===1&&t===i-1&&t===n+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Ja("/",e)},parse:function(e){we(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var n=e.charCodeAt(0),i=n===47,s;i?(t.root="/",s=1):s=0;for(var u=-1,a=0,o=-1,l=!0,h=e.length-1,c=0;h>=s;--h){if(n=e.charCodeAt(h),n===47){if(!l){a=h+1;break}continue}o===-1&&(l=!1,o=h+1),n===46?u===-1?u=h:c!==1&&(c=1):u!==-1&&(c=-1)}return u===-1||o===-1||c===0||c===1&&u===o-1&&u===a+1?o!==-1&&(a===0&&i?t.base=t.name=e.slice(1,o):t.base=t.name=e.slice(a,o)):(a===0&&i?(t.name=e.slice(1,u),t.base=e.slice(1,o)):(t.name=e.slice(a,u),t.base=e.slice(a,o)),t.ext=e.slice(u,o)),a>0?t.dir=e.slice(0,a-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Dt.posix=Dt;var $=Dt,Va=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,Ka=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,Xa=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Yr={Space_Separator:Va,ID_Start:Ka,ID_Continue:Xa},K={isSpaceSeparator(r){return typeof r=="string"&&Yr.Space_Separator.test(r)},isIdStartChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="$"||r==="_"||Yr.ID_Start.test(r))},isIdContinueChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||r==="$"||r==="_"||r==="\u200C"||r==="\u200D"||Yr.ID_Continue.test(r))},isDigit(r){return typeof r=="string"&&/[0-9]/.test(r)},isHexDigit(r){return typeof r=="string"&&/[0-9A-Fa-f]/.test(r)}};let Zr,ae,Be,er,He,me,ee,en,xt;var Qa=function(e,t){Zr=String(e),ae="start",Be=[],er=0,He=1,me=0,ee=void 0,en=void 0,xt=void 0;do ee=Ya(),to[ae]();while(ee.type!=="eof");return typeof t=="function"?ki({"":xt},"",t):xt};function ki(r,e,t){const n=r[e];if(n!=null&&typeof n=="object")for(const i in n){const s=ki(n,i,t);s===void 0?delete n[i]:n[i]=s}return t.call(r,e,n)}let O,T,_t,Re,L;function Ya(){for(O="default",T="",_t=!1,Re=1;;){L=Te();const r=Bi[O]();if(r)return r}}function Te(){if(Zr[er])return String.fromCodePoint(Zr.codePointAt(er))}function v(){const r=Te();return r===`
`?(He++,me=0):r?me+=r.length:me++,r&&(er+=r.length),r}const Bi={default(){switch(L){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":v();return;case"/":v(),O="comment";return;case void 0:return v(),U("eof")}if(K.isSpaceSeparator(L)){v();return}return Bi[ae]()},comment(){switch(L){case"*":v(),O="multiLineComment";return;case"/":v(),O="singleLineComment";return}throw W(v())},multiLineComment(){switch(L){case"*":v(),O="multiLineCommentAsterisk";return;case void 0:throw W(v())}v()},multiLineCommentAsterisk(){switch(L){case"*":v();return;case"/":v(),O="default";return;case void 0:throw W(v())}v(),O="multiLineComment"},singleLineComment(){switch(L){case`
`:case"\r":case"\u2028":case"\u2029":v(),O="default";return;case void 0:return v(),U("eof")}v()},value(){switch(L){case"{":case"[":return U("punctuator",v());case"n":return v(),Ze("ull"),U("null",null);case"t":return v(),Ze("rue"),U("boolean",!0);case"f":return v(),Ze("alse"),U("boolean",!1);case"-":case"+":v()==="-"&&(Re=-1),O="sign";return;case".":T=v(),O="decimalPointLeading";return;case"0":T=v(),O="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":T=v(),O="decimalInteger";return;case"I":return v(),Ze("nfinity"),U("numeric",1/0);case"N":return v(),Ze("aN"),U("numeric",NaN);case'"':case"'":_t=v()==='"',T="",O="string";return}throw W(v())},identifierNameStartEscape(){if(L!=="u")throw W(v());v();const r=tn();switch(r){case"$":case"_":break;default:if(!K.isIdStartChar(r))throw Ri();break}T+=r,O="identifierName"},identifierName(){switch(L){case"$":case"_":case"\u200C":case"\u200D":T+=v();return;case"\\":v(),O="identifierNameEscape";return}if(K.isIdContinueChar(L)){T+=v();return}return U("identifier",T)},identifierNameEscape(){if(L!=="u")throw W(v());v();const r=tn();switch(r){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!K.isIdContinueChar(r))throw Ri();break}T+=r,O="identifierName"},sign(){switch(L){case".":T=v(),O="decimalPointLeading";return;case"0":T=v(),O="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":T=v(),O="decimalInteger";return;case"I":return v(),Ze("nfinity"),U("numeric",Re*(1/0));case"N":return v(),Ze("aN"),U("numeric",NaN)}throw W(v())},zero(){switch(L){case".":T+=v(),O="decimalPoint";return;case"e":case"E":T+=v(),O="decimalExponent";return;case"x":case"X":T+=v(),O="hexadecimal";return}return U("numeric",Re*0)},decimalInteger(){switch(L){case".":T+=v(),O="decimalPoint";return;case"e":case"E":T+=v(),O="decimalExponent";return}if(K.isDigit(L)){T+=v();return}return U("numeric",Re*Number(T))},decimalPointLeading(){if(K.isDigit(L)){T+=v(),O="decimalFraction";return}throw W(v())},decimalPoint(){switch(L){case"e":case"E":T+=v(),O="decimalExponent";return}if(K.isDigit(L)){T+=v(),O="decimalFraction";return}return U("numeric",Re*Number(T))},decimalFraction(){switch(L){case"e":case"E":T+=v(),O="decimalExponent";return}if(K.isDigit(L)){T+=v();return}return U("numeric",Re*Number(T))},decimalExponent(){switch(L){case"+":case"-":T+=v(),O="decimalExponentSign";return}if(K.isDigit(L)){T+=v(),O="decimalExponentInteger";return}throw W(v())},decimalExponentSign(){if(K.isDigit(L)){T+=v(),O="decimalExponentInteger";return}throw W(v())},decimalExponentInteger(){if(K.isDigit(L)){T+=v();return}return U("numeric",Re*Number(T))},hexadecimal(){if(K.isHexDigit(L)){T+=v(),O="hexadecimalInteger";return}throw W(v())},hexadecimalInteger(){if(K.isHexDigit(L)){T+=v();return}return U("numeric",Re*Number(T))},string(){switch(L){case"\\":v(),T+=Za();return;case'"':if(_t)return v(),U("string",T);T+=v();return;case"'":if(!_t)return v(),U("string",T);T+=v();return;case`
`:case"\r":throw W(v());case"\u2028":case"\u2029":ro(L);break;case void 0:throw W(v())}T+=v()},start(){switch(L){case"{":case"[":return U("punctuator",v())}O="value"},beforePropertyName(){switch(L){case"$":case"_":T=v(),O="identifierName";return;case"\\":v(),O="identifierNameStartEscape";return;case"}":return U("punctuator",v());case'"':case"'":_t=v()==='"',O="string";return}if(K.isIdStartChar(L)){T+=v(),O="identifierName";return}throw W(v())},afterPropertyName(){if(L===":")return U("punctuator",v());throw W(v())},beforePropertyValue(){O="value"},afterPropertyValue(){switch(L){case",":case"}":return U("punctuator",v())}throw W(v())},beforeArrayValue(){if(L==="]")return U("punctuator",v());O="value"},afterArrayValue(){switch(L){case",":case"]":return U("punctuator",v())}throw W(v())},end(){throw W(v())}};function U(r,e){return{type:r,value:e,line:He,column:me}}function Ze(r){for(const e of r){if(Te()!==e)throw W(v());v()}}function Za(){switch(Te()){case"b":return v(),"\b";case"f":return v(),"\f";case"n":return v(),`
`;case"r":return v(),"\r";case"t":return v(),"	";case"v":return v(),"\v";case"0":if(v(),K.isDigit(Te()))throw W(v());return"\0";case"x":return v(),eo();case"u":return v(),tn();case`
`:case"\u2028":case"\u2029":return v(),"";case"\r":return v(),Te()===`
`&&v(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw W(v());case void 0:throw W(v())}return v()}function eo(){let r="",e=Te();if(!K.isHexDigit(e)||(r+=v(),e=Te(),!K.isHexDigit(e)))throw W(v());return r+=v(),String.fromCodePoint(parseInt(r,16))}function tn(){let r="",e=4;for(;e-- >0;){const t=Te();if(!K.isHexDigit(t))throw W(v());r+=v()}return String.fromCodePoint(parseInt(r,16))}const to={start(){if(ee.type==="eof")throw et();rn()},beforePropertyName(){switch(ee.type){case"identifier":case"string":en=ee.value,ae="afterPropertyName";return;case"punctuator":tr();return;case"eof":throw et()}},afterPropertyName(){if(ee.type==="eof")throw et();ae="beforePropertyValue"},beforePropertyValue(){if(ee.type==="eof")throw et();rn()},beforeArrayValue(){if(ee.type==="eof")throw et();if(ee.type==="punctuator"&&ee.value==="]"){tr();return}rn()},afterPropertyValue(){if(ee.type==="eof")throw et();switch(ee.value){case",":ae="beforePropertyName";return;case"}":tr()}},afterArrayValue(){if(ee.type==="eof")throw et();switch(ee.value){case",":ae="beforeArrayValue";return;case"]":tr()}},end(){}};function rn(){let r;switch(ee.type){case"punctuator":switch(ee.value){case"{":r={};break;case"[":r=[];break}break;case"null":case"boolean":case"numeric":case"string":r=ee.value;break}if(xt===void 0)xt=r;else{const e=Be[Be.length-1];Array.isArray(e)?e.push(r):e[en]=r}if(r!==null&&typeof r=="object")Be.push(r),Array.isArray(r)?ae="beforeArrayValue":ae="beforePropertyName";else{const e=Be[Be.length-1];e==null?ae="end":Array.isArray(e)?ae="afterArrayValue":ae="afterPropertyValue"}}function tr(){Be.pop();const r=Be[Be.length-1];r==null?ae="end":Array.isArray(r)?ae="afterArrayValue":ae="afterPropertyValue"}function W(r){return rr(r===void 0?`JSON5: invalid end of input at ${He}:${me}`:`JSON5: invalid character '${Ti(r)}' at ${He}:${me}`)}function et(){return rr(`JSON5: invalid end of input at ${He}:${me}`)}function Ri(){return me-=5,rr(`JSON5: invalid identifier character at ${He}:${me}`)}function ro(r){console.warn(`JSON5: '${Ti(r)}' in strings is not valid ECMAScript; consider escaping`)}function Ti(r){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[r])return e[r];if(r<" "){const t=r.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return r}function rr(r){const e=new SyntaxError(r);return e.lineNumber=He,e.columnNumber=me,e}var no=function(e,t,n){const i=[];let s="",u,a,o="",l;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(n=t.space,l=t.quote,t=t.replacer),typeof t=="function")a=t;else if(Array.isArray(t)){u=[];for(const m of t){let d;typeof m=="string"?d=m:(typeof m=="number"||m instanceof String||m instanceof Number)&&(d=String(m)),d!==void 0&&u.indexOf(d)<0&&u.push(d)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),typeof n=="number"?n>0&&(n=Math.min(10,Math.floor(n)),o="          ".substr(0,n)):typeof n=="string"&&(o=n.substr(0,10)),h("",{"":e});function h(m,d){let p=d[m];switch(p!=null&&(typeof p.toJSON5=="function"?p=p.toJSON5(m):typeof p.toJSON=="function"&&(p=p.toJSON(m))),a&&(p=a.call(d,m,p)),p instanceof Number?p=Number(p):p instanceof String?p=String(p):p instanceof Boolean&&(p=p.valueOf()),p){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof p=="string")return c(p);if(typeof p=="number")return String(p);if(typeof p=="object")return Array.isArray(p)?C(p):f(p)}function c(m){const d={"'":.1,'"':.2},p={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let w="";for(let A=0;A<m.length;A++){const b=m[A];switch(b){case"'":case'"':d[b]++,w+=b;continue;case"\0":if(K.isDigit(m[A+1])){w+="\\x00";continue}}if(p[b]){w+=p[b];continue}if(b<" "){let x=b.charCodeAt(0).toString(16);w+="\\x"+("00"+x).substring(x.length);continue}w+=b}const F=l||Object.keys(d).reduce((A,b)=>d[A]<d[b]?A:b);return w=w.replace(new RegExp(F,"g"),p[F]),F+w+F}function f(m){if(i.indexOf(m)>=0)throw TypeError("Converting circular structure to JSON5");i.push(m);let d=s;s=s+o;let p=u||Object.keys(m),w=[];for(const A of p){const b=h(A,m);if(b!==void 0){let x=g(A)+":";o!==""&&(x+=" "),x+=b,w.push(x)}}let F;if(w.length===0)F="{}";else{let A;if(o==="")A=w.join(","),F="{"+A+"}";else{let b=`,
`+s;A=w.join(b),F=`{
`+s+A+`,
`+d+"}"}}return i.pop(),s=d,F}function g(m){if(m.length===0)return c(m);const d=String.fromCodePoint(m.codePointAt(0));if(!K.isIdStartChar(d))return c(m);for(let p=d.length;p<m.length;p++)if(!K.isIdContinueChar(String.fromCodePoint(m.codePointAt(p))))return c(m);return m}function C(m){if(i.indexOf(m)>=0)throw TypeError("Converting circular structure to JSON5");i.push(m);let d=s;s=s+o;let p=[];for(let F=0;F<m.length;F++){const A=h(String(F),m);p.push(A!==void 0?A:"null")}let w;if(p.length===0)w="[]";else if(o===""){let F=p.join(",");w="["+F+"]"}else{let F=`,
`+s,A=p.join(F);w=`[
`+s+A+`,
`+d+"]"}return i.pop(),s=d,w}},$e={parse:Qa,stringify:no};const $i={behaviorPack:"./BP",resourcePack:"./RP",skinPack:"./SP",worldTemplate:"./WT"};class io{constructor(e){this.basePath=e,this.data={}}async refreshConfig(){this.data=await this.readConfig()}async setup(){await this.refreshConfig()}get(){return this.data}getRelativePackRoot(e){var t,n;return(n=(t=this.data.packs)==null?void 0:t[e])!=null?n:$i[e]}getAbsolutePackRoot(e){return this.resolvePackPath(e)}resolvePackPath(e,t){return!t&&!e?this.basePath:!e&&t?$.join(this.basePath,t):!t&&e?$.join(this.basePath,this.getRelativePackRoot(e)):$.join(this.basePath,`${this.getRelativePackRoot(e)}/${t}`)}getAvailablePackPaths(){var e;const t=[];for(const n of Object.keys((e=this.data.packs)!=null?e:{}))t.push(this.resolvePackPath(n));return t}getAvailablePacks(){var e;const t={};for(const n in(e=this.data.packs)!=null?e:{})t[n]=this.resolvePackPath(n);return t}async save(){await this.writeConfig(this.data)}}class so{constructor(e){this.projectConfig=e,this.packTypes=[],this.extensionPackTypes=new Set}setProjectConfig(e){this.projectConfig=e}get all(){return this.packTypes.concat(...Array.from(this.extensionPackTypes.values()))}getFromId(e){return this.all.find(t=>t.id===e)}get(e){var t,n;const i=(n=(t=this.projectConfig)==null?void 0:t.getAvailablePacks())!=null?n:$i;for(const s in i)if(e.startsWith(i[s]))return this.getFromId(s)}getId(e){var t,n;return(n=(t=this.get(e))==null?void 0:t.id)!=null?n:"unknown"}addExtensionPackType(e){return this.extensionPackTypes.add(e),{dispose:()=>this.extensionPackTypes.delete(e)}}}class uo{constructor(e,t){this.projectConfig=e,this.isMatch=t,this.pluginFileTypes=new Set,this._fileTypes=[]}get fileTypes(){return this._fileTypes}set fileTypes(e){this._fileTypes=e.sort((t,n)=>t.add==="post"&&n.add!=="post"?1:t.add!=="post"&&n.add==="post"||t.add==="pre"&&n.add!=="pre"?-1:t.add!=="pre"&&n.add==="pre"?1:0)}get all(){return this.fileTypes.concat([...this.pluginFileTypes.values()])}setProjectConfig(e){this.projectConfig=e}addPluginFileType(e){return this.pluginFileTypes.add(e),{dispose:()=>this.pluginFileTypes.delete(e)}}getPluginFileTypes(){return[...this.pluginFileTypes.values()]}setPluginFileTypes(e=[]){this.pluginFileTypes.clear(),e.forEach(t=>this.pluginFileTypes.add(t))}get(e,t,n=!0){var i,s,u,a,o,l,h,c,f,g,C,m,d;const p=e?$.extname(e):null;if(!!p)for(const w of this.all){if(t!==void 0&&t===w.id)return w;if(!e)continue;const F=((i=w.detect)==null?void 0:i.packType)===void 0?[]:Array.isArray((s=w.detect)==null?void 0:s.packType)?(u=w.detect)==null?void 0:u.packType:[(a=w.detect)==null?void 0:a.packType],A=(o=w.detect)==null?void 0:o.fileExtensions,b=!!((l=w.detect)!=null&&l.scope),x=Array.isArray((h=w.detect)==null?void 0:h.scope)?(c=w.detect)==null?void 0:c.scope:[(f=w.detect)==null?void 0:f.scope],B=!!((g=w.detect)!=null&&g.matcher),_=Array.isArray((C=w.detect)==null?void 0:C.matcher)?(m=w.detect)==null?void 0:m.matcher:[(d=w.detect)==null?void 0:d.matcher];if(!(n&&A&&!A.includes(p)))if(b){if(this.prefixMatchers(F,x).some(R=>e.startsWith(R)))return w}else if(B){const R=this.prefixMatchers(F,_.filter(y=>!y.startsWith("!"))),q=this.prefixMatchers(F,_.filter(y=>y.startsWith("!")).map(y=>y.slice(1)));if(this.isMatch(e,R)&&!this.isMatch(e,q))return w}else throw console.log(w),new Error('Invalid file definition, no "detect" properties')}}prefixMatchers(e,t){if(!this.projectConfig)return[];if(e.length===0)return t.map(i=>this.projectConfig.resolvePackPath(void 0,i));const n=[];for(const i of e)for(const s of t)n.push(this.projectConfig.resolvePackPath(i,s));return n}getIds(){const e=[];for(const t of this.all)e.push(t.id);return e}async guessFolder(e){var t;const n=(h,c)=>{var f,g;let C=Array.isArray(h)?h[0]:h;C.endsWith("/")||(C+="/");const m=(g=(f=this.projectConfig)==null?void 0:f.getAbsolutePackRoot(c))!=null?g:"./unknown";return $.join(m,C)},i=`.${e.name.split(".").pop()}`,s=this.all.filter(({detect:h})=>{var c;return!h||!h.scope?!1:(c=h.fileExtensions)==null?void 0:c.includes(i)}),u=s.length===1,a=i!==".json"&&s.length>0;if(u||a){const{detect:h}=s[0];return n(h.scope,Array.isArray(h.packType)?h.packType[0]:(t=h.packType)!=null?t:"behaviorPack")}if(i!==".json")return null;const o=await e.getFile();let l;try{l=$e.parse(await o.text())}catch{return null}for(const{type:h,detect:c}of s){if(typeof h=="string"&&h!=="json")continue;const{scope:f,fileContent:g,packType:C="behaviorPack"}=c!=null?c:{};if(!(!f||!g)&&!!Ha(l,g))return n(f,Array.isArray(C)?C[0]:C)}return null}getId(e){var t,n;return(n=(t=this.get(e))==null?void 0:t.id)!=null?n:"unknown"}isJsonFile(e){var t,n;const i=(n=(t=this.get(e))==null?void 0:t.meta)==null?void 0:n.language;return i?i==="json":e.endsWith(".json")}}class ao extends uo{constructor(e){super(e,Zt),this.ready=new Ge,this.lCacheFiles={},this.lCacheFilesLoaded=new Ge,this.packSpiderFiles={},this.packSpiderFilesLoaded=new Ge}setProjectConfig(e){this.projectConfig=e}async setup(e){this.fileTypes.length>0||(await e.fired,this.fileTypes=await e.readJSON("data/packages/minecraftBedrock/fileDefinitions.json"),this.loadLightningCache(e),this.loadPackSpider(e),this.ready.dispatch())}getMonacoSchemaEntries(){return this.fileTypes.map(({detect:e={},schema:t})=>{if(!e.matcher)return null;const n=(e==null?void 0:e.packType)===void 0?[]:Array.isArray(e==null?void 0:e.packType)?e==null?void 0:e.packType:[e==null?void 0:e.packType];return{fileMatch:this.prefixMatchers(n,Array.isArray(e.matcher)?[...e.matcher]:[e.matcher]).map(i=>encodeURI(i).replaceAll(/;|,|@|&|=|\+|\$|\.|!|'|\(|\)|#/g,"*")),uri:t}}).filter(e=>e!==null).flat()}async loadLightningCache(e){var i;const t=await e.readJSON("data/packages/minecraftBedrock/lightningCaches.json"),n=s=>Object.entries(t).find(([u])=>u.endsWith(s));for(const s of this.fileTypes){if(!s.lightningCache)continue;const[u,a]=(i=n(s.lightningCache))!=null?i:[];if(!u)throw new Error(`Lightning cache file "${s.lightningCache}" for file type "${s.id}" not found`);this.lCacheFiles[s.lightningCache]=a}this.lCacheFilesLoaded.dispatch()}async getLightningCache(e){var n,i;const{lightningCache:t}=(n=this.get(e))!=null?n:{};return t?(await this.lCacheFilesLoaded.fired,(i=this.lCacheFiles[t])!=null?i:[]):[]}async loadPackSpider(e){const t=await e.readJSON("data/packages/minecraftBedrock/packSpiders.json");this.packSpiderFiles=Object.fromEntries(this.fileTypes.map(({id:n,packSpider:i})=>{if(!!i)return[n,t[`file:///data/packages/minecraftBedrock/packSpider/${i}`]]}).filter(n=>n!==void 0)),this.packSpiderFilesLoaded.dispatch()}async getPackSpiderData(){return await this.packSpiderFilesLoaded.fired,this.packSpiderFiles}}const oo="/";var Oi={},lo=function(r,e,t,n,i){var s=Oi[e]||(Oi[e]=URL.createObjectURL(new Blob([r],{type:"text/javascript"}))),u=new Worker(s);return u.onerror=function(a){return i(a.error,null)},u.onmessage=function(a){return i(null,a.data)},u.postMessage(t,n),u},se=Uint8Array,Ce=Uint16Array,St=Uint32Array,nn=new se([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sn=new se([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Pi=new se([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ii=function(r,e){for(var t=new Ce(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new St(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return[t,i]},Ni=Ii(nn,2),un=Ni[0],co=Ni[1];un[28]=258,co[258]=28;for(var ho=Ii(sn,0),Li=ho[0],nr=new Ce(32768),z=0;z<32768;++z){var je=(z&43690)>>>1|(z&21845)<<1;je=(je&52428)>>>2|(je&13107)<<2,je=(je&61680)>>>4|(je&3855)<<4,nr[z]=((je&65280)>>>8|(je&255)<<8)>>>1}for(var mt=function(r,e,t){for(var n=r.length,i=0,s=new Ce(e);i<n;++i)++s[r[i]-1];var u=new Ce(e);for(i=0;i<e;++i)u[i]=u[i-1]+s[i-1]<<1;var a;if(t){a=new Ce(1<<e);var o=15-e;for(i=0;i<n;++i)if(r[i])for(var l=i<<4|r[i],h=e-r[i],c=u[r[i]-1]++<<h,f=c|(1<<h)-1;c<=f;++c)a[nr[c]>>>o]=l}else for(a=new Ce(n),i=0;i<n;++i)r[i]&&(a[i]=nr[u[r[i]-1]++]>>>15-r[i]);return a},kt=new se(288),z=0;z<144;++z)kt[z]=8;for(var z=144;z<256;++z)kt[z]=9;for(var z=256;z<280;++z)kt[z]=7;for(var z=280;z<288;++z)kt[z]=8;for(var Mi=new se(32),z=0;z<32;++z)Mi[z]=5;var Hi=mt(kt,9,1),ji=mt(Mi,5,1),ir=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ge=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},sr=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Ui=function(r){return(r/8|0)+(r&7&&1)},ur=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new(r instanceof Ce?Ce:r instanceof St?St:se)(t-e);return n.set(r.subarray(e,t)),n},Wi=function(r,e,t){var n=r.length;if(!n||t&&!t.l&&n<5)return e||new se(0);var i=!e||t,s=!t||t.i;t||(t={}),e||(e=new se(n*3));var u=function(P){var st=e.length;if(P>st){var Er=new se(Math.max(st*2,P));Er.set(e),e=Er}},a=t.f||0,o=t.p||0,l=t.b||0,h=t.l,c=t.d,f=t.m,g=t.n,C=n*8;do{if(!h){t.f=a=ge(r,o,1);var m=ge(r,o+1,3);if(o+=3,m)if(m==1)h=Hi,c=ji,f=9,g=5;else if(m==2){var F=ge(r,o,31)+257,A=ge(r,o+10,15)+4,b=F+ge(r,o+5,31)+1;o+=14;for(var x=new se(b),B=new se(19),_=0;_<A;++_)B[Pi[_]]=ge(r,o+_*3,7);o+=A*3;for(var R=ir(B),q=(1<<R)-1,y=mt(B,R,1),_=0;_<b;){var H=y[ge(r,o,q)];o+=H&15;var d=H>>>4;if(d<16)x[_++]=d;else{var I=0,pe=0;for(d==16?(pe=3+ge(r,o,3),o+=2,I=x[_-1]):d==17?(pe=3+ge(r,o,7),o+=3):d==18&&(pe=11+ge(r,o,127),o+=7);pe--;)x[_++]=I}}var E=x.subarray(0,F),D=x.subarray(F);f=ir(E),g=ir(D),h=mt(E,f,1),c=mt(D,g,1)}else throw"invalid block type";else{var d=Ui(o)+4,p=r[d-4]|r[d-3]<<8,w=d+p;if(w>n){if(s)throw"unexpected EOF";break}i&&u(l+p),e.set(r.subarray(d,w),l),t.b=l+=p,t.p=o=w*8;continue}if(o>C){if(s)throw"unexpected EOF";break}}i&&u(l+131072);for(var ne=(1<<f)-1,M=(1<<g)-1,ce=o;;ce=o){var I=h[sr(r,o)&ne],ie=I>>>4;if(o+=I&15,o>C){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(ie<256)e[l++]=ie;else if(ie==256){ce=o,h=null;break}else{var ue=ie-254;if(ie>264){var _=ie-257,Fe=nn[_];ue=ge(r,o,(1<<Fe)-1)+un[_],o+=Fe}var Mt=c[sr(r,o)&M],We=Mt>>>4;if(!Mt)throw"invalid distance";o+=Mt&15;var D=Li[We];if(We>3){var Fe=sn[We];D+=sr(r,o)&(1<<Fe)-1,o+=Fe}if(o>C){if(s)throw"unexpected EOF";break}i&&u(l+131072);for(var be=l+ue;l<be;l+=4)e[l]=e[l-D],e[l+1]=e[l+1-D],e[l+2]=e[l+2-D],e[l+3]=e[l+3-D];l=be}}t.l=h,t.p=ce,t.b=l,h&&(a=1,t.m=f,t.d=c,t.n=g)}while(!a);return l==e.length?e:ur(e,0,l)},fo=new se(0),po=function(r,e){var t={};for(var n in r)t[n]=r[n];for(var n in e)t[n]=e[n];return t},zi=function(r,e,t){for(var n=r(),i=r.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),u=0;u<n.length;++u){var a=n[u],o=s[u];if(typeof a=="function"){e+=";"+o+"=";var l=a.toString();if(a.prototype)if(l.indexOf("[native code]")!=-1){var h=l.indexOf(" ",8)+1;e+=l.slice(h,l.indexOf("(",h))}else{e+=l;for(var c in a.prototype)e+=";"+o+".prototype."+c+"="+a.prototype[c].toString()}else e+=l}else t[o]=a}return[e,t]},ar=[],go=function(r){var e=[];for(var t in r)(r[t]instanceof se||r[t]instanceof Ce||r[t]instanceof St)&&e.push((r[t]=new r[t].constructor(r[t])).buffer);return e},Do=function(r,e,t,n){var i;if(!ar[t]){for(var s="",u={},a=r.length-1,o=0;o<a;++o)i=zi(r[o],s,u),s=i[0],u=i[1];ar[t]=zi(r[a],s,u)}var l=po({},ar[t][1]);return lo(ar[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,l,go(l),n)},mo=function(){return[se,Ce,St,nn,sn,Pi,un,Li,Hi,ji,nr,mt,ir,ge,sr,Ui,ur,Wi,on,Gi,qi]},Gi=function(r){return postMessage(r,[r.buffer])},qi=function(r){return r&&r.size&&new se(r.size)},Eo=function(r,e,t,n,i,s){var u=Do(t,n,i,function(a,o){u.terminate(),s(a,o)});return u.postMessage([r,e],e.consume?[r.buffer]:[]),function(){u.terminate()}},Ae=function(r,e){return r[e]|r[e+1]<<8},Ee=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},an=function(r,e){return Ee(r,e)+Ee(r,e+4)*4294967296};function yo(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Eo(r,e,[mo],function(n){return Gi(on(n.data[0],qi(n.data[1])))},1,t)}function on(r,e){return Wi(r,e)}var ln=typeof TextDecoder<"u"&&new TextDecoder,vo=0;try{ln.decode(fo,{stream:!0}),vo=1}catch{}var wo=function(r){for(var e="",t=0;;){var n=r[t++],i=(n>127)+(n>223)+(n>239);if(t+i>r.length)return[e,ur(r,t-1)];i?i==3?(n=((n&15)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|r[t++]&63):e+=String.fromCharCode((n&15)<<12|(r[t++]&63)<<6|r[t++]&63):e+=String.fromCharCode(n)}};function Co(r,e){if(e){for(var t="",n=0;n<r.length;n+=16384)t+=String.fromCharCode.apply(null,r.subarray(n,n+16384));return t}else{if(ln)return ln.decode(r);var i=wo(r),s=i[0],u=i[1];if(u.length)throw"invalid utf-8 data";return s}}var Ao=function(r,e){return e+30+Ae(r,e+26)+Ae(r,e+28)},Fo=function(r,e,t){var n=Ae(r,e+28),i=Co(r.subarray(e+46,e+46+n),!(Ae(r,e+8)&2048)),s=e+46+n,u=Ee(r,e+20),a=t&&u==4294967295?bo(r,s):[u,Ee(r,e+24),Ee(r,e+42)],o=a[0],l=a[1],h=a[2];return[Ae(r,e+10),o,l,i,s+Ae(r,e+30)+Ae(r,e+32),h]},bo=function(r,e){for(;Ae(r,e)!=1;e+=4+Ae(r,e+2));return[an(r,e+12),an(r,e+4),an(r,e+20)]};function xo(r,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var f=0;f<t.length;++f)t[f]()},i={},s=r.length-22;Ee(r,s)!=101010256;--s)if(!s||r.length-s>65558){e("invalid zip file",null);return}var u=Ae(r,s+8);u||e(null,{});var a=u,o=Ee(r,s+16),l=o==4294967295;if(l){if(s=Ee(r,s-12),Ee(r,s)!=101075792){e("invalid zip file",null);return}a=u=Ee(r,s+32),o=Ee(r,s+48)}for(var h=function(f){var g=Fo(r,o,l),C=g[0],m=g[1],d=g[2],p=g[3],w=g[4],F=g[5],A=Ao(r,F);o=w;var b=function(B,_){B?(n(),e(B,null)):(i[p]=_,--u||e(null,i))};if(!C)b(null,ur(r,A,A+m));else if(C==8){var x=r.subarray(A,A+m);if(m<32e4)try{b(null,on(x,new se(d)))}catch(B){b(B,null)}else t.push(yo(x,{size:d},b))}else b("unknown compression type "+C,null)},c=0;c<a;++c)h();return n}const cn=$.dirname,_o=$.join;$.extname;const Ji=$.basename;$.resolve,$.relative;async function hn(r,e,t=new Set,n=""){for await(const i of r.values()){const s=n.length===0?i.name:`${n}/${i.name}`;if(i.kind==="file"){if(i.name[0]===".")continue;await e(i,s,r)}else i.kind==="directory"&&!t.has(s)&&await hn(i,e,t,s)}}async function So(){return typeof(await(await navigator.storage.getDirectory()).getFileHandle("bridge-supports-writable-test",{create:!0})).createWritable=="function"}async function Vi(){var r;return typeof((r=navigator.storage)==null?void 0:r.getDirectory)!="function"||!await So()?new fe(null,"bridgeFolder",void 0):await navigator.storage.getDirectory()}class or extends Ge{constructor(e){super(),e&&this.setup(e)}get baseDirectory(){return this._baseDirectory}setup(e){this._baseDirectory=e,this.hasFired||this.dispatch()}async getDirectoryHandle(e,{create:t,createOnce:n}={}){if(e===""||e===".")return this.baseDirectory;let i=this.baseDirectory;const s=e.split(/\\|\//g);s[0]==="."&&s.shift(),s[0]==="extensions"&&(s[0]="~local",s.splice(1,0,"extensions")),s[0]==="~local"&&(i=await Vi(),s.shift());for(const u of s){try{i=await i.getDirectoryHandle(u,{create:n||t})}catch{throw new Error(`Failed to access "${e}": Directory does not exist`)}n&&(n=!1,t=!1)}return i}async getFileHandle(e,t=!1){if(e.length===0)throw new Error("Error: filePath is empty");const n=await this.getDirectoryHandle(cn(e),{create:t});try{return await n.getFileHandle(Ji(e),{create:t})}catch{throw new Error(`File does not exist: "${e}"`)}}async pathTo(e){const t=await Vi();if(e instanceof ye&&!(t instanceof fe))return;let n=await t.resolve(e).then(i=>i==null?void 0:i.join("/"));return n?n="~local/"+n:n=await this.baseDirectory.resolve(e).then(i=>i==null?void 0:i.join("/")),n}async mkdir(e,{recursive:t}={}){await this.getDirectoryHandle(e,{create:!0})}async readdir(e,{withFileTypes:t}={}){const n=await this.getDirectoryHandle(e),i=[];for await(const s of n.values())s.kind==="file"&&s.name===".DS_Store"||(t?i.push(s):i.push(s.name));return i}async readFilesFromDir(e,t=this.getDirectoryHandle(e)){t=await t;const n=[];for await(const i of t.values())i.kind==="file"&&i.name===".DS_Store"||(i.kind==="file"?n.push({name:i.name,kind:i.kind,path:`${e}/${i.name}`}):i.kind==="directory"&&n.push(...await this.readFilesFromDir(`${e}/${i.name}`,i)));return n}readFile(e){return this.getFileHandle(e).then(t=>t.getFile())}async unlink(e){if(e.length===0)throw new Error("Error: filePath is empty");const t=e.split(/\\|\//g),n=t.pop();let i;try{i=await this.getDirectoryHandle(t.join("/"))}catch{return}try{await i.removeEntry(n,{recursive:!0})}catch{}}async writeFile(e,t){const n=await this.getFileHandle(e,!0);return await this.write(n,t),n}async write(e,t){const n=await e.createWritable({keepExistingData:!1});await n.write(t),await n.close()}async readJSON(e){const t=await this.readFile(e);try{return await $e.parse(await t.text())}catch{throw new Error(`Invalid JSON: ${e}`)}}writeJSON(e,t,n=!1){return this.writeFile(e,JSON.stringify(t,null,n?"	":void 0))}async move(e,t){if(await this.fileExists(e))await this.copyFile(e,t);else if(await this.directoryExists(e))await this.copyFolder(e,t);else throw new Error(`File or folder does not exist: ${e}`);await this.unlink(e)}async copyFile(e,t){const n=await this.getFileHandle(e,!1),i=await this.getFileHandle(t,!0);return await this.copyFileHandle(n,i)}async copyFileHandle(e,t){return await this.write(t,await e.getFile()),t}async copyFolder(e,t){const n=await this.getDirectoryHandle(e,{create:!1});await hn(n,async(i,s)=>{await this.copyFileHandle(i,await this.getFileHandle(_o(t,s),!0))})}async copyFolderByHandle(e,t){const n=new or(t);await hn(e,async(i,s)=>{await this.copyFileHandle(i,await n.getFileHandle(s,!0))})}loadFileHandleAsDataUrl(e){return new Promise(async(t,n)=>{const i=new FileReader;try{const s=await e.getFile();i.addEventListener("load",()=>{t(i.result)}),i.addEventListener("error",n),i.readAsDataURL(s)}catch{n(`File does not exist: "${e.name}"`)}})}async fileExists(e){try{return await this.getFileHandle(e),!0}catch{return!1}}async directoryExists(e){try{return await this.getDirectoryHandle(e),!0}catch{return!1}}async getDirectoryHandlesFromGlob(e,t="."){const n=e.split(/\/|\\/g),i=new Set([await this.getDirectoryHandle(t)]);for(const s of n){if(s==="*")for(const u of[...i.values()]){i.delete(u);for await(const a of u.values())a.kind==="directory"&&i.add(a)}else{if(s==="**")return console.warn('"**" is not supported yet'),[];for(const u of[...i.values()]){i.delete(u);try{i.add(await u.getDirectoryHandle(s))}catch{}}}if(i.size===0)return[]}return[...i.values()]}}const Ki=1088685;function ko(r){return new Promise(async e=>{typeof requestIdleCallback=="function"?requestIdleCallback(async()=>{await r(),e()}):(await r(),e())})}class Bo extends or{constructor(e=!1){super(),this.isMainLoader=e}get virtualFileSystem(){if(!this._virtualFileSystem)throw new Error("DataLoader: virtualFileSystem is not initialized");return this._virtualFileSystem}async loadData(e=!1){if(this.hasFired){console.warn("This dataLoader instance already loaded data. You called loadData() twice.");return}let t=await _r("savedAllDataInIdb");e&&(t=!1,await Sr("savedAllDataInIdb",!1)),this.isMainLoader&&console.log(t?"[APP] Data saved; restoring from cache...":"[APP] Data not saved; fetching now..."),console.time("[App] Data");const n=this.isMainLoader&&!t;if(this._virtualFileSystem=new fe(new vt("data-fs"),"bridgeFolder",t?void 0:new Map,n),await this._virtualFileSystem.setupDone.fired,t){this.setup(this._virtualFileSystem),console.timeEnd("[App] Data");return}const i=await fetch(oo+"packages.zip").then(o=>o.arrayBuffer());if(i.byteLength!==Ki)throw new Error(`Error: Data package was larger than the expected size of ${Ki} bytes; got ${i.byteLength} bytes`);const s=await new Promise((o,l)=>xo(new Uint8Array(i),async(h,c)=>{if(h)return l(h);o(c)})),a={".":await this._virtualFileSystem.getDirectoryHandle("data",{create:!0})};for(const o in s){const l=Ji(o),h=cn(o);if(o.endsWith("/")){const c=await a[h].getDirectoryHandle(l,{create:!0});a[o.slice(0,-1)]=c}else await a[h].getFileHandle(l,{create:!0,initialData:s[o]})}this.setup(this._virtualFileSystem),console.timeEnd("[App] Data"),this.isMainLoader&&!e&&ko(async()=>{await this._virtualFileSystem.moveToIdb(),await Sr("savedAllDataInIdb",!0)})}}const Ro={"!":"BANG","&":"AND","(":"LEFT_PARENT",")":"RIGHT_PARENT","*":"ASTERISK","+":"PLUS",",":"COMMA","-":"MINUS","/":"SLASH",":":"COLON",";":"SEMICOLON","<":"SMALLER","=":"EQUALS",">":"GREATER","?":"QUESTION","[":"ARRAY_LEFT","]":"ARRAY_RIGHT","{":"CURLY_LEFT","|":"OR","}":"CURLY_RIGHT"},Xi=new Set(["return","continue","break","for_each","loop","false","true"]);class Bt{constructor(e,t,n,i){this.type=e,this.text=t,this.startColumn=n,this.startLine=i}getType(){return this.type}getText(){return this.text}getPosition(){return{startColumn:this.startColumn,startLineNumber:this.startLine,endColumn:this.startColumn+this.text.length,endLineNumber:this.startLine}}}class Qi{constructor(e){this.i=0,this.currentColumn=0,this.currentLine=0,this.lastColumns=0,this.keywordTokens=e?new Set([...Xi,...e]):Xi}init(e){this.currentLine=0,this.currentColumn=0,this.lastColumns=0,this.i=0,this.expression=e}next(){for(this.currentColumn=this.i-this.lastColumns;this.i<this.expression.length&&(this.expression[this.i]===" "||this.expression[this.i]==="	"||this.expression[this.i]===`
`);)this.expression[this.i]===`
`&&(this.currentLine++,this.currentColumn=0,this.lastColumns=this.i+1),this.i++;if(this.expression[this.i]==="#"){const t=this.expression.indexOf(`
`,this.i+1);return this.i=t===-1?this.expression.length:t,this.currentLine++,this.lastColumns=this.i+1,this.currentColumn=0,this.next()}let e=Ro[this.expression[this.i]];if(e)return new Bt(e,this.expression[this.i++],this.currentColumn,this.currentLine);if(this.isLetter(this.expression[this.i])||this.expression[this.i]==="_"){let t=this.i+1;for(;t<this.expression.length&&(this.isLetter(this.expression[t])||this.isNumber(this.expression[t])||this.expression[t]==="_"||this.expression[t]===".");)t++;const n=this.expression.substring(this.i,t).toLowerCase();return this.i=t,new Bt(this.keywordTokens.has(n)?n.toUpperCase():"NAME",n,this.currentColumn,this.currentLine)}if(this.isNumber(this.expression[this.i])||this.expression[this.i]==="."){let t=this.i+1,n=this.expression[this.i]===".";for(;t<this.expression.length&&(this.isNumber(this.expression[t])||this.expression[t]==="."&&!n);)this.expression[t]==="."&&(n=!0),t++;const i=new Bt("NUMBER",this.expression.substring(this.i,t),this.currentColumn,this.currentLine),s=n&&this.expression[t]==="f";return this.i=s?t+1:t,i}if(this.expression[this.i]==="'"){let t=this.i+1;for(;t<this.expression.length&&this.expression[t]!=="'";)t++;t++;const n=new Bt("STRING",this.expression.substring(this.i,t),this.currentColumn,this.currentLine);return this.i=t,n}return this.hasNext()?(this.i++,this.next()):new Bt("EOF","",this.currentColumn,this.currentLine)}hasNext(){return this.i<this.expression.length}isLetter(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumber(e){return e>="0"&&e<="9"}}const To=(r,e,t)=>typeof r!="number"||Number.isNaN(r)?e:r>t?t:r<e?e:r,$o=(r,e,t)=>{let n=0;for(;0<r;)n+=Yi(e,t);return n},Oo=(r,e,t)=>{let n=0;for(;0<r;)n+=Zi(e,t);return n},Po=r=>3*r**2-2*r**3,Io=(r,e,t)=>(t<0?t=0:t>1&&(t=1),r+(e-r)*t),No=(r,e,t)=>{const n=i=>((i+180)%360+180)%360;if((r=n(r))>(e=n(e))){let i=r;r=e,e=i}return e-r>180?n(e+t*(360-(e-r))):r+t*(e-r)},Lo=(r,e)=>r%e,Yi=(r,e)=>r+Math.random()*(e-r),Zi=(r,e)=>Math.round(r+Math.random()*(e-r)),Mo=r=>((r=((r%=360)+360)%360)>179&&(r-=360),r),Ho=r=>{const e=r?1:Math.PI/180;return{"math.abs":Math.abs,"math.acos":t=>Math.acos(t)/e,"math.asin":t=>Math.asin(t)/e,"math.atan":t=>Math.atan(t)/e,"math.atan2":(t,n)=>Math.atan2(t,n)/e,"math.ceil":Math.ceil,"math.clamp":To,"math.cos":t=>Math.cos(t*e),"math.die_roll":$o,"math.die_roll_integer":Oo,"math.exp":Math.exp,"math.floor":Math.floor,"math.hermite_blend":Po,"math.lerp":Io,"math.lerp_rotate":No,"math.ln":Math.log,"math.max":Math.max,"math.min":Math.min,"math.min_angle":Mo,"math.mod":Lo,"math.pi":Math.PI,"math.pow":Math.pow,"math.random":Yi,"math.random_integer":Zi,"math.round":Math.round,"math.sin":t=>Math.sin(t*e),"math.sqrt":Math.sqrt,"math.trunc":Math.trunc}},jo={"query.in_range":(r,e,t)=>typeof r!="number"||typeof e!="number"||typeof t!="number"?(console.error('"query.in_range": value, min and max must be numbers'),!1):r>=e&&r<=t,"query.all":(r,...e)=>e.every(t=>t===r),"query.any":(r,...e)=>e.some(t=>t===r),"query.count":r=>Array.isArray(r)?r.length:1},es=r=>({...Ho(r),...jo});class fn{constructor(e,t){var n;if(this.config=t,!e)throw new Error("Provided environment must be an object");this.env={...es((n=t.useRadians)!=null?n:!1),"query.self":()=>this.env,...t.isFlat?e:this.flattenEnv(e)}}updateConfig({variableHandler:e,convertUndefined:t,useRadians:n}){t!==void 0&&(this.config.convertUndefined=t),typeof e=="function"&&(this.config.variableHandler=e),!!this.config.useRadians!=!!n&&(this.env=Object.assign(this.env,es(!!n)))}get(){return this.env}flattenEnv(e,t="",n={}){for(let i in e){let s=i;if(i[1]===".")switch(i[0]){case"q":s="query"+i.substring(1,i.length);break;case"t":s="temp"+i.substring(1,i.length);break;case"v":s="variable"+i.substring(1,i.length);break;case"c":s="context"+i.substring(1,i.length);break;case"f":s="function"+i.substring(1,i.length)}e[i].__isContext?n[`${t}${s}`]=e[i].env:typeof e[i]!="object"||Array.isArray(e[i])?n[`${t}${s}`]=e[i]:this.flattenEnv(e[i],`${t}${i}.`,n)}return n}setAt(e,t){if(e[1]===".")switch(e[0]){case"q":e="query"+e.substring(1,e.length);break;case"t":e="temp"+e.substring(1,e.length);break;case"v":e="variable"+e.substring(1,e.length);break;case"c":e="context"+e.substring(1,e.length);break;case"f":e="function"+e.substring(1,e.length)}return this.env[e]=t}getFrom(e){var n,i,s;if(e[1]===".")switch(e[0]){case"q":e="query"+e.substring(1,e.length);break;case"t":e="temp"+e.substring(1,e.length);break;case"v":e="variable"+e.substring(1,e.length);break;case"c":e="context"+e.substring(1,e.length);break;case"f":e="function"+e.substring(1,e.length)}const t=(s=this.env[e])!=null?s:(i=(n=this.config).variableHandler)==null?void 0:i.call(n,e,this.env);return t===void 0&&this.config.convertUndefined?0:t}}class X{toString(){return""+this.eval()}walk(e,t=new Set){var i;let n=(i=e(this))!=null?i:this;return n.iterate(e,t),n}iterate(e,t){var n;for(let i=0;i<this.allExpressions.length;i++){const s=this.allExpressions[i];if(t.has(s))continue;t.add(s);const u=(n=e(s))!=null?n:s;u!==s&&t.has(u)||(t.add(u),this.setExpressionAt(i,u),u.iterate(e,t))}}some(e){return this.allExpressions.some(t=>e(t)||t.some(e))}}class Et extends X{constructor(){super(...arguments),this.type="VoidExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return 0}toString(){return""}}class re extends X{constructor(e,t,n,i){super(),this.left=e,this.right=t,this.operator=n,this.evalHelper=i,this.type="GenericOperatorExpression"}get allExpressions(){return[this.left,this.right]}setExpressionAt(e,t){e===0?this.left=t:e===1&&(this.right=t)}isStatic(){return this.left.isStatic()&&this.right.isStatic()}eval(){return this.evalHelper(this.left,this.right)}toString(){return`${this.left.toString()}${this.operator}${this.right.toString()}`}}const Uo=(r,e)=>{const t=r.eval(),n=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof n!="number"&&typeof n!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} + ${n}"`);return t+n},Wo=(r,e)=>{const t=r.eval(),n=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof n!="number"&&typeof n!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} - ${n}"`);return t-n},zo=(r,e)=>{const t=r.eval(),n=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof n!="number"&&typeof n!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} / ${n}"`);return t/n},Go=(r,e)=>{const t=r.eval(),n=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof n!="number"&&typeof n!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} * ${n}"`);return t*n},qo=(r,e)=>{if(r.setPointer)return r.setPointer(e.eval()),0;throw Error("Cannot assign to "+r.type)};class Rt{constructor(e=0){this.precedence=e}parse(e,t,n){const i=e.parseExpression(this.precedence),s=n.getText();switch(s){case"+":return new re(t,i,s,Uo);case"-":return new re(t,i,s,Wo);case"*":return new re(t,i,s,Go);case"/":return new re(t,i,s,zo);case"=":return new re(t,i,"=",qo);default:throw new Error("Operator not implemented")}}}var G;(function(r){r[r.SCOPE=1]="SCOPE",r[r.STATEMENT=2]="STATEMENT",r[r.ASSIGNMENT=3]="ASSIGNMENT",r[r.CONDITIONAL=4]="CONDITIONAL",r[r.ARRAY_ACCESS=5]="ARRAY_ACCESS",r[r.NULLISH_COALESCING=6]="NULLISH_COALESCING",r[r.AND=7]="AND",r[r.OR=8]="OR",r[r.EQUALS_COMPARE=9]="EQUALS_COMPARE",r[r.COMPARE=10]="COMPARE",r[r.SUM=11]="SUM",r[r.PRODUCT=12]="PRODUCT",r[r.EXPONENT=13]="EXPONENT",r[r.PREFIX=14]="PREFIX",r[r.POSTFIX=15]="POSTFIX",r[r.FUNCTION=16]="FUNCTION"})(G||(G={}));class ts extends X{constructor(e,t){super(),this.tokenType=e,this.expression=t,this.type="PrefixExpression"}get allExpressions(){return[this.expression]}setExpressionAt(e,t){this.expression=t}isStatic(){return this.expression.isStatic()}eval(){const e=this.expression.eval();if(typeof e!="number")throw new Error(`Cannot use "${this.tokenType}" operator in front of ${typeof e} "${e}"`);switch(this.tokenType){case"MINUS":return-e;case"BANG":return!e}}toString(){switch(this.tokenType){case"MINUS":return"-"+this.expression.toString();case"BANG":return"!"+this.expression.toString()}throw new Error(`Unknown prefix operator: "${this.tokenType}"`)}}class rs{constructor(e=0){this.precedence=e}parse(e,t){return new ts(t.getType(),e.parseExpression(this.precedence))}}class dn extends X{constructor(e){super(),this.value=e,this.type="NumberExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.value}toString(){const e=""+this.value;return e.startsWith("0.")?e.slice(1):e}}class Jo{constructor(e=0){this.precedence=e}parse(e,t){return new dn(Number(t.getText()))}}class Tt extends X{constructor(e,t,n=!1){super(),this.executionEnv=e,this.name=t,this.isFunctionCall=n,this.type="NameExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!1}setPointer(e){this.executionEnv.setAt(this.name,e)}setFunctionCall(e=!0){this.isFunctionCall=e}setName(e){this.name=e}setExecutionEnv(e){this.executionEnv=e}eval(){const e=this.executionEnv.getFrom(this.name);return this.isFunctionCall||typeof e!="function"?e:e()}toString(){return this.name}}class Vo extends X{constructor(e,t){super(),this.leftExpr=e,this.rightExpr=t,this.type="NameExpression"}get allExpressions(){return[this.leftExpr,this.rightExpr]}setExpressionAt(e,t){if(!(t instanceof Tt))throw new Error('Cannot use context switch operator "->" on '+t.type);e===0?this.leftExpr=t:e===1&&(this.rightExpr=t)}isStatic(){return!1}eval(){const e=this.leftExpr.eval();return typeof e!="object"?0:(this.rightExpr.setExecutionEnv(new fn(e,this.rightExpr.executionEnv.config)),this.rightExpr.eval())}toString(){return`${this.leftExpr.toString()}->${this.rightExpr.toString()}`}}class Ko{constructor(e=0){this.precedence=e}parse(e,t){const n=new Tt(e.executionEnv,t.getText()),i=[e.lookAhead(0),e.lookAhead(1)];if(i[0].getType()==="MINUS"&&i[1].getType()==="GREATER"){e.consume("MINUS"),e.consume("GREATER");const s=e.parseExpression(G.FUNCTION-1);if(s.type!=="NameExpression"&&s.type!=="FunctionExpression")throw new Error('Cannot use context switch operator "->" on '+s.type);return new Vo(n,s)}return n}}class Oe extends X{constructor(e,t){super(),this.expression=e,this.brackets=t,this.type="GroupExpression"}get allExpressions(){return[this.expression]}setExpressionAt(e,t){this.expression=t}isStatic(){return this.expression.isStatic()}get isReturn(){return this.expression.isReturn}get isBreak(){return this.expression.isBreak}get isContinue(){return this.expression.isContinue}eval(){return this.expression.eval()}toString(){return`${this.brackets[0]}${this.expression.toString()}${this.brackets[1]}`}}class Xo{constructor(e=0){this.precedence=e}parse(e,t){const n=e.parseExpression(this.precedence);return e.consume("RIGHT_PARENT"),e.config.keepGroups?new Oe(n,"()"):n}}class tt extends X{constructor(e){super(),this.expression=e,this.type="ReturnExpression",this.isReturn=!0}get allExpressions(){return[this.expression]}setExpressionAt(e,t){this.expression=t}isStatic(){return!1}eval(){return this.expression.eval()}toString(){return"return "+this.expression.toString()}}class Qo{constructor(e=0){this.precedence=e}parse(e,t){const n=e.parseExpression(G.STATEMENT+1);return new tt(e.match("SEMICOLON",!1)?n:new dn(0))}}class rt extends X{constructor(e,t=!1){super(),this.value=e,this.isReturn=t,this.type="StaticExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.value}toString(){let e=this.value;return typeof e=="string"&&(e=`'${e}'`),this.isReturn?"return "+e:""+e}}class De extends X{constructor(e){super(),this.expressions=e,this.type="StatementExpression",this.didReturn=void 0,this.wasLoopBroken=!1,this.wasLoopContinued=!1}get allExpressions(){return this.expressions}setExpressionAt(e,t){this.expressions[e]=t}get isReturn(){if(this.didReturn!==void 0)return this.didReturn;let e=0;for(;e<this.expressions.length;){const t=this.expressions[e];if(t.isBreak||t.isContinue)return!1;if(t.isReturn)return this.didReturn=!0,!0;e++}return this.didReturn=!1,!1}get isBreak(){return!!this.wasLoopBroken&&(this.wasLoopBroken=!1,!0)}get isContinue(){return!!this.wasLoopContinued&&(this.wasLoopContinued=!1,!0)}isStatic(){let e=0;for(;e<this.expressions.length;){if(!this.expressions[e].isStatic())return!1;e++}return!0}eval(){this.didReturn=!1,this.wasLoopBroken=!1,this.wasLoopContinued=!1;let e=0;for(;e<this.expressions.length;){let t=this.expressions[e].eval();if(this.expressions[e].isReturn)return this.didReturn=!0,t;if(this.expressions[e].isContinue)return void(this.wasLoopContinued=!0);if(this.expressions[e].isBreak)return void(this.wasLoopBroken=!0);e++}return 0}toString(){let e="";for(const t of this.expressions){if(t instanceof Et||t instanceof rt&&!t.isReturn)continue;const n=t.toString();n&&(e+=n+";")}return e}}class Yo{constructor(e=0){this.precedence=e}findReEntryPoint(e){let t=1,n=e.lookAhead(0).getType();for(;n!=="EOF"&&(n=="CURLY_RIGHT"?t--:n==="CURLY_LEFT"&&t++,t!==0);)e.consume(),n=e.lookAhead(0).getType()}parse(e,t,n){if(e.config.useOptimizer&&(t.isStatic()&&(t=new rt(t.eval(),t.isReturn)),e.config.earlyReturnsSkipParsing&&t.isReturn))return e.config.earlyReturnsSkipTokenization||this.findReEntryPoint(e),new De([t]);const i=[t];if(!e.match("CURLY_RIGHT",!1))do{let s=e.parseExpression(this.precedence);if(e.config.useOptimizer){if(s.isStatic()){if(e.config.useAgressiveStaticOptimizer&&!s.isReturn)continue;s=new rt(s.eval(),s.isReturn)}if(e.config.earlyReturnsSkipParsing&&(s.isBreak||s.isContinue||s.isReturn))return i.push(s),e.config.earlyReturnsSkipTokenization||this.findReEntryPoint(e),new De(i)}i.push(s)}while(e.match("SEMICOLON")&&!e.match("EOF")&&!e.match("CURLY_RIGHT",!1));return e.match("SEMICOLON"),new De(i)}}class lr extends X{constructor(e){super(),this.name=e,this.type="StringExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.name.substring(1,this.name.length-1)}toString(){return this.name}}class Zo{constructor(e=0){this.precedence=e}parse(e,t){return new lr(t.getText())}}class ns extends X{constructor(e,t){super(),this.name=e,this.args=t,this.type="FunctionExpression"}get allExpressions(){return[this.name,...this.args]}setExpressionAt(e,t){e===0?this.name=t:e>0&&(this.args[e-1]=t)}setExecutionEnv(e){this.name.setExecutionEnv(e)}get executionEnv(){return this.name.executionEnv}isStatic(){return!1}eval(){const e=[];let t=0;for(;t<this.args.length;)e.push(this.args[t++].eval());const n=this.name.eval();if(typeof n!="function")throw new Error(this.name.toString()+" is not callable!");return n(...e)}toString(){let e=this.name.toString()+"(";for(let t=0;t<this.args.length;t++)e+=`${this.args[t].toString()}${t+1<this.args.length?",":""}`;return e+")"}}class el{constructor(e=0){this.precedence=e}parse(e,t,n){const i=[];if(!t.setFunctionCall)throw new Error(t.type+" is not callable!");if(t.setFunctionCall(!0),!e.match("RIGHT_PARENT")){do i.push(e.parseExpression());while(e.match("COMMA"));e.consume("RIGHT_PARENT")}return new ns(t,i)}}class is extends X{constructor(e,t){super(),this.name=e,this.lookup=t,this.type="ArrayAccessExpression"}get allExpressions(){return[this.name,this.lookup]}setExpressionAt(e,t){e===0?this.name=t:e===1&&(this.lookup=t)}isStatic(){return!1}setPointer(e){this.name.eval()[this.lookup.eval()]=e}eval(){return this.name.eval()[this.lookup.eval()]}toString(){return`${this.name.toString()}[${this.lookup.toString()}]`}}class tl{constructor(e=0){this.precedence=e}parse(e,t,n){const i=e.parseExpression(this.precedence-1);if(!t.setPointer)throw new Error(`"${t.type}" is not an array`);if(!e.match("ARRAY_RIGHT"))throw new Error(`No closing bracket for opening bracket "[${i.eval()}"`);return new is(t,i)}}class rl{constructor(e=0){this.precedence=e}parse(e,t){let n=e.parseExpression(this.precedence);return e.config.useOptimizer&&e.config.earlyReturnsSkipTokenization&&n.isReturn?e.match("CURLY_RIGHT"):e.consume("CURLY_RIGHT"),e.config.keepGroups?new Oe(n,"{}"):n}}class ss extends X{constructor(e,t){super(),this.count=e,this.expression=t,this.type="LoopExpression"}get allExpressions(){return[this.count,this.expression]}get isNoopLoop(){return this.count.isStatic()&&this.count.eval()===0}setExpressionAt(e,t){e===0?this.count=t:e===1&&(this.expression=t)}get isReturn(){return!this.isNoopLoop&&this.expression.isReturn}isStatic(){return this.count.isStatic()&&this.expression.isStatic()}eval(){const e=Number(this.count.eval());if(e===0)return 0;if(Number.isNaN(e))throw new Error(`First loop() argument must be of type number, received "${typeof this.count.eval()}"`);if(e>1024)throw new Error(`Cannot loop more than 1024x times, received "${e}"`);let t=0;for(;t<e;){t++;const n=this.expression.eval();if(this.expression.isBreak)break;if(!this.expression.isContinue&&this.expression.isReturn)return n}return 0}toString(){return this.isNoopLoop?"":`loop(${this.count.toString()},${this.expression.toString()})`}}class nl{constructor(e=0){this.precedence=e}parse(e,t){e.consume("LEFT_PARENT");const n=[];if(e.match("RIGHT_PARENT"))throw new Error("loop() called without arguments");do n.push(e.parseExpression());while(e.match("COMMA"));if(e.consume("RIGHT_PARENT"),n.length!==2)throw new Error("There must be exactly two loop() arguments; found "+n.length);return new ss(n[0],n[1])}}class us extends X{constructor(e,t,n){if(super(),this.variable=e,this.arrayExpression=t,this.expression=n,this.type="ForEachExpression",!this.variable.setPointer)throw new Error(`First for_each() argument must be a variable, received "${typeof this.variable.eval()}"`)}get isReturn(){return this.expression.isReturn}get allExpressions(){return[this.variable,this.arrayExpression,this.expression]}setExpressionAt(e,t){e===0?this.variable=t:e===1?this.arrayExpression=t:e===2&&(this.expression=t)}isStatic(){return this.variable.isStatic()&&this.arrayExpression.isStatic()&&this.expression.isStatic()}eval(){var n,i;const e=this.arrayExpression.eval();if(!Array.isArray(e))throw new Error(`Second for_each() argument must be an array, received "${typeof e}"`);let t=0;for(;t<e.length;){(i=(n=this.variable).setPointer)==null||i.call(n,e[t++]);const s=this.expression.eval();if(this.expression.isBreak)break;if(!this.expression.isContinue&&this.expression.isReturn)return s}return 0}toString(){return`for_each(${this.variable.toString()},${this.arrayExpression.toString()},${this.expression.toString()})`}}class il{constructor(e=0){this.precedence=e}parse(e,t){e.consume("LEFT_PARENT");const n=[];if(e.match("RIGHT_PARENT"))throw new Error("for_each() called without arguments");do n.push(e.parseExpression());while(e.match("COMMA"));if(e.consume("RIGHT_PARENT"),n.length!==3)throw new Error("There must be exactly three for_each() arguments; found "+n.length);return new us(n[0],n[1],n[2])}}class as extends X{constructor(){super(),this.type="ContinueExpression",this.isContinue=!0}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!1}eval(){return 0}toString(){return"continue"}}class sl{constructor(e=0){this.precedence=e}parse(e,t){return new as}}class os extends X{constructor(){super(),this.type="BreakExpression",this.isBreak=!0}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!1}eval(){return 0}isString(){return"break"}}class ul{constructor(e=0){this.precedence=e}parse(e,t){return new os}}class ls extends X{constructor(e){super(),this.value=e,this.type="BooleanExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.value}}class cs{constructor(e=0){this.precedence=e}parse(e,t){return new ls(t.getText()==="true")}}class al{constructor(e=0){this.precedence=e}parse(e,t,n){return new re(t,e.parseExpression(this.precedence),"==",(i,s)=>i.eval()===s.eval())}}class ol{constructor(e=0){this.precedence=e}parse(e,t,n){if(e.match("EQUALS"))return new re(t,e.parseExpression(this.precedence),"!=",(i,s)=>i.eval()!==s.eval());throw new Error("! was used as a binary operator")}}class ll{constructor(e=0){this.precedence=e}parse(e,t,n){if(e.match("AND"))return new re(t,e.parseExpression(this.precedence),"&&",(i,s)=>i.eval()&&s.eval());throw new Error('"&" not followed by another "&"')}}class cl{constructor(e=0){this.precedence=e}parse(e,t,n){if(e.match("OR"))return new re(t,e.parseExpression(this.precedence),"||",(i,s)=>i.eval()||s.eval());throw new Error('"|" not followed by another "|"')}}class hl{constructor(e=0){this.precedence=e}parse(e,t,n){return e.match("EQUALS")?new re(t,e.parseExpression(this.precedence),"<=",(i,s)=>i.eval()<=s.eval()):new re(t,e.parseExpression(this.precedence),"<",(i,s)=>i.eval()<s.eval())}}class fl{constructor(e=0){this.precedence=e}parse(e,t,n){return e.match("EQUALS")?new re(t,e.parseExpression(this.precedence),">=",(i,s)=>i.eval()>=s.eval()):new re(t,e.parseExpression(this.precedence),">",(i,s)=>i.eval()>s.eval())}}class pn extends X{constructor(e,t,n){super(),this.leftExpression=e,this.thenExpression=t,this.elseExpression=n,this.type="TernaryExpression"}get allExpressions(){return this.leftExpression.isStatic()?[this.leftExpression,this.leftExpression.eval()?this.thenExpression:this.elseExpression]:[this.leftExpression,this.thenExpression,this.elseExpression]}setExpressionAt(e,t){e===0?this.leftExpression=t:e===1?this.thenExpression=t:e===2&&(this.elseExpression=t)}get isReturn(){return this.leftResult===void 0?this.thenExpression.isReturn&&this.elseExpression.isReturn:this.leftResult?this.thenExpression.isReturn:this.elseExpression.isReturn}get hasReturn(){return this.thenExpression.isReturn||this.elseExpression.isReturn}get isContinue(){return this.leftResult===void 0?this.thenExpression.isContinue&&this.elseExpression.isContinue:this.leftResult?this.thenExpression.isContinue:this.elseExpression.isContinue}get isBreak(){return this.leftResult===void 0?this.thenExpression.isBreak&&this.elseExpression.isBreak:this.leftResult?this.thenExpression.isBreak:this.elseExpression.isBreak}isStatic(){return this.leftExpression.isStatic()&&this.thenExpression.isStatic()&&this.elseExpression.isStatic()}eval(){return this.leftResult=this.leftExpression.eval(),this.leftResult?this.thenExpression.eval():this.elseExpression.eval()}toString(){return this.elseExpression instanceof Et?`${this.leftExpression.toString()}?${this.thenExpression.toString()}`:`${this.leftExpression.toString()}?${this.thenExpression.toString()}:${this.elseExpression.toString()}`}}const dl=new class{constructor(r=0){this.precedence=r,this.exprName="Ternary"}parse(r,e,t){let n,i=r.parseExpression(this.precedence-1);return n=r.match("COLON")?r.parseExpression(this.precedence-1):new Et,r.config.useOptimizer&&e.isStatic()?e.eval()?i:n:new pn(e,i,n)}}(G.CONDITIONAL);class pl{constructor(e=0){this.precedence=e}parse(e,t,n){return e.match("QUESTION")?new re(t,e.parseExpression(this.precedence),"??",(i,s)=>{var u;return(u=i.eval())!=null?u:s.eval()}):dl.parse(e,t,n)}}class hs extends class{constructor(e){this.config=e,this.prefixParselets=new Map,this.infixParselets=new Map,this.readTokens=[],this.tokenIterator=new Qi}updateConfig(e){this.config=e}init(e){this.tokenIterator.init(e),this.readTokens=[]}setTokenizer(e){this.tokenIterator=e}setExecutionEnvironment(e){this.executionEnv=e}parseExpression(e=0){let t=this.consume();if(t.getType()==="EOF")return new Et;const n=this.prefixParselets.get(t.getType());if(!n)throw new Error(`Cannot parse ${t.getType()} expression "${t.getType()}"`);let i=n.parse(this,t);return this.parseInfixExpression(i,e)}parseInfixExpression(e,t=0){let n;for(;this.getPrecedence()>t;){n=this.consume();let i=n.getType();i!=="EQUALS"||this.match("EQUALS")||(i="ASSIGN");const s=this.infixParselets.get(i);if(!s)throw new Error(`Unknown infix parselet: "${i}"`);e=s.parse(this,e,n)}return e}getPrecedence(){var t;const e=this.infixParselets.get(this.lookAhead(0).getType());return(t=e==null?void 0:e.precedence)!=null?t:0}consume(e){const t=this.lookAhead(0);if(e&&t.getType()!==e)throw new Error(`Expected token "${e}" and found "${t.getType()}"`);return this.readTokens.shift(),t}match(e,t=!0){return this.lookAhead(0).getType()===e&&(t&&this.consume(),!0)}lookAhead(e){for(;e>=this.readTokens.length;)this.readTokens.push(this.tokenIterator.next());return this.readTokens[e]}registerInfix(e,t){this.infixParselets.set(e,t)}registerPrefix(e,t){this.prefixParselets.set(e,t)}getInfix(e){return this.infixParselets.get(e)}getPrefix(e){return this.prefixParselets.get(e)}}{constructor(e){super(e),this.registerPrefix("NAME",new Ko),this.registerPrefix("STRING",new Zo),this.registerPrefix("NUMBER",new Jo),this.registerPrefix("TRUE",new cs(G.PREFIX)),this.registerPrefix("FALSE",new cs(G.PREFIX)),this.registerPrefix("RETURN",new Qo),this.registerPrefix("CONTINUE",new sl),this.registerPrefix("BREAK",new ul),this.registerPrefix("LOOP",new nl),this.registerPrefix("FOR_EACH",new il),this.registerInfix("QUESTION",new pl(G.CONDITIONAL)),this.registerPrefix("LEFT_PARENT",new Xo),this.registerInfix("LEFT_PARENT",new el(G.FUNCTION)),this.registerInfix("ARRAY_LEFT",new tl(G.ARRAY_ACCESS)),this.registerPrefix("CURLY_LEFT",new rl(G.SCOPE)),this.registerInfix("SEMICOLON",new Yo(G.STATEMENT)),this.registerPrefix("MINUS",new rs(G.PREFIX)),this.registerPrefix("BANG",new rs(G.PREFIX)),this.registerInfix("PLUS",new Rt(G.SUM)),this.registerInfix("MINUS",new Rt(G.SUM)),this.registerInfix("ASTERISK",new Rt(G.PRODUCT)),this.registerInfix("SLASH",new Rt(G.PRODUCT)),this.registerInfix("EQUALS",new al(G.EQUALS_COMPARE)),this.registerInfix("BANG",new ol(G.EQUALS_COMPARE)),this.registerInfix("GREATER",new fl(G.COMPARE)),this.registerInfix("SMALLER",new hl(G.COMPARE)),this.registerInfix("AND",new ll(G.AND)),this.registerInfix("OR",new cl(G.OR)),this.registerInfix("ASSIGN",new Rt(G.ASSIGNMENT))}}class gl{constructor(e=0){this.precedence=e}parse(e,t){if(e.consume("LEFT_PARENT"),e.match("RIGHT_PARENT"))throw new Error("function() called without arguments");let n,i,s=[];do{const u=e.parseExpression();if(u instanceof lr)i?s.push(u.eval()):i=u.eval();else{if(!(u instanceof De||u instanceof Oe))throw new Error(`Unexpected expresion: found "${u.constructor.name}"`);n=u}}while(e.match("COMMA"));if(e.consume("RIGHT_PARENT"),!i)throw new Error(`Missing function() name (argument 1); found "${i}"`);if(!n)throw new Error(`Missing function() body (argument ${s.length+2})`);if(e.lookAhead(0).getType()!=="SEMICOLON")throw new Error("Missing semicolon after function expression");return new Dl(e.functions,i,s,n)}}class Dl extends X{constructor(e,t,n,i){super(),this.functionBody=i,this.type="CustomFunctionExpression",e.set(t.toLowerCase(),[n,i instanceof Oe?i.allExpressions[0].toString():i.toString()])}get allExpressions(){return[this.functionBody]}setExpressionAt(e,t){this.functionBody=t}get isReturn(){return!1}isStatic(){return!0}eval(){return 0}}class gn{constructor(e={},t={}){this.config=t,this.expressionCache={},this.totalCacheEntries=0,t.useOptimizer===void 0&&(this.config.useOptimizer=!0),t.useCache===void 0&&(this.config.useCache=!0),t.earlyReturnsSkipParsing===void 0&&(this.config.earlyReturnsSkipParsing=!0),t.earlyReturnsSkipTokenization===void 0&&(this.config.earlyReturnsSkipTokenization=!0),t.convertUndefined===void 0&&(this.config.convertUndefined=!1),this.parser=new hs({...this.config,tokenizer:void 0}),this.updateExecutionEnv(e,t.assumeFlatEnvironment)}updateConfig(e){(e=Object.assign(this.config,e)).tokenizer&&this.parser.setTokenizer(e.tokenizer),this.parser.updateConfig({...this.config,tokenizer:void 0}),this.executionEnvironment.updateConfig(e)}updateExecutionEnv(e,t=!1){this.executionEnvironment=new fn(e,{useRadians:this.config.useRadians,convertUndefined:this.config.convertUndefined,isFlat:t,variableHandler:this.config.variableHandler}),this.parser.setExecutionEnvironment(this.executionEnvironment)}clearCache(){this.expressionCache={},this.totalCacheEntries=0}execute(e){this.parser.setExecutionEnvironment(this.executionEnvironment);const t=this.parse(e).eval();return t===void 0?0:typeof t=="boolean"?Number(t):t}executeAndCatch(e){try{return this.execute(e)}catch{return 0}}parse(e){var n,i,s;if((n=this.config.useCache)==null||n){const u=this.expressionCache[e];if(u)return u}this.parser.init(e);let t=this.parser.parseExpression();return((i=this.config.useOptimizer)!=null?i:1)&&t.isStatic()&&(t=new rt(t.eval())),((s=this.config.useCache)==null||s)&&(this.totalCacheEntries>(this.config.maxCacheSize||256)&&this.clearCache(),this.expressionCache[e]=t,this.totalCacheEntries++),t}resolveStatic(e){return e=(e=e.walk(t=>{if(!(t instanceof lr))return t.isStatic()?new rt(t.eval()):void 0})).walk(t=>{if(t instanceof re)switch(t.operator){case"+":case"-":{const n=t.allExpressions.find(i=>i.isStatic()&&i.eval()===0);if(n)return t.allExpressions.find(i=>i!==n);break}case"*":if(t.allExpressions.find(n=>n.isStatic()&&n.eval()===0))return new rt(0);case"*":case"/":{const n=t.allExpressions.find(i=>i.isStatic()&&i.eval()===1);if(n)return t.allExpressions.find(i=>i!==n);break}}})}getParser(){return this.parser}}class ml extends hs{constructor(e){super(e),this.functions=new Map,this.classes=new Map,this.registerPrefix("FUNCTION",new gl)}reset(){this.functions.clear()}}class El{constructor(e){this.parser=new ml({useCache:!1,useOptimizer:!0,useAgressiveStaticOptimizer:!0,keepGroups:!0,earlyReturnsSkipParsing:!1,earlyReturnsSkipTokenization:!1}),this.parser.setExecutionEnvironment(new fn(this.parser,e)),this.parser.setTokenizer(new Qi(new Set(["function"])))}get functions(){return this.parser.functions}parse(e){return this.parser.init(e.replace(/\"/g,"'")),this.parser.parseExpression()}transform(e){const t=new gn({},{useCache:!1,keepGroups:!0,useOptimizer:!0,useAgressiveStaticOptimizer:!0,earlyReturnsSkipParsing:!0,earlyReturnsSkipTokenization:!1});let n=0,i=t.parse(e),s=!1;i instanceof De&&(s=!0);let u=!1;i=i.walk(o=>{var m;if(o.type!=="FunctionExpression")return;const l=o.name.name.replace(/(f|function)\./g,""),h=o.args;let[c,f]=(m=this.functions.get(l))!=null?m:[];if(!f||!c)return;f=f.replace(/(a|arg)\.(\w+)/g,(d,p,w)=>{var F,A;return((A=(F=h[c.indexOf(w)])==null?void 0:F.toString())!=null?A:"0").replace(/(t|temp)\./,"outer_temp.")});let g=function(d){if(d instanceof tt)return new Oe(d.allExpressions[0],"()");if(!(d instanceof De)||d.allExpressions.length>1)return d;const p=d.allExpressions[0];return p instanceof tt?new Oe(p.allExpressions[0],"()"):d}(t.parse(f));if(g instanceof De){const d=g.allExpressions.some(w=>w instanceof tt),p=d||g.some(w=>w instanceof tt);g=t.parse(`({${f}}+${p?d?"t.return_value":"(t.return_value??0)":"0"})`),u=!0}const C=new Map;return g=g.walk(d=>{if(d instanceof Tt){let p=d.toString().split(".");const w=p.shift(),[F,...A]=p,b=A.length>0?"."+A.join("."):"";if(w==="t"||w==="temp"){let x=C.get(F);x||(x="t.__scvar"+n++,C.set(F,x)),d.setName(`${x}${b}`)}else w==="outer_temp"&&d.setName(`t.${F}${b}`)}else{if(d instanceof tt){const p=new Tt(t.getParser().executionEnv,"t.return_value"),w=d.allExpressions[0];return new re(p,w,"=",()=>{p.setPointer(w.eval())})}if(d instanceof De){const p=[];for(let w=0;w<d.allExpressions.length;w++){const F=d.allExpressions[w];if(F instanceof pn&&F.hasReturn){yl(F,d.allExpressions.slice(w+1)),p.push(F);break}if(F.isReturn){p.push(F);break}p.push(F)}return new De(p)}}}),g});const a=t.parse(i.toString());return t.resolveStatic(a),!s&&u?`return ${a.toString()};`:a.toString()}reset(){this.functions.clear()}}function yl(r,e){if(r.isReturn)return;const t=r.allExpressions[2].isReturn?1:2,n=r.allExpressions[t];n instanceof Et||(n instanceof Oe&&n.allExpressions[0]instanceof De?e.unshift(...n.allExpressions):e.unshift(n)),e.length>0&&r.setExpressionAt(t,new Oe(new De(e),"{}"))}var fs=Object.freeze({__proto__:null,ArrayAccessExpression:is,BooleanExpression:ls,BreakExpression:os,ContinueExpression:as,ForEachExpression:us,FunctionExpression:ns,GenericOperatorExpression:re,GroupExpression:Oe,LoopExpression:ss,NameExpression:Tt,NumberExpression:dn,PostfixExpression:class extends X{constructor(r,e){super(),this.expression=r,this.tokenType=e,this.type="PostfixExpression"}get allExpressions(){return[this.expression]}setExpressionAt(r,e){this.expression=e}isStatic(){return this.expression.isStatic()}eval(){this.tokenType}},PrefixExpression:ts,ReturnExpression:tt,StatementExpression:De,StaticExpression:rt,StringExpression:lr,TernaryExpression:pn,VoidExpression:Et});let j,ds=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ds.decode();let cr=null;function hr(){return(cr===null||cr.buffer!==j.memory.buffer)&&(cr=new Uint8Array(j.memory.buffer)),cr}function fr(r,e){return ds.decode(hr().subarray(r,r+e))}const Pe=new Array(32).fill(void 0);Pe.push(void 0,null,!0,!1);let $t=Pe.length;function Ue(r){$t===Pe.length&&Pe.push(Pe.length+1);const e=$t;return $t=Pe[e],Pe[e]=r,e}function Ot(r){return Pe[r]}let nt=0,dr=new TextEncoder("utf-8");const vl=typeof dr.encodeInto=="function"?function(r,e){return dr.encodeInto(r,e)}:function(r,e){const t=dr.encode(r);return e.set(t),{read:r.length,written:t.length}};function Pt(r,e,t){if(t===void 0){const a=dr.encode(r),o=e(a.length);return hr().subarray(o,o+a.length).set(a),nt=a.length,o}let n=r.length,i=e(n);const s=hr();let u=0;for(;u<n;u++){const a=r.charCodeAt(u);if(a>127)break;s[i+u]=a}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3);const a=hr().subarray(i+u,i+n);u+=vl(r,a).written}return nt=u,i}let pr=null;function de(){return(pr===null||pr.buffer!==j.memory.buffer)&&(pr=new Int32Array(j.memory.buffer)),pr}function wl(r){r<36||(Pe[r]=$t,$t=r)}function it(r){const e=Ot(r);return wl(r),e}function Cl(r,e){try{const a=j.__wbindgen_add_to_stack_pointer(-16);var t=Pt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),n=nt;j.minifySync(a,t,n,Ue(e));var i=de()[a/4+0],s=de()[a/4+1],u=de()[a/4+2];if(u)throw it(s);return it(i)}finally{j.__wbindgen_add_to_stack_pointer(16)}}function Al(r,e){try{const a=j.__wbindgen_add_to_stack_pointer(-16);var t=Pt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),n=nt;j.parseSync(a,t,n,Ue(e));var i=de()[a/4+0],s=de()[a/4+1],u=de()[a/4+2];if(u)throw it(s);return it(i)}finally{j.__wbindgen_add_to_stack_pointer(16)}}function ps(r,e,t){try{const o=j.__wbindgen_add_to_stack_pointer(-16);var n=Pt(r,j.__wbindgen_malloc,j.__wbindgen_realloc),i=nt;j.transformSync(o,n,i,Ue(e),Ue(t));var s=de()[o/4+0],u=de()[o/4+1],a=de()[o/4+2];if(a)throw it(u);return it(s)}finally{j.__wbindgen_add_to_stack_pointer(16)}}async function Fl(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}async function gs(r){typeof r>"u"&&(r=new URL("/assets/wasm-web_bg.533586ee.wasm",self.location));const e={};e.wbg={},e.wbg.__wbindgen_json_parse=function(i,s){var u=JSON.parse(fr(i,s));return Ue(u)},e.wbg.__wbindgen_json_serialize=function(i,s){const u=Ot(s);var a=JSON.stringify(u===void 0?null:u),o=Pt(a,j.__wbindgen_malloc,j.__wbindgen_realloc),l=nt;de()[i/4+1]=l,de()[i/4+0]=o},e.wbg.__wbindgen_object_drop_ref=function(i){it(i)},e.wbg.__wbindgen_string_new=function(i,s){var u=fr(i,s);return Ue(u)},e.wbg.__wbg_new0_57a6a2c2aaed3fc5=function(){var i=new Date;return Ue(i)},e.wbg.__wbg_getTime_f8ce0ff902444efb=function(i){var s=Ot(i).getTime();return s},e.wbg.__wbg_getTimezoneOffset_41211a984662508b=function(i){var s=Ot(i).getTimezoneOffset();return s},e.wbg.__wbg_new_693216e109162396=function(){var i=new Error;return Ue(i)},e.wbg.__wbg_stack_0ddaca5d1abfb52f=function(i,s){var u=Ot(s).stack,a=Pt(u,j.__wbindgen_malloc,j.__wbindgen_realloc),o=nt;de()[i/4+1]=o,de()[i/4+0]=a},e.wbg.__wbg_error_09919627ac0992f5=function(i,s){try{console.error(fr(i,s))}finally{j.__wbindgen_free(i,s)}},e.wbg.__wbindgen_throw=function(i,s){throw new Error(fr(i,s))},(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Fl(await r,e);return j=t.exports,gs.__wbindgen_wasm_module=n,j}var bl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function xl(r){for(var e=0,t=0,n=0,i=0,s="",u=0;u<r.length;u++){var a=r[u];if(u>0&&(s+=";"),a.length!==0){for(var o=0,l=[],h=0,c=a;h<c.length;h++){var f=c[h],g=It(f[0]-o);o=f[0],f.length>1&&(g+=It(f[1]-e)+It(f[2]-t)+It(f[3]-n),e=f[1],t=f[2],n=f[3]),f.length===5&&(g+=It(f[4]-i),i=f[4]),l.push(g)}s+=l.join(",")}}return s}function It(r){var e="";r=r<0?-r<<1|1:r<<1;do{var t=r&31;r>>>=5,r>0&&(t|=32),e+=bl[t]}while(r>0);return e}class gr{constructor(e){this.bits=e instanceof gr?e.bits.slice():[]}add(e){this.bits[e>>5]|=1<<(e&31)}has(e){return!!(this.bits[e>>5]&1<<(e&31))}}class Nt{constructor(e,t,n){this.start=e,this.end=t,this.original=n,this.intro="",this.outro="",this.content=n,this.storeName=!1,this.edited=!1,Object.defineProperties(this,{previous:{writable:!0,value:null},next:{writable:!0,value:null}})}appendLeft(e){this.outro+=e}appendRight(e){this.intro=this.intro+e}clone(){const e=new Nt(this.start,this.end,this.original);return e.intro=this.intro,e.outro=this.outro,e.content=this.content,e.storeName=this.storeName,e.edited=this.edited,e}contains(e){return this.start<e&&e<this.end}eachNext(e){let t=this;for(;t;)e(t),t=t.next}eachPrevious(e){let t=this;for(;t;)e(t),t=t.previous}edit(e,t,n){return this.content=e,n||(this.intro="",this.outro=""),this.storeName=t,this.edited=!0,this}prependLeft(e){this.outro=e+this.outro}prependRight(e){this.intro=e+this.intro}split(e){const t=e-this.start,n=this.original.slice(0,t),i=this.original.slice(t);this.original=n;const s=new Nt(e,this.end,i);return s.outro=this.outro,this.outro="",this.end=e,this.edited?(s.edit("",!1),this.content=""):this.content=n,s.next=this.next,s.next&&(s.next.previous=s),s.previous=this,this.next=s,s}toString(){return this.intro+this.content+this.outro}trimEnd(e){if(this.outro=this.outro.replace(e,""),this.outro.length)return!0;const t=this.content.replace(e,"");if(t.length)return t!==this.content&&this.split(this.start+t.length).edit("",void 0,!0),!0;if(this.edit("",void 0,!0),this.intro=this.intro.replace(e,""),this.intro.length)return!0}trimStart(e){if(this.intro=this.intro.replace(e,""),this.intro.length)return!0;const t=this.content.replace(e,"");if(t.length)return t!==this.content&&(this.split(this.end-t.length),this.edit("",void 0,!0)),!0;if(this.edit("",void 0,!0),this.outro=this.outro.replace(e,""),this.outro.length)return!0}}let Dn=()=>{throw new Error("Unsupported environment: `window.btoa` or `Buffer` should be supported.")};typeof window<"u"&&typeof window.btoa=="function"?Dn=r=>window.btoa(unescape(encodeURIComponent(r))):typeof Buffer=="function"&&(Dn=r=>Buffer.from(r,"utf-8").toString("base64"));class _l{constructor(e){this.version=3,this.file=e.file,this.sources=e.sources,this.sourcesContent=e.sourcesContent,this.names=e.names,this.mappings=xl(e.mappings)}toString(){return JSON.stringify(this)}toUrl(){return"data:application/json;charset=utf-8;base64,"+Dn(this.toString())}}function Sl(r){const e=r.split(`
`),t=e.filter(s=>/^\t+/.test(s)),n=e.filter(s=>/^ {2,}/.test(s));if(t.length===0&&n.length===0)return null;if(t.length>=n.length)return"	";const i=n.reduce((s,u)=>{const a=/^ +/.exec(u)[0].length;return Math.min(a,s)},1/0);return new Array(i+1).join(" ")}function kl(r,e){const t=r.split(/[/\\]/),n=e.split(/[/\\]/);for(t.pop();t[0]===n[0];)t.shift(),n.shift();if(t.length){let i=t.length;for(;i--;)t[i]=".."}return t.concat(n).join("/")}const Bl=Object.prototype.toString;function Rl(r){return Bl.call(r)==="[object Object]"}function Ds(r){const e=r.split(`
`),t=[];for(let n=0,i=0;n<e.length;n++)t.push(i),i+=e[n].length+1;return function(i){let s=0,u=t.length;for(;s<u;){const l=s+u>>1;i<t[l]?u=l:s=l+1}const a=s-1,o=i-t[a];return{line:a,column:o}}}class Tl{constructor(e){this.hires=e,this.generatedCodeLine=0,this.generatedCodeColumn=0,this.raw=[],this.rawSegments=this.raw[this.generatedCodeLine]=[],this.pending=null}addEdit(e,t,n,i){if(t.length){const s=[this.generatedCodeColumn,e,n.line,n.column];i>=0&&s.push(i),this.rawSegments.push(s)}else this.pending&&this.rawSegments.push(this.pending);this.advance(t),this.pending=null}addUneditedChunk(e,t,n,i,s){let u=t.start,a=!0;for(;u<t.end;)(this.hires||a||s.has(u))&&this.rawSegments.push([this.generatedCodeColumn,e,i.line,i.column]),n[u]===`
`?(i.line+=1,i.column=0,this.generatedCodeLine+=1,this.raw[this.generatedCodeLine]=this.rawSegments=[],this.generatedCodeColumn=0,a=!0):(i.column+=1,this.generatedCodeColumn+=1,a=!1),u+=1;this.pending=null}advance(e){if(!e)return;const t=e.split(`
`);if(t.length>1){for(let n=0;n<t.length-1;n++)this.generatedCodeLine++,this.raw[this.generatedCodeLine]=this.rawSegments=[];this.generatedCodeColumn=0}this.generatedCodeColumn+=t[t.length-1].length}}const Lt=`
`,yt={insertLeft:!1,insertRight:!1,storeName:!1};class mn{constructor(e,t={}){const n=new Nt(0,e.length,e);Object.defineProperties(this,{original:{writable:!0,value:e},outro:{writable:!0,value:""},intro:{writable:!0,value:""},firstChunk:{writable:!0,value:n},lastChunk:{writable:!0,value:n},lastSearchedChunk:{writable:!0,value:n},byStart:{writable:!0,value:{}},byEnd:{writable:!0,value:{}},filename:{writable:!0,value:t.filename},indentExclusionRanges:{writable:!0,value:t.indentExclusionRanges},sourcemapLocations:{writable:!0,value:new gr},storedNames:{writable:!0,value:{}},indentStr:{writable:!0,value:Sl(e)}}),this.byStart[0]=n,this.byEnd[e.length]=n}addSourcemapLocation(e){this.sourcemapLocations.add(e)}append(e){if(typeof e!="string")throw new TypeError("outro content must be a string");return this.outro+=e,this}appendLeft(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const n=this.byEnd[e];return n?n.appendLeft(t):this.intro+=t,this}appendRight(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const n=this.byStart[e];return n?n.appendRight(t):this.outro+=t,this}clone(){const e=new mn(this.original,{filename:this.filename});let t=this.firstChunk,n=e.firstChunk=e.lastSearchedChunk=t.clone();for(;t;){e.byStart[n.start]=n,e.byEnd[n.end]=n;const i=t.next,s=i&&i.clone();s&&(n.next=s,s.previous=n,n=s),t=i}return e.lastChunk=n,this.indentExclusionRanges&&(e.indentExclusionRanges=this.indentExclusionRanges.slice()),e.sourcemapLocations=new gr(this.sourcemapLocations),e.intro=this.intro,e.outro=this.outro,e}generateDecodedMap(e){e=e||{};const t=0,n=Object.keys(this.storedNames),i=new Tl(e.hires),s=Ds(this.original);return this.intro&&i.advance(this.intro),this.firstChunk.eachNext(u=>{const a=s(u.start);u.intro.length&&i.advance(u.intro),u.edited?i.addEdit(t,u.content,a,u.storeName?n.indexOf(u.original):-1):i.addUneditedChunk(t,u,this.original,a,this.sourcemapLocations),u.outro.length&&i.advance(u.outro)}),{file:e.file?e.file.split(/[/\\]/).pop():null,sources:[e.source?kl(e.file||"",e.source):null],sourcesContent:e.includeContent?[this.original]:[null],names:n,mappings:i.raw}}generateMap(e){return new _l(this.generateDecodedMap(e))}getIndentString(){return this.indentStr===null?"	":this.indentStr}indent(e,t){const n=/^[^\r\n]/gm;if(Rl(e)&&(t=e,e=void 0),e=e!==void 0?e:this.indentStr||"	",e==="")return this;t=t||{};const i={};t.exclude&&(typeof t.exclude[0]=="number"?[t.exclude]:t.exclude).forEach(h=>{for(let c=h[0];c<h[1];c+=1)i[c]=!0});let s=t.indentStart!==!1;const u=l=>s?`${e}${l}`:(s=!0,l);this.intro=this.intro.replace(n,u);let a=0,o=this.firstChunk;for(;o;){const l=o.end;if(o.edited)i[a]||(o.content=o.content.replace(n,u),o.content.length&&(s=o.content[o.content.length-1]===`
`));else for(a=o.start;a<l;){if(!i[a]){const h=this.original[a];h===`
`?s=!0:h!=="\r"&&s&&(s=!1,a===o.start||(this._splitChunk(o,a),o=o.next),o.prependRight(e))}a+=1}a=o.end,o=o.next}return this.outro=this.outro.replace(n,u),this}insert(){throw new Error("magicString.insert(...) is deprecated. Use prependRight(...) or appendLeft(...)")}insertLeft(e,t){return yt.insertLeft||(console.warn("magicString.insertLeft(...) is deprecated. Use magicString.appendLeft(...) instead"),yt.insertLeft=!0),this.appendLeft(e,t)}insertRight(e,t){return yt.insertRight||(console.warn("magicString.insertRight(...) is deprecated. Use magicString.prependRight(...) instead"),yt.insertRight=!0),this.prependRight(e,t)}move(e,t,n){if(n>=e&&n<=t)throw new Error("Cannot move a selection inside itself");this._split(e),this._split(t),this._split(n);const i=this.byStart[e],s=this.byEnd[t],u=i.previous,a=s.next,o=this.byStart[n];if(!o&&s===this.lastChunk)return this;const l=o?o.previous:this.lastChunk;return u&&(u.next=a),a&&(a.previous=u),l&&(l.next=i),o&&(o.previous=s),i.previous||(this.firstChunk=s.next),s.next||(this.lastChunk=i.previous,this.lastChunk.next=null),i.previous=l,s.next=o||null,l||(this.firstChunk=i),o||(this.lastChunk=s),this}overwrite(e,t,n,i){if(typeof n!="string")throw new TypeError("replacement content must be a string");for(;e<0;)e+=this.original.length;for(;t<0;)t+=this.original.length;if(t>this.original.length)throw new Error("end is out of bounds");if(e===t)throw new Error("Cannot overwrite a zero-length range \u2013 use appendLeft or prependRight instead");this._split(e),this._split(t),i===!0&&(yt.storeName||(console.warn("The final argument to magicString.overwrite(...) should be an options object. See https://github.com/rich-harris/magic-string"),yt.storeName=!0),i={storeName:!0});const s=i!==void 0?i.storeName:!1,u=i!==void 0?i.contentOnly:!1;if(s){const l=this.original.slice(e,t);Object.defineProperty(this.storedNames,l,{writable:!0,value:!0,enumerable:!0})}const a=this.byStart[e],o=this.byEnd[t];if(a){let l=a;for(;l!==o;){if(l.next!==this.byStart[l.end])throw new Error("Cannot overwrite across a split point");l=l.next,l.edit("",!1)}a.edit(n,s,u)}else{const l=new Nt(e,t,"").edit(n,s);o.next=l,l.previous=o}return this}prepend(e){if(typeof e!="string")throw new TypeError("outro content must be a string");return this.intro=e+this.intro,this}prependLeft(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const n=this.byEnd[e];return n?n.prependLeft(t):this.intro=t+this.intro,this}prependRight(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const n=this.byStart[e];return n?n.prependRight(t):this.outro=t+this.outro,this}remove(e,t){for(;e<0;)e+=this.original.length;for(;t<0;)t+=this.original.length;if(e===t)return this;if(e<0||t>this.original.length)throw new Error("Character is out of bounds");if(e>t)throw new Error("end must be greater than start");this._split(e),this._split(t);let n=this.byStart[e];for(;n;)n.intro="",n.outro="",n.edit(""),n=t>n.end?this.byStart[n.end]:null;return this}lastChar(){if(this.outro.length)return this.outro[this.outro.length-1];let e=this.lastChunk;do{if(e.outro.length)return e.outro[e.outro.length-1];if(e.content.length)return e.content[e.content.length-1];if(e.intro.length)return e.intro[e.intro.length-1]}while(e=e.previous);return this.intro.length?this.intro[this.intro.length-1]:""}lastLine(){let e=this.outro.lastIndexOf(Lt);if(e!==-1)return this.outro.substr(e+1);let t=this.outro,n=this.lastChunk;do{if(n.outro.length>0){if(e=n.outro.lastIndexOf(Lt),e!==-1)return n.outro.substr(e+1)+t;t=n.outro+t}if(n.content.length>0){if(e=n.content.lastIndexOf(Lt),e!==-1)return n.content.substr(e+1)+t;t=n.content+t}if(n.intro.length>0){if(e=n.intro.lastIndexOf(Lt),e!==-1)return n.intro.substr(e+1)+t;t=n.intro+t}}while(n=n.previous);return e=this.intro.lastIndexOf(Lt),e!==-1?this.intro.substr(e+1)+t:this.intro+t}slice(e=0,t=this.original.length){for(;e<0;)e+=this.original.length;for(;t<0;)t+=this.original.length;let n="",i=this.firstChunk;for(;i&&(i.start>e||i.end<=e);){if(i.start<t&&i.end>=t)return n;i=i.next}if(i&&i.edited&&i.start!==e)throw new Error(`Cannot use replaced character ${e} as slice start anchor.`);const s=i;for(;i;){i.intro&&(s!==i||i.start===e)&&(n+=i.intro);const u=i.start<t&&i.end>=t;if(u&&i.edited&&i.end!==t)throw new Error(`Cannot use replaced character ${t} as slice end anchor.`);const a=s===i?e-i.start:0,o=u?i.content.length+t-i.end:i.content.length;if(n+=i.content.slice(a,o),i.outro&&(!u||i.end===t)&&(n+=i.outro),u)break;i=i.next}return n}snip(e,t){const n=this.clone();return n.remove(0,e),n.remove(t,n.original.length),n}_split(e){if(this.byStart[e]||this.byEnd[e])return;let t=this.lastSearchedChunk;const n=e>t.end;for(;t;){if(t.contains(e))return this._splitChunk(t,e);t=n?this.byStart[t.end]:this.byEnd[t.start]}}_splitChunk(e,t){if(e.edited&&e.content.length){const i=Ds(this.original)(t);throw new Error(`Cannot split a chunk that has already been edited (${i.line}:${i.column} \u2013 "${e.original}")`)}const n=e.split(t);return this.byEnd[t]=e,this.byStart[t]=n,this.byEnd[n.end]=n,e===this.lastChunk&&(this.lastChunk=n),this.lastSearchedChunk=e,!0}toString(){let e=this.intro,t=this.firstChunk;for(;t;)e+=t.toString(),t=t.next;return e+this.outro}isEmpty(){let e=this.firstChunk;do if(e.intro.length&&e.intro.trim()||e.content.length&&e.content.trim()||e.outro.length&&e.outro.trim())return!1;while(e=e.next);return!0}length(){let e=this.firstChunk,t=0;do t+=e.intro.length+e.content.length+e.outro.length;while(e=e.next);return t}trimLines(){return this.trim("[\\r\\n]")}trim(e){return this.trimStart(e).trimEnd(e)}trimEndAborted(e){const t=new RegExp((e||"\\s")+"+$");if(this.outro=this.outro.replace(t,""),this.outro.length)return!0;let n=this.lastChunk;do{const i=n.end,s=n.trimEnd(t);if(n.end!==i&&(this.lastChunk===n&&(this.lastChunk=n.next),this.byEnd[n.end]=n,this.byStart[n.next.start]=n.next,this.byEnd[n.next.end]=n.next),s)return!0;n=n.previous}while(n);return!1}trimEnd(e){return this.trimEndAborted(e),this}trimStartAborted(e){const t=new RegExp("^"+(e||"\\s")+"+");if(this.intro=this.intro.replace(t,""),this.intro.length)return!0;let n=this.firstChunk;do{const i=n.end,s=n.trimStart(t);if(n.end!==i&&(n===this.lastChunk&&(this.lastChunk=n.next),this.byEnd[n.end]=n,this.byStart[n.next.start]=n.next,this.byEnd[n.next.end]=n.next),s)return!0;n=n.next}while(n);return!1}trimStart(e){return this.trimStartAborted(e),this}hasChanged(){return this.original!==this.toString()}replace(e,t){function n(s,u){return typeof t=="string"?t.replace(/\$(\$|&|\d+)/g,(a,o)=>o==="$"?"$":o==="&"?s[0]:+o<s.length?s[+o]:`$${o}`):t(...s,s.index,u,s.groups)}function i(s,u){let a;const o=[];for(;a=s.exec(u);)o.push(a);return o}if(typeof e!="string"&&e.global)i(e,this.original).forEach(u=>{u.index!=null&&this.overwrite(u.index,u.index+u[0].length,n(u,this.original))});else{const s=this.original.match(e);s&&s.index!=null&&this.overwrite(s.index,s.index+s[0].length,n(s,this.original))}return this}}function $l(r,e,t=0){const n=new mn(r),i=(a,o,l)=>n.overwrite(a-t,o-t,l),s=(a,o)=>n.slice(a-t,o-t);let u="";return e.forEach(a=>{if(a.type==="ExportDefaultDeclaration")i(a.span.start,a.span.end,`
___module.__default__ = ${s(a.decl.span.start,a.decl.span.end)};`);else if(a.type==="ExportDefaultExpression")i(a.span.start,a.span.end,`
___module.__default__ = ${s(a.expression.span.start,a.expression.span.end)};`);else if(a.type==="ExportDeclaration")i(a.span.start,a.span.end,s(a.declaration.span.start,a.declaration.span.end)),a.declaration.type==="ClassDeclaration"||a.declaration.type==="FunctionDeclaration"?u+=`
___module.${a.declaration.identifier.value} = ${a.declaration.identifier.value};`:a.declaration.type==="VariableDeclaration"&&a.declaration.declarations.forEach(o=>{u+=`
___module.${o.id.value} = ${o.id.value};`});else if(a.type==="ExportNamedDeclaration"){let o="";for(const{orig:l,exported:h}of a.specifiers)h.value==="default"?o+=`
___module.__default__ = ${l.value};`:o+=`
___module.${h.value} = ${l.value};`;i(a.span.start,a.span.end,o)}else if(a.type==="ImportDeclaration")if(a.specifiers.length===1&&a.specifiers[0].type==="ImportNamespaceSpecifier")i(a.span.start,a.span.end,`
const ${a.specifiers[0].local.value} = await ___require(${a.source.raw});`);else{const o=[];a.specifiers.forEach(h=>{h.type==="ImportDefaultSpecifier"?o.push(`__default__: ${h.local.value}`):h.type==="ImportSpecifier"&&(h.imported||(h.imported=h.local),o.push(`${h.imported.value}: ${h.local.value}`))});const l=o.length===0?`
await ___require(${a.source.raw});`:`
const {${o.join(", ")}} = await ___require(${a.source.raw});`;i(a.span.start,a.span.end,l)}}),n.toString()+u}class Ol{constructor(e){if(this.evaluatedModules=new Map,this.baseModules=new Map,this.env={},e)for(const[t,n]of e)this.registerModule(t,n)}async run(e,t={},n){return this.env=t,await this.eval(e,n)}clearCache(){this.evaluatedModules.clear()}registerModule(e,t){this.baseModules.set(e,t)}async eval(e,t){const n=this.evaluatedModules.get(e);if(n)return n;const i=$.dirname(e),s=e.endsWith(".js")?"ecmascript":"typescript";if(t||(t=await this.readFile(e).catch(()=>{})),!t)throw new Error(`File "${e}" not found`);if(Dr===null)throw new Error("You must call initRuntimes() before using the runtime");await Dr;let u=Cl(ps(t,{filename:$.basename(e),jsc:{parser:{syntax:s,preserveAllComments:!1,topLevelAwait:!0},target:"es2020"}}).code,{compress:!1,mangle:!1,format:{beautify:!0}}).code;const{type:a,body:o}=Al(u,{syntax:s,target:"es2022"}),l=o[0].span.start,h=$l(u,o,l),c={};try{await this.runSrc(h,Object.assign({},this.env,{___module:c,___require:f=>this.require(f,i)}))}catch(f){throw new Error(`Error in ${e}: ${f}`)}return this.evaluatedModules.set(e,c),c}async require(e,t){const n=this.baseModules.get(e);if(n)return typeof n=="function"?await n():n;if(e.startsWith("https://")){const u=await(await fetch(e)).text();return await this.eval(e,u)}if(e.startsWith(".")&&(e=$.join(t,e)),e.endsWith(".json")){const s=await this.readFile(e).catch(()=>{});if(s){let u={};try{u=$e.parse(s)}catch{throw new Error(`File "${e}" contains invalid JSON`)}return{__default__:u,...u}}}const i=[".ts",".js"];for(const s of i){const u=`${e}${s}`;let a=await this.readFile(u).catch(()=>{});if(!!a)return await this.eval(u,a)}throw new Error(`Module "${e}" not found`)}async runSrc(e,t){return new Function(...Object.keys(t),`return (async () => {
${e}
})()`)(...Object.values(t))}}let Dr=null;function Pl(r){Dr=gs(r).then(()=>null)}/*!
 * is-extglob <https://github.com/jonschlinkert/is-extglob>
 *
 * Copyright (c) 2014-2016, Jon Schlinkert.
 * Licensed under the MIT License.
 */var Il=function(e){if(typeof e!="string"||e==="")return!1;for(var t;t=/(\\).|([@?!+*]\(.*\))/g.exec(e);){if(t[2])return!0;e=e.slice(t.index+t[0].length)}return!1};/*!
 * is-glob <https://github.com/jonschlinkert/is-glob>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Nl=Il,ms={"{":"}","(":")","[":"]"},Ll=function(r){if(r[0]==="!")return!0;for(var e=0,t=-2,n=-2,i=-2,s=-2,u=-2;e<r.length;){if(r[e]==="*"||r[e+1]==="?"&&/[\].+)]/.test(r[e])||n!==-1&&r[e]==="["&&r[e+1]!=="]"&&(n<e&&(n=r.indexOf("]",e)),n>e&&(u===-1||u>n||(u=r.indexOf("\\",e),u===-1||u>n)))||i!==-1&&r[e]==="{"&&r[e+1]!=="}"&&(i=r.indexOf("}",e),i>e&&(u=r.indexOf("\\",e),u===-1||u>i))||s!==-1&&r[e]==="("&&r[e+1]==="?"&&/[:!=]/.test(r[e+2])&&r[e+3]!==")"&&(s=r.indexOf(")",e),s>e&&(u=r.indexOf("\\",e),u===-1||u>s))||t!==-1&&r[e]==="("&&r[e+1]!=="|"&&(t<e&&(t=r.indexOf("|",e)),t!==-1&&r[t+1]!==")"&&(s=r.indexOf(")",t),s>t&&(u=r.indexOf("\\",t),u===-1||u>s))))return!0;if(r[e]==="\\"){var a=r[e+1];e+=2;var o=ms[a];if(o){var l=r.indexOf(o,e);l!==-1&&(e=l+1)}if(r[e]==="!")return!0}else e++}return!1},Ml=function(r){if(r[0]==="!")return!0;for(var e=0;e<r.length;){if(/[*?{}()[\]]/.test(r[e]))return!0;if(r[e]==="\\"){var t=r[e+1];e+=2;var n=ms[t];if(n){var i=r.indexOf(n,e);i!==-1&&(e=i+1)}if(r[e]==="!")return!0}else e++}return!1},Hl=function(e,t){if(typeof e!="string"||e==="")return!1;if(Nl(e))return!0;var n=Ll;return t&&t.strict===!1&&(n=Ml),n(e)};class jl extends io{constructor(e,t){super($.dirname(t)),this.fileSystem=e,this.configPath=t}readConfig(){return this.fileSystem.readJson(this.configPath)}writeConfig(e){return this.fileSystem.writeJson(this.configPath,e)}}class Es{constructor(e,t,n){this.dash=e,this.pluginId=t,this.plugin=n}async runBuildStartHook(){var e,t;try{return await((t=(e=this.plugin).buildStart)==null?void 0:t.call(e))}catch(n){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "buildStart" hook:`,n)}}async runIncludeHook(){var e,t;try{return await((t=(e=this.plugin).include)==null?void 0:t.call(e))}catch(n){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "include" hook:`,n)}}async runTransformPathHook(e){var t,n;try{return await((n=(t=this.plugin).transformPath)==null?void 0:n.call(t,e))}catch(i){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "transformPath" hook for "${e}":`,i)}}async runReadHook(e,t){var n,i;try{return await((i=(n=this.plugin).read)==null?void 0:i.call(n,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "read" hook for "${e}":`,s)}}async runLoadHook(e,t){var n,i;try{return await((i=(n=this.plugin).load)==null?void 0:i.call(n,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "load" hook for "${e}":`,s)}}async runRegisterAliasesHook(e,t){var n,i;try{return await((i=(n=this.plugin).registerAliases)==null?void 0:i.call(n,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "registerAliases" hook for "${e}":`,s)}}async runRequireHook(e,t){var n,i;try{return await((i=(n=this.plugin).require)==null?void 0:i.call(n,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "require" hook for "${e}":`,s)}}async runTransformHook(e,t,n){var i,s;try{return await((s=(i=this.plugin).transform)==null?void 0:s.call(i,e,t,n))}catch(u){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "transform" hook for "${e}":`,u)}}async runFinalizeBuildHook(e,t){var n,i;try{return await((i=(n=this.plugin).finalizeBuild)==null?void 0:i.call(n,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "finalizeBuild" hook for "${e}":`,s)}}async runBuildEndHook(){var e,t;try{return await((t=(e=this.plugin).buildEnd)==null?void 0:t.call(e))}catch(n){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "buildEnd" hook:`,n)}}async runBeforeFileUnlinked(e){var t,n;try{return await((n=(t=this.plugin).beforeFileUnlinked)==null?void 0:n.call(t,e))}catch(i){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "beforeFileUnlinked" hook for "${e}":`,i)}}}const Ul=({options:r,outputFileSystem:e,hasComMojangDirectory:t,projectConfig:n,projectRoot:i,packType:s})=>{var u;r.buildName||(r.buildName=r.mode==="development"?"dev":"dist"),r.packName||(r.packName="Bridge"),(u=r.rewriteToComMojang)==null||u||(t=!1);const a={behaviorPack:"development_behavior_packs",resourcePack:"development_resource_packs",skinPack:"skin_packs",worldTemplate:"minecraftWorlds"},o=h=>t&&r.mode==="development"?`${a[h]}`:`${i}/builds/${r.buildName}`,l=(h,c)=>`${o(h)}/${r.packName} ${c}`;return{async buildStart(){if(r.mode==="production"||r.buildType==="fullBuild")if(t)for(const h in a){const c=s.getFromId(h);!c||await e.unlink(l(h,c.defaultPackPath)).catch(()=>{})}else await e.unlink(o("BP")).catch(()=>{})},transformPath(h){var c,f;if(!h||h.includes("BP/scripts/gametests/")&&r.mode==="production")return;const g=s==null?void 0:s.get(h);if(!g)return;const C=n.getAbsolutePackRoot(g.id),m=$.relative(C,h);if(["behaviorPack","resourcePack","skinPack","worldTemplate"].includes(g.id))return $.join(l(g.id,(f=(c=r.packNameSuffix)==null?void 0:c[g.id])!=null?f:g.defaultPackPath),m)}}},Wl=({fileType:r,projectConfig:e,requestJsonData:t,options:n,console:i,jsRuntime:s})=>{const u=(f,g)=>e.resolvePackPath(f,g),a=new El({}),o=f=>f==null?void 0:f.endsWith(".molang"),l=f=>f==null?void 0:f.startsWith(e.resolvePackPath("behaviorPack","scripts/molang/")),h=f=>{var g;return(g=Object.entries(n.include).find(([C])=>(r==null?void 0:r.getId(f))===C))==null?void 0:g[1]};let c=[];return{async buildStart(){n.include=Object.assign(await t("data/packages/minecraftBedrock/location/validMoLang.json"),n.include)},transformPath(f){if(o(f)||l(f))return null},async read(f,g){if((o(f)||l(f))&&g){const C=await g.getFile();return await(C==null?void 0:C.text())}else if(h(f)&&f.endsWith(".json")&&g){const C=await g.getFile();if(!C)return;try{return $e.parse(await C.text())}catch(m){return n.buildType!=="fileRequest"&&i.error(`Error within file "${f}": ${m}`),{__error__:`Failed to load original file: ${m}`}}}},async load(f,g){if(o(f)&&g)a.parse(g);else if(l(f)){const C=await s.run(f,{console:i},g).catch(m=>(i.error(`Failed to execute Molang AST script "${f}": ${m}`),null));if(!C)return null;typeof C.__default__=="function"&&c.push(C.__default__)}},async require(f){if(h(f))return[u("behaviorPack","scripts/molang/**/*.[jt]s"),u("behaviorPack","molang/**/*.molang"),u("resourcePack","molang/**/*.molang")]},async transform(f,g){const C=h(f);C&&C.length>0&&C.forEach(m=>xi(m,g,d=>{if(typeof d!="string"||d[0]==="/"||d[0]==="@")return d;if(c.length>0){let p=null;try{p=a.parse(d)}catch(w){n.buildType!=="fileRequest"&&i.error(`Error within file "${f}"; script "${d}": ${w}`)}if(p){for(const w of c)p=p.walk(w);d=p.toString()}}try{return a.transform(d)}catch(p){return n.buildType!=="fileRequest"&&i.error(`Error within file "${f}"; script "${d}": ${p}`),d}}))},finalizeBuild(f,g){if(h(f)&&typeof g!="string")return JSON.stringify(g,null,"	")},buildEnd(){c=[]}}},zl=({fileType:r})=>({registerAliases(e,t){var n,i,s,u;if((r==null?void 0:r.getId(e))==="entity"&&((i=(n=t==null?void 0:t["minecraft:entity"])==null?void 0:n.description)==null?void 0:i.identifier))return[(u=(s=t==null?void 0:t["minecraft:entity"])==null?void 0:s.description)==null?void 0:u.identifier]}});function Gl(r,e){const t=ys(r),n=ys(e),i=t.pop(),s=n.pop(),u=Cs(t,n);return u!==0?u:i&&s?Cs(i.split("."),s.split(".")):i||s?i?-1:1:0}const ql=(r,e,t)=>{Xl(t);const n=Gl(r,e);return As[t].includes(n)},Jl=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,ys=r=>{if(typeof r!="string")throw new TypeError("Invalid argument expected string");const e=r.match(Jl);if(!e)throw new Error(`Invalid argument not valid semver ('${r}' received)`);return e.shift(),e},vs=r=>r==="*"||r==="x"||r==="X",ws=r=>{const e=parseInt(r,10);return isNaN(e)?r:e},Vl=(r,e)=>typeof r!=typeof e?[String(r),String(e)]:[r,e],Kl=(r,e)=>{if(vs(r)||vs(e))return 0;const[t,n]=Vl(ws(r),ws(e));return t>n?1:t<n?-1:0},Cs=(r,e)=>{for(let t=0;t<Math.max(r.length,e.length);t++){const n=Kl(r[t]||0,e[t]||0);if(n!==0)return n}return 0},As={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]},Fs=Object.keys(As),Xl=r=>{if(typeof r!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof r}`);if(Fs.indexOf(r)===-1)throw new Error(`Invalid operator, expected one of ${Fs.join("|")}`)},Ql=(r,e)=>({register:t=>{var n;((n=t.type)!=null?n:"entity")===e&&(r.component=({name:i,schema:s,template:u})=>{const a=new t;i(t.component_name),s(En(Object.values(a.onPropose())[0])),u((o,{create:l})=>{l(a.onApply(o,"components")[`minecraft:${e}`])})})}});function En(r){const e={},t=Object.keys(r);if(t.length===1&&t[0].startsWith("$dynamic.list."))return{type:"array",items:En(Object.values(r)[0])};for(const[n,i]of Object.entries(r))n.startsWith("$")||(typeof i=="string"?e[n]=Yl(i):Array.isArray(i)?e[n]={enum:i}:i==="object"&&(e[n]=En(i)));return{type:"object",properties:e}}function Yl(r){switch(r){case"$general.boolean":return{type:"boolean"};case"$general.number":return{type:"integer"};case"$general.decimal":return{type:"number"};default:return{type:["number","integer","string","boolean","object","array"]}}}class Zl{constructor(e,t,n,i,s,u){this.console=e,this.fileType=t,this.componentSrc=n,this.mode=i,this.v1Compat=s,this.targetVersion=u,this.animations=[],this.animationControllers=[],this.createOnPlayer=[],this.dialogueScenes={},this.serverFiles=[],this.clientFiles={},this.lifecycleHookCount={activated:0,deactivated:0}}setProjectConfig(e){this.projectConfig=e}get name(){return this._name}async load(e,t,n){let i={component:null};const s=await e.run(t,{defineComponent:l=>l,console:this.console,Bridge:this.v1Compat?Ql(i,this.fileType):void 0}).catch(()=>(this.console.error(`Failed to execute component ${t}`),null));if(!s)return!1;if(typeof s.__default__!="function")if(i.component)s.__default__=i.component;else return this.console.error(`Component ${t} is not a valid component. Expected a function as the default export.`),!1;const u=l=>this._name=l;let a=l=>this.schema=l,o=()=>{};return(!n||n==="server")&&(a=()=>{},o=l=>{this.template=(h,c)=>{try{l(h,c)}catch(f){this.console.log(l.toString()),this.console.error(f)}}}),await s.__default__({name:u,schema:a,template:o}),!0}reset(){this.animations=[],this.animationControllers=[],this.clientFiles={},this.serverFiles=[]}getSchema(){return this.schema}toString(){return this.componentSrc}create(e,t,n=`minecraft:${this.fileType}`,i){var s;const u=n.split("/"),a=u.pop(),o=this.getObjAtLocation(e,[...u]);o[a]=(i?(l,h)=>i(bt,l,h):bt)((s=o[a])!=null?s:{},t!=null?t:{})}getObjAtLocation(e,t){let n=e;for(;t.length>0;){const i=t.shift();n[i]===void 0?n[Number(i)]!==void 0?n=n[Number(i)]:(n[i]={},n=n[i]):n=n[i]}return n}async processTemplates(e,t,n){var i,s,u,a,o,l;if(typeof this.template!="function")return;const h=(u=(s=(i=e[`minecraft:${this.fileType}`])==null?void 0:i.description)==null?void 0:s.identifier)!=null?u:"bridge:no_identifier",c=await Qr(`${this.name}/${h}`),f=(l=(o=(a=this.projectConfig)==null?void 0:a.get())==null?void 0:o.namespace)!=null?l:"bridge",g=(x,B)=>(this.animations.push([x,B]),this.getShortAnimName("a",c,this.animations.length-1)),C=(x,B)=>(this.animationControllers.push([x,B]),this.getShortAnimName("ac",c,this.animationControllers.length-1)),m=x=>{const B=`loot_tables/bridge/${this.getShortAnimName("lt",c,this.serverFiles.length)}.json`;return this.serverFiles.push([B,x]),B},d=x=>{const B=`trading/bridge/${this.getShortAnimName("tt",c,this.serverFiles.length)}.json`;return this.serverFiles.push([B,x]),B},p=x=>{this.serverFiles.push([`recipes/bridge/${this.getShortAnimName("recipe",c,this.serverFiles.length)}.json`,x])},w=x=>{this.serverFiles.push([`spawn_rules/bridge/${this.getShortAnimName("sr",c,this.serverFiles.length)}.json`,x])},F=(await Qr(`${this.name}/${n}`)).slice(0,16),A=x=>this.registerLifecycleHook(e,n,x,F,"activated"),b=x=>this.registerLifecycleHook(e,n,x,F,"deactivated");this.fileType==="entity"?this.template(t!=null?t:{},{mode:this.mode,compilerMode:this.mode,sourceEntity:()=>JSON.parse(JSON.stringify(e)),create:(x,B,_)=>this.create(e,x,B,_),location:n,identifier:h,projectNamespace:f,animationController:C,animation:g,lootTable:m,tradeTable:d,spawnRule:w,dialogueScene:!this.targetVersion||ql(this.targetVersion,"1.17.10",">=")?(x,B=!0)=>{this.dialogueScenes[c]||(this.dialogueScenes[c]=[]),this.dialogueScenes[c].push(x),x.scene_tag&&B&&A({run_command:{command:[`/dialogue open @s @p ${x.scene_tag}`]}})}:void 0,onActivated:A,onDeactivated:b,client:{create:(x,B="1.10.0")=>{this.clientFiles[`entity/bridge/${c}.json`]={format_version:B,"minecraft:client_entity":Object.assign({description:{identifier:h}},x)}}}}):this.fileType==="item"?this.template(t!=null?t:{},{mode:this.mode,compilerMode:this.mode,sourceItem:()=>JSON.parse(JSON.stringify(e)),create:(x,B,_)=>this.create(e,x,B,_),location:n,identifier:h,projectNamespace:f,lootTable:m,recipe:p,player:{animationController:C,animation:g,create:(x,B,_)=>this.createOnPlayer.push([B!=null?B:"minecraft:entity",x,_])}}):this.fileType==="block"&&this.template(t!=null?t:{},{mode:this.mode,compilerMode:this.mode,sourceBlock:()=>JSON.parse(JSON.stringify(e)),create:(x,B,_)=>this.create(e,x,B,_),lootTable:m,recipe:p,location:n,identifier:h,projectNamespace:f})}async processAdditionalFiles(e,t){var n,i,s,u,a,o;const l=(i=(n=this.projectConfig)==null?void 0:n.getRelativePackRoot("behaviorPack"))!=null?i:"BP",h=(s=this.projectConfig)==null?void 0:s.getRelativePackRoot("resourcePack"),c=(o=(a=(u=t[`minecraft:${this.fileType}`])==null?void 0:u.description)==null?void 0:a.identifier)!=null?o:"bridge:no_identifier",f=await Qr(`${this.name}/${c}`),g=`${l}/animations/bridge/${f}.json`,C=`${l}/animation_controllers/bridge/${f}.json`;return c==="minecraft:player"&&this.createOnPlayer.forEach(([m,d,p])=>{this.create(t,d,m,p)}),h||(this.clientFiles={},this.console.error(`[${this.name}] Dash was unable to load the root of your resource pack and therefore cannot generate client files for this component.`)),{[g]:{baseFile:e,fileContent:this.createAnimations(f,t)},[C]:{baseFile:e,fileContent:this.createAnimationControllers(f,t)},[$.join(l,`dialogue/bridge/${f}.json`)]:this.dialogueScenes[f]&&this.dialogueScenes[f].length>0?{baseFile:e,fileContent:JSON.stringify({format_version:this.targetVersion,"minecraft:npc_dialogue":{scenes:this.dialogueScenes[f]}},null,"	")}:void 0,...Object.fromEntries(this.serverFiles.map(([m,d])=>[$.join(l,m),{baseFile:e,fileContent:JSON.stringify(d,null,"	")}])),...Object.fromEntries(Object.entries(this.clientFiles).map(([m,d])=>[$.join(h,m),{baseFile:e,fileContent:JSON.stringify(d,null,"	")}]))}}createAnimations(e,t){if(this.animations.length===0)return;let n=0;const i={format_version:"1.10.0",animations:{}};for(const[s,u]of this.animations){if(!s){n++;continue}const a=this.getAnimName("animation",e,n),o=this.getShortAnimName("a",e,n);i.animations[a]=s,this.create(t,{animations:{[o]:a}},"minecraft:entity/description"),u!==!1&&this.create(t,{scripts:{animate:[u?{[o]:u}:o]}},"minecraft:entity/description"),n++}return JSON.stringify(i,null,"	")}createAnimationControllers(e,t){if(this.animationControllers.length===0)return;let n=0;const i={format_version:"1.10.0",animation_controllers:{}};for(const[s,u]of this.animationControllers){if(!s){n++;continue}const a=this.getAnimName("controller.animation",e,n),o=this.getShortAnimName("ac",e,n);i.animation_controllers[a]=s,this.create(t,{animations:{[o]:a}},"minecraft:entity/description"),u!==!1&&this.create(t,{scripts:{animate:[u?{[o]:u}:o]}},"minecraft:entity/description"),n++}return JSON.stringify(i,null,"	")}getAnimName(e,t,n){return`${e}.${t}_${n}`}getShortAnimName(e,t,n){var i;return`${(i=t.slice(0,16))!=null?i:"bridge_auto"}_${e}_${n}`}registerLifecycleHook(e,t,n,i,s){e[`minecraft:${this.fileType}`].events||(e[`minecraft:${this.fileType}`].events={});const u=e[`minecraft:${this.fileType}`].events;if(s==="activated"&&t===`minecraft:${this.fileType}/components`)u["minecraft:entity_spawned"]||(u["minecraft:entity_spawned"]={}),this.addEventReponse(u["minecraft:entity_spawned"],n);else if(this.fileType==="entity"&&t.startsWith(`minecraft:${this.fileType}/component_groups/`)){const a=t.split("/").pop();this.findComponentGroupReferences(u,s==="activated"?"add":"remove",a).forEach(l=>this.addEventReponse(l,n))}else if(t.startsWith(`minecraft:${this.fileType}/permutations/`)){const a=t.split("/");if(a.pop()!=="components")throw new Error("Invalid component location inside of permutation");const o=this.getObjAtLocation(e,[...a]),l=`bridge:${i}_${s}_${s==="activated"?this.lifecycleHookCount.activated++:this.lifecycleHookCount.deactivated++}`;o.condition&&this.animationControllers.push([{states:{default:{on_entry:[`@s ${l}`]}}},s==="activated"?o.condition:`!(${o.condition})`]),u[l]=n}}addEventReponse(e,t){if(Array.isArray(e.sequence))e.sequence.push(t);else if(Object.keys(e).length===0)Object.assign(e,t);else{let n=Object.assign({},e,{filters:void 0});for(const i in e)i!=="filters"&&(e[i]=void 0);e.sequence=[n,t]}}findComponentGroupReferences(e,t,n){var i,s;let u=[];for(const a in e){const o=e[a];Array.isArray(o.sequence)?u.push(...this.findComponentGroupReferences(o.sequence,t,n)):Array.isArray(o.randomize)?u.push(...this.findComponentGroupReferences(o.randomize,t,n)):((s=(i=o[t])==null?void 0:i.component_groups)!=null?s:[]).includes(n)&&u.push(o)}return u}}function ec(r){const e=[];for(const[t,n]of r)e.push(...tc(n,t));return e}function tc(r,e){const t=[];for(const n in r)n.startsWith("minecraft:")||n.startsWith("tag:")||t.push([n,e]);return t}function yn({fileType:r,getComponentObjects:e}){const t=new Map;let n={};return({console:i,projectConfig:s,projectRoot:u,compileFiles:a,getAliases:o,options:l,jsRuntime:h,targetVersion:c,fileType:f})=>{const g=(d,p)=>d&&r==="item"&&(f==null?void 0:f.getId(d))==="entity"&&p(d).includes("minecraft:player"),C=d=>l.v1CompatMode?d==null?void 0:d.includes("/components/"):d&&(f==null?void 0:f.getId(d))==="customComponent"&&d.includes(`/${r}/`),m=d=>d&&(f==null?void 0:f.getId(d))===r;return{buildStart(){t.clear(),n={}},transformPath(d){if(C(d)&&l.buildType!=="fileRequest")return null},async read(d,p){if(!p)return n[d]?$e.parse(n[d].fileContent):void 0;if(C(d)&&d.endsWith(".js")){const w=await p.getFile();return await(w==null?void 0:w.text())}else if(m(d)||g(d,o)){const w=await p.getFile();if(!w)return;try{return $e.parse(await w.text())}catch(F){return l.buildType!=="fileRequest"&&i.error(`Error within file "${d}": ${F}`),{__error__:`Failed to load original file: ${F}`}}}},async load(d,p){if(C(d)&&typeof p=="string"){const w=new Zl(i,r,p,l.mode,!!l.v1CompatMode,c);return w.setProjectConfig(s),await w.load(h,d)?w:p}},async registerAliases(d,p){if(C(d))return[`${r}Component#${p.name}`]},async require(d,p){if(g(d,o))return[`.${s.getRelativePackRoot("behaviorPack")}/components/item/**/*.[jt]s`,`.${s.getRelativePackRoot("behaviorPack")}/items/**/*.json`];if(m(d)){const w=ec(e(p));return t.set(d,w),w.map(F=>`${r}Component#${F[0]}`)}else if(n[d])return[n[d].baseFile]},async transform(d,p,w={}){var F;if(g(d,o)){const A=Object.entries(w).filter(([b])=>b.startsWith("itemComponent#")).map(([b,x])=>x);for(const b of A){if(!b)return;n=bt(n,await b.processAdditionalFiles(d,p))}}else if(m(d)){const A=new Set;for(const[b,x]of(F=t.get(d))!=null?F:[]){const B=w[`${r}Component#${b}`];if(!B)continue;const _=ja(p,x.split("/"),{}),R=_[b];delete _[b],await B.processTemplates(p,R,x),A.add(B)}for(const b of A)n=bt(n,await b.processAdditionalFiles(d,p));for(const b of A)b.reset()}},finalizeBuild(d,p){if(C(d)&&p)return p.toString();if(m(d)||n[d])return JSON.stringify(p,null,"	")},async buildEnd(){if(l.buildType==="fileRequest")return;n=Object.fromEntries(Object.entries(n).filter(([p,w])=>(w==null?void 0:w.fileContent)!==void 0).map(([p,w])=>[$.join(u,p),w]));const d=Object.keys(n);d.length>0&&await a(d),n={}}}}}const rc=yn({fileType:"entity",getComponentObjects:r=>{var e,t,n,i,s,u;return[["minecraft:entity/components",(t=(e=r==null?void 0:r["minecraft:entity"])==null?void 0:e.components)!=null?t:{}],...Object.entries((i=(n=r==null?void 0:r["minecraft:entity"])==null?void 0:n.component_groups)!=null?i:{}).map(([a,o])=>[`minecraft:entity/component_groups/${a}`,o]),...((u=(s=r==null?void 0:r["minecraft:entity"])==null?void 0:s.permutations)!=null?u:[]).map((a,o)=>{var l;return[`minecraft:entity/permutations/${o}/components`,(l=a==null?void 0:a.components)!=null?l:{}]})]}}),nc=yn({fileType:"item",getComponentObjects:r=>{var e,t;return[["minecraft:item/components",(t=(e=r==null?void 0:r["minecraft:item"])==null?void 0:e.components)!=null?t:{}]]}}),ic=yn({fileType:"block",getComponentObjects:r=>{var e,t,n,i;return[["minecraft:block/components",(t=(e=r==null?void 0:r["minecraft:block"])==null?void 0:e.components)!=null?t:{}],...((i=(n=r==null?void 0:r["minecraft:block"])==null?void 0:n.permutations)!=null?i:[]).map((s,u)=>{var a;return[`minecraft:block/permutations/${u}/components`,(a=s.components)!=null?a:{}]})]}});function vn(r,e,t,n=0){const i=[];for(const s of r){if(!s.startsWith("/")){i.push(s);continue}const[u,...a]=_i(s.slice(1)).tokens.map(({word:l})=>l),o=e[`command#${u}`];if(u==="execute"){let l=4;if(a[l]==="detect"&&(l+=6),a[l]===void 0){i.push(s);continue}const[h,...c]=a.slice(l),f=e[`command#${h}`];if(!(f instanceof wn)){i.push(s);continue}i.push(...f.process(`${h} ${c.join(" ")}`,e,n+1).map(g=>g.startsWith("/")?`/execute ${a.slice(0,l).join(" ")} ${g.slice(1)}`:g));continue}else if(!(o instanceof wn)){i.push(s);continue}i.push(...o.process(s,e,n))}return i.filter(s=>t||!s.startsWith("#")).map(s=>s.trim())}const sc=r=>({register:e=>{r.command=({name:t,schema:n,template:i})=>{t(e.command_name),n([]),i(s=>new e().onApply(s))}}});class wn{constructor(e,t,n,i){this.console=e,this.commandSrc=t,this.mode=n,this.v1Compat=i}get name(){var e;return(e=this._name)!=null?e:"unknown"}async load(e,t,n){const i={command:null},s=await e.run(t,{console:this.console,defineCommand:l=>l,Bridge:this.v1Compat?sc(i):void 0}).catch(l=>(this.console.error(`Failed to execute command ${this.name}: ${l}`),null));if(!s)return null;if(typeof s.__default__!="function")if(i.command)s.__default__=i.command;else return this.console.error(`Component ${t} is not a valid component. Expected a function as the default export.`),!1;const u=l=>this._name=l;let a=l=>this.schema=l,o=()=>{};(!n||n==="server")&&(a=()=>{},o=l=>{this.template=(h,c)=>{try{return l(h,c)}catch(f){return this.console.error(f),[]}}}),await s.__default__({name:u,schema:a,template:o})}process(e,t,n){var i;e.startsWith("/")&&(e=e.slice(1));const[s,...u]=_i(e).tokens.map(({word:l})=>l),a=(i=this.template)==null?void 0:i.call(this,u.map(l=>Ga(l)),{compilerMode:this.mode,commandNestingDepth:n,compileCommands:l=>vn(l.map(h=>h.startsWith("/")?h:`/${h}`),t,!1,n+1).map(h=>h.startsWith("/")?h.slice(1):h)});let o=[];if(typeof a=="string")o=a.split(`
`);else if(Array.isArray(a))o=a.filter(l=>typeof l=="string");else{const l=`Failed to process command ${this._name}; Invalid command template return type: Expected string[] or string, received ${typeof a}`;this.console.error(l),o.push(`# ${l}`)}return o.map(l=>l.startsWith("/")||l.startsWith("#")?l:`/${l}`)}getSchema(){if(this.schema){if(Array.isArray(this.schema))return this.schema.length===0?[{commandName:this.name}]:this.schema.map(e=>({commandName:this.name,...e}))}else return[{commandName:this.name}];return this.schema.commandName||(this.schema.commandName=this.name),[this.schema]}toString(){return this.commandSrc}}const uc=({projectConfig:r,jsRuntime:e,console:t,fileType:n,requestJsonData:i,options:s})=>{const u=(c,f)=>r.resolvePackPath(c,f),a=c=>c&&n.getId(c)==="customCommand",o=c=>c&&n.getId(c)==="function",l=c=>{var f;return(f=Object.entries(s.include).find(([g])=>n.getId(c)===g))==null?void 0:f[1]},h=c=>{var f,g,C;return(C=(g=(f=n.get(c))==null?void 0:f.meta)==null?void 0:g.commandsUseSlash)!=null?C:!1};return{async buildStart(){s.include=Object.assign(await i("data/packages/minecraftBedrock/location/validCommand.json"),s.include)},transformPath(c){if(a(c)&&s.buildType!=="fileRequest")return null},async read(c,f){if(!!f){if(a(c)&&c.endsWith(".js")){const g=await f.getFile();return await(g==null?void 0:g.text())}else if(o(c)){const g=await f.getFile();return await(g==null?void 0:g.text())}else if(l(c)&&f){const g=await f.getFile();if(!g)return;try{return $e.parse(await g.text())}catch(C){t.error(C)}}}},async load(c,f){var g;if(a(c)){const C=new wn(t,f,s.mode,(g=s.v1CompatMode)!=null?g:!1);return await C.load(e,c),C}},async registerAliases(c,f){if(a(c))return[`command#${f.name}`]},async require(c){if(l(c)||o(c))return[u("behaviorPack","commands/**/*.[jt]s"),u("behaviorPack","commands/*.[jt]s")]},async transform(c,f,g={}){const C=l(c);if(C&&C.length>0){const m=h(c);C.forEach(d=>xi(d,f,p=>{if(!p)return p;p=Array.isArray(p)?p:[p];const w=[];for(const F of p){if(typeof F=="string"){w.push(F);continue}t.error(`The file "${c}" contains invalid commands. Expected type "string" within array but got type "${typeof F}"`)}return vn(w.map(F=>!m&&!F.startsWith("/")?`/${F}`:F),g,!1).map(F=>m?F:F.slice(1))}))}else if(o(c)){const m=f.split(`
`).map(d=>d.trim()).filter(d=>d!==""&&!d.startsWith("#")).map(d=>`/${d}`);return vn(m,g,!0).map(d=>d.startsWith("/")?d.slice(1):d).join(`
`)}},finalizeBuild(c,f){if(a(c)&&f)return f.toString();if(l(c)&&typeof f!="string")return JSON.stringify(f,null,"	")}}},ac=({options:r})=>({async transformPath(e){if(!!(e!=null&&e.endsWith(".ts")))return`${e.slice(0,-3)}.js`},async read(e,t){if(!e.endsWith(".ts")||!t)return;const n=await t.getFile();return await(n==null?void 0:n.text())},async load(e,t){if(!!e.endsWith(".ts"))return await Dr,ps(t,{filename:$.basename(e),sourceMaps:r!=null&&r.inlineSourceMap?"inline":void 0,jsc:{parser:{syntax:"typescript"},target:"es2020"}}).code},finalizeBuild(e,t){if(e.endsWith(".ts")&&typeof t=="string")return t}}),oc=({options:r,outputFileSystem:e,projectRoot:t,packType:n,fileType:i,console:s})=>{r.packName||(r.packName="bridge project");const u=h=>h.split(/\\|\//g).filter(c=>c!==".."&&c!==".").slice(1).join("/"),a=h=>{const c=n.getId(h),f=$.relative(t,h);if(c==="behaviorPack"||c==="resourcePack"||c==="skinPack")return $.join(t,"builds/dist",c,u(f))},o=h=>{const c=n.getId(h),f=$.relative(t,h);if(c==="worldTemplate")return $.join(t,"builds/dist",u(f));if(c==="behaviorPack"||c==="resourcePack")return $.join(t,"builds/dist",c==="behaviorPack"?"behavior_packs":"resource_packs",r.packName,u(f))},l=h=>i.getId(h)==="worldManifest"?null:o(h);return{async buildStart(){await e.unlink(`${t}/builds/dist`).catch(()=>{})},transformPath(h){if(!!h)switch(r.format){case"mcaddon":return a(h);case"mcworld":return l(h);case"mctemplate":return o(h);default:s.error(`Unknown packaging format: ${r.format}`)}}}},lc=({projectConfig:r,packType:e,options:t})=>{const n=Object.keys(r.getAvailablePacks()),i=Object.fromEntries(n.map(u=>[u,[]])),s=u=>{const a=e.getId(u);if(a!=="unknown")return[a,r.resolvePackPath(a,"contents.json")]};return t.buildType!=="fullBuild"?{}:{include(){return n.map(u=>[r.resolvePackPath(u,"contents.json"),{isVirtual:!0}])},read(u){const a=s(u);if(!a)return;const[o,l]=a;if(u!==l)return i[o]},transformPath(u){if(!u)return;const a=e.getId(u);a!=="unknown"&&i[a].push(u)},finalizeBuild(u){const a=s(u);if(!a)return;const[o,l]=a;if(u!==l)return JSON.stringify(i[o])}}},cc=({fileType:r})=>{const e=[];for(const n of r.all)n.formatVersionMap&&e.push(n.id);const t=n=>n&&e.includes(r.getId(n));return{async read(n,i){if(!!i&&t(n)){const s=await i.getFile();if(!s)return;try{return $e.parse(await s.text())}catch(u){console.error(u)}}},load(n,i){if(t(n))return i},transform(n,i){if(t(n)){const s=r.get(n),u=s==null?void 0:s.formatVersionMap;if(!u)return;const a=i==null?void 0:i.format_version;return a&&u[a]&&(i.format_version=u[a]),i}},finalizeBuild(n,i){if(t(n))return JSON.stringify(i)}}};class Cn{constructor(e,t){this.console=e,this.baseDir=t,this.files=new Map}get hasFiles(){return this.files.size>0}getAll(){return[...this.files.entries()]}get(e){return this.files.get(e)}clear(){this.files.clear()}add(e,t){const n=this.baseDir?$.join(this.baseDir,e):e;if(this.files.has(n)){this.console.warn(`Omitting file "${n}" from collection because it would overwrite a previously generated file!`);return}this.files.set(n,t)}has(e){return this.files.has(e)}addFrom(e){for(const[t,n]of e.getAll())this.add(t,n)}}function hc({generatorPath:r,omitUsedTemplates:e,fileSystem:t,console:n}){return{useTemplate:(i,{omitTemplate:s=!0}={})=>{const u=$.join($.dirname(r),i);return s&&e.add(u),i.endsWith(".json")?t.readJson(u):t.readFile(u).then(a=>a.text())},createCollection:()=>new Cn(n,$.dirname(r))}}const fc=({options:r,fileType:e,console:t,jsRuntime:n,fileSystem:i,compileFiles:s,getFileMetadata:u,unlinkOutputFiles:a,addFileDependencies:o})=>{var l;const h=new Set(["gameTest","customCommand","customComponent","molangAstScript",...(l=r.ignoredFileTypes)!=null?l:[]]),c=A=>e.getId(A),f=A=>{var b;const x=e.get(A,void 0,!1);return x?(b=x.type)!=null?b:"json":"raw"},g=A=>!h.has(c(A))&&(A.endsWith(".js")||A.endsWith(".ts")),C=A=>{var b,x,B,_;return f(A)==="json"?".json":(_=(B=(x=(b=e.get(A))==null?void 0:b.detect)==null?void 0:x.fileExtensions)==null?void 0:B[0])!=null?_:".txt"},m=A=>A.replace(/\.(js|ts)$/,C(A)),d=new Set,p=new Cn(t),w=new Set,F=new Map;return{buildStart(){p.clear(),d.clear(),w.clear(),F.clear()},transformPath(A){if(A&&g(A))return m(A)},async read(A,b){if(g(A)&&b){const B=await b.getFile();return B?B.text():void 0}const x=p.get(A);if(x)return x},async load(A,b){var x,B;const _=new Set;if(n.registerModule("@bridge/generate",hc({generatorPath:A,fileSystem:i,omitUsedTemplates:_,console:t})),g(A)){if(!b)return null;const R=await n.run(A,{console:t},b).catch(I=>(t.error(`Failed to execute generator script "${A}": ${I}`),null));if(!R)return null;if(!R.__default__)return t.error(`Expected generator script "${A}" to provide file content as default export!`),null;const q=u(A);((x=q.get("unlinkedFiles"))!=null?x:[]).filter(I=>!_.has(I)).forEach(I=>w.add(I)),q.set("unlinkedFiles",[..._]);const H=(B=q.get("generatedFiles"))!=null?B:[];return await a([...H,..._]),F.set(A,_),R.__default__}},require(A){const b=F.get(A);if(b)return[...b]},finalizeBuild(A,b){if(p.get(A))return A.endsWith(".json")&&typeof b!="string"?JSON.stringify(b,null,"	"):b;if(d.has(A))return null;if(g(A)){if(b===null)return null;const x=u(A);return b instanceof Cn?(p.addFrom(b),x.set("generatedFiles",b.getAll().map(([B])=>B)),null):(x.set("generatedFiles",[m(A)]),typeof b=="object"?JSON.stringify(b):b)}},async buildEnd(){n.deleteModule("@bridge/generate"),w.size>0&&await s([...w].filter(A=>!p.has(A)),!1),p.hasFiles&&await s(p.getAll().map(([A])=>A))},async beforeFileUnlinked(A){var b,x;if(g(A)){const B=u(A),_=(b=B.get("unlinkedFiles"))!=null?b:[],R=(x=B.get("generatedFiles"))!=null?x:[];await a(R),await s(_)}}}};class bs extends Ol{constructor(e,t){super(t),this.fs=e}readFile(e){return this.fs.readFile(e).then(t=>t.text())}deleteModule(e){this.baseModules.delete(e)}}const xs={simpleRewrite:Ul,rewriteForPackaging:oc,moLang:Wl,entityIdentifierAlias:zl,customEntityComponents:rc,customItemComponents:nc,customBlockComponents:ic,customCommands:uc,typeScript:ac,contentsFile:lc,formatVersionCorrection:cc,generatorScripts:fc};class dc{constructor(e){this.dash=e,this.plugins=[],this.pluginRuntime=new bs(this.dash.fileSystem)}async loadPlugins(e={}){var t,n;this.plugins=[],this.pluginRuntime.clearCache();const i=[...(await this.dash.fileSystem.readdir($.join(this.dash.projectRoot,".bridge/extensions")).catch(()=>[])).map(a=>a.kind==="directory"?$.join(this.dash.projectRoot,".bridge/extensions",a.name):void 0),...(await this.dash.fileSystem.readdir("extensions").catch(()=>[])).map(a=>a.kind==="directory"?$.join("extensions",a.name):void 0)],s={};for(const a of i){if(!a)continue;let o;try{o=await this.dash.fileSystem.readJson($.join(a,"manifest.json"))}catch{continue}if(!!((t=o==null?void 0:o.compiler)!=null&&t.plugins))for(const l in o.compiler.plugins)s[l]=$.join(a,o.compiler.plugins[l])}const u=(n=(await this.getCompilerOptions()).plugins)!=null?n:[];for(const a of u){const o=typeof a=="string"?a:a[0],l=typeof a=="string"?{}:a[1];if(s[o]){const h=await this.pluginRuntime.run(s[o],{console:this.dash.console,...e}).catch(c=>(this.dash.console.error(`Failed to execute plugin ${o}: ${c}`),null));if(!h)continue;typeof h.__default__=="function"?this.plugins.push(new Es(this.dash,o,h.__default__(await this.getPluginContext(o,l)))):this.dash.console.error(`Plugin ${o} is invalid: It does not provide a function as a default export.`)}else xs[o]?this.plugins.push(new Es(this.dash,o,xs[o](await this.getPluginContext(o,l)))):this.dash.console.error(`Unknown compiler plugin: ${o}`)}}async getCompilerOptions(){var e;const t=await this.dash.getCompilerConfigPath();return t?await this.dash.fileSystem.readJson(t):(e=this.dash.projectConfig.get().compiler)!=null?e:{}}async getPluginContext(e,t={}){const n=this.dash;return{options:{get mode(){return n.getMode()},get buildType(){return n.buildType},...t},jsRuntime:this.dash.jsRuntime,console:this.dash.console,fileSystem:this.dash.fileSystem,outputFileSystem:this.dash.outputFileSystem,projectConfig:this.dash.projectConfig,projectRoot:this.dash.projectRoot,packType:this.dash.packType,fileType:this.dash.fileType,targetVersion:this.dash.projectConfig.get().targetVersion,requestJsonData:this.dash.requestJsonData,getAliases:i=>{var s,u;return[...(u=(s=this.dash.includedFiles.get(i))==null?void 0:s.aliases)!=null?u:[]]},getFileMetadata:i=>{const s=this.dash.includedFiles.get(i);if(!s)throw new Error(`File ${i} to add metadata to not found`);return{get(u){return s.getMetadata(u)},set(u,a){s.addMetadata(u,a)},delete(u){s.deleteMetadata(u)}}},addFileDependencies:(i,s,u=!1)=>{const a=this.dash.includedFiles.get(i);if(!a)throw new Error(`File ${i} to add dependency to not found`);u?a.setRequiredFiles(new Set(s)):s.forEach(o=>a.addRequiredFile(o))},getOutputPath:i=>this.dash.getCompilerOutputPath(i),unlinkOutputFiles:i=>this.dash.unlinkMultiple(i,!1,!0),hasComMojangDirectory:this.dash.fileSystem!==this.dash.outputFileSystem,compileFiles:(i,s=!0)=>this.dash.compileAdditionalFiles(i,s)}}async runBuildStartHooks(){for(const e of this.plugins)await e.runBuildStartHook()}async runIncludeHooks(){let e=[];for(const t of this.plugins){const n=await t.runIncludeHook();Array.isArray(n)&&e.push(...n)}return e}async runTransformPathHooks(e){let t=e;for(const n of this.plugins){const i=await n.runTransformPathHook(t);if(i===null)return null;i!==void 0&&(t=i)}return t}async runReadHooks(e,t){for(const n of this.plugins){const i=await n.runReadHook(e,t);if(i!=null)return i}}async runLoadHooks(e,t){let n=t;for(const i of this.plugins){const s=await i.runLoadHook(e,n);s!==void 0&&(n=s)}return n}async runRegisterAliasesHooks(e,t){const n=new Set;for(const i of this.plugins){const s=await i.runRegisterAliasesHook(e,t);s!=null&&(Array.isArray(s)?s.forEach(u=>n.add(u)):n.add(s))}return n}async runRequireHooks(e,t){const n=new Set;for(const i of this.plugins){const s=await i.runRequireHook(e,t);s!=null&&(Array.isArray(s)?s.forEach(u=>n.add(u)):n.add(s))}return n}async runTransformHooks(e){const t=Object.fromEntries([...e.requiredFiles].map(i=>this.dash.includedFiles.query(i)).flat().map(i=>[[i.filePath,i.data],...[...i.aliases].map(s=>[s,i.data])]).flat());let n=e.data;for(const i of this.plugins){const s=await i.runTransformHook(e.filePath,n,t);s!==void 0&&(n=s)}return n}async runFinalizeBuildHooks(e){for(const t of this.plugins){const n=await t.runFinalizeBuildHook(e.filePath,e.data);if(n!==void 0)return n}}async runBuildEndHooks(){for(const e of this.plugins)await e.runBuildEndHook()}async runBeforeFileUnlinked(e){for(const t of this.plugins)await t.runBeforeFileUnlinked(e)}}class An{constructor(e,t,n=!1){this.dash=e,this.filePath=t,this.isVirtual=n,this.isDone=!1,this.requiredFiles=new Set,this.aliases=new Set,this.updateFiles=new Set,this.metadata=new Map,this.outputPath=t,this.isVirtual||this.setDefaultFileHandle()}setFileHandle(e){this.fileHandle=e}setDefaultFileHandle(){this.setFileHandle({getFile:()=>this.dash.fileSystem.readFile(this.filePath).catch(()=>null)})}setOutputPath(e){this.outputPath=e}setReadData(e){this.data=e}setAliases(e){for(const t of e)this.dash.includedFiles.addAlias(t,this);this.aliases=e}setRequiredFiles(e){this.requiredFiles=e}addRequiredFile(e){this.requiredFiles.add(e)}setUpdateFiles(e){this.updateFiles=new Set(e.map(t=>this.dash.includedFiles.get(t)).filter(t=>t!==void 0))}addUpdateFile(e){this.updateFiles.add(e)}removeUpdateFile(e){this.updateFiles.delete(e)}setMetadata(e){typeof e=="object"&&(this.metadata=new Map(Object.entries(e)))}addMetadata(e,t){this.metadata.set(e,t)}deleteMetadata(e){this.metadata.delete(e)}getMetadata(e){return this.metadata.get(e)}getAllMetadata(){return Object.fromEntries(this.metadata.entries())}getHotUpdateChain(){const e=new Set([this]);for(const t of this.updateFiles)t.getHotUpdateChain().forEach(n=>{e.add(n)});return e}filesToLoadForHotUpdate(e=new Set,t=!0){const n=new Set;if(e.has(this))return n;e.add(this);for(const i of this.requiredFiles){const s=this.dash.includedFiles.query(i);for(const u of s)u.filesToLoadForHotUpdate(e,!1).forEach(a=>{n.add(a)})}if(n.add(this),t)for(const i of this.updateFiles)i.filesToLoadForHotUpdate(e,!0).forEach(s=>{n.add(s)});return n}async processAfterLoad(e){if((this.data===null||this.data===void 0)&&(this.isDone=!0,this.filePath!==this.outputPath&&this.outputPath!==null&&!this.isVirtual&&e)){const t=await this.dash.fileSystem.readFile(this.filePath);await this.dash.outputFileSystem.writeFile(this.outputPath,new Uint8Array(await t.arrayBuffer()))}}serialize(){return{isVirtual:this.isVirtual,filePath:this.filePath,aliases:[...this.aliases],requiredFiles:[...this.requiredFiles],updateFiles:[...this.updateFiles].map(e=>e.filePath),metadata:this.metadata.size>0?Object.fromEntries(this.metadata.entries()):void 0}}reset(){this.isDone=!1,this.data=null,this.isVirtual||this.setDefaultFileHandle()}}class pc{constructor(e){this.dash=e,this.files=new Map,this.aliases=new Map,this.queryCache=new Map}all(){return[...this.files.values()]}filtered(e){return this.all().filter(t=>e(t))}get(e){var t;return(t=this.aliases.get(e))!=null?t:this.files.get(e)}query(e){if(Hl(e))return this.queryGlob(e);const t=this.aliases.get(e);if(t)return[t];const n=this.files.get(e);return n?[n]:[]}addAlias(e,t){this.aliases.set(e,t)}queryGlob(e){if(this.queryCache.has(e))return this.queryCache.get(e);const t=this.filtered(n=>Zt(n.filePath,e));return this.queryCache.set(e,t),t}async loadAll(){this.queryCache=new Map;const e=new Set,t=this.dash.projectConfig.getAvailablePackPaths();for(const i of t){const s=await this.dash.fileSystem.allFiles(i).catch(u=>(this.dash.console.warn(u),[]));for(const u of s)e.add(u)}const n=await this.dash.plugins.runIncludeHooks();for(const i of n)typeof i=="string"?e.add(i):this.addOne(i[0],i[1].isVirtual);this.add([...e])}addOne(e,t=!1){const n=new An(this.dash,e,t);return this.files.set(e,n),n}add(e,t=!1){let n=[];for(const i of e){const s=this.files.get(i);if(s){n.push(s);continue}n.push(new An(this.dash,i,t)),this.files.set(i,n[n.length-1])}return n}remove(e){const t=this.files.get(e);if(!!t){this.files.delete(e);for(const n of t.aliases)this.aliases.delete(n)}}async save(e){await this.dash.fileSystem.writeJson(e,this.all().map(t=>t.serialize()))}async load(e){this.removeAll();const t=await this.dash.fileSystem.readJson(e),n=[];for(const i of t){const s=new An(this.dash,i.filePath,i.isVirtual);s.setAliases(new Set(i.aliases)),s.setRequiredFiles(new Set(i.requiredFiles)),s.setMetadata(i.metadata),n.push(s);for(const u of i.aliases)this.aliases.set(u,s)}this.files=new Map(n.map(i=>[i.filePath,i]));for(let i=0;i<n.length;i++)n[i].setUpdateFiles(t[i].updateFiles)}resetAll(){for(const e of this.all())e.reset()}removeAll(){this.files=new Map,this.aliases=new Map,this.queryCache=new Map}}class gc{constructor(e){this.dash=e}async run(e,t=!0){for(const n of e)n.isDone||await this.loadFile(n,t);for(const n of e)n.isDone||await this.loadRequiredFiles(n)}async loadFile(e,t=!0){var n;const[i,s]=await Promise.all([this.dash.plugins.runTransformPathHooks(e.filePath),this.dash.plugins.runReadHooks(e.filePath,e.fileHandle)]);if(e.setOutputPath(i),e.setReadData(s),await e.processAfterLoad(t),e.isDone)return;e.setReadData((n=await this.dash.plugins.runLoadHooks(e.filePath,e.data))!=null?n:e.data);const u=await this.dash.plugins.runRegisterAliasesHooks(e.filePath,e.data);e.setAliases(u)}async loadRequiredFiles(e){const t=await this.dash.plugins.runRequireHooks(e.filePath,e.data);e.setRequiredFiles(t)}}class Dc{constructor(e){this.dash=e}run(e){const t=new Set;for(const n of e)n.isDone||t.has(n)||this.resolveSingle(n,t);return t}resolveSingle(e,t,n=new Set){const i=this.dash.includedFiles;n.add(e);for(const s of e.requiredFiles){const u=i.query(s);for(const a of u){if(!a){this.dash.console.error(`Undefined file dependency: "${e.filePath}" requires "${s}"`);continue}if(a.addUpdateFile(e),!t.has(a)){if(n.has(a)){this.dash.console.error(`Circular dependency detected: ${a.filePath} is required by ${e.filePath} but also depends on this file.`);continue}this.resolveSingle(a,t,n)}}}t.add(e),n.delete(e)}}function mc(r){return typeof r=="string"||r instanceof Blob||r instanceof File||r instanceof ArrayBuffer||(r==null?void 0:r.buffer)instanceof ArrayBuffer}class Ec{constructor(e){this.dash=e}async run(e,t=!1){for(const n of e){if(n.isDone)continue;let i=await this.transformFile(n,!0,t);i!=null&&n.outputPath&&await this.dash.outputFileSystem.writeFile(n.outputPath,i)}}async transformFile(e,t=!1,n=!1){var i;if(n||(e.data=(i=await this.dash.plugins.runTransformHooks(e))!=null?i:e.data),!t)return e.data;let s=await this.dash.plugins.runFinalizeBuildHooks(e);return s===void 0&&(s=e.data),s!=null&&(mc(s)||(this.dash.console.warn(`File "${e.filePath}" was not in a writable format: "${typeof s}". Trying to JSON.stringify(...) it...`,s),s=JSON.stringify(s))),e.isDone=!0,s}}class yc{constructor(e=1){this.total=e,this.current=0,this.onChangeCbs=new Set}get percentage(){return this.current/this.total}onChange(e){return this.onChangeCbs.add(e),{dispose:()=>this.onChangeCbs.delete(e)}}setTotal(e){this.total=e,this.current=0,this.onChangeCbs.forEach(t=>t(this))}updateCurrent(e){this.current=e,this.onChangeCbs.forEach(t=>t(this))}advance(){this.current++,this.onChangeCbs.forEach(e=>e(this))}addToTotal(e){this.total+=e,this.onChangeCbs.forEach(t=>t(this))}}class _s{constructor(){this._timers=new Map}time(e){if(this._timers.has(e)){this.warn(`Timer "${e}" already exists.`);return}else this._timers.set(e,Date.now())}timeEnd(e){const t=this._timers.get(e);if(t)this._timers.delete(e),this.log(`${e}: ${Date.now()-t}ms`);else{this.warn(`Timer "${e}" does not exist.`);return}}}class vc extends _s{log(...e){console.log(...e)}error(...e){console.error(...e)}warn(...e){console.warn(...e)}info(...e){console.info(...e)}}class wc{constructor(e,t,n){var i;this.fileSystem=e,this.options=n,this.progress=new yc,this.plugins=new dc(this),this.includedFiles=new pc(this),this.loadFiles=new gc(this),this.fileOrderResolver=new Dc(this),this.fileTransformer=new Ec(this),this.buildType="fullBuild",this.outputFileSystem=t!=null?t:e,this.projectRoot=$.dirname(n.config),this.projectConfig=new jl(e,n.config),this.console=(i=n.console)!=null?i:new vc,this.jsRuntime=new bs(this.fileSystem,[["@molang/expressions",fs],["@molang/core",{MoLang:gn}],["molang",{MoLang:gn,...fs}],["@bridge/compiler",{mode:n.mode}]]),this.packType=n.packType,this.fileType=n.fileType}getMode(){var e;return(e=this.options.mode)!=null?e:"development"}getCompilerConfigPath(){return this.options.compilerConfig}get requestJsonData(){return this.options.requestJsonData}get dashFilePath(){return $.join(this.projectRoot,`.bridge/.dash.${this.getMode()}.json`)}async setup(e){var t,n,i,s;try{await this.projectConfig.setup()}catch(u){this.console.error("Failed to load project config: "+u)}(t=this.fileType)==null||t.setProjectConfig(this.projectConfig),(n=this.packType)==null||n.setProjectConfig(this.projectConfig),await((i=this.fileType)==null?void 0:i.setup(e)),await((s=this.packType)==null?void 0:s.setup(e)),await this.plugins.loadPlugins(this.options.pluginEnvironment)}async reload(){try{await this.projectConfig.refreshConfig()}catch{}await this.plugins.loadPlugins(this.options.pluginEnvironment)}get isCompilerActivated(){const e=this.projectConfig.get();return e.compiler!==void 0&&Array.isArray(e.compiler.plugins)}async build(){if(this.console.log("Starting compilation..."),!this.isCompilerActivated)return;this.jsRuntime.clearCache(),this.buildType="fullBuild",this.includedFiles.removeAll();const e=Date.now();this.progress.setTotal(7),await this.plugins.runBuildStartHooks(),this.progress.advance(),await this.includedFiles.loadAll(),this.progress.advance(),await this.compileIncludedFiles(),await this.plugins.runBuildEndHooks(),this.progress.advance(),this.getMode()==="development"&&await this.saveDashFile(),this.includedFiles.resetAll(),this.progress.advance(),this.console.log(`Dash compiled ${this.includedFiles.all().length} files in ${Date.now()-e}ms!`)}async updateFiles(e,t=!0){var n;if(!this.isCompilerActivated||e.length===0)return;this.buildType="hotUpdate",this.jsRuntime.clearCache(),this.progress.setTotal(8),this.console.log(`Dash is starting to update ${e.length} files...`),await this.includedFiles.load(this.dashFilePath),await this.plugins.runBuildStartHooks();const i=[];for(const o of e){let l=this.includedFiles.get(o);l||([l]=this.includedFiles.add([o])),i.push(l)}this.progress.advance();const s=[];for(const o of i)s.push(new Set([...o.requiredFiles]));this.progress.advance(),await this.loadFiles.run(i),this.progress.advance();for(let o=0;o<i.length;o++){const l=i[o];[...l.requiredFiles].filter(f=>!s[o].has(f)).forEach(f=>this.includedFiles.query(f).forEach(g=>g.addUpdateFile(l))),[...s[o]].filter(f=>!l.requiredFiles.has(f)).forEach(f=>this.includedFiles.query(f).forEach(g=>g.removeUpdateFile(l)))}this.progress.advance();const u=new Set(i.map(o=>[...o.filesToLoadForHotUpdate()]).flat());this.console.log(`Dash is loading ${u.size} files...`),await this.loadFiles.run([...u.values()].filter(o=>!i.includes(o))),this.progress.advance();const a=new Set(i.map(o=>[...o.getHotUpdateChain()]).flat());for(const o of u)o.isDone||(o.data=(n=await this.plugins.runTransformHooks(o))!=null?n:o.data,a.has(o)||(o.isDone=!0));this.progress.advance(),this.console.log(`Dash is compiling ${a.size} files...`),await this.fileTransformer.run(a,!0),this.progress.advance(),await this.plugins.runBuildEndHooks(),t&&await this.saveDashFile(),this.includedFiles.resetAll(),this.console.log(`Dash finished updating ${a.size} files!`),this.progress.advance()}async compileFile(e,t){var n;if(!this.isCompilerActivated)return[[],t];this.buildType="fileRequest",this.jsRuntime.clearCache(),this.progress.setTotal(7),await this.plugins.runBuildStartHooks(),await this.includedFiles.load(this.dashFilePath);let i=this.includedFiles.get(e);i||([i]=this.includedFiles.add([e])),i.setFileHandle({getFile:async()=>new File([t],$.basename(e))}),await this.loadFiles.loadFile(i,!1),await this.loadFiles.loadRequiredFiles(i),this.progress.advance();const s=i.filesToLoadForHotUpdate();await this.loadFiles.run([...s.values()].filter(a=>i!==a),!1),this.progress.advance();for(const a of s)a.isDone||(a.data=(n=await this.plugins.runTransformHooks(a))!=null?n:a.data);this.progress.advance();const u=await this.fileTransformer.transformFile(i,!0,!0);return this.progress.advance(),await this.includedFiles.load(this.dashFilePath),this.progress.advance(),await this.plugins.runBuildEndHooks(),[[...s].map(a=>a.filePath),u]}async unlinkMultiple(e,t=!0,n=!1){if(!(!this.isCompilerActivated||e.length===0)){for(const i of e)await this.unlink(i,!1,n);t&&await this.saveDashFile()}}async unlink(e,t=!0,n=!1){if(!this.isCompilerActivated)return;const i=await this.getCompilerOutputPath(e);!i||i===e||(n||(await this.plugins.runBeforeFileUnlinked(e),this.includedFiles.remove(e)),await this.outputFileSystem.unlink(i),t&&await this.saveDashFile())}async rename(e,t){!this.isCompilerActivated||(await this.unlink(e,!1),await this.updateFiles([t],!1),await this.saveDashFile())}async getCompilerOutputPath(e){var t;if(!this.isCompilerActivated)return;const n=this.includedFiles.get(e);if(n&&n.outputPath!==e)return(t=n.outputPath)!=null?t:void 0;const i=await this.plugins.runTransformPathHooks(e);if(!!i)return i}async getFileMetadata(e){if(!this.isCompilerActivated)return;const t=this.includedFiles.get(e);return t?t.getAllMetadata():null}async getFileDependencies(e){if(!this.isCompilerActivated)return[];await this.includedFiles.load(this.dashFilePath);const t=this.includedFiles.get(e);return t?[...t.filesToLoadForHotUpdate()].map(n=>n.isVirtual?n.outputPath:n.filePath).filter(n=>n!==null&&n!==e):[]}async saveDashFile(){await this.includedFiles.save(this.dashFilePath)}async compileIncludedFiles(e=this.includedFiles.all()){await this.loadFiles.run(e),this.progress.advance();const t=this.fileOrderResolver.run(e);this.progress.advance(),await this.fileTransformer.run(t),this.progress.advance()}async compileAdditionalFiles(e,t=!0){const n=this.includedFiles.add(e,t);this.progress.addToTotal(3),n.forEach(i=>i.reset()),await this.compileIncludedFiles(n)}}class Cc{async allFiles(e){const t=[],n=await this.readdir(e);for(const{name:i,kind:s}of n)s==="directory"?t.push(...await this.allFiles($.join(e,i))):s==="file"&&t.push($.join(e,i));return t}async writeJson(e,t,n=!0){await this.writeFile(e,JSON.stringify(t,null,n?"	":0))}async readJson(e){const t=await this.readFile(e);try{return await $e.parse(await t.text())}catch{throw new Error(`Invalid JSON: ${e}`)}}watchDirectory(e,t){console.warn("Watching a directory for changes is not supported on this platform!")}}class Ac extends so{constructor(e){super(e),this.ready=new Ge}async setup(e){this.packTypes.length>0||(await e.fired,this.packTypes=await e.readJSON("data/packages/minecraftBedrock/packDefinitions.json").catch(()=>[]),this.ready.dispatch())}}class Ss extends Cc{constructor(e){super(),this.internalFs=new or(e)}get internal(){return this.internalFs}readJson(e){return this.internalFs.readJSON(e)}async writeJson(e,t,n){await this.internalFs.writeJSON(e,t,n)}readFile(e){return this.internalFs.readFile(e)}async writeFile(e,t){await this.internalFs.writeFile(e,t)}mkdir(e){return this.internalFs.mkdir(e)}unlink(e){return this.internalFs.unlink(e)}async allFiles(e){return(await this.internalFs.readFilesFromDir(e)).map(t=>t.path)}readdir(e){return this.internalFs.readdir(e,{withFileTypes:!0})}async lastModified(e){return 0}}class Fc extends _s{constructor(){super(...arguments),this.logs=[],this.changeListeners=[]}getLogs(){return this.logs}basicLog(e,{type:t}={}){switch(t){case"warning":console.warn(e);break;case"error":console.error(e);break;case"info":console.info(e);break;default:console.log(e);break}e instanceof Error&&(e=e.message),this.logs.unshift([typeof e=="string"?e:JSON.stringify(e),{type:t}]),this.logsChanged()}addChangeListener(e){this.changeListeners.push(e)}removeChangeListeners(){this.changeListeners=[]}logsChanged(){this.changeListeners.forEach(e=>e())}clear(){this.logs=[],this.logsChanged()}log(...e){e.forEach(t=>this.basicLog(t))}info(...e){e.forEach(t=>this.basicLog(t,{type:"info"}))}warn(...e){e.forEach(t=>this.basicLog(t,{type:"warning"}))}error(...e){e.forEach(t=>this.basicLog(t,{type:"error"}))}}class bc{constructor(){this.listeners=[],this.isLocked=!1}lock(){return new Promise(async(e,t)=>{this.isLocked?this.listeners.push(()=>{this.isLocked=!0,e()}):(this.isLocked=!0,e())})}unlock(){if(!this.isLocked)throw new Error("Trying to unlock a mutex that is not locked");this.isLocked=!1,this.listeners.length>0&&this.listeners.shift()()}}var xc="/assets/wasm-web_bg.533586ee.wasm";globalThis.process={cwd:()=>"",env:{}},Pl(xc);const mr=new Bo,ks=new Map;class _c extends Bn{constructor(e,t,n){super(),this.isDashFree=new bc,this.isSetup=!1,this.completedStartUp=new Ge,this.fileSystem=new Ss(e);const i=t&&n.mode==="development"?new Ss(t):void 0;this.fileType=new ao,this.fileType.setPluginFileTypes(n.pluginFileTypes);let s=ks.get(n.projectName);s||(s=new Fc,ks.set(n.projectName,s)),this.console=s,this.dash=new wc(this.fileSystem,i,{config:n.config,compilerConfig:n.compilerConfig,console:s,mode:n.mode,fileType:this.fileType,packType:new Ac,requestJsonData:u=>mr.readJSON(u)}),this.projectDir=cn(n.config)}getCompilerLogs(){return this.console.getLogs()}clearCompilerLogs(){this.console.clear()}onConsoleUpdate(e){this.console.addChangeListener(e)}removeConsoleListeners(){this.console.removeChangeListeners()}async compileFile(e,t){await this.isDashFree.lock();const[n,i]=await this.dash.compileFile(e,t);return this.isDashFree.unlock(),[n,i!=null?i:t]}async start(e,t){await this.isDashFree.lock();const n=this.fileSystem.internal;await n.fileExists(`${this.projectDir}/.bridge/.restartWatchMode`)||!await n.fileExists(`${this.projectDir}/.bridge/.dash.${this.dash.getMode()}.json`)?await Promise.all([this.build(!1).catch(i=>console.error(i)),n.unlink(`${this.projectDir}/.bridge/.restartWatchMode`).catch(i=>console.error(i))]):(t.length>0&&await this.unlinkMultiple(t,!1),e.length>0&&await this.updateFiles(e,!1)),this.completedStartUp.dispatch(),this.isDashFree.unlock()}async build(e=!0){e&&await this.isDashFree.lock(),this.dispatch(),await this.dash.build(),e&&this.isDashFree.unlock()}async updateFiles(e,t=!0){t&&await this.isDashFree.lock(),this.dispatch(),await this.dash.updateFiles(e),t&&this.isDashFree.unlock()}async unlink(e,t=!0){await this.isDashFree.lock(),await this.dash.unlink(e,t),this.isDashFree.unlock()}async unlinkMultiple(e,t=!0){t&&await this.isDashFree.lock(),await this.dash.unlinkMultiple(e),t&&this.isDashFree.unlock()}async rename(e,t){await this.isDashFree.lock(),this.dispatch(),await this.dash.rename(e,t),this.isDashFree.unlock()}getCompilerOutputPath(e){return this.dash.getCompilerOutputPath(e)}getFileDependencies(e){return this.dash.getFileDependencies(e)}async setup(){await this.isDashFree.lock(),mr.hasFired||await mr.loadData(),await this.dash.setup(mr),this.isDashFree.unlock(),this.isSetup=!0}async reloadPlugins(){await this.isDashFree.lock(),await this.dash.reload(),this.isDashFree.unlock()}onProgress(e){const t=this.dash.progress.onChange(n=>{n.percentage===1?(t.dispose(),e(1)):e(n.percentage)})}}wr(_c,self)})();
