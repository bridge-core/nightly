var qa=Object.defineProperty;var Ga=(s,e,t)=>e in s?qa(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var c=(s,e,t)=>(Ga(s,typeof e!="symbol"?e+"":e,t),t);import{c as Yi,g as he,s as ye,d as Je,a as Ka,b as Ya,e as Qa,k as Za,v as E,r as F,m as x,t as ui,f as pi,h as q,i as U,V as vs,j as B,l as He,n as X,o as Se,p as Ve,q as gt,u as L,w as wt,x as Qi,z as bs,y as _s,A as hi,B as Q,C as Xa,T as er,D as Zi,E as mi,P as tr,F as Ot,G as Xi,H as lt,R as ir,I as nr,J as Ss,K as sr,L as ar,M as rr,N as or,O as cr,Q as lr,S as dr,U as ur,W as pr,X as hr,Y as mr,Z as dt,_ as fr,$ as gr,a0 as wr,a1 as Cs,a2 as yr,a3 as Zt,a4 as vr,a5 as br,a6 as _r,a7 as Sr,a8 as Cr,a9 as Tt,aa as xr,ab as kr,ac as Pr,ad as en,ae as jr,af as Fr,ag as Tr,ah as Ar,ai as $r,aj as Er,ak as Dr,al as tn,am as Mr,an as Ir,ao as Or,ap as Rr,aq as Wr,ar as Lr,as as Nr,at as Br,au as Vr,av as Hr,aw as xs,ax as Ur,ay as zr,az as Jr,aA as qr,aB as Gr,aC as Kr,aD as Yr}from"./vendor.1f611e46.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();class z{constructor(){c(this,"listeners",new Set)}get hasListeners(){return this.listeners.size>0}dispatch(e){this.listeners.forEach(t=>t(e))}on(e,t=!0){if(this.listeners.add(e),t)return{dispose:()=>{this.off(e)}}}off(e){this.listeners.delete(e)}once(e,t=!1){const i=n=>{e(n),this.off(i)};return this.on(i,t)}disposeListeners(){this.listeners=new Set}}class $ extends z{constructor(t=1){super();c(this,"firedTimes",0);c(this,"data");this.needsToFireAmount=t}get fired(){return new Promise(t=>this.once(t,!1))}get hasFired(){return this.firedTimes>=this.needsToFireAmount}setFiredTimes(t){this.firedTimes=t}resetSignal(){this.data=void 0,this.firedTimes=0}dispatch(t){if(this.firedTimes<this.needsToFireAmount&&this.firedTimes++,this.data=t,this.hasFired)return super.dispatch(t)}on(t,i=!0){return this.hasFired&&t(this.data),super.on(t,i)}}const Qr=Yi("virtual-fs","virtual-fs-store"),nn=s=>he(s,Qr),Zr=async s=>await nn(s)!==void 0;class ut{constructor(e="virtual-fs"){c(this,"store");this.storeName=e,this.store=Yi(e,`${e}-store`)}set(e,t){return ye(e,t,this.store)}get(e){return he(e,this.store)}del(e){return Je(e,this.store)}setMany(e){return Ka(e,this.store)}getMany(e){return Ya(e,this.store)}clear(){return Qa(this.store)}async has(e){return await nn(e)!==void 0}keys(){return Za(this.store)}}class ot{constructor(e,t,i=[],n=E()){c(this,"_idbWrapper",null);c(this,"parent",null);c(this,"isVirtual",!0);c(this,"setupDone",new $);this._name=t,this.basePath=i,this.uuid=n,e===null?this._idbWrapper=new ut:e instanceof ut?this._idbWrapper=e:this.parent=e}get path(){return this.parent?this.parent.path.concat(this.name):this.basePath}get hasParentContext(){return this.path.length>1}get idbKey(){return this.path.length===0?this._name:this.path.join("/")}get idbWrapper(){return this._idbWrapper===null?this.parent.idbWrapper:this._idbWrapper}get name(){return this._name}getParent(){return this.parent}async isSameEntry(e){return e.idbKey===this.idbKey}async queryPermission(e){return"granted"}async requestPermission(e){return"granted"}}const Xr=new TextEncoder,ks=Symbol("writeMethod");class eo{constructor(e){c(this,"tmpData",new Uint8Array);c(this,"cursorOffset",0);c(this,"locked",!1);this.fileHandle=e}async write(e){let t;if(typeof e=="string")t=Xr.encode(e);else if(e instanceof Blob)t=await e.arrayBuffer().then(i=>new Uint8Array(i));else if("type"in e){if(e.type==="seek")return await this.seek(e.position);if(e.type==="truncate")return await this.truncate(e.size);if(e.type==="write")return e.position&&await this.seek(e.position),await this.write(e.data);throw new Error(`Unknown data type: ${e.type}`)}else ArrayBuffer.isView(e)?t=new Uint8Array(e.buffer):t=new Uint8Array(e);this.tmpData=new Uint8Array([...this.tmpData.slice(0,this.cursorOffset),...t]),this.cursorOffset=this.tmpData.length}async seek(e){this.cursorOffset=Math.floor(e)}async truncate(e){this.tmpData=this.tmpData.slice(0,e),this.cursorOffset>e&&(this.cursorOffset=e)}async close(){await this.fileHandle[ks](this.tmpData)}async abort(){throw new Error("WriteStream was aborted")}getWriter(){}}class ae extends ot{constructor(t,i,n,a=!1,r){super(t,i,r);c(this,"kind","file");c(this,"isFile",!0);c(this,"isDirectory",!1);c(this,"fileData");this.inMemory=a,n?this.setup(n):this.setupDone.dispatch()}get isFileStoredInMemory(){return this.fileData!==void 0}moveData(){if(!this.fileData)throw new Error(`No file data to move to IDB for file "${this.name}"`);const t=this.fileData;return this.fileData=void 0,this.inMemory=!1,t}async setup(t){this.fileData=t;const i=this.path.join("/").startsWith("data/packages");if(this.inMemory||i&&t.length<5e4)return this.inMemory=!0,this.setupDone.dispatch();(!i||globalThis.document)&&await this.updateIdb(t),this.setupDone.dispatch()}async updateIdb(t){await this.idbWrapper.set(this.idbKey,t),this.fileData=void 0}async loadFromIdb(){if(this.fileData)return this.fileData;let t=await this.idbWrapper.get(this.idbKey);if(t===void 0)throw console.log(this.parent),new Error(`File not found: "${this.path.join("/")}"`);return t}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"file",name:this.name,path:this.path,fileData:this.fileData}}static deserialize(t){return new ae(t.idbWrapper?new ut(t.idbWrapper):null,t.name,t.fileData,t.fileData!==void 0,t.path)}async isSameEntry(t){return this.parent===null?!1:super.isSameEntry(t)}async removeSelf(t=!0){await this.idbWrapper.del(this.idbKey),this.parent&&t&&this.parent.deleteChild(this.name)}async getFile(){const t=await this.loadFromIdb();return new File([t],this.name)}async createWritable(){return new eo(this)}async[ks](t){this.inMemory?this.fileData=t:await this.updateIdb(t)}}class sn{constructor(){c(this,"listeners",[]);c(this,"isLocked",!1)}lock(){return new Promise(async(e,t)=>{this.isLocked?this.listeners.push(()=>{this.isLocked=!0,e()}):(this.isLocked=!0,e())})}unlock(){if(!this.isLocked)throw new Error("Trying to unlock a mutex that is not locked");this.isLocked=!1,this.listeners.length>0&&this.listeners.shift()()}}class to{constructor(){c(this,"mutexMap",new Map)}async lock(e){let t=this.mutexMap.get(e);t||(t=new sn,this.mutexMap.set(e,t)),await t.lock()}unlock(e){const t=this.mutexMap.get(e);if(!t)throw new Error("Trying to unlock a mutex that does not exist");t.unlock()}}const Vn=new to;class ne extends ot{constructor(t,i,n,a=!1,r=[]){super(t,i,r);c(this,"kind","directory");c(this,"isDirectory",!0);c(this,"isFile",!1);this.children=n,this.updateIdb(a)}get isDirectoryInMemory(){return this.children!==void 0}async moveToIdb(){const t=this.allInMemoryChildren();this.idbWrapper.setMany(t.map(i=>[i.idbKey,i.moveData()]))}moveData(){if(!this.children)throw new Error(`No directory data to move to IDB for directory "${this.name}"`);const t=[...this.children.values()].map(i=>i.name);return this.children=void 0,t}allInMemoryChildren(){if(!this.children)return[];const t=[this];for(const i of this.children.values())i instanceof ne?i.isDirectoryInMemory&&t.push(...i.allInMemoryChildren()):i.isFileStoredInMemory&&t.push(i);return t}async lockAccess(){await Vn.lock(this.idbKey)}unlockAccess(){Vn.unlock(this.idbKey)}async updateIdb(t=!1){await this.lockAccess(),t&&await this.idbWrapper.clear(),!this.children&&!await this.hasChildren()&&await this.idbWrapper.set(this.idbKey,[]),this.setupDone.dispatch(),this.unlockAccess()}async addChild(t){this.children?this.children.set(t.name,t):await this.idbWrapper.set(this.idbKey,[...new Set([...await this.fromIdb(),t.name])])}async fromIdb(){var t;return(t=await this.idbWrapper.get(this.idbKey))!=null?t:[]}async getChildren(){return this.children?[...this.children.values()]:(await Promise.all((await this.fromIdb()).map(t=>this.getChild(t)))).filter(t=>t!==void 0)}getChildPath(t){return this.path.concat(t).join("/")}async getChild(t){if(this.children)return this.children.get(t);if(await this.has(t)){const i=await this.idbWrapper.get(this.getChildPath(t));if(i instanceof Uint8Array)return new ae(this,t);if(Array.isArray(i))return new ne(this,t)}}async deleteChild(t,i=!0){i&&await this.lockAccess(),this.children?this.children.delete(t):await this.idbWrapper.set(this.idbKey,(await this.fromIdb()).filter(n=>n!==t)),i&&this.unlockAccess()}async hasChildren(){return this.children?this.children.size>0:(await this.fromIdb()).length>0}async has(t){return this.children?this.children.has(t):(await this.fromIdb()).includes(t)}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"directory",name:this.name,path:this.path,children:this.children?[...this.children.values()].map(t=>t.serialize()):void 0}}static deserialize(t,i=null){var a;const n=new ne(i||new ut(t.idbWrapper),t.name,void 0,!1,t.path);for(const r of(a=t.children)!=null?a:[])r.kind==="directory"?n.addChild(ne.deserialize(r,n)):n.addChild(new ae(n,r.name,r.fileData));return n}async getDirectoryHandle(t,{create:i}={}){await this.lockAccess();let n=await this.getChild(t);if(n&&n.kind==="file")throw this.unlockAccess(),new Error(`TypeMismatch: Expected directory with name "${t}", found file`);if(!n)if(i)n=new ne(this,t,this.children?new Map:void 0),await n.setupDone.fired,await this.addChild(n);else throw this.unlockAccess(),new Error(`No file with the name ${t} exists in this folder`);return this.unlockAccess(),n}async getFileHandle(t,{create:i,initialData:n}={}){await this.lockAccess();let a=await this.getChild(t);if(a&&a.kind==="directory")throw this.unlockAccess(),new Error(`TypeMismatch: Expected file with name "${t}", found directory`);if(!a)if(i)a=new ae(this,t,n!=null?n:new Uint8Array),await a.setupDone.fired,await this.addChild(a);else throw this.unlockAccess(),new Error(`No file with the name ${t} exists in this folder`);return this.unlockAccess(),a}async removeEntry(t,{recursive:i}={}){await this.lockAccess();const n=await this.getChild(t);if(n){if(n.kind==="directory"&&!i&&await n.hasChildren())throw this.unlockAccess(),new Error('Cannot remove directory with children without "recursive" option being set to true')}else throw this.unlockAccess(),new Error(`No entry with the name ${t} exists in this folder`);await n.removeSelf(!0,!1),await this.deleteChild(t,!1),this.unlockAccess()}async resolve(t){const i=[t.name];let n=t.getParent();for(;n!==null&&!await n.isSameEntry(this);)i.unshift(n.name),n=n.getParent();return n===null?null:i}async removeSelf(t=!0,i=!0){i&&await this.lockAccess();const n=await this.getChildren();for(const a of n)await a.removeSelf(!1);this.children||await this.idbWrapper.del(this.idbKey),this.parent&&t&&this.parent.deleteChild(this.name),i&&this.unlockAccess()}[Symbol.asyncIterator](){return this.entries()}keys(){return this.children?this.children.keys():{childNamesPromise:this.fromIdb(),[Symbol.asyncIterator](){return{i:0,childNamesPromise:this.childNamesPromise,async next(){const t=await this.childNamesPromise;return this.i<t.length?{done:!1,value:t[this.i++]}:{done:!0}}}}}}entries(){return this.children?this.children.entries():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const t=await this.childrenPromise;return this.i<t.length?{done:!1,value:[t[this.i].name,t[this.i++]]}:{done:!0}}}}}}values(){return this.children?this.children.values():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const t=await this.childrenPromise;return this.i<t.length?{done:!1,value:t[this.i++]}:{done:!0}}}}}}getEntries(){return this.values()}getDirectory(t,i={}){return this.getDirectoryHandle(t,i)}getFile(t,i={}){return this.getFileHandle(t,i)}}function fi(){const s=["93","94"],e=navigator.userAgentData;if(!e)return!0;const t=e.brands.find(({brand:a})=>a==="Google Chrome"),i=e.brands.find(({brand:a})=>a==="Microsoft Edge"),n=e.brands.find(({brand:a})=>a==="Opera GX"||a==="Opera");return t?s.includes(t.version):!(i||n)}let A=F(!1),Ps=!1,js=!1;(fi()||typeof window.showDirectoryPicker!="function")&&(A.value=!0,window.showDirectoryPicker=async()=>x(new ne(null,"bridgeFolder",void 0)));(fi()||typeof window.showOpenFilePicker!="function")&&(window.showOpenFilePicker=async s=>{var n;const e={types:[],...s},t=document.createElement("input");t.type="file",t.multiple=(n=e.multiple)!=null?n:!1,t.accept=e.types.map(a=>Object.values(a.accept)).flat(2).join(","),t.style.display="none",document.body.appendChild(t);let i=!1;return new Promise((a,r)=>{t.addEventListener("change",async o=>{var d;i=!0;const l=[...(d=t.files)!=null?d:[]];document.body.removeChild(t),a(await Promise.all(l.map(async p=>x(new ae(null,p.name,new Uint8Array(await p.arrayBuffer()),!0)))))},{once:!0}),window.addEventListener("focus",()=>{setTimeout(()=>{i||(r("User aborted selecting file"),document.body.removeChild(t))},300)},{once:!0}),t.click()})});(fi()||typeof window.showSaveFilePicker!="function")&&(Ps=!0,window.showSaveFilePicker=async(s={})=>{var e;return new ae(null,(e=s.suggestedName)!=null?e:"newFile.txt",new Uint8Array,!0)});(fi()||globalThis.DataTransferItem&&!DataTransferItem.prototype.getAsFileSystemHandle)&&(DataTransferItem.prototype.getAsFileSystemHandle=async function(){if(this.kind==="file"){const s=this.getAsFile();return s?new ae(null,s.name,new Uint8Array(await s.arrayBuffer()),!0):null}else if(this.kind==="directory")return x(new ne(null,"unknown"));return null});ui.set("VirtualFileHandle",{canHandle:s=>s instanceof ae,serialize:s=>[s.serialize(),[]],deserialize:s=>new ae(null,s.name,s.fileData)});ui.set("VirtualDirectoryHandle",{canHandle:s=>s instanceof ne,serialize:s=>[s.serialize(),[]],deserialize:s=>ne.deserialize(s)});ui.set("VirtualDirectoryHandleArray",{canHandle:s=>Array.isArray(s)&&s.every(({directory:e})=>e instanceof ne),serialize:s=>[s.map(({directory:e,...t})=>({directory:e.serialize(),...t})),[]],deserialize:s=>s.map(({directory:e,...t})=>({directory:ne.deserialize(e),...t}))});ui.set("VirtualFileHandleArray",{canHandle:s=>Array.isArray(s)&&s.every(({fileHandle:e})=>e instanceof ae),serialize:s=>[s.map(({fileHandle:e,...t})=>({fileHandle:e.serialize(),...t})),[]],deserialize:s=>s.map(({fileHandle:e,...t})=>({fileHandle:ae.deserialize(e),...t}))});const io="modulepreload",no=function(s){return"/"+s},Hn={},ue=function(e,t,i){return!t||t.length===0?e():Promise.all(t.map(n=>{if(n=no(n),n in Hn)return;Hn[n]=!0;const a=n.endsWith(".css"),r=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${r}`))return;const o=document.createElement("link");if(o.rel=a?"stylesheet":io,a||(o.as="script",o.crossOrigin=""),o.href=n,document.head.appendChild(o),a)return new Promise((l,d)=>{o.addEventListener("load",l),o.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())},Ei=JSON.parse(`{"general":{"yes":"Yes","no":"No","okay":"Okay","confirm":"Confirm","cancel":"Cancel","close":"Close","reload":"Reload","refresh":"Refresh","information":"Information","continue":"Continue","delete":"Delete","select":"Select","skip":"Skip","save":"Save","shareFile":"Share File","more":"More...","selectFolder":"Select Folder","fileName":"File Name","folderName":"Folder Name","inactive":"Inactive","active":"Active","later":"Later","clear":"Clear","reset":"Reset","readMore":"Read More","search":"Search...","confirmOverwriteFile":"This action overwrites a file with the same name. Do you want to continue?","confirmOverwriteFolder":"This action overwrites a folder with the same name. Do you want to continue?","fileSystemPolyfill":{"name":"Save Your Projects!","description":"Due to the browser you are using, you need to download your projects in order to actually save your progress. We recommend you use a browser where this is not necessary, such as Chrome or Edge on Desktop."},"successfulExport":{"title":"Export Successful","description":"You can find the exported package here"},"experimentalGameplay":"Experimental Gameplay","textureLocation":"Texture Location"},"openWith":{"snowstorm":"Snowstorm","textEditor":"Text Editor","treeEditor":"Tree Editor","htmlPreviewer":"HTML Previewer","blockbench":"Blockbench"},"packType":{"behaviorPack":{"name":"Behavior Pack","description":"Create new game mechanics and change how Minecraft behaves"},"resourcePack":{"name":"Resource Pack","description":"Used for changing Minecraft's look and sound"},"skinPack":{"name":"Skin Pack","description":"Provide new appearances a player can select for their character"},"worldTemplate":{"name":"World Template","description":"Create a world that users can create to experience your project"}},"fileType":{"manifest":"Manifest","animation":"Animation","animationController":"Animation Controller","biome":"Biome","block":"Block","bridgeConfig":"Project Config","dialogue":"Dialogue","entity":"Entity","feature":"Feature","featureRule":"Feature Rule","functionTick":"Function Tick","function":"Function","generatorScript":"Generator Script","item":"Item","lootTable":"Loot Table","recipe":"Recipe","clientScript":"Client Script","serverScript":"Server Script","script":"Script","spawnRule":"Spawn Rule","mcstructure":"Structure","tradeTable":"Trade Table","clientManifest":"Client Manifest","skinManifest":"Skin Manifest","geometry":"Geometry","customCommand":"Command","customComponent":"Component","clientAnimation":"Client Animation","clientAnimationController":"Client Animation Controller","attachable":"Attachable","clientEntity":"Client Entity","clientItem":"Client Item","clientLang":"Language","fog":"Fog","particle":"Particle","renderController":"Render Controller","texture":"Texture","textureSet":"Texture Set","itemTexture":"Item Texture","clientBlock":"Client Block","terrainTexture":"Terrain Texture","flipbookTexture":"Flipbook Texture","clientBiome":"Client Biome","soundDefinition":"Sound Definition","musicDefinition":"Music Definition","clientSound":"Client Sound","skins":"Skins","langDef":"Language Definitions","lang":"Language","molang":"Molang","gameTest":"Game Test","unknown":"Other","simpleFile":"Simple Files","ui":"UI","volume":"Volume","worldManifest":"World Manifest"},"actions":{"name":"Actions","download":{"name":"Download","description":"Download this file or folder"},"fullscreen":{"name":"Fullscreen","description":"Toggle fullscreen mode"},"viewConnectedFiles":{"name":"View Connected Files","description":"View all files connected to this file"},"viewExtensionsFolder":{"name":"View Extensions Folder","description":"View the folder where bridge. stores global extensions"},"open":{"name":"Open","description":"Open the file in the editor"},"openWith":{"name":"Open With","description":"Open the file in the editor"},"openInSplitScreen":{"name":"Open in Split Screen","description":"Open the file in split screen mode"},"edit":{"name":"Edit","description":"Edit the file or folder"},"delete":{"name":"Delete","description":"Delete a file or folder","confirmText":"Are you sure that you want to delete ","noRestoring":"You won't be able to restore it later!"},"rename":{"name":"Rename","description":"Rename a file","sameName":"Your new file name only differs in capitalization. This is not allowed on Windows."},"duplicate":{"name":"Duplicate","description":"Duplicate a file"},"viewCompilerOutput":{"name":"Compiler Output","view":"View Compiler Output","description":"View the current compiler output for this file","fileMissing":"It does not look like this file was compiled yet."},"revealPath":{"name":"Reveal Path","description":"Reveals the location of a file or folder"},"createFile":{"name":"Create File","description":"Create a new file"},"importFile":{"name":"Import File"},"createFolder":{"name":"Create Folder","description":"Create a new folder"},"findInFolder":{"name":"Find in Folder","description":"Search the contents of a folder"},"goHome":{"name":"Go Home","description":"Go back to the home screen"},"newProject":{"name":"New Project","description":"Create a new bridge. project"},"newFile":{"name":"New File","description":"Create a new Add-On feature"},"openFile":{"name":"Open File","description":"Open a file to edit it with bridge."},"openFolder":{"name":"Open Folder","description":"Open a folder to edit it, set it as an output folder or trigger other actions"},"searchFile":{"name":"Search File","description":"Search and open a file from the current project"},"saveFile":{"name":"Save File","description":"Save the currently opened file"},"saveAs":{"name":"Save As","description":"Save the currently opened file under a different name"},"saveAll":{"name":"Save All","description":"Save all currently opened files"},"closeFile":{"name":"Close File","description":"Close the currently opened file"},"settings":{"name":"Settings","description":"Open bridge.'s app settings"},"extensions":{"name":"Extensions","description":"Install and manage your installed extensions"},"copy":{"name":"Copy","description":"Copy selected text to the clipboard"},"cut":{"name":"Cut","description":"Copy selected text to the clipboard and remove it from the original context"},"paste":{"name":"Paste","description":"Paste clipboard content"},"docs":{"name":"Open bedrock.dev","description":"Opens the Minecraft Add-On documentation"},"minecraftDocs":{"name":"Open Minecraft Documentation","description":"Opens the Minecraft Bedrock Add-On documentation"},"releases":{"name":"Releases","description":"View the latest bridge. releases"},"bugReports":{"name":"Bug Reports","description":"Report an issue with bridge."},"twitter":{"name":"Twitter","description":"Follow bridge. on Twitter"},"extensionAPI":{"name":"Extension API","description":"Read more about bridge.'s extension API"},"gettingStarted":{"name":"Getting Started","description":"Read our guide on how to get started with bridge."},"faq":{"name":"FAQ","description":"Read through frequently asked questions about developing Add-Ons with bridge."},"reloadAutoCompletions":{"name":"Reload Auto-Completions","description":"Reloads all auto-completion data"},"reloadExtensions":{"name":"Reload Extensions","description":"Reloads all extensions"},"moveToSplitScreen":{"name":"Move to Split Screen","description":"Opens a split screen view and moves this tab to it"},"closeTab":{"name":"Close Tab","description":"Close this tab"},"closeAll":{"name":"Close All","description":"Close all tabs"},"closeTabsToRight":{"name":"Close Tabs to the Right","description":"Close all tabs to the right-hand side of this tab"},"closeAllSaved":{"name":"Close All Saved","description":"Close all saved tabs"},"closeOtherTabs":{"name":"Close other Tabs","description":"Close all tabs except this tab"},"clearAllNotifications":{"name":"Clear All Notifications","description":"Clears all current notifications"},"pluginInstallLocation":{"global":{"name":"Install Globally","description":"Global extensions are accessible in all of your projects"},"local":{"name":"Install Locally","description":"Local extensions are only accessible inside of the projects you add them to"}},"toObject":{"name":"Transform to Object"},"toArray":{"name":"Transform to Array"},"documentationLookup":{"name":"View Documentation","noDocumentation":"No documentation available for"},"toggleReadOnly":{"name":"Toggle Read-Only Mode","description":"Toggle read-only mode for the currently opened file"},"keepInTabSystem":{"name":"Keep in Tab System","description":"Converts this tab to a permanent tab"},"importBrproject":{"name":"Import Project","description":"Import a project from a .brproject file"},"downloadFile":{"name":"Download File","description":"Download the currently opened file"},"undo":{"name":"Undo","description":"Undo the last action"},"redo":{"name":"Redo","description":"Redo the last action"},"goToDefinition":{"name":"Go to Definition","description":"Go to the definition of the selected symbol"},"goToSymbol":{"name":"Go to Symbol","description":"Opens a dialog to select a symbol to go to"},"formatDocument":{"name":"Format Document","description":"Format the currently opened document"},"changeAllOccurrences":{"name":"Change All Occurrences","description":"Change all occurrences of the selected text"},"tgaMaskToggle":{"name":"Show/Hide Alpha Mask"},"recompileChanges":{"name":"Compile Changes","description":"Compile all files that were edited without bridge. This will not compile any changes made in the editor itself after disabling watch mode"}},"toolbar":{"project":{"name":"Project"},"file":{"name":"File","preferences":{"name":"Preferences"}},"edit":{"name":"Edit"},"view":{"name":"View","togglePackExplorer":{"name":"Toggle Pack Explorer","description":"Toggle the pack explorer that appears inside of bridge.'s sidebar"},"openFileSearch":{"name":"Open Find & Replace","description":"Opens a new Find & Replace tab"},"cursorUndo":{"name":"Cursor Undo","description":"Undo the last cursor position change"},"cursorRedo":{"name":"Cursor Redo","description":"Redo the last cursor position change"},"nextTab":{"name":"Next Tab","description":"Switch to the next tab"},"previousTab":{"name":"Previous Tab","description":"Switch to the previous tab"}},"tools":{"name":"Tools"},"help":{"name":"Help"}},"packExplorer":{"name":"Pack Explorer","searchFiles":"Search files...","categories":"Categories","move":{"toLocal":"Move to Local Folder","toBridgeFolder":"Move to bridge. Folder"},"refresh":{"name":"Refresh Project","description":"Fetch the current project for newly added files"},"noProjectView":{"noProjectsFound":"It does not look like you have any projects yet!","createLocalProject":"Create Local Project","chooseBridgeFolder":"Choose bridge. Folder","accessBridgeFolder":"Access bridge. Folder","projectNoLongerExists":"It looks like this project no longer exists!"},"restartWatchMode":{"name":"Restart Watch Mode","description":"Restart the compiler's watch mode to delete the current build output, rebuild the complete project and then start watching for further changes.","confirmDescription":"Are you sure that you want to restart the compiler's watch mode? This can take some time depending on the size of your project. Restarting the compiler deletes your add-on from the com.mojang folder and recompiles it based on your bridge. folder!"},"createPreset":"New File","projectConfig":{"name":"Open Project Config","missing":"It looks like this project has no config.json file. Every project needs a project config in order to work correctly."},"openProjectFolder":{"name":"Open Project Folder"},"exportAs":{"name":"Export As","mcaddon":".mcaddon","brproject":".brproject","mcworld":".mcworld","mctemplate":".mctemplate"},"fileDiagnostics":{"fileUnused":"This file is not used within your project"}},"sidebar":{"quickExport":{"name":"Quick Export"},"openedFolders":{"name":"Opened Folders","removeFolder":"Remove From View"},"compiler":{"name":"Compiler","categories":{"watchMode":{"name":"Watch Mode","settings":{"watchModeActive":{"name":"Watch Mode","description":"Enable or disable automatically recompiling files when you make changes with bridge."},"autoFetchChangedFiles":{"name":"Auto Fetch","description":"Automatically search the project for changed files upon starting bridge."}}},"profiles":"Build Profiles","outputFolders":"Output Folders","logs":{"name":"Logs","noLogs":"Dash did not produce any logs to show yet."}},"default":{"name":"Default Config","description":"Run bridge.'s compiler with the default compiler configuration that is part of your project's \\"config.json\\" file."},"actions":{"runLastProfile":"Run Last Profile"}},"extensions":{"name":"Extensions"},"notifications":{"socials":{"message":"Socials"},"gettingStarted":{"message":"Getting Started"},"installApp":{"message":"Install App"},"updateAvailable":{"message":"Update Available"},"updateExtensions":"Update All Extensions"}},"experimentalGameplay":{"cavesAndCliffs":{"name":"Caves and Cliffs","description":"Enables auto-completions for the new mountain generation inside of biomes."},"holidayCreatorFeatures":{"name":"Holiday Creator Features","description":"Enables auto-completions for the data driven item and block features."},"creationOfCustomBiomes":{"name":"Creation of Custom Biomes","description":"Enables the creation of custom biomes, features and feature rules."},"additionalModdingCapabilities":{"name":"Additional Modding Capabilities","description":"Enables the Scripting API in the manifest and allows you to create scripts with auto-completions."},"upcomingCreatorFeatures":{"name":"Upcoming Creator Features","description":"Enables the creation of fog volume files and provides auto-completions for entity properties."},"enableGameTestFramework":{"name":"Beta APIs","description":"Enables the beta level script API related modules in the manifest and allows you to create scripts with auto-completions."},"experimentalMolangFeatures":{"name":"Experimental Molang Features","description":"Enables auto-completions for experimental Molang queries."},"theWildUpdate":{"name":"The Wild Update","description":"Enables auto-completions for new features introduced in the Wild Update, such as entity components."},"educationEdition":{"name":"Enable Education Edition","description":"Enables auto-completions for education features such as material reducer recipes."}},"windows":{"sidebar":{"disabledItem":"This item is disabled"},"changelogWindow":{"title":"What's new?"},"openFile":{"title":"Open","search":"Search file...","noData":"No results..."},"assetPreview":{"title":"Asset Preview","previewScale":"Preview Scale","assetName":"Asset Name","boneVisibility":"Bone Visibility","backgroundColor":"Background Color","outputResolution":"Output Resolution"},"createProject":{"welcome":"Welcome to bridge.!","welcomeDescription":"Please create your first project in order to get started.","omitPack":"Omit","selectedPack":"Selected","title":"Create Project","packIcon":"Project Icon (optional)","projectName":{"name":"Project Name","invalidLetters":"Project name must not contain the following characters: \\"  \\\\ / : | < >  * ? ~","mustNotBeEmpty":"You must enter a project name","endsInPeriod":"Project name cannot end with a period"},"projectDescription":"Project Description (optional)","projectPrefix":"Project Prefix","projectAuthor":"Project Author","projectTargetVersion":"Project Target Version","rpAsBpDependency":"Register resource pack as behavior pack dependency","bpAsRpDependency":"Register behavior pack as a resource pack dependency","useLangForManifest":"Add pack name/description directly to the manifest","bdsProject":"Set project for use with Bedrock Dedicated Servers","create":"Create","saveCurrentProject":"Do you want to save your current project before creating the new one? Any unsaved changes will get lost!","individualFiles":{"name":"Individual Files","file":{"player":{"name":"player.json","description":"Edit how the default player behaves"},"tick":{"name":"tick.json","description":"Define which functions to execute every tick"},"skins":{"name":"skins.json","description":"Register the skins you have created"},"blocks":{"name":"blocks.json","description":"Used to define how multiple block faces are combined to a single block"},"terrainTexture":{"name":"terrain_texture.json","description":"Used to assign textures to block faces"},"itemTexture":{"name":"item_texture.json","description":"Used to assign textures to items"},"flipbookTextures":{"name":"flipbook_textures.json","description":"Used for animating block textures"},"biomesClient":{"name":"biomes_client.json","description":"Used to define how biome specific effects render"},"sounds":{"name":"sounds.json","description":"Used to define sounds for specific game features"},"soundDefinitions":{"name":"sound_definitions.json","description":"Used to register ids for sound files to be used elsewhere in the project"}}}},"createPreset":{"title":"Create Preset","searchPresets":"Search presets...","overwriteFiles":"This preset overwrites one or more existing files. Do you want to continue?","overwriteFilesConfirm":"Continue","overwriteUnsavedChanges":"This preset overwrites one or more files with unsaved changes. Do you want to continue?","overwriteUnsavedChangesConfirm":"Continue","validationRule":{"alphanumeric":"You may only use alphanumeric characters and/or underscores","lowercase":"You may only use lowercase letters","required":"This field is required","noEmptyFolderNames":"Folder name may not be empty"},"showAllPresets":"Show all presets","disabledPreset":{"experimentalGameplay":"Required experimental gameplay toggle condition(s) not met","packTypes":"Required pack condition(s) not met","targetVersion":"Required target version not met","manifestDependency":"Required BP manifest dependencies are missing"}},"deleteProject":{"confirm":"Delete","description":"Are you sure you want to delete this project?"},"socials":{"title":"Socials","content":"Check out our Twitter, Github and join the official bridge. Discord server!","discord":"Discord","twitter":"Twitter","github":"Github"},"projectChooser":{"title":"Choose Project","description":"Select the currently active project","searchProjects":"Search projects...","loadAllProjects":"Load All","openPacks":"Open Packs","localProject":{"name":"Local Project","description":"Local projects cannot be accessed outside of bridge."},"comMojangProject":{"name":"com.mojang Project","description":"This project was loaded directly from your com.mojang folder","uninstallWarning":"This project will be deleted if you uninstall Minecraft."},"newProject":{"name":"New Project","description":"Create a new bridge. project."},"saveCurrentProject":{"name":"Save Project","description":"Download your current project as a .brproject file to save changes that you have made."},"openNewProject":{"name":"Open Project","description":"Open a different project by selecting the corresponding .brproject file.","saveCurrentProject":"Do you want to save your current project before loading in the new one?"},"wrongFileType":"Project must be a .brproject or .mcaddon file","addPack":"Add Pack"},"filePath":{"title":"Choose File Path"},"lootSimulatorSettings":{"title":"Simulator Settings","repeat":{"name":"Repeat Options","amount":{"name":"Repeat","description":"Repeat the loot table a set amount of times"},"itemFound":{"name":"Item Identifier","description":"Run the loot table until an item stack with the specified identifier is found"},"quantityFound":{"name":"Quantity","description":"Run the loot table until an item stack with the specified quantity is found"}},"killConditions":{"looting":{"name":"Looting Enchant","description":"The level of looting used to run the table, 0 for no looting"}}},"settings":{"title":"Settings","searchSettings":"Search settings...","reloadRequired":"You need to reload bridge. in order to apply the changes made to the settings.","sidebar":{"name":"Sidebar","sidebarRight":{"name":"Sidebar Right","description":"Moves the sidebar to the right side of the screen"},"sidebarSize":{"name":"Sidebar Size","description":"Changes the width of the expanded sidebar area."},"shrinkSidebarElements":{"name":"Shrink Sidebar Elements","description":"Shrink the size of bridge.'s sidebar elements"}},"appearance":{"name":"Appearance","colorScheme":{"name":"Color Scheme","description":"Choose the color scheme of bridge.'s UI"},"darkTheme":{"name":"Dark Theme","description":"Select the default dark theme bridge. uses"},"lightTheme":{"name":"Light Theme","description":"Select the default light theme bridge. uses"},"localDarkTheme":{"name":"Local Dark Theme","description":"Choose a dark theme for the currently active project"},"localLightTheme":{"name":"Local Light Theme","description":"Choose a light theme for the currently active project"},"fontSize":{"name":"Font Size","description":"Change the font size of bridge.'s text"},"editorFontSize":{"name":"Code Font Size","description":"Change the font size of bridge.'s code editor"},"editorFont":{"name":"Code Font","description":"Change the font of bridge.'s code editor"},"font":{"name":"Font","description":"Change the font that is used inside of bridge.'s user interface"},"hideToolbarItems":{"name":"Hide Toolbar Items","description":"Make bridge. feel at home on MacOS: Move all toolbar items into a new menu button"}},"general":{"name":"General","language":{"name":"Language","description":"Choose a language for bridge. to use"},"collaborativeMode":{"name":"Collaborative Mode","description":"Forces full refresh of the cache upon switching projects. Disable when you work alone and you only use bridge. to edit your project"},"packSpider":{"name":"Pack Spider","description":"Pack Spider connects files inside of your projects and presents the connections to you in a virtual file system"},"formatOnSave":{"name":"Format On Save","description":"Formats your text files upon saving them"},"openLinksInBrowser":{"name":"Open Links in Default Browser","description":"Open links inside of your default browser instead of a native app window"},"restoreTabs":{"name":"Restore Tabs","description":"Restore your tabs from when you last used bridge. upon opening the app"},"resetBridgeFolder":{"name":"Select Root Folder","description":"Choose the main folder bridge. operates on"}},"developer":{"name":"Developer","simulateOS":{"name":"Simulate OS","description":"Simulate a different OS for testing platform specific behavior"},"devMode":{"name":"Developer Mode","description":"Enable the developer mode for this app"},"forceDataDownload":{"name":"Force Data Download","description":"Ignore the cached app data and instead download the latest data"}},"actions":{"name":"Actions"},"projects":{"name":"Projects","defaultAuthor":{"name":"Default Author","description":"The default author for new projects"},"loadComMojangProjects":{"name":"Load com.mojang Projects","description":"Automatically load projects from the com.mojang folder"},"incrementVersionOnExport":{"name":"Increment Version","description":"Automatically increment the version number inside of your pack manifests when exporting a project"},"addGeneratedWith":{"name":"Add \\"generated_with\\"","description":"Add the \\"generated_with\\" metadata to your projects' manifests"}},"editor":{"jsonEditor":{"name":"JSON Editor","description":"Choose how you want to edit JSON files"},"bracketPairColorization":{"name":"Bracket Pair Colorization","description":"Give matching brackets an unique color"},"wordWrap":{"name":"Word Wrap","description":"Wrap words to disable horizontal scrolling"},"wordWrapColumns":{"name":"Word Wrap Columns","description":"Defines after how many columns the editor should wrap words"},"compactTabDesign":{"name":"Compact Tab Design","description":"Display tabs inside of the tab system in a more compact way"},"keepTabsOpen":{"name":"Keep Tabs Open","description":"By default, opening a new tab closes the previously opened tab if it was not interacted with"},"autoSaveChanges":{"name":"Auto Save Changes","description":"Automatically save changes to files after a short delay"},"bridgePredictions":{"name":"bridge. Predictions","description":"Enable bridge. predictions to let the app intelligently decide whether to add a value or object within bridge.'s tree editor. This simplifies editing JSON significantly"},"automaticallyOpenTreeNodes":{"name":"Automatically Open Tree Nodes","description":"Inside of bridge.'s tree editor, automatically open nodes when you select them"},"dragAndDropTreeNodes":{"name":"Drag and Drop Tree Nodes","description":"Disable/enable drag & drop for tree nodes inside of bridge.'s tree editor"},"showArrayIndices":{"name":"Show Array Indices","description":"Show indices for array elements inside of bridge.'s tree editor"},"hideBracketsWithinTreeEditor":{"name":"Hide Brackets","description":"Hide brackets within bridge.'s tree editor"}}},"projectFolder":{"title":"Project Folder","content":"bridge. needs access to its project folder in order to work correctly."},"extensionStore":{"title":"Extension Store","searchExtensions":"Search Extension...","deleteExtension":"Delete Extension","activateExtension":"Activate Extension","deactivateExtension":"Deactivate Extension","installLocal":"Install Local","installGlobal":"Install Global","offlineError":"Failed to load extensions. Please confirm that your device has an active network connection.","incompatibleVersion":"Incompatible bridge. version","compilerPluginDownload":{"compilerPlugins":"Compiler Plugins","title":"Downloaded Compiler Plugin","description":"You have just downloaded a new compiler plugin. Make sure to add it to your compiler config file or otherwise it won't have an effect.","openConfig":"Open Config"}},"pluginInstallLocation":{"title":"Choose Install Location"},"unsavedFile":{"description":"Do you want to save your changes to this file before closing it?","save":"Save & Close"},"browserUnsupported":{"title":"Browser Warning","description":"In order to get the best experience with bridge., you need to use Chrome (excluding Chrome 93/94) or Edge (Chromium) on desktop. If you continue, you will not be able to save files directly and you will need to download your project in order to save it or test your changes in Minecraft.","continue":"Continue Anyway"},"invalidJson":{"title":"Invalid JSON","description":"bridge.'s tree editor cannot open files that contain invalid JSON. You can switch to the \\"Raw Text\\" editor type inside of the settings to manually fix the issue."},"loadingWindow":{"titles":{"loading":"Loading..."}},"upgradeFs":{"title":"Upgrade File System?","description":"Your browser now supports saving files directly to your computer. Do you want to upgrade now?"}},"taskManager":{"tasks":{"packIndexing":{"title":"Indexing Packs","description":"bridge. is collecting data about your pack that is needed for its intelligent features"},"compiler":{"title":"Compiling Project","description":"bridge. is compiling your project to make it ready for import into Minecraft"},"unzipper":{"name":"Unpacking ZIP","description":"bridge. is currently unpacking a ZIP file."},"loadingSchemas":{"name":"Loading Auto-Completions","description":"bridge. is currently loading its auto-completion data."}}},"fileDropper":{"importFiles":"Drop files here to import them!","importFailed":"bridge. was unable to import the following files:","andMore":"...and more!","importMethod":{"name":"Import Method","folder":{"output":{"name":"Output Folder","description":"Sets this folder as a new output folder"},"open":{"name":"Open Folder","description":"Opens this folder in bridge.'s file explorer"}}},"mcaddon":{"missingManifests":"bridge. was unable to load data from your .mcaddon or .mpack file because it wasn't able to find a pack manifest file inside of it."},"saveToProject":{"title":"Save to Project","description1":"Save the file ","description2":" inside of your project."},"openFile":{"title":"Open File","description1":"Open the file ","description2":" and save edits to the original file."}},"comMojang":{"title":"Access to folder \\"com.mojang\\"","permissionRequest":"bridge. needs access to your \\"com.mojang\\" folder in order to compile projects to it.","status":{"sucess":"Syncing your projects to com.mojang is setup correctly.","deniedPermission":"You setup com.mojang syncing but you did not grant bridge. permission to the folder.","notSetup":"You have not setup com.mojang syncing yet. Drag your com.mojang folder onto bridge. to do so.","notAvailable":"Syncing projects to the com.mojang folder is only available for Chrome and Edge users."}},"findAndReplace":{"name":"Find & Replace","findOnly":"Find","search":"Search","replace":"Replace","replaceAll":"Replace All","includeFiles":"Files to Include","excludeFiles":"Files to Exclude","noResults":"No results found.","noSearch":"Once you start typing, results for your search query will appear here."},"preview":{"name":"Preview","viewAnimation":"View Animation","viewModel":"View Model","viewParticle":"View Particle","viewEntity":"View Entity","viewBlock":"View Block","simulateLoot":"Simulate Loot","failedClientEntityLoad":"Failed to load connected client entity","invalidEntity":"Cannot open preview for an entity with invalid JSON. Please fix JSON errors inside of the file and try again.","chooseGeometry":"Choose Geometry","chooseTexture":"Choose Texture","noGeometry":"No valid geometry found inside of this file. Make sure that your JSON is valid, that the file structure is correct and that a geometry with the provided identifier exists.","lootTableSimulator":{"emptyLootOutput":"Output is empty, try running the loot table to collect results.","data":{"value":"Data Value","enchantments":"Enchantments","blockStates":"Block States","itemAuxValue":"Aux Value","eggIdentifier":"Spawns Entity","bannerType":"Banner Type","bookData":{"view":"View Book","title":"Title","author":"Author"},"durability":"Durability","lore":"Lore","displayName":"Display Name","mapDestination":"Map Destination"}}},"initialSetup":{"welcome":"Welcome to bridge. v2!","welcomeCaption":"A powerful IDE for Minecraft Add-Ons","step":{"installApp":{"name":"Install bridge.","description":"Click here to install bridge. v2 as an app to your device."},"bridge":{"name":"bridge. Folder","description":"Please create a folder where bridge. can save app related data and your add-on projects."},"bridgeProject":{"name":"bridge. Project","description":"Do you want to create a new project or import an existing project from a .brproject file?","createNew":{"name":"New Project","description":"Create a new project."},"importExisting":{"name":"Import Project","description":"Import an existing project."}},"comMojang":{"name":"com.mojang Folder","description":"Drag your com.mojang folder onto bridge. to setup syncing of projects to this folder. This makes your add-ons accessible inside of Minecraft for Windows 10 automatically. Setting up com.mojang syncing can be done at any point in time while bridge. is open.","extraDescription":"Drag your com.mojang folder onto bridge."},"editorType":{"name":"Choose Editor Type","description":"How do you want to edit JSON files? You can change your choice inside of bridge.'s settings later!","rawText":{"name":"Raw Text","description":"Edit JSON as raw text. Ideal for intermediate to advanced developers. Comes with advanced auto-completions and JSON validation."},"treeEditor":{"name":"Tree Editor","description":"Edit JSON as a tree-like structure that requires little to no JSON knowledge. Ideal for beginners and intermediate creators."}}}},"editors":{"treeEditor":{"add":"Add","addObject":"Add Object","addArray":"Add Array","addValue":"Add Value","forceValue":"Force Value","edit":"Edit"},"langValidation":{"noValue":{"errorMessage":"Language keys must be assigned a value","quickFix":"Add a value to this key"}}},"validation":{"mcfunction":{"invalidArgument":{"name":"Argument {{$1}} is not valid here"},"unknownCommand":{"name":"Command {{$1}} does not exist"},"missingArguments":{"name":"Command {{$1}} requires more arguments"},"unknownSchema":{"name":"Unknown schema value {{$1}}"},"unknownSchemaInArgument":{"name":"Unknown schema value {{$1}} for argument {{$2}}"},"invalidSelectorBase":{"name":"Invalid target selector base {{$1}}"},"unexpectedSymbol":{"name":"Unexpected symbol {{$1}}. Expected {{$2}}"},"invalidSelectorArgument":{"name":"Invalid selector argument {{$1}}"},"argumentNoSupport":{"name":"Argument {{$1}} does not support {{$2}}","bothConditions":"Argument {{$1}} does not support multiple instances when not all negated"},"invalidSelectorArgumentValue":{"name":"Invalid selector argument value {{$1}} for argument {{$2}}"},"conditions":{"negation":"negation","multipleInstances":"multiple instances"},"tokens":{"selectorArgument":"selector argument"}}}}`),Di=JSON.parse('[{"id":"english","name":"English","file":"en.json","codes":["en-US","en-UK"]},{"id":"german","name":"Deutsch","file":"de.json","codes":["de-DE"]},{"id":"japanese","name":"\u65E5\u672C\u8A9E","file":"ja.json","codes":["ja-JP"]},{"id":"korean","name":"\uD55C\uAD6D\uC5B4","file":"ko.json","codes":["ko-KR"]},{"id":"chineseCN","name":"\u4E2D\u6587","file":"zh-CN.json","codes":["zh-CN"]},{"id":"chineseTW","name":"\u4E2D\u6587(\u81FA\u7063)","file":"zh-TW.json","codes":["zh-TW"]},{"id":"netherlands","name":"Nederlands","file":"nl.json","codes":["nl-NL"]}]'),so=Object.fromEntries(Object.entries(Object.assign({"../../locales/de.json":()=>ue(()=>import("./de.6bd3df5b.js"),[]),"../../locales/ja.json":()=>ue(()=>import("./ja.4a9a1a08.js"),[]),"../../locales/ko.json":()=>ue(()=>import("./ko.f2dd296f.js"),[]),"../../locales/nl.json":()=>ue(()=>import("./nl.8e3d6a12.js"),[]),"../../locales/zh-CN.json":()=>ue(()=>import("./zh-CN.7b308fa9.js"),[]),"../../locales/zh-TW.json":()=>ue(()=>import("./zh-TW.9e137765.js"),[])})).map(([s,e])=>[s.split("/").pop(),e]));class ge{static getAvailableLanguages(){return Di.sort((e,t)=>e.name.localeCompare(t.name)).map(e=>({text:e.name,value:e.id}))}static getCurrentLanguageId(){return this.currentLanuageId}static async setDefaultLanguage(){const e=await he("language");if(e)await this.applyLanguage(e);else for(const t of navigator.languages){const i=Di.find(({codes:n})=>n.includes(t));if(!!i){await this.applyLanguage(i.id);break}}}static async applyLanguage(e){var n;if(e===this.currentLanuageId)return;if(e==="english"){this.currentLanguage=Mi(Ei),this.currentLanuageId=e;return}const t=(n=Di.find(a=>a.id===e))==null?void 0:n.file;if(!t)throw new Error(`[Locales] Language with id "${e}" not found`);const i=(await so[t]()).default;if(!i)throw new Error(`[Locales] Language with id "${e}" not found: File "${t}" does not exist`);this.currentLanguage=pi(Mi(Ei),Mi({...i})),this.currentLanuageId=e}static translate(e){if(!e)return"";if(e.startsWith("[")&&e.endsWith("]"))return e.slice(1,-1);const t=e.split(".");let i=this.currentLanguage;for(const n of t)if(i=i[n],!i)return console.warn(`[Locales] Translation key "${e}" not found`),e;return typeof i!="string"?(console.warn(`[Locales] Translation key "${e}" not found`),e):i}}c(ge,"currentLanguage",Ei),c(ge,"currentLanuageId","english");function R(s){return ge.translate(s)}function V(s,e){let t=ge.translate(s);if(!e)return t;for(let i=0;i<=e.length;i++)t=t==null?void 0:t.replace(`{{$${i+1}}}`,e[i]);return t}function Mi(s){return typeof window.structuredClone=="function"?window.structuredClone(s):JSON.parse(JSON.stringify(s))}function O(){return{t:s=>ge.translate(s)}}let b=q({});function ao(s){for(const e in s)U(b,e,s[e])}function H(){var e;if(((e=b==null?void 0:b.developers)==null?void 0:e.simulateOS)&&b.developers.simulateOS!=="auto")return b.developers.simulateOS;const s=navigator.platform.toLowerCase();return s.includes("win")?"win32":s.includes("linux")?"linux":s.includes("mac")?"darwin":(console.error(`Unknown platform: ${s}`),"win32")}class D extends z{constructor(t){var i;super();c(this,"type","action");c(this,"id");c(this,"addPadding",!1);this.config=t,this.id=(i=t.id)!=null?i:E()}get name(){return this.config.name}get icon(){return this.config.icon}get description(){return this.config.description}get color(){return this.config.color}get isDisabled(){var t,i,n,a;return typeof this.config.isDisabled=="function"?(n=(i=(t=this.config).isDisabled)==null?void 0:i.call(t))!=null?n:!1:(a=this.config.isDisabled)!=null?a:!1}getConfig(){return this.config}async trigger(){if(!this.isDisabled)return this.dispatch(),await this.config.onTrigger(this)}withPadding(){const t=new D(this.config);return t.addPadding=!0,t}}const Xt=new vs({breakpoint:{mobileBreakpoint:"xs"},theme:{dark:!0,options:{customProperties:!0,variations:!1},themes:{dark:{primary:"#0073FF",secondary:"#0073FF",accent:"#0073FF",background:"#121212",sidebarNavigation:"#1F1F1F",expandedSidebar:"#1F1F1F",menu:"#424242",footer:"#111111",tooltip:"#1F1F1F"},light:{primary:"#0073FF",secondary:"#0073FF",accent:"#0073FF",background:"#fafafa",sidebarNavigation:"#FFFFFF",expandedSidebar:"#FFFFFF",tooltip:"#424242",toolbar:"#e0e0e0",footer:"#f5f5f5"}}}});function Un(){return{isDarkMode:B(()=>Xt.framework.theme.dark)}}function zn(){return{isMobile:B(()=>Xt.framework.breakpoint.mobile),isMinimalDisplay:B(()=>!Xt.framework.breakpoint.mdAndUp)}}function _(s,e,t,i,n,a,r,o){var l=typeof s=="function"?s.options:s;e&&(l.render=e,l.staticRenderFns=t,l._compiled=!0),i&&(l.functional=!0),a&&(l._scopeId="data-v-"+a);var d;if(r?(d=function(m){m=m||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!m&&typeof __VUE_SSR_CONTEXT__<"u"&&(m=__VUE_SSR_CONTEXT__),n&&n.call(this,m),m&&m._registeredComponents&&m._registeredComponents.add(r)},l._ssrRegister=d):n&&(d=o?function(){n.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:n),d)if(l.functional){l._injectStyles=d;var p=l.render;l.render=function(f,g){return d.call(g),p(f,g)}}else{var h=l.beforeCreate;l.beforeCreate=h?[].concat(h,d):[d]}return{exports:s,options:l}}const ro={__name:"DisplayAction",props:{action:{type:D,required:!0}},setup(s){const{t:e}=O(),{isDarkMode:t}=Un(),{isMinimalDisplay:i}=zn();return{__sfc:!0,t:e,isDarkMode:t,isMinimalDisplay:i,SimpleAction:D,platform:H,useDarkMode:Un,useTranslations:O,useDisplay:zn}}};var oo=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-btn",{style:i.platform()==="darwin"?"border-radius: 8px":void 0,attrs:{text:!i.isMinimalDisplay,small:"",icon:i.isMinimalDisplay},on:{click:function(n){return e.action.trigger()}}},[t("v-icon",{class:{"mr-1":!0,"ml-1":i.isMinimalDisplay},attrs:{color:e.action.accent||"accent",small:""}},[e._v(" "+e._s(e.action.icon)+" ")]),i.isMinimalDisplay?e._e():t("span",{style:{"text-transform":"none","font-weight":"unset",color:i.isDarkMode?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"}},[e._v(" "+e._s(i.t(e.action.name))+" ")])],1)},co=[],lo=_(ro,oo,co,!1,null,null,null,null);const Fs=lo.exports,uo={name:"WindowsToolbar",components:{DisplayAction:Fs},props:{windowTitle:String,actions:Array,sidebarWidth:{type:String,default:"25%"},hasCloseButton:{type:Boolean,default:!0},hasMaximizeButton:{type:Boolean,default:!0},hasSidebar:Boolean},computed:{isDarkMode(){return this.$vuetify.theme.dark}}};var po=function(){var e=this,t=e._self._c;return t("v-system-bar",{style:{"padding-right":"0px","padding-left":e.hasSidebar?`calc(${e.sidebarWidth} + 12px)`:void 0},attrs:{height:"30px",color:"toolbar"}},[t("span",[e._v(e._s(e.windowTitle))]),t("v-spacer"),t("v-toolbar-items",{staticClass:"px14-font"},[e._l(e.actions,function(i){return t("DisplayAction",{key:i.id,attrs:{action:i}})}),e._t("default"),e.hasMaximizeButton?t("v-btn",{attrs:{small:"",icon:""},on:{click:function(i){return i.stopPropagation(),e.$emit("toggleFullscreen")}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-plus")])],1):e._e(),e.hasCloseButton?t("v-btn",{staticClass:"mr-1",attrs:{small:"",icon:"",color:"error"},on:{click:function(i){return i.stopPropagation(),e.$emit("closeWindow")}}},[t("v-icon",{attrs:{color:e.isDarkMode?"white":"grey darken-1",small:""}},[e._v(" mdi-close ")])],1):e._e()],2)],1)},ho=[],mo=_(uo,po,ho,!1,null,null,null,null);const fo=mo.exports;const go={props:{color:String,disabled:Boolean},data:()=>({windowHasFocus:!0}),mounted(){window.addEventListener("focus",this.enableButton),window.addEventListener("blur",this.disableButton)},destroyed(){window.removeEventListener("focus",this.enableButton),window.removeEventListener("blur",this.disableButton)},computed:{isDarkMode(){return this.$vuetify.theme.dark}},methods:{disableButton(){this.windowHasFocus=!1},enableButton(){this.windowHasFocus=!0}}};var wo=function(){var e=this,t=e._self._c;return t("v-icon",{directives:[{name:"ripple",rawName:"v-ripple",value:!e.disabled,expression:"!disabled"}],staticClass:"mr-1",staticStyle:{"font-size":"15px"},attrs:{color:e.disabled||!e.windowHasFocus?e.isDarkMode?"grey darken-2":"grey":e.color,small:""},nativeOn:{click:function(i){return i.stopPropagation(),e.$emit("click")}}},[e._v(" mdi-checkbox-blank-circle ")])},yo=[],vo=_(go,wo,yo,!1,null,null,null,null);const bo=vo.exports;const _o={components:{MacButton:bo},props:{hasCloseButton:{type:Boolean,default:!0},hasMinimizeButton:{type:Boolean,default:!1},hasMaximizeButton:{type:Boolean,default:!0}},computed:{isDarkMode(){return this.$vuetify.theme.dark}}};var So=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{position:"fixed","z-index":"1"}},[e.hasCloseButton?t("MacButton",{attrs:{color:"error"},on:{click:function(i){return e.$emit("closeWindow")}}}):e._e(),e.hasCloseButton?t("MacButton",{attrs:{color:"warning",disabled:!e.hasMinimizeButton},on:{click:function(i){return e.$emit("minimizeWindow")}}}):e._e(),e.hasCloseButton?t("MacButton",{attrs:{color:"success",disabled:!e.hasMaximizeButton},on:{click:function(i){return e.$emit("toggleFullscreen")}}}):e._e()],1)},Co=[],xo=_(_o,So,Co,!1,null,null,null,null);const Ts=xo.exports;const ko={name:"MacToolbar",components:{MacWindowControls:Ts,DisplayAction:Fs},props:{windowTitle:String,hasSidebar:Boolean,actions:Array,sidebarWidth:{type:String,default:"25%"},hasCloseButton:{type:Boolean,default:!0},hasMinimizeButton:{type:Boolean,default:!1},hasMaximizeButton:{type:Boolean,default:!0}}};var Po=function(){var e=this,t=e._self._c;return t("v-system-bar",{attrs:{height:"30px",color:"toolbar"}},[t("span",{class:{"window-title":!e.hasSidebar},style:{"padding-left":e.hasSidebar?`calc(${e.sidebarWidth} + 12px)`:void 0}},[e._v(" "+e._s(e.windowTitle)+" ")]),t("div",{staticStyle:{position:"absolute",top:"3px"}},[e.hasSidebar?e._e():t("MacWindowControls",e._g({attrs:{hasCloseButton:e.hasCloseButton,hasMaximizeButton:e.hasMaximizeButton,hasMinimizeButton:e.hasMinimizeButton}},e.$listeners))],1),t("v-spacer"),e._l(e.actions,function(i){return t("DisplayAction",{key:i.id,attrs:{action:i}})}),e._t("default")],2)},jo=[],Fo=_(ko,Po,jo,!1,null,"39653066",null,null);const To=Fo.exports;const Ao={name:"BaseWindow",components:{WindowsToolbar:fo,MacToolbar:To,MacWindowControls:Ts},props:{isFullscreen:Boolean,isLoading:Boolean,isVisible:Object|Boolean,shouldRender:Object|Boolean,isPersistent:Boolean,actions:Array,sidebarWidth:{type:String,default:"25%"},blurBackground:{type:Boolean,default:!0},hideToolbar:Boolean,windowTitle:String,hasCloseButton:{type:Boolean,default:!0},hasMaximizeButton:{type:Boolean,default:!1},width:{type:Number,default:1600},maxWidth:{type:Number,default:1600},height:{type:Number,default:800},maxHeight:{type:Number,default:800},heightUnset:Boolean,percentageHeight:Number,percentageWidth:Number,maxPercentageHeight:Number,maxPercentageWidth:Number,isSmallPopup:Boolean},setup(){const{t:s}=O();return{t:s}},data(){return{platform:H(),globalWindowWidth:window.innerWidth,globalWindowHeight:window.innerHeight,updateWindowSize:He(function(){this.globalWindowWidth=window.innerWidth,this.globalWindowHeight=window.innerHeight},200).bind(this)}},mounted(){window.addEventListener("resize",this.updateWindowSize)},destroyed(){window.removeEventListener("resize",this.updateWindowSize)},computed:{calcSidebarWidth(){return this.$vuetify.breakpoint.mobile?"76px":this.sidebarWidth},isFullScreenOrMobile(){return!this.isSmallPopup&&this.$vuetify.breakpoint.mobile||this.isFullscreen},isDarkMode(){return this.$vuetify.theme.dark},windowWidth(){return this.percentageWidth==null?this.width:this.globalWindowWidth/100*this.percentageWidth},windowHeight(){return this.percentageHeight==null?this.height:this.globalWindowHeight/100*this.percentageHeight-150},maxWindowWidth(){return this.maxPercentageWidth==null?this.maxWidth:this.globalWindowWidth/100*this.maxPercentageWidth},maxWindowHeight(){return!this.isSmallPopup&&this.$vuetify.breakpoint.mobile?this.globalWindowHeight-!this.hideToolbar*30-!!this.$slots.actions*52:this.maxPercentageHeight==null?this.maxHeight:this.globalWindowHeight/100*this.maxPercentageHeight-150}}};var $o=function(){var e=this,t=e._self._c;return t("v-dialog",{attrs:{value:e.isVisible,fullscreen:!e.isSmallPopup&&e.$vuetify.breakpoint.mobile,persistent:e.isPersistent,"hide-overlay":!e.blurBackground,"max-width":e.isFullScreenOrMobile?e.maxWindowWidth:e.windowWidth,"content-class":"no-overflow"},on:{input:function(i){return e.$emit("closeWindow")}}},[t("v-card",{ref:"card",attrs:{height:"100%",width:"100%",color:"background",rounded:e.isFullScreenOrMobile?null:"lg"}},[e.hideToolbar?e._e():t(e.platform==="darwin"?"MacToolbar":"WindowsToolbar",{tag:"component",attrs:{windowTitle:e.t(e.windowTitle),actions:e.actions,hasMaximizeButton:e.hasMaximizeButton,hasCloseButton:e.hasCloseButton,hasSidebar:!!e.$slots.sidebar,sidebarWidth:e.calcSidebarWidth},on:{toggleFullscreen:function(i){return e.$emit("toggleFullscreen")},closeWindow:function(i){return e.$emit("closeWindow")}}},[e._t("toolbar")],2),e.$slots.sidebar?t("v-navigation-drawer",{class:e.isFullScreenOrMobile?null:"rounded-l-lg",staticStyle:{visibility:"visible",transform:"translateX(0)"},attrs:{absolute:"",width:e.calcSidebarWidth,permanent:"",clipped:"",stateless:"",color:"expandedSidebar"}},[e.platform==="darwin"?t("MacWindowControls",{staticClass:"pl-3 pt-1",staticStyle:{width:"calc(100% - 1px)","background-color":"var(--v-expandedSidebar-base)"},attrs:{hasMaximizeButton:e.hasMaximizeButton,hasCloseButton:e.hasCloseButton},on:{toggleFullscreen:function(i){return e.$emit("toggleFullscreen")},closeWindow:function(i){return e.$emit("closeWindow")}}}):e._e(),t("v-container",{class:{"pt-8":e.platform==="darwin"}},[e._t("sidebar")],2)],1):e._e(),t("v-card-text",{class:{"d-flex align-center justify-center":e.isLoading},staticStyle:{"overflow-y":"auto"},style:{height:e.heightUnset?void 0:`${e.isFullScreenOrMobile?e.maxWindowHeight:e.windowHeight}px`,"max-height":`${e.maxWindowHeight}px`,"padding-top":e.hideToolbar?"24px":"12px","padding-left":e.$slots.sidebar?`calc(${e.calcSidebarWidth} + 12px)`:void 0}},[e.isLoading?t("v-progress-circular",{attrs:{indeterminate:"",color:"accent",size:"42"}}):e._t("default")],2),e.$slots.actions?t("v-card-actions",{style:{"padding-left":e.$slots.sidebar?`calc(${e.sidebarWidth} + 12px)`:void 0},attrs:{"background-color":"footer"}},[e._t("actions")],2):e._e()],1)],1)},Eo=[],Do=_(Ao,$o,Eo,!1,null,null,null,null);const ce=Do.exports,Mo=X({__name:"Information",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState();function n(){e.window.close()}return{__sfc:!0,t,props:e,state:i,close:n,BaseWindow:ce}}});var Io=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,width:440,height:124,hasCloseButton:!1,isPersistent:e.window.isPersistent,isSmallPopup:!0},scopedSlots:e._u([{key:"default",fn:function(){return[t("p",{staticClass:"mt-2"},[e._v(e._s(i.t(e.window.description)))])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary"},on:{click:i.close}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(e._s(i.t("general.confirm")))])],1)]},proxy:!0}],null,!1,2422611214)}):e._e()},Oo=[],Ro=_(Mo,Io,Oo,!1,null,null,null,null);const Wo=Ro.exports;class ee extends ${constructor(t,i=!1,n=!1){super();c(this,"windowUUID",E());c(this,"component");c(this,"closeTimeout",null);c(this,"state",q({isVisible:!1,shouldRender:!1,isLoading:!0,actions:[]}));c(this,"sidebar");this.disposeOnClose=i,this.keepAlive=n,this.component=x(t)}getState(){return this.state}defineWindow(){u.windowState.addWindow(this.windowUUID,this)}addAction(t){this.state.actions.push(t)}close(t){var i;(i=this.sidebar)==null||i.setFilter(""),this.state.isVisible=!1,t!==null&&this.dispatch(t),this.keepAlive||(this.closeTimeout=window.setTimeout(()=>{this.state.shouldRender=!1,this.closeTimeout=null,this.disposeOnClose&&this.dispose()},600))}open(){this.state.shouldRender=!0,this.state.isVisible=!0,this.resetSignal(),this.closeTimeout!==null&&(window.clearTimeout(this.closeTimeout),this.closeTimeout=null)}dispose(){u.windowState.deleteWindow(this.windowUUID)}}class J extends ee{constructor(e){super(Wo,!0,!1),this.opts=e,this.defineWindow(),this.open()}get description(){return this.opts.description}get title(){var e,t;return(t=(e=this.opts.title)!=null?e:this.opts.name)!=null?t:"general.information"}get isPersistent(){var e;return(e=this.opts.isPersistent)!=null?e:!0}async close(){super.close(null),typeof this.opts.onClose=="function"&&await this.opts.onClose(),this.dispatch()}}const Qe=q({});class gi{constructor(e){c(this,"id");c(this,"_isVisible",!1);var t,i;this.config=e,this.id=(t=e.id)!=null?t:E(),U(Qe,this.id,this),((i=this.config.isVisible)==null||i)&&this.show()}get icon(){return this.config.icon}get message(){return this.config.message}get color(){return this.config.color}get textColor(){return this.config.textColor}get isVisible(){return this._isVisible}onClick(){typeof this.config.onClick=="function"&&this.config.onClick()}onMiddleClick(){var e,t;(t=(e=this.config).onMiddleClick)==null||t.call(e),this.config.disposeOnMiddleClick&&Se(Qe,this.id)}addClickHandler(e){this.config.onClick=e}show(){this._isVisible||this.updateAppBadge(),this._isVisible=!0}dispose(){Se(Qe,this.id),this.updateAppBadge()}updateAppBadge(){typeof navigator.setAppBadge=="function"&&navigator.setAppBadge(Object.values(Qe).filter(({isVisible:e})=>e).length)}}function wi(s){return new gi(s)}function Lo(){typeof navigator.clearAppBadge=="function"&&navigator.clearAppBadge();for(const[s]of Object.entries(Qe))Ve.delete(Qe,s)}function No(s){var i;let t=((i=s.stack)!=null?i:"at unknown").split(`
`).map(n=>n.trim());return t.splice(t[0].startsWith("Error")?1:0)}function Ne(s){var n;const e=(n=s.message)!=null?n:"";let t=e;e.includes(": ")&&(t=e.split(": ").shift()),t.length>24&&(t=e.length>24?`${e.substr(0,23)}...`:e);const i=wi({id:e,icon:"mdi-alert-circle-outline",message:`[${t}]`,color:"error",textColor:"white",disposeOnMiddleClick:!0,onClick:()=>{new J({name:`[ERROR: ${t}]`,description:`[${s.message} (${No(s)})]`}),i.dispose()}});return i}window.addEventListener("error",s=>{var e,t;Ne((e=s.error)!=null?e:s),(t=u==null?void 0:u.ready)==null||t.once(i=>i.windows.loadingWindow.closeAll())});window.onunhandledrejection=s=>{var e;Ne(new Error(s.reason)),(e=u==null?void 0:u.ready)==null||e.once(t=>t.windows.loadingWindow.closeAll())};const Ee=location.origin==="https://nightly.bridge-core.app",Bo={setup(){return{logoPath:Ee?"/img/icons/nightly/favicon.svg":"/img/icons/favicon.svg"}}};var Vo=function(){var e=this,t=e._self._c;return t("img",{attrs:{draggable:"false",src:e.logoPath,alt:"Logo of bridge. v2"}})},Ho=[],Uo=_(Bo,Vo,Ho,!1,null,null,null,null);const an=Uo.exports,Jn=Yi("app-notifications","app-notification-store");class Gt extends gi{constructor(e){if(super(e),!e.id)throw new Error("PersistentNotification requires an id")}async show(){await he(this.id,Jn)||super.show()}dispose(){super.dispose(),ye(this.id,!0,Jn)}}const zo=X({__name:"ConfirmWindow",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState();function n(){e.window.onCancel()}function a(){e.window.onConfirm()}return{__sfc:!0,t,props:e,state:i,onCancel:n,onConfirm:a,BaseWindow:ce}}});var Jo=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,isPersistent:!0,hasMaximizeButton:!1,isFullscreen:!1,width:440,height:e.window.height,hasCloseButton:!1,isSmallPopup:!0},scopedSlots:e._u([{key:"default",fn:function(){return[t("p",{staticClass:"mt-2"},[e._v(e._s(i.t(e.window.description)))])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"sidebarSelection"},on:{click:i.onCancel}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-close")]),t("span",[e._v(e._s(i.t(e.window.cancelText)))])],1),t("v-btn",{attrs:{color:"primary"},on:{click:i.onConfirm}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-check")]),t("span",[e._v(e._s(i.t(e.window.confirmText)))])],1)]},proxy:!0}],null,!1,2853835962)}):e._e()},qo=[],Go=_(zo,Jo,qo,!1,null,null,null,null);const Ko=Go.exports;class N extends ee{constructor(e){super(Ko,!0,!1),this.opts=e,this.defineWindow(),this.open()}get confirmText(){var e;return(e=this.opts.confirmText)!=null?e:"general.okay"}get cancelText(){var e;return(e=this.opts.cancelText)!=null?e:"general.cancel"}get description(){return this.opts.description}get title(){var e;return(e=this.opts.title)!=null?e:"general.confirm"}get height(){var e;return(e=this.opts.height)!=null?e:130}onConfirm(){typeof this.opts.onConfirm=="function"&&this.opts.onConfirm(),this.close(!0)}onCancel(){typeof this.opts.onCancel=="function"&&this.opts.onCancel(),this.close(!1)}}const Yo={async mounted(){const{id:s,icon:e,title:t,description:i=t,textColor:n="white",color:a,link:r}=navigator.onLine?await fetch("https://raw.githubusercontent.com/bridge-core/editor-packages/main/remote/welcomeAlert.json").catch(()=>null).then(o=>o?o.json():{}):{};if(this.icon=e,this.title=t,this.color=a,this.textColor=n,this.link=r,t){const o=new Gt({id:s,icon:e,message:`[${t}]`,color:a,textColor:n,onClick:()=>{const l={title:`[${t}]`,description:`[${i}]`};r?new N({...l,confirmText:"general.readMore",onConfirm:()=>{this.onClick()}}):new J(l),o.dispose()}})}},data:()=>({icon:null,title:null,color:null,textColor:null,link:null}),methods:{onClick(){u.openUrl(this.link,null,!0)}}};var Qo=function(){var e=this,t=e._self._c;return e.title?t("v-alert",{staticClass:"mt-2 mb-8 pa-3",style:`color: ${e.textColor}; width: calc(100% - 8px); position: absolute; top: 0; left: 0;`,attrs:{value:!!e.title,color:"purple",border:"bottom",rounded:"lg"}},[t("div",{staticClass:"d-flex align-center"},[e.icon?t("v-icon",{staticClass:"pr-2",attrs:{color:e.textColor,large:""}},[e._v(" "+e._s(e.icon)+" ")]):e._e(),t("span",[e._v(e._s(e.title))]),t("v-spacer"),e.link?t("v-btn",{style:`color: ${e.textColor}`,attrs:{text:"",dense:""},on:{click:e.onClick}},[e._v(" Read more "),t("v-icon",{staticClass:"pl-2",attrs:{color:e.textColor}},[e._v(" mdi-chevron-right ")])],1):e._e()],1)]):e._e()},Zo=[],Xo=_(Yo,Qo,Zo,!1,null,null,null,null);const ec=Xo.exports,Ni=new Set,tc=({disposables:s})=>({registerAction(e){const t=new D(e);Ni.add(t);const i={dispose:()=>{Ni.delete(t)}};return s.push(i),i}}),ve=gt.dirname,Be=gt.join,me=gt.extname,fe=gt.basename,ic=gt.resolve,As=gt.relative,nc=Object.freeze(Object.defineProperty({__proto__:null,dirname:ve,join:Be,extname:me,basename:fe,resolve:ic,relative:As},Symbol.toStringTag,{value:"Module"})),sc={"mdi-file-image-outline":[".jpg",".jpeg",".png",".gif",".bmp",".webp",".tga"],"mdi-code-json":[".json"],"mdi-volume-high":[".mp3",".wav",".fsb",".ogg"],"mdi-language-html5":[".html"],"mdi-language-typescript":[".ts",".tsx"],"mdi-language-javascript":[".js",".jsx"],"mdi-web":[".lang"]};function ei(s){const e=me(s);for(const[t,i]of Object.entries(sc))if(i.includes(e))return t;return"mdi-file-outline"}async function we(s,e,t=new Set,i=""){for await(const n of s.values()){const a=i.length===0?n.name:`${i}/${n.name}`;if(n.kind==="file"){if(n.name[0]===".")continue;await e(n,a,s)}else n.kind==="directory"&&!t.has(a)&&await we(n,e,t,a)}}async function At(s,e,t=new Set,i=""){const n=[];for await(const a of s.values()){const r=i.length===0?a.name:`${i}/${a.name}`;if(a.kind==="file"){if(a.name[0]===".")continue;n.push(e(a,r,s))}else a.kind==="directory"&&!t.has(r)&&n.push(At(a,e,t,r))}await Promise.all(n)}async function ac(){return typeof(await(await navigator.storage.getDirectory()).getFileHandle("bridge-supports-writable-test",{create:!0})).createWritable=="function"}async function Bi(){var s;return typeof((s=navigator.storage)==null?void 0:s.getDirectory)!="function"||!await ac()?new ne(null,"bridgeFolder",void 0):await navigator.storage.getDirectory()}class Z extends ${constructor(t){super();c(this,"_baseDirectory");t&&this.setup(t)}get baseDirectory(){return this._baseDirectory}setup(t){this._baseDirectory=t,this.hasFired||this.dispatch()}async getDirectoryHandle(t,{create:i,createOnce:n}={}){if(t===""||t===".")return this.baseDirectory;let a=this.baseDirectory;const r=t.split(/\\|\//g);r[0]==="."&&r.shift(),r[0]==="extensions"&&(r[0]="~local",r.splice(1,0,"extensions")),r[0]==="~local"&&(a=await Bi(),r.shift());for(const o of r){try{a=await a.getDirectoryHandle(o,{create:n||i})}catch{throw new Error(`Failed to access "${t}": Directory does not exist`)}n&&(n=!1,i=!1)}return a}async getFileHandle(t,i=!1){if(t.length===0)throw new Error("Error: filePath is empty");const n=await this.getDirectoryHandle(ve(t),{create:i});try{return await n.getFileHandle(fe(t),{create:i})}catch{throw new Error(`File does not exist: "${t}"`)}}async pathTo(t){const i=await Bi();if(t instanceof ae&&!(i instanceof ne))return;let n=await i.resolve(t).then(a=>a==null?void 0:a.join("/"));return n?n="~local/"+n:n=await this.baseDirectory.resolve(t).then(a=>a==null?void 0:a.join("/")),n}async mkdir(t,{recursive:i}={}){await this.getDirectoryHandle(t,{create:!0})}async readdir(t,{withFileTypes:i}={}){const n=await this.getDirectoryHandle(t),a=[];for await(const r of n.values())r.kind==="file"&&r.name===".DS_Store"||(i?a.push(r):a.push(r.name));return a}async readFilesFromDir(t,i=this.getDirectoryHandle(t)){i=await i;const n=[],a=[];for await(const r of i.values())r.kind==="file"&&r.name===".DS_Store"||(r.kind==="file"?n.push({name:r.name,kind:r.kind,path:`${t}/${r.name}`}):r.kind==="directory"&&a.push(this.readFilesFromDir(`${t}/${r.name}`,r).then(o=>n.push(...o))));return await Promise.allSettled(a),n}readFile(t){return this.getFileHandle(t).then(i=>i.getFile())}async unlink(t){if(t.length===0)throw new Error("Error: filePath is empty");const i=t.split(/\\|\//g),n=i.pop();let a;try{a=await this.getDirectoryHandle(i.join("/"))}catch{return}try{await a.removeEntry(n,{recursive:!0})}catch{}}async writeFile(t,i){const n=await this.getFileHandle(t,!0);return await this.write(n,i),n}async write(t,i){const n=await t.createWritable({keepExistingData:!1});await n.write(i),await n.close()}async readJSON(t){const i=await this.readFile(t);try{return await L.parse(await i.text())}catch{throw new Error(`Invalid JSON: ${t}`)}}async readJsonHandle(t){const i=await t.getFile();try{return await L.parse(await i.text())}catch{throw new Error(`Invalid JSON: ${t.name}`)}}writeJSON(t,i,n=!1){return this.writeFile(t,JSON.stringify(i,null,n?"	":void 0))}async move(t,i){if(await this.fileExists(t))await this.copyFile(t,i);else if(await this.directoryExists(t))await this.copyFolder(t,i);else throw new Error(`File or folder does not exist: ${t}`);await this.unlink(t)}async copyFile(t,i){const n=await this.getFileHandle(t,!1),a=await this.getFileHandle(i,!0);return await this.copyFileHandle(n,a)}async copyFileHandle(t,i){return await this.write(i,await t.getFile()),i}async copyFolder(t,i){const n=await this.getDirectoryHandle(t,{create:!1});await At(n,async(a,r)=>{await this.copyFileHandle(a,await this.getFileHandle(Be(i,r),!0))})}async copyFolderByHandle(t,i){const n=new Z(i);await At(t,async(a,r)=>{await this.copyFileHandle(a,await n.getFileHandle(r,!0))})}loadFileHandleAsDataUrl(t){return new Promise(async(i,n)=>{const a=new FileReader;try{const r=await t.getFile();a.addEventListener("load",()=>{i(a.result)}),a.addEventListener("error",n),a.readAsDataURL(r)}catch{n(`File does not exist: "${t.name}"`)}})}async fileExists(t){try{return await this.getFileHandle(t),!0}catch{return!1}}async directoryExists(t){try{return await this.getDirectoryHandle(t),!0}catch{return!1}}async getDirectoryHandlesFromGlob(t,i="."){const n=t.split(/\/|\\/g),a=new Set([await this.getDirectoryHandle(i)]);for(const r of n){if(r==="*")for(const o of[...a.values()]){a.delete(o);for await(const l of o.values())l.kind==="directory"&&a.add(l)}else{if(r==="**")return console.warn('"**" is not supported yet'),[];for(const o of[...a.values()]){a.delete(o);try{a.add(await o.getDirectoryHandle(r))}catch{}}}if(a.size===0)return[]}return[...a.values()]}}const Ze="comMojangDirectory";class rc extends ${constructor(t){super();c(this,"fileSystem",new Z);c(this,"setup",new $);c(this,"_hasComMojang",!1);c(this,"_permissionDenied",!1);c(this,"_hasComMojangHandle",!1);this.app=t}get hasComMojang(){return this._hasComMojang}get hasComMojangHandle(){return this._hasComMojangHandle}get status(){return{hasComMojang:this._hasComMojang,didDenyPermission:this._permissionDenied}}async setupComMojang(){if(this._hasComMojang)return!1;const t=await he(Ze);return this._hasComMojangHandle=t!==void 0,t&&(await this.requestPermissions(t).catch(async()=>{await this.createPermissionWindow(t)}),this._hasComMojang)?(this.setup.dispatch(),this.dispatch(),!0):(this.dispatch(),!1)}async createPermissionWindow(t){const i=new J({name:"comMojang.title",description:"comMojang.permissionRequest"});i.open(),await i.fired,await this.requestPermissions(t)}async requestPermissions(t){await t.requestPermission({mode:"readwrite"})!=="granted"?(this._hasComMojang=!1,this._permissionDenied=!0,this.app.projectManager.recompileAll()):(this.fileSystem.setup(t),this._hasComMojang=!0)}async set(t){ye(Ze,t),await this.requestPermissions(t),this._hasComMojang&&this.setup.dispatch(),this._hasComMojangHandle=!0,this.dispatch()}async handleComMojangDrop(t){await this.set(t),this._hasComMojang&&await this.app.projectManager.recompileAll()}async unlink(){await this.app.projectManager.recompileAll(),await Je(Ze)}}const oc=[{icon:"mdi-delete",name:"[Dev: Reset local fs]",description:"[Reset the local fs (navigator.storage.getDirectory()) to be completely emtpy]",onTrigger:async()=>{const s=await u.getApp(),e=new N({description:"[Are you sure you want to reset the local fs?]"});e.open(),await e.fired&&await Promise.all([s.fileSystem.unlink("~local/data"),s.fileSystem.unlink("~local/projects"),s.fileSystem.unlink("~local/extensions")])}},{icon:"mdi-delete",name:"[Dev: Reset 'com.mojang' folder]",description:"[Remove the 'com.mojang' folder from local storage]",onTrigger:async()=>{Je(Ze)}},{icon:"mdi-cancel",name:"[Dev: Clear app data]",description:"[Clear data from bridge-core/editor-packages repository]",onTrigger:async()=>{await Je("savedDataForVersion")}},{icon:"mdi-refresh",name:"[Dev: Reset initial setup]",description:"[Resets editor type and com.mojang selection]",onTrigger:async()=>{await Je("didChooseEditorType"),await Je(Ze)}},{icon:"mdi-open-in-new",name:"[Dev: Open local fs]",description:"[Open the local fs within the editor]",onTrigger:async()=>{(await u.getApp()).viewFolders.addDirectoryHandle({directoryHandle:await navigator.storage.getDirectory(),startPath:"~local"})}},{icon:"mdi-database-outline",name:"[Dev: Open data directory]",description:"[Open the data directory within the editor]",onTrigger:async()=>{const s=await u.getApp();s.viewFolders.addDirectoryHandle({directoryHandle:s.dataLoader.baseDirectory})}},{icon:"mdi-minecraft",name:"[Dev: Open com.mojang]",description:"[Open the com.mojang folder within the editor]",onTrigger:async()=>{const s=await u.getApp();!s.comMojang.setup.hasFired||s.viewFolders.addDirectoryHandle({directoryHandle:s.comMojang.fileSystem.baseDirectory})}}];oc.map(s=>new D(s));const rn=q({isWindowOpen:!1,shouldRender:!1,closeDelay:null}),Vi=new Set;function cc(s){return Vi.add(s),{dispose:()=>{Vi.delete(s)}}}function lc(){return Array.from(Vi)}const dc={props:{autofocus:{type:Boolean,default:!1}},setup(){const{t:s}=O();return{t:s}},async mounted(){this.updateActions(),this.disposables.push(u.eventSystem.on("projectChanged",async()=>this.updateActions()))},destroyed(){this.disposables.forEach(s=>s.dispose()),this.disposables=[]},data:()=>({currentItem:"",actions:[],disposables:[]}),methods:{async updateActions(){const s=await u.getApp(),e=s.actionManager.getAllActions(),t=[...Ni.values()];this.actions=[...e,...s.isNoProjectSelected?[]:await this.loadFilesFromProject(s.project),...t,...lc()]},onSelectedAction(s){this.$nextTick(()=>this.currentItem=""),s.trigger(),this.$emit("actionSelected")},async loadFilesFromProject(s){var t,i;return!s||s.isVirtualProject?void 0:(await s.packIndexer.fired,((i=await((t=s.packIndexer)==null?void 0:t.service.getAllFiles()))!=null?i:[]).map(n=>{var o,l;const a=u.packType.get(n),r=u.fileType.get(n);return new D({name:`[${s.relativePath(n)}]`,description:"actions.openFile.name",icon:(o=r==null?void 0:r.icon)!=null?o:ei(n),color:(l=a==null?void 0:a.color)!=null?l:"primary",onTrigger:async()=>{const d=await s.app.fileSystem.getFileHandle(n);s.openFile(d)}})}))}}};var uc=function(){var e=this,t=e._self._c;return t("v-autocomplete",{staticClass:"commandbar-input elevation-1",attrs:{"prepend-inner-icon":"mdi-magnify",solo:"",rounded:"","hide-details":"","background-color":"expandedSidebar","append-icon":null,"menu-props":{rounded:"lg",dense:!0,"nudge-top":-12,"min-width":"unset","max-width":"500px",transition:"slide-y-transition",contentClass:"commandbar-menu"},items:e.actions,"item-text":i=>`${e.t(i.name)}
${e.t(i.description)}`,"item-value":i=>i,placeholder:e.t("general.search"),"auto-select-first":"",autofocus:e.autofocus},on:{change:e.onSelectedAction,focus:e.updateActions,blur:function(i){return e.$emit("blur")}},scopedSlots:e._u([{key:"no-data",fn:function(){return[t("v-list-item",[t("v-list-item-title",[e._v(" Search for files, actions or projects. ")])],1)]},proxy:!0},{key:"item",fn:function({item:i}){return[t("v-list-item-avatar",{staticClass:"text-h5 font-weight-light white--text",attrs:{color:i.color||"warning"}},[t("v-icon",{attrs:{color:"white"}},[e._v(e._s(i.icon))])],1),t("v-list-item-content",[t("v-list-item-title",{domProps:{textContent:e._s(e.t(i.name))}}),t("v-list-item-subtitle",{domProps:{textContent:e._s(e.t(i.description))}})],1)]}}]),model:{value:e.currentItem,callback:function(i){e.currentItem=i},expression:"currentItem"}})},pc=[],hc=_(dc,uc,pc,!1,null,null,null,null);const $s=hc.exports;const mc={name:"welcome-screen",components:{Logo:an,WelcomeAlert:ec,CommandBar:$s},props:{containerPadding:String}};var fc=function(){var e=this,t=e._self._c;return t("div",{class:`d-flex flex-column justify-center align-center ${e.containerPadding}`,style:"position: relative; height: 80vh;"},[t("WelcomeAlert"),t("div",{staticClass:"d-flex flex-column justify-center align-center",staticStyle:{width:"50vw","max-width":"500px"}},[t("Logo",{staticClass:"mt-4 mb-8",staticStyle:{height:"160px",width:"160px"},attrs:{alt:"Logo of bridge. v2"}}),t("CommandBar")],1)],1)},gc=[],wc=_(mc,fc,gc,!1,null,"5e689ba1",null,null);const Es=wc.exports;function yc(s,e=!1){const t=s.toLowerCase().split(" + "),i={key:""};return t.forEach(n=>{n==="\u2318"||(H()!=="darwin"||e)&&n==="ctrl"?i.ctrlKey=!0:n==="\u2325"||n==="alt"?i.altKey=!0:n==="\u21E7"||n==="shift"?i.shiftKey=!0:n==="\u2303"||n==="meta"?i.metaKey=!0:i.key=n}),i}function Ds({key:s,ctrlKey:e,altKey:t,shiftKey:i,metaKey:n}){const a=H();let r=s.toUpperCase();return i&&(a==="darwin"?r="\u21E7 + "+r:r="Shift + "+r),t&&(a==="darwin"?r="\u2325 + "+r:r="Alt + "+r),n&&(a==="darwin"?r="\u2303 + "+r:r="Meta + "+r),e&&(a==="darwin"?r="\u2318 + "+r:r="Ctrl + "+r),r}class Ms extends z{constructor(e,t){super(),this.keyBindingManager=e,this.config=t}static fromStrKeyCode(e,t,i=!1,n){return e.create({...yc(t,i),prevent:n})}toStrKeyCode(){return Ds(this.config)}async trigger(){this.dispatch()}prevent(e){return typeof this.config.prevent=="function"?this.config.prevent(e):!1}dispose(){this.keyBindingManager.disposeKeyBinding(this.toStrKeyCode())}}class Is extends D{constructor(t,i){var n;super(i);c(this,"type","action");c(this,"id");c(this,"_keyBinding");this.actionManager=t,this.config=i,this.id=(n=i.id)!=null?n:E(),i.keyBinding&&(Array.isArray(i.keyBinding)?i.keyBinding:[i.keyBinding]).forEach(r=>this.addKeyBinding(Ms.fromStrKeyCode(t.keyBindingManager,r,!0,i.prevent)))}get keyBinding(){return this._keyBinding}addKeyBinding(t){return this._keyBinding=t,t.on(()=>this.trigger()),this}disposeKeyBinding(){this._keyBinding&&this._keyBinding.dispose()}dispose(){this.actionManager.disposeAction(this.id),this.disposeKeyBinding()}}class Rt{constructor(e){c(this,"type","submenu");c(this,"state",wt({}));this._keyBindingManager=e}get keyBindingManager(){if(!this._keyBindingManager)throw new Error("No keyBindingManager was defined for this actionManager");return this._keyBindingManager}create(e){const t=new Is(this,e);return U(this.state,t.id,t),t}getAction(e){return this.state[e]}getAllActions(){return Object.values(this.state).filter(e=>e.type==="action")}getAllElements(){return Object.values(this.state)}addDivider(){this.state[E()]={type:"divider"}}addSubMenu(e){const t=new vc;e.actions.forEach(i=>{i!==null&&(i.type==="divider"?t.addDivider():t.create(i))}),this.state[E()]={type:"submenu",icon:e.icon,name:e.name,submenu:t}}disposeAction(e){Se(this.state,e)}dispose(){Object.values(this.state).forEach(e=>e.type==="action"?e.dispose():null)}async trigger(e){if(!this.state[e]||this.state[e].type!=="action")throw new Error(`Failed to trigger "${e}": Action does not exist.`);await this.state[e].trigger()}}class vc extends Rt{constructor(){super(...arguments);c(this,"type","submenu")}}async function De(s,e,t=!0){let i=e.filter(r=>r!==null);if(s instanceof MouseEvent&&(s.preventDefault(),s.stopImmediatePropagation()),i.length===0)return;const n=await u.getApp(),a=new Rt;i.forEach(r=>{switch(r.type){case"submenu":a.addSubMenu(r);break;case"divider":a.addDivider();break;default:a.create(r);break}}),setTimeout(()=>n.contextMenu.show(s,a,t),60)}const bc=new TextEncoder,_c={type:"compressed",name:"openRawFile",onTrigger:async s=>{const e=s.indexOf(`
`),[t,i]=[s.slice(0,e),s.slice(e+1)],n=new ae(null,t,bc.encode(i),!0),a=await u.getApp();await a.projectManager.projectReady.fired,await a.fileDropper.importFile(n)}};async function Os(s){const e=await s.getFile().then(t=>t.text());if(typeof navigator.share=="function"){const t=new URL(window.location.href);u.sidebar.isContentVisible.value||t.searchParams.set("setSidebarState","hidden"),t.searchParams.set("openRawFile",btoa(Qi(bs(_s(`${s.name}
${e}`),{level:9}),!0))),await navigator.share({title:`View File: ${s.name}`,text:`Edit the file "${s.name}" file with bridge.!`,url:t.href}).catch(()=>{})}}const ct=F(!1);let ti=null;function Sc(s){ti=s}function qn(){return ti}function Cc(){return{isInFullScreen:ct}}const Rs=(s=!0)=>({icon:"mdi-fullscreen",name:"actions.fullscreen.name",description:s?"actions.fullscreen.description":void 0,onTrigger:()=>{if(!!ti)if(document.fullscreenElement)document.exitFullscreen();else{ti.requestFullscreen(),ct.value=!0;const e=()=>{ct.value=document.fullscreenElement!=null,ct.value||document.removeEventListener("fullscreenchange",e)};document.addEventListener("fullscreenchange",e)}}});var ys;class yt extends ${constructor(t){super();c(this,"uuid",E());c(this,"hasRemoteChange",!1);c(this,"_isUnsaved",!1);c(this,"isForeignFile",!0);c(this,"connectedTabs",[]);c(this,"isTemporary",!((ys=b==null?void 0:b.editor)!=null&&ys.keepTabsOpen));c(this,"onClose",new z);c(this,"path");c(this,"folderName",null);c(this,"actions",[]);c(this,"isActive",!1);c(this,"isLoading",!0);this.parent=t,window.setTimeout(()=>this.setup())}static is(t){return!1}async setup(){this.dispatch(this),this.isLoading=!1}get project(){return this.parent.project}setIsLoading(t){this.isLoading=t}setIsUnsaved(t){this._isUnsaved=t,this.isTemporary=!1}get isUnsaved(){return this._isUnsaved}updateParent(t){this.parent=t}get tabSystem(){return this.parent}get isSharingScreen(){return this.parent.isSharingScreen.value}setFolderName(t){this.folderName=t}getPath(){if(!this.path)throw new Error("Trying to access projectPath before tab finished loading");return this.path}getProjectPath(){if(console.warn("CommonTab.getProjectPath() is deprecated in favor of CommonTab.getPath()"),!this.path)throw new Error("Trying to access projectPath before tab finished loading");return this.path.split("/").slice(2).join("/")}get icon(){var t,i;return(i=(t=u.fileType.get(this.getPath()))==null?void 0:t.icon)!=null?i:ei(this.getPath())}get iconColor(){var t;return this.hasFired?(t=u.packType.get(this.getPath(),!0))==null?void 0:t.color:"accent"}get isSelected(){return this.parent.selectedTab===this}async select(){return await this.parent.select(this),this}async close(){this.parent.setActive(!0);const t=await this.parent.close(this);return t&&(this.connectedTabs.forEach(i=>i.close()),this.onClose.dispatch()),t}async is(t){return!1}focus(){}async onActivate(){this.isActive=!0}onDeactivate(){this.isActive=!1}onDestroy(){}async toOtherTabSystem(t=!0){var l;const n=(l=(await u.getApp()).projectManager.currentProject)==null?void 0:l.tabSystems,a=this.isSelected,r=n[0]===this.parent?n[0]:n[1],o=n[0]===this.parent?n[1]:n[0];this.parent=o,t?(r.remove(this,!1),await o.add(this,!0)):(this.isForeignFile||(await o.openedFiles.add(this.getPath()),await r.openedFiles.remove(this.getPath())),a&&await r.select(r.tabs.value[0]),await o.select(this))}addAction(...t){this.actions.push(...t)}clearActions(){this.actions=[]}async onContextMenu(t){const i=[];this.fileHandle&&i.push({icon:"mdi-share",name:"general.shareFile",onTrigger:async()=>{await Os(this.fileHandle)}}),this.isTemporary&&i.push({name:"actions.keepInTabSystem.name",icon:"mdi-pin-outline",onTrigger:()=>{this.isTemporary=!1}}),this.parent.tabs.value.length>1&&i.push({name:"actions.moveToSplitScreen.name",icon:"mdi-arrow-split-vertical",onTrigger:async()=>{this.toOtherTabSystem()}}),i.length>0&&i.push({type:"divider"}),await De(t,[Rs(!1),...i,{name:"actions.closeTab.name",icon:"mdi-close",onTrigger:()=>{this.close()}},{name:"actions.closeAll.name",icon:"mdi-table-row",onTrigger:()=>{this.parent.closeTabs(()=>!0)}},{name:"actions.closeTabsToRight.name",icon:"mdi-chevron-right",onTrigger:()=>{let n=!0;this.parent.closeTabs(a=>(a===this&&(n=!1),n))}},{name:"actions.closeAllSaved.name",icon:"mdi-content-save-outline",onTrigger:()=>{this.parent.closeTabs(n=>!n.isUnsaved)}},{name:"actions.closeOtherTabs.name",icon:"mdi-unfold-more-vertical",onTrigger:()=>{this.parent.closeTabs(n=>n!==this)}}])}copy(){document.execCommand("copy")}cut(){document.execCommand("cut")}paste(){}}async function yi(s,e,t){const i=wi({icon:"mdi-download",color:"success",textColor:"white",message:"general.successfulExport.title",isVisible:!0,onClick:async()=>{(await u.getApp()).project.isLocal||js||A.value?pt(fe(s),e):new J({description:`[${R("general.successfulExport.description")}: "${s}"]`}),i.dispose()}});await t.writeFile(s,e)}const xc=new Set([".mcpack",".mcaddon",".mcworld",".mctemplate",".brproject",".mcfunction",".lang",".material"]);function pt(s,e){const t=me(s);let i;xc.has(t)&&(i="application/file-export");const n=URL.createObjectURL(new Blob([e],{type:i})),a=document.createElement("a");a.download=s,a.href=n,a.click(),URL.revokeObjectURL(n)}const kc=new TextEncoder;async function Pc(s){let e;return typeof s=="string"?e=kc.encode(s):s instanceof Blob?e=await s.arrayBuffer().then(t=>new Uint8Array(t)):ArrayBuffer.isView(s)?e=new Uint8Array(s.buffer):e=new Uint8Array(s),e}const jc=async()=>{var e,t;const s=await u.getApp();return(t=(e=b==null?void 0:b.editor)==null?void 0:e.autoSaveChanges)!=null?t:s.mobile.isCurrentDevice()},Fc=He(async s=>{s.tryAutoSave()},3e3);class W extends yt{constructor(t,i,n="off"){super(t);c(this,"isForeignFile",!1);c(this,"isSaving",!1);this.parent=t,this.fileHandle=i,this.readOnlyMode=n}get isReadOnly(){return this.readOnlyMode!=="off"}async setup(){var t;if(this.isForeignFile=!1,this.fileHandle instanceof ae&&this.fileHandle.getParent()===null?this.path=void 0:this.path=await this.parent.app.fileSystem.pathTo(this.fileHandle),!this.path||!this.parent.project.isFileWithinProject(this.path)){await u.fileType.ready.fired,this.isForeignFile=!0;let i=(t=await u.fileType.guessFolder(this.fileHandle))!=null?t:E();i.endsWith("/")||(i+="/"),this.path=`${i}${E()}/${this.fileHandle.name}`}this.parent.project.packIndexer.once(async()=>{const i=this.parent.project.packIndexer;await i.hasFile(this.path)||(await i.updateFile(this.path,await this.getFile().then(n=>n.text()),this.isForeignFile),u.fileType.isJsonFile(this.getPath())&&this.parent.project.jsonDefaults.updateDynamicSchemas(this.getPath()))}),await super.setup()}async onDeactivate(){await this.tryAutoSave(),super.onDeactivate()}get name(){return this.fileHandle.name}getFileType(){return u.fileType.getId(this.getPath())}async is(t){return t instanceof W?await this.isForFileHandle(t.fileHandle):!1}async isForFileHandle(t){return t.isVirtual!==this.fileHandle.isVirtual?!1:await t.isSameEntry(this.fileHandle)}getFile(){return this.fileHandle.getFile()}getFileHandle(){return this.fileHandle}fileDidChange(){Fc(this)}async tryAutoSave(){this.fileHandleWithoutParentContext()||await jc()&&this.isUnsaved&&await this.save()}async save(){this.isSaving||(this.isSaving=!0,await this._save(),this.isSaving=!1)}async saveAs(){if(Ps){const i=await this.fileHandle.getFile();pt(this.fileHandle.name,new Uint8Array(await i.arrayBuffer()));return}const t=await self.showSaveFilePicker({suggestedName:this.fileHandle.name,startIn:this.fileHandle}).catch(()=>null);!t||(this.isForeignFile||this.parent.openedFiles.remove(this.getPath()),this.fileHandle=t,this.resetSignal(),await this.setup(),await this.parent.save(this),this.isForeignFile||this.parent.openedFiles.add(this.getPath()))}fileHandleWithoutParentContext(){return this.fileHandle instanceof ae&&!this.fileHandle.hasParentContext}async writeFile(t){if(this.fileHandleWithoutParentContext()){if(A.value)pt(this.fileHandle.name,await Pc(t));else{let i;try{i=await window.showSaveFilePicker({suggestedName:this.fileHandle.name,startIn:this.parent.app.fileSystem.baseDirectory})}catch{}if(!i)return!1;this.fileHandle=i,this.resetSignal(),await this.setup()}return!0}return await this.parent.app.fileSystem.write(this.fileHandle,t).then(()=>!0).catch(()=>!1)}}const Tc={name:"TextTab",props:{tab:Object},computed:{tabSystem(){return this.tab.parent}},activated(){this.updateEditor()},mounted(){this.updateEditor()},methods:{updateEditor(){this.tabSystem.createMonacoEditor(this.$refs.monacoContainer)}}};var Ac=function(){var e=this,t=e._self._c;return t("div",{ref:"monacoContainer",on:{click:function(i){return e.tab.parent.setActive(!0)},contextmenu:function(i){return e.tab.showContextMenu(i)}}})},$c=[],Ec=_(Tc,Ac,$c,!1,null,null,null,null);const Dc=Ec.exports,$t=new $;async function I(){return await $t.fired,await ue(()=>import("./editor.main.fba69f8b.js").then(s=>s.e),["assets/editor.main.fba69f8b.js","assets/editor.2dcbbb62.css"])}function ii(s){return new Promise(e=>setTimeout(()=>e(),s))}const Mc=He(async s=>{var i;if(!s.editorModel||s.editorModel.isDisposed())return;const e=(i=s.editorModel)==null?void 0:i.getValue(),t=await u.getApp();t.project.fileChange.dispatch(s.getPath(),await s.getFile()),await t.project.packIndexer.updateFile(s.getPath(),e,s.isForeignFile,!0),await t.project.jsonDefaults.updateDynamicSchemas(s.getPath())},600);class ht extends W{constructor(t,i,n){super(t,i,n);c(this,"component",Dc);c(this,"editorModel");c(this,"editorViewState");c(this,"disposables",[]);c(this,"isActive",!1);c(this,"modelLoaded",new $);c(this,"initialVersionId",0);this.fired.then(async()=>{const a=await u.getApp();await a.projectManager.projectReady.fired,a.project.tabActionProvider.addTabActions(this)})}get editorInstance(){return this.parent.monacoEditor}async getFile(){return!this.editorModel||this.editorModel.isDisposed()?await super.getFile():new File([this.editorModel.getValue()],this.name)}updateUnsavedStatus(){var t;!this.editorModel||this.editorModel.isDisposed()||this.setIsUnsaved(this.initialVersionId!==((t=this.editorModel)==null?void 0:t.getAlternativeVersionId()))}fileDidChange(){this.updateUnsavedStatus(),super.fileDidChange()}async onActivate(){var n,a,r,o,l,d;if(this.isActive)return;this.isActive=!0,$t.hasFired||(this.isLoading=!0,$t.dispatch(),await this.parent.app.themeManager.applyMonacoTheme());const{editor:t,Uri:i}=await I();if(await this.parent.fired,await ii(1),this.isLoading=!1,!this.editorModel||this.editorModel.isDisposed()){const h=await(await this.fileHandle.getFile()).text(),m=i.file(this.getPath());this.editorModel=x((r=t.getModel(m))!=null?r:t.createModel(h,(a=(n=u.fileType.get(this.getPath()))==null?void 0:n.meta)==null?void 0:a.language,m)),this.initialVersionId=this.editorModel.getAlternativeVersionId(),this.modelLoaded.dispatch(),await this.loadEditor(!1)}else await this.loadEditor();this.disposables.push((o=this.editorModel)==null?void 0:o.onDidChangeContent(()=>{Mc(this),this.fileDidChange()})),this.disposables.push((l=this.editorInstance)==null?void 0:l.onDidFocusEditorText(()=>{this.parent.setActive(!0)})),(d=this.editorInstance)==null||d.layout()}async onDeactivate(){if(await super.onDeactivate(),this.tabSystem.hasFired){const t=this.editorInstance.saveViewState();t&&(this.editorViewState=x(t))}this.disposables.forEach(t=>t==null?void 0:t.dispose()),this.isActive=!1}onDestroy(){var t;this.disposables.forEach(i=>i==null?void 0:i.dispose()),(t=this.editorModel)==null||t.dispose(),this.editorModel=void 0,this.editorViewState=void 0,this.isActive=!1,this.modelLoaded.resetSignal()}updateParent(t){super.updateParent(t)}focus(){var t;(t=this.editorInstance)==null||t.focus()}async loadEditor(t=!0){var i;await this.parent.fired,this.editorModel&&!this.editorModel.isDisposed()&&this.editorInstance.setModel(this.editorModel),this.editorViewState&&this.editorInstance.restoreViewState(this.editorViewState),(i=this.editorInstance)==null||i.updateOptions({readOnly:this.isReadOnly}),t&&setTimeout(()=>this.focus(),10)}async _save(){var a,r,o,l,d;this.isTemporary=!1,await u.getApp();const t=(a=this.editorInstance)==null?void 0:a.getAction("editor.action.formatDocument"),i=u.fileType.get(this.getPath()),n=(r=this.editorModel)==null?void 0:r.getValue();if(n&&n!==""&&t&&i&&((l=(o=b==null?void 0:b.general)==null?void 0:o.formatOnSave)!=null?l:!0)&&((d=i==null?void 0:i.formatOnSaveCapable)!=null?d:!0)){this.makeFakeEdit("	");const p=new Promise(f=>{var w;if(!this.editorModel||this.editorModel.isDisposed())return f();const g=(w=this.editorModel)==null?void 0:w.onDidChangeContent(()=>{g==null||g.dispose(),f()})}),h=t.run();let m=!1;await Promise.race([Promise.all([p,h]),ii(1500).then(()=>{m||this.makeFakeEdit(null)})]),m=!0}await this.saveFile()}makeFakeEdit(t){var i;t?(this.editorInstance.pushUndoStop(),(i=this.editorInstance)==null||i.executeEdits("automatic",[{forceMoveMarkers:!1,range:{startLineNumber:1,endLineNumber:1,startColumn:1,endColumn:1},text:t}]),this.editorInstance.pushUndoStop()):this.editorInstance.trigger("automatic","undo",null)}async saveFile(){this.editorModel&&!this.editorModel.isDisposed()?await this.writeFile(this.editorModel.getValue())&&(this.setIsUnsaved(!1),this.initialVersionId=this.editorModel.getAlternativeVersionId()):console.error("Cannot save file content without active editorModel")}setReadOnly(t){var i;this.readOnlyMode=t,(i=this.editorInstance)==null||i.updateOptions({readOnly:t!=="off"})}async paste(){var t;this.isReadOnly||(this.focus(),(t=this.editorInstance)==null||t.trigger("keyboard","paste",{text:await navigator.clipboard.readText()}))}cut(){this.isReadOnly||(this.focus(),document.execCommand("cut"))}async close(){const t=await super.close();if(t&&this.isUnsaved){const i=await u.getApp();if(this.isForeignFile)await i.fileSystem.unlink(this.getPath());else{const a=await(await this.fileHandle.getFile()).text();await i.project.packIndexer.updateFile(this.getPath(),a)}}return t}showContextMenu(t){this.parent.showCustomMonacoContextMenu(t,this)}}const Ic=X({__name:"UnsavedFile",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState();function n(){e.window.cancel()}function a(){e.window.noSave()}function r(){e.window.save()}return{__sfc:!0,t,props:e,state:i,onCancel:n,onNoSave:a,onSave:r,BaseWindow:ce}}});var Oc=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"general.confirm",isVisible:i.state.isVisible,isPersistent:!1,hasMaximizeButton:!1,isFullscreen:!1,width:440,height:130,hasCloseButton:!1,isSmallPopup:!0},scopedSlots:e._u([{key:"default",fn:function(){return[t("p",{staticClass:"mt-2"},[e._v(e._s(i.t("windows.unsavedFile.description")))])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"menu"},on:{click:i.onCancel}},[t("span",[e._v(e._s(i.t("general.cancel")))])]),t("v-btn",{attrs:{color:"error"},on:{click:i.onNoSave}},[t("span",[e._v(e._s(i.t("general.close")))])]),t("v-btn",{attrs:{color:"primary"},on:{click:i.onSave}},[t("span",[e._v(e._s(i.t("windows.unsavedFile.save")))])])]},proxy:!0}],null,!1,1792198457)}):e._e()},Rc=[],Wc=_(Ic,Oc,Rc,!1,null,null,null,null);const Lc=Wc.exports,Gn=new WeakMap;class Nc extends ee{constructor(e){super(Lc,!0,!1),Gn.set(this,e),this.defineWindow(),this.open()}get tab(){return Gn.get(this)}async noSave(){var t;this.close("close"),await((t=(await u.getApp()).tabSystem)==null?void 0:t.close(this.tab,!1))}async save(){var t,i;this.close("save");const e=await u.getApp();await((t=e.tabSystem)==null?void 0:t.save(this.tab)),await((i=e.tabSystem)==null?void 0:i.close(this.tab,!1))}async cancel(){this.close("cancel")}}class Kn{constructor(e=1/0,t){c(this,"array",[]);this.maxSize=e;for(const i of t!=null?t:[])this.add(i)}add(e,t=this.isEquals.bind(this)){const i=this.array.findIndex(n=>t(n,e));return i>-1?(this.array.splice(i,1),this.array.unshift(e),this):(this.array.length>=this.maxSize&&this.array.pop(),this.array.unshift(e),this)}remove(e,t=this.isEquals.bind(this)){const i=this.array.findIndex(n=>t(n,e));return i>-1&&this.array.splice(i,1),this}clear(){this.array=[]}isEquals(e,t){return e===t}toJSON(){return JSON.stringify(this.array)}fromArray(e){this.array=e}[Symbol.iterator](){return this.array.values()}get size(){return this.maxSize}get elementCount(){return this.array.length}get elements(){return[...this.array]}}class Bc extends ${constructor(t,i,n,a=!0){super();c(this,"queue");c(this,"app");this.maxSize=i,this.savePath=n,U(this,"queue",new Kn(i)),this.app=x(t),a&&this.setup()}async setup(){await this.app.fileSystem.fired;let t=[];try{t=await this.app.fileSystem.readJSON(this.savePath)}catch{}this.queue.fromArray(t),this.dispatch(this.queue)}isEquals(t,i){return t===i}keep(t){const i=new Kn(this.maxSize);this.elements.filter(n=>t(n)).forEach(n=>i.add(n,this.isEquals.bind(this))),this.queue=i}async add(t){await this.fired,this.queue.add(t,this.isEquals.bind(this)),await this.saveQueue()}async remove(t){await this.fired,this.queue.remove(t,this.isEquals.bind(this)),await this.saveQueue()}clear(){return this.queue.clear(),this.saveQueue()}async saveQueue(){await this.app.fileSystem.mkdir(ve(this.savePath),{recursive:!0}),await this.app.fileSystem.writeFile(this.savePath,this.queue.toJSON())}get elements(){return this.queue.elements}}class Vc extends Bc{constructor(e,t,i){super(t,1/0,i),this.tabSystem=e}async restoreTabs(){var e,t;if((t=(e=b==null?void 0:b.general)==null?void 0:e.restoreTabs)==null||t){await this.fired;for(let i=0;i<this.queue.elements.length;i++)try{await this.tabSystem.openPath(this.queue.elements[i],{selectTab:i===0,isTemporary:!1})}catch{}}}}async function Hc(){return await ue(()=>import("./jsoncParser.1459d33c.js"),[])}async function on(s,e){const{getLocation:t}=await Hc(),i=t(s.getValue(),s.getOffsetAt(e)).path;return isNaN(Number(i[i.length-1]))||i.pop(),i.join("/")}async function cn(s,e){const{Range:t}=await I(),i=s.getLineContent(e.lineNumber),n=zc(i,e.column),a=Uc(i,e.column);return{word:i.substring(n,a),range:new t(e.lineNumber,n,e.lineNumber,a)}}function Uc(s,e){for(let t=e-1;t<s.length;t++)if(s[t]==='"')return t;return s.length}function zc(s,e){for(let t=e-2;t>0;t--)if(s[t]==='"')return t+1;return 0}function ln(s){return Jc(s)(...Object.values(s.env))}function Jc({script:s,env:e,language:t,modules:i,async:n=!1}){if(t==="typeScript")throw new Error(`bridge.'s legacy script runner no longer supports TypeScript. Use "bridge-js-runner" instead.`);let a=qc(s);if(i){const r=e.require;e.require=async o=>{if(i[o])return i[o];if(typeof r=="function")return await(r==null?void 0:r(o))}}try{return n?new Function(...Object.keys(e),`return (async () => {
${a}
})()`):new Function(...Object.keys(e),a)}catch(r){throw console.error(s),new Error(`Error within script: ${r}`)}}function qc(s){return s.replace(/export default([ \(])/g,(e,t)=>`module.exports =${t}`).replace(/import\s+(\* as [a-z][a-z0-9]*|[a-z][a-z0-9]+|{[a-z\s][a-z0-9,\s]*})\s+from\s+["'](.+)["']/gi,(e,t,i)=>(t.startsWith("* as ")&&(t=t.replace("* as ","")),`const ${t} = await require('${i}')`))}async function Gc(s,e){const i=(await Promise.all(s.map(e))).findIndex(n=>n);return s[i]}async function dn(s,e,t){for(const i of t){const n=`${e}${i}`;if(await s.fileExists(n))return n}}function Kc(s,e){return{Bridge:{value:s,withExtension:(t,i)=>dn(e.fileSystem,t,i),resolvePackPath:(t,i)=>e.config.resolvePackPath(t,i)}}}class Yc{async provideDefinition(e,t,i){var C,P,k;const n=await u.getApp(),{word:a,range:r}=await cn(e,t),o=(P=(C=n.project.tabSystem)==null?void 0:C.selectedTab)==null?void 0:P.getPath();if(!o)return;const{definitions:l}=(k=u.fileType.get(o))!=null?k:{},d=await u.fileType.getLightningCache(o);if(!l||typeof d=="string"||d.length===0)return;const p=await on(e,t),{definitionId:h,transformedWord:m}=await this.getDefinition(a,p,d);if(!h||!m)return;let f=l[h];if(!f)return;Array.isArray(f)||(f=[f]);const g=await this.getFilePath(m,f),{editor:w,Uri:y,Range:S}=await I();return(await Promise.all(g.map(async T=>{const j=y.file(T);if(!w.getModel(j)){let M;try{M=await n.fileSystem.getFileHandle(T)}catch{return}const le=w.createModel(await M.getFile().then(Re=>Re.text()),void 0,j);setTimeout(()=>{n.project.getFileTab(M)||le.dispose()},5*1e3)}return{uri:j,range:new S(0,0,1/0,1/0)}}))).filter(T=>T!==void 0)}async getDefinition(e,t,i){var o;const n=await u.getApp();let a=e;const r=i.map(l=>[l.cacheKey,l.path,{script:l.script,filter:l.filter}]).filter(l=>l!==void 0);return{definitionId:await((o=Gc(r,async([l,d,{script:p,filter:h}])=>d===""?!1:hi(t,d)?(h&&h.includes(e)&&(a=void 0),a&&p&&(a=await ln({script:p,async:!0,env:{...Kc(a,{fileSystem:n.fileSystem,config:n.project.config})}})),!0):!1))==null?void 0:o.then(l=>l==null?void 0:l[0])),transformedWord:a}}async getFilePath(e,t){var a,r;const i=await u.getApp(),n=[];for(const o of t){if(o.directReference){n.push(e);continue}const l=(r=await((a=i.project.packIndexer.service)==null?void 0:a.find(o.from,o.match,[e],!0)))!=null?r:[];n.push(...l)}return n}}async function Ws(s,e){var r,o;await u.fileType.ready.fired;const t=l=>R(l),{id:i,documentation:n}=(r=u.fileType.get(s))!=null?r:{};if(!n){new J({description:`[${t("actions.documentationLookup.noDocumentation")} ${i?t(`fileType.${i}`):'"'+s+'"'}.]`});return}let a=n.baseUrl;e&&((o=n.supportsQuerying)!=null?o:!0)&&(a+=`#${e}`),u.openUrl(a)}function Ls(s,e){let t;try{t=s.getLineContent(e.lineNumber)}catch{return!1}const i=Zc(t,e.column),n=Qc(t,e.column);return i&&n}function Qc(s,e){for(let t=e-1;t<s.length;t++)if(s[t]==='"')return!0;return!1}function Zc(s,e){for(let t=e-2;t>0;t--)if(s[t]==='"')return!0;return!1}async function Xc(s){const e=await u.getApp();return await e.dataLoader.fired,await e.projectManager.projectReady.fired,s||(s=e.projectConfig.get().targetVersion),un().then(t=>t.filter(i=>!s||Q(i,s,"<=")))}async function un(){const s=await u.getApp();return await s.dataLoader.fired,(await s.dataLoader.readJSON("data/packages/minecraftBedrock/formatVersions.json")).formatVersions.reverse()}function it(){return un().then(s=>s[0])}async function Ns(s){return await s.fired,(await s.readJSON("data/packages/minecraftBedrock/formatVersions.json")).currentStable}async function el(){const{languages:s}=await I();s.registerCompletionItemProvider("json",{provideCompletionItems:async(e,t)=>{var d;const i=await u.getApp(),n=await on(e,t),a=(d=i.project.tabSystem)==null?void 0:d.selectedTab;if(!(a instanceof W))return{suggestions:[]};const r=a.getFileType();let o;try{o=L.parse(e.getValue())}catch{o={}}const l=o.format_version||i.project.config.get().targetVersion||await it();return{suggestions:i.project.snippetLoader.getSnippetsFor(l,r,[n]).map(p=>({kind:s.CompletionItemKind.Snippet,label:p.displayData.name,documentation:p.displayData.description,insertText:p.insertText,insertTextRules:s.CompletionItemInsertTextRule.InsertAsSnippet}))}}})}async function tl(){const{languages:s}=await I(),e={provideCompletionItems:async(t,i)=>{var l;const n=await u.getApp(),a=(l=n.project.tabSystem)==null?void 0:l.selectedTab;if(!(a instanceof W))return{suggestions:[]};const r=a.getFileType(),o=n.project.config.get().targetVersion||await it();return{suggestions:n.project.snippetLoader.getSnippetsFor(o,r,[]).map(d=>({kind:s.CompletionItemKind.Snippet,label:d.displayData.name,documentation:d.displayData.description,insertText:d.insertText,insertTextRules:s.CompletionItemInsertTextRule.InsertAsSnippet}))}}};["mcfunction","molang","javascript","typescript"].forEach(t=>s.registerCompletionItemProvider(t,e))}const Bs=new $;class il{constructor(e){this.theme=e}async apply(){if(!$t.hasFired)return;const{editor:e}=await I();e.defineTheme("bridgeMonacoDefault",{base:this.theme.colorScheme==="light"?"vs":"vs-dark",inherit:!1,colors:{"editor.background":this.convertColor(this.theme.getColor("background")),"editor.lineHighlightBackground":this.convertColor(this.theme.getColor("lineHighlightBackground")),"editorWidget.background":this.convertColor(this.theme.getColor("background")),"editorWidget.border":this.convertColor(this.theme.getColor("sidebarNavigation")),"pickerGroup.background":this.convertColor(this.theme.getColor("background")),"pickerGroup.border":this.convertColor(this.theme.getColor("sidebarNavigation")),"badge.background":this.convertColor(this.theme.getColor("background")),"input.background":this.convertColor(this.theme.getColor("sidebarNavigation")),"input.border":this.convertColor(this.theme.getColor("menu")),"inputOption.activeBorder":this.convertColor(this.theme.getColor("primary")),focusBorder:this.convertColor(this.theme.getColor("primary")),"list.focusBackground":this.convertColor(this.theme.getColor("menu")),"list.hoverBackground":this.convertColor(this.theme.getColor("sidebarNavigation")),contrastBorder:this.convertColor(this.theme.getColor("sidebarNavigation")),"peekViewTitle.background":this.convertColor(this.theme.getColor("background")),"peekView.border":this.convertColor(this.theme.getColor("primary")),"peekViewResult.background":this.convertColor(this.theme.getColor("sidebarNavigation")),"peekViewResult.selectionBackground":this.convertColor(this.theme.getColor("menu")),"peekViewEditor.background":this.convertColor(this.theme.getColor("background")),"peekViewEditor.matchHighlightBackground":this.convertColor(this.theme.getColor("menu")),...this.theme.getMonacoDefinition()},rules:[{background:this.convertColor(this.theme.getColor("background")),foreground:this.convertColor(this.theme.getColor("text"))},...Object.entries(this.theme.getHighlighterDefinition()).map(([t,{color:i,background:n,textDecoration:a,isItalic:r}])=>({token:t,foreground:this.convertColor(i),background:n?this.convertColor(n):void 0,fontStyle:`${r?"italic ":""}${a}`})).filter(({foreground:t})=>t!==void 0)]}),e.setTheme("bridgeMonacoDefault"),Bs.dispatch()}convertColor(e){return e&&(e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`:e:Xa.keyword.hex(e))}}let Yn=!1;class nl extends ${constructor(t){super();c(this,"_monacoEditor");c(this,"disposables",[]);this._app=t,Yn||(Yn=!0,I().then(({languages:i})=>{i.typescript.javascriptDefaults.setCompilerOptions({target:i.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,alwaysStrict:!0,checkJs:!0}),i.typescript.typescriptDefaults.setCompilerOptions({target:i.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,alwaysStrict:!0,moduleResolution:i.typescript.ModuleResolutionKind.NodeJs,module:i.typescript.ModuleKind.ESNext}),i.registerDefinitionProvider("json",new Yc),tl()}))}get monacoEditor(){if(!this._monacoEditor)throw new Error("Accessed Monaco Editor before it was defined");return this._monacoEditor}getMobileOptions(t){return{lineNumbers:t?"off":"on",minimap:{enabled:!t},tabSize:t?2:4,scrollbar:{horizontalScrollbarSize:t?15:void 0,verticalScrollbarSize:t?20:void 0,horizontalSliderSize:t?15:void 0,verticalSliderSize:t?20:void 0}}}async createMonacoEditor(t){var d,p,h,m,f,g,w,y,S;const{KeyCode:i,KeyMod:n,editor:a}=await I();await Bs.fired,this.dispose(),this._monacoEditor=x(a.create(t,{wordBasedSuggestions:!1,theme:"bridgeMonacoDefault",roundedSelection:!1,autoIndent:"full",fontSize:Number(((p=(d=b==null?void 0:b.appearance)==null?void 0:d.editorFontSize)!=null?p:"14px").replace("px","")),"bracketPairColorization.enabled":(m=(h=b==null?void 0:b.editor)==null?void 0:h.bracketPairColorization)!=null?m:!1,fontFamily:((g=(f=b==null?void 0:b.appearance)==null?void 0:f.editorFont)!=null?g:H()==="darwin"?"Menlo":"Consolas")+", monospace",...this.getMobileOptions(this._app.mobile.isCurrentDevice()),contextmenu:!1,wordWrap:(w=b==null?void 0:b.editor)!=null&&w.wordWrap?"bounded":"off",wordWrapColumn:Number((S=(y=b==null?void 0:b.editor)==null?void 0:y.wordWrapColumns)!=null?S:"80")}));const r=this._monacoEditor._codeEditorService,o=r.openCodeEditor.bind(r);r.openCodeEditor=He(async(v,C,P)=>{var T,j;let k=await o(v,C,P);if(!k)try{const M=(T=this._app.tabSystem)==null?void 0:T.selectedTab;M&&(M.isTemporary=!1),await((j=this._app.project.tabSystem)==null?void 0:j.openPath(v.resource.path.slice(1)))}catch{console.error(`Failed to open file "${v.resource.path.slice(1)}"`)}return k},100);const l=this._monacoEditor.getAction("editor.action.commentLine");this._monacoEditor.addAction({...l,keybindings:[n.CtrlCmd|i.Backslash],run(...v){this._run(...v)}}),this._monacoEditor.onDidChangeModelContent(v=>{var T,j,M,le,Re;const C=(j=(T=this._app.tabSystem)==null?void 0:T.selectedTab)==null?void 0:j.getPath();if(!C||!u.fileType.isJsonFile(C))return;const P=(M=this._monacoEditor)==null?void 0:M.getModel(),k=(Re=(le=this._monacoEditor)==null?void 0:le.getSelection())==null?void 0:Re.getPosition();P&&k&&Ls(P,k)&&v.changes.some(Ge=>Ge.text===" ")&&setTimeout(()=>{var Ge;(Ge=this._monacoEditor)==null||Ge.trigger("auto","editor.action.triggerSuggest",{})},50)}),this._monacoEditor.layout(),this.disposables.push(this._app.windowResize.on(()=>setTimeout(()=>{var v;return(v=this._monacoEditor)==null?void 0:v.layout()}))),this.disposables.push(this._app.mobile.change.on(v=>{var C;(C=this._monacoEditor)==null||C.updateOptions(this.getMobileOptions(v))})),this.dispatch()}updateOptions(t){var i;(i=this._monacoEditor)==null||i.updateOptions(t)}dispose(){var t;(t=this._monacoEditor)==null||t.dispose(),this.disposables.forEach(i=>i.dispose()),this.disposables=[],this._monacoEditor=void 0,this.resetSignal()}onReadonlyCustomMonacoContextMenu(){return[{name:"actions.documentationLookup.name",icon:"mdi-book-open-outline",onTrigger:async()=>{var r,o,l,d,p;const t=(r=this._monacoEditor)==null?void 0:r.getModel(),i=(o=this._monacoEditor)==null?void 0:o.getSelection();if(!t||!i)return;const n=(d=(l=this._app.tabSystem)==null?void 0:l.selectedTab)==null?void 0:d.getPath();if(!n)return;let a;u.fileType.isJsonFile(n)?a=await cn(t,i.getPosition()).then(h=>h.word):a=(p=t.getWordAtPosition(i.getPosition()))==null?void 0:p.word,Ws(n,a)}},{name:"actions.goToDefinition.name",icon:"mdi-magnify",onTrigger:()=>{var t;(t=this._monacoEditor)==null||t.trigger("contextmenu","editor.action.revealDefinition",null)}},{name:"actions.goToSymbol.name",icon:"mdi-at",onTrigger:()=>{setTimeout(()=>{var t,i;(t=this._monacoEditor)==null||t.focus(),(i=this._monacoEditor)==null||i.trigger("contextmenu","editor.action.quickOutline",null)})}}]}showCustomMonacoContextMenu(t,i){if(i.isReadOnly)return De(t,this.onReadonlyCustomMonacoContextMenu());De(t,[...this.onReadonlyCustomMonacoContextMenu(),{type:"divider"},{name:"actions.changeAllOccurrences.name",icon:"mdi-pencil-outline",onTrigger:()=>{var n;(n=this._monacoEditor)==null||n.trigger("contextmenu","editor.action.rename",null)}},{name:"actions.formatDocument.name",icon:"mdi-text-box-check-outline",onTrigger:()=>{var n;(n=this._monacoEditor)==null||n.trigger("contextmenu","editor.action.formatDocument",null)}},{type:"divider"},{name:"actions.copy.name",icon:"mdi-content-copy",onTrigger:()=>{document.execCommand("copy")}},{name:"actions.cut.name",icon:"mdi-content-cut",onTrigger:()=>{i.cut()}},{name:"actions.paste.name",icon:"mdi-content-paste",onTrigger:()=>{i.paste()}}])}}async function ni(s,e){return e||(e=(await u.getApp()).fileSystem),new Promise(async(t,i)=>{const n=new FileReader;try{const r=await(await e.getFileHandle(s)).getFile();n.addEventListener("load",()=>{t(n.result)}),n.addEventListener("error",i),n.readAsDataURL(r)}catch{i(`File does not exist: "${s}"`)}})}function vi(s){return new Promise(async(e,t)=>{const i=new FileReader;try{const n=await s.getFile();i.addEventListener("load",()=>{e(i.result)}),i.addEventListener("error",t),i.readAsDataURL(n)}catch{t(`File does not exist: "${s.name}"`)}})}const sl={name:"ImageTab",props:{tab:Object}};var al=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex align-center justify-center",on:{click:function(i){return e.tab.parent.setActive(!0)}}},[t("img",{staticClass:"img-preview",attrs:{src:e.tab.dataUrl,alt:e.tab.path,draggable:"false"}})])},rl=[],ol=_(sl,al,rl,!1,null,"bd22dcf6",null,null);const cl=ol.exports;class Vs extends W{constructor(){super(...arguments);c(this,"component",cl);c(this,"dataUrl")}static is(t){const i=t.name;return i.endsWith(".png")||i.endsWith(".jpg")||i.endsWith(".jpeg")}setReadOnly(t){this.readOnlyMode=t}async onActivate(){this.dataUrl=await vi(this.fileHandle)}get icon(){return"mdi-file-image-outline"}get iconColor(){return"resourcePack"}_save(){}}class ll extends Vs{constructor(){super(...arguments);c(this,"tga",new er);c(this,"maskIsApplied",!0)}static is(t){return t.name.endsWith(".tga")}async setup(){await super.setup(),this.addAction(new D({icon:"mdi-image-filter-black-white",name:"actions.tgaMaskToggle.name",onTrigger:async()=>{if(this.maskIsApplied){await this.applyUnmaskedImageUrl(),this.maskIsApplied=!1;return}this.applyMaskedImageUrl(),this.maskIsApplied=!0}}))}async onActivate(){this.isLoading=!0;const t=await this.fileHandle.getFile();if(this.tga.load(new Uint8Array(await t.arrayBuffer())),this.isLoading=!1,this.maskIsApplied){this.applyMaskedImageUrl();return}await this.applyUnmaskedImageUrl()}_save(){}async saveAs(){}applyMaskedImageUrl(){this.dataUrl=this.tga.getDataURL("image/png")}async applyUnmaskedImageUrl(){const{width:t,height:i,data:n}=this.tga.getImageData(),a=new OffscreenCanvas(t,i),r=a.getContext("2d"),o=r.createImageData(t,i),l=n.length;for(let h=0;h<l;h+=4)o.data[h]=n[h],o.data[h+1]=n[h+1],o.data[h+2]=n[h+2],o.data[h+3]=255;r.putImageData(o,0,0);const d=await a.convertToBlob({type:"image/png"}),p=new FileReader;p.readAsDataURL(d),p.onload=()=>{var h;this.dataUrl=(h=p.result)==null?void 0:h.toString()},p.onerror=()=>{throw new Error("Failed reading OffscreenCanvas Blob")}}}const dl={name:"BridgeSheet",props:{dark:Boolean,isLoading:Boolean},computed:{nonClickListeners(){return Object.fromEntries(Object.entries(this.$listeners).filter(([s,e])=>s!=="click"))},hasClickListener(){return!!this.$listeners.click}}};var ul=function(){var e=this,t=e._self._c;return t("div",e._g({directives:[{name:"ripple",rawName:"v-ripple",value:e.hasClickListener&&!e.isLoading,expression:"hasClickListener && !isLoading"}],staticClass:"rounded-lg",class:{"bg-dark":e.dark,bg:!e.dark},on:{click:function(i){e.isLoading||e.$emit("click")}}},e.nonClickListeners),[e.isLoading?t("v-progress-circular",{attrs:{color:"accent",indeterminate:""}}):e._t("default")],2)},pl=[],hl=_(dl,ul,pl,!1,null,"ce3c4e27",null,null);const Oe=hl.exports,ml={name:"SoundTab",components:{BridgeSheet:Oe},props:{tab:Object},computed:{audio(){return this.tab.audio},extension(){return this.tab.name.split(".").pop().toUpperCase()},roundedCurrentTime(){return(Math.round(this.tab.currentTime*100)/100).toFixed(2)},roundedTotalTime(){return(Math.round(this.audio.duration*100)/100).toFixed(2)}}};var fl=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex align-center justify-center",on:{click:function(i){return e.tab.parent.setActive(!0)}}},[e.audio?t("BridgeSheet",{staticClass:"pa-3 d-flex flex-column",staticStyle:{width:"90%",height:"400px"}},[t("div",{staticClass:"d-flex align-center"},[t("BridgeSheet",{staticClass:"pa-4 accent--text",staticStyle:{width:"fit-content",height:"fit-content"},attrs:{dark:""}},[e._v(" "+e._s(e.extension)+" ")]),t("v-btn",{attrs:{icon:"",color:e.tab.audioShouldLoop?"primary":null},on:{click:function(i){return e.tab.toggleAudioLoop()}}},[t("v-icon",[e._v("mdi-all-inclusive")])],1),t("v-spacer"),t("v-slider",{attrs:{height:"50%","prepend-icon":e.audio.volume===0?"mdi-volume-off":"mdi-volume-high",min:0,max:1,step:.01,"hide-details":""},model:{value:e.audio.volume,callback:function(i){e.$set(e.audio,"volume",i)},expression:"audio.volume"}})],1),t("div",{staticClass:"flex-grow-1 d-flex align-center justify-center"},[t("v-btn",{attrs:{"x-large":"",icon:"",outlined:""},on:{click:function(i){e.tab.isPlaying?e.audio.pause():e.audio.play()}}},[t("v-icon",[e._v(" "+e._s(e.tab.isPlaying?"mdi-pause":"mdi-play")+" ")])],1)],1),t("div",{staticClass:"d-flex align-center"},[e.tab.loadedAudioMetadata?t("span",{staticClass:"text--secondary"},[e._v(" "+e._s(e.roundedCurrentTime)+" / "+e._s(e.roundedTotalTime)+" ")]):e._e(),t("v-slider",{attrs:{value:e.tab.currentTime,min:0,max:e.audio.duration,step:"0.01","hide-details":""},on:{input:i=>e.tab.setCurrentTime(i)}})],1)]):e._e()],1)},gl=[],wl=_(ml,fl,gl,!1,null,null,null,null);const yl=wl.exports;function Ii(s,e,t=window){return t.addEventListener(s,e),{dispose:()=>{t.removeEventListener(s,e)}}}class vl extends W{constructor(){super(...arguments);c(this,"component",yl);c(this,"dataUrl");c(this,"audio",null);c(this,"intervalId",null);c(this,"currentTime",0);c(this,"timeTriggeredManually",!1);c(this,"isPlaying",!1);c(this,"loadedAudioMetadata",!1);c(this,"audioShouldLoop",!1);c(this,"disposables",[])}get icon(){return"mdi-file-music-outline"}get iconColor(){return"resourcePack"}static is(t){const i=t.name;return i.endsWith(".mp3")||i.endsWith(".ogg")}setReadOnly(t){this.readOnlyMode=t}async setup(){this.dataUrl=await vi(this.fileHandle),this.audio=document.createElement("audio"),this.audio&&(this.audio.preload="metadata",this.audio.loop=this.audioShouldLoop,this.audio.src=this.dataUrl,this.intervalId=window.setInterval(()=>this.updateCurrentTime(),100),this.disposables=[Ii("play",()=>this.onPlay(),this.audio),Ii("pause",()=>this.onPause(),this.audio),Ii("loadedmetadata",()=>this.onLoadedMetadata(),this.audio)],await super.setup())}onDestroy(){var t;this.intervalId&&window.clearInterval(this.intervalId),this.intervalId=null,this.disposables.forEach(i=>i.dispose()),this.disposables=[],(t=this.audio)==null||t.pause(),this.audio=null}onPlay(){this.isPlaying=!0}onPause(){this.isPlaying=!1}onLoadedMetadata(){this.loadedAudioMetadata=!0}updateCurrentTime(){var t,i;this.timeTriggeredManually=!1,this.currentTime=(i=(t=this.audio)==null?void 0:t.currentTime)!=null?i:0}toggleAudioLoop(){this.audioShouldLoop=!this.audioShouldLoop,this.audio&&(this.audio.loop=this.audioShouldLoop)}setCurrentTime(t){if(!!this.audio){if(!this.timeTriggeredManually){this.timeTriggeredManually=!0;return}Number.isNaN(t)||(this.audio.currentTime=Math.round(t*100)/100)}}_save(){}}const G={methods:{t(s){return R(s)}}};class nt{}class Et extends nt{constructor(e){super(),this.entries=e}get unselectTrees(){return this.entries.map(e=>e.unselectTrees).flat()}undo(){return new Et(this.entries.reverse().map(e=>e.undo()))}}class Hi extends nt{constructor(t,i,n=""){super();c(this,"unselectTrees",[]);this.tree=t,this.index=i,this.key=n,this.unselectTrees=[this.tree]}undo(){const t=this.tree.getParent();if(!t)throw new Error("Invalid state: Undo delete action on global tree node");return t.type==="array"?t.children.splice(this.index,0,this.tree):t.children.splice(this.index,0,[this.key,this.tree]),new si(this.tree,this.index,this.key)}}class si extends nt{constructor(t,i,n=""){super();c(this,"unselectTrees",[]);this.tree=t,this.index=i,this.key=n,this.unselectTrees=[this.tree]}undo(){const t=this.tree.getParent();if(!t)throw new Error("Invalid state: Redo delete action on global tree node");return t.children.splice(this.index,1),new Hi(this.tree,this.index,this.key)}}class pn extends nt{constructor(t,i,n){super();c(this,"unselectTrees");this.parent=t,this.oldValue=i,this.newValue=n,this.unselectTrees=[t]}undo(){return this.parent.updatePropertyName(this.newValue,this.oldValue),new pn(this.parent,this.newValue,this.oldValue)}}class hn extends nt{constructor(t,i){super();c(this,"unselectTrees");this.tree=t,this.value=i,this.unselectTrees=[t]}undo(){const t=`${this.tree.value}`;return this.tree.edit(this.value),new hn(this.tree,t)}}class Le extends nt{constructor(t,i){super();c(this,"unselectTrees");this.oldTree=t,this.newTree=i,this.unselectTrees=[i]}undo(){return this.newTree.replace(this.oldTree),new Le(this.newTree,this.oldTree)}}const te=F("mouse");window.addEventListener("pointerdown",s=>{te.value=s.pointerType},{passive:!0});const Dt=te.value==="mouse"?19:26;class mn{constructor(e){c(this,"uuid",E());c(this,"isSelected",!1);this.parent=e}get value(){return this._value}getParent(){return this.parent}setParent(e){this.parent=e}get path(){return this.parent?[...this.parent.path,this.key]:[]}findParentIndex(){if(!this.parent)throw new Error("Cannot findParentIndex for tree without parent");let e;if(this.parent.type==="array"?e=this.parent.children.findIndex(t=>t===this):e=this.parent.children.findIndex(([t,i])=>i===this),e===-1)throw console.log(this),new Error("Invalid state: TreeChild with parent couldn't be found inside of parent's children");return e}get key(){if(!this.parent)throw new Error("Trees without parent do not have a key");const e=this.findParentIndex();return this.parent.type==="array"?e:this.parent.children[e][0]}setIsSelected(e){this.isSelected=e}replace(e){if(!this.parent)throw new Error("Cannot replace tree without parent");const t=this.findParentIndex();U(this.parent.children,t,this.parent.type==="array"?e:[this.key,e])}delete(){if(!this.parent)throw new Error("Cannot delete tree without parent");let e;if(this.parent.type==="array"){if(e=this.parent.children.findIndex(i=>i===this),e===-1)throw new Error("Invalid state: TreeChild with parent couldn't be found inside of parent's children")}else if(e=this.parent.children.findIndex(([i,n])=>n===this),e===-1)throw new Error("Invalid state: TreeChild with parent couldn't be found inside of parent's children");const[t]=this.parent.children.splice(e,1);return[e,Array.isArray(t)?t[0]:""]}}const Qn=s=>`${s}Def`,fn=s=>({data:()=>Object.fromEntries(s.map(e=>[Qn(e),{}])),mounted(){u.instance.themeManager.on(this.onThemeChanged),this.onThemeChanged()},destroyed(){u.instance.themeManager.off(this.onThemeChanged)},methods:{onThemeChanged(){s.forEach(e=>{this[Qn(e)]=u.instance.themeManager.getHighlighterInfo(e)})}}}),Pt=new q({keywords:[],typeIdentifiers:[],variables:[],definitions:[]});setTimeout(()=>{u.getApp().then(s=>s.configuredJsonLanguage.getHighlighter().on(({keywords:e,typeIdentifiers:t,variables:i,definitions:n})=>{Pt.keywords=e,Pt.typeIdentifiers=t,Pt.variables=i,Pt.definitions=n}))});const bl={props:{def:Object,value:String},mixins:[fn(["string","variable","definition","keyword","type"])],setup(){return{knownWords:Pt}},data:()=>({skipRender:!0}),computed:{tokens(){return this.value.split(":").map(s=>({text:s,def:this.getDefinition(s)}))}},methods:{getDefinition(s){return this.knownWords.keywords.includes(s)?this.keywordDef:this.knownWords.typeIdentifiers.includes(s)?this.typeDef:this.knownWords.variables.includes(s)?this.variableDef:this.knownWords.definitions.includes(s)?this.definitionDef:this.stringDef},getTextDecoration(s){return s?(s.textDecoration||(s.textDecoration=""),s.isItalic&&(s.textDecoration+=" italic"),s.textDecoration):null},toStyle(s){return{color:s?s.color:null,backgroundColor:s?s.background:null,textDecoration:this.getTextDecoration(s)}},onIntersect(s){if(!this.skipRender)return;const e=!s[0].isIntersecting;this.skipRender=e}}};var _l=function(){var e=this,t=e._self._c;return e.value===void 0?t("span",{style:e.toStyle(e.def)},[e._t("default")],2):t("span",{directives:[{name:"intersect",rawName:"v-intersect",value:e.skipRender?e.onIntersect:null,expression:"skipRender ? onIntersect : null"}],staticStyle:{"white-space":"nowrap"}},[e.skipRender?t("span",[e._v('"'+e._s(e.value)+'"')]):t("span",[e._v('"'),e._l(e.tokens,function({text:i,def:n},a){return[t("span",{key:i,style:e.toStyle(n)},[e._v(e._s(i))]),t("span",{key:`${i}.colon`},[e._v(e._s(e.tokens.length>a+1?":":""))])]}),e._v('"')],2)])},Sl=[],Cl=_(bl,_l,Sl,!1,null,null,null,null);const Hs=Cl.exports;class gn extends nt{constructor(t,i,n,a=""){super();c(this,"unselectTrees",[]);this.oldParent=t,this.tree=i,this.index=n,this.key=a,this.unselectTrees=[this.tree]}undo(){const t=this.tree.getParent();if(!t)throw new Error("Invalid state: Undo delete action on global tree node");const i=this.tree.findParentIndex();return this.tree.delete(),this.oldParent.type==="array"?this.oldParent.children.splice(this.index,0,this.tree):this.oldParent.children.splice(this.index,0,[this.key,this.tree]),this.tree.setParent(this.oldParent),new gn(t,this.tree,i,this.key)}}const xl={name:"TreeChildren",mixins:[fn(["number"])],components:{Highlight:Hs,Draggable:Zi},props:{tree:Object,treeEditor:Object},setup(){return{pointerDevice:te}},methods:{wrapKey(s){return this.tree.type==="object"?`"${s}"`:`${s}`},onChange(s){if(s.removed||s.moved){const e=s.removed?s.removed.element[1]:s.moved.element[1],t=s.removed?s.removed.oldIndex:s.moved.oldIndex;this.treeEditor.history.push(new gn(this.tree,e,t,e.key))}else s.added&&(s.added.element[1].parent=this.tree)}},computed:{dragAndDropEnabled(){var s,e;return(e=(s=b.editor)==null?void 0:s.dragAndDropTreeNodes)!=null?e:!0},children:{get(){return this.tree instanceof pe?Object.entries(this.tree.children):this.tree.children},set(s){this.tree instanceof pe?this.tree._children=s.map(e=>e[1]):this.tree._children=s}}}};var kl=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pl-4"},[t("Draggable",{attrs:{group:{name:"treeEditorNode"},disabled:!e.dragAndDropEnabled||e.pointerDevice==="touch"},on:{change:e.onChange},model:{value:e.children,callback:function(i){e.children=i},expression:"children"}},e._l(e.children,function([i,n]){return t(n.component,{key:n.uuid,tag:"component",attrs:{tree:n,treeEditor:e.treeEditor},on:{setActive:function(a){return e.$emit("setActive")}}},[e.tree.type==="array"?t("span",{style:e.numberDef},[e._v(e._s(i))]):t("Highlight",{attrs:{value:i}})],1)}),1)],1)},Pl=[],jl=_(xl,kl,Pl,!1,null,null,null,null);const Fl=jl.exports;function Ui(s,e,t,i=500){let n=null;return{onTouchStart:(...o)=>{n=window.setTimeout(()=>{s(...o),n=null},i)},onTouchEnd:()=>{n&&(window.clearTimeout(n),n=null,e==null||e()),t==null||t()}}}const Us={computed:{isDevMode(){var s,e;return(e=(s=b==null?void 0:b.developers)==null?void 0:s.isDevMode)!=null?e:!1}}};const rt={array:"[]",object:"{}"},Tl={name:"ObjectTree",components:{TreeChildren:Fl},mixins:[Us],props:{tree:Object,treeKey:String,treeEditor:Object},setup(s){const{onTouchStart:e,onTouchEnd:t}=Ui(i=>{s.treeEditor.onContextMenu(i,s.tree)},null,()=>{s.treeEditor.parent.app.contextMenu.setMayCloseOnClickOutside(!0)},800);return{onTouchStart:e,onTouchEnd:t,pointerDevice:te}},computed:{hideBracketsWithinTreeEditor(){return b.editor&&b.editor.hideBracketsWithinTreeEditor||!1},showArrayIndices(){return b.editor&&b.editor.showArrayIndices||!1},openingBracket(){if(!this.hideBracketsWithinTreeEditor)return this.tree.isOpen?rt[this.tree.type][0]:Object.keys(this.tree.children).length>0?`${rt[this.tree.type][0]}...${rt[this.tree.type][1]}`:`${rt[this.tree.type][0]}${rt[this.tree.type][1]}`},closingBracket(){if(!this.hideBracketsWithinTreeEditor)return this.tree.isOpen?rt[this.tree.type][1]:void 0}},methods:{onClickKey(s){var e,t;this.$emit("setActive"),((t=(e=b.editor)==null?void 0:e.automaticallyOpenTreeNodes)==null||t)&&(!this.tree.isOpen||this.tree.isSelected)&&this.tree.toggleOpen(),s.altKey?this.treeEditor.toggleSelection(this.tree):this.treeEditor.setSelection(this.tree)}}};var Al=function(){var e=this,t=e._self._c;return e.$slots.default?t("details",{attrs:{open:e.tree.isOpen,tabindex:"-1"}},[t("summary",{class:{"common-tree-key":!0,open:e.tree.isOpen,"tree-editor-selection":e.tree.isSelected},style:{height:e.pointerDevice==="touch"?"26px":null},attrs:{tabindex:"-1"},on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.onClickKey.apply(null,arguments)},contextmenu:function(i){return i.preventDefault(),e.treeEditor.onContextMenu(i,e.tree)},pointerdown:function(i){return e.onTouchStart(i)},pointerup:e.onTouchEnd,pointermove:e.onTouchEnd,pointercancel:e.onTouchEnd}},[t("v-icon",{staticClass:"mr-1 open-state-icon",style:{position:"relative",opacity:e.tree.hasChildren?null:"60%",top:e.tree.hasChildren?"0px":"-1.5px"},attrs:{small:""},nativeOn:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.tree.toggleOpen()}}},[e._v(" mdi-chevron-right ")]),e.showArrayIndices||e.tree.parent.type==="object"?t("span",[e.isDevMode?t("span",[e._v(" s: "+e._s(e.tree.type)+" p: "+e._s(e.tree.parent.type)+" ")]):e._e(),t("span",{on:{dblclick:function(i){return e.tree.toggleOpen()}}},[e._t("default")],2),e._v(e._s(e.hideBracketsWithinTreeEditor?void 0:":"))]):e.showArrayIndices?e._e():t("span",{class:{"mx-2":e.pointerDevice!=="touch","mx-6":e.pointerDevice==="touch"}}),t("span",{staticClass:"px-1",on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.tree.toggleOpen()}}},[e._v(" "+e._s(e.openingBracket)+" ")])],1),e.tree.isOpen?t("TreeChildren",{attrs:{tree:e.tree,treeEditor:e.treeEditor},on:{setActive:function(i){return e.$emit("setActive")}}}):e._e(),e._v(" "+e._s(e.closingBracket)+" ")],1):t("TreeChildren",{attrs:{tree:e.tree,treeEditor:e.treeEditor},on:{setActive:function(i){return e.$emit("setActive")}}})},$l=[],El=_(Tl,Al,$l,!1,null,"e3b8530c",null,null);const zs=El.exports;class be extends mn{constructor(t,i){super(t);c(this,"component",x(zs));c(this,"_isOpen",!1);c(this,"type","object");c(this,"_children");this._value=i,this._children=Object.entries(i).map(([n,a])=>[n,ai(this,a)])}get height(){return this.isOpen?2*Dt+this._children.reduce((t,[i,n])=>t+n.height,0):Dt}get children(){return this._children}get hasChildren(){return this._children.length>0}get isOpen(){return this.hasChildren?this._isOpen:!1}hasChild(t){return this.children.some(([i,n])=>n===t)}addChild(t,i){this._children.push([t,i])}setOpen(t,i=!1){(this.hasChildren||i)&&(this._isOpen=t)}toggleOpen(){this.setOpen(!this._isOpen)}toJSON(){return Object.fromEntries(this._children.map(([t,i])=>[t,i.toJSON()]))}updatePropertyName(t,i){const n=this.children.findIndex(p=>p[0]===t);let[a,r]=this.children[n];if(!r)return;let o=0,l=i,d=this.children.findIndex(p=>p[0]===i);if(d!==n)for(;d!==-1;)d=this.children.findIndex(p=>p[0]===i),i=l+`_${o++}`;U(this.children,n,[i,r])}}const Dl={components:{Highlight:Hs},name:"PrimitiveTree",mixins:[fn(["atom","string","number"]),Us],props:{tree:Object,treeEditor:Object},setup(s){const{onTouchStart:e,onTouchEnd:t}=Ui(a=>{te.value==="touch"&&s.treeEditor.onContextMenu(a,s.tree,!1)},null,()=>{s.treeEditor.parent.app.contextMenu.setMayCloseOnClickOutside(!0)}),{onTouchStart:i,onTouchEnd:n}=Ui(a=>{te.value==="touch"&&s.treeEditor.onContextMenu(a,s.tree)},null,()=>{s.treeEditor.parent.app.contextMenu.setMayCloseOnClickOutside(!0)});return{onTouchStart:e,onTouchEnd:t,onKeyTouchStart:i,onKeyTouchEnd:n,pointerDevice:te}},computed:{treeValue(){return this.tree.value===null?"null":this.tree.type==="string"?this.tree.value:this.tree.value},highlighterInfoDef(){switch(this.tree.type){case"number":return"numberDef";case"string":return;case"boolean":return"atomDef";case"null":return"atomDef";default:throw new Error(`Unknown primitive type: "${this.tree.type}"`)}},highlighterInfo(){return this[this.highlighterInfoDef]},textDecoration(){return this.highlighterInfo.textDecoration||(this.highlighterInfo.textDecoration=""),this.highlighterInfo.isItalic&&(this.highlighterInfo.textDecoration+=" italic"),this.highlighterInfo.textDecoration}},methods:{onClickKey(s,e){this.$emit("setActive"),s.altKey?this.treeEditor.toggleSelection(this.tree,e):this.treeEditor.setSelection(this.tree,e)}}};var Ml=function(){var e=this,t=e._self._c;return t("div",{style:{display:"block",whiteSpace:"nowrap",height:e.pointerDevice==="touch"?"26px":null},attrs:{tabindex:"-1"}},[t("div",{class:{"tree-editor-selection":e.tree.type!=="object"&&e.tree.type!=="array"&&e.tree.isSelected},staticStyle:{display:"inline-block"},on:{contextmenu:function(i){return i.preventDefault(),i.stopPropagation(),e.treeEditor.onContextMenu(i,e.tree)},pointerdown:function(i){return e.onKeyTouchStart(i)},pointerup:e.onKeyTouchEnd}},[t("v-icon",{staticClass:"mr-1",style:{opacity:"60%",position:"relative",top:"-1.5px"},attrs:{small:""}},[e._v(" mdi-chevron-right ")]),e.tree.parent.type==="object"?t("span",[t("span",{on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.onClickKey.apply(null,arguments)}}},[e._t("default")],2),e._v(":")]):e._e()],1),e.isDevMode?t("span",[e._v(" s: "+e._s(e.tree.type)+" p: "+e._s(e.tree.parent.type))]):e._e(),t("Highlight",{class:{"tree-editor-selection":e.tree.isValueSelected,"px-1":!0},style:{height:"20.5px",display:"inline-block"},attrs:{def:e.highlighterInfo,value:this.tree.type==="string"?e.treeValue:void 0},on:{pointermove:e.onTouchEnd,pointercancel:e.onTouchEnd},nativeOn:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.onClickKey(i,!0)},contextmenu:function(i){return i.preventDefault(),e.treeEditor.onContextMenu(i,e.tree,!1)},pointerdown:function(i){return e.onTouchStart(i)},pointerup:function(i){return e.onTouchEnd.apply(null,arguments)}}},[e._v(" "+e._s(e.treeValue)+" ")])],1)},Il=[],Ol=_(Dl,Ml,Il,!1,null,null,null,null);const Rl=Ol.exports;class se extends mn{constructor(t,i){super(t);c(this,"component",x(Rl));c(this,"isValueSelected",!1);this._value=i}get type(){return this.value===null?"null":typeof this.value}get height(){return Dt}setValue(t){this._value=t}toJSON(){return this.value}edit(t){t==="true"||t==="false"?this.setValue(t==="true"):Number.isNaN(Number(t))?t==="null"?this.setValue(null):this.setValue(t):this.setValue(Number(t))}isEmpty(){return this.value===""}}function ai(s,e){if(e===null)return new se(s,null);if(Array.isArray(e))return new pe(s,e);if(typeof e=="object")return new be(s,e);if(["string","number","boolean"].includes(typeof e))return new se(s,e);throw new Error(`Undefined type handler: "${typeof e}" -> ${e}`)}class pe extends mn{constructor(t,i){super(t);c(this,"component",x(zs));c(this,"_isOpen",!1);c(this,"type","array");c(this,"_children");this._value=i,this._children=i.map(n=>ai(this,n))}get height(){return this.isOpen?2*Dt+this._children.reduce((t,i)=>t+i.height,0):Dt}get children(){return this._children}get hasChildren(){return this._children.length>0}get isOpen(){return this.hasChildren?this._isOpen:!1}hasChild(t){return this.children.includes(t)}addChild(t){this._children.push(t)}setOpen(t,i=!1){(this.hasChildren||i)&&(this._isOpen=t)}toggleOpen(){this.setOpen(!this._isOpen)}toJSON(){return this._children.map(t=>t.toJSON())}updatePropertyName(t,i){let n=this.children[t],a=this.children[i];return this.children[i]=n,delete this.children[t],{undo:()=>{this.children[t]=n,this.children[i]=a}}}}class Zn{constructor(e,t){this.parent=e,this.tree=t,t.setIsSelected(!0)}getTree(){return this.tree}getLocation(){return this.tree.path.join("/")}select(e){this.tree.setIsSelected(!1),this.tree=e,this.tree.setIsSelected(!0)}dispose(e=!0){this.tree.setIsSelected(!1),e&&this.parent.removeSelection(this)}edit(e){const t=this.tree.getParent();if(!t)throw new Error("Cannot edit property name without parent");if(t instanceof pe)throw new Error("Cannot edit array indices");const i=this.tree.key;return t.updatePropertyName(i,e),new pn(t,i,e)}addKey(e,t){if(this.tree instanceof se)return;const i=this.tree.children.length,n=[];if(this.tree.setOpen(!0,!0),t==="objectArray"&&this.tree instanceof be){this.dispose();const r=new pe(this.tree.getParent(),[]);this.tree.replace(r),r.setOpen(!0,!0),n.push(new Le(this.tree,r)),this.tree=r}const a=t==="object"?new be(this.tree,{}):new pe(this.tree,[]);if(this.tree instanceof pe){this.tree.children.push(a);const r=new be(a,{});a.type==="array"?a.children.push(r):a.children.push([e,r]),this.parent.setSelection(r),a.setOpen(!0)}else this.tree.children.push([e,a]),this.parent.setSelection(a);return this.tree.setOpen(!0),n.push(new si(a,i,e)),new Et(n)}addValue(e,t){const i=[];if(!(this.tree instanceof se&&!this.tree.isEmpty())){if(t==="valueArray"&&this.tree instanceof be){this.dispose();const n=new pe(this.tree.getParent(),[]);n.setOpen(!0,!0),this.tree.replace(n),i.push(new Le(this.tree,n)),this.tree=n}if(this.tree.type==="array"){const n=new se(this.tree,e);this.tree.children.push(n),this.parent.setSelection(this.tree),i.push(new si(n,this.tree.children.length-1)),this.tree.setOpen(!0)}else if(this.tree instanceof se||this.tree.children.length===0){const n=new se(this.tree.getParent(),e);this.tree.replace(n),this.parent.setSelection(n.getParent()),this.dispose(),i.push(new Le(this.tree,n))}return new Et(i)}}}class Ae{constructor(e,t){this.parent=e,this.tree=t,t.isValueSelected=!0}getTree(){return this.tree}getLocation(){return this.tree.path.join("/")}dispose(e=!0){this.tree.isValueSelected=!1,e&&this.parent.removeSelection(this)}edit(e){const t=`${this.tree.value}`;return this.tree.edit(e),new hn(this.tree,t)}}const Xn=/^\d+(\.\d+)?$/;function Js(s){let e=s;return typeof s=="boolean"||s==="true"||s==="false"?e=typeof s=="boolean"?s:s==="true":Xn.test(s)?e=Number(s):(s==="null"||s===null)&&(e=null),Xn.lastIndex=0,e}const Wl={string:[],number:["string"],boolean:["string"],null:["string"],integer:["string","number"]};const Ll={name:"TreeTab",mixins:[G],props:{tab:Object,height:Number},data:()=>({keyToAdd:"",valueToAdd:"",pressedShift:!1,triggerCooldown:!1,isUserControlledTrigger:!1}),mounted(){this.treeEditor.receiveContainer(this.$refs.editorContainer)},activated(){this.treeEditor.receiveContainer(this.$refs.editorContainer)},computed:{isUsingBridgePredictions(){var s,e;return(e=(s=b==null?void 0:b.editor)==null?void 0:s.bridgePredictions)!=null?e:!0},fontSize(){return b&&b.appearance&&b.appearance.editorFontSize?`${b.appearance.editorFontSize}`:"14px"},codeFontFamily(){return b&&b.appearance&&b.appearance.editorFont?`${b.appearance.editorFont}, monospace !important`:"Menlo, monospace !important"},fontFamily(){return this.settingsState&&this.settingsState.appearance&&this.settingsState.appearance.font?`${this.settingsState.appearance.font} !important`:"Roboto !important"},treeEditor(){return this.tab.treeEditor},currentValue(){let s;return this.treeEditor.forEachSelection(e=>{if(!e.getTree().parent)return;let t;try{e instanceof Ae?t=e.getTree().value:t=e.getTree().key}catch{}s===void 0?s=t:s!==t&&(s="")}),s},isGlobal(){let s=!1;return this.treeEditor.forEachSelection(e=>{s||e.getTree().parent||(s=!0)}),s},propertySuggestions(){return this.treeEditor.propertySuggestions.map(s=>({...s,text:s.value}))},valueSuggestions(){return this.treeEditor.valueSuggestions.map(s=>({...s,text:s.value}))},editSuggestions(){return this.treeEditor.editSuggestions.map(s=>({...s,text:s.value}))},allSuggestions(){return this.propertySuggestions.concat(this.valueSuggestions)}},methods:{focusEditor(){this.$refs.editorContainer&&this.$refs.editorContainer.focus()},onEdit(s){typeof s!="string"&&(s=s.value),this.treeEditor.edit(`${s}`)},onAdd(s,e=!1){if(this.triggerCooldown||!this.isUserControlledTrigger){this.isUserControlledTrigger||this.$nextTick(()=>{this.keyToAdd="",this.valueToAdd=""}),this.pressedShift=!1;return}if(!s)return this.pressedShift=!1,this.onTriggerCooldown();let t;if(e)this.pressedShift=!0;else if(typeof s=="string"){const a=this.allSuggestions.find(({label:r})=>r===s);if(a)s=a;else{const r=Js(s),o=typeof r=="number"?s.includes(".")?"number":"integer":typeof r,l=this.treeEditor.getSchemaTypes();(l.has(o)||Wl[o].some(d=>{if(l.has(d))return t=d,!0}))&&(this.pressedShift=!0)}}const{type:i=this.pressedShift?"value":"object",value:n=s}=s;this.pressedShift=!1,i==="snippet"?this.treeEditor.addFromJSON(n[1]):i==="object"||i==="array"?this.treeEditor.addKey(n,i):i==="value"||i==="valueArray"?this.treeEditor.addValue(n,i,t):console.error(`Unknown suggestion type: "${i}"`),this.$nextTick(()=>{this.keyToAdd="",this.valueToAdd=""}),this.onTriggerCooldown()},onTriggerCooldown(){this.triggerCooldown||(setTimeout(()=>{this.triggerCooldown=!1},100),this.triggerCooldown=!0)},mayTrigger(s){this.pressedShift=s.shiftKey,!this.isUserControlledTrigger&&(setTimeout(()=>{this.isUserControlledTrigger=!1},100),this.isUserControlledTrigger=!0)},forceValue(){this.$refs.addKeyInput.blur(),this.$nextTick(()=>{this.isUserControlledTrigger=!0,this.onAdd(this.keyToAdd,!0)})},onScroll(s){this.treeEditor.scrollTop=s.target.scrollTop},getIcon(s){switch(s.type){case"object":return"mdi-code-json";case"array":return"mdi-code-brackets";case"value":return"mdi-alphabetical";case"arrayValue":return"mdi-link-variant";case"objectArray":return"mdi-link-variant";case"snippet":return"mdi-attachment";default:return"mdi-text"}}},watch:{"tab.uuid"(){this.treeEditor.receiveContainer(this.$refs.editorContainer)},propertySuggestions(){if(this.isUsingBridgePredictions&&this.propertySuggestions.length>0){this.$refs.addKeyInput.focus();return}!this.$refs.addKeyInput||!this.$refs.addValueInput||!this.$refs.editValueInput||(this.propertySuggestions.length===0&&this.valueSuggestions.length>0?(this.$refs.editValueInput.blur(),this.$refs.addKeyInput.blur(),this.$refs.addValueInput.focus()):this.propertySuggestions.length>0?(this.$refs.editValueInput.blur(),this.$refs.addValueInput.blur(),this.$refs.addKeyInput.focus()):this.treeEditor.selections.some(s=>s.tree instanceof se)&&(this.$refs.addKeyInput.blur(),this.$refs.addValueInput.blur(),this.$refs.editValueInput.focus()))}}};var Nl=function(){var e=this,t=e._self._c;return t("div",{ref:"editorContainer",staticClass:"editor-container",style:{fontSize:e.fontSize,fontFamily:e.codeFontFamily},attrs:{tabindex:"-1"},on:{click:function(i){return e.tab.parent.setActive(!0)}}},[t("div",{staticClass:"pr-4",style:`height: ${e.height-!e.tab.isReadOnly*194}px; overflow: auto;`,on:{blur:e.focusEditor,scroll:e.onScroll,contextmenu:function(i){return i.preventDefault(),i.stopPropagation(),e.tab.treeEditor.onPasteMenu(i)}}},[t(e.tab.treeEditor.tree.component,{tag:"component",attrs:{tree:e.tab.treeEditor.tree,treeEditor:e.tab.treeEditor},on:{setActive:function(i){return e.tab.parent.setActive(!0)}}})],1),e.tab.isReadOnly?e._e():t("v-divider",{staticClass:"mb-4"}),e.tab.isReadOnly?e._e():t("div",{staticClass:"d-flex px-4",style:{fontFamily:e.fontFamily},on:{blur:e.focusEditor}},[t("v-combobox",{ref:"addKeyInput",attrs:{items:e.isUsingBridgePredictions?e.allSuggestions:e.propertySuggestions,"item-value":i=>i,"menu-props":{maxHeight:124,top:!1,contentClass:"json-editor-suggestions-menu",rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},label:e.isUsingBridgePredictions?e.t("editors.treeEditor.add"):e.t("editors.treeEditor.addObject"),outlined:"",dense:"","hide-details":""},on:{change:e.onAdd,keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.mayTrigger.apply(null,arguments)},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"tab",9,i.key,"Tab")?null:e.mayTrigger.apply(null,arguments)}]},scopedSlots:e._u([{key:"item",fn:function({item:i}){return[t("div",{staticStyle:{width:"100%"},on:{click:e.mayTrigger}},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary",small:""}},[e._v(" "+e._s(e.getIcon(i))+" ")]),t("span",{staticStyle:{"font-size":"0.8125rem","font-weight":"500","line-height":"1rem"}},[e._v(" "+e._s(i.label)+" ")])],1)]}}],null,!1,1072492042),model:{value:e.keyToAdd,callback:function(i){e.keyToAdd=i},expression:"keyToAdd"}}),e.isUsingBridgePredictions?t("v-tooltip",{attrs:{color:"tooltip",bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("v-btn",e._g({staticClass:"mx-4",on:{click:e.forceValue}},i),[t("v-icon",[e._v("mdi-alphabetical")])],1)]}}],null,!1,340804505)},[t("span",[e._v(e._s(e.t("editors.treeEditor.forceValue")))])]):t("v-combobox",{ref:"addValueInput",staticClass:"mx-4",attrs:{disabled:e.isGlobal,items:e.valueSuggestions,"item-value":i=>i,"menu-props":{maxHeight:124,top:!1,contentClass:"json-editor-suggestions-menu",rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},label:e.t("editors.treeEditor.addValue"),outlined:"",dense:"","hide-details":""},on:{change:i=>e.onAdd(i,!0),keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.mayTrigger.apply(null,arguments)},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"tab",9,i.key,"Tab")?null:e.mayTrigger.apply(null,arguments)}]},scopedSlots:e._u([{key:"item",fn:function({item:i}){return[t("div",{staticStyle:{width:"100%"},on:{click:e.mayTrigger}},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary",small:""}},[e._v(" "+e._s(e.getIcon(i))+" ")]),t("span",{staticStyle:{"font-size":"0.8125rem","font-weight":"500","line-height":"1rem"}},[e._v(" "+e._s(i.label)+" ")])],1)]}}],null,!1,1072492042),model:{value:e.valueToAdd,callback:function(i){e.valueToAdd=i},expression:"valueToAdd"}}),t("v-combobox",{ref:"editValueInput",attrs:{value:e.currentValue===void 0?void 0:`${e.currentValue}`,disabled:e.isGlobal,items:e.editSuggestions,"item-value":i=>i,"menu-props":{maxHeight:124,top:!1,contentClass:"json-editor-suggestions-menu",rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},label:e.t("editors.treeEditor.edit"),outlined:"",dense:"","hide-details":""},on:{change:i=>e.onEdit(i),keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.mayTrigger.apply(null,arguments)},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"tab",9,i.key,"Tab")?null:e.mayTrigger.apply(null,arguments)}]},scopedSlots:e._u([{key:"item",fn:function({item:i}){return[t("div",{staticStyle:{width:"100%"},on:{click:e.mayTrigger}},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary",small:""}},[e._v(" "+e._s(e.getIcon(i))+" ")]),t("span",{staticStyle:{"font-size":"0.8125rem","font-weight":"500","line-height":"1rem"}},[e._v(" "+e._s(i.label)+" ")])],1)]}}],null,!1,1072492042)})],1)],1)},Bl=[],Vl=_(Ll,Nl,Bl,!1,null,null,null,null);const Hl=Vl.exports,Ul=["Control","Alt","Meta"];class qs{constructor(e=document){c(this,"state",wt({}));c(this,"lastTimeStamp",0);c(this,"onKeydown",e=>{const{key:t,ctrlKey:i,altKey:n,metaKey:a,shiftKey:r}=e;if(Ul.includes(t))return;const o=Ds({key:t,ctrlKey:H()==="darwin"?a:i,altKey:n,metaKey:H()==="darwin"?i:a,shiftKey:r}),l=this.state[o];if(l&&this.lastTimeStamp+100<Date.now()){if(l.prevent(e.target))return;this.lastTimeStamp=Date.now(),e.preventDefault(),e.stopImmediatePropagation(),l.trigger()}});c(this,"onMouseDown",e=>{let t=null;switch(e.button){case 0:t="Left";break;case 1:t="Middle";break;case 2:t="Right";break;case 3:t="Back";break;case 4:t="Forward";break;default:console.error(`Unknown mouse button: ${e.button}`)}!t||this.onKeydown({key:`mouse${t}`,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,shiftKey:e.shiftKey,target:e.target,preventDefault:()=>e.preventDefault(),stopImmediatePropagation:()=>e.stopImmediatePropagation()})});this.element=e,e.addEventListener("keydown",this.onKeydown),e.addEventListener("mousedown",this.onMouseDown)}create(e){const t=new Ms(this,e),i=t.toStrKeyCode();if(this.state[i])throw new Error(`KeyBinding with keyCode "${i}" already exists!`);return U(this.state,i,t),t}disposeKeyBinding(e){Se(this.state,e)}dispose(){this.element.removeEventListener("keydown",this.onKeydown)}}class re{constructor(e,t,i){c(this,"schemaType");this.location=e,this.key=t,this.value=i}validate(e){return[]}isValid(e){return this.validate(e).length===0}}class Gs extends re{constructor(t,i,n){super(t,i,n);c(this,"schemaType","ifSchema");c(this,"rootSchema");c(this,"types",[]);typeof n!="boolean"&&(this.rootSchema=new oe(this.location,"if",n))}getSchemasFor(){return[]}getCompletionItems(){return[]}validate(){return[]}isTrue(t){var i;return typeof this.value=="boolean"?this.value:(i=this.rootSchema)==null?void 0:i.isValid(t)}}class Ks extends re{constructor(t,i,n){if(typeof n!="boolean")throw new Error(`[${t}] Type of "doNotSuggest" must be boolean, found ${typeof n}`);super(t,i,n);c(this,"types",[])}getSchemasFor(){return[]}getCompletionItems(){return[]}validate(){return[]}}class vt extends re{get types(){return this.children.map(e=>e.types).flat()}get hasDoNotSuggest(){return this.children.some(e=>e instanceof Ks)}getCompletionItems(e){return this.hasDoNotSuggest?[]:this.children.map(t=>t.getCompletionItems(e)).flat()}getSchemasFor(e,t){return this.children.map(i=>i.getSchemasFor(e,[...t])).flat()}getFlatChildren(){const e=[];for(const t of this.children)t instanceof vt?e.push(...t.getFlatChildren()):e.push(t);return e}}class Ys extends re{constructor(t,i,n){super(t,i,n);c(this,"ifSchema");c(this,"rootSchema");this.rootSchema=new oe(this.location,"then",n)}get types(){return this.ifSchema.isTrue(this.value)?this.rootSchema.types:[]}receiveIfSchema(t){this.ifSchema=t}getSchemasFor(t,i){return this.ifSchema.isTrue(t)?this.rootSchema.getSchemasFor(t,[...i]):[]}getCompletionItems(t){return this.ifSchema.isTrue(t)?this.rootSchema.getCompletionItems(t):[]}validate(t){return this.ifSchema.isTrue(t)?this.rootSchema.validate(t):[]}}class oe extends vt{constructor(t,i,n){super(t,i,n);c(this,"children");(i==="$global"||i==="$ref")&&je.addRootSchema(t,this),this.children=je.createSchemas(this.location,n)}validate(t){return this.children.map(i=>i.validate(t)).flat()}getFreeIfSchema(){let t=!1;for(const i of this.getFlatChildren().reverse())if(i instanceof Ys)t=!0;else if(i instanceof Gs)if(t)t=!1;else return i}}class zl extends re{constructor(t,i,n){super(t,i,n);c(this,"rootSchema");c(this,"types",[]);typeof n=="object"&&(this.rootSchema=new oe(t,i,n))}validate(t){var i,n;return(n=(i=this.rootSchema)==null?void 0:i.validate(t))!=null?n:[]}getCompletionItems(t){return[]}getSchemasFor(t,i){var a,r;if(i.length===0)return[];if(i.length===1)return this.rootSchema?[this.rootSchema]:[];const n=i.shift();return Array.isArray(t[n])?[]:(r=(a=this.rootSchema)==null?void 0:a.getSchemasFor(t[n],i))!=null?r:[]}}class Jl extends vt{constructor(t,i,n){super(t,i,n);c(this,"children");if(!Array.isArray(n))throw new Error(`"allOf" schema must be of type array, found "${typeof n}"`);this.children=n.map(a=>new oe(this.location,"allOf",a))}validate(t){return this.children.map(i=>i.validate(t)).flat()}}class ql extends vt{constructor(t,i,n){super(t,i,n);c(this,"children");if(!Array.isArray(n))throw new Error(`"anyOf" schema must be of type array, found "${typeof n}"`);this.children=n.map(a=>new oe(this.location,"anyOf",a))}validate(t){const i=[];for(const n of this.children){const a=n.validate(t);if(a.length===0)return[];i.push(...a)}return i}}class Qs extends re{constructor(){super(...arguments);c(this,"types",[])}getSchemasFor(){return[]}getCompletionItems(){return[{type:"value",label:`${this.value}`,value:this.value}]}validate(t){return this.value!==t?[{message:`Found ${t}; expected ${this.value}`}]:[]}}class Gl extends re{constructor(){super(...arguments);c(this,"types",[])}getSchemasFor(){return[]}getCompletionItems(){return typeof this.value!="object"&&!Array.isArray(this.value)?[{type:"value",label:`${this.value}`,value:this.value}]:[]}}class Kl extends re{constructor(t,i,n){super(t,i,n);c(this,"ifSchema");c(this,"rootSchema");this.rootSchema=new oe(this.location,"else",n)}get types(){return this.ifSchema.isTrue(this.value)?[]:this.rootSchema.types}receiveIfSchema(t){this.ifSchema=t}getSchemasFor(t,i){return this.ifSchema.isTrue(t)?[]:this.rootSchema.getSchemasFor(t,[...i])}getCompletionItems(t){return this.ifSchema.isTrue(t)?[]:this.rootSchema.getCompletionItems(t)}validate(t){return this.ifSchema.isTrue(t)?[]:this.rootSchema.validate(t)}}class Yl extends re{constructor(t,i,n){super(t,i,n);c(this,"types",[]);if(!Array.isArray(n))throw new Error(`Enum must be of type array; found ${typeof n}`)}getSchemasFor(){return[]}getCompletionItems(){return this.value.map(t=>({type:"value",label:`${t}`,value:t}))}validate(t){return this.value.includes(t)?[]:[{message:`Found ${t}; expected one of ${this.value.join(", ")}`}]}}class Ql extends re{constructor(t,i,n){super(t,i,n);c(this,"children");if(typeof n!="object"&&typeof n<"u")throw new Error(`Invalid usage of "properties" schema field. Expected type "object", received "${typeof n}"`);Array.isArray(n)?this.children=n.map(a=>new oe(this.location,"items",a)):this.children=new oe(this.location,"items",n)}get types(){return["array"]}get arrayChildren(){return Array.isArray(this.children)?this.children:[this.children]}getSchemasFor(t,i){var a,r;const n=i.shift();return typeof n=="string"?[]:n===void 0?this.arrayChildren:i.length===0?Array.isArray(this.children)?this.children[n]?[this.children[n]]:[]:[this.children]:Array.isArray(this.children)?(r=(a=this.children[n])==null?void 0:a.getSchemasFor(t[n],[...i]))!=null?r:[]:this.children.getSchemasFor(t[n],[...i])}getCompletionItems(t){return this.arrayChildren.filter(i=>!i.hasDoNotSuggest).map(i=>i.getCompletionItems(t).map(n=>({type:n.type==="object"?"objectArray":"valueArray",label:`${n.value}`,value:n.value}))).flat()}validate(t){return[]}}class Zl extends re{constructor(t,i,n){super(t,i,n);c(this,"rootSchema");c(this,"types",[]);if(typeof n!="object")throw new Error(`[${t}] Type of "not" must be object, found ${typeof n}`);this.rootSchema=new oe(this.location,"not",n)}getSchemasFor(){return[]}getCompletionItems(){return[]}validate(t){return[]}isValid(t){return this.rootSchema.validate(t).length>0}}class Xl extends vt{constructor(t,i,n){super(t,i,n);c(this,"children");if(!Array.isArray(n))throw new Error(`"oneOf" schema must be of type array, found "${typeof n}"`);this.children=n.map(a=>new oe(this.location,"oneOf",a))}validate(t){const i=[];let n=!1,a=!1;for(const r of this.children){const o=r.validate(t);o.length===0&&(n&&(a=!0),n=!0),i.push(...o)}return a?[{message:"JSON matched more than one schema, expected exactly one match"}]:n?[]:i}}class ed extends re{constructor(t,i,n){super(t,i,n);c(this,"children",{});if(typeof n!="object"&&typeof n<"u")throw new Error(`Invalid usage of "properties" schema field. Expected type "object", received "${typeof n}"`);this.children=Object.fromEntries(Object.entries(n!=null?n:{}).map(([a,r])=>[a,new oe(this.location,a,r)]))}get types(){return["object"]}getSchemasFor(t,i){const n=i.shift();let a=[];if(typeof n=="number"||n===void 0)return a;if(Array.isArray(t[n]))return[];for(const[r,o]of Object.entries(this.children))n.match(new RegExp(r))!==null&&a.push(o);return i.length===0?a:a.map(r=>r.getSchemasFor(t[n],[...i])).flat()}getCompletionItems(){return[]}validate(t){if(typeof t!="object"||Array.isArray(t))return[{message:`Invalid type: Expected "object", received "${Array.isArray(t)?"array":typeof t}"`}];const i=[];for(const n in t)for(const[a,r]of Object.entries(this.children))n.match(new RegExp(a))===null&&i.push(...r.validate(t[n]));return i}}class td extends re{constructor(t,i,n){super(t,i,n);c(this,"children",{});if(typeof n!="object"&&typeof n<"u")throw new Error(`[${this.location}] Invalid usage of "properties" schema field. Expected type "object", received "${typeof n}"`);this.children=Object.fromEntries(Object.entries(n!=null?n:{}).map(([a,r])=>[a,new oe(this.location,a,r)]))}get types(){return["object"]}getSchemasFor(t,i){var a,r;const n=i.shift();return n===void 0?Object.values(this.children):i.length===0?this.children[n]?[this.children[n]]:[]:(r=(a=this.children[n])==null?void 0:a.getSchemasFor(t[n],[...i]))!=null?r:[]}getCompletionItems(t){const i=Object.keys(typeof t=="object"?t!=null?t:{}:{});return Object.entries(this.children).filter(([n,a])=>!i.includes(n)&&!a.hasDoNotSuggest).map(([n,a])=>{const r=new Set(a.types),o=[],l=r.has("array");return l&&o.push({type:"array",label:`${n}`,value:n}),(!l||r.size>1)&&o.push({type:"object",label:`${n}`,value:n}),o}).flat()}validate(t){if(typeof t!="object"||Array.isArray(t))return[{message:`Invalid type: Expected "object", received "${Array.isArray(t)?"array":typeof t}"`}];const i=[];for(const n in t)this.children[n]&&i.push(...this.children[n].validate(t[n]));return i}}class id extends re{constructor(t,i,n){super(t,i,n);c(this,"rootSchema");c(this,"types",[]);this.rootSchema=new oe(this.location,"propertyNames",n)}getSchemasFor(){return[]}getCompletionItems(t){return this.rootSchema.getCompletionItems(t).filter(i=>i.type==="value").map(i=>({type:"object",label:`${i.value}`,value:i.value}))}validate(){return[]}isTrue(t){return this.rootSchema.isValid(t)}}class Ft extends re{constructor(t,i,n){var a,r;super(t,i,n);c(this,"schemaType","refSchema");c(this,"rootSchema");if(typeof n!="string")throw new Error(`Invalid $ref type "${typeof n}": ${JSON.stringify(n)}`);if(n.startsWith("#")){const o=this.location.split("#/")[0],l=n==="#"?o:`${o}${n}`;this.rootSchema=(a=je.requestRootSchema(l))!=null?a:new oe(l,"$ref",je.request(o,n==="#"?void 0:n.replace("#/","")))}else{const o=this.location.includes("#/")?ve(this.location.split("#/")[0]):ve(this.location);let l;n.startsWith("/")?l=`file://${n}`:l=Be(o,n).replace("file:/","file:///");let d;l.includes("#/")&&([l,d]=l.split("#/")),this.location=l,this.rootSchema=(r=je.requestRootSchema(d?`${l}#/${d}`:l))!=null?r:new oe(d?`${l}#/${d}`:l,"$ref",je.request(this.location,d))}}get types(){return this.rootSchema.types}getCompletionItems(t){return this.rootSchema.getCompletionItems(t)}validate(t){return this.rootSchema.validate(t)}getSchemasFor(t,i){return this.rootSchema.getSchemasFor(t,[...i])}getFreeIfSchema(){return this.rootSchema.getFreeIfSchema()}}class nd extends re{constructor(){super(...arguments);c(this,"types",[])}getSchemasFor(){return[]}getCompletionItems(){return[]}validate(t){const i=Array.isArray(this.value)?this.value:[this.value];if(typeof t!="object"||Array.isArray(t))return[{message:`Required properties missing: ${i.join(", ")}`}];for(const n of i)if(t[n]===void 0||t[n]===null)return[{message:`Missing required property: ${n}`}];return[]}}function es(s){return Array.isArray(s)?"array":typeof s}class sd extends re{get values(){return Array.isArray(this.value)?this.value:[this.value]}get types(){return this.values}getSchemasFor(){return[]}getCompletionItems(){const e=[];return this.values.includes("boolean")&&e.push(...[!0,!1].map(t=>({type:"value",label:`${t}`,value:t}))),this.values.includes("integer")&&e.push(...[0,1,2,3,4,5,6,7,8,9].map(t=>({type:"value",label:`${t}`,value:t}))),this.values.includes("number")&&e.push(...[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1].map(t=>({type:"value",label:`${t}`,value:t}))),this.values.includes("null")&&e.push({type:"value",label:"null",value:null}),e}validate(e){const t=Array.isArray(this.value)?this.value:[this.value];return t.includes(es(e))?[]:[{message:`Invalid type: Found ${es(e)}; expected ${t.join(", ")}`}]}}const ts=new Map([["$ref",Ft],["additionalProperties",zl],["allOf",Jl],["anyOf",ql],["const",Qs],["enum",Yl],["if",Gs],["items",Ql],["oneOf",Xl],["patternProperties",ed],["properties",td],["propertyNames",id],["required",nd],["then",Ys],["type",sd],["default",Gl],["else",Kl],["doNotSuggest",Ks],["not",Zl]]),ad=new Set(["$schema","$id","description","title","definitions","pattern","min","max","maxItems","minItems","deprecationMessage","examples","minimum","maximum","format","maxLength","multipleOf"]);class je{static setJSONDefaults(e){this.lib=e,this.rootSchemas.clear()}static request(e,t){const i=this.lib[e];if(!i)return console.warn(`Couldn't find schema for "${e}"${t?`(#${t})`:""}`),{};if(t){let n;return mi(t,i.schema,a=>n=a),n===void 0&&console.error(`Couldn't find hash ${t} @ ${e}`),n!=null?n:{}}else return i.schema}static addRootSchema(e,t){return this.rootSchemas.set(e,t),t}static requestRootSchema(e){return this.rootSchemas.get(e)}static createSchemas(e,t){if(typeof t!="object")return console.warn(`Unexpected schema type "${typeof t}" @ ${e}`),[new Qs(e,"",t)];let i=[];for(const[n,a]of Object.entries(t)){if(a===void 0)continue;const r=ts.get(n);if(r===void 0){if(ad.has(n))continue;console.warn(`Schema field not implemented: <${n}, ${a}> @ ${e}`);continue}const o=new r(e,n,a);if(n==="then"||n==="else"){let d=i.reverse().map(p=>{if(p.schemaType==="ifSchema")return p;if(p.schemaType==="refSchema")return p.getFreeIfSchema()}).filter(p=>p!==void 0)[0];d||(console.warn(`"${n}" schema without "if" @ ${e}`),d=new(ts.get("if"))(e,"if",!0)),o.receiveIfSchema(d)}i.push(o)}return i}}c(je,"lib",{}),c(je,"rootSchemas",new Map);class rd extends z{constructor(t){super();c(this,"changed",new z);c(this,"undoStack",[]);c(this,"redoStack",[]);c(this,"lastUndoLength",0);this.parent=t}get length(){return this.undoStack.length}updateHasChanges(){this.dispatch(this.undoStack.length!==this.lastUndoLength)}saveState(){this.lastUndoLength=this.undoStack.length,this.updateHasChanges()}undo(){const t=this.undoStack.pop();!t||(t.unselectTrees.forEach(i=>this.parent.removeSelectionOf(i)),this.redoStack.push(t.undo()),this.updateHasChanges(),this.changed.dispatch())}redo(){const t=this.redoStack.pop();!t||(t.unselectTrees.forEach(i=>this.parent.removeSelectionOf(i)),this.undoStack.push(t.undo()),this.updateHasChanges(),this.changed.dispatch())}push(t){this.undoStack.push(t),this.redoStack=[],this.updateHasChanges(),this.changed.dispatch()}pushAll(t){t.length!==0&&(t.length===1?this.push(t[0]):this.push(new Et(t)))}}const Zs=H()==="darwin"?"Ctrl + Shift + Z":"Ctrl + Y";function od(s){return`t-${s.type}:v-${s.value}`}function Ut(s){const e=new Set;return s.filter(t=>{const i=od(t),n=!e.has(i);return e.add(i),n})}class cd{constructor(e,t){c(this,"propertySuggestions",[]);c(this,"valueSuggestions",[]);c(this,"editSuggestions",[]);c(this,"tree");c(this,"selections",[]);c(this,"_keyBindings");c(this,"_actions");c(this,"history",new rd(this));c(this,"schemaRoot");c(this,"selectionChange",new z);c(this,"containerElement");c(this,"scrollTop",0);c(this,"updateSuggestions",He(async()=>{var a,r;const e=this.tree.toJSON().format_version||this.parent.project.config.get().targetVersion||await it(),{tree:t,isValueSelection:i}=this.getSelectedTree(),n=this.getSuggestions(t);this.propertySuggestions=Ut(n.filter(o=>{var l;return["object","array"].includes(o.type)&&!((l=(t!=null?t:this.tree).children)!=null&&l.find(d=>d.type==="array"?!1:d[0]===o.value))}).concat(this.parent.app.project.snippetLoader.getSnippetsFor(e,this.parent.getFileType(),this.selections.map(o=>o.getLocation())).map(o=>({type:"snippet",label:o.displayData.name,value:o.insertData})))),t instanceof be&&((a=t==null?void 0:t.children)==null?void 0:a.length)===0||t instanceof pe||t instanceof se&&t.isEmpty()?this.valueSuggestions=Ut(n.filter(o=>o.type==="value"||o.type==="valueArray")):this.valueSuggestions=[],this.editSuggestions=[],i&&t instanceof se&&(this.editSuggestions=Ut(n.filter(o=>o.type==="value"))),t instanceof be&&(this.editSuggestions=Ut(this.getSuggestions((r=t.getParent())!=null?r:void 0).filter(o=>o.type==="object")))},50));this.parent=e,this.json=t,this.tree=ai(null,t),this.setSelection(this.tree),this.history.on(i=>{this.parent.setIsUnsaved(i)}),this.history.changed.on(()=>{this.propertySuggestions=[],this.valueSuggestions=[],this.parent.updateCache(),this.parent.fileDidChange()}),u.getApp().then(async i=>{await i.projectManager.projectReady.fired,this.parent.once(()=>{i.project.jsonDefaults.isReady&&this.createSchemaRoot()}),i.project.jsonDefaults.on(()=>{this.parent.hasFired&&this.createSchemaRoot()})}),this.selectionChange.on(()=>this.updateSuggestions())}get keyBindings(){if(!this._keyBindings)throw new Error("Cannot access keyBindings before they were initialized.");return this._keyBindings}get actions(){if(!this._actions)throw new Error("Cannot access keyBindings before they were initialized.");return this._actions}createSchemaRoot(){var t;const e=(t=u.fileType.get(this.parent.getPath()))==null?void 0:t.schema;e&&(this.schemaRoot=je.addRootSchema(e,new oe(e,"$global",je.request(e)))),this.updateSuggestions()}getSchemas(e,t=!1){var i,n;return this.selections.length===0||e===this.tree?this.schemaRoot?[this.schemaRoot]:[]:e?(n=(i=this.schemaRoot)==null?void 0:i.getSchemasFor(this.tree.toJSON(),t?[...e.path,void 0]:e.path))!=null?n:[]:[]}getSuggestions(e){const t=e==null?void 0:e.toJSON();return this.getSchemas(e).filter(n=>n!==void 0).map(n=>n.getCompletionItems(t)).flat()}getSchemaTypes(e){const{tree:t,isValueSelection:i}=this.getSelectedTree();if(i)return new Set;e===void 0&&(e=t instanceof pe);const n=this.getSchemas(t,e);return n.length===0?new Set:new Set(n.reduce((a,r)=>a.concat(r.types),[]))}getSelectedTree(){if(this.selections.length===0)return{tree:this.tree,isValueSelection:!1};const e=this.selections[0];return{tree:e==null?void 0:e.getTree(),isValueSelection:e instanceof Ae}}receiveContainer(e){var t,i;(t=this._keyBindings)==null||t.dispose(),(i=this._actions)==null||i.dispose(),this._keyBindings=new qs(e),this._actions=new Rt(this._keyBindings),this.containerElement=e,this.actions.create({keyBinding:["Ctrl + DELETE","Ctrl + BACKSPACE"],onTrigger:()=>{const n=[];this.forEachSelection(a=>{const r=a.getTree();if(!!r.getParent())if(a.dispose(),a instanceof Ae&&r.getParent().type==="object"){const o=new be(r.getParent(),{});this.setSelection(o),r.replace(o),n.push(new Le(r,o))}else{this.toggleSelection(r.getParent());const[o,l]=r.delete();n.push(new Hi(r,o,l))}}),this.history.pushAll(n)}}),this.actions.create({keyBinding:["ESCAPE"],onTrigger:()=>{this.setSelection(this.tree)}}),this.actions.create({keyBinding:["CTRL + Z"],onTrigger:()=>{this.undo()}}),this.actions.create({keyBinding:[Zs],onTrigger:()=>{this.redo()}})}deactivate(){var e,t;(e=this._keyBindings)==null||e.dispose(),(t=this._actions)==null||t.dispose()}activate(){!this.containerElement||(this.receiveContainer(this.containerElement),this.containerElement.children[0].scrollTop=this.scrollTop)}saveState(){this.history.saveState()}toJSON(){return this.tree.toJSON()}toJsonString(e=!1){return JSON.stringify(this.toJSON(),null,e?"	":void 0).replaceAll("\\\\","\\")}forEachSelection(e){this.selections.forEach(e)}removeSelection(e){this.selections=this.selections.filter(t=>e!==t),this.selectionChange.dispatch()}removeSelectionOf(e){this.selections=this.selections.filter(t=>{const i=t.getTree();return i!==e&&(e instanceof se||!e.hasChild(i))?!0:(t.dispose(!1),!1)}),this.selectionChange.dispatch()}setSelection(e,t=!1){this.selections.forEach(i=>i.dispose(!1)),this.selections=[t&&e instanceof se?new Ae(this,e):new Zn(this,e)],this.selectionChange.dispatch()}toggleSelection(e,t=!1){let i=!1;this.selections=this.selections.filter(n=>n.getTree()!==e||n instanceof Ae!==t?!0:(n.dispose(!1),i=!0,!1)),i||this.selections.push(t&&e instanceof se?new Ae(this,e):new Zn(this,e)),this.selectionChange.dispatch()}addKey(e,t){const i=[];this.forEachSelection(n=>{if(n instanceof Ae)return;const a=n.addKey(e,t);a&&i.push(a)}),this.history.pushAll(i)}addValue(e,t,i){let n=Js(e);i&&(i==="string"?n=e:i==="integer"?n=parseInt(e):i==="number"?n=parseFloat(e):i==="boolean"?n=e==="true":i==="null"&&(n=null));const a=[];this.forEachSelection(r=>{if(r instanceof Ae)return;const o=r.addValue(n,t);o&&a.push(o)}),this.history.pushAll(a)}addFromJSON(e){if(typeof e!="object")return;let t=[];this.forEachSelection(i=>{if(i instanceof Ae)return;const n=i.getTree();if(n instanceof se)return;const a=n.children.length;for(const r in e){const o=ai(n,e[r]);n instanceof be?n.addChild(r,o):n.addChild(o),t.push(new si(o,a,n instanceof be?r:void 0))}}),this.history.pushAll(t)}edit(e){const t=[];this.forEachSelection(i=>{const n=i.edit(e);n&&t.push(n)}),this.history.pushAll(t)}delete(e){this.removeSelectionOf(e);const[t,i]=e.delete();this.history.push(new Hi(e,t,i))}objectValueDeletion(e){this.removeSelectionOf(e);const t=new be(e.getParent(),{});e.replace(t),this.history.push(new Le(e,t))}onPasteMenu(e,t=this.tree){const i=[{name:"actions.paste.name",icon:"mdi-content-paste",onTrigger:()=>{this.setSelection(t),this.parent.paste()}}];return e&&!this.parent.isReadOnly&&De(e,i,!1),i}onReadOnlyMenu(e,t=this.tree,i=!0){const n=[{name:"actions.documentationLookup.name",icon:"mdi-book-open-outline",onTrigger:()=>{const a=i?t.key:t.value;typeof a=="string"&&Ws(this.parent.getPath(),a)}},{name:"actions.copy.name",icon:"mdi-content-copy",onTrigger:()=>{this.setSelection(t,!i),this.parent.copy()}}];return e&&De(e,n,!1),n}onContextMenu(e,t,i=!0){if(this.parent.isReadOnly)return this.onReadOnlyMenu(e,t,i);const[n,a]=this.onReadOnlyMenu(void 0,t,i),r=[n];t instanceof se?r.push({name:"general.delete",icon:"mdi-delete-outline",onTrigger:()=>{t.getParent().type==="object"&&!i?this.objectValueDeletion(t):this.delete(t)}}):r.push({name:"general.delete",icon:"mdi-delete-outline",onTrigger:()=>{this.delete(t)}}),r.push(a,{name:"actions.cut.name",icon:"mdi-content-cut",onTrigger:()=>{this.setSelection(t,!i),this.parent.cut()}},...t instanceof se?[]:this.onPasteMenu(void 0,t)),!(t instanceof se)&&t.children.length===0&&r.push({name:t instanceof pe?"actions.toObject.name":"actions.toArray.name",icon:t instanceof pe?"mdi-code-braces-box":"mdi-code-array",onTrigger:()=>{if(this.removeSelectionOf(t),t instanceof pe){const o=new be(t.getParent(),{});t.replace(o),this.history.push(new Le(t,o))}else{const o=new pe(t.getParent(),[]);t.replace(o),this.history.push(new Le(t,o))}}}),De(e,r,!1)}undo(){this.history.undo()}redo(){this.history.redo()}}const ld=He(async s=>{const e=s.treeEditor.toJsonString(),t=await u.getApp();t.project.fileChange.dispatch(s.getPath(),await s.getFile()),await t.project.packIndexer.updateFile(s.getPath(),e,s.isForeignFile,!0),await t.project.jsonDefaults.updateDynamicSchemas(s.getPath())},600);class Mt extends W{constructor(t,i,n){super(t,i,n);c(this,"component",Hl);c(this,"_treeEditor");this.fired.then(async()=>{const a=await u.getApp();await a.projectManager.projectReady.fired,a.project.tabActionProvider.addTabActions(this)})}get app(){return this.parent.app}get project(){return this.parent.project}static is(t){var i;return((i=b==null?void 0:b.editor)==null?void 0:i.jsonEditor)==="treeEditor"&&t.name.endsWith(".json")}get treeEditor(){if(!this._treeEditor)throw new Error("Trying to access TreeEditor before it was setup.");return this._treeEditor}async setup(){let t;try{const i=await this.fileHandle.getFile().then(n=>n.text());i===""?t={}:t=L.parse(i.replaceAll("\\n","\\\\n"))}catch{new J({name:"windows.invalidJson.title",description:"windows.invalidJson.description"}),this.close();return}this._treeEditor=new cd(this,t),await super.setup()}async getFile(){return new File([this.treeEditor.toJsonString()],this.name)}updateCache(){ld(this)}async onActivate(){this.treeEditor.activate()}async onDeactivate(){var t;await super.onDeactivate(),(t=this._treeEditor)==null||t.deactivate()}loadEditor(){}setReadOnly(t){this.readOnlyMode=t}async _save(){this.isTemporary=!1;const t=this.treeEditor.toJsonString(!0);await this.writeFile(t)&&this.treeEditor.saveState()}async paste(){if(this.isReadOnly)return;const t=await navigator.clipboard.readText();let i;try{i=L.parse(t)}catch{try{i=L.parse(`{${t}}`)}catch{return}}i!==void 0&&this.treeEditor.addFromJSON(i)}async copy(){let t="";this.treeEditor.forEachSelection(i=>{const n=i.getTree();i instanceof Ae?n.isValueSelected?t+=n.toJSON():t+=n.key:t+=`"${n.key}": ${JSON.stringify(i.getTree().toJSON(),null,"	")}`}),t!==""&&await navigator.clipboard.writeText(t)}async cut(){this.isReadOnly||(await this.copy(),this.treeEditor.forEachSelection(t=>this.treeEditor.delete(t.getTree())))}async close(){const t=await super.close();if(!this.isForeignFile&&t&&this.isUnsaved)if(this.isForeignFile)await this.app.fileSystem.unlink(this.getPath());else{const n=await(await this.fileHandle.getFile()).text();await this.project.packIndexer.updateFile(this.getPath(),n)}return t}}class wn{static get tabs(){return[...this._tabs].reverse()}static register(e){return this._tabs.add(e),{dispose:()=>this._tabs.delete(e)}}}c(wn,"_tabs",new Set([ht,Mt,Vs,ll,vl]));class is extends nl{constructor(t,i=0){super(t.app);c(this,"uuid",E());c(this,"tabs",F([]));c(this,"_selectedTab",F(void 0));c(this,"_isActive",!0);c(this,"openedFiles");c(this,"shouldRender",B(()=>this.tabs.value.length>0));c(this,"isSharingScreen",B(()=>{var i;const t=this.project.tabSystems.find(n=>n!==this);return(i=t==null?void 0:t.shouldRender.value)!=null?i:!1}));this._project=t,this.openedFiles=new Vc(this,t.app,`${t.projectPath}/.bridge/openedFiles_${i}.json`)}get tabTypes(){return wn.tabs}get isActive(){return this._isActive}get app(){return this._app}get project(){return this._project}get hasUnsavedTabs(){return this.tabs.value.some(t=>t.isUnsaved)}get selectedTab(){return this._selectedTab.value}get currentComponent(){var t,i;return(i=(t=this._selectedTab.value)==null?void 0:t.component)!=null?i:Es}get projectRoot(){return this.project.baseDirectory}get projectName(){return this.project.name}async open(t,{selectTab:i=!0,readOnlyMode:n="off",isTemporary:a=!0}={}){const r=await this.getTabFor(t,n);return a||(r.isTemporary=!1),await this.add(r,i),r}async openPath(t,i={}){const n=await this.project.app.fileSystem.getFileHandle(t);return await this.open(n,i)}async getTabFor(t,i="off"){let n;for(const a of this.tabTypes)if(await a.is(t)){n=new a(this,t,i);break}return n||(n=new ht(this,t,i)),await n.fired}async hasTab(t){for(const i of this.tabs.value)if(await i.is(t))return!0;return!1}async add(t,i=!0,n=!1){if(this.closeAllTemporary(),!n){for(const a of this.tabs.value)if(await a.is(t))return t.onDeactivate(),i?a.select():a}return t.hasFired||await t.fired,this.tabs.value=[...this.tabs.value,t],!t.isForeignFile&&!(t instanceof W&&t.isReadOnly)&&await this.openedFiles.add(t.getPath()),i&&t.select(),this.project.updateTabFolders(),t}remove(t,i=!0,n=!0){t.onDeactivate();const a=this.tabs.value.findIndex(r=>r===t);if(a!==-1)return this.tabs.value.splice(a,1),i&&t.onDestroy(),n&&t===this.selectedTab&&this.select(this.tabs.value[a===0?0:a-1]),t.isForeignFile||this.openedFiles.remove(t.getPath()),this.project.updateTabFolders(),t}async close(t=this.selectedTab,i=!0){return t?i&&t.isUnsaved?await new Nc(t).fired!=="cancel":(this.remove(t),!0):!1}async closeTabWithHandle(t){const i=await this.getTab(t);i&&this.close(i)}async selectNextTab(){var r;const t=this.tabs.value;if(t.length===0)return;const i=this.selectedTab;if(!i)return;const n=t.indexOf(i);await((r=t[n+1])!=null?r:t[0]).select()}async selectPreviousTab(){var r;const t=this.tabs.value;if(t.length===0)return;const i=this.selectedTab;if(!i)return;const n=t.indexOf(i);await((r=t[n-1])!=null?r:t[t.length-1]).select()}async select(t){var i,n;this.isActive!==!!t&&this.setActive(!!t),this.app.mobile.isCurrentDevice()&&u.sidebar.hide(),!(t!=null&&t.isSelected)&&((i=this.selectedTab)==null||i.onDeactivate(),t&&t!==this.selectedTab&&this.project.isActiveProject&&u.eventSystem.dispatch("currentTabSwitched",t),this._selectedTab.value=t,t&&(await((n=this.selectedTab)==null?void 0:n.onActivate()),Ve.nextTick(async()=>{var a;(a=this._monacoEditor)==null||a.layout()})))}async save(t=this.selectedTab){if(!t||t instanceof W&&t.isReadOnly)return;t==null||t.setIsLoading(!0);const i=this.selectedTab===t,n=this.selectedTab;n!==t&&await this.select(t),t instanceof W&&await t.save(),n!==t&&await this.select(n),!t.isForeignFile&&t instanceof W&&(await this.project.updateFile(t.getPath()),this.project.fileSave.dispatch(t.getPath(),await t.getFile()),i&&u.eventSystem.dispatch("refreshCurrentContext",t.getPath())),t.focus(),t==null||t.setIsLoading(!1)}async saveAs(){this.selectedTab instanceof W&&await this.selectedTab.saveAs()}async saveAll(){const t=await u.getApp();t.windows.loadingWindow.open();for(const i of this.tabs.value)i.isUnsaved&&await this.save(i);t.windows.loadingWindow.close()}closeAllTemporary(){for(const t of[...this.tabs.value])!t.isTemporary||this.remove(t,!0,!1)}async activate(){var t;await this.openedFiles.restoreTabs(),this.tabs.value.length>0&&this.setActive(!0),!this.selectedTab&&this.tabs.value.length>0&&this.tabs.value[0].select(),await((t=this.selectedTab)==null?void 0:t.onActivate())}deactivate(){var t;(t=this.selectedTab)==null||t.onDeactivate(),this.dispose()}setActive(t,i=!0){i&&this.project.setActiveTabSystem(this,!t),t!==this._isActive&&(this._isActive=t,t&&this._selectedTab&&this.project.isActiveProject&&u.eventSystem.dispatch("currentTabSwitched",this._selectedTab))}async getTab(t){for(const i of this.tabs.value)if(i instanceof W&&await i.isForFileHandle(t))return i}closeTabs(t){const i=[...this.tabs.value].reverse();for(const n of i)t(n)&&n.close()}forceCloseTabs(t){const i=[...this.tabs.value].reverse();for(const n of i)t(n)&&this.remove(n)}has(t){for(const i of this.tabs.value)if(t(i))return!0;return!0}get(t){for(const i of this.tabs.value)if(t(i))return i}}class dd extends tr{constructor(e,t,i){super(t),this.fileSystem=e,this.project=i,i&&i.fileSave.on(this.resolvePackPath(void 0,"config.json"),()=>{this.refreshConfig(),this.project.app.windows.createPreset.onPresetsChanged(),this.project.compilerService.reloadPlugins()})}readConfig(){return this.fileSystem.readJSON("config.json").catch(()=>({}))}async writeConfig(e){await this.fileSystem.writeJSON("config.json",e,!0)}async setup(e=!0){var n,a,r,o,l,d,p;if(e&&await this.fileSystem.fileExists(".bridge/config.json")){const{darkTheme:h,lightTheme:m,gameTestAPI:f,scriptingAPI:g,prefix:w,...y}=await this.fileSystem.readJSON(".bridge/config.json");await this.fileSystem.unlink(".bridge/config.json");const S={};f&&(S.enableGameTestFramework=!0),g&&(S.additionalModdingCapabilities=!0);const v={type:"minecraftBedrock",name:this.fileSystem.baseDirectory.name,namespace:w,experimentalGameplay:S,...y,authors:y.author?[y.author]:["Unknown"],packs:Ot,bridge:{darkTheme:h,lightTheme:m}};await this.fileSystem.writeJSON("config.json",v,!0),this.data=v;return}await super.setup();const t=(a=(n=this.data.bridge)==null?void 0:n.formatVersion)!=null?a:0;this.data.bridge||(this.data.bridge={});let i=!1;if(e&&this.project&&this.data.capabilities){const h=await this.project.app.dataLoader.readJSON("data/packages/minecraftBedrock/experimentalGameplay.json"),m=(r=this.data.experimentalGameplay)!=null?r:{},f=(o=this.data.capabilities)!=null?o:[];m.enableGameTestFramework=f.includes("gameTestAPI"),m.additionalModdingCapabilities=f.includes("scriptingAPI");for(const g of h)(d=m[l=g.id])!=null||(m[l]=!0);this.data.experimentalGameplay=m,this.data.capabilities=void 0,i=!0}if(e&&this.data.author&&!this.data.authors&&(this.data.authors=typeof this.data.author=="string"?[this.data.author]:this.data.author,this.data.author=void 0,i=!0),e&&await this.fileSystem.fileExists(".bridge/compiler/default.json")){const h=await this.fileSystem.readJSON(".bridge/compiler/default.json");this.data.compiler={plugins:h.plugins},await this.fileSystem.unlink(".bridge/compiler/default.json"),i=!0}e&&t===0&&((p=this.data.compiler)==null?void 0:p.plugins)&&!this.data.compiler.plugins.includes("formatVersionCorrection")&&(this.data.bridge.formatVersion=1,this.data.compiler.plugins.push("formatVersionCorrection"),i=!0),i&&await this.writeConfig(this.data)}async getWorldHandles(){var i;if(!this.project)throw new Error("Cannot use getWorldHandles() within web workers yet");const e=this.project.app,t=((i=this.get().worlds)!=null?i:["./worlds/*"]).map(n=>this.resolvePackPath(void 0,n));return(await Promise.all(t.map(n=>e.fileSystem.getDirectoryHandlesFromGlob(n)))).flat()}getAuthorImage(){var t;const e=(t=this.get().authors)==null?void 0:t.find(i=>typeof i!="string"&&i.logo);if(!!e)return this.resolvePackPath(void 0,e.logo)}async toggleExperiment(e,t){var n,a;e.app.windows.loadingWindow.open();const i=(a=(n=this.get())==null?void 0:n.experimentalGameplay)!=null?a:{};i[t]=!i[t],await this.save(),e.isActiveProject&&await e.refresh(),this.project.app.windows.createPreset.onPresetsChanged(),e.app.windows.loadingWindow.close()}}async function ud(s,e){const t=s.config,i=Object.values(t.getAvailablePacks());if(i.length!==0)return await ni(Be(i[0],"pack_icon.png"),e).catch(()=>{})}const yn=JSON.parse('{"name":"bridge","version":"2.3.7","private":true,"scripts":{"dev":"vite","dev:force":"vite --force","dev:host":"vite --host","serve":"vite preview","check":"tsc --project tsconfig.json --noEmit","build":"node ./scripts/build.mjs && node ./scripts/buildApp.mjs","build:nightly":"node ./scripts/build.mjs && node ./scripts/buildApp.mjs --nightly"},"dependencies":{"@mdi/font":"^6.9.96","@types/lz-string":"^1.3.34","bridge-common-utils":"^0.3.3","bridge-iframe-api":"^0.4.11","bridge-js-runtime":"^0.3.6","bridge-model-viewer":"^0.7.7","buffer":"^6.0.3","color-convert":"^2.0.1","comlink":"^4.3.0","compare-versions":"^3.6.0","core-js":"^3.6.5","dash-compiler":"^0.10.6","escape-string-regexp":"^5.0.0","fflate":"^0.6.7","idb-keyval":"^5.1.3","is-glob":"^4.0.1","json5":"^2.1.3","jsonc-parser":"^3.0.0","lodash-es":"^4.17.20","lz-string":"^1.4.4","mc-project-core":"^0.3.22","molang":"^1.13.11","monaco-editor":"^0.33.0","path-browserify":"^1.0.1","prismarine-nbt":"^1.6.0","quick-score":"^0.0.13","tga-js":"^1.1.1","three":"^0.139.2","uuid":"^8.3.1","vue":"^2.7.8","vue-template-compiler":"^2.7.8","vuedraggable":"^2.24.3","vuetify":"^2.6.10","wintersky":"^1.1.0"},"devDependencies":{"@types/color-convert":"^2.0.0","@types/is-glob":"^4.0.1","@types/json5":"0.0.30","@types/lodash-es":"^4.17.4","@types/lodash.debounce":"^4.0.6","@types/node":"^14.17.9","@types/three":"^0.127.1","@types/uuid":"^8.3.0","@types/wicg-file-system-access":"^2020.9.5","@vitejs/plugin-vue2":"^1.1.2","markdown-it":"^12.3.2","node-fetch":"^2.6.7","prettier":"^2.2.1","sass":"^1.19.0","typescript":"^4.4.3","vite":"^3.1.2","vite-plugin-ejs":"^1.4.3","vite-plugin-pwa":"^0.12.3","vite-plugin-vue2":"^2.0.2"}}');let xe=yn.dependencies["dash-compiler"];xe.startsWith("^")||xe.startsWith("~")||xe.startsWith(">")||xe.startsWith("<")?xe=xe.substring(1):(xe.startsWith(">=")||xe.startsWith("<="))&&(xe=xe.substring(2));const zi=xe,de=yn.version;async function pd(s,e){var o,l,d,p,h,m,f,g,w,y,S,v;let t=await s.fileSystem.readJSON(e),i=(l=(o=b==null?void 0:b.projects)==null?void 0:o.addGeneratedWith)!=null?l:!0,n=(h=(p=(d=t==null?void 0:t.metadata)==null?void 0:d.generated_with)==null?void 0:p.bridge)!=null?h:[],a=(g=(f=(m=t==null?void 0:t.metadata)==null?void 0:m.generated_with)==null?void 0:f.dash)!=null?g:[],r=!1;return i?((!n.includes(de)||n.length>1)&&(n=[de],r=!0),(!a.includes(zi)||a.length>1)&&(a=[zi],r=!0)):(w=t==null?void 0:t.metadata)!=null&&w.generated_with&&(r=!0),r&&(t={...t!=null?t:{},metadata:{...(y=t==null?void 0:t.metadata)!=null?y:{},generated_with:i?{...(v=(S=t==null?void 0:t.metadata)==null?void 0:S.generated_with)!=null?v:{},bridge:n,dash:a}:void 0}},await s.fileSystem.writeJSON(e,t,!0)),t}async function hd(s,e){var a,r,o;await u.packType.ready.fired;const t=[],i=e.config,n=i.getAvailablePacks();for(const[l,d]of Object.entries(n)){let p={};try{p=await pd(s,i.resolvePackPath(l,"manifest.json"))}catch{}t.push({...u.packType.getFromId(l),packPath:d,version:(r=(a=p==null?void 0:p.header)==null?void 0:a.version)!=null?r:[1,0,0],uuid:(o=p==null?void 0:p.header)==null?void 0:o.uuid})}return t}function md(){return new Worker("/assets/Main.e65fe878.js")}const fd=Xi(new md),gd={icon:"mdi-flash-outline",name:"taskManager.tasks.packIndexing.title",description:"taskManager.tasks.packIndexing.description"};class wd extends ${constructor(t,i){super();c(this,"isPackIndexerFree",new sn);c(this,"_service",null);c(this,"task");this.project=t,this.baseDirectory=i}get service(){if(!this._service)throw new Error("Accessing service without service being defined");return this._service}async activate(t){var r,o,l,d,p,h;console.time("[TASK] Indexing Packs (Total)"),this.isPackIndexerFree.lock();const i=this.project.app;this.task=i.taskManager.create(gd),this._service=await new fd(this.baseDirectory,this.project.app.fileSystem.baseDirectory,{disablePackSpider:!((o=(r=b==null?void 0:b.general)==null?void 0:r.enablePackSpider)!=null&&o),pluginFileTypes:u.fileType.getPluginFileTypes(),noFullLightningCacheRefresh:!t&&!((l=b==null?void 0:b.general)!=null&&l.fullLightningCacheRefresh),projectPath:this.project.projectPath}),await((d=this._service)==null?void 0:d.on(lt(([m,f])=>{var g;(g=this.task)==null||g.update(m,f)}),!1));const[n,a]=await((p=this._service)==null?void 0:p.start(t));return await((h=this._service)==null?void 0:h.disposeListeners()),this.task.complete(),this.isPackIndexerFree.unlock(),console.timeEnd("[TASK] Indexing Packs (Total)"),this._service&&this.dispatch([n,a]),[n,a]}async deactivate(){var t,i;this.resetSignal(),await((t=this._service)==null?void 0:t.disposeListeners()),this._service=null,(i=this.task)==null||i.complete()}async updateFile(t,i,n=!1,a=!1){await this.isPackIndexerFree.lock(),await this.service.updatePlugins(u.fileType.getPluginFileTypes());const r=await this.service.updateFile(t,i,n,a);return this.isPackIndexerFree.unlock(),r}async rename(t,i,n=!0){await this.isPackIndexerFree.lock(),await this.service.updatePlugins(u.fileType.getPluginFileTypes()),await this.service.rename(t,i,n),this.isPackIndexerFree.unlock()}async hasFile(t){await this.isPackIndexerFree.lock();const i=await this.service.hasFile(t);return this.isPackIndexerFree.unlock(),i}async updateFiles(t,i=!1){await this.isPackIndexerFree.lock(),await this.service.updatePlugins(u.fileType.getPluginFileTypes());const n=await this.service.updateFiles(t,i);return this.isPackIndexerFree.unlock(),n}async unlinkFile(t,i=!0){await this.isPackIndexerFree.lock(),await this.service.updatePlugins(u.fileType.getPluginFileTypes()),await this.service.unlinkFile(t,i),this.isPackIndexerFree.unlock()}async saveCache(){await this.isPackIndexerFree.lock(),await this.service.saveCache(),this.isPackIndexerFree.unlock()}}class yd{constructor(e,t,i){this.jsonDefaults=e,this.app=t,this.filePath=i}async runScript(e,t){const i=this.app.fileSystem;let n={},a=!0;if(this.filePath)try{const r=await this.app.project.getFileFromDiskOrTab(this.filePath);n=L.parse(await r.text()),a=!1}catch{}try{return await ln({async:!0,script:t,env:{readdir:r=>i.readFilesFromDir(r).catch(()=>[]),uuid:E,getFormatVersions:Xc,getCacheDataFor:async(r,o,l)=>{const d=this.app.project.packIndexer;return await d.fired,d.service.getCacheDataFor(r,o,l)},getIndexedPaths:async(r,o)=>{const l=this.app.project.packIndexer;return await l.fired,await l.service.getAllFiles(r,o)},getProjectPrefix:()=>{var r;return(r=this.app.projectConfig.get().namespace)!=null?r:"bridge"},getProjectConfig:()=>this.app.projectConfig.get(),getFileName:()=>this.filePath?this.filePath.split(/\/|\\/g).pop():void 0,customComponents:r=>this.jsonDefaults.componentSchemas.get(r),get:r=>{const o=[];return mi(r,n,l=>o.push(l)),o},compare:Q,resolvePackPath:(r,o)=>this.app.projectConfig.resolvePackPath(r,o),failedCurrentFileLoad:a}})}catch(r){console.error(`Error evaluating schemaScript "${e}": ${r.message}`)}}async runSchemaScripts(e){const t=await this.app.dataLoader.readJSON("data/packages/minecraftBedrock/schemaScripts.json");for(const[i,n]of Object.entries(t)){let a;i.endsWith(".js")?a={script:n}:a=n;let r=await this.runScript(i,a.script);if(r){if(i.endsWith(".js")){if(r.keep)continue;a={...a,type:r.type,generateFile:r.generateFile},r=r.data}a.type==="object"&&!Array.isArray(r)&&typeof r=="object"?e[`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`]={uri:`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`,schema:{type:"object",properties:r}}:a.type==="custom"?e[`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`]={uri:`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`,schema:r}:e[`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`]={uri:`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`,schema:{type:a.type==="enum"?"string":"object",enum:a.type==="enum"?r:void 0,properties:a.type==="properties"?Object.fromEntries(r.map(o=>[o,{}])):void 0}}}}}}class ri extends ir{async readFile(e){return await(await(await u.getApp()).fileSystem.readFile(e)).text()}run(e,t={},i){return super.run(e,Object.assign(t,{require:n=>this.require(n,ve(e),t)}),i)}}const Oi=["block","item","entity"];class vd{constructor(){c(this,"schemas",{block:{},item:{},entity:{}});c(this,"schemaLookup",new Map);c(this,"disposables")}get(e){return this.schemas[e]}async activate(){this.disposables=[u.eventSystem.on("fileSave",async([t,i])=>{var h,m;const a=(await u.getApp()).project,r=a.config.resolvePackPath("behaviorPack","components"),o=(m=(h=a.config.get().bridge)==null?void 0:h.v1CompatMode)!=null?m:!1;if(!t.startsWith(r))return;const l=new ri,d=t.replace(r+"/","").split("/")[0],p=Oi.includes(d);!p&&o?await Promise.all(Oi.map(f=>this.evalComponentSchema(l,f,t,i,!0))):p&&await this.evalComponentSchema(l,d,t,i,o)}),u.eventSystem.on("fileUnlinked",t=>{var a;const[i,n]=(a=this.schemaLookup.get(t))!=null?a:[];!i||!n||(this.schemas[i][n]=void 0,this.schemaLookup.delete(t))})];const e=new ri;await Promise.all(Oi.map(t=>this.generateComponentSchemas(e,t)))}dispose(){var e;(e=this.disposables)==null||e.forEach(t=>t.dispose()),this.disposables=void 0}async generateComponentSchemas(e,t){var l,d;const i=await u.getApp(),n=i.project;await(await n.compilerService.completedStartUp).fired;const a=(d=(l=n.config.get().bridge)==null?void 0:l.v1CompatMode)!=null?d:!1,r=a?n.config.resolvePackPath("behaviorPack","components"):n.config.resolvePackPath("behaviorPack",`components/${t}`);let o;try{o=await i.fileSystem.getDirectoryHandle(r)}catch{return{}}this.schemas[t]={},await we(o,async(p,h)=>{await this.evalComponentSchema(e,t,h,await p.getFile(),a)},void 0,r)}async evalComponentSchema(e,t,i,n,a){const o=(await u.getApp()).project;await(await o.compilerService.completedStartUp).fired;const[l,d]=await o.compilerService.compileFile(i,new Uint8Array(await n.arrayBuffer())),p=new File([d],n.name),h=new nr(new Ss,t,await p.text(),"development",a);await h.load(e,i,"client")&&h.name&&(this.schemas[t][h.name]=h.getSchema(),this.schemaLookup.set(i,[t,h.name]))}}let Te={},zt=!1;class bd extends z{constructor(t){super();c(this,"loadedSchemas",!1);c(this,"localSchemas",{});c(this,"disposables",[]);c(this,"componentSchemas",new vd);c(this,"task",null);this.project=t}get isReady(){return this.loadedSchemas&&zt}async activate(){console.time("[SETUP] JSONDefaults"),await this.project.app.project.packIndexer.fired,await this.componentSchemas.activate(),this.disposables=[u.eventSystem.on("currentTabSwitched",t=>{t instanceof W&&u.fileType.isJsonFile(t.getPath())&&this.updateDynamicSchemas(t.getPath())}),u.eventSystem.on("refreshCurrentContext",t=>this.updateDynamicSchemas(t)),u.eventSystem.on("disableValidation",()=>{this.setJSONDefaults(!1)})].filter(t=>t!==void 0),await this.loadAllSchemas(),await this.setJSONDefaults(),console.timeEnd("[SETUP] JSONDefaults")}deactivate(){var t;this.disposables.forEach(i=>i.dispose()),this.componentSchemas.dispose(),this.disposables=[],(t=this.task)==null||t.complete(),this.task=null}async loadAllSchemas(){var a,r,o,l,d,p,h,m;this.localSchemas={};const t=await u.getApp();this.task=t.taskManager.create({icon:"mdi-book-open-outline",name:"taskManager.tasks.loadingSchemas.name",description:"taskManager.tasks.loadingSchemas.description",totalTaskSteps:10}),await t.dataLoader.fired,(a=this.task)==null||a.update(1);const i=await t.dataLoader.readdir("data/packages");(r=this.task)==null||r.update(2);for(const f of i)try{await this.loadStaticSchemas(await t.dataLoader.getFileHandle(`data/packages/${f}/schemas.json`),f==="minecraftBedrock")}catch(g){console.error(g);continue}zt=!0,(o=this.task)==null||o.update(3),await this.runSchemaScripts(t),(l=this.task)==null||l.update(5);const n=(d=this.project.tabSystem)==null?void 0:d.selectedTab;if(n&&n instanceof W){const f=u.fileType.getId(n.getPath());this.addSchemas(await this.requestSchemaFor(f,n.getPath())),await this.runSchemaScripts(t,n.isForeignFile?void 0:n.getPath())}this.addSchemas(await this.getDynamicSchemas()),(p=this.task)==null||p.update(4),this.loadedSchemas=!0,(h=this.task)==null||h.update(6),(m=this.task)==null||m.complete()}async setJSONDefaults(t=!0){const i=Object.assign({},Te,this.localSchemas);if($t.hasFired){const{languages:n}=await I();n.json.jsonDefaults.setDiagnosticsOptions({enableSchemaRequest:!1,allowComments:!0,validate:t,schemas:Object.values(i)})}je.setJSONDefaults(i),this.dispatch()}async reload(){const t=await u.getApp();t.windows.loadingWindow.open(),this.loadedSchemas=!1,this.localSchemas={},zt=!1,Te={},await this.deactivate(),await this.activate(),t.windows.loadingWindow.close()}async updateDynamicSchemas(t){const i=await u.getApp(),n=u.fileType.getId(t);this.addSchemas(await this.requestSchemaFor(n,t)),this.addSchemas(await this.requestSchemaFor(n)),await this.runSchemaScripts(i,t),await this.setJSONDefaults()}async updateMultipleDynamicSchemas(t){const i=await u.getApp(),n=new Set;for(const a of t){const r=u.fileType.getId(a);n.has(r)||(this.addSchemas(await this.requestSchemaFor(r)),await this.runSchemaScripts(i,a),n.add(r))}await this.setJSONDefaults()}addSchemas(t){t.forEach(i=>{this.localSchemas[i.uri]?(i.schema&&(this.localSchemas[i.uri].schema=i.schema),i.fileMatch&&(this.localSchemas[i.uri].fileMatch=i.fileMatch)):this.localSchemas[i.uri]=i})}async requestSchemaFor(t,i){const n=this.project.packIndexer;return await n.fired,await n.service.getSchemasFor(t,i)}async getDynamicSchemas(){return(await Promise.all(u.fileType.getIds().map(t=>this.requestSchemaFor(t)))).flat()}async loadStaticSchemas(t,i=!1){if(!zt){const n=await t.getFile(),a=JSON.parse(await n.text());for(const r in a)Te[r]={uri:r,schema:a[r]}}if(i){const n=u.fileType.getMonacoSchemaEntries();n.forEach(a=>{if(!a.uri)return;const r=Te[a.uri];r&&r.fileMatch&&a.fileMatch&&(r.fileMatch=void 0)}),n.forEach(a=>{!a.uri||(Te[a.uri]?(a.schema&&(Te[a.uri].schema=a.schema),a.fileMatch&&(Te[a.uri].fileMatch?Te[a.uri].fileMatch.push(...a.fileMatch):Te[a.uri].fileMatch=a.fileMatch)):Te[a.uri]=a)})}}addSchemaEntries(){}async runSchemaScripts(t,i){await new yd(this,t,i).runSchemaScripts(this.localSchemas)}}class oi{constructor(){c(this,"experimentalGameplay",{});c(this,"projectTargetVersion","");c(this,"failures",[]);c(this,"latestFormatVersion");c(this,"bpManifest");c(this,"isSetup",!1);c(this,"app")}async setup(){var a,r;if(this.isSetup)return;this.app=await u.getApp();const[e,t,i]=await Promise.all([this.app.projectManager.projectReady.fired,it(),this.app.fileSystem.readJSON(this.app.project.config.resolvePackPath("behaviorPack","manifest.json")).catch(()=>null)]),n=this.app.project.config.get();this.experimentalGameplay=(a=n.experimentalGameplay)!=null?a:{},this.latestFormatVersion=t,this.projectTargetVersion=(r=n.targetVersion)!=null?r:this.latestFormatVersion,this.bpManifest=i,this.isSetup=!0}resetFailures(){this.failures=[]}isValid(e){var o,l,d,p,h,m,f,g;if(this.resetFailures(),!e)return!0;if(!this.isSetup)throw new Error("RequiresMatcher is not setup. Make sure to call setup() before isValid().");(o=e.matchAll)!=null||(e.matchAll=!0);const t=this.app.project.hasPacks((l=e.packTypes)!=null?l:[]),i=!e.targetVersion||(Array.isArray(e.targetVersion)?Q(this.projectTargetVersion,e.targetVersion[1],e.targetVersion[0]):Q(this.projectTargetVersion,(p=(d=e.targetVersion)==null?void 0:d.min)!=null?p:"1.8.0",">=")&&Q(this.projectTargetVersion,(m=(h=e.targetVersion)==null?void 0:h.max)!=null?m:"1.18.0","<=")),n=!e.experimentalGameplay||e.experimentalGameplay.some(w=>w.startsWith("!")?!this.experimentalGameplay[w.replace("!","")]:this.experimentalGameplay[w]),a=(g=(f=this.bpManifest)==null?void 0:f.dependencies)==null?void 0:g.map(w=>{var y;if(w!=null&&w.module_name)switch(w.module_name){case"mojang-minecraft":return"@minecraft/server";case"mojang-gametest":return"@minecraft/server-gametest";case"mojang-minecraft-server-ui":return"@minecraft/server-ui";case"mojang-minecraft-server-admin":return"@minecraft/server-admin";case"mojang-net":return"@minecraft/server-net";default:return w.module_name}else switch((y=w.uuid)!=null?y:""){case"b26a4d4c-afdf-4690-88f8-931846312678":return"@minecraft/server";case"6f4b6893-1bb6-42fd-b458-7fa3d0c89616":return"@minecraft/server-gametest";case"2bd50a27-ab5f-4f40-a596-3641627c635e":return"@minecraft/server-ui";case"53d7f2bf-bf9c-49c4-ad1f-7c803d947920":return"@minecraft/server-admin";case"777b1798-13a6-401c-9cba-0cf17e31a81b":return"@minecraft/server-net";default:return""}}),r=!e.dependencies||!a||(e==null?void 0:e.dependencies.every(w=>a.includes(w)));return t||this.failures.push({type:"packTypes"}),i||this.failures.push({type:"targetVersion"}),n||this.failures.push({type:"experimentalGameplay"}),r||this.failures.push({type:"manifestDependency"}),e.matchAll?t&&n&&i&&r:t&&e.packTypes||n&&e.experimentalGameplay||i&&e.targetVersion||r&&e.dependencies}}const ns=new Map;class _d{constructor(e){c(this,"disposables",[]);c(this,"typeDisposables",[]);c(this,"userTypeDisposables",[]);c(this,"currentTypeEnv",null);this.dataLoader=e}async activate(e){this.disposables=[u.eventSystem.on("currentTabSwitched",async t=>{!t.isForeignFile&&t instanceof W&&(await this.setTypeEnv(t.getPath()),await this.loadUserTypes())})],e&&await this.setTypeEnv(e),await this.loadUserTypes()}deactivate(){this.currentTypeEnv=null,this.typeDisposables.forEach(e=>e.dispose()),this.disposables.forEach(e=>e.dispose()),this.typeDisposables=[],this.disposables=[]}async load(e){let t=ns.get(e);return t||(await this.dataLoader.fired,t=await(await this.dataLoader.readFile(`data/packages/minecraftBedrock/${e}`)).text(),ns.set(e,t),t)}async setTypeEnv(e){var l;if(e===this.currentTypeEnv)return;const{languages:t,Uri:i}=await I();this.currentTypeEnv=e,this.typeDisposables.forEach(d=>d.dispose()),this.typeDisposables=[],await u.fileType.ready.fired;const{types:n=[]}=(l=u.fileType.get(e))!=null?l:{},a=new oi;await a.setup();const o=(await Promise.all(n.map(async d=>{if(typeof d=="string")return[d,await this.load(d)];const{definition:p,requires:h}=d;if(h?a.isValid(h):!0)return[p,await this.load(p)]}))).filter(d=>d!==void 0);for(const[d,p]of o){const h=i.file(d);this.typeDisposables.push(t.typescript.javascriptDefaults.addExtraLib(p,h.toString()),t.typescript.typescriptDefaults.addExtraLib(p,h.toString()))}}async loadUserTypes(){const e=await u.getApp();await e.project.packIndexer.fired;let t;try{t=await e.project.packIndexer.service.getAllFiles()}catch{return}const i=t.filter(r=>r.endsWith(".ts")||r.endsWith(".js")),{languages:n,Uri:a}=await I();this.userTypeDisposables.forEach(r=>{r.dispose()}),this.userTypeDisposables=[];for(const r of i){const o=a.file(r),l=await e.fileSystem.readFile(r).catch(()=>null);!l||this.userTypeDisposables.push(n.typescript.typescriptDefaults.addExtraLib(await l.text(),o.toString()))}}}function Sd(s){const e=document.createElement("style");return e.innerHTML=s,document.head.appendChild(e),{dispose:()=>{document.head.contains(e)&&document.head.removeChild(e)}}}async function Cd(){return await ue(()=>import("./vueTemplateCompiler.c51c0527.js"),["assets/vueTemplateCompiler.c51c0527.js","assets/vendor.1f611e46.js","assets/vendor.f6a4afb7.css"])}const xd={VBtn:sr,VAlert:ar,VApp:rr,VToolbar:or,VToolbarItems:cr,VAutocomplete:lr,VCombobox:dr,VSwitch:ur,VTextField:pr,VWindow:hr,VTooltip:mr};async function kd(s,e,t,i){await we(e,async(n,a)=>{await Pd(s,a,await n.getFile().then(r=>r.text()),t,i)},void 0,"ui"),t.allLoaded.dispatch()}async function Pd(s,e,t,i,n){if(me(e)!==".vue"){Ne(new Error(`NOT A VUE FILE: Provided UI file "${fe(e)}" is not a vue file!`));return}const{parseComponent:a}=await Cd(),r=new Promise(async(o,l)=>{var w,y,S;const{template:d,script:p,styles:h,errors:m}=a(t);if(m.length>0)return m.forEach(v=>Ne(v)),l(m[0]);const{__default__:f}=p!=null&&p.content?await s.run(e,void 0,(w=p==null?void 0:p.content)!=null?w:""):{__default__:{}},g={name:fe(e),...f,...Ve.compile((y=d==null?void 0:d.content)!=null?y:'<p color="red">NO TEMPLATE DEFINED</p>')};g.components=Object.assign((S=g.components)!=null?S:{},xd),h.forEach(v=>n.push(Sd(v.content))),o(g)});i.set(e.replace("ui/","").split("/"),()=>r)}function jd(){let s={};return E(),{get UI(){return s},allLoaded:new $,set(e,t){let i=s;for(;e.length>1;){const a=e.shift();i[a]===void 0&&(i[a]={}),i=i[a]}const n=e.shift();i[fe(n,me(n))]=t},dispose(){s=null}}}async function Fd(s,e){await we(e,async(t,i)=>{const n=await t.getFile().then(a=>a.text());await s.run(i,void 0,n)},void 0,"scripts")}const Td={props:{action:Object,hideTriggerButton:Boolean,dense:Boolean,dark:Boolean,selected:{type:Boolean,default:void 0}},mixins:[G],methods:{onTrigger(){this.action.trigger()}}};var Ad=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pa-4 mb-2 rounded-lg control-bg",class:{selected:e.selected,dark:e.dark}},[t("div",{staticClass:"d-flex align-center"},[e.action.icon?t("v-icon",{staticClass:"mr-1",attrs:{color:e.action.color||"accent"}},[e._v(" "+e._s(e.action.icon)+" ")]):e._e(),t("h3",[e._v(e._s(e.t(e.action.name)))]),t("v-spacer"),e.action.keyBinding?t("span",[e._v(" "+e._s(e.action.keyBinding.toStrKeyCode())+" ")]):e._e(),e.hideTriggerButton?e._e():t("v-btn",{attrs:{color:e.action.color||"accent",small:"",icon:""}},[t("v-icon",{on:{click:e.onTrigger}},[e._v("mdi-play")])],1),e.selected!==void 0?t("v-icon",[e._v(" "+e._s(e.selected?"mdi-check-circle-outline":"mdi-checkbox-blank-circle-outline")+" ")]):e._e()],1),!e.dense&&e.action.description?t("p",[e._v(" "+e._s(e.t(e.action.description))+" ")]):e._e()])},$d=[],Ed=_(Td,Ad,$d,!1,null,"b0bf7f72",null,null);const bt=Ed.exports;class Xs{constructor({type:e,text:t,isDismissible:i}){c(this,"type");c(this,"text");c(this,"isDismissible");c(this,"isVisible",!0);this.type=e,this.text=t,this.isDismissible=i!=null?i:!1}}const Dd={mixins:[G],props:{infoPanel:Xs}};var Md=function(){var e=this,t=e._self._c;return t("v-alert",{attrs:{type:e.infoPanel.type,rounded:"lg",border:"bottom",dismissible:e.infoPanel.isDismissible},model:{value:e.infoPanel.isVisible,callback:function(i){e.$set(e.infoPanel,"isVisible",i)},expression:"infoPanel.isVisible"}},[e._v(" "+e._s(e.t(e.infoPanel.text))+" ")])},Id=[],Od=_(Dd,Md,Id,!1,null,null,null,null);const vn=Od.exports,Rd=X({__name:"InformedChoice",props:["window"],setup(s){const e=s,t=e.window.getState();function i(){e.window.close()}function n(a){a.trigger(),e.window.close()}return{__sfc:!0,props:e,state:t,onClose:i,onClick:n,BaseWindow:ce,ActionViewer:bt,InfoPanel:vn}}});var Wd=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,hasCloseButton:!e.window.opts.isPersistent,hasMaximizeButton:!1,percentageWidth:50,maxPercentageHeight:80,isPersistent:e.window.opts.isPersistent,heightUnset:""},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[e.window.topPanel?t(i.InfoPanel,{staticClass:"mb-2",attrs:{infoPanel:e.window.topPanel}}):e._e(),e._l(i.state.actionManager.state,function(n,a){return t(i.ActionViewer,{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,staticStyle:{cursor:"pointer"},attrs:{action:n,hideTriggerButton:!0},nativeOn:{click:function(r){return i.onClick(n)}}})})]},proxy:!0}])})},Ld=[],Nd=_(Rd,Wd,Ld,!1,null,null,null,null);const Bd=Nd.exports;class Wt extends ee{constructor(t,i={}){super(Bd,!0);c(this,"_ready",new $);c(this,"topPanel");c(this,"state",q({...super.state,actionManager:new Rt}));this.title=t,this.opts=i,this.defineWindow(),this.open()}get actionManager(){return this.state.actionManager}async open(){super.open()}dispose(){super.dispose(),this.actionManager.dispose()}}class bi{constructor({items:e,text:t,isOpen:i,shouldSort:n}){c(this,"type","category");c(this,"id",E());c(this,"text");c(this,"items");c(this,"isOpen");c(this,"shouldSort");c(this,"showDisabled",!1);this.text=t,this.items=e,this.isOpen=i!=null?i:!0,this.shouldSort=n!=null?n:!0,this.shouldSort&&this.sortCategory()}get isDisabled(){return this.items.every(e=>e.isDisabled)}addItem(e){this.items.push(e),this.shouldSort&&this.sortCategory()}removeItems(){this.items=[]}getText(){return this.text}getSearchText(){return this.text.toLowerCase()}getItems(e=this.showDisabled){return e?this.items:this.items.filter(t=>!t.isDisabled)}setOpen(e){this.isOpen=e}getCurrentElement(e){return this.items.find(({id:t})=>t===e)}sortCategory(){this.items=this.items.sort((e,t)=>e.getSearchText().localeCompare(t.getSearchText()))}hasFilterMatches(e){return e===""?this.items.length>0:this.items.find(t=>t.getSearchText().includes(e))!==void 0}filtered(e){if(e.length===0)return this;const t=new bi({items:this.getItems().filter(i=>i.getSearchText().includes(e)),text:this.text,shouldSort:this.shouldSort,isOpen:!0});return t.showDisabled=this.showDisabled,t}}class $e{constructor({id:e,text:t,icon:i,color:n,isDisabled:a,disabledText:r}){c(this,"type","item");c(this,"id");c(this,"text");c(this,"icon");c(this,"color");c(this,"isDisabled");c(this,"disabledText");this.id=e,this.text=t,this.icon=i,this.color=n,this.isDisabled=a!=null?a:!1,this.disabledText=r}getText(){return this.text}getSearchText(){return this.text.toLowerCase()}}class Lt extends z{constructor(t,i=!0){super();c(this,"_selected",F(""));c(this,"_filter",F(""));c(this,"reselectedForFilter","");c(this,"state",q({}));c(this,"_showDisabled",F(!1));c(this,"_elements",F([]));this.shouldSortSidebar=i,this.selected=this.findDefaultSelected()}get showDisabled(){return this._showDisabled.value}set showDisabled(t){this._showDisabled.value=t,this.rawElements.forEach(i=>{i.type==="category"&&(i.showDisabled=t)})}addElement(t,i){t.type==="item"&&i&&U(this.state,t.id,i),this.has(t)?this.replace(t):this._elements.value.push(t)}has(t){return this._elements.value.find(i=>i.id===t.id)!==void 0}replace(t){this._elements.value=this._elements.value.map(i=>i.id===t.id?t:i)}removeElements(){this._elements.value=[];for(const t in this.state)Se(this.state,t)}get filter(){return this._filter.value.toLowerCase()}set filter(t){this._filter.value=t.toLowerCase()}setFilter(t){this._filter.value=t.toLowerCase()}get elements(){const t=this.sortSidebar(this._elements.value.filter(i=>!this.showDisabled&&i.isDisabled?!1:i.type==="item"?i.getSearchText().includes(this.filter):i.hasFilterMatches(this.filter)).map(i=>i.type==="item"?i:i.filtered(this.filter)));if(this.filter!==this.reselectedForFilter&&t.length>0){const i=t.find(n=>!n.isDisabled);if(!i)return t;if(i.type==="category"&&i.getItems(!1).length>0){i.setOpen(!0);const n=i.getItems(!1)[0];n&&this.setDefaultSelected(n.id)}else i.type==="item"&&this.setDefaultSelected(i.id);this.reselectedForFilter=this.filter}return t}get rawElements(){return this._elements.value}get currentElement(){if(!!this.selected)for(const t of this._elements.value){if(t.type==="item"){if(t.id===this.selected)return t;continue}const i=t.getCurrentElement(this.selected);if(i)return i}}get currentState(){var t;return this.selected?(t=this.state[this.selected])!=null?t:{}:{}}getState(t){var i;return(i=this.state[t])!=null?i:{}}setState(t,i){U(this.state,t,i)}sortSidebar(t){return this.shouldSortSidebar?t.sort((i,n)=>i.type!==n.type?i.type.localeCompare(n.type):i.getSearchText().localeCompare(n.getSearchText())):t}findDefaultSelected(){for(const t of this.sortSidebar(this.elements))if(!t.isDisabled){if(t.type==="category"&&t.getItems(!1).length>0){const i=t.getItems(!1)[0];if(i)return i.id}else if(t.type==="item")return t.id}}setDefaultSelected(t){t?this.selected=t:this.selected||(this.selected=this.findDefaultSelected())}resetSelected(){this.selected=void 0}clearFilter(){this._filter.value=""}get selected(){return this._selected.value}set selected(t){this._selected.value!==t&&(this.dispatch(t),this._selected.value=t)}}class Vd{constructor(e,t){c(this,"icon");c(this,"text");c(this,"color");this.parent=e,this.icon=this.parent.getTagIcon(t),this.text=t,this.color=this.parent.getTagColor(t)}getText(){return this.text}asSidebarElement(){return new $e({id:this.text.toLowerCase(),text:this.text,color:this.color,icon:this.icon})}}const Hd=s=>[new D({name:"windows.extensionStore.deleteExtension",icon:"mdi-delete",onTrigger:()=>{s.delete(),s.closeActionMenu()}}),new D({name:`windows.extensionStore.${s.isActive?"deactivateExtension":"activateExtension"}`,icon:s.isActive?"mdi-close":"mdi-check",onTrigger:()=>{s.setActive(!s.isActive),s.closeActionMenu()}}),!s.isInstalledLocallyAndGlobally&&!u.instance.isNoProjectSelected?new D({name:`windows.extensionStore.${s.isGlobal?"installLocal":"installGlobal"}`,icon:"mdi-download",onTrigger:()=>{s.download(!s.isGlobal),s.closeActionMenu()}}):null];class ea{constructor(e,t,i=!1){c(this,"tags");c(this,"isLoading",!1);c(this,"_isInstalled",!1);c(this,"isUpdateAvailable",!1);c(this,"connected",[]);c(this,"showMenu",!1);c(this,"isActive",!0);this.parent=e,this.config=t,this.isLocalOnly=i,this.tags=this.config.tags.map(n=>(this.parent.tags[n]||(this.parent.tags[n]=new Vd(this.parent,n)),this.parent.tags[n])).sort((n,a)=>n.getText().localeCompare(a.getText()))}get author(){return this.manifest.author}get name(){return this.manifest.name}get version(){return this.manifest.version}get description(){return this.manifest.description}get icon(){return this.manifest.icon}get id(){return this.manifest.id}get releaseTimestamp(){var e;return(e=this.config.releaseTimestamp)!=null?e:Date.now()}get readme(){return this.manifest.readme}get manifest(){var e,t,i,n;return this.isUpdateAvailable?(e=this.config)!=null?e:{}:(n=(i=(t=this.extension)==null?void 0:t.manifest)!=null?i:this.config)!=null?n:{}}get compilerPlugins(){var t,i,n,a;const e=this.extension;return Object.keys(e?(t=e.compilerPlugins)!=null?t:{}:(a=(n=(i=this.config)==null?void 0:i.compiler)==null?void 0:n.plugins)!=null?a:{})}get isInstalled(){return this._isInstalled}get actions(){return Hd(this).filter(e=>e!==null)}get isGlobal(){var e,t;return(t=(e=this.extension)==null?void 0:e.isGlobal)!=null?t:!1}get onlineVersion(){return this.config.version}get isInstalledLocallyAndGlobally(){return this.connected.length===2}get extension(){if(this.connected.length===0)return null;const e=this.connected.find(t=>!t.isGlobal);return e||this.connected[0]}hasTag(e){return this.tags.includes(e)}isCompatibleVersion(){return!this.config.compatibleAppVersions||(this.config.compatibleAppVersions.min&&Q(de,this.config.compatibleAppVersions.min,">=")||!this.config.compatibleAppVersions.min)&&(this.config.compatibleAppVersions.max&&Q(de,this.config.compatibleAppVersions.max,"<")||!this.config.compatibleAppVersions.max)}async download(e){const t=await u.getApp();if(e!==void 0)return this.downloadExtension(e);if(t.isNoProjectSelected)return this.downloadExtension(!0);const n=await new Wt("windows.pluginInstallLocation.title").actionManager;n.create({icon:"mdi-folder-multiple-outline",name:"actions.pluginInstallLocation.global.name",description:"actions.pluginInstallLocation.global.description",onTrigger:()=>{this.downloadExtension(!0)}}),n.create({icon:"mdi-folder-outline",name:"actions.pluginInstallLocation.local.name",description:"actions.pluginInstallLocation.local.description",onTrigger:()=>{this.downloadExtension(!1)}})}async downloadExtension(e,t=!1,i=!0){var p,h;this.isLoading=!0;const n=await u.getApp(),a=await fetch(this.parent.getBaseUrl()+this.config.link).then(m=>m.arrayBuffer()),r=e?"~local/extensions":`${n.project.projectPath}/.bridge/extensions`,o=e?n.extensionLoader:n.project.extensionLoader,l=r+`/${this.name.replace(/\s+/g,"")}.zip`;await n.fileSystem.writeFile(l,a);try{await n.fileSystem.unlink(l.replace(".zip",""))}catch{}for(const m of(p=this.config.dependencies)!=null?p:[]){const f=this.parent.getExtensionById(m);f&&(f.isInstalled?!f.isActive&&f.connected&&f.connected.forEach(g=>g.activate()):await f.downloadExtension(e))}const d=await o.loadExtension(await n.fileSystem.getDirectoryHandle(r),await n.fileSystem.getFileHandle(l),i&&(this.connected.length===0||((h=this.extension)==null?void 0:h.isGlobal)));d&&this.setConnected(d),this.setInstalled(),this.isUpdateAvailable=!1,this.isLoading=!1,t||d!=null&&d.contributesCompilerPlugins&&new N({title:"windows.extensionStore.compilerPluginDownload.title",description:"windows.extensionStore.compilerPluginDownload.description",cancelText:"general.later",confirmText:"windows.extensionStore.compilerPluginDownload.openConfig",onConfirm:async()=>{this.parent.close();const f=(await u.getApp()).project;f.config.get().compiler?await f.openFile(await f.fileSystem.getFileHandle("config.json")):await f.openFile(await f.fileSystem.getFileHandle(".bridge/compiler/default.json"))}})}async update(e=!0){if(this.connected.length===0)return;e&&this.parent.updateInstalled(this);const t=this.connected.map(i=>i.isActive);this.connected.forEach(i=>i.deactivate()),await Promise.all(this.connected.map(async(i,n)=>{await i.resetInstalled(),await this.downloadExtension(i.isGlobal,!0,t[n])}))}delete(){var e;this.connected.length!==0&&((e=this.extension)==null||e.delete(),this.connected=this.connected.filter(t=>t!==this.extension),this.connected.length===0&&(this.parent.delete(this),this._isInstalled=!1))}setInstalled(){this._isInstalled=!0,this.parent.addInstalledExtension(this)}setIsUpdateAvailable(){this.isUpdateAvailable=!0}setConnected(e){var t,i;this.connected.push(e),this.isActive=(i=(t=this.extension)==null?void 0:t.isActive)!=null?i:!1}setActive(e){var t;if(!this.connected)throw new Error("No extension connected to ExtensionViewer");e?(t=this.extension)==null||t.setActive(e):this.connected.forEach(i=>i.setActive(e)),this.isActive=e}closeActionMenu(){this.showMenu=!1}get canShare(){return typeof navigator.share=="function"}async share(){if(!this.canShare)return;const e=new URL(window.location.href);e.searchParams.set("viewExtension",encodeURIComponent(this.id)),await navigator.share({title:`Extension: ${this.name}`,text:`View the extension "${this.name}" within bridge.!`,url:e.href}).catch(()=>{})}}function Ud(s,e){return we(s,async t=>{const i=await t.getFile(),n=L.parse(await i.text());e.push(u.fileType.addPluginFileType(n))})}class zd{constructor(e,t){this.fileSystem=e,this.contributeFiles=t}async execute(e){const t=u.instance;await t.projectManager.projectReady.fired;const i=[];for(const[n,a]of Object.entries(this.contributeFiles)){const r=e?t.projects:[t.project];if(await this.fileSystem.fileExists(n)){const o=await this.fileSystem.readFile(n);for(const l of r){const d=l.config.resolvePackPath(a.pack,a.path);i.push(t.fileSystem.writeFile(d,await o.arrayBuffer()))}}else if(await this.fileSystem.directoryExists(n))i.push(At(await this.fileSystem.getDirectoryHandle(n),async(o,l)=>{const d=[];for(const p of r){const h=p.config.resolvePackPath(a.pack,a.path),m=await t.fileSystem.getFileHandle(Be(h,l),!0);d.push(t.fileSystem.copyFileHandle(o,m))}await Promise.all(d)}));else{console.warn(`Failed to install files from "${n}": No such file or directory`);continue}}await Promise.all(i),t.actionManager.trigger("bridge.action.refreshProject")}}const Kt=new ut("persistent-extension-storage"),Jd=({extensionId:s})=>({async save(e){await Kt.set(s,e)},async load(){return await Kt.get(s)},async delete(){await Kt.del(s)}});class mt{constructor(e){this.config=e}getConfig(){return this.config}trigger(e){var t,i;(i=(t=this.config).onTrigger)==null||i.call(t,e)}}class ft extends mt{constructor(t,i){super(i);c(this,"_isSelected",!1);this.parent=t,this.parent.selectedAction||this.select()}get isSelected(){return this._isSelected}select(){this.parent.unselectAllActions(),this._isSelected=!0,this.parent.selectedAction=this}unselect(){this._isSelected&&(this.parent.selectedAction=void 0),this._isSelected=!1}}class Nt{constructor(){c(this,"headerSlot");c(this,"headerHeight");c(this,"topPanel");c(this,"actions",[]);c(this,"selectedAction")}unselectAllActions(){var e;(e=this.actions)==null||e.forEach(t=>t instanceof ft?t.unselect():void 0),this.selectedAction=void 0}getSelectedAction(){var e;return(e=this.actions)==null?void 0:e.find(t=>t instanceof ft&&t.isSelected)}onContentRightClick(e){}}function Ke(s){return new bn(s)}class bn{constructor(e){c(this,"sidebarUUID");c(this,"disposable");c(this,"isLoading",!1);c(this,"isSelected",!1);c(this,"stopHandle");c(this,"badge",null);c(this,"isVisibleSetting");var t;if(this.config=e,this.sidebarUUID=(t=e.id)!=null?t:E(),this.disposable=u.sidebar.addSidebarElement(this.sidebarUUID,this),this.config.component){const i=this.config.component;this.config.sidebarContent=new class extends Nt{constructor(){super(...arguments);c(this,"component",i);c(this,"actions");c(this,"topPanel")}}}this.stopHandle=dt(u.sidebar.currentState,()=>{var i;this.isSelected=((i=u.sidebar.currentState.value)!=null?i:!1)&&u.sidebar.currentState.value===this.config.sidebarContent},{deep:!1})}get isDisabled(){var e,t,i;return(i=(t=(e=this.config).disabled)==null?void 0:t.call(e))!=null?i:!1}get isVisible(){var e;return typeof this.config.isVisible=="function"?this.config.isVisible():(e=this.config.isVisible)!=null?e:!!this.isVisibleSetting}get defaultVisibility(){var e;return(e=this.config.defaultVisibility)!=null?e:!0}get icon(){return this.config.icon}get uuid(){return this.sidebarUUID}get displayName(){return this.config.displayName}get group(){return this.config.group}get component(){return this.config.component}dispose(){var e;this.disposable.dispose(),(e=this.stopHandle)==null||e.call(this),this.stopHandle=void 0}setSidebarContent(e){this.config.sidebarContent=e}setIsVisible(e){this.config.isVisible=e}attachBadge(e){return this.badge=e,this}async click(){this.isLoading=!0,this.config.sidebarContent&&u.sidebar.toggleSidebarContent(this.config.sidebarContent),typeof this.config.onClick=="function"&&await this.config.onClick(this),this.isLoading=!1}select(){if(!this.config.sidebarContent)throw new Error("Cannot select sidebar element without sidebar content");u.sidebar.selectSidebarContent(this.config.sidebarContent)}}const qd={name:"SidebarItem",mixins:[G],props:{isSelected:Boolean,isDisabled:Boolean,disabledText:String,text:String,icon:String,color:String,compact:Boolean}};var Gd=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"ripple",rawName:"v-ripple",value:!e.isSelected&&!e.isDisabled,expression:"!isSelected && !isDisabled"}],staticClass:"pa-1 rounded-lg category",class:{selected:e.isSelected,"is-disabled":e.isDisabled},on:{click:function(i){e.isDisabled||e.$emit("click")}}},[t("v-tooltip",{attrs:{disabled:!e.isDisabled,right:"",color:"tooltip"},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("span",e._g({staticClass:"d-flex align-center",class:{"justify-center":e.compact}},i),[t("v-icon",{class:{"pr-1":!e.compact},style:{"font-size":`${e.compact?30:22}px`},attrs:{color:e.isDisabled?null:e.color}},[e._v(" "+e._s(e.icon)+" ")]),e.compact?e._e():t("span",[e._v(e._s(e.text))]),e.isDisabled?t("v-spacer"):e._e(),e.isDisabled?t("v-icon",{attrs:{small:"",color:"error"}},[e._v(" mdi-alert-circle-outline ")]):e._e()],1)]}}])},[t("span",[e._v(e._s(e.disabledText||e.t("windows.sidebar.disabledItem")))])])],1)},Kd=[],Yd=_(qd,Gd,Kd,!1,null,"b5044f90",null,null);const ta=Yd.exports;const Qd={name:"SidebarGroup",mixins:[G],components:{SidebarItem:ta},props:{text:String,isOpen:Boolean,items:Array,selected:String,compact:Boolean}};var Zd=function(){var e=this,t=e._self._c;return t("details",{attrs:{open:e.isOpen}},[t("summary",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"rounded-lg",on:{click:function(i){return i.preventDefault(),e.$emit("toggleOpen")}}},[t("span",{staticClass:"d-flex",class:{"justify-center":e.compact}},[e.compact?e._e():t("h2",{staticClass:"d-inline"},[e._v(e._s(e.t(e.text)))]),e.compact?e._e():t("v-spacer"),t("v-icon",{attrs:{color:"primary",large:""}},[e._v(" "+e._s(e.isOpen?"mdi-chevron-down":"mdi-chevron-right")+" ")])],1)]),e._l(e.items,function({text:i,icon:n,color:a,id:r,isDisabled:o,disabledText:l},d){return t("SidebarItem",{key:`${i}.${d}`,attrs:{icon:n,color:a,text:i,isSelected:e.selected===r,isDisabled:o,disabledText:l,compact:e.compact},on:{click:function(p){return e.$emit("click",r)}}})}),e.compact?t("v-divider"):e._e()],2)},Xd=[],eu=_(Qd,Zd,Xd,!1,null,"7d0b77cf",null,null);const tu=eu.exports,iu={inheritAttrs:!1,components:{BaseWindow:ce,SidebarItem:ta,SidebarGroup:tu},props:{sidebarItems:Array,isLoading:Boolean,value:{type:String,default:void 0}},computed:{selected(){return this.value},isMobile(){return this.$vuetify.breakpoint.mobile}},methods:{onSidebarChanged(s){this.$emit("input",s)},toggleOpenCategory(s){s.isOpen=!s.isOpen}}};var nu=function(){var e=this,t=e._self._c;return t("BaseWindow",e._g(e._b({attrs:{isLoading:e.isLoading},scopedSlots:e._u([{key:"toolbar",fn:function(){return[e._t("toolbar",null,{selectedTab:e.selected})]},proxy:!0},{key:"sidebar",fn:function(){return[e.isLoading?t("v-progress-linear",{attrs:{indeterminate:""}}):[e.isMobile?e._e():e._t("sidebar",null,{selectedSidebar:e.selected}),e._l(e.sidebarItems,function(i){return[i.type==="item"?t("SidebarItem",{key:`${i.id}`,attrs:{icon:i.icon,color:i.color,text:i.text,isSelected:e.selected===i.id,isDisabled:i.isDisabled,disabledText:i.disabledText,compact:e.isMobile},on:{click:function(n){return e.onSidebarChanged(i.id)}}}):t("SidebarGroup",{key:`${i.id}.${i.isOpen}`,attrs:{isOpen:i.isOpen,items:i.getItems(),text:i.text,selected:e.selected,compact:e.isMobile},on:{toggleOpen:function(n){return e.toggleOpenCategory(i)},click:e.onSidebarChanged}})]})]]},proxy:!0},{key:"default",fn:function(){return[e._t("default",null,{selectedSidebar:e.selected})]},proxy:!0},{key:"actions",fn:function(){return[e._t("actions",null,{selectedSidebar:e.selected})]},proxy:!0}],null,!0)},"BaseWindow",e.$attrs,!1),e.$listeners))},su=[],au=_(iu,nu,su,!1,null,null,null,null);const _t=au.exports,ru=X({__name:"SettingsWindow",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState(),n=e.window.sidebar,a=B(()=>n.currentElement?`[${n.currentElement.text} - ${t("windows.settings.title")}]`:"windows.settings.title");function r(){e.window.close()}function o(){location.reload()}return{__sfc:!0,t,props:e,state:i,sidebar:n,title:a,onClose:r,onReload:o,SidebarWindow:_t,pointerDevice:te}}});var ou=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.SidebarWindow,{attrs:{windowTitle:i.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:i.sidebar.elements},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"sidebar",fn:function(){return[t("v-text-field",{staticClass:"pt-2",attrs:{"prepend-inner-icon":"mdi-magnify",label:i.t("windows.settings.searchSettings"),autocomplete:"off",autofocus:i.pointerDevice==="mouse",outlined:"",dense:""},model:{value:i.sidebar.filter,callback:function(n){e.$set(i.sidebar,"filter",typeof n=="string"?n.trim():n)},expression:"sidebar.filter"}})]},proxy:!0},{key:"default",fn:function({selectedSidebar:n}){return[i.state.reloadRequired?t("v-alert",{attrs:{border:"bottom",type:"info"}},[t("div",{staticClass:"d-flex align-center"},[t("span",[e._v(e._s(i.t("windows.settings.reloadRequired")))]),t("v-spacer"),t("v-btn",{attrs:{text:"",dense:""},on:{click:i.onReload}},[t("v-icon",{staticClass:"pr-1",attrs:{small:""}},[e._v(" mdi-refresh ")]),e._v(" "+e._s(i.t("general.reload"))+" ")],1)],1)]):e._e(),i.sidebar.currentState.length===0&&i.sidebar.filter!==""?t("span",[e._v(' No setting matches your search for "'+e._s(i.sidebar.filter)+'". ')]):e._e(),e._l(i.sidebar.currentState,function(a,r){return t(a.component,{key:`${n}.${r}.${a.value}`,tag:"component",staticClass:"mb-6",attrs:{config:a.config,value:a.value},on:{change:a.onChange,closeWindow:i.onClose}})})]}}]),model:{value:i.sidebar.selected,callback:function(n){e.$set(i.sidebar,"selected",n)},expression:"sidebar.selected"}})},cu=[],lu=_(ru,ou,cu,!1,null,null,null,null);const du=lu.exports;class st{constructor(e,t,i=b){c(this,"component");c(this,"config");c(this,"rawValue");c(this,"onChange",async e=>{this.value!==e&&(await(this.value=e),typeof this.config.onChange=="function"&&await this.config.onChange(e))});this.state=i,U(this,"config",t),U(this,"component",e),this.value===void 0&&t.default!==void 0&&(this.value=t.default)}set value(e){if(this.config.omitFromSaveFile){this.rawValue=e;return}this.state[this.config.category]===void 0&&U(this.state,this.config.category,{}),U(this.state[this.config.category],this.config.key,e)}get value(){var e;return this.config.omitFromSaveFile?this.rawValue:(e=this.state[this.config.category])==null?void 0:e[this.config.key]}}const uu={props:{config:Object,value:String},mixins:[G],data:()=>({value_:void 0}),created(){this.value_=this.config.options.findIndex(s=>s===this.value)||0},methods:{onChange(s){this.$nextTick(()=>this.$emit("change",this.config.options[s]))}}};var pu=function(){var e=this,t=e._self._c;return t("div",[t("h3",[e._v(e._s(e.t(e.config.name)))]),t("div",{staticClass:"d-flex"},[t("div",[t("v-btn-toggle",{attrs:{inset:"",dense:"",mandatory:"",label:e.config.description,value:e.value_},on:{change:e.onChange}},e._l(e.config.options,function(i){return t("v-btn",{key:i,attrs:{color:"sidebarSelection"}},[e._v(" "+e._s(i)+" ")])}),1)],1),t("span",{staticClass:"ml-4 text-normal"},[e._v(e._s(e.t(e.config.description)))])])])},hu=[],mu=_(uu,pu,hu,!1,null,null,null,null);const fu=mu.exports;class ss extends st{constructor(e){super(fu,e)}matches(e){return this.config.name.toLowerCase().includes(e)||this.config.description.toLowerCase().includes(e)||this.config.options.some(t=>t.toLowerCase().includes(e))}}const gu={props:{value:[Boolean,Promise],config:Object},mixins:[G],data:()=>({value_:void 0}),async mounted(){this.value_=await this.value},methods:{onChange(s){this.$emit("change",s===null?!1:s)}}};var wu=function(){var e=this,t=e._self._c;return t("div",[t("h3",[e._v(e._s(e.t(e.config.name)))]),t("v-switch",{staticStyle:{"margin-top":"0"},attrs:{inset:"",dense:"",label:e.t(e.config.description),value:e.value_},on:{change:e.onChange}})],1)},yu=[],vu=_(gu,wu,yu,!1,null,null,null,null);const bu=vu.exports;class Y extends st{constructor(e){super(bu,e)}matches(e){return this.config.name.toLowerCase().includes(e)||this.config.description.toLowerCase().includes(e)}}const _u={props:{config:Object},components:{ActionViewer:bt},mixins:[G]};var Su=function(){var e=this,t=e._self._c;return t("ActionViewer",{attrs:{action:e.config.action}})},Cu=[],xu=_(_u,Su,Cu,!1,null,null,null,null);const ku=xu.exports;class Pu extends st{constructor(t,i="actions"){var n,a;super(ku,{category:i,action:{},description:(n=t.description)!=null?n:"No description provided",key:t.id,name:(a=t.name)!=null?a:"general.unknown"},void 0);c(this,"config",wt({category:"actions",action:{}}));c(this,"onChange",async()=>{});this.config.category=i,this.config.action=t}matches(t){var i;return this.config.action.name.includes(t)||((i=this.config.action.description)==null?void 0:i.includes(t))}}const ju={props:{config:Object,value:[String,Promise]},mixins:[G],data:()=>({value_:void 0}),async mounted(){this.value_=await this.value||this.config.default},methods:{onChange(s){this.$nextTick(()=>this.$emit("change",s))},async onClick(){this.config.onClick&&await this.config.onClick()}}};var Fu=function(){var e=this,t=e._self._c;return t("div",[t("h3",[e._v(e._s(e.t(e.config.name)))]),t("div",{staticClass:"d-flex align-center"},[t("div",[t("v-autocomplete",{attrs:{inset:"",dense:"",mandatory:"",outlined:"",value:e.value_,items:e.config.options,"hide-details":"","menu-props":{maxHeight:220,rounded:"lg","nudge-top":-8,transition:"slide-y-transition"}},on:{change:e.onChange},nativeOn:{click:function(i){return e.onClick.apply(null,arguments)}}})],1),t("span",{staticClass:"ml-4 text-normal"},[e._v(e._s(e.t(e.config.description)))])])])},Tu=[],Au=_(ju,Fu,Tu,!1,null,null,null,null);const $u=Au.exports;class ze extends st{constructor(e){super($u,e)}matches(e){return this.config.name.toLowerCase().includes(e)||this.config.description.toLowerCase().includes(e)||this.config.options.some(t=>typeof t=="string"?t.toLowerCase().includes(e):t.text.toLowerCase().includes(e))}}class as extends ze{get value(){return u.getApp().then(e=>{var t;return(t=e.projectConfig.get().bridge)==null?void 0:t[this.config.key]})}set value(e){u.getApp().then(async t=>{t.projectConfig.get().bridge||(t.projectConfig.get().bridge={}),t.projectConfig.get().bridge[this.config.key]=e,await t.projectConfig.save()})}}const Eu={props:{config:Object},mixins:[G]};var Du=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex align-center"},[t("v-btn",{attrs:{color:"primary"},on:{click:e.config.onClick}},[e._v(" "+e._s(e.t(e.config.name))+" ")]),t("span",{staticClass:"ml-4 text-normal"},[e._v(e._s(e.t(e.config.description)))])],1)},Mu=[],Iu=_(Eu,Du,Mu,!1,null,null,null,null);const Ou=Iu.exports;class Ru extends st{constructor(t){super(Ou,{...t,key:"N/A"});c(this,"onChange",async()=>{})}matches(t){return this.config.name.includes(t)||this.config.description.includes(t)}}const Wu={setup(){return{sidebarElements:u.sidebar.elements}},components:{ActionViewer:bt},methods:{onClick(s){s.isVisibleSetting=!s.isVisibleSetting,b.sidebar||(b.sidebar={}),b.sidebar.sidebarElements||(b.sidebar.sidebarElements={}),b.sidebar.sidebarElements[s.uuid]=s.isVisibleSetting}}};var Lu=function(){var e=this,t=e._self._c;return t("div",e._l(e.sidebarElements,function(i,n){return t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],key:n,attrs:{selected:i.isVisibleSetting,action:{...i.config,name:i.displayName},hideTriggerButton:""},nativeOn:{click:function(a){return e.onClick(i)}}})}),1)},Nu=[],Bu=_(Wu,Lu,Nu,!1,null,null,null,null);const Vu=Bu.exports;class Hu extends st{constructor(e){super(Vu,e)}matches(e){return Object.values(u.sidebar.elements).some(t=>R(t.displayName).includes(e))}}const Uu={props:{config:Object,value:[String,Promise]},mixins:[G],data:()=>({value_:void 0}),async created(){this.value_=await this.value||this.config.default},methods:{onChange(s){this.$nextTick(()=>this.$emit("change",s))}}};var zu=function(){var e=this,t=e._self._c;return t("div",[t("h3",[e._v(e._s(e.t(e.config.name)))]),t("div",{staticClass:"d-flex align-center"},[t("div",[t("v-text-field",{attrs:{inset:"",dense:"",mandatory:"",outlined:"",value:e.value_,items:e.config.options,"hide-details":"","menu-props":{maxHeight:220}},on:{change:e.onChange}})],1),t("span",{staticClass:"ml-4 text-normal"},[e._v(e._s(e.t(e.config.description)))])])])},Ju=[],qu=_(Uu,zu,Ju,!1,null,null,null,null);const Gu=qu.exports;class Ku extends st{constructor(e){super(Gu,e)}matches(e){return this.config.name.toLowerCase().includes(e)||this.config.description.toLowerCase().includes(e)}}class rs extends ze{constructor(t){var i;super(t);c(this,"didLoadFonts",!1);t.onClick=()=>this.onClick(),typeof((i=navigator==null?void 0:navigator.permissions)==null?void 0:i.query)=="function"&&navigator.permissions.query({name:"local-fonts"}).then(({state:n})=>{n==="granted"&&this.onClick()}).catch(()=>{})}async onClick(){!window.queryLocalFonts||this.didLoadFonts||await window.queryLocalFonts().then(t=>{this.didLoadFonts=!0,this.config.options.push(...t.filter(i=>i.style==="Regular").map(i=>({text:i.fullName,value:i.family})))}).catch(t=>console.error(t))}}async function Yu(s){const e=await u.getApp();s.addControl(new ss({category:"appearance",name:"windows.settings.appearance.colorScheme.name",description:"windows.settings.appearance.colorScheme.description",key:"colorScheme",options:["auto","dark","light"],default:"auto",onChange:()=>{e.themeManager.updateTheme()}})),s.addControl(new ze({category:"appearance",name:"windows.settings.appearance.darkTheme.name",description:"windows.settings.appearance.darkTheme.description",key:"darkTheme",get options(){return s.parent.themeManager.getThemes("dark").map(t=>({text:t.name,value:t.id}))},default:"bridge.default.dark",onChange:()=>{e.themeManager.updateTheme()}})),s.addControl(new ze({category:"appearance",name:"windows.settings.appearance.lightTheme.name",description:"windows.settings.appearance.lightTheme.description",key:"lightTheme",get options(){return s.parent.themeManager.getThemes("light").map(t=>({text:t.name,value:t.id}))},default:"bridge.default.light",onChange:()=>{e.themeManager.updateTheme()}})),s.addControl(new as({category:"appearance",name:"windows.settings.appearance.localDarkTheme.name",description:"windows.settings.appearance.localDarkTheme.description",key:"darkTheme",get options(){return s.parent.themeManager.getThemes("dark",!1).map(t=>({text:t.name,value:t.id})).concat([{text:"None",value:"bridge.noSelection"}])},default:"bridge.noSelection",onChange:()=>{e.themeManager.updateTheme()}})),s.addControl(new as({category:"appearance",name:"windows.settings.appearance.localLightTheme.name",description:"windows.settings.appearance.localLightTheme.description",key:"lightTheme",get options(){return s.parent.themeManager.getThemes("light",!1).map(t=>({text:t.name,value:t.id})).concat([{text:"None",value:"bridge.noSelection"}])},default:"bridge.noSelection",onChange:()=>{e.themeManager.updateTheme()}})),s.addControl(new rs({category:"appearance",name:"windows.settings.appearance.font.name",description:"windows.settings.appearance.font.description",key:"font",default:"Roboto",options:["Roboto","Arial","Verdana","Helvetica","Tahome","Trebuchet MS","Menlo","Monaco","Courier New","monospace"]})),s.addControl(new rs({category:"appearance",name:"windows.settings.appearance.editorFont.name",description:"windows.settings.appearance.editorFont.description",key:"editorFont",default:H()==="darwin"?"Menlo":"Consolas",options:["Roboto","Arial","Consolas","Menlo","Monaco",'"Courier New"',"monospace"],onChange:async t=>{e.projectManager.updateAllEditorOptions({fontFamily:t})}})),s.addControl(new ze({category:"appearance",name:"windows.settings.appearance.editorFontSize.name",description:"windows.settings.appearance.editorFontSize.description",key:"editorFontSize",default:"14px",options:["8px","10px","12px","14px","16px","18px","20px"],onChange:async t=>{e.projectManager.updateAllEditorOptions({fontSize:Number(t.replace("px",""))})}})),s.addControl(new Y({category:"appearance",name:"windows.settings.appearance.hideToolbarItems.name",description:"windows.settings.appearance.hideToolbarItems.description",key:"hideToolbarItems",default:!1})),s.addControl(new Y({category:"sidebar",name:"windows.settings.sidebar.sidebarRight.name",description:"windows.settings.sidebar.sidebarRight.description",key:"isSidebarRight",default:!1})),s.addControl(new Y({category:"sidebar",name:"windows.settings.sidebar.shrinkSidebarElements.name",description:"windows.settings.sidebar.shrinkSidebarElements.description",key:"smallerSidebarElements",default:!1})),s.addControl(new ss({category:"sidebar",name:"windows.settings.sidebar.sidebarSize.name",description:"windows.settings.sidebar.sidebarSize.description",key:"sidebarSize",options:["tiny","small","normal","large"],default:"normal",onChange:()=>{e.windowResize.dispatch()}})),s.addControl(new Hu({category:"sidebar",name:"windows.settings.sidebar.shrinkSidebarElements.name",description:"windows.settings.sidebar.shrinkSidebarElements.description",key:"hideElements"})),s.addControl(new ze({omitFromSaveFile:!0,category:"general",name:"windows.settings.general.language.name",description:"windows.settings.general.language.description",key:"locale",options:ge.getAvailableLanguages(),default:ge.getCurrentLanguageId(),onChange:t=>{s.getState().reloadRequired=!0,ye("language",t)}})),s.addControl(new Y({category:"general",name:"windows.settings.general.collaborativeMode.name",description:"windows.settings.general.collaborativeMode.description",key:"fullLightningCacheRefresh",default:!0})),s.addControl(new Y({category:"general",name:"windows.settings.general.formatOnSave.name",description:"windows.settings.general.formatOnSave.description",key:"formatOnSave",default:!0})),s.addControl(new Y({category:"general",name:"windows.settings.general.openLinksInBrowser.name",description:"windows.settings.general.openLinksInBrowser.description",key:"openLinksInBrowser",default:!1})),s.addControl(new Y({category:"general",name:"windows.settings.general.restoreTabs.name",description:"windows.settings.general.restoreTabs.description",key:"restoreTabs",default:!0})),A.value||s.addControl(new Ru({category:"general",name:"windows.settings.general.resetBridgeFolder.name",description:"windows.settings.general.resetBridgeFolder.description",onClick:async()=>{await Je("bridgeBaseDir"),await Je(Ze),location.reload()}})),s.addControl(new ze({category:"editor",name:"windows.settings.editor.jsonEditor.name",description:"windows.settings.editor.jsonEditor.description",key:"jsonEditor",options:[{text:"Tree Editor",value:"treeEditor"},{text:"Raw Text",value:"rawText"}],default:"rawText"})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.bracketPairColorization.name",description:"windows.settings.editor.bracketPairColorization.description",key:"bracketPairColorization",default:!1,onChange:async t=>{e.projectManager.updateAllEditorOptions({"bracketPairColorization.enabled":t})}})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.wordWrap.name",description:"windows.settings.editor.wordWrap.description",key:"wordWrap",default:!1,onChange:async t=>{e.projectManager.updateAllEditorOptions({wordWrap:t?"bounded":"off"})}})),s.addControl(new ze({category:"editor",name:"windows.settings.editor.wordWrapColumns.name",description:"windows.settings.editor.wordWrapColumns.description",key:"wordWrapColumns",default:"80",options:["40","60","80","100","120","140","160"],onChange:async t=>{e.projectManager.updateAllEditorOptions({wordWrapColumn:Number(t)})}})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.compactTabDesign.name",description:"windows.settings.editor.compactTabDesign.description",key:"compactTabDesign",default:!0})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.keepTabsOpen.name",description:"windows.settings.editor.keepTabsOpen.description",key:"keepTabsOpen",default:!1})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.autoSaveChanges.name",description:"windows.settings.editor.autoSaveChanges.description",key:"autoSaveChanges",default:e.mobile.isCurrentDevice()})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.bridgePredictions.name",description:"windows.settings.editor.bridgePredictions.description",key:"bridgePredictions",default:!1})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.automaticallyOpenTreeNodes.name",description:"windows.settings.editor.automaticallyOpenTreeNodes.description",key:"automaticallyOpenTreeNodes",default:!0})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.dragAndDropTreeNodes.name",description:"windows.settings.editor.dragAndDropTreeNodes.description",key:"dragAndDropTreeNodes",default:!0})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.showArrayIndices.name",description:"windows.settings.editor.showArrayIndices.description",key:"showArrayIndices",default:!1})),s.addControl(new Y({category:"editor",name:"windows.settings.editor.hideBracketsWithinTreeEditor.name",description:"windows.settings.editor.hideBracketsWithinTreeEditor.description",key:"hideBracketsWithinTreeEditor",default:!1})),s.addControl(new Ku({category:"projects",name:"windows.settings.projects.defaultAuthor.name",description:"windows.settings.projects.defaultAuthor.description",key:"defaultAuthor",default:""})),s.addControl(new Y({category:"projects",name:"windows.settings.projects.loadComMojangProjects.name",description:"windows.settings.projects.loadComMojangProjects.description",key:"loadComMojangProjects",default:!0})),s.addControl(new Y({category:"projects",name:"windows.settings.projects.incrementVersionOnExport.name",description:"windows.settings.projects.incrementVersionOnExport.description",key:"incrementVersionOnExport",default:A.value})),s.addControl(new Y({category:"projects",name:"windows.settings.projects.addGeneratedWith.name",description:"windows.settings.projects.addGeneratedWith.description",key:"addGeneratedWith",default:!0})),Object.values(e.actionManager.state).forEach(t=>{t.type==="action"&&s.addControl(new Pu(t))})}class Qu extends Lt{constructor(){super(...arguments);c(this,"lastFilter")}get elements(){let t;const i=this._elements.value.filter(n=>{if(n.type==="category")return!0;const r=this.getState(n.id).some(o=>o.matches(this.filter));return!t&&r&&(t=n.id),r});return t&&this.lastFilter!==this.filter&&this.currentState.length===0&&this.setDefaultSelected(t),this.lastFilter=this.filter,this.sortSidebar(i)}get currentState(){var t;return this.selected?((t=this.state[this.selected])!=null?t:[]).filter(i=>i.matches(this.filter)):[]}}const Nn=class extends ee{constructor(t){super(du,!1,!0);c(this,"sidebar",new Qu([]));c(this,"bridgeCategory",new bi({items:[],text:"bridge."}));c(this,"state",q({...super.getState(),reloadRequired:!1}));this.parent=t,this.defineWindow()}async setup(){this.addCategory("general",R("windows.settings.general.name"),"mdi-circle-outline"),this.addCategory("appearance",R("windows.settings.appearance.name"),"mdi-palette-outline"),this.addCategory("editor","Editor","mdi-pencil-outline"),this.addCategory("actions",R("windows.settings.actions.name"),"mdi-keyboard-outline"),this.addCategory("sidebar",R("windows.settings.sidebar.name"),"mdi-table-column"),this.addCategory("developers",R("windows.settings.developer.name"),"mdi-wrench-outline"),this.addCategory("projects",R("windows.settings.projects.name"),"mdi-folder-open-outline"),await Yu(this),this.sidebar.setDefaultSelected()}addCategory(t,i,n){b[t]===void 0&&(b[t]={}),this.sidebar.addElement(new $e({color:"primary",text:i,icon:n,id:t}),[])}addControl(t){const i=this.sidebar.state[t.config.category];if(!i)throw new Error(`Undefined settings category: ${t.config.category}`);i.push(t)}static async saveSettings(t){t||(t=await u.getApp()),await t.fileSystem.writeJSON("~local/data/settings.json",b)}static async loadSettings(t){try{ao(await t.fileSystem.readJSON("~local/data/settings.json"))}catch{}finally{this.loadedSettings.dispatch(b)}}async open(){this.state.isVisible||(this.sidebar.removeElements(),await this.setup(),super.open())}async close(){super.close();const t=await u.getApp();t.windows.loadingWindow.open(),await Nn.saveSettings(),t.windows.loadingWindow.close()}};let _e=Nn;c(_e,"loadedSettings",new $);const Zu=({disposables:s,extensionId:e})=>({SidebarContent:Nt,SidebarAction:mt,SelectableSidebarAction:ft,create(t){t.id||(console.error("SidebarModule: config.id is required"),t.id=`${e}//${t.displayName}`);const i=Ke(t);return t.id&&_e.loadedSettings.once(n=>{var a,r,o;i.isVisibleSetting=(o=(r=(a=n==null?void 0:n.sidebar)==null?void 0:a.sidebarElements)==null?void 0:r[t.id])!=null?o:!0}),s.push(i),i},getSelected(){throw new Error("This function no longer works with bridge. v2")},onChange(){throw new Error("This function no longer works with bridge. v2")},select(){throw new Error("This function no longer works with bridge. v2")}});async function _n({directoryHandle:s,name:e,forceWrite:t}){let i;try{i=await s.getFileHandle(e)}catch{return i=await s.getFileHandle(e,{create:!0}),{type:"create",handle:i}}return t?{type:"overwrite",handle:i}:await new N({description:"general.confirmOverwriteFile"}).fired?{type:"overwrite",handle:i}:{type:"cancel"}}async function _i(s,e){return s.getDirectoryHandle(e).then(()=>!0).catch(()=>!1)}async function ia(s,e){return s.getFileHandle(e).then(()=>!0).catch(()=>!1)}async function na({toDirectory:s,moveHandle:e,forceWrite:t}){const i=await _i(s,e.name);let n="move";if(!t&&(i||await ia(s,e.name))){if(!await new N({description:i?"general.confirmOverwriteFolder":"general.confirmOverwriteFile"}).fired)return"cancel";n="overwrite"}try{return await e.move(s),n}catch{return"moveFailed"}}async function Sn(s){return s.moveHandle.kind==="file"?await Cn(s):s.moveHandle.kind==="directory"?await Xu(s):{type:"cancel"}}async function Cn({fromHandle:s,toHandle:e,moveHandle:t},i=!1){if(typeof t.move=="function"){const l=await na({toDirectory:e,moveHandle:t,forceWrite:i});if(l!=="moveFailed")return{type:l,handle:t}}const n=await t.getFile(),{type:a,handle:r}=await _n({directoryHandle:e,name:t.name,forceWrite:i});if(!r)return{type:"cancel"};const o=await r.createWritable();return await o.write(n),await o.close(),s&&await s.removeEntry(t.name),{type:a==="overwrite"?"overwrite":"move",handle:r}}async function Xu({fromHandle:s,toHandle:e,moveHandle:t}){if(typeof t.move=="function"){const r=await na({moveHandle:t,toDirectory:e});if(r!=="moveFailed")return{type:r,handle:t}}const i=new Z(e);let n="move";if(await _i(e,t.name)&&(n="overwrite",!await new N({description:"general.confirmOverwriteFolder"}).fired))return{type:"cancel"};const a=await i.getDirectoryHandle(t.name,{create:!0});return await we(t,async(r,o,l)=>{await Cn({moveHandle:r,fromHandle:l,toHandle:await i.getDirectoryHandle(ve(o),{create:!0})},!0)},new Set,t.name),s&&await s.removeEntry(t.name,{recursive:!0}),{type:n,handle:a}}async function sa({newName:s,parentHandle:e,renameHandle:t,forceWrite:i}){const n=await _i(e,s);let a="rename";if(!i&&(n||await ia(e,s))){if(!await new N({description:n?"general.confirmOverwriteFolder":"general.confirmOverwriteFile"}).fired)return"cancel";a="overwrite"}try{return await t.move(s),a}catch{return"renameFailed"}}async function ep(s){return s.renameHandle.kind==="file"?await tp(s):s.renameHandle.kind==="directory"?await ip(s):{type:"cancel"}}async function tp({renameHandle:s,newName:e,parentHandle:t},i=!1){if(typeof s.move=="function"){const l=await sa({parentHandle:t,renameHandle:s,newName:e,forceWrite:i});if(l!=="renameFailed")return{type:l,handle:s}}const n=await s.getFile(),{type:a,handle:r}=await _n({directoryHandle:t,name:e,forceWrite:i});if(!r)return{type:"cancel"};const o=await r.createWritable();return await o.write(n),await o.close(),await t.removeEntry(s.name),{type:a==="create"?"rename":"overwrite",handle:r}}async function ip({parentHandle:s,renameHandle:e,newName:t}){if(typeof e.move=="function"){const o=await sa({parentHandle:s,renameHandle:e,newName:t});if(o!=="renameFailed")return{type:o,handle:e}}const i=new Z(s),n=e.name;let a="rename";if(await _i(s,t)&&(a="overwrite",!await new N({description:"general.confirmOverwriteFolder"}).fired))return{type:"cancel"};const r=await i.getDirectoryHandle(t,{create:!0});return await we(e,async(o,l,d)=>{await Cn({moveHandle:o,fromHandle:d,toHandle:await i.getDirectoryHandle(ve(l),{create:!0})},!0)},new Set,t),s&&await s.removeEntry(n,{recursive:!0}),{type:a,handle:r}}function xn(s,e){return s instanceof ot&&e instanceof ot?s.isSameEntry(e):s instanceof ot||e instanceof ot?!1:s.isSameEntry(e)}class kn{constructor(e,t,i){c(this,"isSelected",F(!1));c(this,"isEditingName",F(!1));this.parent=e,this.handle=t,this.options=i}get name(){var e;return this.handle.name===""?(e=this.options.startPath)!=null?e:"":this.handle.name}get path(){var t;if(!this.parent)return(t=this.options.startPath)!=null?t:null;const e=this.parent.path;return e?`${e}/${this.name}`:this.name}get color(){var t,i,n,a;const e=this.path;return e?(a=(n=(i=u.packType.get(e))==null?void 0:i.color)!=null?n:this.options.defaultIconColor)!=null?a:"accent":(t=this.options.defaultIconColor)!=null?t:"accent"}getParent(){return this.parent}async isSame(e){return await xn(e.handle,this.handle)}onRightClick(e,t){this._onRightClick(e,t),this.unselectAll(),this.isSelected.value=!0}onClick(e,t=!1){this._onClick(e,t),(H()==="darwin"&&!e.metaKey||H()!=="darwin"&&!e.ctrlKey)&&this.unselectAll(),this.isSelected.value=!0;const i=e.composedPath().find(n=>n.classList.contains("directory-viewer-name"));i&&i.focus()}async move(e){var r,o;if(this.parent===e)return;const t=this.path,i=this.parent;this.parent=e;const{type:n,handle:a}=await Sn({fromHandle:i.handle,toHandle:this.parent.handle,moveHandle:this.handle});a&&(this.handle=a),n==="cancel"?(this.parent=i,e.children.value=e.children.value.filter(l=>l!==this),i.children.value.push(this),i.sort()):n==="overwrite"&&(e.children.value=e.children.value.filter(l=>l===this||!l.isSame(this))),(o=(r=this.options).onHandleMoved)==null||o.call(r,{movedHandle:this.handle,fromHandle:this.parent.handle,fromPath:t,toPath:this.path,toHandle:this.parent.handle}),e.sort()}async rename(e){var r,o;if(this.name===e)return;const t=this.path,i=this.parent,{type:n,handle:a}=await ep({parentHandle:i.handle,renameHandle:this.handle,newName:e});a&&(this.handle=a),n!=="cancel"&&(n==="overwrite"&&(this.getParent().children.value=this.getParent().children.value.filter(l=>l===this||!l.isSame(this))),(o=(r=this.options).onHandleMoved)==null||o.call(r,{movedHandle:this.handle,fromHandle:i.handle,fromPath:t,toPath:this.path,toHandle:this.parent.handle}),await this.parent.refresh())}startRename(){this.options.isReadOnly||this.parent===null||(this.isEditingName.value=!0)}async confirmRename(e){!e||(this.isEditingName.value=!1,await this.rename(e))}async onFilesAdded(e){var t,i;await((i=(t=this.options).onFilesAdded)==null?void 0:i.call(t,e))}}const Xe={item:null},Si=s=>({icon:"mdi-content-copy",name:"actions.copy.name",onTrigger:async()=>{Xe.item=s.handle}}),np=s=>({icon:"mdi-plus",name:"actions.open.name",onTrigger:async()=>{(await u.getApp()).project.openFile(s.handle,{readOnlyMode:s.options.isReadOnly?"forced":"off"})}}),sp=s=>({icon:"mdi-arrow-split-vertical",name:"actions.openInSplitScreen.name",onTrigger:async()=>{(await u.getApp()).project.openFile(s.handle,{openInSplitScreen:!0,readOnlyMode:s.options.isReadOnly?"forced":"off"})}});const ap={name:"HTMLPreviewTab",props:{tab:Object},async mounted(){const s=await u.getApp();setTimeout(()=>this.updateIframe(),50),this.disposable=s.windowResize.on(()=>{setTimeout(()=>this.updateIframe(),50)})},destroyed(){this.disposable&&(this.disposable.dispose(),this.disposable=null)},data:()=>({disposable:null}),methods:{async updateIframe(){if(await this.tab.fired,!this.$refs.container)return;if(!this.$refs.container.isConnected){setTimeout(()=>this.updateIframe(),50);return}const{width:s,height:e,top:t,left:i}=this.$refs.container.getBoundingClientRect();this.tab.iframe.height=`${e-16}px`,this.tab.iframe.width=`${s-16}px`,this.tab.iframe.style.top=`${t}px`,this.tab.iframe.style.left=`${i}px`}},watch:{tab(){setTimeout(()=>this.updateIframe(),50)}}};var rp=function(){var e=this,t=e._self._c;return t("div",{ref:"container"})},op=[],cp=_(ap,rp,op,!1,null,null,null,null);const lp=cp.exports;class aa{constructor(e){c(this,"disposables",[]);this.api=e,this.disposables.push(this.api.loaded.on(()=>this.onApiLoaded(),!0),this.api.loaded.once(()=>this.setup(),!0))}onApiLoaded(){}dispose(){this.disposables.forEach(e=>e.dispose()),this.disposables=[]}}class dp extends aa{async setup(){const e=await u.getApp();this.disposables.push(e.themeManager.on(()=>{this.api.trigger("themeManager.themeChange",e.themeManager.getCurrentTheme())})),this.api.trigger("themeManager.themeChange",e.themeManager.getCurrentTheme())}}class at{constructor(e,t){c(this,"disposables",[]);this.api=t,this.api.channelSetup.once(()=>{this.disposables.push(this.api.channel.on(e,(i,n)=>this.handle(i,n)))})}dispose(){this.disposables.forEach(e=>e.dispose()),this.disposables=[]}}const ra="~bridge://OPENED-FILE";async function Ci(s,e,t=!1){if(s===ra){const i=e.openedFileHandle;if(!i)throw new Error("No opened file to write to!");return i}return await e.app.fileSystem.getFileHandle(s,t)}class up extends at{constructor(e){super("fs.readFile",e)}async handle(e,t){const n=await(await Ci(e,this.api)).getFile();return new Uint8Array(await n.arrayBuffer())}}class pp extends at{constructor(e){super("fs.writeFile",e)}async handle({filePath:e,data:t},i){const n=await u.getApp(),a=await Ci(e,this.api,!0);await n.fileSystem.write(a,t)}}class hp extends at{constructor(e){super("fs.readTextFile",e)}async handle(e,t){return await(await(await Ci(e,this.api)).getFile()).text()}}class mp extends aa{setup(){this.api.trigger("tab.openFile",this.api.openWithPayload)}}class fp extends at{constructor(e){super("project.getItemPreview",e)}async handle(e,t){var S,v,C,P,k,T;const i=this.api.app,n=i.project,a=n.packIndexer,r=i.fileSystem;await a.fired;const[o]=await a.service.find("item","identifier",[e],!1),l=await r.readJSON(o).catch(()=>null);if(l===null)return null;const d=(C=(v=(S=l["minecraft:item"])==null?void 0:S.components)==null?void 0:v["minecraft:icon"])!=null?C:null;if(d===null)return null;const p=(P=d.texture)!=null?P:null;if(p===null)return null;const h=await r.readJSON(n.config.resolvePackPath("resourcePack","textures/item_texture.json")).catch(()=>null);if(h===null||!h.texture_data)return null;const m=(k=h.texture_data[p])!=null?k:null;if(m===null)return null;let f=null;if(typeof m=="string"?f=m:typeof m=="object"&&typeof m.textures=="string"?f=m.textures:typeof m=="object"&&Array.isArray(m.textures)&&(f=(T=m.textures[0])!=null?T:null),f===null)return null;const g=n.config.resolvePackPath("resourcePack",f);console.log(g);const w=await dn(r,g,[".png",".jpg",".jpeg",".tga"]);if(console.log(w),w===void 0)return null;const y=await r.getFileHandle(w).catch(()=>null);return y===null?null:await r.loadFileHandleAsDataUrl(y)}}class gp extends at{constructor(e){super("fs.readAsDataUrl",e)}async handle(e,t){const i=await Ci(e,this.api);return await vi(i)}}class wp extends at{constructor(e){super("packIndexer.find",e)}async handle({findFileType:e,whereCacheKey:t,matchesOneOf:i,fetchAll:n},a){const r=this.api.app.project.packIndexer;return await r.fired,await r.service.find(e,t,i,n)}}class yp extends at{constructor(e){super("packIndexer.getFile",e)}async handle(e,t){const i=this.api.app.project.packIndexer;await i.fired;const n=u.fileType.getId(e);return await i.service.getCacheDataFor(n,e)}}class vp{constructor(e,t){c(this,"didSetup",!1);c(this,"loaded",new $);c(this,"channelSetup",new $);c(this,"disposables",[]);c(this,"_channel");c(this,"events",[new dp(this),new mp(this)]);c(this,"requests",[new up(this),new hp(this),new gp(this),new pp(this),new fp(this),new wp(this),new yp(this)]);this.tab=e,this.iframe=t,this.iframe.addEventListener("load",async()=>{!t.src&&!t.srcdoc||(this._channel=new fr(this.iframe.contentWindow),this.channelSetup.dispatch(),await ii(20),await this.channel.open(),this.loaded.dispatch(),this.onLoad())})}get app(){return this.tab.project.app}get openWithPayload(){var t,i;const e=(t=this.tab.getOptions().openWithPayload)!=null?t:{};return{filePath:e.filePath,fileReference:ra,isReadOnly:(i=e.isReadOnly)!=null?i:!1}}get openedFileHandle(){var e,t;return(t=(e=this.tab.getOptions().openWithPayload)==null?void 0:e.fileHandle)!=null?t:null}get channel(){if(!this._channel)throw new Error("Channel is not initialized yet. Make sure to await iframeApi.loaded.fired");return this._channel}on(e,t){return this.channel.on(e,t)}trigger(e,t){return this.channel.simpleTrigger(e,t)}onLoad(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.trigger("app.buildInfo",{appVersion:de,isNightlyBuild:Ee})}dispose(){this.events.forEach(e=>e.dispose()),this.events=[],this.requests.forEach(e=>e.dispose()),this.requests=[]}}class qe extends yt{constructor(t,i={}){var n;super(t);c(this,"component",lp);c(this,"iframe",document.createElement("iframe"));c(this,"loaded");c(this,"api",x(new vp(this,this.iframe)));this.options=i,this.isTemporary=!1,this.iframe.setAttribute("sandbox","allow-scripts allow-same-origin allow-modals allow-popups allow-forms allow-downloads"),this.loaded=new Promise(a=>this.iframe.addEventListener("load",()=>a())),this.url&&this.setUrl(this.url),this.options.html&&(this.iframe.srcdoc=this.options.html),this.iframe.width="100%",this.iframe.style.display="none",this.iframe.style.position="absolute",this.iframe.classList.add("outlined"),this.iframe.style.borderRadius="12px",this.iframe.style.margin="8px",(n=qn())==null||n.appendChild(this.iframe)}getOptions(){return this.options}async setup(){await super.setup()}async onActivate(){await super.onActivate(),this.isLoading=!0,await this.loaded,this.isLoading=!1,this.isActive&&(this.iframe.style.display="block")}onDeactivate(){super.onDeactivate(),this.iframe.style.display="none"}onDestroy(){var t;(t=qn())==null||t.removeChild(this.iframe),this.api.dispose()}get icon(){var t;return(t=this.options.icon)!=null?t:"mdi-web"}get iconColor(){return this.options.iconColor}get name(){var t;return(t=this.options.name)!=null?t:"Web"}get url(){return this.options.url}set srcdoc(t){this.api.loaded.resetSignal(),this.iframe.srcdoc=t}set src(t){this.api.loaded.resetSignal(),this.iframe.src=t}setUrl(t){this.iframe.src=t}async is(t){return t instanceof qe&&t.url===this.url}}let ke=yn.dependencies["bridge-iframe-api"];ke.startsWith("^")||ke.startsWith("~")||ke.startsWith(">")||ke.startsWith("<")?ke=ke.substring(1):(ke.startsWith(">=")||ke.startsWith("<="))&&(ke=ke.substring(2));const bp=ke;class xi extends qe{constructor(t,i){super(t);c(this,"rawHtml","");c(this,"defaultStyles","");c(this,"themeListener");c(this,"fileListener");c(this,"messageListener");c(this,"scrollY",0);this.previewOptions=i;const n=t.app.themeManager;this.updateDefaultStyles(n),this.themeListener=n.on(()=>this.updateDefaultStyles(n)),i.filePath&&(this.fileListener=t.app.project.fileChange.on(i.filePath,async a=>{await this.load(a)})),this.api.loaded.once(()=>{this.api.on("saveScrollPosition",a=>{a!==0&&(this.scrollY=a)})})}async setup(){await this.load(),await super.setup()}async onActivate(){await super.onActivate(),await this.api.loaded.fired,this.api.trigger("loadScrollPosition",this.scrollY)}onDeactivate(){var t;(t=this.messageListener)==null||t.dispose(),this.messageListener=void 0,super.onDeactivate()}onDestroy(){var t,i;(t=this.themeListener)==null||t.dispose(),this.themeListener=void 0,(i=this.fileListener)==null||i.dispose(),this.fileListener=void 0}get icon(){return"mdi-language-html5"}get iconColor(){return"behaviorPack"}get name(){return`${R("preview.name")}: ${this.fileHandle.name}`}get fileHandle(){return this.previewOptions.fileHandle}get html(){return this.rawHtml.replaceAll('href="#','href="about:srcdoc#')+`<link
				rel="stylesheet"
				href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"
			/><style>${this.defaultStyles}</style><script type="module">
				import { Channel } from "https://unpkg.com/bridge-iframe-api@${bp}/dist/bridge-iframe-api.es.js"

				const channel = new Channel()

				await channel.connect()
	
				window.addEventListener('scroll', () => {
					channel.simpleTrigger('saveScrollPosition', window.scrollY)
				})
			
				channel.on('loadScrollPosition', (scrollY) => {
					window.scrollTo(0, scrollY)
				})
			<\/script>`}updateDefaultStyles(t){this.defaultStyles=`html {
			color: ${t.getColor("text")};
			font-family: Roboto;
		}
		
		a {
			color: ${t.getColor("primary")};
		}
	
		textarea, input {
			background-color: ${t.getColor("background")};
			color: ${t.getColor("text")};
		}`,this.rawHtml!==""&&this.updateHtml()}async updateHtml(){this.srcdoc=this.html,await this.api.loaded.fired,this.api.trigger("loadScrollPosition",this.scrollY)}async load(t){t||(t=await this.fileHandle.getFile()),this.rawHtml=await t.text(),this.updateHtml()}async is(t){return t instanceof xi&&await t.fileHandle.isSameEntry(this.fileHandle)}}const _p=(s,e)=>s.name.endsWith(".html")?{icon:"mdi-language-html5",name:"openWith.htmlPreviewer",onTrigger:async()=>{const i=(await u.getApp()).tabSystem;!i||i.add(new xi(i,{fileHandle:s,filePath:e!=null?e:void 0}))}}:null,Sp=s=>s.name.endsWith(".json")?{icon:"mdi-file-tree-outline",name:"openWith.treeEditor",onTrigger:async()=>{const t=(await u.getApp()).tabSystem;!t||t.add(new Mt(t,s.handle,s.options.isReadOnly?"forced":"off"))}}:null,Cp=[".png",".jpg",".jpeg",".tga",".fsb",".wav",".ogg"],xp=s=>{const e=me(s.name);return Cp.includes(e)?null:{icon:"mdi-pencil-outline",name:"openWith.textEditor",onTrigger:async()=>{const i=(await u.getApp()).tabSystem;!i||i.add(new ht(i,s.handle,s.options.isReadOnly?"forced":"off"))}}},kp=s=>{if(!s.name.endsWith(".json"))return null;const e=s.path;if(!e)return null;const t=u.fileType.getId(e);return t==="particle"||t==="unknown"&&e.includes("particles/")?{icon:"mdi-snowflake",name:"openWith.snowstorm",onTrigger:async()=>{const n=(await u.getApp()).tabSystem;if(!n)return;const a=await s.handle.getFile();L.parse(await a.text());const r=new Uint8Array(await a.arrayBuffer()),o=btoa(Qi(bs(r,{level:9}),!0)),l=new URL("https://snowstorm.app/");l.searchParams.set("loadParticle",o),n.add(new qe(n,{icon:"mdi-snowflake",name:`Snowstorm: ${s.name}`,url:l.href,iconColor:"primary"}))}}:null},Ji=new Set,Pp=async s=>{var n,a,r;const e=[xp(s),Sp(s),_p(s.handle,(n=s.path)!=null?n:void 0)].filter(o=>o!==null),t=[kp(s)].filter(o=>o!==null);for(const o of Ji){const l={isReadOnly:s.options.isReadOnly,fileHandle:s.handle,filePath:s.path};!((r=await((a=o.isAvailable)==null?void 0:a.call(o,l)))==null||r)||t.push({icon:o.icon,name:o.name,onTrigger:async()=>{await o.onOpen(l)}})}const i=[...e,e.length>0&&t.length>0?{type:"divider"}:null,...t].filter(o=>o!==null);return i.length<=1?null:{type:"submenu",icon:"mdi-open-in-app",name:"actions.openWith.name",actions:i}},oa=s=>A.value?null:{icon:s.kind==="directory"?"mdi-folder-marker-outline":"mdi-file-marker-outline",name:"actions.revealPath.name",onTrigger:async()=>{new J({name:"actions.revealPath.name",description:`[${s.path}]`,isPersistent:!1}).open()}};async function ca(s){const e=[];for await(const t of s.values())e.push(t);return e}async function jp(s,e){var a,r;const t=await ca(e),i=me(s);let n=fe(s,i);for(;t.find(o=>o.name===n+i);)if(!n.includes(" copy"))n=`${n} copy`;else{const o=parseInt((r=(a=n.match(/copy (\d+)/))==null?void 0:a[1])!=null?r:"1");n=n.replace(/ \d+$/,"")+` ${o+1}`}return n+i}async function ki(s,e){var n,a;const t=await ca(e);let i=s;for(;t.find(r=>r.name===i);)if(!i.includes(" copy"))i=`${i} copy`;else{const r=parseInt((a=(n=i.match(/copy (\d+)/))==null?void 0:n[1])!=null?a:"1");i=i.replace(/ \d+$/,"")+` ${r+1}`}return i}const Pi=s=>({icon:"mdi-content-paste",name:"actions.paste.name",onTrigger:async()=>{if(s.options.isReadOnly||!Xe.item)return;const e=Xe.item,t=await u.getApp(),i=t.project;s.isOpen.value||await s.open();let n;if(e.kind==="file"){const a=await jp(e.name,s.handle);n=await s.handle.getFileHandle(a,{create:!0}),await t.fileSystem.copyFileHandle(e,n)}else if(e.kind==="directory"){t.windows.loadingWindow.open();const a=await ki(e.name,s.handle);n=await s.handle.getDirectoryHandle(a,{create:!0}),await t.fileSystem.copyFolderByHandle(e,n),t.windows.loadingWindow.close()}else throw new Error("Invalid handle kind: "+e.kind);return await s.refresh(),n&&await i.updateHandle(n),n}}),Fp=s=>({icon:"mdi-content-duplicate",name:"actions.duplicate.name",onTrigger:async()=>{const e=s.getParent();if(!e)return;Xe.item=s.handle;const t=await Pi(e).onTrigger();if(!t)return;const i=e.getChild(t.name);!i||(i.isEditingName.value=!0)}}),Tp=s=>({icon:"mdi-pencil-outline",name:"actions.rename.name",onTrigger:()=>{s.isEditingName.value=!0}}),la=s=>({icon:"mdi-delete-outline",name:"actions.delete.name",onTrigger:async()=>{var r,o;const e=s.getParent();if(s.options.isReadOnly||e===null)return;const t=await u.getApp(),i=l=>R(l);if(!await new N({description:`[${i("actions.delete.confirmText")} "${(r=s.path)!=null?r:s.name}"? ${i("actions.delete.noRestoring")}]`}).fired)return;await t.project.unlinkHandle(s.handle)||await e.handle.removeEntry(s.name,{recursive:!0}),await((o=s.getParent())==null?void 0:o.refresh())}}),da=async(s,e={})=>({type:"submenu",icon:s instanceof Fe?"mdi-folder-edit-outline":"mdi-file-edit-outline",name:"actions.edit.name",actions:[Si(s),Pi(s instanceof Fe?s:s.getParent()),e.hideDuplicate?null:Fp(s),e.hideRename?null:Tp(s),e.hideDelete?null:la(s)]});class ji{constructor(e){this.handle=e}async package(e){let t={};return await At(this.handle,async(i,n)=>{const a=await i.getFile();t[n]=new Uint8Array(await a.arrayBuffer())},e),new Promise((i,n)=>gr(t,{level:6},(a,r)=>{if(a){n(a);return}i(r)}))}}const ua=s=>({icon:s.kind==="directory"?"mdi-folder-download-outline":"mdi-file-download-outline",name:"actions.download.name",onTrigger:async()=>{if(s.kind==="file"){const e=await s.handle.getFile();pt(s.name,new Uint8Array(await e.arrayBuffer()))}else{const e=new ji(s.handle);pt(`${s.name}.zip`,await e.package())}}});async function Ap(s,e){var i,n;const t=await((n=(i=e.options).provideFileContextMenu)==null?void 0:n.call(i,e));De(s,[np(e),await Pp(e),sp(e),{type:"divider"},e.options.isReadOnly?Si(e):await da(e),{type:"divider"},{icon:"mdi-share",name:"general.shareFile",onTrigger:async()=>{await Os(e.handle)}},ua(e),oa(e),...t!=null?t:[]])}class pa extends kn{constructor(t,i,n){super(t,i,n);c(this,"kind","file")}get icon(){var i,n;const t=this.path;return t?(n=(i=u.fileType.get(t))==null?void 0:i.icon)!=null?n:ei(this.handle.name):ei(this.handle.name)}async getFirstDiagnostic(){return null}async openFile(t=!1){await(await u.getApp()).project.openFile(this.handle,{selectTab:!0,readOnlyMode:this.options.isReadOnly?"forced":"off",isTemporary:!t})}_onRightClick(t){var i,n;Ap(t,this),(n=(i=this.options).onFileRightClick)==null||n.call(i,t,this)}async _onClick(t,i){var n;if(i){const r=(n=(await u.getApp()).project.tabSystem)==null?void 0:n.selectedTab;r&&r.isTemporary&&(r.isTemporary=!1)}this.openFile()}unselectAll(){var t;(t=this.parent)==null||t.unselectAll()}}const It={matchCase:0,ignoreCase:1,useRegExp:2},$p={name:"SearchType",props:{value:Number}};var Ep=function(){var e=this,t=e._self._c;return t("v-btn-toggle",{attrs:{dense:"",mandatory:"",value:e.value},on:{change:i=>e.$emit("input",i)}},[t("v-btn",{staticStyle:{"min-width":"unset"},attrs:{title:"Match Case",color:"menu"}},[t("v-icon",[e._v("mdi-format-letter-case-upper")])],1),t("v-btn",{staticStyle:{"min-width":"unset"},attrs:{title:"Ignore Case",color:"menu"}},[t("v-icon",[e._v("mdi-format-letter-case")])],1),t("v-btn",{staticStyle:{"min-width":"unset"},attrs:{title:"Use Regular Expression",color:"menu"}},[t("v-icon",[e._v("mdi-regex")])],1)],1)},Dp=[],Mp=_($p,Ep,Dp,!1,null,null,null,null);const Ip=Mp.exports;const Op={name:"Match",props:{replaceWith:String,showReplaceWith:Boolean,item:Object}};var Rp=function(){var e=this,t=e._self._c;return t("div",{staticClass:"code-font code-match",staticStyle:{width:"100%","overflow-x":"hidden"}},[t("span",[e._v(e._s(e.item.isStartOfFile?"":"...")+e._s(e.item.beforeMatch))]),t("span",{class:{"error--text text-decoration-line-through":e.showReplaceWith,"success--text":!e.showReplaceWith}},[e._v(e._s(e.item.match))]),e.showReplaceWith?t("span",{staticClass:"success--text"},[e._v(e._s(e.replaceWith))]):e._e(),t("span",[e._v(e._s(e.item.afterMatch)+"...")])])},Wp=[],Lp=_(Op,Rp,Wp,!1,null,"3d3eaa64",null,null);const Np=Lp.exports;const Bp={name:"FileName",props:{displayFilePath:String,filePath:String,fileHandle:{}},methods:{getFileIcon(s){var e;return(e=(u.fileType.get(s)||{}).icon)!=null?e:"mdi-file-outline"},getIconColor(s){return(u.packType.get(s)||{}).color},async openFile(){(await u.getApp()).project.openFile(this.fileHandle)}}};var Vp=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"font-weight-black clickable px-1",staticStyle:{display:"inline-block",width:"fit-content"},on:{click:e.openFile}},[t("v-icon",{staticStyle:{position:"relative",top:"-2px"},attrs:{small:"",color:e.getIconColor(e.filePath)}},[e._v(" "+e._s(e.getFileIcon(e.filePath))+" ")]),e._v(" "+e._s(e.displayFilePath)+" ")],1)},Hp=[],Up=_(Bp,Vp,Hp,!1,null,null,null,null);const zp=Up.exports;function Jp(s,e,t){return s.replace(e,(i,...n)=>(n=n.slice(0,-2),t.replace(/{(\d+)}/g,(a,...r)=>{var o;return(o=n[Number(r[0])])!=null?o:a})))}function qp(s,e){let t;try{t=new RegExp(e===It.useRegExp?s:wr(s),`g${e===It.ignoreCase?"i":""}`)}catch{return}return t}const Gp=X({__name:"Tab",props:{tab:{type:Object,required:!0},height:Number},setup(s){const e=s,{t}=O(),i=B(()=>e.tab.state),n=B(()=>u.instance.mobile.is.value||e.tab.parent.isSharingScreen.value),a=B(()=>i.value.queryResults.map(({matches:g,...w})=>[w,...g]).flat()),r=F(null);Cs(()=>{r.value&&(r.value.$el.scrollTop=i.value.scrollTop)}),yr(()=>{r.value&&(r.value.$el.scrollTop=i.value.scrollTop)});const o=He(async function(){await e.tab.updateQuery()},250);function l(g){i.value.scrollTop=g.target.scrollTop}function d(){e.tab.executeQuery()}function p(g){return Jp(g,qp(i.value.searchFor,i.value.queryOptions.searchType),i.value.replaceWith)}function h(g,w){e.tab.executeSingleQuery(g,w)}let m="",f=0;return Zt(()=>{(i.value.searchFor!==m||i.value.queryOptions.searchType!==f)&&(m=i.value.searchFor,f=i.value.queryOptions.searchType,o())}),{__sfc:!0,t,props:e,state:i,hasLimitedSpace:n,displayQueryResults:a,virtualScroller:r,updateQuery:o,onScroll:l,onReplaceAll:d,processReplaceWith:p,onReplaceSingleFile:h,lastSearchQuery:m,lastSearchType:f,SearchType:Ip,Match:Np,FilePath:zp,pointerDevice:te}}});var Kp=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("div",{staticClass:"px-3"},[t("div",{staticClass:"d-flex",class:{"flex-column":i.hasLimitedSpace}},[t("v-col",{staticClass:"flex-grow-0 flex-shrink-0 align-center",attrs:{cols:i.hasLimitedSpace?12:3}},[t("v-text-field",{staticClass:"mb-2",attrs:{"prepend-inner-icon":"mdi-magnify",outlined:"",dense:"","hide-details":"",autofocus:i.pointerDevice==="mouse",label:i.t("findAndReplace.search")},model:{value:i.state.searchFor,callback:function(n){e.$set(i.state,"searchFor",n)},expression:"state.searchFor"}}),i.state.queryOptions.isReadOnly?e._e():t("v-text-field",{staticClass:"mb-2",attrs:{"prepend-inner-icon":"mdi-file-replace-outline",outlined:"",dense:"","hide-details":"",label:i.t("findAndReplace.replace")},model:{value:i.state.replaceWith,callback:function(n){e.$set(i.state,"replaceWith",n)},expression:"state.replaceWith"}}),i.state.queryOptions.isReadOnly?e._e():t("v-btn",{staticClass:"mb-2",attrs:{color:"primary",block:"",disabled:i.state.replaceWith===""||i.state.searchFor==="",loading:e.tab.isLoading},on:{click:function(n){return i.onReplaceAll()}}},[t("v-icon",{staticClass:"mr-1",attrs:{small:""}},[e._v("mdi-file-replace-outline")]),e._v(" "+e._s(i.t("findAndReplace.replaceAll"))+" ")],1),t(i.SearchType,{staticClass:"mb-2",model:{value:i.state.queryOptions.searchType,callback:function(n){e.$set(i.state.queryOptions,"searchType",n)},expression:"state.queryOptions.searchType"}})],1),t("v-col",{staticClass:"flex-grow-1 flex-shrink-0",attrs:{cols:i.hasLimitedSpace?12:9}},[t("v-card",{staticClass:"pa-2",staticStyle:{background:"var(--v-expandedSidebar-base)"},style:`white-space: nowrap; height: ${(i.hasLimitedSpace?400:e.height)-24}px`,attrs:{outlined:"",rounded:""}},[i.state.queryResults.length===0?t("p",{staticStyle:{"white-space":"normal"}},[e._v(" "+e._s(i.t(`findAndReplace.no${i.state.searchFor===""?"Search":"Results"}`))+" ")]):e._e(),t("v-virtual-scroll",{ref:"virtualScroller",attrs:{items:i.displayQueryResults,height:(i.hasLimitedSpace?400:e.height)-40,bench:30,"item-height":"22"},nativeOn:{scroll:function(n){return i.onScroll.apply(null,arguments)}},scopedSlots:e._u([{key:"default",fn:function({item:n}){return[n.filePath?t("div",{staticStyle:{display:"inline-flex",width:"calc(100% - 8px)"}},[t(i.FilePath,{attrs:{filePath:n.filePath,displayFilePath:n.displayFilePath,fileHandle:n.fileHandle}}),t("v-spacer"),i.state.queryOptions.isReadOnly?e._e():t("v-btn",{staticStyle:{position:"relative",top:"3px"},attrs:{icon:"","x-small":"",disabled:i.state.replaceWith===""},on:{click:function(a){return i.onReplaceSingleFile(n.filePath,n.fileHandle)}}},[t("v-icon",[e._v("mdi-file-replace-outline")])],1)],1):t(i.Match,{attrs:{showReplaceWith:!!i.state.replaceWith,replaceWith:i.processReplaceWith(n.match),item:n}})]}}])})],1)],1)],1)])},Yp=[],Qp=_(Gp,Kp,Yp,!1,null,null,null,null);const Zp=Qp.exports;function Xp(){return new Worker("/assets/Worker.f00fc75a.js")}const eh=Xi(new Xp);class Pn extends yt{constructor(t,i,n){super(t);c(this,"component",x(Zp));c(this,"findAndReplace");c(this,"directories",x([]));c(this,"state",q({scrollTop:0,searchFor:"",replaceWith:"",queryOptions:{isReadOnly:!1,searchType:It.matchCase},queryResults:[]}));c(this,"shouldLoadPackDirs",!1);c(this,"isSearchFree",new sn);this.parent=t,n&&(this.state.queryOptions=n),i?this.directories=x(i):this.shouldLoadPackDirs=!0}async setup(){if(await this.isSearchFree.lock(),this.shouldLoadPackDirs){this.shouldLoadPackDirs=!1;const t=this.parent.app,i=t.project,n=i.getPacks();for(const a of n){const r=i.config.resolvePackPath(a),o=await t.fileSystem.getDirectoryHandle(r).catch(()=>null);o&&this.directories.push({directory:o,path:r})}}this.findAndReplace=await new eh(this.parent.projectRoot,this.parent.project.projectPath),await super.setup(),this.isSearchFree.unlock()}async updateQuery(){this.isTemporary=!1,await this.isSearchFree.lock(),this.isLoading=!0,this.state.queryResults=await this.findAndReplace.createQuery(this.directories,this.state.searchFor,this.state.queryOptions),this.isLoading=!1,this.state.scrollTop=0,this.isSearchFree.unlock()}async executeQuery(){await this.isSearchFree.lock(),this.isLoading=!0,await this.findAndReplace.executeQuery(this.directories,this.state.searchFor,this.state.replaceWith,this.state.queryOptions),await Promise.all(this.state.queryResults.map(({fileHandle:t})=>this.parent.app.project.updateHandle(t))),this.state.queryResults=[],this.state.scrollTop=0,this.isLoading=!1,this.isSearchFree.unlock()}async executeSingleQuery(t,i){await this.isSearchFree.lock(),this.isLoading=!0;const n=await this.findAndReplace.setMatchedFiles([t]);await this.findAndReplace.executeQuery(this.directories,this.state.searchFor,this.state.replaceWith,this.state.queryOptions),await this.findAndReplace.setMatchedFiles(n.filter(a=>a!==t)),await this.parent.app.project.updateHandle(i),this.state.queryResults=this.state.queryResults.filter(a=>a.filePath!==t),this.isLoading=!1,this.isSearchFree.unlock()}static is(){return!1}async is(){return!1}async onActivate(){}get icon(){return"mdi-file-search-outline"}get iconColor(){return"success"}get name(){const t=i=>R(i);return(this.state.queryOptions.isReadOnly?t("findAndReplace.findOnly"):t("findAndReplace.name"))+(this.directories.length===1?`: "${this.directories[0].directory.name}"`:"")}save(){}}const os=s=>({icon:"mdi-file-search-outline",name:"actions.findInFolder.name",onTrigger:async()=>{var i,n;const t=(await u.getApp()).project;(n=t.tabSystem)==null||n.add(new Pn(t.tabSystem,[{directory:s.handle,path:(i=s.path)!=null?i:""}],{searchType:It.matchCase,isReadOnly:s.options.isReadOnly}))}}),th=s=>({icon:"mdi-import",name:"actions.importFile.name",onTrigger:async()=>{const e=await window.showOpenFilePicker({multiple:!0});for(const i of e)await Sn({moveHandle:i,toHandle:s.handle});if(await s.refresh(),s.path===null)return;const t=e.map(i=>`${s.path}/${i.name}`);s.onFilesAdded(t)}}),ih=s=>({icon:"mdi-refresh",name:"general.refresh",onTrigger:()=>{s.refresh()}}),nh=X({__name:"Input",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState();function n(){e.window.close(null),i.inputValue=""}function a(){e.window.confirm(),i.inputValue=""}return{__sfc:!0,t,props:e,state:i,onClose:n,onConfirm:a,BaseWindow:ce,pointerDevice:te}}});var sh=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,width:440,height:120},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"d-flex justify-center align-center"},[t("v-text-field",{staticClass:"mr-2",attrs:{label:i.t(e.window.label),outlined:"",dense:"",autofocus:i.pointerDevice==="mouse","hide-details":""},nativeOn:{keydown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:i.onConfirm.apply(null,arguments)}},model:{value:i.state.inputValue,callback:function(n){e.$set(i.state,"inputValue",n)},expression:"state.inputValue"}}),e.window.expandText!==""?t("span",{staticClass:"expand-text text--secondary"},[e._v(" "+e._s(e.window.expandText)+" ")]):e._e()],1)]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary",disabled:i.state.inputValue===""},on:{click:i.onConfirm}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(e._s(i.t("general.confirm")))])],1)]},proxy:!0}],null,!1,1573498354)}):e._e()},ah=[],rh=_(nh,sh,ah,!1,null,null,null,null);const oh=rh.exports;class qi extends ee{constructor(t){var i;super(oh,!0,!1);c(this,"state",q({...super.getState(),inputValue:""}));this.opts=t,this.state.inputValue=(i=t.default)!=null?i:"",super.defineWindow(),super.open()}get title(){return this.opts.name}get label(){return this.opts.label}get expandText(){return this.opts.expandText}async confirm(){var i;const t=this.state.inputValue+((i=this.expandText)!=null?i:"");typeof this.opts.onConfirm=="function"&&await this.opts.onConfirm(t),super.close(t)}}async function ch({directoryHandle:s,name:e,forceWrite:t}){let i;try{i=await s.getDirectoryHandle(e)}catch{return i=await s.getDirectoryHandle(e,{create:!0}),{type:"create",handle:i}}return t?{type:"overwrite",handle:i}:await new N({description:"general.confirmOverwriteFolder"}).fired?{type:"overwrite",handle:i}:{type:"cancel"}}async function jn(s,e,t={}){var r,o;const i=await u.getApp();e.path;const n=[{icon:"mdi-file-plus-outline",name:"actions.createFile.name",onTrigger:async()=>{const d=await new qi({name:"actions.createFile.name",label:"general.fileName",default:""}).fired;if(!d)return;const{type:p,handle:h}=await _n({directoryHandle:e.handle,name:d});p!=="cancel"&&(h&&(i.project.updateHandle(h),await i.project.openFile(h,{selectTab:!0})),e.refresh())}},{icon:"mdi-folder-plus-outline",name:"actions.createFolder.name",onTrigger:async()=>{const d=await new qi({name:"actions.createFolder.name",label:"general.folderName",default:""}).fired;if(!d)return;const{type:p}=await ch({directoryHandle:e.handle,name:d});p!=="cancel"&&e.refresh()}},th(e),os(e),{type:"divider"},await da(e,t)].filter(l=>l!==null),a=await((o=(r=e.options).provideDirectoryContextMenu)==null?void 0:o.call(r,e));De(s,[...e.options.isReadOnly?[os(e),Si(e)]:n,{type:"divider"},ih(e),ua(e),oa(e),...a!=null?a:[]])}const lh=[".DS_Store"];class Fe extends kn{constructor(t,i,n){super(t,i,n);c(this,"kind","directory");c(this,"isOpen",F(!1));c(this,"isLoading",F(!1));c(this,"children",F(null))}get icon(){return this.isOpen.value?"mdi-folder-open":"mdi-folder"}async getChildren(){const t=[];try{for await(const i of this.handle.values())i.kind==="directory"?t.push(x(new Fe(this,i,this.options))):i.kind==="file"&&!lh.includes(i.name)&&t.push(x(new pa(this,i,this.options)))}catch{console.error("Trying to access non-existent directory",this.path)}return this.sortChildren(t),t}sortChildren(t){return t.sort((i,n)=>i.kind===n.kind?i.name.localeCompare(n.name):i.kind==="directory"?-1:n.kind==="directory"?1:0)}async load(){if(this.children.value){console.warn("Children are already loaded");return}this.children.value=await this.getChildren()}getOpenFolders(t=[]){const i=[];return this.isOpen.value&&t.length!==0&&i.push(t),this.children.value&&this.children.value.forEach(n=>{n.kind==="directory"&&i.push(...n.getOpenFolders(t?[...t,n.name]:[n.name]))}),i}async openFolderPaths(t,i){if(t.length!==0)for(const n of t){const a=i.find(r=>r.name===n[0]&&r.kind==="directory");a&&(await a.open(),a.children.value&&await a.openFolderPaths([n.slice(1)],a.children.value))}}async refresh(){const t=this.getOpenFolders([]),i=await this.getChildren();await this.openFolderPaths(t,i),this.children.value=i}sort(){this.children.value&&this.sortChildren(this.children.value)}async toggleOpen(t=!1){this.isOpen.value?this.close(t):await this.open(t)}async close(t=!1){var i;this.isOpen.value=!1,t&&((i=this.children.value)==null||i.forEach(n=>{n instanceof Fe&&n.close(!0)}))}async open(t=!1){var i;this.isOpen.value&&!t||(this.children.value?this.isOpen.value=!0:(this.isLoading.value=!0,await this.load(),this.isOpen.value=!0,this.isLoading.value=!1),t&&((i=this.children.value)==null||i.forEach(n=>{n instanceof Fe&&n.open(!0)})))}getChild(t){var i;if(!this.children.value)throw new Error("Cannot use directoryWrapper.getChild(..) because children are not loaded yet");return(i=this.children.value)==null?void 0:i.find(n=>n.name===t)}_unselectAll(){var t;this.isSelected.value=!1,(t=this.children.value)==null||t.forEach(i=>{i.isSelected.value=!1,i.kind==="directory"&&i._unselectAll()})}unselectAll(){if(this.parent===null)return this._unselectAll();this.parent.unselectAll()}_onRightClick(t){var i,n;jn(t,this,{hideDelete:this.parent===null,hideRename:this.parent===null,hideDuplicate:this.parent===null}),(n=(i=this.options).onDirectoryRightClick)==null||n.call(i,t,this)}_onClick(t,i){i?this.isOpen.value?this.open(!0):this.close(!0):this.toggleOpen(i)}}class ha{static async getCachedDirectoryHandle(e){for(const[t,i]of this.cache.entries())if(await xn(t,e))return await i.refresh(),i;return null}static async getDirectory(e,t={}){const i=await this.getCachedDirectoryHandle(e);if(i)return i;const n=new Fe(null,e,t);return await n.open(),this.cache.set(e,x(n)),n}static async disposeDirectory(e){this.cache.delete(e)}}c(ha,"cache",new Map);const dh={props:{name:String,icon:String,color:String,opacity:Number,showName:{type:Boolean,default:!0}}};var uh=function(){var e=this,t=e._self._c;return t("span",e._g({staticClass:"icon-name",style:{opacity:e.opacity}},e.$listeners),[t("v-icon",{staticClass:"pr-1",attrs:{color:e.color,small:""}},[e._v(" "+e._s(e.icon)+" ")]),e.showName?t("span",{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},[e._v(" "+e._s(e.name)+" ")]):e._e()],1)},ph=[],hh=_(dh,uh,ph,!1,null,"1216ba2d",null,null);const mh=hh.exports;function fh(s,e=!1){let t=null,i=0;return(...n)=>{if(te.value==="touch")return s(!1,...n);i===0?(i++,e&&s(!1,...n),t=window.setTimeout(()=>{i=0,t=null,e||s(!1,...n)},500)):(t&&window.clearTimeout(t),i=0,s(!0,...n))}}const gh={components:{BasicIconName:mh},mixins:[G],props:{type:{type:String,default:"file"},tagName:{type:String,default:"div"},baseWrapper:{type:kn,required:!0},diagnostic:Object},setup(s){return{onClick:fh((t,i)=>{s.baseWrapper.onClick(i,t)},!0),pointerDevice:te}},data(){return{isFocused:!1,currentName:"",rules:{required:s=>!!s,validName:s=>/^[^\\/:*?"<>|]*$/.test(s),notSameName:s=>H()==="win32"?s.toUpperCase()!==this.baseWrapper.name.toUpperCase():s!==this.baseWrapper.name}}},computed:{diagnosticIcon(){return this.diagnostic.icon||"mdi-alert-circle"},diagnosticIconColor(){switch(this.diagnostic.type){case"info":return"info";case"warning":return"warning";default:case"error":return"error"}},diagnosticOpacity(){return this.diagnostic&&this.diagnostic.opacity||1},hasDiagnostic(){return this.diagnostic!==void 0&&this.diagnostic!==null}},methods:{onEnter(s){H()==="darwin"?this.baseWrapper.startRename():this.onClick(s)},onFocus(){this.isFocused=!0,!this.baseWrapper.isSelected.value&&this.select()},onKeyDown(s){s.target.tagName!=="INPUT"&&(s.code==="Enter"?this.onEnter(s):H()!=="darwin"&&s.code==="F2"&&this.baseWrapper.startRename(),!(H()==="darwin"&&!s.metaKey)&&(H()!=="darwin"&&!s.ctrlKey||(s.code==="KeyC"?Si(this.baseWrapper).onTrigger():s.code==="KeyV"?Pi(this.baseWrapper.kind==="directory"?this.baseWrapper:this.baseWrapper.getParent()).onTrigger():s.code==="Backspace"&&la(this.baseWrapper).onTrigger())))},cancelRename(){this.baseWrapper.isEditingName.value=!1},confirmRename(){if(!this.rules.notSameName(this.currentName)){this.cancelRename();return}!this.rules.validName(this.currentName)||this.currentName.length===0||this.baseWrapper.confirmRename(this.currentName)},focus(){this.$refs.name&&this.$refs.name.focus()},select(){this.baseWrapper.unselectAll(),this.baseWrapper.isSelected.value=!0}},watch:{"baseWrapper.isEditingName.value"(){this.baseWrapper.isEditingName.value?(this.currentName=this.baseWrapper.name,this.$nextTick(()=>{const s=this.$refs.renameInput.$el.getElementsByTagName("input")[0];if(s){const t=me(this.currentName)?this.currentName.indexOf(me(this.currentName)):s.value.length;s.setSelectionRange(0,t)}})):this.focus()}}};var wh=function(){var e=this,t=e._self._c;return t(e.tagName,{directives:[{name:"ripple",rawName:"v-ripple",value:!e.baseWrapper.isEditingName.value,expression:"!baseWrapper.isEditingName.value"}],ref:"name",tag:"component",staticClass:"directory-viewer-name d-flex justify-center align-center px-1 rounded-lg",class:{selected:e.baseWrapper.isSelected.value,"drag-handle":!e.baseWrapper.isEditingName.value},attrs:{tabindex:"0"},on:{click:function(i){return i.preventDefault(),e.onClick(i)},keydown:[function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"space",32,i.key,[" ","Spacebar"]))return null;i.preventDefault(),e.isFocused&&e.onClick(i)},function(i){return i.stopPropagation(),e.onKeyDown.apply(null,arguments)}],contextmenu:function(i){return i.preventDefault(),i.stopPropagation(),e.baseWrapper.onRightClick(i)},focus:function(i){return i.ctrlKey||i.shiftKey||i.altKey||i.metaKey?null:e.onFocus.apply(null,arguments)},blur:function(i){e.isFocused=!1}}},[e.hasDiagnostic&&!e.baseWrapper.isEditingName.value?t("v-tooltip",{attrs:{color:e.diagnosticIconColor,right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("BasicIconName",e._g({attrs:{name:e.baseWrapper.name,icon:e.diagnosticIcon,color:e.diagnosticIconColor,opacity:e.diagnosticOpacity,showName:!e.baseWrapper.isEditingName.value}},i))]}}],null,!1,2634215617)},[t("span",[e._v(e._s(e.diagnostic?e.t(e.diagnostic.text):""))])]):[t("BasicIconName",{attrs:{name:e.baseWrapper.name,icon:e.baseWrapper.icon,color:e.baseWrapper.color,showName:!e.baseWrapper.isEditingName.value}})],e.baseWrapper.isEditingName.value?t("v-text-field",{ref:"renameInput",style:{position:"relative",top:"-3px"},attrs:{autofocus:"",dense:"","hide-details":"",height:"20px",rules:[e.rules.validName,e.rules.required]},on:{blur:e.cancelRename,keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:(i.stopPropagation(),i.preventDefault(),e.confirmRename.apply(null,arguments))},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"esc",27,i.key,["Esc","Escape"])?null:(i.stopPropagation(),i.preventDefault(),e.cancelRename.apply(null,arguments))}],click:function(i){i.stopPropagation()}},nativeOn:{keydown:function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"space",32,i.key,[" ","Spacebar"]))return null;i.preventDefault(),i.stopPropagation()}},model:{value:e.currentName,callback:function(i){e.currentName=i},expression:"currentName"}}):e._e(),t("v-spacer"),e.isFocused?t("v-icon",{attrs:{color:e.baseWrapper.color}},[e._v(" mdi-circle-small ")]):e._e(),e.pointerDevice==="touch"?t("v-btn",{directives:[{name:"ripple",rawName:"v-ripple",value:!1,expression:"false"}],attrs:{text:"",icon:"",small:""},on:{click:function(i){return i.stopPropagation(),e.baseWrapper.onRightClick(i)}}},[t("v-icon",[e._v(" mdi-dots-vertical-circle-outline ")])],1):e._e()],2)},yh=[],vh=_(gh,wh,yh,!1,null,"0e988ace",null,null);const ma=vh.exports,bh={components:{Name:ma},name:"FileView",props:{fileWrapper:pa},mounted(){this.fileWrapper.getFirstDiagnostic().then(s=>{this.diagnostic=s})},data:()=>({isFocused:!1,diagnostic:void 0})};var _h=function(){var e=this,t=e._self._c;return t("Name",{attrs:{baseWrapper:e.fileWrapper,diagnostic:e.diagnostic}})},Sh=[],Ch=_(bh,_h,Sh,!1,null,null,null,null);const xh=Ch.exports,kh=F(!1);const Ph={name:"DirectoryView",components:{Draggable:Zi,FileView:xh,Name:ma},props:{directoryWrapper:Fe,renderDirectoryName:{default:!0,type:Boolean}},setup(){return{isDraggingWrapper:kh,pointerDevice:te}},data:()=>({selectedFromFileDrag:!1,openedFromFileDrag:!1}),computed:{isReadOnly(){return this.directoryWrapper.options.isReadOnly}},methods:{async onDragEnter(s){this.isReadOnly||this.isDraggingWrapper||(s.preventDefault(),s.stopPropagation(),this.select(!0),this.directoryWrapper.kind==="directory"&&!this.directoryWrapper.isOpen.value&&(this.openedFromFileDrag=!0,await this.directoryWrapper.open(!0)))},async onDrop(s){var n,a;if(this.isReadOnly||this.isDraggingWrapper)return;s.preventDefault(),s.stopPropagation(),this.isOpenedFromFileDrag=!1,this.selectedFromFileDrag=!1;const e=Xe.item,t=[...(a=(n=s.dataTransfer)==null?void 0:n.items)!=null?a:[]];if(t.length===0)return;s.preventDefault(),s.stopPropagation();const i=Pi(this.directoryWrapper);for(const r of t){const o=await r.getAsFileSystemHandle();!o||(Xe.item=o,await i.onTrigger())}await this.directoryWrapper.refresh(),Xe.item=e},onDragLeave(s){this.isReadOnly||this.isDraggingWrapper||(s.preventDefault(),s.stopPropagation(),this.selectedFromFileDrag&&(this.directoryWrapper.isSelected.value=!1),this.selectedFromFileDrag=!1,this.openedFromFileDrag&&this.directoryWrapper.close(!1))},select(s=!1){s?this.selectedFromFileDrag=!0:this.directoryWrapper.unselectAll(),this.directoryWrapper.isSelected.value=!0},draggedHandle(s){if(s.moved){const{newIndex:e,oldIndex:t,element:i}=s.moved;this.directoryWrapper.children.value.splice(e,1),this.directoryWrapper.children.value.splice(t,0,i)}else s.added&&s.added.element.move(this.directoryWrapper)}}};var jh=function(){var e=this,t=e._self._c;return t(e.renderDirectoryName?"details":"div",{tag:"component",attrs:{open:e.directoryWrapper.isOpen.value},on:{dragenter:e.onDragEnter,dragleave:e.onDragLeave,drop:e.onDrop}},[e.renderDirectoryName?t("Name",{attrs:{type:"directory",tagName:"summary",baseWrapper:e.directoryWrapper}}):e._e(),e.directoryWrapper.isOpen.value?t("Draggable",{class:{"ml-2":e.renderDirectoryName},attrs:{group:"directory-view",handle:".drag-handle",disabled:e.isReadOnly||e.pointerDevice==="touch"},on:{start:function(i){e.isDraggingWrapper=!0},end:function(i){e.isDraggingWrapper=!1},change:e.draggedHandle},model:{value:e.directoryWrapper.children.value,callback:function(i){e.$set(e.directoryWrapper.children,"value",i)},expression:"directoryWrapper.children.value"}},[e._l(e.directoryWrapper.children.value,function(i,n){return[i.kind==="directory"?t("DirectoryView",{key:`${n}//${i.name}`,attrs:{directoryWrapper:i}}):i.kind==="file"?t("FileView",{key:`${n}//${i.name}`,attrs:{fileWrapper:i}}):t("div",{key:`${n}//${i.name}`},[t("v-icon",{attrs:{color:"error",small:""}},[e._v(" mdi-alert-circle-outline ")]),e._v(' Unknown directory entry kind: "'+e._s(i.kind)+'" ')],1)]})],2):e._e()],1)},Fh=[],Th=_(Ph,jh,Fh,!1,null,"6146b46b",null,null);const Ah=Th.exports,$h={components:{DirectoryView:Ah},props:{directoryHandle:{required:!0},renderTopLevelDirectory:Boolean,options:Object},setup(s){const e=F(null);return s.directoryHandle instanceof Fe?e.value=s.directoryHandle:ha.getDirectory(s.directoryHandle,s.options).then(t=>{e.value=t}),{directoryWrapper:e}}};var Eh=function(){var e=this,t=e._self._c;return e.directoryWrapper?t("DirectoryView",{staticClass:"mx-1",attrs:{directoryWrapper:e.directoryWrapper,renderDirectoryName:e.renderTopLevelDirectory}}):t("v-progress-linear",{attrs:{indeterminate:""}})},Dh=[],Mh=_($h,Eh,Dh,!1,null,null,null,null);const Fi=Mh.exports,Ih=async({uiStore:s})=>(await(s==null?void 0:s.allLoaded.fired),{...s==null?void 0:s.UI,BuiltIn:{BaseWindow:ce,SidebarWindow:_t,DirectoryViewer:Fi,BridgeSheet:Oe}}),Oh=({disposables:s})=>({create(e){const t=wi(e);return s.push(t),t},createError(e){const t=Ne(e);return s.push(t),t}}),Rh=({disposables:s})=>new Promise(e=>{u.ready.once(t=>{const i={onBridgeFolderSetup:n=>{s.push(t.bridgeFolderSetup.once(n,!0))}};for(const n of Object.getOwnPropertyNames(Object.getPrototypeOf(t.fileSystem)))n!=="constructor"&&typeof t.fileSystem[n]=="function"&&(i[n]=t.fileSystem[n].bind(t.fileSystem));e(i)})}),Wh=({})=>({APP_VERSION:de,isNightlyBuild:Ee,getCurrentBP(){return u.getApp().then(s=>s.projectConfig.resolvePackPath("behaviorPack"))},getCurrentRP(){return u.getApp().then(s=>s.projectConfig.resolvePackPath("resourcePack"))},getCurrentProject(){return u.instance.project.projectPath},getProjectPrefix(){return u.getApp().then(s=>s.projectConfig.get().namespace)},getProjectTargetVersion(){return u.getApp().then(s=>s.projectConfig.get().targetVersion)},getProjectAuthors(){return u.getApp().then(s=>s.projectConfig.get().authors)},resolvePackPath(s,e){return u.getApp().then(t=>t.projectConfig.resolvePackPath(s,e))},getContext(){return console.warn("This API is deprecated!"),{}}}),Lh=({})=>({openExternal:s=>window.open(s,"_blank")}),Nh=()=>nc,Bh=({})=>({fetchDefinition:async(s,e,t,i=!1)=>{var o;const a=(o=(await u.getApp()).project)==null?void 0:o.packIndexer;return a?(await Promise.all(e.map(l=>{var d,p;return(p=(d=a.service)==null?void 0:d.find(s,l,[t],i))!=null?p:[]}))).flat():[]}});function Vh(s,e={},t=!0,i=()=>{}){const n={};n.done=new Promise(l=>{n.setDone=l});const a=E(),r=wt(Object.assign(e,{isVisible:!1,shouldRender:!1})),o={component:s,getState:()=>r,close:()=>{i(),r.isVisible=!1,setTimeout(()=>{r.shouldRender=!1,t&&o.dispose()},600)},open:()=>{r.shouldRender=!0,r.isVisible=!0},dispose:()=>Se(u.windowState.state,a),status:n,get isVisible(){return r.isVisible}};return U(u.windowState.state,a,o),o}const Hh=X({__name:"Dropdown",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState();function n(){e.window.close(null)}function a(){e.window.confirm()}return{__sfc:!0,t,props:e,state:i,onClose:n,onConfirm:a,BaseWindow:ce,pointerDevice:te}}});var Uh=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,isPersistent:!e.window.isClosable,hasCloseButton:!1,width:440,height:140},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("v-autocomplete",{staticClass:"mt-4",attrs:{autofocus:i.pointerDevice==="mouse",outlined:"",dense:"",items:e.window.options,"background-color":"background"},model:{value:i.state.currentSelection,callback:function(n){e.$set(i.state,"currentSelection",n)},expression:"state.currentSelection"}})]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary",disabled:!i.state.currentSelection},on:{click:i.onConfirm}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(e._s(i.t("general.confirm")))])],1)]},proxy:!0}],null,!1,413649646)}):e._e()},zh=[],Jh=_(Hh,Uh,zh,!1,null,null,null,null);const qh=Jh.exports;class et extends ee{constructor(t){var i;super(qh,!0,!1);c(this,"state",q({...super.state,currentSelection:void 0}));this.opts=t,this.state.currentSelection=(i=t.default)!=null?i:t.options[0],this.defineWindow(),this.open()}get title(){return this.opts.name}get options(){return this.opts.options}get placeholder(){return this.opts.placeholder}get isClosable(){return this.opts.isClosable}async confirm(){const t=typeof this.state.currentSelection=="object"?this.state.currentSelection.value:this.state.currentSelection;typeof this.opts.onConfirm=="function"&&await this.opts.onConfirm(t),super.close(t!=null?t:null)}}const Gh=({})=>({BaseWindow:ee,createWindow:(s,e)=>(console.warn('[@bridge/windows] Calling "createWindow" is deprecated. Please replace direct function calls by defining a class based window instead.'),Vh(s,e)),createInformationWindow:(s,e)=>new J({name:s,description:e}),createInputWindow:(s,e,t,i,n)=>new qi({name:s,label:e,default:t,expandText:n,onConfirm:i}),createDropdownWindow:(s,e,t,i,n)=>new et({name:s,default:i,options:t,placeholder:e,onConfirm:n}),createConfirmWindow:(s,e,t,i,n)=>new N({description:s,confirmText:e,cancelText:t,onConfirm:i,onCancel:n})});let Jt;const Kh=async({})=>{try{if(Jt===void 0)return new Promise(s=>{u.ready.once(async e=>{Jt=await e.fileSystem.readJSON(`${e.project.projectPath}/globals.json`).catch(()=>{}),s(Jt)})})}catch{return{}}return{...Jt}};class Ie extends z{constructor(){super(...arguments);c(this,"id",E());c(this,"type","divider")}}class Ue extends z{constructor(t,i){super();c(this,"id",E());c(this,"type","category");c(this,"shouldRender",!0);c(this,"isVisible",!1);c(this,"state",q({}));c(this,"disposables",{});this.icon=t,this.name=i,u.getApp().then(n=>{n.mobile.change.on(a=>this.setShouldRender(!a))})}setShouldRender(t){this.shouldRender=t}addItem(t){return U(this.state,t.id,t),this.disposables[t.id]=t.on(()=>this.trigger()),this}disposeItem(t){var i;Se(this.state,t.id),(i=this.disposables[t.id])==null||i.dispose(),this.disposables[t.id]=void 0}toNestedMenu(){return{type:"submenu",icon:this.icon,name:this.name,actions:Object.values(this.state).map(t=>{if(t instanceof Is)return{...t.getConfig(),description:void 0,keyBinding:void 0};if(t instanceof Ue)return null;if(t instanceof Ie)return{type:"divider"};throw new Error(`Unknown toolbar item type: ${t}`)})}}trigger(){this.isVisible=!1,this.dispatch()}dispose(){u.toolbar.disposeCategory(this)}}const Yh=async({disposables:s})=>({ToolbarCategory:Ue,actionManager:(await u.getApp()).actionManager,addCategory(e){u.toolbar.addCategory(e),s.push(e)}}),Qh=()=>({compare:Q}),Zh=({disposables:s})=>({registerDocumentFormattingEditProvider:async(e,t)=>{const{languages:i}=await I();s.push(i.registerDocumentFormattingEditProvider(e,t))}}),Xh=()=>({parse:s=>L.parse(s),stringify:(s,e,t)=>JSON.stringify(s,e,t)}),em=async({})=>{const s=await u.getApp();return{setup:s.comMojang.setup,requestFileSystem:async()=>{const e={};for(const t of Object.getOwnPropertyNames(Object.getPrototypeOf(s.comMojang.fileSystem)))t!=="constructor"&&typeof s.comMojang.fileSystem[t]=="function"&&(e[t]=s.comMojang.fileSystem[t].bind(s.comMojang.fileSystem));return e}}},tm={name:"ThreePreviewTab",props:{tab:Object},activated(){this.tab.receiveCanvas(this.$refs.canvas)},mounted(){this.tab.receiveCanvas(this.$refs.canvas)},watch:{"tab.uuid"(){this.tab.receiveCanvas(this.$refs.canvas)}}};var im=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{position:"relative"}},[t("div",{staticStyle:{width:"100%",height:"100%"},on:{click:function(i){return e.tab.parent.setActive(!0)}}},[t("canvas",{ref:"canvas"})])])},nm=[],sm=_(tm,im,nm,!1,null,null,null,null);const am=sm.exports;class rm extends yt{constructor(t,i){super(i);c(this,"isForeignFile",!0);this.tab=t,this.onCreate()}static is(){return!1}onCreate(){}async onActivate(){this.onChange(),this.isActive=!0}get name(){return`${R("preview.name")}: ${this.tab.name}`}save(){}getFile(){return this.tab.getFile()}}class Fn extends rm{constructor(){super(...arguments);c(this,"component",am);c(this,"setupComplete",new $);c(this,"disposables",[]);c(this,"canvas");c(this,"renderer");c(this,"_camera");c(this,"controls");c(this,"_scene");c(this,"renderingRequested",!1);c(this,"width",0);c(this,"height",0)}get scene(){if(!this._scene)throw new Error("Scene is not defined yet");return this._scene}get camera(){if(!this._camera)throw new Error("Camera is not defined yet");return this._camera}async is(){return!1}async receiveCanvas(t){var n;const i=await u.getApp();this.canvas=x(t),this.renderer=x(new vr({antialias:!0,canvas:t})),this.renderer.setPixelRatio(window.devicePixelRatio),this._camera||(this._camera=x(new br(70,2,.1,1e3)),this._camera.position.x=-16,this._camera.position.y=16,this._camera.position.z=-16),(n=this.controls)==null||n.dispose(),this.controls=x(new _r(this.camera,t)),this.controls.addEventListener("change",()=>{this.requestRendering(),this.parent.isActive||this.parent.setActive(!0)}),this._scene||(this._scene=x(new Sr),this._scene.add(new Cr(16777215))),this._scene.background=new Tt(i.themeManager.getColor("background")),this.disposables.push(i.windowResize.on(()=>setTimeout(()=>this.onResize()))),this.onResize(),await this.fired,this.setupComplete.dispatch()}async onActivate(){await this.setupComplete.fired,await super.onActivate();const t=await u.getApp();this.disposables.push(t.themeManager.on(()=>{const i=t.themeManager.getColor("background");this.scene.background=new Tt(i),this.requestRendering()}))}onDeactivate(){var t,i,n;this.setupComplete.resetSignal(),(t=this.controls)==null||t.dispose(),(i=this.renderer)==null||i.resetState(),(n=this.renderer)==null||n.dispose(),this.renderer=void 0,this.controls=void 0,super.onDeactivate()}render(){var t,i;(t=this.controls)==null||t.update(),(i=this.renderer)==null||i.render(this.scene,this.camera),this.renderingRequested=!1}async requestRendering(){this.renderingRequested||(this.renderingRequested=!0,await this.setupComplete.fired,requestAnimationFrame(()=>this.render()))}onResize(){var i,n,a,r,o;const t=(n=(i=this.canvas)==null?void 0:i.parentElement)==null?void 0:n.getBoundingClientRect();this.width=(a=t==null?void 0:t.width)!=null?a:0,this.height=(r=t==null?void 0:t.height)!=null?r:0,(o=this.renderer)==null||o.setSize(this.width,this.height,!0),this.camera&&(this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix()),this.requestRendering()}async toOtherTabSystem(t){await super.toOtherTabSystem(t),await this.setupComplete.fired,this.onResize()}}const om=async({disposables:s})=>{const e=await u.getApp(),t=()=>e.project;return{ContentTab:yt,FileTab:W,ThreePreviewTab:Fn,IframeTab:qe,register:i=>{const n=wn.register(i);return s.push(n),n},openTab:async(i,n=!1)=>{const a=n?t().inactiveTabSystem:t().tabSystem;if(!a)return;const r=new i(a);return n&&a.setActive(!0),a.add(r,!0),s.push({dispose:()=>a.remove(r)}),r},addTab(i){const n=t().tabSystem;!n||(n.add(i,!0),s.push({dispose:()=>n.remove(i)}))},getCurrentTabSystem(){return t().tabSystem},openFilePath:async(i,n=!1)=>{const a=await t().fileSystem.getFileHandle(i);await t().openFile(a,{selectTab:n})}}};function cs({isGlobal:s,func:e,disposables:t,app:i}){s?t.push(i.projectManager.forEachProject(e)):e(i.project)}const cm=async({disposables:s,isGlobal:e})=>({addTabActions:async t=>{(await u.getApp()).project.tabActionProvider.addTabActions(t)},register:async t=>{const i=await u.getApp();cs({app:i,disposables:s,isGlobal:e,func:n=>{s.push(n.tabActionProvider.register(t))}})},registerPreview:async t=>{const i=await u.getApp();cs({app:i,disposables:s,isGlobal:e,func:n=>{s.push(n.tabActionProvider.registerPreview(t))}})}}),lm=async({disposables:s})=>{const e=await u.getApp(),t=e.themeManager;return{onChange:i=>{const n=t.on(i);return s.push(n),n},getCurrentMode(){return e.themeManager.getCurrentMode()},getColor(i){return t.getColor(i)},getHighlighterInfo(i){return t.getHighlighterInfo(i)}}};class ls{constructor(e){this.config=e}get displayData(){return{icon:this.config.icon,name:this.config.name}}isDisabled(){if(typeof this.config.isDisabled=="function")return this.config.isDisabled()}export(){if(typeof this.config.export=="function")return this.config.export()}}const dm=async({disposables:s,isGlobal:e})=>{const t=await u.getApp();return{hasPacks(i){return t.project.hasPacks(i)},registerExporter(i){e?t.projectManager.forEachProject(n=>{s.push(n.exportProvider.register(new ls(i)))}):s.push(t.project.exportProvider.register(new ls(i)))},async compile(i){const n=await t.project.createDashService("production",i==="default"?void 0:`${t.project.projectPath}/.bridge/compiler/${i}`);await n.setup(),await n.build()},async compileFiles(i){await t.project.compilerService.updateFiles(i)},async unlinkFile(i){await t.project.unlinkFile(i)},onProjectChanged(i){const n=u.eventSystem.on("projectChanged",a=>i(a.name));return s.push(n),n},onFileChanged(i,n){const a=u.eventSystem.on("fileChange",([r,o])=>{r===i&&n(o)});return s.push(a),a},async openFile(i,n){await t.project.openFile(i,n)}}},um=()=>ue(()=>import("./vendor.1f611e46.js").then(s=>s.ba),["assets/vendor.1f611e46.js","assets/vendor.f6a4afb7.css"]);async function ci(){return await ue(()=>import("./model-viewer.es.95af1e3a.js"),["assets/model-viewer.es.95af1e3a.js","assets/vendor.1f611e46.js","assets/vendor.f6a4afb7.css","assets/wintersky.esm.0ccac7fa.js"])}const pm=async()=>{const{Model:s,StandaloneModelViewer:e}=await ci();return{Model:s,StandaloneModelViewer:e}},hm=({disposables:s})=>({addFolderImporter:async e=>{const t=await u.getApp();s.push(t.folderImportManager.addImporter(e))},async importHandle(e){await(await u.getApp()).fileDropper.import(e)},registerOpenWithHandler:e=>{Ji.add(e);const t={dispose:()=>{Ji.delete(e)}};return s.push(t),t}}),mm=()=>ue(()=>import("./vendor.1f611e46.js").then(s=>s.b9),["assets/vendor.1f611e46.js","assets/vendor.f6a4afb7.css"]),fm=()=>({ref:F,shallowRef:xr,computed:B,reactive:q,shallowReactive:wt,readonly:kr,shallowReadonly:Pr,markRaw:x,watch:dt,watchEffect:Zt,del:Se,set:U}),gm=new Map([["@bridge/ui",Ih],["@bridge/sidebar",Zu],["@bridge/notification",Oh],["@bridge/fs",Rh],["@bridge/path",Nh],["@bridge/env",Wh],["@bridge/project",dm],["@bridge/globals",Kh],["@bridge/utils",Lh],["@bridge/fetch-definition",Bh],["@bridge/windows",Gh],["@bridge/toolbar",Yh],["@bridge/compare-versions",Qh],["@bridge/monaco",Zh],["@bridge/json5",Xh],["@bridge/com-mojang",em],["@bridge/tab",om],["@bridge/tab-actions",cm],["@bridge/theme",lm],["@bridge/three",um],["@bridge/model-viewer",pm],["@bridge/import",hm],["@bridge/persistent-storage",Jd],["@bridge/command-bar",tc],["@bridge/fflate",mm],["@bridge/reactivity",fm]]);function wm(s,e=[],t,i=!1,n=gm){return[...n.entries()].map(([a,r])=>[a,()=>r({extensionId:s,disposables:e,uiStore:t,isGlobal:i})])}function ym(s,e=[],t,i=!1){return wm(s,e,t,i)}class vm{constructor(e,t,i,n=!1){c(this,"disposables",[]);c(this,"uiStore",jd());c(this,"fileSystem");c(this,"_compilerPlugins",{});c(this,"isLoaded",!1);c(this,"installFiles");c(this,"hasPresets",!1);c(this,"jsRuntime");var a;this.parent=e,this._manifest=t,this.baseDirectory=i,this._isGlobal=n,this.fileSystem=new Z(this.baseDirectory),this.installFiles=new zd(this.fileSystem,(a=t==null?void 0:t.contributeFiles)!=null?a:{}),this.jsRuntime=new ri(ym(this.id,this.disposables,this.uiStore,this.isGlobal))}get isActive(){var e;if(!this.parent.activeStatus)throw new Error("Accessed activeStatus property before the corresponding ActiveClass instance was initialized");return(e=this.parent.activeStatus)==null?void 0:e.isActive(this.manifest.id)}get compilerPlugins(){return this._compilerPlugins}get contributesCompilerPlugins(){var e,t,i;return Object.keys((i=(t=(e=this.manifest)==null?void 0:e.compiler)==null?void 0:t.plugins)!=null?i:{}).length>0}get description(){return this.manifest.description}get version(){return this.manifest.version}get isGlobal(){return this._isGlobal}get id(){return this.manifest.id}get manifest(){return this._manifest}isCompatibleAppEnv(){return this.manifest.compatibleAppVersions?(this.manifest.compatibleAppVersions.min&&Q(de,this.manifest.compatibleAppVersions.min,">=")||!this.manifest.compatibleAppVersions.min)&&(this.manifest.compatibleAppVersions.max&&Q(de,this.manifest.compatibleAppVersions.max,"<")||!this.manifest.compatibleAppVersions.max):!0}async activate(){var a,r,o,l;if(this.isLoaded||!this.isCompatibleAppEnv())return;this.isLoaded=!0;const e=await u.getApp(),t=((a=await e.fileSystem.baseDirectory.resolve(this.baseDirectory))!=null?a:[]).join("/");for(const d of(r=this.manifest.dependencies)!=null?r:[])if(!await this.parent.activate(d)){Ne(new Error(`Failed to activate extension "${this.manifest.name}": Failed to load one of its dependencies`));return}if(!this.isGlobal){const d=u.instance.extensionLoader;d.has(this.id)&&d.deactivate(this.id)}for(const[d,p]of Object.entries((l=(o=this.manifest.compiler)==null?void 0:o.plugins)!=null?l:{}))this._compilerPlugins[d]=`${t}/${p}`;await this.fileSystem.fileExists("presets.json")?(this.hasPresets=!0,u.eventSystem.dispatch("presetsChanged",null),this.disposables.push(e.windows.createPreset.addPresets(`${t}/presets.json`))):await this.fileSystem.directoryExists("presets")&&(this.hasPresets=!0,this.disposables.push(e.windows.createPreset.addPresets(`${t}/presets`)),u.eventSystem.dispatch("presetsChanged",null));try{await we(await this.baseDirectory.getDirectoryHandle("themes"),d=>e.themeManager.loadTheme(d,this.isGlobal,this.disposables))}catch{}try{await Ud(await this.baseDirectory.getDirectoryHandle("fileDefinitions"),this.disposables)}catch{}let i=null;try{i=await this.baseDirectory.getDirectoryHandle("scripts")}catch{}let n=null;try{n=await this.baseDirectory.getDirectoryHandle("ui")}catch{}if(n&&await kd(this.jsRuntime,n,this.uiStore,this.disposables),i&&await Fd(this.jsRuntime,i),await this.fileSystem.directoryExists("snippets")){const d=await this.baseDirectory.getDirectoryHandle("snippets");this.isGlobal?this.disposables.push(e.projectManager.onActiveProject(async p=>{this.disposables.push(...await p.snippetLoader.loadFrom(d))})):this.disposables.push(...await e.project.snippetLoader.loadFrom(d))}await this.fileSystem.fileExists(".installed")||(await this.installFiles.execute(this.isGlobal),await this.fileSystem.writeFile(".installed",""))}async resetInstalled(){await this.fileSystem.unlink(".installed")}deactivate(){if(this.hasPresets&&u.eventSystem.dispatch("presetsChanged",null),this.disposables.forEach(e=>e.dispose()),this.jsRuntime.clearCache(),this.isLoaded=!1,!this.isGlobal){const e=u.instance.extensionLoader;e.has(this.id)&&e.activate(this.id)}}async delete(){this.deactivate(),await Kt.del(this.id),this.parent.deleteExtension(this.manifest.id)}async setActive(e){var t;e?await this.activate():this.deactivate(),await((t=this.parent.activeStatus)==null?void 0:t.setActive(this.manifest.id,e))}forStore(e){const t=new ea(e,this.manifest,!0);return t.setInstalled(),t.setConnected(this),t}async installFilesToCurrentProject(){await this.installFiles.execute(!1)}}class bm extends ${constructor(t,i){super();c(this,"inactiveExtensions",new Set);this.fileSystem=t,this.savePath=i,this.loadFile().finally(()=>this.dispatch())}async loadFile(){try{this.inactiveExtensions=new Set(await this.fileSystem.readJSON(this.savePath))}catch{}}async save(){await this.fileSystem.writeJSON(this.savePath,[...this.inactiveExtensions])}async setActive(t,i){i?this.inactiveExtensions.delete(t):this.inactiveExtensions.add(t),await this.save()}isActive(t){return!this.inactiveExtensions.has(t)}}class fa extends ${constructor(t,i,n,a=!1){super();c(this,"_extensions",new Map);c(this,"extensionPaths",new Map);c(this,"_loadedInstalledExtensions",new $(2));c(this,"activeStatus");this.fileSystem=t,this.loadExtensionsFrom=i,this.saveInactivePath=n,this.isGlobal=a}get extensions(){return this._extensions}async loadActiveExtensions(){this.activeStatus=new bm(this.fileSystem,this.saveInactivePath),await this.activeStatus.fired}async getInstalledExtensions(){return await this.fired,new Set(this.extensions.values())}async loadExtensions(t=this.loadExtensionsFrom){const i=await this.fileSystem.getDirectoryHandle(t,{create:!0});await this.loadActiveExtensions();const n=[];for await(const a of i.values())a.name!==".DS_Store"&&n.push(this.loadExtension(i,a,!1));await Promise.all(n),this._loadedInstalledExtensions.dispatch();for(const[a,r]of this._extensions)r.isActive&&await r.activate();this.dispatch()}async loadExtension(t,i,n=!1){let a;return i.kind==="file"&&i.name.endsWith(".zip")?(a=await this.unzipExtension(i,await t.getDirectoryHandle(i.name.replace(".zip",""),{create:!0})),await t.removeEntry(i.name)):i.kind==="directory"&&(a=await this.loadManifest(i)),n&&a&&await a.activate(),a}async unzipExtension(t,i){const n=new Z(i),a=await t.getFile(),r=await new Promise(async(o,l)=>en(new Uint8Array(await a.arrayBuffer()),(d,p)=>{d?l(d):o(p)}));for(const o in r)if(!o.startsWith(".")){if(o.endsWith("/")){await n.mkdir(o.slice(0,-1),{recursive:!0});continue}await n.writeFile(o,r[o])}return await this.loadManifest(i)}async loadManifest(t){var r;let i;try{i=await t.getFileHandle("manifest.json")}catch{return}const a=await(await i.getFile()).text().then(o=>JSON.parse(o));if(a.id){const o=new vm(this,a,t,this.isGlobal);return this._extensions.set(a.id,o),this.extensionPaths.set(a.id,`${this.loadExtensionsFrom}/${t.name}`),o}else Ne(new Error(`Failed to load extension "${(r=a.name)!=null?r:t.name}": Invalid extension ID`))}async activate(t){const i=this.extensions.get(t);return i?(i.isActive&&await i.activate(),!0):(Ne(new Error(`Failed to activate extension with ID "${t}": Extension not found`)),!1)}deactivate(t){const i=this.extensions.get(t);return i?(i.deactivate(),!0):(Ne(new Error(`Failed to deactivate extension with ID "${t}": Extension not found`)),!1)}has(t){return this.extensions.has(t)}deactiveAll(t=!1){for(const[i,n]of this._extensions)n.deactivate(),t&&this._extensions.delete(i)}disposeAll(){this.deactiveAll(!0),this.resetSignal()}deleteExtension(t){const i=this.extensionPaths.get(t);i&&(this.fileSystem.unlink(i),this.extensionPaths.delete(t),this.extensions.delete(t))}mapActive(t){const i=[];for(const n of this._extensions.values())n.isActive&&i.push(t(n));return i}}class ga{constructor(e=[],t=!1){c(this,"events",new Map);c(this,"any",new z);this.autoCleanEmptyDispatchers=t,e.forEach(i=>this.create(i))}create(e){if(this.events.get(e)!==void 0)throw new Error(`Dispatcher for event "${e}" is already defined.`);return this.events.set(e,new z),{dispose:()=>{this.events.delete(e)}}}hasEvent(e){return this.events.has(e)}getDispatcher(e){const t=this.events.get(e);if(t===void 0)throw new Error(`No dispatcher defined for event "${e}".`);return t}dispatch(e,t){return this.any.dispatch([e,t]),this.getDispatcher(e).dispatch(t)}on(e,t){const i=this.getDispatcher(e),n=i.on(t);return{dispose:()=>{n.dispose(),this.autoCleanEmptyDispatchers&&!i.hasListeners&&this.events.delete(e)}}}off(e,t){const i=this.getDispatcher(e);i.off(t),this.autoCleanEmptyDispatchers&&!i.hasListeners&&this.events.delete(e)}once(e,t){const i=this.getDispatcher(e);i.once(n=>{t(n),this.autoCleanEmptyDispatchers&&!i.hasListeners&&this.events.delete(e)})}}class Ri extends ga{constructor(){super([],!0)}dispatch(e,t){this.any.dispatch([e,t]),this.hasEvent(e)&&super.dispatch(e,t)}on(e,t){return this.hasEvent(e)||this.create(e),super.on(e,t)}}class _m{constructor(){c(this,"definitions",new Set);c(this,"processedFileTabs",new Set)}register(e){return this.definitions.add(e),this.processedFileTabs.forEach(t=>{e.isFor(t)&&t.addAction(new D({icon:e.icon,name:e.name,isDisabled:()=>{var i,n;return(n=(i=e.isDisabled)==null?void 0:i.call(e,t))!=null?n:!1},onTrigger:()=>e.trigger(t)}))}),{dispose:()=>{this.definitions.delete(e),this.processedFileTabs.forEach(t=>{e.isFor(t)&&(t.clearActions(),this.addTabActions(t))})}}}registerPreview(e){return this.register({icon:"mdi-play",name:e.name,isFor:t=>{if(t instanceof W){if(e.fileType)return t.getFileType()===e.fileType;if(e.fileMatch)return t.getProjectPath().startsWith(e.fileMatch)}else return!1;return!1},trigger:async t=>{var a,r;const i=await u.getApp(),n=await e.createPreview(i.project.inactiveTabSystem,t);!n||(n.isTemporary=!1,t.connectedTabs.push(n),(a=i.project.inactiveTabSystem)==null||a.add(n,!0),(r=i.project.inactiveTabSystem)==null||r.setActive(!0))}})}async addTabActions(e){this.processedFileTabs.add(e),e.onClose.on(()=>this.processedFileTabs.delete(e));for(const t of this.definitions)await t.isFor(e)&&e.addAction(new D({icon:t.icon,name:t.name,onTrigger:()=>t.trigger(e)}))}}class Sm{constructor({name:e,description:t,fileTypes:i,locations:n,data:a,targetFormatVersion:r}){c(this,"name");c(this,"description");c(this,"fileTypes");c(this,"locations");c(this,"data");c(this,"minTargetFormatVersion");c(this,"maxTargetFormatVersion");this.name=e,this.description=t,this.fileTypes=new Set(i),this.locations=n!=null?n:[],this.data=a,this.minTargetFormatVersion=r==null?void 0:r.min,this.maxTargetFormatVersion=r==null?void 0:r.max}get displayData(){return{name:this.name,description:this.description}}get insertData(){return[this.name,this.data]}get insertText(){return typeof this.data=="string"?this.data:Array.isArray(this.data)?this.data.join(`
`):JSON.stringify(this.data,null,"	").slice(1,-1).replaceAll(`
	`,`
`).trim()}isValid(e,t,i){return(typeof e!="string"||(!this.minTargetFormatVersion||Q(e,this.minTargetFormatVersion,">="))&&(!this.maxTargetFormatVersion||Q(e,this.maxTargetFormatVersion,"<=")))&&this.fileTypes.has(t)&&(this.locations.length===0||this.locations.some(a=>i.some(r=>a===r||(a!==""?hi(r,a):!1))))}}class Cm{constructor(e){c(this,"snippets",new Set);this.project=e}async activate(){const i=await(await(await u.getApp()).project.getCurrentDataPackage()).getDirectoryHandle("snippet",{create:!0});await this.loadFrom(i)}async loadFrom(e){const t=[];return await we(e,async(i,n)=>{let a;try{a=L.parse(await i.getFile().then(r=>r.text()))}catch{console.error(`Invalid JSON within snippet "${n}"`);return}t.push(this.addSnippet(new Sm(a)))}),t}async deactivate(){this.snippets.clear()}addSnippet(e){return this.snippets.add(e),{dispose:()=>{this.snippets.delete(e)}}}getSnippetsFor(e,t,i){return[...this.snippets].filter(n=>n.isValid(e,t,i))}}class xm{constructor(){c(this,"exports",new Set)}register(e){return this.exports.add(e),{dispose:()=>this.exports.delete(e)}}async getExporters(){return await Promise.all([...this.exports].map(async e=>({...e.displayData,isDisabled:await e.isDisabled(),onTrigger:()=>e.export()})))}}function km(s){let e=s.map(n=>n.split("/").reverse());const t=e.map(()=>null),i=e.map(()=>0);if(!s.every(n=>n.split("/").reverse()[0]===s[0].split("/").reverse()[0]))throw new Error("All files must have the same name");for(;i.some((n,a)=>n<e[a].length);){const n=e.map((r,o)=>r[i[o]]);n.every(r=>r===n[0])||t.forEach((r,o)=>{r===null&&(t[o]=n[o])}),i.forEach((r,o)=>{r<e[o].length&&i[o]++})}return t}class wa extends jr{constructor(t){super(t,hi);c(this,"ready",new $);c(this,"lCacheFiles",{});c(this,"lCacheFilesLoaded",new $);c(this,"packSpiderFiles",{});c(this,"packSpiderFilesLoaded",new $)}setProjectConfig(t){this.projectConfig=t}async setup(t){this.fileTypes.length>0||(await t.fired,this.fileTypes=await t.readJSON("data/packages/minecraftBedrock/fileDefinitions.json"),this.loadLightningCache(t),this.loadPackSpider(t),this.ready.dispatch())}getMonacoSchemaEntries(){return this.fileTypes.map(({detect:t={},schema:i})=>{if(!t.matcher)return null;const n=(t==null?void 0:t.packType)===void 0?[]:Array.isArray(t==null?void 0:t.packType)?t==null?void 0:t.packType:[t==null?void 0:t.packType];return{fileMatch:this.prefixMatchers(n,Array.isArray(t.matcher)?[...t.matcher]:[t.matcher]).map(a=>encodeURI(a).replaceAll(/;|,|@|&|=|\+|\$|\.|!|'|\(|\)|#/g,"*")),uri:i}}).filter(t=>t!==null).flat()}async loadLightningCache(t){var a;const i=await t.readJSON("data/packages/minecraftBedrock/lightningCaches.json"),n=r=>Object.entries(i).find(([o])=>o.endsWith(r));for(const r of this.fileTypes){if(!r.lightningCache)continue;const[o,l]=(a=n(r.lightningCache))!=null?a:[];if(!o)throw new Error(`Lightning cache file "${r.lightningCache}" for file type "${r.id}" not found`);this.lCacheFiles[r.lightningCache]=l}this.lCacheFilesLoaded.dispatch()}async getLightningCache(t){var n,a;const{lightningCache:i}=(n=this.get(t))!=null?n:{};return i?(await this.lCacheFilesLoaded.fired,(a=this.lCacheFiles[i])!=null?a:[]):[]}async loadPackSpider(t){const i=await t.readJSON("data/packages/minecraftBedrock/packSpiders.json");this.packSpiderFiles=Object.fromEntries(this.fileTypes.map(({id:n,packSpider:a})=>{if(!!a)return[n,i[`file:///data/packages/minecraftBedrock/packSpider/${a}`]]}).filter(n=>n!==void 0)),this.packSpiderFilesLoaded.dispatch()}async getPackSpiderData(){return await this.packSpiderFilesLoaded.fired,this.packSpiderFiles}}function Pm(){return new Worker("/assets/Service.95ad22d7.js")}const jm=new Pm,Fm=Xi(jm),We="bridge-temp-project";class Tm{constructor(e,t,i,{requiresPermissions:n}={}){c(this,"tabSystems");c(this,"_projectData");c(this,"packIndexer");c(this,"_fileSystem");c(this,"_compilerService");c(this,"compilerReady",new $);c(this,"jsonDefaults",x(new bd(this)));c(this,"typeLoader");c(this,"isVirtualProject");c(this,"requiresPermissions");c(this,"config");c(this,"fileTypeLibrary");c(this,"extensionLoader");c(this,"fileChange",new Ri);c(this,"fileSave",new Ri);c(this,"fileUnlinked",new Ri);c(this,"tabActionProvider",new _m);c(this,"snippetLoader",new Cm(this));c(this,"exportProvider",new xm);this.parent=e,this.app=t,this._baseDirectory=i,this.isVirtualProject=We===this.name,this.requiresPermissions=n!=null?n:!1,this._fileSystem=x(new Z(i)),this.config=x(new dd(this._fileSystem,this.projectPath,this)),this.fileTypeLibrary=x(new wa(this.config)),this.packIndexer=x(new wd(this,i)),this.extensionLoader=x(new fa(t.fileSystem,`${this.projectPath}/.bridge/extensions`,`${this.projectPath}/.bridge/inactiveExtensions.json`)),this.typeLoader=x(new _d(this.app.dataLoader)),this.fileChange.any.on(a=>u.eventSystem.dispatch("fileChange",a)),this.fileSave.any.on(a=>u.eventSystem.dispatch("fileSave",a)),this.fileUnlinked.any.on(a=>u.eventSystem.dispatch("fileUnlinked",a[0])),this.tabSystems=[x(new is(this)),x(new is(this,1))],this.createDashService("development").then(a=>{this._compilerService=x(a),this.compilerReady.dispatch()}),setTimeout(()=>this.onCreate(),0)}get projectData(){return this._projectData}get name(){return this.baseDirectory.name}get displayName(){var e;return(e=this.config.get().name)!=null?e:this.name}get tabSystem(){if(this.tabSystems[0].isActive)return this.tabSystems[0];if(this.tabSystems[1].isActive)return this.tabSystems[1]}get inactiveTabSystem(){if(!this.tabSystems[0].isActive)return this.tabSystems[0];if(!this.tabSystems[1].isActive)return this.tabSystems[1]}get baseDirectory(){return this._baseDirectory}get fileSystem(){return this._fileSystem}get isActiveProject(){return this.name===this.parent.selectedProject}get compilerService(){if(this._compilerService===void 0)throw new Error("Trying to access compilerService before it was setup. Make sure to await compilerReady.fired before accessing it.");return this._compilerService}get watchModeActive(){var e,t;return((t=(e=b.compiler)==null?void 0:e.watchModeActive)!=null?t:!0)&&!this.isVirtualProject&&!A.value}get projectPath(){return this.requiresPermissions?`projects/${this.name}`:`~local/projects/${this.name}`}get bpUuid(){var e,t;return(t=(e=this.projectData.contains)==null?void 0:e.find(i=>i.id==="behaviorPack"))==null?void 0:t.uuid}get isLocal(){return!this.requiresPermissions}async createDashService(e,t){this.isVirtualProject||await this.app.comMojang.fired;const i=await new Fm(this.app.fileSystem.baseDirectory,this.app.comMojang.hasComMojang?this.app.comMojang.fileSystem.baseDirectory:void 0,{config:`${this.projectPath}/config.json`,compilerConfig:t,mode:e,projectName:this.name,pluginFileTypes:this.fileTypeLibrary.getPluginFileTypes()});return i.on(lt(async()=>{const n=this.app.taskManager.create({icon:"mdi-cogs",name:"taskManager.tasks.compiler.title",description:"taskManager.tasks.compiler.description",totalTaskSteps:100});i.onProgress(lt(a=>{a===1?n.complete():n.update(100*a)}))}),!1),i}async activate(e=!1){var r,o,l;if(u.fileType.setProjectConfig(this.config),u.packType.setProjectConfig(this.config),this.parent.title.setProject(this.name),this.parent.activatedProject.dispatch(this),await this.fileTypeLibrary.setup(this.app.dataLoader),await this.compilerReady.fired,!e)for(const d of this.tabSystems)await d.activate();await this.extensionLoader.loadExtensions();const t=(r=this.tabSystem)==null?void 0:r.selectedTab;this.typeLoader.activate(t instanceof W?t.getPath():void 0),await this.app.dataLoader.fired,await Promise.all([this.packIndexer.activate(e),this.compilerService.setup()]);const[i,n]=await this.packIndexer.fired,a=((l=(o=b.compiler)==null?void 0:o.autoFetchChangedFiles)!=null?l:!0)&&!this.isVirtualProject;await Promise.all([this.jsonDefaults.activate(),a?this.compilerService.start(i,n):Promise.resolve()]),this.snippetLoader.activate()}async deactivate(e=!1){e||this.tabSystems.forEach(t=>t.deactivate()),this.typeLoader.deactivate(),this.jsonDefaults.deactivate(),this.extensionLoader.disposeAll(),await Promise.all([this.packIndexer.deactivate(),this.snippetLoader.deactivate()])}dispose(){this.tabSystems.forEach(e=>e.dispose()),this.extensionLoader.disposeAll()}async refresh(){this.app.packExplorer.refresh(),await this.deactivate(!0),await this.activate(!0)}async openFile(e,t={}){var i,n,a;for(const r of this.tabSystems){const o=await r.getTab(e);if(o)return(i=t.selectTab)==null||i?r.select(o):void 0}t.openInSplitScreen?await((a=this.inactiveTabSystem)==null?void 0:a.open(e,t)):await((n=this.tabSystem)==null?void 0:n.open(e,t))}async closeFile(e){for(const t of this.tabSystems){const i=await t.getTab(e);i==null||i.close()}}async getFileTab(e){for(const t of this.tabSystems){const i=await t.getTab(e);if(i!==void 0)return i}}async getFileTabWithPath(e){for(const t of this.tabSystems){const i=await t.get(n=>n instanceof W&&n.getPath()===e);if(i!==void 0)return i}}async openTab(e,t=!0){var i;for(const n of this.tabSystems)if(await n.hasTab(e)){t&&n.select(e);return}(i=this.tabSystem)==null||i.add(e,t)}updateTabFolders(){const e={};for(const t of this.tabSystems)t.tabs.value.forEach(i=>{if(!(i instanceof W))return;const n=i.name;e[n]||(e[n]=[]),e[n].push(i)});for(const t in e){const i=e[t];if(i.length===1)i[0].setFolderName(null);else{const n=km(i.map(a=>a.getPath()));i.forEach((a,r)=>a.setFolderName(n[r]))}}}absolutePath(e){return`${this.projectPath}/${e}`}relativePath(e){return As(this.projectPath,e)}async updateHandle(e){const t=await this.app.fileSystem.pathTo(e);if(!t)return;if(e.kind==="file")return await this.updateFile(t);const i=[];await we(e,(n,a)=>{i.push(a)},void 0,t),await this.updateFiles(i)}async updateFile(e){const[t]=await Promise.all([this.packIndexer.updateFile(e),this.watchModeActive?this.compilerService.updateFiles([e]):Promise.resolve()]);t&&await this.jsonDefaults.updateDynamicSchemas(e)}async updateFiles(e){const t=await this.packIndexer.updateFiles(e);this.watchModeActive&&await this.compilerService.updateFiles(e),t&&await this.jsonDefaults.updateMultipleDynamicSchemas(e)}async unlinkFile(e){await this.unlinkFiles([e])}async unlinkFiles(e){var i,n;await Promise.allSettled([...e.map(a=>this.packIndexer.unlinkFile(a,!1)),...e.map(a=>this.app.fileSystem.unlink(a))]),await this.packIndexer.saveCache(),this.watchModeActive&&await this.compilerService.unlinkMultiple(e),e.forEach(a=>{this.fileUnlinked.dispatch(a);for(const r of this.tabSystems)r.forceCloseTabs(o=>o.getPath()===a)});const t=(n=(i=this.tabSystem)==null?void 0:i.selectedTab)==null?void 0:n.getPath();t&&await this.jsonDefaults.updateDynamicSchemas(t)}async unlinkHandle(e){const t=await this.app.fileSystem.pathTo(e);if(!t)return!1;if(e.kind==="file")return await this.unlinkFile(t),!0;const i=[];return await we(e,(n,a)=>{i.push(a)},void 0,t),await this.unlinkFiles(i),await this.app.fileSystem.unlink(t),!0}async onMovedFile(e,t){await Promise.all([this.compilerService.rename(e,t),this.packIndexer.rename(e,t)]),await this.jsonDefaults.updateDynamicSchemas(t)}async onMovedFolder(e,t){const i=await this.app.fileSystem.getDirectoryHandle(t),n=[];await we(i,async(a,r)=>{const o=`${e}/${r}`,l=`${t}/${r}`;n.push([o,l])}),await Promise.all([this.compilerService.renameMultiple(n),this.packIndexer.rename(e,t)]),await this.jsonDefaults.updateDynamicSchemas(t)}async updateChangedFiles(){this.packIndexer.deactivate(),await this.packIndexer.activate(!0),await this.compilerService.build()}async getFileFromDiskOrTab(e){const t=await this.getFileTabWithPath(e);return t&&t instanceof W?await t.getFile():await this.app.fileSystem.readFile(e)}setActiveTabSystem(e,t){this.tabSystems.forEach(i=>e!==i?i.setActive(t,!1):void 0)}hasPacks(e){var t;for(const i of e)if(!((t=this._projectData.contains)!=null&&t.some(({id:n})=>n===i)))return!1;return!0}getPacks(){var e;return((e=this._projectData.contains)!=null?e:[]).map(t=>t.id)}addPack(e){this._projectData.contains.push(e)}getFilePath(e,t){return this.config.resolvePackPath(e,t)}isFileWithinAnyPack(e){return this.getPacks().map(t=>this.config.resolvePackPath(t)).some(t=>e.startsWith(t))}isFileWithinProject(e){return e.startsWith(`${this.projectPath}/`)||this.isFileWithinAnyPack(e)}isFileOpen(e){return this.tabSystems.some(t=>t.tabs.value.some(i=>i instanceof W&&i.getPath()===e))}async loadProject(){await this.config.setup();const[e,t]=await Promise.all([ud(this,this.app.fileSystem),hd(this.app,this)]);U(this,"_projectData",{...this.config.get(),path:this.name,name:this.name,imgSrc:e,contains:t.sort((i,n)=>i.id.localeCompare(n.id))})}async recompile(e=!0){this.isVirtualProject||(this._compilerService=x(await this.createDashService("development")),await this._compilerService.setup(),e&&this.isActiveProject?(await this.fileSystem.writeFile(".bridge/.restartWatchMode",""),await this.compilerService.start([],[])):await this.fileSystem.writeFile(".bridge/.restartWatchMode",""))}async switchProjectType(){this.app.windows.loadingWindow.open();const e=this.requiresPermissions?"projects":"~local/projects",t=this.requiresPermissions?"~local/projects":"projects",{type:i,handle:n}=await Sn({moveHandle:this.baseDirectory,fromHandle:await this.app.fileSystem.getDirectoryHandle(e),toHandle:await this.app.fileSystem.getDirectoryHandle(t)});if(i==="cancel"||!n||n.kind!=="directory"){this.app.windows.loadingWindow.close();return}await this.parent.removeProject(this,!1),await this.parent.addProject(n,!0,!this.requiresPermissions),this.app.windows.loadingWindow.close()}}function ya(s){if(s["minecraft:geometry"])return s;const e=Object.entries(s).filter(([i,n])=>typeof n!="string"),t=[];for(const[i,n]of e)t.push({description:{identifier:i,texture_width:n.texturewidth,texture_height:n.textureheight},bones:n.bones});return{format_version:"1.12.0","minecraft:geometry":t}}class Tn extends z{constructor(t,i){super();c(this,"fileContent");c(this,"disposable");c(this,"children",[]);c(this,"ready",new $);this.app=t,this.filePath=i,this.activate(),t.project.getFileFromDiskOrTab(i).then(async n=>{await this.onFileChange(n),await this.setup(n),this.ready.dispatch()})}async setup(t){}async activate(){this.disposable===void 0&&(this.disposable=this.app.project.fileChange.on(this.filePath,t=>this.onFileChange(t)))}async requestFile(t){return await this.onFileChange(t),new Promise(i=>{this.once(n=>i(n))})}async compileFile(t){const[i,n]=await this.app.project.compilerService.compileFile(this.filePath,new Uint8Array(await t.arrayBuffer()));return this.children.forEach(a=>a.dispose()),this.children=[],i.forEach(a=>{const r=new Am(this.app,a);this.children.push(r),r.on(()=>this.onFileChange(t))}),new File([n],t.name)}async onFileChange(t){this.dispatch(await this.compileFile(t))}async getFile(){return this.compileFile(await this.app.project.getFileFromDiskOrTab(this.filePath))}dispose(){var t;(t=this.disposable)==null||t.dispose(),this.disposable=void 0,this.children.forEach(i=>i.dispose())}}class Am extends z{constructor(t,i){super();c(this,"disposable");this.app=t,this.filePath=i,this.activate()}async activate(){this.disposable===void 0&&(this.disposable=this.app.project.fileSave.on(this.filePath,t=>this.onFileChange(t)))}async onFileChange(t){this.dispatch()}dispose(){var t;(t=this.disposable)==null||t.dispose(),this.disposable=void 0}}class Bt extends Tn{constructor(e,t){super(e,t),this.ready.on(()=>{this.on(i=>this.onChange(i))})}async setup(e){return await this.onChange(await this.compileFile(e),!0)}}class $m extends Bt{constructor(t,i,n){super(t.app,i);c(this,"geometryJson",{});c(this,"selected");this.parent=t,this.includedGeometryIdentifiers=n}select(t){this.selected=t}async onChange(t,i=!1){try{this.geometryJson=ya(L.parse(await t.text())),i||this.parent.onChange()}catch{}}get includedGeometries(){var t,i,n,a,r;return this.includedGeometryIdentifiers===void 0?(i=(t=this.geometryJson)==null?void 0:t["minecraft:geometry"])!=null?i:[]:(r=(a=(n=this.geometryJson)==null?void 0:n["minecraft:geometry"])==null?void 0:a.filter(({description:o})=>!this.includedGeometryIdentifiers.includes(o.identifier)))!=null?r:[]}get identifiers(){return this.includedGeometries.map(({description:t})=>t.identifier)}get geometry(){return this.includedGeometries.find(({description:t})=>t.identifier===this.selected)}get fallbackGeometry(){return this.includedGeometries[0]}}class Em extends Bt{constructor(t,i,n){super(t.app,i);c(this,"animationJson",{});this.parent=t,this.includedAnimationIdentifiers=n}async onChange(t,i=!1){try{this.animationJson=L.parse(await t.text()),i||this.parent.onChange()}catch{}}get includedAnimations(){var t,i;return this.includedAnimationIdentifiers===void 0?Object.entries((i=(t=this.animationJson)==null?void 0:t.animations)!=null?i:{}):Object.entries(this.animationJson.animations).filter(([n,{description:a}])=>!this.includedAnimationIdentifiers.includes(a.identifier))}get identifiers(){return this.includedAnimations.map(([t])=>t)}}class Dm extends Bt{constructor(t,i,n){super(t.app,n);c(this,"particleData",{});this.parent=t,this.shortName=i}async onChange(t,i=!1){try{this.particleData=L.parse(await t.text()),i||this.parent.onChange()}catch{}}get identifier(){var t,i,n;return(n=(i=(t=this.particleData)==null?void 0:t.particle_effect)==null?void 0:i.description)==null?void 0:n.identifier}get json(){return this.particleData}}class Mm extends Bt{constructor(t,i){super(t.app,i);c(this,"entityData",{});this.parent=t}async onChange(t,i=!1){try{this.entityData=L.parse(await t.text()),i||this.parent.onChange()}catch{}}findComponent(t){const i=[],n=r=>i.push(r);return[`*/components/${t}`,`*/component_groups/*/${t}`].forEach(r=>mi(r,this.entityData,n)),i}getSeatBoxHelpers(){var n;const t=this.findComponent("minecraft:rideable"),i={x:16*.8,y:16*1.8,z:16*.8};return(n=t.map(a=>{var r;return(r=a==null?void 0:a.seats)!=null?r:[]}).flat().map(a=>a==null?void 0:a.position).filter(a=>Array.isArray(a)&&typeof a[0]=="number"&&typeof a[1]=="number"&&typeof a[2]=="number"))==null?void 0:n.map(a=>({color:"#ff0000",position:{x:a[0]*-16,y:a[1]*16,z:a[2]*-16},size:i}))}getCollisionBoxes(){return this.findComponent("minecraft:collision_box").filter(t=>typeof(t==null?void 0:t.width)=="number"&&typeof(t==null?void 0:t.height)=="number").map(t=>({color:"#ffff00",position:{x:0,y:0,z:0},size:{x:t.width*16,y:t.height*16,z:t.width*16}}))}getHitboxes(){return this.findComponent("minecraft:custom_hit_test").map(t=>{var i;return(i=t==null?void 0:t.hitboxes)!=null?i:[]}).flat().filter(t=>typeof(t==null?void 0:t.width)=="number"&&typeof(t==null?void 0:t.height)=="number"&&((t==null?void 0:t.pivot)===void 0||Array.isArray(t==null?void 0:t.pivot)&&typeof t.pivot[0]=="number"&&typeof t.pivot[1]=="number"&&typeof t.pivot[2]=="number")).map(t=>{var i,n,a,r,o,l;return{color:"#0000ff",position:{x:((n=(i=t==null?void 0:t.pivot)==null?void 0:i[0])!=null?n:0)*-16,y:(((r=(a=t==null?void 0:t.pivot)==null?void 0:a[1])!=null?r:0)-t.height/2)*16,z:((l=(o=t==null?void 0:t.pivot)==null?void 0:o[2])!=null?l:0)*-16},size:{x:t.width*16,y:t.height*16,z:t.width*16}}})}}class Gi extends z{constructor(t,i){super();c(this,"_geometries",[]);c(this,"_animations",[]);c(this,"readyPromises",[]);c(this,"_currentTexturePath");c(this,"_runningAnimations",new Set);c(this,"particleEffects",[]);c(this,"_serverEntity");this.app=t,this.renderData=i,this._currentTexturePath=this.texturePaths[0]}get ready(){return Promise.all(this.readyPromises)}update(t){this.renderData=t}createGeometry(t,i){const n=new $m(this,t,i);this._geometries.push(n),this.readyPromises.push(n.ready.fired)}createAnimation(t,i){const n=new Em(this,t,i);this._animations.push(n),this.readyPromises.push(n.ready.fired)}createParticle(t,i){const n=new Dm(this,t,i);this.particleEffects.push(n),this.readyPromises.push(n.ready.fired)}addServerEntity(t){this._serverEntity=new Mm(this,t),this.readyPromises.push(this._serverEntity.ready.fired)}selectGeometry(t){for(const i of this._geometries)if(i.identifiers.includes(t))return i.select(t);throw new Error(`Failed to find geometry with ID "${t}"`)}selectTexturePath(t){this._currentTexturePath=t}onChange(){this.dispatch()}get identifier(){return this.renderData.identifier}get texturePaths(){return this.renderData.texturePaths}get geometryIdentifiers(){return this._geometries.map(t=>t.identifiers).flat()}get animations(){return this._animations.map(t=>t.includedAnimations).flat().filter(([t])=>this.renderData.connectedAnimations.has(t))}get runningAnimations(){return this._runningAnimations}get modelData(){for(const t of this._geometries){let i=t.geometry;if(i)return i}return this._geometries[0].fallbackGeometry}get currentTexturePath(){return this._currentTexturePath}get particles(){return this.particleEffects.map(t=>[t.shortName,t.json])}get serverEntity(){return this._serverEntity}activate(){this._geometries.forEach(t=>t.activate())}dispose(){var t;this._geometries.forEach(i=>i.dispose()),this._animations.forEach(i=>i.dispose()),(t=this._serverEntity)==null||t.dispose()}}const Im=X({__name:"Window",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState();function n(){e.window.close(e.window.options.filter(({isSelected:a})=>a).map(({name:a})=>a))}return{__sfc:!0,t,props:e,state:i,onClose:n,BaseWindow:ce}}});var Om=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.name,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,isPersistent:!e.window.isClosable,hasCloseButton:!1,width:440,height:400},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return e._l(e.window.options,function(n,a){return t("v-checkbox",{key:a,attrs:{label:n.name,"hide-details":""},model:{value:n.isSelected,callback:function(r){e.$set(n,"isSelected",r)},expression:"option.isSelected"}})})},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary"},on:{click:i.onClose}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(" "+e._s(i.t("general.confirm"))+" ")])],1)]},proxy:!0}],null,!1,862505436)}):e._e()},Rm=[],Wm=_(Im,Om,Rm,!1,null,null,null,null);const Lm=Wm.exports;class Nm extends ee{constructor(e){super(Lm,!0,!1),this.config=e,this.defineWindow(),this.open()}get name(){return this.config.name}get options(){return this.config.options}get isClosable(){return this.config.isClosable}}const Bm=X({__name:"Window",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState(),n=e.window,a=F(null);function r(l){e.window.startClosing(l)}function o(l,d){!n.modelViewer||(d?n.modelViewer.getModel().showBone(l):n.modelViewer.getModel().hideBone(l),n.modelViewer.requestRendering())}return Cs(async()=>{await e.window.receiveCanvas(a.value),Zt(()=>{n.modelViewer.positionCamera(i.previewScale)}),Zt(()=>{n.modelViewer.scene.background=new Tt(i.backgroundColor),n.modelViewer.requestRendering()})}),{__sfc:!0,t,props:e,state:i,window:n,canvas:a,onClose:r,onBoneVisibilityChange:o,BaseWindow:ce}}});var Vm=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"windows.assetPreview.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,isPersistent:!1,hasCloseButton:!0,width:760,height:560},on:{closeWindow:function(n){return i.onClose(!0)}},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"d-flex"},[t("div",{staticStyle:{width:"200px"}},[t("v-text-field",{attrs:{outlined:"",dense:"",label:i.t("windows.assetPreview.assetName")},model:{value:i.state.assetName,callback:function(n){e.$set(i.state,"assetName",n)},expression:"state.assetName"}}),t("v-slider",{attrs:{min:"1",max:"4",step:"0.1",discrete:"","thumb-size":24,"thumb-label":"always","hide-details":"",label:i.t("windows.assetPreview.previewScale")},model:{value:i.state.previewScale,callback:function(n){e.$set(i.state,"previewScale",n)},expression:"state.previewScale"}}),t("v-slider",{attrs:{min:"1",max:"10",step:"1",discrete:"","thumb-size":24,"thumb-label":"always","hide-details":"",label:i.t("windows.assetPreview.outputResolution")},model:{value:i.state.outputResolution,callback:function(n){e.$set(i.state,"outputResolution",n)},expression:"state.outputResolution"}}),t("h2",{staticClass:"mt-8 mb-3"},[e._v(" "+e._s(i.t("windows.assetPreview.backgroundColor"))+" ")]),t("v-color-picker",{attrs:{width:"220px","hide-mode-switch":"",elevation:"2",mode:"hexa"},model:{value:i.state.backgroundColor,callback:function(n){e.$set(i.state,"backgroundColor",n)},expression:"state.backgroundColor"}}),i.state.bones.length>0?t("h2",{staticClass:"mt-8"},[e._v(" "+e._s(i.t("windows.assetPreview.boneVisibility"))+" ")]):e._e(),e._l(i.state.bones,function(n,a){return t("v-checkbox",{key:a,attrs:{label:a,"hide-details":""},on:{change:r=>i.onBoneVisibilityChange(a,r)},model:{value:i.state.bones[a],callback:function(r){e.$set(i.state.bones,a,r)},expression:"state.bones[boneName]"}})})],2),t("canvas",{ref:"canvas",staticClass:"ml-4 pa-1 rounded-lg outlined",staticStyle:{position:"sticky",top:"0"},attrs:{height:"500",width:"500"}})])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary"},on:{click:function(n){return i.onClose(!1)}}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(" "+e._s(i.t("general.confirm"))+" ")])],1)]},proxy:!0}],null,!1,1964320974)}):e._e()},Hm=[],Um=_(Bm,Vm,Hm,!1,null,null,null,null);const zm=Um.exports;class Jm extends ee{constructor({assetName:t,textureUrl:i,modelData:n}){super(zm,!0,!1);c(this,"textureUrl");c(this,"modelData");c(this,"modelViewer");c(this,"state",q({...super.state,bones:{},assetName:"",backgroundColor:"#121212",previewScale:1.5,outputResolution:4}));this.state.assetName=t,this.textureUrl=i,this.modelData=x(n),this.defineWindow(),this.open()}async receiveCanvas(t){const{StandaloneModelViewer:i}=await ci(),n=new i(t,this.modelData,this.textureUrl,{antialias:!0,height:500,width:500});await n.loadedModel,this.state.bones=Object.fromEntries(n.getModel().bones.map(a=>[a,!0])),n.scene.background=new Tt(this.state.backgroundColor),n.positionCamera(this.state.previewScale),this.modelViewer=x(n)}startClosing(t){this.close(t?null:{assetName:this.state.assetName,previewScale:this.state.previewScale,boneVisibility:this.state.bones,backgroundColor:this.state.backgroundColor,outputResolution:this.state.outputResolution})}}async function li(){return await ue(()=>import("./wintersky.esm.0ccac7fa.js"),["assets/wintersky.esm.0ccac7fa.js","assets/vendor.1f611e46.js","assets/vendor.f6a4afb7.css"])}class va extends Fn{constructor(t,i){super(t,i);c(this,"winterskyScene");c(this,"model");c(this,"_renderContainer");c(this,"boxHelperDisposables",[])}async setup(){const{default:t}=await li();this.winterskyScene=x(new t.Scene({fetchTexture:async i=>{const n=await u.getApp();try{return await ni(i.particle_texture_path,n.project.fileSystem)}catch{}}})),this.winterskyScene.global_options.loop_mode="once",this.winterskyScene.global_options.tick_rate=60,this.winterskyScene.global_options.max_emitter_particles=1e3,this.winterskyScene.global_options.scale=16,this.setupComplete.once(()=>this.scene.add(this.winterskyScene.space)),await super.setup()}get renderContainer(){if(!this._renderContainer)throw new Error("Preview.renderContainer was not defined yet");return this._renderContainer}get icon(){return this.tab.icon}get iconColor(){return this.tab.iconColor}async onActivate(){var t;await super.onActivate(),(t=this._renderContainer)==null||t.activate()}onCreate(){this.registerActions()}registerActions(){this.actions=[],this.addAction(new D({icon:"mdi-refresh",name:"general.reload",onTrigger:()=>this.reload()}),new D({icon:"mdi-image-outline",name:"fileType.texture",isDisabled:()=>{var t,i,n;return((n=(i=(t=this._renderContainer)==null?void 0:t.texturePaths)==null?void 0:i.length)!=null?n:0)<=1},onTrigger:async()=>{const t=this.renderContainer.texturePaths,n=await new et({name:"fileType.texture",isClosable:!1,options:t,default:this.renderContainer.currentTexturePath}).fired;this.renderContainer.selectTexturePath(n),this.createModel()}}),new D({icon:"mdi-cube-outline",name:"fileType.geometry",isDisabled:()=>{var t,i,n;return((n=(i=(t=this._renderContainer)==null?void 0:t.geometryIdentifiers)==null?void 0:i.length)!=null?n:0)<=1},onTrigger:async()=>{const t=this.renderContainer.geometryIdentifiers,n=await new et({name:"fileType.geometry",isClosable:!1,options:t,default:t[0]}).fired;this.renderContainer.selectGeometry(n),this.createModel()}}),new D({icon:"mdi-movie-open-outline",name:"fileType.clientAnimation",isDisabled:()=>{var t,i,n;return((n=(i=(t=this._renderContainer)==null?void 0:t.animations)==null?void 0:i.length)!=null?n:0)==0},onTrigger:async()=>{var a;const t=this.renderContainer.animations,n=await new Nm({name:"fileType.clientAnimation",options:t.map(([r])=>({name:r,isSelected:this.renderContainer.runningAnimations.has(r)}))}).fired;(a=this.model)==null||a.animator.pauseAll(),this.renderContainer.runningAnimations.clear(),n.forEach(r=>{this.renderContainer.runningAnimations.add(r)}),this.createModel()}}),new D({icon:"mdi-collage",name:"[Asset Preview]",onTrigger:()=>{this.renderAssetPreview()}}))}onDestroy(){var t;(t=this._renderContainer)==null||t.dispose(),super.onDestroy()}onChange(){}async createModel(){var r;if(!this._renderContainer)return;const t=await u.getApp(),{Model:i}=await ci();if(this.model&&((r=this.scene)==null||r.remove(this.model.getGroup()),this.model.animator.disposeAnimations(),this.boxHelperDisposables.forEach(o=>o.dispose())),this.registerActions(),!this.renderContainer.currentTexturePath)return;this.model=x(new i(this.renderContainer.modelData,await ni(this.renderContainer.currentTexturePath,t.fileSystem))),await this.model.create(),this.scene.add(this.model.getGroup()),this.model.animator.setupWintersky(this.winterskyScene);const{default:n}=await li();this.renderContainer.particles.forEach(([o,l])=>{var d;!o||(d=this.model)==null||d.animator.addEmitter(o,new n.Config(this.winterskyScene,l))});for(const[o,l]of this.renderContainer.animations)this.model.animator.addAnimation(o,l);this.renderContainer.runningAnimations.forEach(o=>{var l;return(l=this.model)==null?void 0:l.animator.play(o)});const a=this.renderContainer.serverEntity;a&&(this.boxHelperDisposables.push(),this.createOutlineBoxes([...a.getHitboxes(),...a.getCollisionBoxes(),...a.getSeatBoxHelpers()])),this.requestRendering(),setTimeout(()=>{this.requestRendering()},100)}createOutlineBoxes(t){this.boxHelperDisposables=t.map(i=>this.model.createOutlineBox(i.color,i.position,i.size))}render(t=!0){this.winterskyScene.updateFacingRotation(this.camera),super.render(),t&&this.model&&this.model.shouldTick&&(this.model.tick(),this.isActive&&this.requestRendering())}async close(){var i;const t=await super.close();return t&&((i=this._renderContainer)==null||i.dispose(),this._renderContainer=void 0),t}async renderAssetPreview(){if(!this._renderContainer||!this.renderContainer.currentTexturePath)return;const{StandaloneModelViewer:t}=await ci(),i=this.parent.app.fileSystem,n=await i.loadFileHandleAsDataUrl(await i.getFileHandle(this.renderContainer.currentTexturePath)),r=await new Jm({assetName:this.tab.getFileHandle().name.split(".").shift(),modelData:this.renderContainer.modelData,textureUrl:n}).fired;if(!r)return;const{backgroundColor:o,boneVisibility:l,previewScale:d,outputResolution:p}=r;let h=r.assetName;const m=document.createElement("canvas");m.width=500*p,m.height=500*p;const f=new t(m,this.renderContainer.modelData,n,{antialias:!0,height:500*p,width:500*p});await f.loadedModel;for(const[K,Ht]of Object.entries(l))Ht||f.getModel().hideBone(K);f.scene.background=new Tt(o);const g=document.createElement("canvas");g.width=1400*p,g.height=600*p;const w=g.getContext("2d");if(!w)return;w.imageSmoothingEnabled=!1;const y=f.getModel().getGroup();f.positionCamera(d),f.requestRendering(),await ii(100);const S=[];for(let K=0;K<5;K++)K===1&&y.rotateY(Math.PI/4),K!==0&&y.rotateY(Math.PI/2),f.requestRendering(!0),S.push(m.toDataURL("image/png"));const C=new Fr().setFromObject(y).getCenter(new Tr);y.position.setY(C.y),y.rotation.set(.25*Math.PI,1.75*Math.PI,.75*Math.PI),f.positionCamera(d,!1),f.requestRendering(!0),S.push(m.toDataURL("image/png")),y.position.setY(0),y.rotation.set(0,1.75*Math.PI,1.75*Math.PI),f.positionCamera(d,!1),f.requestRendering(!0),S.push(m.toDataURL("image/png"));const P=this.parent.project.config.getAuthorImage(),[k,T,...j]=await Promise.all([this.loadImageFromDisk(this.renderContainer.currentTexturePath),P?this.loadImageFromDisk(P):null,...S.map(K=>this.loadImage(K))]);w.fillStyle=o,w.fillRect(0,0,g.width,g.height),w.drawImage(j[0],0,100*p,400*p,400*p);for(let K=0;K<3;K++)w.drawImage(j[K+1],650*p,K*200*p,200*p,200*p);for(let K=0;K<3;K++)w.drawImage(j[K+4],1050*p,K*200*p,200*p,200*p);const M=(k.width>k.height?0:(k.height-k.width)/k.width/2)*200,le=(k.height>k.width?0:(k.width-k.height)/k.height/2)*200,Re=k.width>k.height?200:k.width/k.height*200,Ge=k.height>k.width?200:k.height/k.width*200;w.drawImage(k,(400+M)*p,(200+le)*p,Re*p,Ge*p),T&&w.drawImage(T,g.width-50*p,g.height-50*p,50*p,50*p),h!==""?(w.fillStyle="#ffffff",w.font=30*p+"px Arial",w.fillText(h,20*p,50*p)):h=this.tab.getFileHandle().name.split(".")[0],await new Promise(K=>{g.toBlob(async Ht=>{!Ht||(await yi(`previews/${h}.png`,new Uint8Array(await Ht.arrayBuffer()),this.parent.project.fileSystem),K())})}),f.dispose()}loadImage(t){return new Promise(async(i,n)=>{const a=new Image;a.addEventListener("load",()=>i(a)),a.src=t})}async loadImageFromDisk(t){const i=this.parent.app.fileSystem;return await this.loadImage(await i.loadFileHandleAsDataUrl(await i.getFileHandle(t)))}}function ds(s){return Array.isArray(s)&&s.length===3&&typeof s[0]=="number"&&typeof s[1]=="number"&&typeof s[2]=="number"}const qm={"1.16.100":[{name:"minecraft:entity_collision",color:"#ffff00"},{name:"minecraft:pick_collision",color:"#0000ff"}],"1.18.0":[{name:"minecraft:block_collision",color:"#ffff00"},{name:"minecraft:aim_collision",color:"#0000ff"}],"1.19.10":[{name:"minecraft:collision_box",color:"#ffff00"},{name:"minecraft:aim_collision",color:"#0000ff"}]};function Gm(s="1.16.100"){for(const[e,t]of Object.entries(qm))if(!Ar.exports.compare(e,s,"<"))return t}class ba extends va{constructor(t,i,n){super(i,n);c(this,"blockWatcher");c(this,"blockJson",{});c(this,"formatVersion","1.16.100");c(this,"previewOptions",{});this.blockFilePath=t,this.blockWatcher=new Tn(u.instance,t),this.blockWatcher.on(a=>this.reload(a))}setPreviewOptions({loadComponents:t=!0}){this.previewOptions={loadComponents:t}}async close(){const t=await super.close();return t&&this.blockWatcher.dispose(),t}async reload(t){var i;t||(t=await this.blockWatcher.getFile()),(i=this._renderContainer)==null||i.dispose(),this._renderContainer=void 0,this.loadRenderContainer(t)}async loadRenderContainer(t){var m,f,g,w,y,S;if(this._renderContainer!==void 0)return;await this.setupComplete;const i=await u.getApp();await i.project.packIndexer.fired;const n=i.project.packIndexer.service,a=i.project.config;if(!n)return;let r;try{r=L.parse(await t.text())}catch{console.error("Invalid JSON within block file");return}this.blockJson=x((m=r==null?void 0:r["minecraft:block"])!=null?m:{}),this.formatVersion=(f=r==null?void 0:r.format_version)!=null?f:"1.16.100";const o=await n.getCacheDataFor("block",this.blockFilePath),l=(g=o==null?void 0:o.texture)!=null?g:[];let d;try{d=(y=(w=L.parse(await i.project.getFileFromDiskOrTab(a.resolvePackPath("resourcePack","textures/terrain_texture.json")).then(v=>v.text())))==null?void 0:w.texture_data)!=null?y:{}}catch{console.error("Invalid JSON within terrain_texture.json file");return}const p=await Promise.all(l.map(v=>{var C,P;return(P=(C=d[v])==null?void 0:C.textures)!=null?P:[]}).flat().map(v=>dn(i.fileSystem,a.resolvePackPath("resourcePack",v),[".tga",".png",".jpg",".jpeg"])));if(p.length===0)return;const h=await n.find("geometry","identifier",(S=o.geometryIdentifier)!=null?S:[]);h.length!==0&&(this._renderContainer=x(new Gi(i,{identifier:o.geometryIdentifier[0],texturePaths:p.filter(v=>v!==void 0),connectedAnimations:new Set([])})),this._renderContainer.createGeometry(h[0]),this.renderContainer.ready.then(()=>{this.createModel()}),this._renderContainer.on(()=>{this.createModel()}))}async createModel(){var t;if(await super.createModel(),this.previewOptions.loadComponents){const n=((t=Gm(this.formatVersion))!=null?t:[]).map(({name:a,color:r})=>this.loadCollisionBoxes(a,r)).flat();this.createOutlineBoxes(n)}}findComponents(t,i){const n=[],a=o=>n.push(o);return[`components/${i}`,`permutations/*/components/${i}`].forEach(o=>mi(o,t,a)),n}loadCollisionBoxes(t,i){return this.findComponents(this.blockJson,t).filter(n=>ds(n.origin)&&ds(n.size)).map(({origin:n,size:a})=>({color:i,position:{x:n[0]+a[0]/2,y:n[1],z:n[2]+a[2]/2},size:{x:a[0],y:a[1],z:a[2]}}))}}class An extends va{constructor(t,i,n){super(i,n);c(this,"previewOptions",{});c(this,"clientEntityWatcher");c(this,"chosenFallbackTexturePath");this.previewOptions=t,this.clientEntityFilePath?(this.clientEntityWatcher=new Tn(u.instance,this.clientEntityFilePath),this.clientEntityWatcher.on(a=>this.reload(a))):this.reload()}setPreviewOptions(t){this.previewOptions=Object.assign(this.previewOptions,t)}get clientEntityFilePath(){return this.previewOptions.clientEntityFilePath}get geometryFilePath(){return this.previewOptions.geometryFilePath}get geometryIdentifier(){return this.previewOptions.geometryIdentifier}async close(){var i;const t=await super.close();return t&&((i=this.clientEntityWatcher)==null||i.dispose()),t}async reload(t){var n,a,r;t||(t=await((n=this.clientEntityWatcher)==null?void 0:n.getFile()));const i=(a=this._renderContainer)==null?void 0:a.runningAnimations;(r=this._renderContainer)==null||r.dispose(),this._renderContainer=void 0,this.loadRenderContainer(t,i)}async loadRenderContainer(t,i=new Set){var m,f,g,w,y,S,v,C;if(this._renderContainer!==void 0)return;await this.setupComplete;const n=await u.getApp(),a=n.project.packIndexer.service;if(!a)return;if(t===void 0)return await this.fallbackToOnlyGeometry();let r;try{r=(f=(m=L.parse(await t.text()))==null?void 0:m["minecraft:client_entity"])!=null?f:{}}catch{return}const o=await a.getCacheDataFor("clientEntity",this.clientEntityFilePath),l=o.texturePath,d=await a.find("clientAnimation","identifier",(g=o.animationIdentifier)!=null?g:[],!0),p=await a.find("geometry","identifier",(w=o.geometryIdentifier)!=null?w:[]);if(p.length===0){new J({description:"preview.noGeometry"}),this.close();return}const h=await Promise.all(Object.entries((S=(y=r==null?void 0:r.description)==null?void 0:y.particle_effects)!=null?S:{}).map(async([P,k])=>[P,(await a.find("particle","identifier",[k],!1))[0]]));if(this._renderContainer=x(new Gi(n,{identifier:o.geometryIdentifier[0],texturePaths:l,connectedAnimations:new Set(o.animationIdentifier)})),this._renderContainer.createGeometry(p[0]),d.forEach(P=>this._renderContainer.createAnimation(P)),h.forEach(([P,k],T)=>{!k||this._renderContainer.createParticle(P,k)}),i&&i.forEach(P=>{var k;return(k=this._renderContainer)==null?void 0:k.runningAnimations.add(P)}),this.previewOptions.loadServerEntity&&((v=r==null?void 0:r.description)==null?void 0:v.identifier)){const P=await a.find("entity","identifier",[(C=r==null?void 0:r.description)==null?void 0:C.identifier],!1);P.length>0&&this._renderContainer.addServerEntity(P[0])}this.renderContainer.ready.then(()=>{this.createModel()}),this._renderContainer.on(()=>{this.createModel()})}async fallbackToOnlyGeometry(){if(!this.geometryFilePath||!this.geometryIdentifier)return;const t=await u.getApp(),i=t.project.packIndexer.service,n=o=>t.fileSystem.readdir(t.project.config.resolvePackPath("resourcePack",`textures/${o}`)).then(l=>l.map(d=>({text:`textures/${o}/${d}`,value:t.project.config.resolvePackPath("resourcePack",`textures/${o}/${d}`)}))).catch(()=>[]);if(this.chosenFallbackTexturePath===void 0){const o=(await n("entity")).concat(await n("blocks")),l=new et({options:o,name:"preview.chooseTexture"});this.chosenFallbackTexturePath=await l.fired}const a=await i.getAllFiles("clientAnimation"),r=await i.getCacheDataFor("clientAnimation",void 0,"identifier");this._renderContainer=x(new Gi(t,{identifier:this.geometryIdentifier,texturePaths:[this.chosenFallbackTexturePath],connectedAnimations:new Set(r)})),this._renderContainer.createGeometry(this.geometryFilePath),a.forEach(o=>this._renderContainer.createAnimation(o)),this.renderContainer.ready.then(()=>{this.createModel()}),this._renderContainer.on(()=>{this.createModel()})}}async function Km(s,e){const t=await u.getApp();await t.project.packIndexer.fired;const i=t.project.packIndexer.service,a=await(await e.getFile()).text();let r;try{r=ya(L.parse(a))}catch{return}const o=r["minecraft:geometry"].map(p=>{var h;return(h=p==null?void 0:p.description)==null?void 0:h.identifier}).filter(p=>p!==void 0);let l=o[0];if(o.length>1&&(l=await new et({default:o[0],options:o,name:"preview.chooseGeometry",isClosable:!1}).fired),!l){new J({description:"preview.noGeometry"});return}const d=await i.find("clientEntity","geometryIdentifier",[l]);if(d.length===0){const p=await i.find("block","geometryIdentifier",[l]);if(p.length>0){const h=new ba(p[0],e,s);return h.setPreviewOptions({loadComponents:!1}),h}}return new An({clientEntityFilePath:d[0],geometryFilePath:e.getPath(),geometryIdentifier:l},e,s)}async function Ym(s,e){return new An({clientEntityFilePath:e.getPath()},e,s)}async function Qm(s,e){var d,p,h;const t=await u.getApp();await t.project.packIndexer.fired;const i=t.project.packIndexer.service,a=await(await e.getFile()).text();let r;try{r=(p=(d=L.parse(a))==null?void 0:d["minecraft:entity"])!=null?p:{}}catch{new J({description:"preview.invalidEntity"});return}const o=await i.find("clientEntity","identifier",[(h=r==null?void 0:r.description)==null?void 0:h.identifier]);if(o.length===0){new J({description:"preview.failedClientEntityLoad"});return}const l=new An({clientEntityFilePath:o[0]},e,s);return l.setPreviewOptions({loadServerEntity:!0}),l}class Zm extends Bt{constructor(e,t){super(e.tabSystem.app,t),this.tab=e}onChange(e){this.tab.onChange(e)}}class Xm extends Fn{constructor(t,i){super(t,i);c(this,"emitter");c(this,"config");c(this,"fileWatcher");c(this,"isReloadingDone",new $);c(this,"wintersky");this.setupComplete.once(()=>{this.scene.add(new $r(16)),this.wintersky.global_options.tick_rate=60,this.wintersky.global_options.max_emitter_particles=1e3,this.wintersky.global_options.scale=16}),this.isReloadingDone.dispatch()}async setup(){const{default:t}=await li();this.wintersky=x(new t.Scene({fetchTexture:async i=>{const n=await u.getApp(),a=n.project.config;try{return await ni(a.resolvePackPath("resourcePack",`${i.particle_texture_path}.png`),n.fileSystem)}catch{}}})),await super.setup()}async onActivate(){await super.onActivate(),await this.onChange()}onDeactivate(){var t;(t=this.emitter)==null||t.stop(!0),super.onDeactivate()}onDestroy(){var t,i;(t=this.fileWatcher)==null||t.dispose(),(i=this.emitter)==null||i.delete(),super.onDestroy()}onCreate(){this.addAction(new D({icon:"mdi-refresh",name:"general.reload",onTrigger:()=>this.reload()}))}async receiveCanvas(t){const i=!this._camera;await super.receiveCanvas(t),i&&this.camera.position.set(60,30,60)}async loadParticle(t){var a,r,o;this.fileWatcher||(this.fileWatcher=x(new Zm(this,this.tab.getPath()))),t||(t=(r=await((a=this.fileWatcher)==null?void 0:a.requestFile(await this.getFile())))!=null?r:await this.getFile());let i;try{i=L.parse(await t.text())}catch{return}const{default:n}=await li();(o=this.emitter)==null||o.delete(),this.scene.children.includes(this.wintersky.space)||this.scene.add(this.wintersky.space),this.config=x(new n.Config(this.wintersky,i,{path:this.tab.getPath()})),this.emitter=x(new n.Emitter(this.wintersky,this.config,{loop_mode:"looping",parent_mode:"world"})),this.emitter.start()}render(){var t,i,n;(t=this.controls)==null||t.update(),this.wintersky.updateFacingRotation(this.camera),(i=this.emitter)==null||i.tick(),(n=this.renderer)==null||n.render(this.scene,this.camera),this.renderingRequested=!1,this.isActive&&this.requestRendering()}async onChange(t){await this.isReloadingDone.fired,this.isReloadingDone.resetSignal(),await this.loadParticle(t),this.isReloadingDone.dispatch()}async close(){var i;const t=await super.close();return t&&((i=this.fileWatcher)==null||i.dispose()),t}async reload(){await this.onChange()}get icon(){return this.tab.icon}get iconColor(){return this.tab.iconColor}}async function ef(){var o,l;const s=await u.getApp(),e=s.project,t=new ri;await(await e.compilerService.completedStartUp).fired;const i=(l=(o=e.config.get().bridge)==null?void 0:o.v1CompatMode)!=null?l:!1,n=e.config.resolvePackPath("behaviorPack","commands");let a;try{a=await s.fileSystem.getDirectoryHandle(n)}catch{return[]}const r=[];return await we(a,async(d,p)=>{const[h,m]=await e.compilerService.compileFile(p,await d.getFile().then(async w=>new Uint8Array(await w.arrayBuffer()))),f=new File([m],d.name),g=new Er(new Ss,await f.text(),"development",i);await g.load(t,p,"client"),r.push(...g.getSchema())},void 0,n),r}function Wi(s,e){return e.includes(s)?"full":e.some(t=>t.includes(s))?"partial":"none"}class tf{constructor(e){this.commandData=e}getSchema(){return this.commandData.getSelectorArgumentsSchema()}async getNextCompletionItems(e){if(e.length===1||e[e.length-2]===",")return this.getArgumentNameCompletions();if(e[e.length-2]==="="||e[e.length-2]==="=!"){const t=e[e.length-3];return await this.getArgumentTypeCompletions(t)}return[]}async getArgumentFromWord(e){return(await this.getSchema()).find(i=>i.argumentName===e)}async getArgumentNameCompletions(){const{languages:e}=await I();return(await this.getSchema()).map(i=>({label:i.argumentName,insertText:i.argumentName,kind:e.CompletionItemKind.Property,documentation:i.description}))}async getArgumentTypeCompletions(e){const t=await this.getSchema();return(await Promise.all(t.filter(n=>n.argumentName===e).map(n=>this.commandData.getCompletionItemsForArgument(n)))).flat()}}class Pe{constructor(e=[],t=0,i=!0){this.args=e,this.lastParsedIndex=t,this.isValidResult=i}static from(e){var i,n;const t=(n=(i=e.filter(a=>a.isValidResult).sort((a,r)=>r.lastParsedIndex-a.lastParsedIndex)[0])==null?void 0:i.lastParsedIndex)!=null?n:0;return new Pe(e.map(a=>a.args).flat(),t)}get arguments(){return this.args}}class nf extends ${constructor(){super(...arguments);c(this,"selectorArguments",new tf(this));c(this,"_data")}async loadCommandData(t){var a;const i=await u.getApp();this._data=x(await i.dataLoader.readJSON(`data/packages/${t}/language/mcfunction/main.json`));const n=(a=this._data.$customTypes)!=null?a:{};for(const{commands:r=[],subcommands:o=[]}of this._data.vanilla){const l=r.concat(o.map(d=>d.commands).flat());for(const d of l)!d.arguments||(d.arguments=d.arguments.map(p=>{if(!p.type||!p.type.startsWith("$"))return p;const h=n[p.type.slice(1)];return h?h.map(m=>({...p,...m})):p}).flat())}this.dispatch()}get shouldIgnoreCustomCommands(){return u.getApp().then(t=>!t.projectManager.projectReady.hasFired)}async getSchema(){if(!this._data)throw new Error("Acessing commandData before it was loaded.");const t=[],i=new oi;await i.setup();for await(const n of this._data.vanilla)i.isValid(n.requires)?t.push(n):n.requires||t.push(n);return t}async getCommandsSchema(t=!1){return(await this.getSchema()).map(i=>i.commands).flat().concat(t?[]:await ef()).filter(i=>i!==void 0)}async getSelectorArgumentsSchema(){return(await this.getSchema()).map(t=>t.selectorArguments).flat().filter(t=>t!==void 0)}async getSubcommands(t){return(await this.getSchema()).map(n=>{var a,r;return(r=(a=n.subcommands)==null?void 0:a.filter(o=>o.commandName===t))!=null?r:[]}).flat(1).map(n=>n.commands).flat(1)}allCommands(t,i=!1){return this.getCommandsSchema(i).then(n=>[...new Set(n.map(a=>a==null?void 0:a.commandName).filter(a=>!t||(a==null?void 0:a.includes(t))))])}allSelectorArguments(){return this.getSelectorArgumentsSchema().then(t=>[...new Set(t.map(i=>i==null?void 0:i.argumentName))])}async getCommandCompletionItems(t,i=!1){const{languages:n}=await I(),a=await this.getCommandsSchema(i),r=[];return a.filter(o=>{var l;return!t||((l=o.commandName)==null?void 0:l.includes(t))}).forEach(o=>{r.some(l=>l.label===o.commandName)||r.push({insertText:o.commandName,label:o.commandName,documentation:o.description,kind:n.CompletionItemKind.Method})}),r}async getCommandDefinitions(t,i){return await this.getCommandsSchema(i).then(a=>a.filter(r=>r.commandName===t))}async getNextCompletionItems(t){if(t.length<=1)return await this.getCommandCompletionItems(t[0],await this.shouldIgnoreCustomCommands);const i=t.shift(),n=await this.getCommandDefinitions(i,await this.shouldIgnoreCustomCommands);if(!n||n.length===0)return[];const a=[];return(await Promise.all(n.map(async r=>{const o=(await this.getNextCommandArgument(r,[...t])).arguments;return o.length===0?[]:await Promise.all(o.map(l=>this.getCompletionItemsForArgument(l,r.commandName)))}))).flat(2).forEach(r=>{a.some(o=>o.label===r.label)||a.push(r)}),a}async getNextCommandArgument(t,i){var l,d;if(!t.arguments||t.arguments.length===0)return new Pe([],0,!1);const n=(l=t.arguments)!=null?l:[];let a=0,r=null,o=!1;for(let p=0;p<i.length;p++){const h=i[p];if(h==="")continue;const m=await this.isArgumentType(h,n[a],t.commandName);if(m==="none")return new Pe([],p,!1);if(m==="partial")return new Pe(i.length===p+1?[n[a]]:[],p);if(n[a].type==="command"&&p+1<i.length)return Pe.from((await Promise.all((await this.getCommandDefinitions(h,await this.shouldIgnoreCustomCommands)).map(f=>this.getNextCommandArgument(f,i.slice(p+1))))).flat());if(n[a].type==="subcommand"){const f=await this.getSubcommands(t.commandName);r=(d=n[a+1])!=null?d:null;let g=!1,w=p;for(;r&&!g&&w<i.length;)w++,g=await this.isArgumentType(i[w],r,t.commandName)==="full";if(g){a+=2,p=w;continue}const y=f.filter(C=>C.commandName===i[p]);if(y.length===0)return new Pe([],p);const S=Pe.from(await Promise.all(y.map(C=>this.getNextCommandArgument(C,i.slice(p+1)))));if(S.arguments.length===0){n[a].allowMultiple?(p+=S.lastParsedIndex+1,o=!0):a++;continue}return S}if(a++,a>=n.length)return new Pe([],p)}return n[a]?new Pe([n[a]].concat(r&&o?[r]:[]),i.length-1):new Pe([],i.length-1)}async isArgumentType(t,i,n){var a,r,o,l;switch(i.type){case"string":{if(!((a=i.additionalData)!=null&&a.values))return"full";const d=(l=(o=(r=i.additionalData)==null?void 0:r.values)!=null?o:this.resolveDynamicReference(i.additionalData.schemaReference))!=null?l:[];return Wi(t,d)}case"command":return Wi(t,await this.allCommands(void 0,await this.shouldIgnoreCustomCommands));case"number":return isNaN(Number(t))?"none":"full";case"selector":return t.startsWith("@")?"full":"none";case"boolean":return t==="true"||t==="false"?"full":"none";case"coordinate":return t.startsWith("~")||t.startsWith("^")||!isNaN(Number(t))?"full":"none";case"jsonData":return/^\{.*\}$/.test(t)?"full":"none";case"blockState":return/^\[.*\]$/.test(t)?"full":"none";case"molang":{const d=new Dr;try{d.parse(t)}catch{return"none"}return"full"}case"subcommand":{const d=n?await this.getSubcommands(n):[];return Wi(t,d.map(p=>p.commandName))}case"integerRange":return/^([\d]*)?([.]{2})?([\d]*)?$/.test(t)?"full":"none";default:return"none"}}async getCompletionItemsForArgument(t,i){var a,r,o,l,d;const{languages:n}=await I();if(!t.type)return(a=t.additionalData)!=null&&a.values?this.toCompletionItem((r=t.additionalData)==null?void 0:r.values):(o=t.additionalData)!=null&&o.schemaReference?this.toCompletionItem(this.resolveDynamicReference(t.additionalData.schemaReference).map(({value:p})=>p)):[];switch(t.type){case"command":return this.mergeCompletionItems(await this.getCommandCompletionItems(),{documentation:t.description});case"selector":return this.toCompletionItem(["@a","@e","@p","@s","@r","@initiator"],t.description,n.CompletionItemKind.TypeParameter);case"boolean":return this.toCompletionItem(["true","false"],t.description,n.CompletionItemKind.Value);case"number":return this.toCompletionItem(["0","1","2","3","4","5","6","7","8","9"],t.description,n.CompletionItemKind.Value);case"coordinate":return this.toCompletionItem(["~","^"],t.description,n.CompletionItemKind.Operator);case"string":return(l=t.additionalData)!=null&&l.values?this.toCompletionItem(t.additionalData.values,t.description,n.CompletionItemKind.Constant):(d=t.additionalData)!=null&&d.schemaReference?this.toCompletionItem(this.resolveDynamicReference(t.additionalData.schemaReference).map(({value:p})=>p),t.description,n.CompletionItemKind.Constant):[];case"jsonData":return this.toCompletionItem([["{}","{${1:json data}}"]],t.description,n.CompletionItemKind.Struct);case"blockState":return this.toCompletionItem([["[]","[${1:block states}]"]],t.description,n.CompletionItemKind.Struct);case"scoreData":return this.toCompletionItem([["{}","{${1:scores}}"]],t.description,n.CompletionItemKind.Struct);case"subcommand":return this.toCompletionItem(i?(await this.getSubcommands(i)).map(p=>p.commandName):[],void 0,n.CompletionItemKind.Constant);case"integerRange":return this.toCompletionItem(["0","1","2","3","..0","0..","0..1"],t.description,n.CompletionItemKind.Value)}return[]}async toCompletionItem(t,i,n){const{languages:a}=await I();return n||(n=a.CompletionItemKind.Text),t.map(r=>({label:Array.isArray(r)?`${r[0]}`:`${r}`,insertText:Array.isArray(r)?`${r[1]}`:`${r}`,kind:n,documentation:i,insertTextRules:Array.isArray(r)?a.CompletionItemInsertTextRule.InsertAsSnippet:void 0}))}mergeCompletionItems(t,i){return t.map(n=>{var a;return{...n,documentation:i.documentation?`${i.documentation}

${(a=n.documentation)!=null?a:""}`:n.documentation}})}resolveDynamicReference(t){return new Ft(t,"$ref",t).getCompletionItems({})}}class sf extends ${constructor(){super(...arguments);c(this,"_data")}async loadLangData(t){const i=await u.getApp();this._data=x(await i.dataLoader.readJSON(`data/packages/${t}/language/lang/main.json`)),this.dispatch()}async getValidLangKeys(){if(!this._data)return[];let t=[];for(const i of this._data.keys)t=t.concat(await this.generateKeys(i));return t}async generateKeys(t){var r;const n=(await u.getApp()).project.packIndexer;await n.fired;let a=[];for(const o of t.inject){const l=(r=await n.service.getCacheDataFor(o.fileType,void 0,o.cacheKey))!=null?r:[];for(const d of t.formats)a=a.concat(l.map(p=>d.replace(`{{${o.name}}}`,p)))}return a}}const af=[{name:"preview.viewModel",fileType:"geometry",createPreview:(s,e)=>Km(s,e)},{name:"preview.viewModel",fileType:"clientEntity",createPreview:(s,e)=>Ym(s,e)},{name:"preview.viewEntity",fileType:"entity",createPreview:(s,e)=>Qm(s,e)},{name:"preview.viewParticle",fileType:"particle",createPreview:async(s,e)=>new Xm(e,s)},{name:"preview.viewBlock",fileType:"block",createPreview:async(s,e)=>{const t=new ba(e.getPath(),e,s);return t.setPreviewOptions({loadComponents:!0}),t}}];class St extends Tm{constructor(){super(...arguments);c(this,"commandData",new nf);c(this,"langData",new sf)}onCreate(){af.forEach(t=>this.tabActionProvider.registerPreview(t)),this.tabActionProvider.register({name:"preview.name",icon:"mdi-play",isFor:t=>t instanceof W&&t.getFileHandle().name.endsWith(".html"),trigger:t=>{const i=this.app.project.inactiveTabSystem;!i||(i.add(new xi(i,{filePath:t.getPath(),fileHandle:t.getFileHandle()})),i.setActive(!0))}}),this.commandData.loadCommandData("minecraftBedrock"),this.langData.loadLangData("minecraftBedrock")}getCurrentDataPackage(){return this.app.dataLoader.getDirectoryHandle("data/packages/minecraftBedrock")}}const _a=[[/§4[^§]*/,"colorCode.darkRed"],[/§c[^§]*/,"colorCode.red"],[/§6[^§]*/,"colorCode.gold"],[/§e[^§]*/,"colorCode.yellow"],[/§2[^§]*/,"colorCode.darkGreen"],[/§a[^§]*/,"colorCode.green"],[/§b[^§]*/,"colorCode.aqua"],[/§3[^§]*/,"colorCode.darkAqua"],[/§1[^§]*/,"colorCode.darkBlue"],[/§9[^§]*/,"colorCode.blue"],[/§d[^§]*/,"colorCode.lightPurple"],[/§5[^§]*/,"colorCode.darkPurple"],[/§f[^§]*/,"colorCode.white"],[/§7[^§]*/,"colorCode.gray"],[/§8[^§]*/,"colorCode.darkGray"],[/§0[^§]*/,"colorCode.black"],[/§g[^§]*/,"colorCode.minecoinGold"],[/§o[^§]*/,"colorCode.italic"],[/§l[^§]*/,"colorCode.bold"],[/§n[^§]*/,"colorCode.underline"]];class $n{constructor({id:e,extensions:t,config:i,tokenProvider:n,completionItemProvider:a,codeActionProvider:r}){c(this,"id");c(this,"disposables",[]);c(this,"models",new Map);c(this,"highlighter");this.id=e,I().then(({languages:o,editor:l})=>{o.register({id:e,extensions:t}),this.disposables=[o.setLanguageConfiguration(e,i),l.onDidCreateModel(this.onModelAdded.bind(this)),l.onWillDisposeModel(this.onModelRemoved.bind(this)),l.onDidChangeModelLanguage(d=>{this.onModelRemoved(d.model),this.onModelAdded(d.model)})],this.highlighter=o.setMonarchTokensProvider(e,n),a&&this.disposables.push(o.registerCompletionItemProvider(e,a)),r&&this.disposables.push(o.registerCodeActionProvider(e,r))})}updateTokenProvider(e){I().then(({languages:t})=>{var i;(i=this.highlighter)==null||i.dispose(),this.highlighter=t.setMonarchTokensProvider(this.id,e)})}onModelAdded(e){return e.getLanguageId()!==this.id?!1:(this.validate(e),this.models.set(e.uri.toString(),e.onDidChangeContent(He(t=>this.validate(e,t),500))),!0)}onModelRemoved(e){var i;I().then(({editor:n})=>{n.setModelMarkers(e,this.id,[])});const t=e.uri.toString();(i=this.models.get(t))==null||i.dispose(),this.models.delete(t)}dispose(){var e;(e=this.highlighter)==null||e.dispose(),this.disposables.forEach(t=>t.dispose()),this.disposables=[]}}async function Sa(s){var o;const e=["name","tile","item","entity","action"];let i=s.substring(0,s.length-1).split(".").filter(l=>!e.includes(l));const n=i.indexOf("spawn_egg"),a=i.length===2&&n>=0;if(a&&i.slice(n,n+1),i.length>1){const l=i.find(d=>d.includes(":"));l&&(i=[l])}return i[0]?(i[0].includes(":")&&(i[0]=(o=i[0].split(":").pop())!=null?o:""),`${a?"Spawn ":""}${i[0].split("_").map(l=>`${l[0].toUpperCase()}${l.slice(1)}`).join(" ")}`):""}const rf={comments:{lineComment:"##"}},us={tokenizer:{root:[[/##.*/,"comment"],[/=|\.|:/,"definition"],..._a]}},of={triggerCharacters:["="],provideCompletionItems:async(s,e)=>{var h,m,f;const t=await u.getApp().then(g=>g.project);if(!(t instanceof St))return;const{Range:i,languages:n}=await I(),a=t.langData;await a.fired;const r=await u.getApp();if(!(u.fileType.getId((m=(h=r.project.tabSystem)==null?void 0:h.selectedTab)==null?void 0:m.getPath())==="clientLang"))return{suggestions:[]};const l=s.getLineContent(e.lineNumber);let d=!1;for(let g=e.column-1;g>=0;g--)l[g]==="="&&(d=!0);const p=[];if(d){const g=s.getValueInRange(new i(e.lineNumber,0,e.lineNumber,e.column)).toLowerCase();if(g[g.length-1]==="="){const w=(f=await Sa(g))!=null?f:"";p.push({label:w,insertText:w,kind:n.CompletionItemKind.Text,range:new i(e.lineNumber,e.column,e.lineNumber,e.column)})}}else{const g=new Set(s.getValue().split(`
`).map(y=>y.split("=")[0].trim())),w=(await a.getValidLangKeys()).filter(y=>!g.has(y));p.push(...w.map(y=>({range:new i(e.lineNumber,e.column,e.lineNumber,e.column),kind:n.CompletionItemKind.Text,label:y,insertText:y})))}return{suggestions:p}}},cf={provideCodeActions:async(s,e,t)=>{const{Range:i}=await I(),n=[];for(const a of t.markers){const r=s.getLineContent(a.startLineNumber),o=await Sa(r);n.push({title:R("editors.langValidation.noValue.quickFix"),diagnostics:[a],kind:"quickfix",edit:{edits:[{resource:s.uri,edit:{range:new i(a.startLineNumber,a.startColumn,a.endLineNumber,a.endColumn),text:`${r}=${o}`}}]},isPreferred:!0})}return{actions:n,dispose:()=>{}}}};class lf extends $n{constructor(){super({id:"lang",extensions:["lang"],config:rf,tokenProvider:us,completionItemProvider:of,codeActionProvider:cf}),this.disposables.push(u.eventSystem.on("projectChanged",e=>{const t={root:[...new Set(["minecraft","bridge",e.config.get().namespace].filter(i=>i!==void 0))].map(i=>[i,"keyword"]).concat(us.tokenizer.root)};this.updateTokenProvider({tokenizer:t})}))}async validate(e){const{editor:t,MarkerSeverity:i}=await I(),n=[];for(let a=1;a<=e.getLineCount();a++){const r=e.getLineContent(a);r&&!r.includes("=")&&!r.startsWith("##")&&n.push({startColumn:1,endColumn:r.length+1,startLineNumber:a,endLineNumber:a,message:R("editors.langValidation.noValue.errorMessage"),severity:i.Error})}t.setModelMarkers(e,this.id,n)}}async function df(){const{languages:s,Range:e}=await I();s.registerCompletionItemProvider("json",{provideCompletionItems:async(t,i)=>{var P,k,T;const n=await u.getApp(),a=n.project;if(!(a instanceof St))return;const r=a.commandData,o=await on(t,i),l=(P=n.project.tabSystem)==null?void 0:P.selectedTab;if(!l)return;const d=await n.dataLoader.readJSON("data/packages/minecraftBedrock/location/validCommand.json"),{id:p,meta:{commandsUseSlash:h}={commandsUseSlash:!1}}=(k=u.fileType.get(l.getPath()))!=null?k:{id:"unknown",meta:{commandsUseSlash:!1}},m=(T=d[p])!=null?T:[];if(m.length===0||!hi(o,m)||!Ls(t,i))return;let{word:g,range:w}=await cn(t,i);if(h&&!g.startsWith("/"))return;let y=!1;g.startsWith("/")&&(g=g.slice(1),y=!0);const{tokens:S}=tn(g),v=S[S.length-1];return{suggestions:(await r.getNextCompletionItems(S.map(j=>j.word))).map(({label:j,insertText:M,documentation:le,kind:Re})=>({label:j!=null?j:M,insertText:M,documentation:le,kind:Re,range:new e(i.lineNumber,Math.min(w.endColumn+1,w.startColumn+v.startColumn+(y?2:1)),i.lineNumber,Math.min(w.endColumn+1,i.column+M.length))}))}}})}const Yt={brackets:[["(",")","delimiter.parenthesis"],["[","]","delimiter.square"],["{","}","delimiter.curly"]],keywords:[],selectors:["@a","@e","@p","@r","@s","@initiator"],targetSelectorArguments:[],tokenizer:{root:[[/#.*/,"comment"],[/\{/,{token:"delimiter.bracket",bracket:"@open",next:"@embeddedJson"}],[/\[/,{token:"delimiter.bracket",next:"@targetSelectorArguments",bracket:"@open"}],{include:"@common"},..._a,[/[a-z_][\w\/]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],[/(@[a-z]+)/,{cases:{"@selectors":"type.identifier","@default":"identifier"}}]],common:[[/(\\)?"[^"]*"|'[^']*'/,"string"],[/\=|\,|\!|%=|\*=|\+=|-=|\/=|<|=|>|<>/,"definition"],[/true|false/,"number"],[/-?([0-9]+(\.[0-9]+)?)|((\~|\^)-?([0-9]+(\.[0-9]+)?)?)/,"number"]],embeddedJson:[[/\{/,"delimiter.bracket","@embeddedJson"],[/\}/,"delimiter.bracket","@pop"],{include:"@common"}],targetSelectorArguments:[[/\]/,{token:"@brackets",bracket:"@close",next:"@pop"}],[/{/,{token:"@brackets",bracket:"@open",next:"@targetSelectorScore"}],[/[a-z_][\w\/]*/,{cases:{"@targetSelectorArguments":"variable","@default":"identifier"}}],{include:"@common"}],targetSelectorScore:[[/}/,{token:"@brackets",bracket:"@close",next:"@pop"}],{include:"@common"}]}};function uf(s,e){const t=pf(s,e-1);if(t===-1)return!1;let i="",n=t-1;for(;n>=0&&s[n]!==" ";)i=s[n]+i,n--;return i.startsWith("@")?{selectorStart:t+1,selectorEnd:hf(s,e)}:!1}function pf(s,e){for(let t=e;t>=0;t--){if(s[t]=="[")return t;if(s[t]==="]")return-1}return-1}function hf(s,e){for(let t=e;t<s.length;t++)if(s[t]=="]")return t;return-1}class mf{constructor(e){c(this,"commandData");this.commandData=e}async parseSubcommand(e,t){const{MarkerSeverity:i}=await I(),n=t[0];let a=(await this.commandData.getSubcommands(e)).filter(d=>d.commandName==n.word);if(a.length==0)return{passed:!1,warnings:[],diagnostics:[]};let r,o=[],l=[];for(const d of a){let p=[],h=[],m=!1;if(!(t.length-1<=d.arguments.length)){for(let f=0;f<d.arguments.length;f++){const g=t[f+1],w=d.arguments[f];let y=await this.commandData.isArgumentType(g.word,w);if(w.type=="blockState"&&y=="full"&&!await this.parseBlockState(g.word)&&(y="none"),y!="full"&&(w.type!="selector"||!this.parsePlayerName(g))){m=!0;break}if(w.type=="selector"){const S=await this.parseSelector(g);S.diagnostic&&p.push(S.diagnostic),h=h.concat(S.warnings)}if(w.additionalData){if(w.additionalData.values&&!w.additionalData.values.includes(g.word)){m=!0;break}if(w.additionalData.schemaReference){const S=w.additionalData.schemaReference;new Ft(S,"$ref",S).getCompletionItems({}).find(C=>C.value==g.word)||h.push({severity:i.Warning,message:V("validation.mcfunction.unknownSchema.name",[`"${g.word}"`]),startLineNumber:-1,startColumn:g.startColumn+1,endLineNumber:-1,endColumn:g.endColumn+1})}}}!m&&(!r||r.arguments.length<d.arguments.length)&&(r=d,o=h,l=p)}}return r?{passed:!0,argumentsConsumedCount:r.arguments.length,warnings:o,diagnostics:l}:{passed:!1,warnings:[],diagnostics:[]}}async parseScoreData(e){if(!e.startsWith("{")||!e.endsWith("}"))return!1;let t=e.substring(1,e.length-1).split(",");if(t.find(i=>i==""))return!1;for(const i of t){i.split("=")[0];let n=i.split("=").slice(1).join("=");if(!n||(n.startsWith("!")&&(n=n.substring(1,n.length)),await this.commandData.isArgumentType(n,{argumentName:"scoreData",description:"scoreDataParser",type:"integerRange",isOptional:!1})!="full"))return!1}return!0}async parseBlockState(e){if(!e.startsWith("[")||!e.endsWith("]"))return!1;const t=e.substring(1,e.length-1).split(",");if(t.find(i=>i==""))return!1;for(const i of t){i.split(":")[0];const n=i.split(":").slice(1).join(":");if(!n)return!1;const a=await this.commandData.isArgumentType(n,{argumentName:"scoreData",description:"scoreDataParser",type:"string",isOptional:!1})=="full"&&(/([a-zA-Z])/.test(n)||n=='""')&&(n.startsWith('"')&&n.endsWith('"')||!n.startsWith('"')&&!n.endsWith('"'))&&(n.split('"').length-1==2||n.split('"').length-1==0),r=await this.commandData.isArgumentType(n,{argumentName:"scoreData",description:"scoreDataParser",type:"number",isOptional:!1})=="full";if(!a&&!r)return!1}return!0}parsePlayerName(e){return!(!e.word.startsWith("@")&&!/[a-zA-Z_0-9]{3,16}/.test(e.word))}async parseSelector(e){const{MarkerSeverity:t}=await I();let i=[];if(this.parsePlayerName(e))return{passed:!0,warnings:i};let n=e.word.substring(0,2);if(!["@a","@p","@r","@e","@s","@i"].includes(n))return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.invalidSelectorBase.name",[`"${n}"`]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};if(n=="@i"){if(e.word.substring(0,10)!="@initiator")return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.invalidSelectorBase.name",[`"${n}"`]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};n="@initiator"}if(n==e.word)return{passed:!0,warnings:[]};if(e.word[n.length]!="[")return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.unexpectedSymbol.name",[`"${e.word[n.length]}"`,'"["']),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};if(!e.word.endsWith("]"))return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.unexpectedSymbol.name",[`"${e.word[n.length]}"`,'"]"']),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};let a=e.word.substring(n.length+1,e.word.length-1).split(",");if(a.find(l=>l==""))return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.unexpectedSymbol.name",[`"${e.word[n.length]}"`,`"${R("validation.mcfunction.tokens.selectorArgument")}"`]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};const r=await this.commandData.getSelectorArgumentsSchema();let o=[];for(const l of a){if(l.split("=").length-1<1)return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.unexpectedSymbol.name",[`"${l}"`,'"="']),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};let d=l.split("=")[0],p=l.split("=").slice(1).join("=");const h=r.find(w=>w.argumentName==d);if(!h)return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.invalidSelectorArgument.name",[`"${d}"`]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};const m=p.startsWith("!"),f=o.includes(d);if(m&&(!h.additionalData||!h.additionalData.supportsNegation))return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.argumentNoSupport.name",[`"${d}"`,R("validation.mcfunction.conditions.negation")]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};if(m&&(p=p.substring(1,p.length)),f)return h.additionalData?h.additionalData.multipleInstancesAllowed=="whenNegated"?{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.argumentNoSupport.bothConditions",[`"${d}"`]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]}:{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.argumentNoSupport.name",[`"${d}"`,R("validation.mcfunction.conditions.multipleInstances")]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]}:{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.argumentNoSupport.name",[`"${d}"`,R("validation.mcfunction.conditions.multipleInstances")]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};let g=await this.commandData.isArgumentType(p,h);if(h.type=="scoreData"&&await this.parseScoreData(p)&&(g="full"),g!="full")return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.invalidSelectorArgumentValue.name",[`"${p}"`,`"${d}"`]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};if(h.additionalData){if(h.additionalData.values&&!h.additionalData.values.includes(p))return{passed:!1,diagnostic:{severity:t.Error,message:V("validation.mcfunction.invalidSelectorArgumentValue.name",[`"${p}"`,`"${d}"`]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1},warnings:[]};if(h.additionalData.schemaReference){const w=h.additionalData.schemaReference;new Ft(w,"$ref",w).getCompletionItems({}).find(S=>S.value==p)||i.push({severity:t.Warning,message:V("validation.mcfunction.unknownSchemaInArgument.name",[`"${p}"`,`"${d}"`]),startLineNumber:-1,startColumn:e.startColumn+1,endLineNumber:-1,endColumn:e.endColumn+1})}}(!h.additionalData||!h.additionalData.multipleInstancesAllowed||h.additionalData.multipleInstancesAllowed=="never"||h.additionalData.multipleInstancesAllowed=="whenNegated"&&!m)&&o.push(d)}return{passed:!0,warnings:i}}async parseCommand(e,t,i){const{MarkerSeverity:n}=await I();let a=[],r=[];e&&(t=tn(e).tokens);for(let m=0;m<t.length;m++)if(t[m-1]){if((t[m].word.startsWith(":")||t[m].word.startsWith(",")||t[m].word.startsWith("]"))&&t[m-1].word.endsWith('"')){t.splice(m-1,2,{startColumn:t[m-1].startColumn,endColumn:t[m].endColumn,word:t[m-1].word+t[m].word}),m--;continue}if(t[m].word.startsWith("}")&&t[m-1].word.startsWith("{")||t[m].word.startsWith("]")&&t[m-1].word.startsWith("[")){t.splice(m-1,2,{startColumn:t[m-1].startColumn,endColumn:t[m].endColumn,word:t[m-1].word+t[m].word}),m--;continue}}const o=t[0];if(!o||o.word=="")return a;if(!(await this.commandData.allCommands()).includes(o.word))return a.push({severity:n.Error,message:V("validation.mcfunction.unknownCommand.name",[`"${o.word}"`]),startLineNumber:-1,startColumn:o.startColumn+1,endLineNumber:-1,endColumn:o.endColumn+1}),a;if(t=t.filter(m=>m.word!=""),t.length<2)return a.push({severity:n.Error,message:V("validation.mcfunction.missingArguments.name",[`"${o.word}"`]),startLineNumber:-1,startColumn:o.startColumn+1,endLineNumber:-1,endColumn:o.endColumn+1}),a;let l=await this.commandData.getCommandDefinitions(o.word,!1),d=0,p="",h=-1;for(let m=0;m<l.length;m++){let f=0;for(f=0;f<l[m].arguments.length&&!l[m].arguments[f].isOptional;f++);let g=!1,w=!1,y=[],S=[],v=0;for(let C=1;C<t.length;C++){if(l[m].arguments.length<=v){l.splice(m,1),m--,d<C&&(w=!0,d=C,p=V("validation.mcfunction.invalidArgument.name",[`"${t[C].word}"`])),g=!0;break}const P=t[C],k=l[m].arguments[v];if(k.type=="subcommand"){const j=await this.parseSubcommand(o.word,t.slice(C,t.length));if(S=S.concat(j.diagnostics),j.passed){if(y=y.concat(j.warnings),C+=j.argumentsConsumedCount,k.allowMultiple){let M={passed:!0,argumentsConsumedCount:0,warnings:[],diagnostics:[]};for(;M.passed;)M=await this.parseSubcommand(o.word,t.slice(C+1,t.length)),S=S.concat(M.diagnostics),M.passed&&(y=y.concat(M.warnings),C+=M.argumentsConsumedCount+1)}v++;continue}else{l.splice(m,1),m--,d<C&&(w=!0,d=C,p=V("validation.mcfunction.invalidArgument.name",[`"${t[C].word}"`])),g=!0;break}}if(k.type=="command"){const j=t.slice(C,t.length),M=await this.parseCommand(void 0,j,i+v);S=S.concat(M),v++;break}let T=await this.commandData.isArgumentType(P.word,k,o.word);if(k.type=="blockState"&&T=="full"&&!await this.parseBlockState(P.word)&&(T="none"),T!="full"&&(k.type!="selector"||!this.parsePlayerName(P))){l.splice(m,1),m--,d<C&&(w=!0,d=C,p=V("validation.mcfunction.invalidArgument.name",[`"${t[C].word}"`])),g=!0;break}if(k.type=="selector"){const j=await this.parseSelector(P);j.diagnostic&&S.push(j.diagnostic),y=y.concat(j.warnings)}if(k.additionalData){if(k.additionalData.values&&!k.additionalData.values.includes(P.word)){l.splice(m,1),m--,d<C&&(w=!0,d=C,p=V("validation.mcfunction.invalidArgument.name",[`"${t[C].word}"`])),g=!0;break}if(k.additionalData.schemaReference){const j=k.additionalData.schemaReference;new Ft(j,"$ref",j).getCompletionItems({}).find(le=>le.value==P.word)||y.push({severity:n.Warning,message:V("validation.mcfunction.unknownSchema.name",[`"${t[C].word}"`]),startLineNumber:-1,startColumn:P.startColumn+1,endLineNumber:-1,endColumn:P.endColumn+1})}}k.allowMultiple&&v--,v++}if(g){w&&(a=S);continue}if(v<f&&!l[m].arguments[v].allowMultiple&&v<f-1){l.splice(m,1),m--,d<t.length-1&&(d=t.length-1,p=V("validation.mcfunction.missingArguments.name",[`"${o.word}"`]));continue}if(v<h)break;h=v,a=S,r=y}return l.length==0?(a.push({severity:n.Error,message:p,startLineNumber:-1,startColumn:t[d].startColumn+1,endLineNumber:-1,endColumn:t[d].endColumn+1}),a):a.concat(r)}async parse(e){const t=e.split(`
`),i=[];for(let n=0;n<t.length;n++){const a=t[n];if(a[0]=="#")continue;const r=await this.parseCommand(a,[],0);for(const o of r)o.startLineNumber=n+1,o.endLineNumber=n+1,i.push(o)}return i}}const ff={wordPattern:/[aA-zZ]+/,comments:{lineComment:"#"},brackets:[["(",")"],["[","]"],["{","}"]],autoClosingPairs:[{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"},{open:'"',close:'"'}]},gf={triggerCharacters:[" ","[","{","=",",","!"],async provideCompletionItems(s,e,t,i){const n=await u.getApp().then(f=>f.project);if(!(n instanceof St))return;const{Range:a}=await I(),r=n.commandData;await r.fired;const o=s.getLineContent(e.lineNumber),l=o.slice(0,e.column-1),d=uf(o,e.column-1);if(d){const f=o.slice(d.selectorStart,e.column-1),{tokens:g}=Mr(f,d.selectorStart),w=g[g.length-1];return{suggestions:await r.selectorArguments.getNextCompletionItems(g.map(y=>y.word)).then(y=>y.map(({label:S,insertText:v,documentation:C,kind:P,insertTextRules:k})=>{var T,j;return{label:S!=null?S:v,insertText:v,documentation:C,kind:P,range:new a(e.lineNumber,((T=w==null?void 0:w.startColumn)!=null?T:0)+1,e.lineNumber,((j=w==null?void 0:w.endColumn)!=null?j:0)+1),insertTextRules:k}}))}}const{tokens:p}=tn(l),h=p[p.length-1];return{suggestions:(await r.getNextCompletionItems(p.map(f=>f.word))).map(({label:f,insertText:g,documentation:w,kind:y,insertTextRules:S})=>{var v,C;return{label:f!=null?f:g,insertText:g,documentation:w,kind:y,range:new a(e.lineNumber,((v=h==null?void 0:h.startColumn)!=null?v:0)+1,e.lineNumber,((C=h==null?void 0:h.endColumn)!=null?C:0)+1),insertTextRules:S}})}}},qt=async s=>{const e=await u.getApp();await e.projectManager.fired;const t=e.project;if(!(t instanceof St))return;await t.commandData.fired,await t.compilerReady.fired;const i=await t.commandData.allCommands(void 0,!await t.compilerService.isSetup);Yt.keywords=i.map(a=>a);const n=await t.commandData.allSelectorArguments();Yt.targetSelectorArguments=n,s.updateTokenProvider(Yt)};class wf extends $n{constructor(){super({id:"mcfunction",extensions:["mcfunction"],config:ff,tokenProvider:Yt,completionItemProvider:gf});c(this,"validator");let t=null;const i=u.eventSystem.on("projectChanged",async n=>{t=n,qt(this),await n.compilerReady.fired,await n.compilerService.once(lt(()=>{n===t&&qt(this)}))});u.getApp().then(async n=>{await n.projectManager.projectReady.fired,this.disposables.push(n.projectManager.forEachProject(r=>{this.disposables.push(r.fileSave.any.on(([o])=>{u.fileType.getId(o)==="customCommand"&&qt(this)}))}),i);const a=n.project;a instanceof St&&(this.validator=new mf(a.commandData))})}onModelAdded(t){return super.onModelAdded(t)?(qt(this),!0):!1}async validate(t){if(this.validator==null)return;const{editor:i}=await I(),n=await this.validator.parse(t.getValue());i.setModelMarkers(t,this.id,n)}}const yf={comments:{lineComment:"#"},brackets:[["(",")"],["[","]"],["{","}"]],autoClosingPairs:[{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"},{open:"'",close:"'"}]},vf={ignoreCase:!0,brackets:[["(",")","delimiter.parenthesis"],["[","]","delimiter.square"],["{","}","delimiter.curly"]],keywords:["return","loop","for_each","break","continue","this","function"],identifiers:["v","t","c","q","f","a","arg","variable","temp","context","query"],tokenizer:{root:[[/#.*/,"comment"],[/'[^']'/,"string"],[/[0-9]+(\.[0-9]+)?/,"number"],[/true|false/,"number"],[/\=|\,|\!|%=|\*=|\+=|-=|\/=|<|=|>|<>/,"definition"],[/[a-z_$][\w$]*/,{cases:{"@keywords":"keyword","@identifiers":"type.identifier","@default":"identifier"}}]]}};class bf extends $n{constructor(){super({id:"molang",extensions:["molang"],config:yf,tokenProvider:vf});c(this,"molang",new Ir({}))}async validate(t){const{editor:i,MarkerSeverity:n}=await I();try{this.molang.parse(t.getValue()),i.setModelMarkers(t,this.id,[])}catch(a){let{startColumn:r=0,endColumn:o=1/0,startLineNumber:l=0,endLineNumber:d=1/0}={};i.setModelMarkers(t,this.id,[{startColumn:r+1,endColumn:o+1,startLineNumber:l+1,endLineNumber:d+1,message:a.message,severity:n.Error}])}}}class _f{constructor(){c(this,"otherLanguages",new Set([new bf,new lf,new wf]))}}function Sf(s={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:i,onRegistered:n,onRegisterError:a}=s;let r,o;const l=async(d=!0)=>{d&&(r==null||r.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()})),o&&o.waiting&&await Rr(o.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){r=new Or("/service-worker.js",{scope:"/",type:"classic"}),r.addEventListener("activated",d=>{d.isUpdate||i==null||i()});{const d=()=>{t==null||t()};r.addEventListener("waiting",d),r.addEventListener("externalwaiting",d)}r.register({immediate:e}).then(d=>{o=d,n==null||n(d)}).catch(d=>{a==null||a(d)})}return l}const Cf=Sf({async onNeedRefresh(){console.log("New content is available; please refresh."),await ye("firstStartAfterUpdate",!0),wi({icon:"mdi-update",color:"primary",message:"sidebar.notifications.updateAvailable.message",textColor:"white",onClick:()=>Cf()})},onOfflineReady(){console.log("bridge. is ready to work offline")}}),Ca=s=>({"colorCode.darkRed":{color:"#AA0000"},"colorCode.red":{color:"#FF5555"},"colorCode.gold":{color:"#FFAA00"},"colorCode.yellow":{color:"#FFFF55"},"colorCode.darkGreen":{color:"#00AA00"},"colorCode.green":{color:"#55FF55"},"colorCode.aqua":{color:"#55FFFF"},"colorCode.darkAqua":{color:"#00AAAA"},"colorCode.darkBlue":{color:"#0000AA"},"colorCode.blue":{color:"#5555FF"},"colorCode.lightPurple":{color:"#FF55FF"},"colorCode.darkPurple":{color:"#AA00AA"},"colorCode.white":{color:"#FFFFFF"},"colorCode.gray":{color:"#AAAAAA"},"colorCode.darkGray":{color:"#555555"},"colorCode.black":{color:"#000000"},"colorCode.minecoinGold":{color:"#ff0000"},"colorCode.bold":{color:s,textDecoration:"bold"},"colorCode.italic":{color:s,textDecoration:"italic"},"colorCode.underline":{color:s,textDecoration:"underline"}}),xf={id:"bridge.default.dark",name:"Default Dark",colorScheme:"dark",colors:{text:"#ffffff",primary:Ee?"#3bb6a3":"#0073FF",secondary:Ee?"#3bb6a3":"#0073FF",accent:Ee?"#3bb6a3":"#0073FF",error:"#ff5252",info:"#2196f3",warning:"#fb8c00",success:"#4caf50",background:"#121212",sidebarNavigation:"#1F1F1F",expandedSidebar:"#1F1F1F",sidebarSelection:"#151515",menu:"#252525",footer:"#111111",tooltip:"#1F1F1F",toolbar:"#000000",tabActive:"#121212",tabInactive:"#1F1F1F",lineHighlightBackground:"#292929",scrollbarThumb:"#000000",behaviorPack:"#ff5252",resourcePack:"#0073FF",skinPack:"#fb8c00",worldTemplate:"#4caf50"},highlighter:{type:{color:"#a6e22e"},keyword:{color:"#f92672"},definition:{color:"#fd971f"},atom:{color:"#ae81ff"},number:{color:"#ae81ff"},string:{color:"#e6db74"},variable:{color:"#6e9eff"},variableStrong:{color:"#6e9eff"},meta:{color:"white"},comment:{color:"#75715e"},...Ca("#fff")}},kf={id:"bridge.default.light",name:"Default Light",colorScheme:"light",colors:{text:"#000000",primary:Ee?"#3bb6a3":"#0073FF",secondary:Ee?"#3bb6a3":"#0073FF",accent:Ee?"#3bb6a3":"#0073FF",error:"#ff5252",info:"#2196f3",warning:"#fb8c00",success:"#4caf50",background:"#fafafa",sidebarNavigation:"#e8e8e8",expandedSidebar:"#e8e8e8",sidebarSelection:"#FFFFFF",menu:"#FFFFFF",tooltip:"#424242",toolbar:"#e0e0e0",footer:"#f5f5f5",tabActive:"#fafafa",tabInactive:"#e0e0e0",lineHighlightBackground:"#e0e0e0",scrollbarThumb:"#c8c8c8",behaviorPack:"#ff5252",resourcePack:"#0073FF",skinPack:"#fb8c00",worldTemplate:"#4caf50"},highlighter:{type:{color:"black"},keyword:{color:"#5A5CAD"},definition:{textDecoration:"underline"},atom:{color:"#6C8CD5"},number:{color:"#164"},string:{color:"red"},variable:{color:"black"},variableStrong:{color:"black"},meta:{color:"yellow"},comment:{color:"#0080FF"},...Ca("#000")}};class Pf{constructor(e,t){c(this,"id");c(this,"colorScheme");c(this,"name");c(this,"colorMap");c(this,"highlighterDef");c(this,"monacoDef");c(this,"monacoSubTheme");var i;this.themeDefinition=e,this.isGlobal=t,this.id=e.id,this.name=e.name,this.colorScheme=(i=e.colorScheme)!=null?i:"dark",this.colorMap=new Map(Object.entries(e.colors)),this.monacoDef=e.monaco,this.highlighterDef=e.highlighter,this.monacoSubTheme=new il(this)}apply(e,t){var i;Ve.set(t.theme.themes,this.colorScheme,Object.fromEntries(this.colorMap.entries())),Ve.set(t.theme,"dark",this.colorScheme==="dark"),e.setThemeColor((i=this.colorMap.get("toolbar"))!=null?i:"red"),this.applyMonacoTheme()}async applyMonacoTheme(){await this.monacoSubTheme.apply()}getColor(e){var t;return(t=this.colorMap.get(e))!=null?t:"red"}getHighlighterInfo(e){var t;return(t=this.highlighterDef)==null?void 0:t[e]}getMonacoDefinition(){var e;return(e=this.monacoDef)!=null?e:{}}getHighlighterDefinition(){var e;return(e=this.highlighterDef)!=null?e:{}}getThemeDefinition(){return this.themeDefinition}}class jf extends z{constructor(t){var r,o;super();c(this,"mode");c(this,"themeMap",new Map);c(this,"themeColorTag",null);c(this,"currentTheme","bridge.default.dark");c(this,"colorScheme",new $);this.vuetify=t;const i=window.matchMedia("(prefers-color-scheme: light)");this.mode=i.matches?"light":"dark";const n=l=>{this.colorScheme.dispatch(l.matches?"light":"dark"),this.mode=l.matches?"light":"dark",this.updateTheme()};"addEventListener"in i?i.addEventListener("change",l=>n(l)):i.addListener(l=>n(l));const a=document.querySelectorAll("meta[name='theme-color']");this.themeColorTag=(r=a[0])!=null?r:null,this.themeColorTag.removeAttribute("media"),(o=a[1])==null||o.remove(),this.themeColorTag||(this.themeColorTag=document.createElement("meta"),this.themeColorTag.setAttribute("name","theme-color"),document.head.appendChild(this.themeColorTag)),this.themeColorTag.id="theme-color-tag",this.addTheme(xf,!0),this.addTheme(kf,!0),this.applyTheme(this.themeMap.get("bridge.default.dark"))}getCurrentMode(){return this.mode}getCurrentTheme(){return this.themeMap.get(this.currentTheme)}applyTheme(t){t==null||t.apply(this,this.vuetify)}async applyMonacoTheme(){var t;(t=this.themeMap.get(this.currentTheme))==null||t.applyMonacoTheme()}async updateTheme(){var p,h,m,f,g;const t=await u.getApp();let i=(p=b==null?void 0:b.appearance)==null?void 0:p.colorScheme;(!i||i==="auto")&&(i=this.mode),await t.projectManager.projectReady.fired;const n=t.projectConfig.get().bridge,a=(h=i==="light"?n==null?void 0:n.lightTheme:n==null?void 0:n.darkTheme)!=null?h:"bridge.noSelection",r=(f=(m=b==null?void 0:b.appearance)==null?void 0:m[`${i}Theme`])!=null?f:`bridge.default.${i}`,o=a!=="bridge.noSelection"?a:r,l=this.themeMap.get(a!=="bridge.noSelection"?a:r),d=this.themeMap.get(`bridge.default.${i}`);this.currentTheme!==(l?o:`bridge.default.${i}`)&&(this.currentTheme=l?o:`bridge.default.${i}`,this.applyTheme(l!=null?l:d),this.dispatch((g=l==null?void 0:l.colorScheme)!=null?g:"dark"))}async loadDefaultThemes(t){await t.dataLoader.fired,(await t.dataLoader.readJSON("data/packages/common/themes.json")).map(n=>this.addTheme(n,!0)),this.updateTheme()}async loadTheme(t,i=!0,n){const a=await t.getFile();let r;try{r=L.parse(await a.text())}catch{throw new Error(`Failed to load theme "${a.name}"`)}const o=this.addTheme(r,i);n&&n.push(o)}getThemes(t,i){const n=[];for(const[a,r]of this.themeMap)(!t||r.colorScheme===t)&&(r.isGlobal||i===r.isGlobal)&&n.push(r);return n}setThemeColor(t){this.themeColorTag.setAttribute("content",t)}addTheme(t,i){var a,r;const n=this.themeMap.get(`bridge.default.${(a=t.colorScheme)!=null?a:"dark"}`);return this.themeMap.set(t.id,new Pf(pi((r=n==null?void 0:n.getThemeDefinition())!=null?r:{},t),i)),this.updateTheme(),{dispose:()=>this.themeMap.delete(t.id)}}getColor(t){const i=this.themeMap.get(this.currentTheme);if(!i)throw new Error("No theme currently loaded");return i.getColor(t)}getHighlighterInfo(t){const i=this.themeMap.get(this.currentTheme);if(!i)throw new Error("No theme currently loaded");return i.getHighlighterInfo(t)}}const Bn=class{constructor(){c(this,"confirmPermissionWindow",null);c(this,"_status","waiting")}get status(){return this._status}setStatus(e){this._status=e}async setupFileSystem(e){var n;let t=await he("bridgeBaseDir");!A.value&&t&&(t=await this.verifyPermissions(t));let i=!1;if((A.value||await Zr("bridgeFolder")&&((n=await nn("projects"))!=null?n:[]).length>0)&&(A.value||await new N({title:"windows.upgradeFs.title",description:"windows.upgradeFs.description",cancelText:"general.later",onCancel:()=>{A.value=!0},onConfirm:async()=>{i=!0,A.value=!1}}).fired,i||(t=x(new ne(null,"bridgeFolder",void 0)),await t.setupDone.fired)),!t){const a=Bn.state;a.showInitialSetupDialog.value=!0,t=await a.receiveDirectoryHandle.fired,await this.verifyPermissions(t);try{t instanceof ne||await ye("bridgeBaseDir",t)}catch{}a.setupDone.dispatch()}if(A.value&&!await he("confirmedUnsupportedBrowser")&&e.windows.browserUnsupported.open(),i){const a=x(new ne(null,"bridgeFolder",void 0));await a.setupDone.fired;const r=new Z(a),o=new Z(t),l=["projects","extensions"];for(const p of l){const h=await r.getDirectoryHandle(p).catch(()=>{});!h||(await o.copyFolderByHandle(h,await o.getDirectoryHandle(p,{create:!0})),await h.removeSelf())}const d=["data/settings.json"];for(const p of d){const h=await r.getFileHandle(p).catch(()=>{});!h||await o.fileExists(p)||(await o.copyFileHandle(h,await o.getFileHandle(p,!0)),await h.removeSelf())}}return this._status="done",t}async verifyPermissions(e,t=!0){if(typeof e.requestPermission!="function"||typeof e.queryPermission!="function")return await e.getDirectoryHandle("data",{create:!0}),e;const i={writable:!0,mode:"readwrite"};try{t&&await e.requestPermission(i)!=="granted"&&await this.verifyPermissions(e,!1)}catch{}await e.queryPermission(i)!=="granted"&&this.confirmPermissionWindow===null&&(this.confirmPermissionWindow=new J({name:"windows.projectFolder.title",description:"windows.projectFolder.content",onClose:async()=>{this._status="userInteracted",this.confirmPermissionWindow=null,await e.requestPermission(i)!=="granted"&&await this.verifyPermissions(e,!1)}}),await this.confirmPermissionWindow.fired);try{await e.getDirectoryHandle("data",{create:!0})}catch{return}return e}};let Qt=Bn;c(Qt,"state",{showInitialSetupDialog:F(!1),receiveDirectoryHandle:new $,setupDone:new $});async function tt(s){const e=u.instance;e.windows.loadingWindow.open();const t=`${e.project.projectPath}/builds/${s!=null?s:e.project.name}.brproject`,i=new ji(A.value?e.fileSystem.baseDirectory:e.project.baseDirectory);try{await yi(t,await i.package(new Set(["builds"])),e.fileSystem)}catch(n){console.error(n)}e.windows.loadingWindow.close()}class xa{constructor(e){c(this,"fileSystem");c(this,"task");this.directory=e,this.fileSystem=new Z(e)}createTask(e,t={icon:"mdi-folder-zip",name:"taskManager.tasks.unzipper.name",description:"taskManager.tasks.unzipper.description"}){this.task=e.create(t)}}class Ff extends xa{unzip(e){var r;const t=new Z(this.directory);(r=this.task)==null||r.update(0,e.length);let i=0,n=0,a=0;return new Promise(async(o,l)=>{const d=new Lr(async p=>{var h,m,f;n++,await this.streamFile(t,p).catch(g=>l(g)),i+=(h=p.size)!=null?h:0,(m=this.task)==null||m.update(i),a++,a===n&&((f=this.task)==null||f.complete(),o())});d.register(Wr),d.push(e,!0)})}async streamFile(e,t){const n=await(await e.getFileHandle(t.name,!0)).createWritable();let a=0;const r=[],o=new Promise((l,d)=>{t.ondata=(p,h,m)=>{if(p)return d(p);h&&(r.push(n.write({type:"write",data:h,position:a})),a+=h.length),m&&l()}});t.start(),await o,await Promise.all(r),await n.close()}}async function En(s,e=!0){const t=await u.getApp(),i=t.fileSystem;await i.unlink("import");const n=await i.getDirectoryHandle("import",{create:!0});if(await t.projectManager.projectReady.fired,e){const d=new Ff(n),p=await s.getFile(),h=new Uint8Array(await p.arrayBuffer());d.createTask(t.taskManager),await d.unzip(h)}let a="import";if(!await i.fileExists("import/config.json")){if(A.value){try{await i.move("import/data","data")}catch{}try{await i.move("import/extensions","extensions")}catch{}await _e.loadSettings(t),await t.extensionLoader.reload(),ge.setDefaultLanguage()}try{const[d]=await i.readdir("import/projects");a=`import/projects/${d}`}catch{return}}A.value&&!t.hasNoProjects&&await new N({description:"windows.projectChooser.openNewProject.saveCurrentProject",cancelText:"general.no",confirmText:"general.yes"}).fired&&await tt();const r=await ki(fe(s.name,".brproject"),await i.getDirectoryHandle("projects")),o=a==="import"?`projects/${r}`:a.replace("import/","");await i.move(a,o);let l;t.hasNoProjects||(l=t.project),A.value&&!t.hasNoProjects&&await t.projectManager.removeProject(l),await t.projectManager.addProject(await i.getDirectoryHandle(o),!0),await i.unlink("import")}class di extends xa{unzip(e){return new Promise(async(t,i)=>{en(e,async(n,a)=>{var l,d,p,h,m;if(n)return i(n);const r=new Z(this.directory);(l=this.task)==null||l.update(0,Object.keys(a).length);let o=0;for(const f in a){if(fe(f).startsWith(".")){(d=this.task)==null||d.update(++o),a[f]=void 0;continue}if(f.endsWith("/")){(p=this.task)==null||p.update(++o),a[f]=void 0;continue}await this.fileSystem.write(await r.getFileHandle(f,!0),a[f]),a[f]=void 0,(h=this.task)==null||h.update(++o)}(m=this.task)==null||m.complete(),t()}),e=void 0})}}const Tf={name:"SelectedStatus",mixins:[G],props:{selected:{type:Boolean,required:!0}}};var Af=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex align-center mb-2"},[e.selected?[t("v-icon",{staticClass:"mr-1",attrs:{color:"success",small:""}},[e._v(" mdi-checkbox-marked-circle-outline ")]),t("span",[e._v(" "+e._s(e.t("general.active"))+" ")])]:[t("v-icon",{staticClass:"mr-1",attrs:{small:""}},[e._v(" mdi-checkbox-blank-circle-outline ")]),t("span",[e._v(" "+e._s(e.t("general.inactive"))+" ")])]],2)},$f=[],Ef=_(Tf,Af,$f,!1,null,null,null,null);const Ti=Ef.exports;const Df={name:"PackTypeViewer",mixins:[G],components:{SelectedStatus:Ti,BridgeSheet:Oe},props:{packType:Object,selected:Boolean,isSelectable:Boolean}};var Mf=function(){var e=this,t=e._self._c;return t("BridgeSheet",{directives:[{name:"ripple",rawName:"v-ripple",value:e.isSelectable,expression:"isSelectable"}],class:{"rounded-lg pa-3 content-area":!0,selected:e.selected},nativeOn:{click:function(i){return i.stopPropagation(),e.$emit("click")}}},[t("div",{staticClass:"d-flex"},[t("v-icon",{staticClass:"mr-2",attrs:{color:e.packType.color}},[e._v(" "+e._s(e.packType.icon)+" ")]),t("h1",{staticClass:"pack-type-header"},[e._v(" "+e._s(e.t(`packType.${e.packType.id}.name`))+" ")])],1),e.isSelectable?t("SelectedStatus",{attrs:{selected:e.selected}}):e._e(),e.packType.version?t("div",{staticClass:"mb-2"},[e._v(" Pack Version: v"+e._s(e.packType.version.join("."))+" ")]):e._e(),t("span",[e._v(e._s(e.t(`packType.${e.packType.id}.description`)))]),e._t("default",null,{selected:e.selected})],2)},If=[],Of=_(Df,Mf,If,!1,null,"e09fc535",null,null);const ka=Of.exports;const Rf={name:"ToogleSheet",components:{BridgeSheet:Oe},props:{value:Boolean,dark:Boolean,isToggleable:{type:Boolean,default:!0}},data(){return{internalValue:this.value}},methods:{onClick(){!this.isToggleable||(this.internalValue=!this.internalValue,this.$emit("input",this.internalValue))}}};var Wf=function(){var e=this,t=e._self._c;return t("BridgeSheet",{directives:[{name:"ripple",rawName:"v-ripple",value:e.isToggleable,expression:"isToggleable"}],class:{"content-area pa-2":!0,selected:e.internalValue},attrs:{dark:e.dark},nativeOn:{click:function(i){return e.onClick.apply(null,arguments)}}},[e._t("default",null,{value:e.internalValue})],2)},Lf=[],Nf=_(Rf,Wf,Lf,!1,null,"1eed6d78",null,null);const Dn=Nf.exports;const Bf={name:"ExperimentalGameplay",mixins:[G],components:{ToggleSheet:Dn,SelectedStatus:Ti},props:{experiment:{type:Object,required:!0},isToggleable:{type:Boolean,default:!0},value:Boolean,dense:Boolean}};var Vf=function(){var e=this,t=e._self._c;return t("ToggleSheet",{attrs:{value:e.value,dark:!0,isToggleable:e.isToggleable},on:{input:function(i){return e.$emit("input",i)}},scopedSlots:e._u([{key:"default",fn:function({value:i}){return[t("div",{staticClass:"d-flex align-center"},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary"}},[e._v(" "+e._s(e.experiment.icon)+" ")]),t("h1",{staticClass:"experimental-gameplay-header"},[e._v(" "+e._s(e.t(`experimentalGameplay.${e.experiment.id}.name`))+" ")])],1),t("SelectedStatus",{attrs:{selected:i}}),e.dense?e._e():t("p",[e._v(" "+e._s(e.t(`experimentalGameplay.${e.experiment.id}.description`))+" ")])]}}])})},Hf=[],Uf=_(Bf,Vf,Hf,!1,null,"272f8fd7",null,null);const Pa=Uf.exports;const zf={name:"ExperimentalGameplay",mixins:[G],components:{ToggleSheet:Dn,SelectedStatus:Ti},props:{file:{type:Object,required:!0},isToggleable:{type:Boolean,default:!0},value:Boolean}};var Jf=function(){var e=this,t=e._self._c;return t("ToggleSheet",{attrs:{value:e.value,dark:!0,isToggleable:e.isToggleable},on:{input:function(i){return e.$emit("input",i)}},scopedSlots:e._u([{key:"default",fn:function({value:i}){return[t("div",{staticClass:"d-flex align-center"},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary"}},[e._v(" "+e._s(e.file.icon)+" ")]),t("h1",{staticClass:"individual-file-header"},[e._v(" "+e._s(e.t(`windows.createProject.individualFiles.file.${e.file.id}.name`))+" ")])],1),t("h2",{staticClass:"text-normal font-weight-light"},[e._v(" "+e._s(e.t(`packType.${e.file.packId}.name`))+" ")]),t("SelectedStatus",{attrs:{selected:i}}),t("p",[e._v(" "+e._s(e.t(`windows.createProject.individualFiles.file.${e.file.id}.description`))+" ")])]}}])})},qf=[],Gf=_(zf,Jf,qf,!1,null,"a3f2b927",null,null);const Kf=Gf.exports;function ja(s,e){if(!e||e==="*")return!0;const t=e.split(","),i=s.name||"",n=s.type||"",a=n.replace(/\/.*$/,"");return t.some(r=>{const o=r.trim();return o.charAt(0)==="."?i.toLowerCase().endsWith(o.toLowerCase()):/\/\*$/.test(o)?a===o.replace(/\/.*$/,""):n===o})}const Yf=X({__name:"CreateProject",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.state,n=B(()=>e.window.projectNameRules.map(d=>p=>{const h=d(p);return h===!0?!0:t(h)}));async function a(){i.isCreatingProject=!0,await e.window.createProject(),i.isCreatingProject=!1,e.window.close()}function r(){e.window.close()}function o(d){const p=i.createOptions.packs,h=p.indexOf(d);h>-1?p.splice(h,1):p.push(d)}function l(d){var h;const p=(h=d.dataTransfer)==null?void 0:h.files[0];!p||!ja(p,"image/png")||(i.createOptions.icon=p)}return{__sfc:!0,t,props:e,state:i,nameRules:n,createProject:a,close:r,togglePack:o,onDropFile:l,BaseWindow:ce,PackTypeViewer:ka,ExperimentalGameplay:Pa,CreateFile:Kf,BridgeSheet:Oe}}});var Qf=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"windows.createProject.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,hasCloseButton:!e.window.isFirstProject,isFullscreen:!1,isPersistent:i.state.isCreatingProject||e.window.isFirstProject,percentageWidth:80,percentageHeight:80},on:{closeWindow:i.close},scopedSlots:e._u([{key:"default",fn:function(){return[e.window.isFirstProject?t(i.BridgeSheet,{staticClass:"pa-3 mb-2"},[t("h1",[e._v(" "+e._s(i.t("windows.createProject.welcome"))+" ")]),t("span",[e._v(" "+e._s(i.t("windows.createProject.welcomeDescription"))+" ")])]):e._e(),t("v-row",{staticClass:"mb-6",attrs:{dense:""}},e._l(e.window.availablePackTypes,function(n){return t("v-col",{key:n.id,attrs:{xs:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[t(i.PackTypeViewer,{staticStyle:{height:"100%"},attrs:{packType:n,isSelectable:"",selected:i.state.createOptions.packs.includes(n.id)},on:{click:function(a){return i.togglePack(n.id)}},scopedSlots:e._u([n.id==="behaviorPack"?{key:"default",fn:function({selected:a}){return[t("v-switch",{staticClass:"mt-3",attrs:{inset:"",dense:"",label:i.t("windows.createProject.bpAsRpDependency"),value:i.state.createOptions.rpAsBpDependency||i.state.createOptions.packs.includes("resourcePack"),disabled:!a||!i.state.createOptions.packs.includes("resourcePack")},nativeOn:{click:function(r){r.stopPropagation(),i.state.createOptions.bpAsRpDependency=!i.state.createOptions.bpAsRpDependency}}})]}}:n.id==="resourcePack"?{key:"default",fn:function({selected:a}){return[t("v-switch",{staticClass:"mt-3",attrs:{inset:"",dense:"",label:i.t("windows.createProject.rpAsBpDependency"),value:i.state.createOptions.rpAsBpDependency||i.state.createOptions.packs.includes("behaviorPack"),disabled:!a||!i.state.createOptions.packs.includes("behaviorPack")},nativeOn:{click:function(r){r.stopPropagation(),i.state.createOptions.rpAsBpDependency=!i.state.createOptions.rpAsBpDependency}}})]}}:null],null,!0)})],1)}),1),t("v-expansion-panels",{staticClass:"mb-6"},[t("v-expansion-panel",[t("v-expansion-panel-header",{attrs:{color:"expandedSidebar","expand-icon":"mdi-menu-down"}},[e._v(" "+e._s(i.t("general.experimentalGameplay"))+" ")]),t("v-expansion-panel-content",{attrs:{color:"expandedSidebar"}},[t("v-row",{attrs:{dense:""}},e._l(e.window.experimentalToggles,function(n){return t("v-col",{key:n.id,attrs:{xs:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[t(i.ExperimentalGameplay,{staticStyle:{height:"100%"},attrs:{experiment:n},model:{value:i.state.createOptions.experimentalGameplay[n.id],callback:function(a){e.$set(i.state.createOptions.experimentalGameplay,n.id,a)},expression:`
									state.createOptions
										.experimentalGameplay[experiment.id]
								`}})],1)}),1)],1)],1)],1),e.window.packCreateFiles.length>0?t("v-expansion-panels",{staticClass:"mb-6"},[t("v-expansion-panel",[t("v-expansion-panel-header",{attrs:{color:"expandedSidebar","expand-icon":"mdi-menu-down"}},[e._v(" "+e._s(i.t("windows.createProject.individualFiles.name"))+" ")]),t("v-expansion-panel-content",{attrs:{color:"expandedSidebar"}},[t("v-row",{attrs:{dense:""}},e._l(e.window.packCreateFiles,function(n,a){return t("v-col",{key:`${a}-${n.id}`,attrs:{xs:"12",sm:"6",md:"4",lg:"3",xl:"3"}},[t(i.CreateFile,{staticStyle:{height:"100%"},attrs:{file:n},model:{value:n.isActive,callback:function(r){e.$set(n,"isActive",r)},expression:"file.isActive"}})],1)}),1)],1)],1)],1):e._e(),t("div",{staticClass:"d-flex"},[t("div",{staticStyle:{width:"40%"},on:{drop:function(n){return n.preventDefault(),n.stopPropagation(),i.onDropFile.apply(null,arguments)},dragover:function(n){n.preventDefault(),n.stopPropagation()}}},[t("v-file-input",{staticClass:"mr-2",attrs:{label:i.t("windows.createProject.packIcon"),"prepend-icon":null,"prepend-inner-icon":"mdi-image-outline",accept:"image/png",outlined:"",dense:""},model:{value:i.state.createOptions.icon,callback:function(n){e.$set(i.state.createOptions,"icon",n)},expression:"state.createOptions.icon"}})],1),t("v-text-field",{staticClass:"ml-2",attrs:{label:i.t("windows.createProject.projectName.name"),rules:i.nameRules,autocomplete:"off",outlined:"",dense:""},model:{value:i.state.createOptions.name,callback:function(n){e.$set(i.state.createOptions,"name",n)},expression:"state.createOptions.name"}})],1),t("v-textarea",{attrs:{label:i.t("windows.createProject.projectDescription"),autocomplete:"off","auto-grow":"",rows:"1",counter:"",outlined:"",dense:""},model:{value:i.state.createOptions.description,callback:function(n){e.$set(i.state.createOptions,"description",n)},expression:"state.createOptions.description"}}),t("div",{staticClass:"d-flex"},[t("v-text-field",{staticClass:"mr-2",attrs:{label:i.t("windows.createProject.projectPrefix"),autocomplete:"off",outlined:"",dense:""},model:{value:i.state.createOptions.namespace,callback:function(n){e.$set(i.state.createOptions,"namespace",n)},expression:"state.createOptions.namespace"}}),t("v-text-field",{staticClass:"mx-2",attrs:{label:i.t("windows.createProject.projectAuthor"),autocomplete:"off",outlined:"",dense:""},model:{value:i.state.createOptions.author,callback:function(n){e.$set(i.state.createOptions,"author",n)},expression:"state.createOptions.author"}}),t("v-autocomplete",{staticClass:"ml-2",attrs:{label:i.t("windows.createProject.projectTargetVersion"),autocomplete:"off","menu-props":{maxHeight:220,rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},items:e.window.availableTargetVersions,loading:i.state.availableTargetVersionsLoading,outlined:"",dense:""},model:{value:i.state.createOptions.targetVersion,callback:function(n){e.$set(i.state.createOptions,"targetVersion",n)},expression:"state.createOptions.targetVersion"}})],1),t("div",{staticClass:"d-flex flex-column"},[t("v-switch",{attrs:{inset:"",dense:"",label:i.t("windows.createProject.useLangForManifest")},model:{value:i.state.createOptions.useLangForManifest,callback:function(n){e.$set(i.state.createOptions,"useLangForManifest",n)},expression:"state.createOptions.useLangForManifest"}}),t("v-switch",{attrs:{inset:"",dense:"",label:i.t("windows.createProject.bdsProject")},model:{value:i.state.createOptions.bdsProject,callback:function(n){e.$set(i.state.createOptions,"bdsProject",n)},expression:"state.createOptions.bdsProject"}})],1)]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary",disabled:!e.window.hasRequiredData||i.state.isCreatingProject,loading:i.state.isCreatingProject},on:{click:i.createProject}},[t("v-icon",{staticClass:"pr-2"},[e._v("mdi-plus")]),t("span",[e._v(e._s(i.t("windows.createProject.create")))])],1)]},proxy:!0}],null,!1,3624044562)}):e._e()},Zf=[],Xf=_(Yf,Qf,Zf,!1,null,"1c074f05",null,null);const eg=Xf.exports;class Ct{async create(e,t){await e.mkdir(this.packPath);for(const i of this.createFiles)!i.isActive||await i.create(e,t)}}class ie{constructor(){c(this,"icon","mdi-file-outline");c(this,"isActive",!0);c(this,"isConfigurable",!0)}}class Ai extends ie{constructor(t){super();c(this,"id","packManifest");c(this,"isConfigurable",!1);this.pack=t}get type(){switch(this.pack){case"BP":return"data";case"RP":return"resources";case"SP":return"skin_pack";case"WT":return"world_template"}}async transformTargetVersion(t){var a;return(a=(await(await u.getApp()).dataLoader.readJSON("data/packages/minecraftBedrock/minEngineVersionMap.json"))[t])!=null?a:t}async create(t,i){var a,r,o,l,d,p,h,m,f,g,w;i.packs.includes("behaviorPack")&&((r=(a=i.uuids).data)!=null||(a.data=E())),i.packs.includes("resourcePack")&&((l=(o=i.uuids).resources)!=null||(o.resources=E())),i.packs.includes("skinPack")&&((p=(d=i.uuids).skin_pack)!=null||(d.skin_pack=E())),i.packs.includes("worldTemplate")&&((m=(h=i.uuids).world_template)!=null||(h.world_template=E()));const n={format_version:2,metadata:{authors:Array.isArray(i.author)?i.author:[i.author],generated_with:{bridge:[de],dash:[zi]}},header:{name:i.useLangForManifest?i.name:"pack.name",description:i.useLangForManifest?i.description:"pack.description",min_engine_version:(this.type,(await this.transformTargetVersion(i.targetVersion)).split(".").map(y=>Number(y))),uuid:(g=i.uuids[(f=this.type)!=null?f:"data"])!=null?g:E(),version:[1,0,0]},modules:[{type:this.type,uuid:E(),version:[1,0,0]}]};if(i.rpAsBpDependency&&i.packs.includes("resourcePack")&&this.type==="data"){if(!i.uuids.resources)throw new Error("Trying to register RP uuid before it was defined");n.dependencies=[{uuid:i.uuids.resources,version:[1,0,0]}]}if(i.bpAsRpDependency&&i.packs.includes("behaviorPack")&&this.type==="resources"){if(!i.uuids.data)throw new Error("Trying to register RP uuid before it was defined");n.dependencies=[{uuid:i.uuids.data,version:[1,0,0]}]}this.type==="data"&&i.experimentalGameplay.enableGameTestFramework&&(Q(i.targetVersion,"1.19.0",">=")?n.modules.push({type:"script",language:"javascript",uuid:E(),entry:"scripts/main.js",version:[1,0,0]}):n.modules.push({type:"javascript",uuid:E(),entry:"scripts/main.js",version:[1,0,0]}),(w=n.dependencies)!=null||(n.dependencies=[]),Q(i.targetVersion,"1.19.30",">=")?Q(i.targetVersion,"1.19.40",">=")?(n.dependencies.push({module_name:"@minecraft/server",version:"1.0.0-beta"},{module_name:"@minecraft/server-gametest",version:"1.0.0-beta"},{module_name:"@minecraft/server-ui",version:"1.0.0-beta"}),i.bdsProject&&n.dependencies.push({module_name:"@minecraft/server-admin",version:"1.0.0-beta"},{module_name:"@minecraft/server-net",version:"1.0.0-beta"})):(n.dependencies.push({module_name:"mojang-minecraft",version:"1.0.0-beta"},{module_name:"mojang-gametest",version:"1.0.0-beta"},{module_name:"mojang-minecraft-ui",version:"1.0.0-beta"}),i.bdsProject&&n.dependencies.push({module_name:"mojang-minecraft-server-admin",version:"1.0.0-beta"},{module_name:"mojang-net",version:"1.0.0-beta"})):(n.dependencies.push({uuid:"b26a4d4c-afdf-4690-88f8-931846312678",version:[0,1,0]},{uuid:"6f4b6893-1bb6-42fd-b458-7fa3d0c89616",version:[0,1,0]}),Q(i.targetVersion,"1.18.20",">=")&&n.dependencies.push({uuid:"2bd50a27-ab5f-4f40-a596-3641627c635e",version:[0,1,0]}),Q(i.targetVersion,"1.19.0",">=")&&i.bdsProject&&n.dependencies.push({uuid:"53d7f2bf-bf9c-49c4-ad1f-7c803d947920",version:[0,1,0]},{uuid:"777b1798-13a6-401c-9cba-0cf17e31a81b",version:[0,1,0]}))),this.type==="world_template"&&(n.header.lock_template_options=!0,n.header.base_game_version=i.targetVersion.split(".").map(y=>Number(y))),await t.writeJSON(`${this.pack}/manifest.json`,n,!0)}}class Fa extends ie{constructor(t){super();c(this,"id","lang");c(this,"isConfigurable",!1);this.packPath=t}async create(t,i){this.packPath==="BP"&&i.useLangForManifest||(await t.mkdir(`${this.packPath}/texts`),await t.writeFile(`${this.packPath}/texts/en_US.lang`,i.useLangForManifest?"":`pack.name=${i.name} ${this.packPath}
pack.description=${i.description}`),await t.writeJSON(`${this.packPath}/texts/languages.json`,["en_US"],!0))}}class Mn extends ie{constructor(t){super();c(this,"id","packIcon");c(this,"isConfigurable",!1);this.packPath=t}async create(t,i){let n=i.icon;if(!n){const a=await u.getApp();await a.dataLoader.fired,n=await a.dataLoader.readFile("data/packages/common/packIcon.png")}await t.writeFile(`${this.packPath}/pack_icon.png`,n)}}class tg extends ie{constructor(){super(...arguments);c(this,"id","tick")}async create(t,i){await t.writeJSON("BP/functions/tick.json",{values:[]},!0)}}class ig extends ie{constructor(){super(...arguments);c(this,"id","gameTestMain");c(this,"isConfigurable",!1)}async create(t,i){i.experimentalGameplay.enableGameTestFramework&&(await t.mkdir("BP/scripts",{recursive:!0}),await t.writeFile("BP/scripts/main.js",""))}}class ng extends ie{constructor(){super(...arguments);c(this,"id","player")}async create(t){const i=await u.getApp();await i.dataLoader.fired;const n=await i.dataLoader.readJSON("data/packages/minecraftBedrock/vanilla/player.json");await t.writeJSON("BP/entities/player.json",n,!0),await t.writeFile("BP/loot_tables/empty.json","{}")}}class Ta extends Ct{constructor(){super(...arguments);c(this,"packPath","BP");c(this,"createFiles",[new Ai(this.packPath),new Fa(this.packPath),new Mn(this.packPath),new tg,new ig,new ng])}}class sg extends ie{constructor(){super(...arguments);c(this,"id","blocks")}async create(t,i){await t.writeJSON("RP/blocks.json",{format_version:[1,1,0]},!0)}}class ag extends ie{constructor(){super(...arguments);c(this,"id","itemTexture")}async create(t,i){await t.mkdir("RP/textures",{recursive:!0}),await t.writeJSON("RP/textures/item_texture.json",{resource_pack_name:i.name,texture_name:"atlas.items",texture_data:{}},!0)}}class rg extends ie{constructor(){super(...arguments);c(this,"id","terrainTexture")}async create(t,i){await t.mkdir("RP/textures",{recursive:!0}),await t.writeJSON("RP/textures/terrain_texture.json",{num_mip_levels:4,padding:8,resource_pack_name:i.name,texture_name:"atlas.terrain",texture_data:{}},!0)}}class og extends ie{constructor(){super(...arguments);c(this,"id","flipbookTextures")}async create(t,i){await t.mkdir("RP/textures",{recursive:!0}),await t.writeJSON("RP/textures/flipbook_textures.json",[],!0)}}class cg extends ie{constructor(){super(...arguments);c(this,"id","biomesClient")}async create(t,i){await t.writeJSON("RP/biomes_client.json",{biomes:{}},!0)}}class lg extends ie{constructor(){super(...arguments);c(this,"id","sounds")}async create(t,i){await t.writeJSON("RP/sounds.json",{},!0)}}class dg extends ie{constructor(){super(...arguments);c(this,"id","soundDefinitions")}async create(t,i){await t.mkdir("RP/sounds",{recursive:!0}),await t.writeJSON("RP/sounds/sound_definitions.json",{format_version:"1.14.0",sound_definitions:{}},!0)}}class Aa extends Ct{constructor(){super(...arguments);c(this,"packPath","RP");c(this,"createFiles",[new Ai(this.packPath),new Fa(this.packPath),new Mn(this.packPath),new sg,new ag,new rg,new og,new cg,new lg,new dg])}}class ug extends ie{constructor(t){super();c(this,"id","lang");c(this,"isConfigurable",!1);this.packPath=t}async create(t,i){await t.mkdir(`${this.packPath}/texts`),await t.writeFile(`${this.packPath}/texts/en_US.lang`,i.useLangForManifest?"":`skinpack.${i.namespace}=${i.name}`),await t.writeJSON(`${this.packPath}/texts/languages.json`,["en_US"],!0)}}class pg extends ie{constructor(){super(...arguments);c(this,"id","skins")}create(t,i){return t.writeJSON("SP/skins.json",{geometry:"skinpacks/skins.json",skins:[],serialize_name:i.namespace,localization_name:i.namespace},!0)}}class $a extends Ct{constructor(){super(...arguments);c(this,"packPath","SP");c(this,"createFiles",[new Ai(this.packPath),new ug(this.packPath),new Mn(this.packPath),new pg])}}class hg extends ie{constructor(){super(...arguments);c(this,"id","compilerConfig");c(this,"isConfigurable",!1)}async create(t,i){await t.mkdir(".bridge/compiler")}}class mg extends Ct{constructor(){super(...arguments);c(this,"packPath",".bridge");c(this,"createFiles",[new hg])}}class fg extends ie{constructor(){super(...arguments);c(this,"id","gitignore")}async create(t,i){await t.writeFile(".gitignore",`Desktop.ini    
.DS_Store 
!.bridge/
.bridge/*
!.bridge/compiler/
!.bridge/extensions
builds`)}}class Ea extends Ct{constructor(){super(...arguments);c(this,"packPath","WT");c(this,"createFiles",[new Ai(this.packPath)])}}class $i extends ie{constructor(){super(...arguments);c(this,"id","bridgeConfig")}async create(t,i){await t.writeJSON("config.json",{type:"minecraftBedrock",name:i.name,namespace:i.namespace,authors:Array.isArray(i.author)?i.author:[i.author],targetVersion:i.targetVersion,description:i.description,experimentalGameplay:i.experimentalGameplay,bdsProject:i.bdsProject,packs:Object.fromEntries(i.packs.filter(n=>n!==".bridge").map(n=>[n,Ot[n]])),worlds:["./worlds/*"],compiler:{plugins:["generatorScripts","typeScript","entityIdentifierAlias","customEntityComponents","customItemComponents","customBlockComponents","customCommands","moLang","formatVersionCorrection",["simpleRewrite",{packName:i.name}]]}},!0)}}class gg extends Ct{constructor(){super(...arguments);c(this,"packPath","worlds");c(this,"createFiles",[])}}class wg extends ie{constructor(){super(...arguments);c(this,"id","denoConfig")}async create(t,i){await t.writeJSON("deno.json",{tasks:{install_dash:"deno install -A --reload -f -n dash_compiler https://raw.githubusercontent.com/bridge-core/deno-dash-compiler/main/mod.ts",watch:"dash_compiler build --mode development && dash_compiler watch",build:"dash_compiler build"}},!0)}}class xt extends ee{constructor(){super(eg,!1);c(this,"isFirstProject",!1);c(this,"availableTargetVersions",[]);c(this,"stableVersion","");c(this,"packs",{behaviorPack:new Ta,resourcePack:new Aa,skinPack:new $a,worldTemplate:new Ea,".bridge":new mg,worlds:new gg});c(this,"availablePackTypes",[]);c(this,"createFiles",[new fg,new $i,new wg]);c(this,"experimentalToggles",[]);c(this,"projectNameRules",[t=>t.match(/"|\\|\/|:|\||<|>|\*|\?|~/g)===null||"windows.createProject.projectName.invalidLetters",t=>!t.endsWith(".")||"windows.createProject.projectName.endsInPeriod",t=>t.trim()!==""||"windows.createProject.projectName.mustNotBeEmpty"]);c(this,"state",q({...super.getState(),isCreatingProject:!1,createOptions:this.getDefaultOptions(),availableTargetVersionsLoading:!0}));this.defineWindow(),u.ready.once(async t=>{await t.dataLoader.fired,this.availableTargetVersions=await un(),this.stableVersion=await Ns(t.dataLoader),this.createOptions.targetVersion=this.stableVersion,this.state.availableTargetVersionsLoading=!1,this.experimentalToggles=await t.dataLoader.readJSON("data/packages/minecraftBedrock/experimentalGameplay.json"),this.createOptions.experimentalGameplay=Object.fromEntries(this.experimentalToggles.map(i=>[i.id,!1]))}),u.packType.ready.once(()=>{this.availablePackTypes=u.packType.all})}get createOptions(){return this.state.createOptions}get packCreateFiles(){return Object.entries(this.packs).map(([t,i])=>this.createOptions.packs.includes(t)?i.createFiles.map(n=>Object.assign(n,{packId:t})):[]).flat().filter(t=>t.isConfigurable)}get hasRequiredData(){return this.createOptions.packs.length>1&&this.projectNameRules.every(t=>t(this.createOptions.name)===!0)&&this.createOptions.namespace.length>0&&this.createOptions.author.length>0&&this.createOptions.targetVersion.length>0}open(t=!1){this.state.createOptions=this.getDefaultOptions(),this.isFirstProject=t,this.packCreateFiles.forEach(i=>i.isActive=!0),super.open()}async createProject(){const t=await u.getApp(),i=A.value&&!t.hasNoProjects&&!this.isFirstProject;let n;this.isFirstProject||(n=t.isNoProjectSelected?t.projects[0]:t.project),i&&await new N({description:"windows.createProject.saveCurrentProject",cancelText:"general.no",confirmText:"general.yes"}).fired&&await tt(n==null?void 0:n.name);const r=await t.fileSystem.getDirectoryHandle(`projects/${this.createOptions.name}`,{create:!0}),o=new Z(r);for(const d of this.createFiles)await d.create(o,this.createOptions);const l=this.createOptions.packs.sort((d,p)=>p.localeCompare(d));for(const d of l)await this.packs[d].create(o,this.createOptions);await t.projectManager.addProject(r,!0,t.bridgeFolderSetup.hasFired),await t.extensionLoader.installFilesToCurrentProject(),i&&await t.projectManager.removeProject(n),this.state.createOptions=this.getDefaultOptions()}static getDefaultOptions(){var t,i;return{author:(i=(t=b==null?void 0:b.projects)==null?void 0:t.defaultAuthor)!=null?i:"",description:"",icon:null,name:"",namespace:"bridge",targetVersion:"",packs:[".bridge","behaviorPack","resourcePack"],rpAsBpDependency:!1,bpAsRpDependency:!1,useLangForManifest:!1,experimentalGameplay:{},uuids:{},bdsProject:!1}}getDefaultOptions(){return{...xt.getDefaultOptions(),targetVersion:this.availableTargetVersions?this.stableVersion:"",experimentalGameplay:this.experimentalToggles?Object.fromEntries(this.experimentalToggles.map(t=>[t.id,!1])):{}}}static async loadFromConfig(){var n,a,r,o,l,d,p;const t=await u.getApp();let i;try{return i=await t.project.fileSystem.readJSON("config.json"),{author:(n=i.author)!=null?n:"",description:(a=i.description)!=null?a:"",icon:null,name:(r=i.name)!=null?r:"",namespace:(o=i.namespace)!=null?o:"bridge",targetVersion:(l=i.targetVersion)!=null?l:"",packs:(d=Object.values(i.packs))!=null?d:[".bridge","behaviorPack","resourcePack"],useLangForManifest:!1,rpAsBpDependency:!1,bpAsRpDependency:!1,experimentalGameplay:(p=i.experimentalGameplay)!=null?p:{},uuids:{},bdsProject:!1}}catch{return this.getDefaultOptions()}}}function Da(s){for(const{type:e}of s)switch(e){case"data":return"behaviorPack";case"resources":return"resourcePack";case"skin_pack":return"skinPack";case"world_template":return"worldTemplate"}}async function In(s,e=!0){var p,h,m;const t=await u.getApp(),i=t.fileSystem,n=await i.getDirectoryHandle("import",{create:!0});if(await t.projectManager.projectReady.fired,e){const f=new di(n),g=await s.getFile(),w=new Uint8Array(await g.arrayBuffer());f.createTask(t.taskManager),await f.unzip(w)}const a=await ki(s.name.replace(".mcaddon","").replace(".zip",""),await i.getDirectoryHandle("projects"));A.value&&!t.hasNoProjects&&await new N({description:"windows.projectChooser.openNewProject.saveCurrentProject",cancelText:"general.no",confirmText:"general.yes"}).fired&&await tt();let r,o;const l=[".bridge"];for await(const f of n.values())if(f.kind==="file"&&f.name.endsWith(".mcpack")){const g=await n.getDirectoryHandle(fe(f.name,".mcpack"),{create:!0}),w=new di(g),y=await f.getFile(),S=new Uint8Array(await y.arrayBuffer());w.createTask(t.taskManager),await w.unzip(S),await n.removeEntry(f.name)}for await(const f of n.values())if(f.kind==="directory"&&await i.fileExists(`import/${f.name}/manifest.json`)){const g=await i.readJSON(`import/${f.name}/manifest.json`),w=(p=g==null?void 0:g.modules)!=null?p:[];r||(r=(h=g==null?void 0:g.metadata)==null?void 0:h.authors),o||(o=(m=g==null?void 0:g.header)==null?void 0:m.description);const y=Da(w);if(!y)return;l.push(y);const S=Ot[y];await i.move(`import/${f.name}`,`projects/${a}/${S}`)}l.length===1&&new J({description:"fileDropper.mcaddon.missingManifests"});const d=xt.getDefaultOptions();d.name=a,d.author=r!=null?r:["Unknown"],d.description=o!=null?o:"",d.packs=l,d.targetVersion=await it(),await new $i().create(new Z(await i.getDirectoryHandle(`projects/${a}`,{create:!0})),d),await i.mkdir(`projects/${a}/.bridge/extensions`),await i.mkdir(`projects/${a}/.bridge/compiler`),A.value&&!t.hasNoProjects&&await t.projectManager.removeProject(t.project),await t.projectManager.addProject(await i.getDirectoryHandle(`projects/${a}`),!0),await i.unlink("import")}async function On(){let s;try{[s]=await window.showOpenFilePicker({multiple:!1,types:[{description:"Choose a Project",accept:{"application/zip":[".brproject",".mcaddon"]}}]})}catch{return}const e=s.name;e.endsWith(".brproject")?await En(s):e.endsWith(".mcaddon")?await In(s):new J({description:"windows.projectChooser.wrongFileType"})}async function Rn(){const e=await new Wt("windows.projectChooser.title",{isPersistent:!1}).actionManager;e.create({icon:"mdi-plus",name:"windows.projectChooser.newProject.name",description:"windows.projectChooser.newProject.description",onTrigger:async()=>{(await u.getApp()).windows.createProject.open()}}),e.create({icon:"mdi-content-save-outline",name:"windows.projectChooser.saveCurrentProject.name",description:"windows.projectChooser.saveCurrentProject.description",onTrigger:()=>tt()}),e.create({icon:"mdi-folder-open-outline",name:"windows.projectChooser.openNewProject.name",description:"windows.projectChooser.openNewProject.description",onTrigger:()=>On()})}const ps=new Map;function yg(){let s={projectName:"",lastReadCount:0,currentCount:0},e,t=!1;const i=async o=>{await o.compilerReady.fired,o.compilerService.removeConsoleListeners()},n=async(o,l=!1)=>{l&&await i(o),await o.compilerReady.fired,o.compilerService.onConsoleUpdate(lt(async()=>{let d=await o.compilerService.getCompilerLogs();d=d.filter(([p,{type:h}])=>h==="error"||h==="warning"),s.currentCount=d.length,t&&e==="logs"&&(s.lastReadCount=s.currentCount),a()}))},a=()=>{r.attachBadge({count:s.currentCount-s.lastReadCount,color:"error"})},r=Ke({id:"compiler",displayName:"sidebar.compiler.name",icon:"mdi-cogs",disabled:()=>u.instance.isNoProjectSelected,defaultVisibility:!u.instance.mobile.isCurrentDevice(),onClick:async()=>{const l=(await u.getApp()).windows.compilerWindow,d=l.activeCategoryChanged.on(p=>{e=p,p==="logs"&&(s.lastReadCount=s.currentCount,a())});l.resetSignal(),l.once(async()=>{d.dispose(),t=!1,n(await u.getApp().then(p=>p.project))}),t=!0,await l.open(),e==="logs"&&(s.lastReadCount=s.currentCount,a())}});u.eventSystem.on("projectChanged",async o=>{var l;ps.set(s.projectName,s),s=(l=ps.get(o.name))!=null?l:{projectName:o.name,lastReadCount:0,currentCount:0},a(),await n(o,!0)})}async function Ma(){var n,a,r,o,l,d;const s=await u.getApp();if(s.windows.loadingWindow.open(),(a=(n=b==null?void 0:b.projects)==null?void 0:n.incrementVersionOnExport)!=null?a:A.value){const p=s.fileSystem;let h={};for(const f of s.project.getPacks()){const g=s.project.config.resolvePackPath(f,"manifest.json");if(await p.fileExists(g)){let w;try{w=(r=await p.readJSON(g))!=null?r:{}}catch{continue}const[y,S,v]=(l=(o=w.header)==null?void 0:o.version)!=null?l:[0,0,0],C=[y,S,v+1];h[g]={...w,header:{...(d=w.header)!=null?d:{},version:C}}}}const m=Object.values(h);for(const f of m)!Array.isArray(f.dependencies)||f.dependencies.forEach(g=>{const w=m.find(y=>y.header.uuid===g.uuid);!w||(g.version=w.header.version)});for(const[f,g]of Object.entries(h))await p.writeJSON(f,g,!0)}const e=await s.project.createDashService("production");await e.setup(),await e.build();const t=new ji(await s.project.fileSystem.getDirectoryHandle("builds/dist",{create:!0})),i=s.project.config.resolvePackPath(void 0,`builds/${s.project.name}.mcaddon`);try{await yi(i,await t.package(),s.fileSystem)}catch(p){console.error(p)}s.windows.loadingWindow.close()}async function vg(){Ke({id:"projects",group:"projectChooser",displayName:"windows.projectChooser.title",icon:"mdi-view-dashboard-outline",disabled:()=>u.instance.hasNoProjects&&u.instance.bridgeFolderSetup.hasFired,onClick:async()=>{u.instance.hasNoProjects&&!u.instance.bridgeFolderSetup.hasFired&&!await u.instance.setupBridgeFolder()||(A.value?Rn():await u.instance.windows.projectChooser.open())}});const s=Ke({id:"packExplorer",group:"packExplorer",displayName:"packExplorer.name",icon:"mdi-folder-outline"});u.getApp().then(e=>{s.setSidebarContent(e.packExplorer),s.setIsVisible(()=>!e.viewComMojangProject.hasComMojangProjectLoaded),u.sidebar.forcedInitialState.value||s.click()}),Ke({id:"fileSearch",displayName:"findAndReplace.name",icon:"mdi-file-search-outline",disabled:()=>u.instance.isNoProjectSelected,onClick:async()=>{var t;const e=await u.getApp();(t=e.project.tabSystem)==null||t.add(new Pn(e.project.tabSystem),!0)}}),yg(),Ke({id:"quickExport",displayName:"sidebar.quickExport.name",icon:"mdi-export",defaultVisibility:A.value,disabled:()=>u.instance.isNoProjectSelected,onClick:()=>{Ma()}}),Ke({id:"extensions",displayName:"sidebar.extensions.name",icon:"mdi-puzzle-outline",onClick:async()=>{await(await u.getApp()).windows.extensionStore.open()}}),_e.loadedSettings.once(e=>{var t,i,n;for(const a of Object.values(u.sidebar.elements))a.isVisibleSetting=(n=(i=(t=e==null?void 0:e.sidebar)==null?void 0:t.sidebarElements)==null?void 0:i[a.uuid])!=null?n:a.defaultVisibility})}class bg{constructor(e,t){c(this,"currentStepCount",0);c(this,"window");this.taskManager=e,this.taskDetails=t}update(e,t){e!==void 0&&(this.currentStepCount=e),t!==void 0&&(this.taskDetails.totalTaskSteps=t)}createWindow(){this.window=new J({name:this.name,description:this.description})}complete(){this.window&&this.window.dispose(),this.dispose()}dispose(){var e;(e=this.taskManager)==null||e.delete(this)}get name(){return this.taskDetails.name}get description(){return this.taskDetails.description}get totalStepCount(){var e;return(e=this.taskDetails.totalTaskSteps)!=null?e:100}get icon(){return this.taskDetails.icon}get progress(){return Math.round(this.currentStepCount/this.totalStepCount*100)}}const jt=F([]);class _g{create(e){const t=new bg(this,e);return jt.value.push(t),t}delete(e){jt.value=jt.value.filter(t=>t!==e)}get hasRunningTasks(){return jt.value.length>0}}const Li=new Set(["INPUT","TEXTAREA"]);function Sg(s){const e=new Ue("mdi-pencil-outline","toolbar.edit.name");e.addItem(s.actionManager.create({icon:"mdi-undo",name:"actions.undo.name",description:"actions.undo.description",keyBinding:"Ctrl + Z",prevent:t=>t.tagName==="INPUT"||t.tagName==="TEXTAREA",onTrigger:()=>{var i;const t=(i=s.tabSystem)==null?void 0:i.selectedTab;t instanceof Mt?t.treeEditor.undo():t instanceof ht?t.editorInstance.trigger("toolbar","undo",null):document.execCommand("undo")}})),e.addItem(s.actionManager.create({icon:"mdi-redo",name:"actions.redo.name",description:"actions.redo.description",keyBinding:Zs,prevent:t=>t.tagName==="INPUT"||t.tagName==="TEXTAREA",onTrigger:()=>{var i;const t=(i=s.tabSystem)==null?void 0:i.selectedTab;t instanceof Mt?t.treeEditor.redo():t instanceof ht?t.editorInstance.trigger("toolbar","redo",null):document.execCommand("redo")}})),e.addItem(new Ie),e.addItem(s.actionManager.create({icon:"mdi-content-copy",name:"actions.copy.name",description:"actions.copy.description",keyBinding:"Ctrl + C",prevent:t=>Li.has(t.tagName),onTrigger:()=>{var t,i;return(i=(t=s.tabSystem)==null?void 0:t.selectedTab)==null?void 0:i.copy()}})),e.addItem(s.actionManager.create({icon:"mdi-content-cut",name:"actions.cut.name",description:"actions.cut.description",keyBinding:"Ctrl + X",prevent:t=>Li.has(t.tagName),onTrigger:()=>{var t,i;return(i=(t=s.tabSystem)==null?void 0:t.selectedTab)==null?void 0:i.cut()}})),e.addItem(s.actionManager.create({icon:"mdi-content-paste",name:"actions.paste.name",description:"actions.paste.description",keyBinding:"Ctrl + V",prevent:t=>Li.has(t.tagName),onTrigger:()=>{var t,i;return(i=(t=s.tabSystem)==null?void 0:t.selectedTab)==null?void 0:i.paste()}})),u.toolbar.addCategory(e)}function Cg(s){const e=new Ue("mdi-file-outline","toolbar.file.name");e.addItem(s.actionManager.create({id:"bridge.action.newFile",icon:"mdi-file-plus-outline",name:"actions.newFile.name",description:"actions.newFile.description",keyBinding:"Ctrl + N",isDisabled:()=>s.isNoProjectSelected,onTrigger:()=>s.windows.createPreset.open()})),e.addItem(s.actionManager.create({id:"bridge.action.openFile",icon:"mdi-open-in-app",name:"actions.openFile.name",description:"actions.openFile.description",keyBinding:"Ctrl + O",onTrigger:async()=>{let t;try{t=await window.showOpenFilePicker({multiple:!0})}catch{return}for(const i of t)await s.fileDropper.importFile(i)||s.project.openFile(i,{isTemporary:!1})}})),A.value||e.addItem(s.actionManager.create({id:"bridge.action.openFolder",icon:"mdi-folder-open-outline",name:"actions.openFolder.name",description:"actions.openFolder.description",keyBinding:"Ctrl + Shift + O",onTrigger:async()=>{const t=await u.getApp();let i;try{i=await window.showDirectoryPicker({multiple:!1,mode:"readwrite"})}catch{return}await t.fileDropper.importFolder(i)}})),e.addItem(s.actionManager.create({id:"bridge.action.searchFile",icon:"mdi-magnify",name:"actions.searchFile.name",description:"actions.searchFile.description",keyBinding:"Ctrl + P",onTrigger:()=>rn.isWindowOpen=!0})),e.addItem(s.actionManager.create({icon:"mdi-file-cancel-outline",name:"actions.closeFile.name",description:"actions.closeFile.description",keyBinding:"Ctrl + W",onTrigger:()=>u.ready.once(t=>{var i;return(i=t.tabSystem)==null?void 0:i.close()})})),e.addItem(new Ie),e.addItem(s.actionManager.create({icon:"mdi-content-save-outline",name:"actions.saveFile.name",description:"actions.saveFile.description",keyBinding:"Ctrl + S",onTrigger:()=>u.ready.once(t=>{var i;return(i=t.tabSystem)==null?void 0:i.save()})})),A.value||js?e.addItem(s.actionManager.create({icon:"mdi-file-download-outline",name:"actions.downloadFile.name",description:"actions.downloadFile.description",keyBinding:"Ctrl + Shift + S",onTrigger:async()=>{var o;const t=await u.getApp(),i=(o=t.project.tabSystem)==null?void 0:o.selectedTab;if(!(i instanceof W))return;const[n,a]=await t.project.compilerService.compileFile(i.getPath(),await i.getFile().then(async l=>new Uint8Array(await l.arrayBuffer())));let r;typeof a=="string"?r=new TextEncoder().encode(a):a instanceof Blob?r=new Uint8Array(await a.arrayBuffer()):r=new Uint8Array(a),pt(i.name,r)}})):e.addItem(s.actionManager.create({icon:"mdi-content-save-edit-outline",name:"actions.saveAs.name",description:"actions.saveAs.description",keyBinding:"Ctrl + Shift + S",onTrigger:()=>u.ready.once(t=>{var i;return(i=t.tabSystem)==null?void 0:i.saveAs()})})),e.addItem(s.actionManager.create({icon:"mdi-content-save-settings-outline",name:"actions.saveAll.name",description:"actions.saveAll.description",keyBinding:H()==="win32"?"Ctrl + Alt + S":"Ctrl + Meta + S",onTrigger:()=>u.ready.once(t=>{var i;return(i=t.tabSystem)==null?void 0:i.saveAll()})})),u.toolbar.addCategory(e)}function xg(s){const e=new Ue("mdi-help","toolbar.help.name");e.addItem(s.actionManager.create({name:"actions.releases.name",icon:"mdi-alert-decagram",description:"actions.releases.description",onTrigger:()=>window.open("https://github.com/bridge-core/editor/releases","_blank")})),e.addItem(s.actionManager.create({name:"actions.bugReports.name",icon:"mdi-bug-outline",description:"actions.bugReports.description",onTrigger:()=>window.open("https://github.com/bridge-core/editor/issues/new/choose","_blank")})),e.addItem(s.actionManager.create({name:"actions.twitter.name",icon:"mdi-twitter",description:"actions.twitter.description",onTrigger:()=>window.open("https://twitter.com/bridgeIDE","_blank")})),e.addItem(new Ie),e.addItem(s.actionManager.create({name:"actions.extensionAPI.name",icon:"mdi-puzzle-outline",description:"actions.extensionAPI.description",onTrigger:()=>u.openUrl("https://bridge-core.github.io/extension-docs/","_blank")})),e.addItem(s.actionManager.create({name:"actions.gettingStarted.name",icon:"mdi-help-circle-outline",description:"actions.gettingStarted.description",onTrigger:()=>u.openUrl("https://bridge-core.github.io/editor-docs/getting-started/","_blank")})),e.addItem(s.actionManager.create({name:"actions.faq.name",icon:"mdi-frequently-asked-questions",description:"actions.faq.description",onTrigger:()=>u.openUrl("https://bridge-core.github.io/editor-docs/faq/","_blank")})),u.toolbar.addCategory(e)}function kg(s){const e=new Ue("mdi-wrench-outline","toolbar.tools.name");e.addItem(s.actionManager.create({icon:"mdi-book-open-page-variant",name:"actions.docs.name",description:"actions.docs.description",onTrigger:async()=>{const i=(await u.getApp()).tabSystem;if(!i)return;const n=new qe(i,{icon:"mdi-book-open-page-variant",name:"bedrock.dev",url:"https://bedrock.dev",iconColor:"primary"});i.add(n)}})),e.addItem(s.actionManager.create({icon:"mdi-minecraft",name:"actions.minecraftDocs.name",description:"actions.minecraftDocs.description",onTrigger:()=>{u.openUrl("https://docs.microsoft.com/en-us/minecraft/creator/")}})),e.addItem(s.actionManager.create({icon:"mdi-cube-outline",name:"[Open Blockbench]",onTrigger:async()=>{const i=(await u.getApp()).tabSystem;if(!i)return;const n=new qe(i,{icon:"mdi-cube-outline",name:"Blockbench",url:"https://web.blockbench.net",iconColor:"primary"});i.add(n)}})),e.addItem(s.actionManager.create({icon:"mdi-snowflake",name:"[Open Snowstorm]",onTrigger:async()=>{const i=(await u.getApp()).tabSystem;if(!i)return;const n=new qe(i,{icon:"mdi-snowflake",name:"Snowstorm",url:"https://snowstorm.app/",iconColor:"primary"});i.add(n)}})),e.addItem(new Ie),e.addItem(s.actionManager.create({id:"bridge.action.refreshProject",icon:"mdi-folder-refresh-outline",name:"packExplorer.refresh.name",description:"packExplorer.refresh.description",keyBinding:H()==="win32"?"Ctrl + Alt + R":"Ctrl + Meta + R",onTrigger:async()=>{await s.projectManager.projectReady.fired,await s.project.refresh()}})),e.addItem(s.actionManager.create({icon:"mdi-reload",name:"actions.reloadAutoCompletions.name",description:"actions.reloadAutoCompletions.description",keyBinding:"Ctrl + Shift + R",onTrigger:async()=>{await s.projectManager.projectReady.fired,s.project.jsonDefaults.reload()}})),e.addItem(s.actionManager.create({icon:"mdi-puzzle-outline",name:"actions.reloadExtensions.name",description:"actions.reloadExtensions.description",onTrigger:async()=>{s.extensionLoader.disposeAll(),s.extensionLoader.loadExtensions(),await s.projectManager.projectReady.fired,s.project.extensionLoader.disposeAll(),s.project.extensionLoader.loadExtensions()}})),e.addItem(new Ie),e.addItem(s.actionManager.create({icon:"mdi-cancel",name:"actions.clearAllNotifications.name",description:"actions.clearAllNotifications.description",onTrigger:()=>Lo()})),u.toolbar.addCategory(e)}function Pg(s){const e=new Ue("mdi-view-dashboard-outline","toolbar.project.name");e.addItem(s.actionManager.create({icon:"mdi-home-outline",name:"actions.goHome.name",description:"actions.goHome.description",isDisabled:()=>s.isNoProjectSelected&&!s.viewComMojangProject.hasComMojangProjectLoaded,onTrigger:async()=>{(await u.getApp()).projectManager.selectProject(We),u.sidebar.elements.packExplorer.isSelected||u.sidebar.elements.packExplorer.click()}})),e.addItem(s.actionManager.create({icon:"mdi-folder-open-outline",name:"windows.projectChooser.title",description:"windows.projectChooser.description",isDisabled:()=>s.hasNoProjects,onTrigger:()=>{A.value?Rn():u.instance.windows.projectChooser.open()}})),e.addItem(new Ie),e.addItem(s.actionManager.create({id:"bridge.action.newProject",icon:"mdi-folder-plus-outline",name:"actions.newProject.name",description:"actions.newProject.description",onTrigger:()=>s.windows.createProject.open()})),e.addItem(s.actionManager.create({icon:"mdi-import",name:"actions.importBrproject.name",description:"actions.importBrproject.description",onTrigger:()=>On()})),e.addItem(new Ie),e.addItem(s.actionManager.create({icon:"mdi-puzzle-outline",name:"actions.extensions.name",description:"actions.extensions.description",onTrigger:()=>s.windows.extensionStore.open()})),e.addItem(s.actionManager.create({id:"bridge.action.openSettings",icon:"mdi-cog-outline",name:"actions.settings.name",description:"actions.settings.description",keyBinding:"Ctrl + ,",onTrigger:()=>s.windows.settings.open()})),u.toolbar.addCategory(e)}const Ki=(s,e=!1,t=!0)=>({icon:"mdi-file-cog-outline",name:`actions.viewCompilerOutput.${t?"view":"name"}`,keyBinding:e?"Ctrl + Shift + D":void 0,onTrigger:async()=>{var d;const i=await u.getApp(),n=i.project;let a=s;if(a===void 0){const p=(d=i.project.tabSystem)==null?void 0:d.selectedTab;if(!(p instanceof W))return;a=p.getPath()}if(!a)return;const r=await n.compilerService.getCompilerOutputPath(a),o=i.comMojang.hasComMojang?i.comMojang.fileSystem:i.fileSystem;if(!r||!await o.fileExists(r)){new J({description:"actions.viewCompilerOutput.fileMissing"});return}const l=await o.getFileHandle(r);await(n==null?void 0:n.openFile(l,{selectTab:!0,readOnlyMode:"forced"}))}});function jg(s){const e=new Ue("mdi-eye-outline","toolbar.view.name");e.addItem(s.actionManager.create({icon:"mdi-folder-outline",name:"toolbar.view.togglePackExplorer.name",description:"toolbar.view.togglePackExplorer.description",keyBinding:"Ctrl + Shift + E",onTrigger:()=>{u.sidebar.elements.packExplorer.click()}})),e.addItem(s.actionManager.create({icon:"mdi-file-search-outline",name:"toolbar.view.openFileSearch.name",description:"toolbar.view.openFileSearch.description",keyBinding:"Ctrl + Shift + F",onTrigger:()=>{u.sidebar.elements.fileSearch.click()}})),e.addItem(new Ie),e.addItem(s.actionManager.create(Rs())),e.addItem(s.actionManager.create({icon:"mdi-chevron-right",name:"toolbar.view.nextTab.name",description:"toolbar.view.nextTab.description",keyBinding:H()==="darwin"?"Meta + Tab":"Ctrl + Tab",onTrigger:()=>{var t;(t=s.tabSystem)==null||t.selectNextTab()}})),e.addItem(s.actionManager.create({icon:"mdi-chevron-left",name:"toolbar.view.previousTab.name",description:"toolbar.view.previousTab.description",keyBinding:H()==="darwin"?"Meta + Shift + Tab":"Ctrl + Shift + Tab",onTrigger:()=>{var t;(t=s.tabSystem)==null||t.selectPreviousTab()}})),e.addItem(s.actionManager.create({icon:"mdi-arrow-u-left-bottom",name:"toolbar.view.cursorUndo.name",description:"toolbar.view.cursorUndo.description",keyBinding:"ctrl + mouseBack",onTrigger:async()=>{var i;const t=s.project.tabSystem;!t||(await t.fired,(i=t==null?void 0:t.monacoEditor)==null||i.trigger("keybinding","cursorUndo",null))}})),e.addItem(s.actionManager.create({icon:"mdi-arrow-u-right-top",name:"toolbar.view.cursorRedo.name",description:"toolbar.view.cursorRedo.description",keyBinding:"mouseForward",onTrigger:async()=>{var i;const t=s.project.tabSystem;!t||(await t.fired,(i=t==null?void 0:t.monacoEditor)==null||i.trigger("keybinding","cursorRedo",null))}})),e.addItem(new Ie),e.addItem(s.actionManager.create(Ki(void 0,!0))),e.addItem(s.actionManager.create({icon:"mdi-puzzle-outline",name:"actions.viewExtensionsFolder.name",description:"actions.viewExtensionsFolder.description",onTrigger:async()=>{const t=await s.fileSystem.getDirectoryHandle("~local/extensions");s.viewFolders.addDirectoryHandle({directoryHandle:t})}})),e.addItem(s.actionManager.create({icon:"mdi-pencil-outline",name:"actions.toggleReadOnly.name",description:"actions.toggleReadOnly.description",onTrigger:()=>{var i;const t=(i=s.tabSystem)==null?void 0:i.selectedTab;!(t instanceof W)||t.readOnlyMode==="forced"||t.setReadOnly(t.readOnlyMode==="manual"?"off":"manual")}})),u.toolbar.addCategory(e)}async function Fg(s){Pg(s),Cg(s),Sg(s),jg(s),kg(s),xg(s)}class Tg extends Nr{constructor(t){super(t);c(this,"ready",new $)}async setup(t){this.packTypes.length>0||(await t.fired,this.packTypes=await t.readJSON("data/packages/minecraftBedrock/packDefinitions.json").catch(()=>[]),this.ready.dispatch())}}const Ag=X({__name:"BrowserUnsupported",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState();function n(){e.window.close()}async function a(){await ye("confirmedUnsupportedBrowser",!0),n()}return{__sfc:!0,t,props:e,state:i,onClose:n,onContinue:a,BaseWindow:ce}}});var $g=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"windows.browserUnsupported.title",isVisible:i.state.isVisible,isPersistent:!0,hasCloseButton:!1,width:420,height:240},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"text-center"},[t("v-icon",{staticStyle:{"font-size":"8em"},attrs:{color:"warning"}},[e._v(" mdi-alert-octagon-outline ")]),t("p",[e._v(e._s(i.t("windows.browserUnsupported.description")))])],1)]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"error"},on:{click:i.onContinue}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-check")]),e._v(" "+e._s(i.t("windows.browserUnsupported.continue"))+" ")],1),t("v-spacer")]},proxy:!0}],null,!1,305660225)}):e._e()},Eg=[],Dg=_(Ag,$g,Eg,!1,null,null,null,null);const Mg=Dg.exports;class Ig extends ee{constructor(){super(Mg),this.defineWindow()}}const Og={name:"ExtensionCard",mixins:[G],props:{extension:Object},computed:{tags(){return[{icon:"mdi-account-outline",color:"primary",text:this.extension.author,type:"search"},{icon:"mdi-code-braces",text:this.extension.onlineVersion,type:"search"}].concat(this.extension.tags)},isMobile(){return this.$vuetify.breakpoint.mobile},compilerPlugins(){return this.extension.compilerPlugins.map(s=>`"${s}"`).join(", ")}},methods:{openUrl(s){u.openUrl(s)}}};var Rg=function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-normal pa-4 mb-2 rounded-lg card"},[t("div",{staticClass:"d-flex align-center mb-2"},[e.extension.icon?t("v-icon",{staticClass:"mr-1",attrs:{color:"accent"}},[e._v(" "+e._s(e.extension.icon)+" ")]):e._e(),t("h3",[e._v(e._s(e.extension.name))]),t("v-spacer"),e.extension.readme?t("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(i){return e.openUrl(e.extension.readme)}}},[t("v-icon",[e._v("mdi-information-outline")])],1):e._e(),e.extension.canShare?t("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(i){return e.extension.share()}}},[t("v-icon",[e._v("mdi-share")])],1):e._e(),e.extension.isInstalled?e.extension.isUpdateAvailable?t("v-btn",{staticClass:"rounded-lg elevation-0",attrs:{loading:e.extension.isLoading,color:"primary",small:""},on:{click:function(i){return e.extension.update()}}},[t("v-icon",{class:{"mr-1":!e.isMobile},attrs:{small:!e.isMobile}},[e._v(" mdi-sync ")]),e.isMobile?e._e():t("span",[e._v("Update")])],1):t("v-tooltip",{attrs:{color:e.extension.isActive?"success":"error",right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[e.extension.isActive?t("v-icon",e._g({attrs:{color:"success"}},i),[e._v(" mdi-check ")]):t("v-icon",e._g({attrs:{color:"error"}},i),[e._v("mdi-close")])]}}])},[t("span",[e._v(" "+e._s(e.extension.isActive?"Extension Active":"Extension Inactive")+" ")])]):t("v-btn",{staticClass:"rounded-lg elevation-0",attrs:{loading:e.extension.isLoading,disabled:!e.extension.isCompatibleVersion(),color:"primary",small:""},on:{click:function(i){return e.extension.download()}}},[t("v-icon",{class:{"mr-1":!e.isMobile},attrs:{small:!e.isMobile}},[e._v(" mdi-download ")]),e.isMobile?e._e():t("span",[e._v("Download")])],1),e.extension.isInstalled?t("v-menu",{attrs:{"offset-y":"","offset-x":"",rounded:"lg"},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:n}){return[t("v-btn",e._g(e._b({attrs:{small:"",icon:""}},"v-btn",n,!1),i),[t("v-icon",[e._v("mdi-dots-vertical")])],1)]}}],null,!1,3448670655),model:{value:e.extension.showMenu,callback:function(i){e.$set(e.extension,"showMenu",i)},expression:"extension.showMenu"}},[t("v-list",{attrs:{color:"menu",dense:""}},e._l(e.extension.actions,function(i,n){return t("v-list-item",{key:n,on:{click:function(a){return a.stopPropagation(),i.trigger()}}},[t("v-list-item-icon",[t("v-icon",{attrs:{color:"primary"}},[e._v(" "+e._s(i.icon))])],1),t("v-list-item-title",[e._v(" "+e._s(e.t(i.name))+" ")])],1)}),1)],1):e._e()],1),t("v-row",{staticClass:"mb-4",attrs:{dense:""}},e._l(e.tags,function(i){return t("v-col",{key:i.text,staticClass:"flex-grow-0"},[t("v-chip",{attrs:{color:i.color,"text-color":i.color?"white":void 0,small:""},on:{click:function(n){i.type==="search"?e.$emit("search",i.text):e.$emit("select",i.text.toLowerCase())}}},[t("v-icon",{staticClass:"mr-1"},[e._v(e._s(i.icon))]),e._v(" "+e._s(i.text)+" ")],1)],1)}),1),t("span",[e._v(e._s(e.extension.description))]),e.extension.compilerPlugins.length>0||!e.extension.isCompatibleVersion()?t("v-divider",{staticClass:"my-2"}):e._e(),e.extension.compilerPlugins.length>0?t("div",{staticClass:"d-flex align-center"},[t("v-icon",{staticClass:"pr-1",attrs:{color:"secondary"}},[e._v("mdi-cogs")]),t("span",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e.t("windows.extensionStore.compilerPluginDownload.compilerPlugins"))+":\xA0 ")]),t("span",[e._v(" "+e._s(e.compilerPlugins)+" ")])],1):e._e(),e.extension.isCompatibleVersion()?e._e():t("div",{staticClass:"d-flex align-center pt-1"},[t("v-icon",{staticClass:"pr-1",attrs:{color:"error"}},[e._v("mdi-alert-circle")]),t("span",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e.t("windows.extensionStore.incompatibleVersion")))])],1)],1)},Wg=[],Lg=_(Og,Rg,Wg,!1,null,"d19a1e79",null,null);const Ng=Lg.exports,Bg=X({__name:"ExtensionStore",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState(),n=e.window.sidebar,a=B(()=>n.currentElement?r.value.length===1?`[${r.value[0].name} - ${t("windows.extensionStore.title")}]`:`[${n.filter||n.currentElement.text} - ${t("windows.extensionStore.title")}]`:"windows.extensionStore.title"),r=B(()=>{if(n.filter!==""){const l=n.filter.toLowerCase();return e.window.extensions.filter(d=>d.name.toLowerCase().includes(l)||d.description.toLowerCase().includes(l)||d.author.toLowerCase().includes(l)||d.version.includes(l)||d.id===n.filter||d.tags.some(p=>p.text.toLowerCase().includes(l)))}return n.currentState});function o(){e.window.close()}return{__sfc:!0,t,props:e,state:i,sidebar:n,title:a,currentExtensions:r,onClose:o,SidebarWindow:_t,ExtensionCard:Ng,pointerDevice:te}}});var Vg=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.SidebarWindow,{attrs:{windowTitle:i.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:i.sidebar.elements},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"sidebar",fn:function(){return[t("v-text-field",{staticClass:"pt-2",attrs:{"prepend-inner-icon":"mdi-magnify",label:i.t("windows.extensionStore.searchExtensions"),autocomplete:"off",autofocus:i.pointerDevice==="mouse",outlined:"",dense:""},model:{value:i.sidebar.filter,callback:function(n){e.$set(i.sidebar,"filter",typeof n=="string"?n.trim():n)},expression:"sidebar.filter"}})]},proxy:!0},{key:"default",fn:function(){return[i.currentExtensions.length===0?t("div",[e._v(" No plugins match your search... ")]):e._l(i.currentExtensions,function(n){return t(i.ExtensionCard,{key:`${n.id}.${n.isInstalled}.${n.isUpdateAvailable}`,attrs:{extension:n},on:{search:a=>i.sidebar.filter=a,select:a=>e.window.selectedSidebar=a}})})]},proxy:!0}]),model:{value:e.window.selectedSidebar,callback:function(n){e.$set(e.window,"selectedSidebar",typeof n=="string"?n.trim():n)},expression:"window.selectedSidebar"}})},Hg=[],Ug=_(Bg,Vg,Hg,!1,null,null,null,null);const zg=Ug.exports;let Ce;class Jg extends ee{constructor(){super(zg);c(this,"baseUrl","https://raw.githubusercontent.com/bridge-core/plugins/master");c(this,"sidebar",new Lt([]));c(this,"extensionTags");c(this,"installedExtensions",[]);c(this,"tags",{});c(this,"updates",new Set);c(this,"extensions",[]);u.eventSystem.on("projectChanged",()=>{Ce==null||Ce.dispose(),Ce=void 0}),this.defineWindow()}async open(t){const i=await u.getApp();i.windows.loadingWindow.open(),this.sidebar.removeElements(),this.installedExtensions=[],await i.dataLoader.fired,this.extensionTags=await i.dataLoader.readJSON("data/packages/common/extensionTags.json");const n=await i.extensionLoader.getInstalledExtensions();let a;try{a=navigator.onLine?await fetch(`${this.baseUrl}/extensions.json`).then(r=>r.json()):[...n.values()].map(r=>r.manifest)}catch{return this.createOfflineWindow()}if(a.length===0&&!navigator.onLine)return this.createOfflineWindow();this.extensions=a.map(r=>new ea(this,r)),this.updates.clear(),n.forEach(r=>{const o=this.extensions.find(l=>l.id===r.id);o?(o.setInstalled(),o.setConnected(r),Q(r.version,o.onlineVersion,"<")&&(o.setIsUpdateAvailable(),this.updates.add(o))):this.extensions.push(r.forStore(this))}),Ce==null||Ce.dispose(),this.setupSidebar(),t&&this.sidebar.setFilter(t),i.windows.loadingWindow.close(),super.open()}async createOfflineWindow(){(await u.getApp()).windows.loadingWindow.close(),new J({description:"windows.extensionStore.offlineError"})}close(){super.close(),this.updates.size>0&&(Ce=new gi({icon:"mdi-sync",color:"primary",message:"sidebar.notifications.updateExtensions",onClick:()=>{this.updates.forEach(t=>t.update(!1)),Ce==null||Ce.dispose()}}))}updateInstalled(t){this.updates.delete(t)}delete(t){const i=this.installedExtensions.findIndex(n=>n.id===t.id);i!==-1&&(this.installedExtensions.splice(i,1),t.isLocalOnly&&(this.extensions=this.extensions.filter(n=>n.id!==t.id)))}setupSidebar(){this.sidebar.addElement(new $e({id:"all",text:"All",icon:"mdi-format-list-bulleted-square",color:"primary"}),this.getExtensions()),this.sidebar.addElement(new $e({id:"installed",text:"Installed",icon:"mdi-download-circle-outline",color:"primary"}),this.installedExtensions),Object.values(this.tags).forEach(t=>this.sidebar.addElement(t.asSidebarElement(),this.getExtensionsByTag(t))),this.sidebar.setDefaultSelected()}getExtensions(t){return[...new Set([...this.extensions,...this.installedExtensions])].filter(i=>!i.isLocalOnly&&(!t||i.hasTag(t)))}getExtensionsByTag(t){return this.getExtensions(t)}getTagIcon(t){var i;return(i=this.extensionTags[t])==null?void 0:i.icon}getTagColor(t){var i;return(i=this.extensionTags[t])==null?void 0:i.color}getExtensionById(t){return this.getExtensions().find(i=>i.id===t)}get selectedSidebar(){return this.sidebar.selected}set selectedSidebar(t){this.sidebar.clearFilter(),this.sidebar.selected=t}getBaseUrl(){return this.baseUrl}addInstalledExtension(t){this.installedExtensions.push(t)}}const qg=X({__name:"LoadingWindow",props:["window"],setup(s){const e=s,t=e.window.getState();function i(){e.window.close()}return{__sfc:!0,props:e,state:t,onClose:i,BaseWindow:ce}}});var Gg=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.BaseWindow,{attrs:{windowTitle:e.window.message||"windows.loadingWindow.titles.loading",isVisible:i.state.isVisible,hasMaximizeButton:!1,hasCloseButton:!1,isPersistent:!0,isFullscreen:!1,width:300,height:40,isSmallPopup:!0},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("v-progress-linear",{attrs:{indeterminate:""}})]},proxy:!0}])})},Kg=[],Yg=_(qg,Gg,Kg,!1,null,null,null,null);const Qg=Yg.exports;class Zg extends ee{constructor(){super(Qg);c(this,"virtualWindows",0);c(this,"loadingMessages",[]);this.defineWindow()}get message(){return this.loadingMessages[this.loadingMessages.length-1]}open(t){this.virtualWindows++,this.loadingMessages.push(t),this.state.isVisible||super.open()}close(){this.virtualWindows--,this.loadingMessages.pop(),this.virtualWindows===0?super.close():this.virtualWindows<0&&(this.virtualWindows=0)}closeAll(){this.virtualWindows=0,this.loadingMessages=[],super.close()}}const Xg={alphanumeric:s=>s.match(/^[a-zA-Z0-9_\/]*$/)!==null,noEmptyFolderNames:s=>s.match(/\/\//g)===null},ew={name:"PresetPath",props:{value:String},data:()=>({mode:"view",editedPath:"",validationText:"",rules:Object.fromEntries(Object.entries(Xg).map(([s,e])=>[s,t=>e(t)||R(`windows.createPreset.validationRule.${s}`)]))}),mounted(){this.mode="view",this.editedPath=this.value,this.sanitizeEditedPath()},computed:{path(){return this.editedPath.substring(0,this.editedPath.length-1)}},methods:{sanitizeEditedPath(){this.editedPath=this.editedPath.replaceAll("\\","/").replace(/\s+/g,"_"),!this.editedPath.endsWith("/")&&this.editedPath!==""&&(this.editedPath=this.editedPath+"/")},isPathValid(){return Object.values(this.rules).map(s=>s(this.editedPath)).find(s=>typeof s=="string")===void 0},tryToViewMode(){this.isPathValid()&&(this.mode="view")}},watch:{value(){this.editedPath=this.value,this.sanitizeEditedPath()},mode(){this.mode==="view"&&(this.sanitizeEditedPath(),this.$emit("input",this.editedPath))},editedPath(){this.validationText=Object.values(this.rules).map(s=>s(this.editedPath)).find(s=>typeof s=="string")}}};var tw=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mb-6 flex justify-center align-start path-container"},[t("v-icon",{staticClass:"mr-1",attrs:{"x-large":"",color:"primary"}},[e._v("mdi-folder-outline")]),e.mode==="view"?[t("v-btn",{staticClass:"mr-2",attrs:{text:"",small:""},on:{click:function(i){e.mode="edit"}}},[t("v-icon",{staticClass:"mr-1",attrs:{small:""}},[e._v(" "+e._s(e.path.length===0?"mdi-plus":"mdi-pencil-outline")+" ")]),e._v(" "+e._s(e.path.length===0?"Add subfolder":"Edit subfolders")+" ")],1),t("span",{on:{dblclick:function(i){e.mode="edit"}}},e._l(e.path.split("/"),function(i,n){return t("span",{key:n,staticClass:"mr-1"},[e._v(" "+e._s(i)+"/ ")])}),0)]:t("v-text-field",{staticStyle:{display:"inline-block",width:"calc(100% - 44px)","margin-top":"0","padding-top":"0"},attrs:{autofocus:"",rules:Object.values(e.rules),dense:""},on:{keydown:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.tryToViewMode()},blur:function(i){return e.tryToViewMode()}},model:{value:e.editedPath,callback:function(i){e.editedPath=i},expression:"editedPath"}})],2)},iw=[],nw=_(ew,tw,iw,!1,null,"50bd4cc2",null,null);const Ia=nw.exports,sw=X({__name:"PresetWindow",props:{window:null},setup(s){const e=s,{t}=O(),i=e.window.getState(),n=B(()=>e.window.sidebar.currentState),a=B(()=>Object.values(n.value.fields||{}).every(([d,p,h={}])=>h.validate&&h.validate.some(m=>e.window.validationRules[m](n.value.models[p])!==!0)?!1:!!n.value.models[p]||h.optional||h.type==="switch"));function r(){e.window.close()}function o(){a.value&&e.window.createPreset(n.value)}function l(d,p,h){var w,y;const{accept:m,multiple:f}=p,g=[...(y=(w=h.dataTransfer)==null?void 0:w.files)!=null?y:[]].filter(S=>ja(S,m));g.length!==0&&(f?n.value.models[d]?n.value.models[d].push(...g):n.value.models[d]=[...g]:n.value.models[d]=g[g.length-1])}return{__sfc:!0,props:e,t,state:i,content:n,fieldsReady:a,onClose:r,onCreatePreset:o,onDropFile:l,SidebarWindow:_t,PresetPath:Ia}}});var aw=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.SidebarWindow,{attrs:{windowTitle:"windows.createPreset.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:e.window.sidebar.elements},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"sidebar",fn:function(){return[t("v-text-field",{staticClass:"pt-2",attrs:{"prepend-inner-icon":"mdi-magnify",label:i.t("windows.createPreset.searchPresets"),autocomplete:"off",autofocus:"",outlined:"",dense:"","hide-details":""},model:{value:e.window.sidebar.filter,callback:function(n){e.$set(e.window.sidebar,"filter",typeof n=="string"?n.trim():n)},expression:"window.sidebar.filter"}}),t("v-switch",{attrs:{label:i.t("windows.createPreset.showAllPresets")},model:{value:e.window.sidebar.showDisabled,callback:function(n){e.$set(e.window.sidebar,"showDisabled",n)},expression:"window.sidebar.showDisabled"}})]},proxy:!0},{key:"default",fn:function(){return[t("h1",{staticClass:"mt-2 d-flex align-center",class:{"mb-6":!i.content.description}},[t("v-icon",{staticClass:"mr-1",attrs:{large:""}},[e._v(e._s(i.content.icon))]),e._v(" "+e._s(i.content.name)+" ")],1),i.content.description?t("p",{staticClass:"mt-2 mb-6"},[e._v(" "+e._s(i.content.description)+" ")]):e._e(),typeof i.content.models.PRESET_PATH=="string"?t(i.PresetPath,{model:{value:i.content.models.PRESET_PATH,callback:function(n){e.$set(i.content.models,"PRESET_PATH",n)},expression:"content.models.PRESET_PATH"}}):e._e(),e._l(i.content.fields,function([n,a,r={}],o){return[!r.type||r.type==="textInput"?t("v-text-field",{key:o,staticClass:"mb-1",attrs:{label:n,rules:r.validate?r.validate.map(l=>e.window.validationRules[l]):[],autocomplete:"off",outlined:"",dense:""},on:{keypress:function(l){return!l.type.indexOf("key")&&e._k(l.keyCode,"enter",13,l.key,"Enter")?null:i.onCreatePreset.apply(null,arguments)}},model:{value:i.content.models[a],callback:function(l){e.$set(i.content.models,a,l)},expression:"content.models[id]"}}):r.type==="fileInput"?t("span",{key:o,on:{drop:function(l){return l.preventDefault(),l.stopPropagation(),i.onDropFile(a,r,l)},dragover:function(l){l.preventDefault(),l.stopPropagation()}}},[t("v-file-input",{staticClass:"mb-1",attrs:{accept:r.accept,"prepend-icon":null,"prepend-inner-icon":r.icon||"mdi-paperclip",label:n,multiple:r.multiple||!1,autocomplete:"off",outlined:"",dense:""},model:{value:i.content.models[a],callback:function(l){e.$set(i.content.models,a,l)},expression:"content.models[id]"}})],1):r.type==="selectInput"?t(r.options.length>4?"v-autocomplete":"v-select",{key:o,tag:"component",staticClass:"mb-1",attrs:{loading:r.isLoading,disabled:r.isLoading,items:r.options,"menu-props":{maxHeight:220,rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},label:n,autocomplete:"off",outlined:"",dense:""},model:{value:i.content.models[a],callback:function(l){e.$set(i.content.models,a,l)},expression:"content.models[id]"}}):r.type==="switch"?t("v-switch",{key:o,staticClass:"mb-1",attrs:{label:n},model:{value:i.content.models[a],callback:function(l){e.$set(i.content.models,a,l)},expression:"content.models[id]"}}):r.type==="numberInput"?t("v-slider",{key:o,staticClass:"mb-1",attrs:{min:r.min||0,max:r.max||10,discrete:"",step:r.step||1,"thumb-label":"always",label:n},model:{value:i.content.models[a],callback:function(l){e.$set(i.content.models,a,l)},expression:"content.models[id]"}}):e._e()]})]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary",disabled:!i.fieldsReady},on:{click:i.onCreatePreset}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-plus")]),e._v(" Create ")],1)]},proxy:!0}],null,!1,3021932500),model:{value:e.window.sidebar.selected,callback:function(n){e.$set(e.window.sidebar,"selected",n)},expression:"window.sidebar.selected"}}):e._e()},rw=[],ow=_(sw,aw,rw,!1,null,null,null,null);const cw=ow.exports;function Me(s,e,t){return e.forEach(i=>s=s.replaceAll(`{{${i}}}`,t[i])),s}class Wn extends Z{constructor(e,t){super(e),this.dataLoader=t}getDirectoryHandle(e,t){return e.startsWith("data/packages/")?this.dataLoader.getDirectoryHandle(e,t):e.startsWith("file:///data/packages/")?this.dataLoader.getDirectoryHandle(e.slice(8),t):super.getDirectoryHandle(e,t)}}async function lw(s,e,t,i){const n=await u.getApp(),a=n.fileSystem,r=new Wn(n.fileSystem.baseDirectory,n.dataLoader);let o;e.startsWith("./")?o=e=e.replaceAll("./",s+"/"):o=`data/packages/minecraftBedrock/${e}`,await n.dataLoader.fired;const d=await(await r.readFile(o)).text(),p={exports:void 0};try{ln({script:d,env:{module:p}})}catch(S){throw new Error(`Failed to execute PresetScript "${e}": ${S}`)}if(typeof p.exports!="function")throw new Error(`Failed to execute PresetScript "${e}": module.exports is of type ${typeof p.exports}`);const h=[],m=[],f=(S,v,C={inject:[],openFile:!1,packPath:void 0})=>(typeof v!="string"&&(v=JSON.stringify(v,null,"	")),g(S,v,C)),g=async(S,v,{inject:C=[],openFile:P=!1,packPath:k=void 0}={inject:[],openFile:!1,packPath:void 0})=>{const T=n.projectConfig.resolvePackPath(k,S);if(i.mayOverwriteFiles===void 0&&await a.fileExists(T))if(await new N({description:"windows.createPreset.overwriteFiles",confirmText:"windows.createPreset.overwriteFilesConfirm"}).fired)i.mayOverwriteFiles=!0;else{i.mayOverwriteFiles=!1;return}else if(i.mayOverwriteFiles===!1)return;const j=await a.getFileHandle(T,!0);h.push(j),P&&m.push(j),await a.write(j,typeof v=="string"?Me(v,C,t):v)},w=async(S,v,{inject:C=[],openFile:P=!1,packPath:k=void 0}={inject:[],openFile:!1,packPath:void 0})=>{const T=n.projectConfig.resolvePackPath(k,S),j=await a.getFileHandle(T,!0);if(i.mayOverwriteUnsavedChanges===void 0){const le=await n.project.getFileTab(j);if(le!==void 0&&le.isUnsaved)if(await new N({description:"windows.createPreset.overwriteUnsavedChanges",confirmText:"windows.createPreset.overwriteUnsavedChangesConfirm"}).fired)i.mayOverwriteUnsavedChanges=!0,le.close();else{i.mayOverwriteUnsavedChanges=!1;return}}else if(i.mayOverwriteUnsavedChanges===!1)return;let M=null;try{M=await(await a.readFile(T)).text()}catch{}h.push(j),P&&m.push(j),typeof v=="string"?(v=Me(v,C,t),await a.writeFile(T,M?`${M}
${v}`:v)):(v=Me(L.stringify(v),C,t),await a.writeJSON(T,pi(M?L.parse(M):{},L.parse(v)),!0))},y=S=>r.readFile(`${s}/${S}`);return await p.exports({models:t,createFile:g,expandFile:w,loadPresetFile:y,createJSONFile:f}),{createdFiles:h,openFile:m}}async function dw(s,[e,t,i],n){var m;const a=await u.getApp(),r=new Wn(a.fileSystem.baseDirectory,a.dataLoader),o=(m=i==null?void 0:i.inject)!=null?m:[],l=`${s}/${e}`,d=Me(a.projectConfig.resolvePackPath(i==null?void 0:i.packPath,t),o,n),p=me(d);await r.mkdir(ve(d),{recursive:!0});let h;if(p===".json"){const f=await r.readFile(l),g=Me(await f.text(),o,n);let w;try{w=await r.readJSON(d)}catch{w={}}h=await r.writeFile(d,JSON.stringify(pi(w,JSON.parse(g)),null,"	"))}else{const g=await(await r.readFile(l)).text();let w;try{w=await(await r.readFile(d)).text()}catch{w=""}const y=Me(g,o,n);h=await r.writeFile(d,`${w}${w!==""?`
`:""}${y}`)}return h}const uw=[".mcfunction",".json",".js",".ts",".txt",".molang"];async function pw(s,[e,t,i],n){var m;const a=await u.getApp(),r=new Wn(a.fileSystem.baseDirectory,a.dataLoader),o=(m=i==null?void 0:i.inject)!=null?m:[],l=`${s}/${e}`,d=Me(a.projectConfig.resolvePackPath(i==null?void 0:i.packPath,t),o,n),p=me(d);await r.mkdir(ve(d),{recursive:!0});let h;if(o.length===0||!uw.includes(p))h=await r.copyFile(l,d);else{const g=await(await r.readFile(l)).text();h=await r.writeFile(d,Me(g,o,n))}return h}class hs extends $e{constructor(t){super(t);c(this,"resetState");this.resetState=t.resetState}}async function hw(s,e){await u.getApp();const t=R(`windows.createPreset.disabledPreset.${s.type}`);let i;switch(s.type){case"experimentalGameplay":e.experimentalGameplay&&(i=e.experimentalGameplay.map(n=>`${n.startsWith("!")?R("general.no"):""} ${R(`experimentalGameplay.${n.replace("!","")}.name`)}`).join(", "));break;case"packTypes":e.packTypes&&(i=e.packTypes.map(n=>`${n.startsWith("!")?R("general.no"):""} ${R(`packType.${n.replace("!","")}.name`)}`).join(", "));break;case"targetVersion":Array.isArray(e.targetVersion)?i=e.targetVersion.join(" "):e.targetVersion&&e.targetVersion.min&&e.targetVersion.max&&(i=`Min: ${e.targetVersion.min} | Max: ${e.targetVersion.max}`);break;case"manifestDependency":e.dependencies&&(i=e.dependencies.join(", "));break}return i?`${t}: ${i}`:void 0}class mw extends ee{constructor(){super(cw);c(this,"loadPresetPaths",new Set);c(this,"sidebar",new Lt([]));c(this,"shouldReloadPresets",!0);c(this,"modelResetters",[]);c(this,"_validationRules",{alphanumeric:t=>t.match(/^[a-zA-Z0-9_\.]*$/)!==null,lowercase:t=>t.toLowerCase()===t,required:t=>!!t,numeric:t=>!isNaN(Number(t))});c(this,"requiresMatcher",x(new oi));this.defineWindow(),["presetsChanged","projectChanged"].forEach(i=>u.eventSystem.on(i,()=>this.onPresetsChanged()))}get validationRules(){return Object.fromEntries(Object.entries(this._validationRules).map(([t,i])=>[t,n=>i(n)||R(`windows.createPreset.validationRule.${t}`)]))}onPresetsChanged(){this.shouldReloadPresets=!0}async addPreset(t,i){var h,m,f;const n=await u.getApp();if(!i.category)throw new Error(`Error loading ${t}: Missing preset category`);const a=this.requiresMatcher.isValid(i.requires);if(!a&&i.showIfDisabled===!1)return;let r=this.sidebar.rawElements.find(g=>g.getText()===i.category);r||(r=new bi({isOpen:!1,text:i.category,items:[]}),this.sidebar.addElement(r));const o=E(),l=()=>{var g,w,y;(g=i.fields)==null||g.forEach(([S,v,C={}])=>{var T;if(C.type!=="selectInput"||Array.isArray(C.options))return;const{fileType:P,cacheKey:k}=(T=C.options)!=null?T:{};!P||!k||(C.options=[],C.isLoading=!0,n.project.packIndexer.once(async()=>{const j=await n.project.packIndexer.service.getCacheDataFor(P,void 0,k);C.options=j!=null?j:[],C.isLoading=!1}))}),this.sidebar.setState(o,{...i,presetPath:ve(t),models:{PROJECT_PREFIX:(w=n.projectConfig.get().namespace)!=null?w:"bridge",...(y=i.additionalModels)!=null?y:{},...Object.fromEntries(i.fields.map(([S,v,C={}])=>{var P;return[v,(P=C.default)!=null?P:!C.type||C.type==="textInput"?"":null]}))}})},d=i.category==="fileType.simpleFile"&&((h=i.requires)==null?void 0:h.packTypes)&&i.requires.packTypes.length>0&&(f=(m=u.packType.getFromId(i.requires.packTypes[0]))==null?void 0:m.color)!=null?f:"primary";let p;this.requiresMatcher.failures.length>0&&(p=await hw(this.requiresMatcher.failures[0],i.requires)),r.addItem(new hs({id:o,text:i.name,icon:i.icon,color:d,isDisabled:!a,disabledText:p,resetState:l})),l(),this.modelResetters.push(l)}async loadPresets(t,i="data/packages/minecraftBedrock/preset"){if(await t.fired,i.endsWith("presets.json")&&await t.fileExists(i)){const r=await t.readJSON(i);await Promise.all(Object.entries(r).map(([o,l])=>this.addPreset(`${ve(i)}/${o}`,l)));return}let n=[];try{n=await t.readdir(i,{withFileTypes:!0})}catch{}const a=[];for(const r of n)if(r.kind==="directory")a.push(this.loadPresets(t,`${i}/${r.name}`));else if(r.name==="manifest.json"){let o;try{o=L.parse(await r.getFile().then(l=>l.text()))}catch(l){const d=new Error(`Failed to load JSON file "${i}/${r.name}".`);d.cause=l,console.error(d);continue}a.push(await this.addPreset(`${i}/${r.name}`,o))}await Promise.all(a)}async loadDefaultPresets(t){const i=await t.readJSON("data/packages/minecraftBedrock/presets.json");await Promise.all(Object.entries(i).map(([n,a])=>this.addPreset(n,a)))}async open(){const t=await u.getApp(),i=t.fileSystem;t.windows.loadingWindow.open(),this.shouldReloadPresets?(this.sidebar.removeElements(),this.requiresMatcher=x(new oi),await this.requiresMatcher.setup(),await Promise.all([this.loadDefaultPresets(t.dataLoader),...[...this.loadPresetPaths].map(n=>this.loadPresets(i,n))]),this.sidebar.setDefaultSelected(),this.shouldReloadPresets=!1):this.modelResetters.forEach(n=>n()),t.windows.loadingWindow.close(),super.open()}addPresets(t){return this.loadPresetPaths.add(t),{dispose:()=>this.loadPresetPaths.delete(t)}}async createPreset({presetPath:t,createFiles:i=[],expandFiles:n=[]}){var m,f,g,w,y,S;if(!t)return;const a=await u.getApp();a.windows.loadingWindow.open();const r=a.project.fileSystem,o=[],l={mayOverwriteFiles:void 0,mayOverwriteUnsavedChanges:void 0};for(const v of i){if(typeof v=="string")continue;const C=Me(v[1],(f=(m=v[2])==null?void 0:m.inject)!=null?f:[],this.sidebar.currentState.models);if(await r.fileExists(C))if(await new N({description:"windows.createPreset.overwriteFiles",confirmText:"windows.createPreset.overwriteFilesConfirm"}).fired){l.mayOverwriteFiles=!0;break}else{a.windows.loadingWindow.close();return}}const d=a.project;for(const v of n){if(typeof v=="string")continue;let C=Me(v[1],(w=(g=v[2])==null?void 0:g.inject)!=null?w:[],this.sidebar.currentState.models),P=null;try{P=await d.fileSystem.getFileHandle(C)}catch{continue}const k=await d.getFileTab(P);if(k!==void 0&&k.isUnsaved)if(await new N({description:"windows.createPreset.overwriteUnsavedChanges",confirmText:"windows.createPreset.overwriteUnsavedChangesConfirm"}).fired)l.mayOverwriteUnsavedChanges=!0,d.closeFile(P);else{a.windows.loadingWindow.close();return}}const p=[];for(const v of i)if(typeof v=="string"){const C=await lw(t,v,this.sidebar.currentState.models,l);o.push(...C.createdFiles),p.push(...C.openFile)}else{const C=await pw(t,v,this.sidebar.currentState.models);o.push(C),(y=v[2])!=null&&y.openFile&&p.push(C)}for(const v of n){const C=await dw(t,v,this.sidebar.currentState.models);o.push(C),(S=v[2])!=null&&S.openFile&&p.push(C)}u.eventSystem.dispatch("fileAdded",void 0),l.mayOverwriteFiles!==!1&&this.close();const h=[];for(const v of o){const C=await a.fileSystem.pathTo(v);!C||(h.push(C),p.includes(v)&&await a.project.openFile(v,{selectTab:v===p[p.length-1],isTemporary:!1}))}a.project.updateFiles(h),this.sidebar.currentElement instanceof hs&&this.sidebar.currentElement.resetState(),a.windows.loadingWindow.close()}}async function fw(){const s=await u.getApp(),e=new Wt("windows.projectChooser.addPack"),t=await e.actionManager,i=s.project.getPacks();u.packType.all.filter(a=>!i.includes(a.id)).forEach(a=>t.create({icon:a.icon,color:a.color,name:`packType.${a.id}.name`,description:`packType.${a.id}.description`,onTrigger:async()=>{var d;s.windows.loadingWindow.open();const r=s.project.fileSystem,o=await xt.loadFromConfig();switch(a.id){case"behaviorPack":{await new Ta().create(r,o);break}case"resourcePack":{await new Aa().create(r,o);break}case"skinPack":{await new $a().create(r,o);break}case"worldTemplate":{await new Ea().create(r,o);break}default:throw s.windows.loadingWindow.close(),new Error(`Unable to add pack with id "${a.id}"`)}const l=await r.readJSON("config.json");await r.writeJSON("config.json",{...l,packs:{...(d=l.packs)!=null?d:{},[a.id]:Ot[a.id]}},!0),s.project.addPack({...a,packPath:s.project.config.resolvePackPath(a.id),version:[1,0,0]}),s.project.updateChangedFiles(),u.eventSystem.dispatch("projectChanged",s.project),s.windows.loadingWindow.close()}})),e.open()}const gw=X({__name:"ProjectChooser",props:["window"],setup(s){const e=s;let t;"ListFormat"in Intl?t=new Intl.ListFormat("en",{style:"long",type:"conjunction"}):t={format:w=>w.join(", ")};const{t:i}=O(),n=e.window.getState(),a=e.window.sidebar,r=B(()=>a.currentState.isComMojangProject),o=B(()=>{const w=a.currentState.authors||"Unknown";return Array.isArray(w)?t.format(w.map(y=>typeof y=="string"?y:y.name)):w});function l(){e.window.close()}async function d(){const w=await u.getApp();r.value?(await w.projectManager.selectProject(We),w.viewComMojangProject.loadComMojangProject(a.currentState.project)):w.projectManager.selectProject(a.selected),e.window.close()}const p=F(!1);function h(w){p.value=!0,new N({description:"windows.deleteProject.description",confirmText:"windows.deleteProject.confirm",cancelText:"general.cancel",onConfirm:async()=>{const y=await u.getApp();await y.projectManager.removeProjectWithName(w),y.hasNoProjects?l():await e.window.loadProjects(),p.value=!1},onCancel:()=>{p.value=!1}})}function m(){fw(),e.window.close()}function f(){e.window.loadAllProjects()}async function g(w){const S=(await u.getApp()).projectManager.getProject(a.currentState.name);!S||await S.config.toggleExperiment(S,w.id)}return{__sfc:!0,formatter:t,t:i,props:e,state:n,sidebar:a,isComMojangProject:r,authors:o,onClose:l,onSelectProject:d,deletePending:p,onDeleteProject:h,onAddPack:m,onLoadAllProjects:f,onToggleExperiment:g,SidebarWindow:_t,PackTypeViewer:ka,ExperimentalGameplay:Pa,BridgeSheet:Oe}}});var ww=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.SidebarWindow,{attrs:{windowTitle:"windows.projectChooser.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:i.sidebar.elements,actions:i.state.actions,isLoading:i.state.isLoading},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"sidebar",fn:function(){return[t("v-text-field",{staticClass:"pt-2 mb-2",attrs:{"prepend-inner-icon":"mdi-magnify",label:i.t("windows.projectChooser.searchProjects"),"hide-details":"",autofocus:"",outlined:"",dense:""},model:{value:i.sidebar.filter,callback:function(n){e.$set(i.sidebar,"filter",typeof n=="string"?n.trim():n)},expression:"sidebar.filter"}}),i.state.showLoadAllButton?t("v-btn",{staticClass:"mb-2",attrs:{loading:i.state.showLoadAllButton==="isLoading",block:"",color:"primary"},on:{click:i.onLoadAllProjects}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-folder-open-outline")]),e._v(" "+e._s(i.t("windows.projectChooser.loadAllProjects"))+" ")],1):e._e()]},proxy:!0},{key:"default",fn:function(){return[t("div",{staticClass:"d-flex align-center mb-4 rounded-lg content-area pa-4"},[t("div",{staticClass:"d-flex align-center"},[t("img",{staticClass:"mr-2 project-logo rounded-lg",attrs:{height:"64",src:i.sidebar.currentState.imgSrc,draggable:"false"}}),t("div",[t("h1",{staticStyle:{"overflow-wrap":"anywhere"}},[e._v(" "+e._s(i.sidebar.currentState.displayName)+" ")]),t("h2",{staticClass:"subheader"},[e._v("by "+e._s(i.authors))])])]),t("v-spacer"),i.sidebar.currentState.isLocalProject?t("v-tooltip",{attrs:{color:"tooltip",bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:n}){return[t(i.BridgeSheet,e._g({staticClass:"d-flex flex-column pa-2",attrs:{dark:""}},n),[t("v-icon",{attrs:{color:"primary"}},[e._v(" mdi-lock-open-outline ")]),e._v(" "+e._s(i.t("windows.projectChooser.localProject.name"))+" ")],1)]}}],null,!1,872088565)},[t("span",[e._v(" "+e._s(i.t("windows.projectChooser.localProject.description"))+" ")])]):e._e(),i.isComMojangProject?t("v-tooltip",{attrs:{color:"tooltip",bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:n}){return[t(i.BridgeSheet,e._g({staticClass:"d-flex flex-column pa-2",attrs:{dark:""}},n),[t("v-icon",{attrs:{color:"primary"}},[e._v("mdi-minecraft")]),e._v(" "+e._s(i.t("windows.projectChooser.comMojangProject.name"))+" ")],1)]}}],null,!1,3649741387)},[t("span",[e._v(" "+e._s(i.t("windows.projectChooser.comMojangProject.description"))+" ")])]):e._e()],1),t("v-row",{staticClass:"mb-6",attrs:{dense:""}},e._l(i.sidebar.currentState.contains,function(n){return t("v-col",{key:n.id},[t(i.PackTypeViewer,{staticStyle:{height:"100%"},attrs:{packType:n}})],1)}),1),i.isComMojangProject?e._e():[t("h2",{staticClass:"subheader"},[e._v(" "+e._s(i.t("general.experimentalGameplay"))+" ")]),t("v-row",{attrs:{dense:""}},e._l(i.sidebar.currentState.experimentalGameplay,function(n){return t("v-col",{key:`${n.id}.${n.isActive}`,attrs:{xs:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[t(i.ExperimentalGameplay,{staticStyle:{height:"100%"},attrs:{experiment:n,isToggleable:!0,value:n.isActive},nativeOn:{click:function(a){return i.onToggleExperiment(n)}}})],1)}),1)],i.isComMojangProject?t(i.BridgeSheet,{staticClass:"d-flex align-center justify-center pa-2"},[t("v-icon",{staticClass:"mr-1",attrs:{color:"error"}},[e._v(" mdi-alert-circle-outline ")]),e._v(" "+e._s(i.t("windows.projectChooser.comMojangProject.uninstallWarning"))+" ")],1):e._e()]},proxy:!0},{key:"actions",fn:function({selectedSidebar:n}){return[i.isComMojangProject?e._e():t("v-btn",{attrs:{color:"primary",disabled:i.state.currentProject!==n||i.state.isLoading},on:{click:i.onAddPack}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-plus-box")]),e._v(" "+e._s(i.t("windows.projectChooser.addPack"))+" ")],1),t("v-spacer"),i.isComMojangProject?e._e():t("v-btn",{attrs:{color:"error",loading:i.deletePending,disabled:i.state.isLoading},on:{click:function(a){return i.onDeleteProject(n)}}},[t("v-icon",[e._v("mdi-delete")]),e._v(" "+e._s(i.t("general.delete"))+" ")],1),t("v-btn",{attrs:{color:"primary",disabled:i.state.currentProject===n||i.state.isLoading},on:{click:i.onSelectProject}},[t("v-icon",[e._v("mdi-check")]),e._v(" "+e._s(i.t("general.select"))+" ")],1)]}}]),model:{value:i.sidebar.selected,callback:function(n){e.$set(i.sidebar,"selected",n)},expression:"sidebar.selected"}})},yw=[],vw=_(gw,ww,yw,!1,null,"3055f2fc",null,null);const bw=vw.exports;class _w{constructor(e){c(this,"cachedProjects",null);this.app=e}get comMojang(){return this.app.comMojang}get fileSystem(){return this.app.comMojang.fileSystem}clearCache(){this.cachedProjects=null}async loadProjects(){var n,a,r;if(!((a=(n=b==null?void 0:b.projects)==null?void 0:n.loadComMojangProjects)==null||a))return this.clearCache(),[];if(this.cachedProjects!==null)return this.cachedProjects;if(!this.comMojang.setup.hasFired||!this.comMojang.status.hasComMojang)return[];const e=await this.loadPacks("development_behavior_packs");if(e.size===0)return[];const t=await this.loadPacks("development_resource_packs"),i=[];for(const o of e.values()){const l=(r=o.manifest)==null?void 0:r.dependencies;if(!l){i.push({name:o.directoryHandle.name,packs:[o]});continue}let d;for(const p of l)if(d=t.get(p.uuid),d)break;!d||i.push({name:o.directoryHandle.name,packs:[o,d]})}return this.cachedProjects=i,i}async loadPacks(e){var n;const t=new Map,i=await this.fileSystem.getDirectoryHandle(e).catch(()=>null);if(!i)return t;for await(const a of i.values()){if(a.kind==="file")continue;const r=await a.getFileHandle("manifest.json").then(d=>this.fileSystem.readJsonHandle(d)).catch(()=>null);if(!r)continue;const o=(n=r==null?void 0:r.header)==null?void 0:n.uuid;if(this.isV2Project(r))continue;const l=await a.getFileHandle("pack_icon.png").then(d=>vi(d)).catch(()=>null);t.set(o,{type:e==="development_behavior_packs"?"behaviorPack":"resourcePack",packPath:`${e}/${a.name}`,uuid:o,manifest:r,packIcon:l,directoryHandle:a})}return t}isV2Project(e){var a,r,o,l,d;const t=(a=e==null?void 0:e.header)==null?void 0:a.uuid,i=(d=(l=(o=(r=e==null?void 0:e.metadata)==null?void 0:r.generated_with)==null?void 0:o.bridge)==null?void 0:l.pop)==null?void 0:d.call(l);return i&&Q(i,"2.0.0",">=")?!0:this.app.projectManager.someProject(p=>!!p.bpUuid&&p.bpUuid===t)}}class Sw extends ee{constructor(t){super(bw,!1,!0);c(this,"sidebar",new Lt([]));c(this,"experimentalToggles",[]);c(this,"comMojangProjectLoader");c(this,"state",q({...super.getState(),showLoadAllButton:!1,currentProject:void 0}));this.state.actions.push(new D({icon:"mdi-refresh",name:"general.reload",color:"accent",isDisabled:()=>this.state.isLoading,onTrigger:()=>{this.reload()}}),new D({icon:"mdi-import",name:"actions.importBrproject.name",color:"accent",onTrigger:()=>{this.close(),On()}}),new D({icon:"mdi-plus",name:"windows.projectChooser.newProject.name",color:"accent",onTrigger:async()=>{const i=await u.getApp();this.close(),i.windows.createProject.open()}})),this.comMojangProjectLoader=x(new _w(t)),this.defineWindow()}async loadAllProjects(){this.state.showLoadAllButton="isLoading";const t=await u.getApp(),i=t.bridgeFolderSetup.hasFired||await t.setupBridgeFolder(),n=t.comMojang.hasComMojangHandle?t.comMojang.hasFired||await t.comMojang.setupComMojang():!0;i||n?(await this.loadProjects(),this.state.showLoadAllButton=!i||!n):this.state.showLoadAllButton=!0}addProject(t,i,n){this.sidebar.addElement(new $e({color:"primary",text:i!=null?i:"Unknown",icon:`mdi-alpha-${i[0].toLowerCase()}-box-outline`,id:t!=null?t:E()}),n),this.sidebar.setDefaultSelected()}async loadProjects(){this.sidebar.removeElements();const t=await u.getApp();this.state.showLoadAllButton=!t.bridgeFolderSetup.hasFired||!t.comMojang.setup.hasFired&&t.comMojang.hasComMojangHandle;const i=await t.projectManager.getProjects(),n=await t.dataLoader.readJSON("data/packages/minecraftBedrock/experimentalGameplay.json");return i.forEach(r=>this.addProject(r.projectData.path,r.displayName,{displayName:r.displayName,...r.projectData,isLocalProject:r.isLocal,experimentalGameplay:n.map(o=>{var l,d;return{isActive:(d=(l=r.config.get().experimentalGameplay)==null?void 0:l[o.id])!=null?d:!1,...o}})})),console.time("Load com.mojang projects"),(await this.comMojangProjectLoader.loadProjects()).forEach(r=>{var o,l;return this.addProject(`comMojang/${r.name}`,r.name,{name:r.name,displayName:r.name,imgSrc:(l=(o=r.packs.find(d=>!!d.packIcon))==null?void 0:o.packIcon)!=null?l:void 0,contains:r.packs.map(d=>{var h,m,f;const p=u.packType.getFromId(d.type);if(!!p)return{...p,version:(f=(m=(h=d.manifest)==null?void 0:h.header)==null?void 0:m.version)!=null?f:[1,0,0],packPath:d.packPath,uuid:d.uuid}}).filter(d=>!!d),isLocalProject:!1,isComMojangProject:!0,project:x(r)})}),console.timeEnd("Load com.mojang projects"),this.sidebar.resetSelected(),t.isNoProjectSelected?this.sidebar.setDefaultSelected():this.sidebar.setDefaultSelected(t.projectManager.selectedProject),t.projectManager.selectedProject}async reload(){this.state.isLoading=!0,this.comMojangProjectLoader.clearCache(),await this.loadProjects(),this.state.isLoading=!1}async open(){super.open(),this.state.isLoading=!0,console.time("Load projects"),this.state.currentProject=await this.loadProjects(),console.timeEnd("Load projects"),this.state.isLoading=!1}}const Cw=X({__name:"Changelog",props:["window"],setup(s){const e=s,t=e.window.getState();function i(){e.window.close()}return{__sfc:!0,props:e,state:t,onClose:i,BaseWindow:ce}}});var xw=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.BaseWindow,{attrs:{windowTitle:"windows.changelogWindow.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,width:600,height:600},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"mt-4 mb-2 d-flex align-center"},[t("v-icon",{staticClass:"mr-2",attrs:{color:"primary",large:""}},[e._v("mdi-update")]),t("h1",[e._v("v"+e._s(e.window.version))])],1),t("v-divider",{staticClass:"mb-4"}),t("div",{staticClass:"changelog",domProps:{innerHTML:e._s(e.window.changelog)}})]},proxy:!0}])})},kw=[],Pw=_(Cw,xw,kw,!1,null,null,null,null);const jw=Pw.exports,Oa="/";class Fw extends ee{constructor(){super(jw);c(this,"changelog");c(this,"version");this.defineWindow()}async open(){const t=await u.getApp();t.windows.loadingWindow.open(),await fetch(Oa+"changelog.html").then(i=>i.text()).then(i=>{this.changelog=i,this.version=de}),t.windows.loadingWindow.close(),super.open()}}const Tw=X({__name:"Main",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState();function n(){e.window.close()}function a(){window.open("https://discord.gg/jj2PmqU","_blank")}function r(){window.open("https://twitter.com/bridgeIDE","_blank")}function o(){window.open("https://github.com/bridge-core","_blank")}return{__sfc:!0,t,props:e,state:i,close:n,openDiscord:a,openTwitter:r,openGithub:o,BaseWindow:ce}}});var Aw=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"windows.socials.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,width:420,height:140},on:{closeWindow:i.close},scopedSlots:e._u([{key:"default",fn:function(){return[t("p",[e._v(e._s(i.t("windows.socials.content")))])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"#7289DA"},on:{click:i.openDiscord}},[t("v-icon",{attrs:{color:"white"}},[e._v("mdi-discord")]),t("span",{staticClass:"white--text"},[e._v(e._s(i.t("windows.socials.discord")))])],1),t("v-btn",{attrs:{color:"#1DA1F2"},on:{click:i.openTwitter}},[t("v-icon",{attrs:{color:"white"}},[e._v("mdi-twitter")]),t("span",{staticClass:"white--text"},[e._v(e._s(i.t("windows.socials.twitter")))])],1),t("v-btn",{attrs:{color:"#333"},on:{click:i.openGithub}},[t("v-icon",{attrs:{color:"white"}},[e._v("mdi-github")]),t("span",{staticClass:"white--text"},[e._v(e._s(i.t("windows.socials.github")))])],1)]},proxy:!0}],null,!1,533919895)}):e._e()},$w=[],Ew=_(Tw,Aw,$w,!1,null,null,null,null);const Dw=Ew.exports;class Mw extends ee{constructor(){super(Dw),this.defineWindow()}}const Iw=X({__name:"Content",props:["window"],setup(s){const e=s,t=e.window.getState(),i=e.window.sidebar,n=e.window.categories;function a(){e.window.close()}return{__sfc:!0,props:e,state:t,sidebar:i,categories:n,onClose:a,SidebarWindow:_t}}});var Ow=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.SidebarWindow,{attrs:{windowTitle:"sidebar.compiler.name",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:i.sidebar.elements,actions:i.state.actions},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function({selectedSidebar:n}){return[i.categories[n]?t(i.categories[n].component,{tag:"component",attrs:{data:i.categories[n].data.value}}):e._e()]}}]),model:{value:i.sidebar.selected,callback:function(n){e.$set(i.sidebar,"selected",n)},expression:"sidebar.selected"}})},Rw=[],Ww=_(Iw,Ow,Rw,!1,null,null,null,null);const Lw=Ww.exports,Nw={props:{data:Array},components:{ActionViewer:bt}};var Bw=function(){var e=this,t=e._self._c;return t("div",e._l(e.data,function(i,n){return t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],key:n,staticStyle:{cursor:"pointer"},attrs:{action:i,hideTriggerButton:!0},nativeOn:{click:function(a){return i.trigger()}}})}),1)},Vw=[],Hw=_(Nw,Bw,Vw,!1,null,null,null,null);const Uw=Hw.exports,zw={props:{data:Array},mixins:[G],components:{Sheet:Oe},methods:{getIconData(s){if(!s)return null;switch(s){case"info":return{color:"info",icon:"mdi-information-outline"};case"warning":return{color:"warning",icon:"mdi-alert-outline"};case"error":return{color:"error",icon:"mdi-alert-circle-outline"};default:return null}},getMessageParts(s){return s.split(`
`)}}};var Jw=function(){var e=this,t=e._self._c;return e.data.length>0?t("div",e._l(e.data,function([i,{type:n}],a){return t("Sheet",{key:`${n}//${i}//${a}`,staticClass:"pa-2 mb-2 d-flex",staticStyle:{overflow:"auto"}},[e.getIconData(n)?t("v-icon",{staticClass:"mr-2",attrs:{color:e.getIconData(n).color}},[e._v(" "+e._s(e.getIconData(n).icon)+" ")]):e._e(),t("div",[e._l(e.getMessageParts(i),function(r,o){return[t("span",{key:`line-${o}`},[e._v(e._s(r))]),t("br",{key:`break-${o}`})]})],2)],1)}),1):t("Sheet",{staticClass:"pa-2"},[e._v(" "+e._s(e.t("sidebar.compiler.categories.logs.noLogs"))+" ")])},qw=[],Gw=_(zw,Jw,qw,!1,null,null,null,null);const Kw=Gw.exports,Yw={props:{data:Object},components:{InfoPanel:vn}};var Qw=function(){var e=this,t=e._self._c;return t("InfoPanel",{attrs:{infoPanel:e.data}})},Zw=[],Xw=_(Yw,Qw,Zw,!1,null,null,null,null);const ey=Xw.exports,Ra=(s=!0)=>({icon:"mdi-restart-alert",name:"packExplorer.restartWatchMode.name",description:s?"packExplorer.restartWatchMode.description":void 0,onTrigger:()=>{new N({description:"packExplorer.restartWatchMode.confirmDescription",height:168,onConfirm:async()=>{const e=await u.getApp();await Promise.all([e.project.fileSystem.unlink(".bridge/.lightningCache"),e.project.fileSystem.unlink(".bridge/.compilerFiles")]),await e.project.fileSystem.writeFile(".bridge/.restartWatchMode",""),e.actionManager.trigger("bridge.action.refreshProject")}})}}),Wa=new D(Ra()),ty={icon:"mdi-cog-outline",name:"actions.recompileChanges.name",description:"actions.recompileChanges.description",onTrigger:async()=>{const e=(await u.getApp()).project;e.packIndexer.deactivate(),await e.packIndexer.activate(!0);const[t,i]=await e.packIndexer.fired;await e.compilerService.start(t,i)}},iy=new D(ty);const ny={components:{ToggleSheet:Dn,SelectedStatus:Ti},props:{value:Boolean},data(){return{selected:this.value||!1}},methods:{onInput(s){this.selected=s,this.$emit("input",s)}}};var sy=function(){var e=this,t=e._self._c;return t("ToggleSheet",{attrs:{value:e.selected},on:{input:e.onInput}},[e._t("header"),t("SelectedStatus",{attrs:{selected:e.selected}}),e._t("default")],2)},ay=[],ry=_(ny,sy,ay,!1,null,null,null,null);const oy=ry.exports,cy={components:{ActionViewer:bt,SettingSheet:oy},mixins:[G],props:{data:Object},data:()=>({settings:[{id:"watchModeActive",icon:"mdi-eye-outline"},{id:"autoFetchChangedFiles",icon:"mdi-radar"}]}),setup(){return b.compiler||U(b,"compiler",{watchModeActive:!0,autoFetchChangedFiles:!0}),{recompileChangesAction:iy,restartWatchModeAction:Wa,settingsState:b}}};var ly=function(){var e=this,t=e._self._c;return t("v-row",{staticClass:"mb-6",attrs:{dense:""}},[t("v-col",[t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],staticStyle:{"margin-bottom":"0 !important",height:"100%"},attrs:{action:e.restartWatchModeAction,hideTriggerButton:!0},nativeOn:{click:function(i){return e.restartWatchModeAction.trigger()}}})],1),t("v-col",[t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],staticStyle:{"margin-bottom":"0 !important",height:"100%"},attrs:{action:e.recompileChangesAction,hideTriggerButton:!0},nativeOn:{click:function(i){return e.recompileChangesAction.trigger()}}})],1),e._l(e.settings,function({id:i,icon:n}){return t("v-col",{key:i},[t("SettingSheet",{staticStyle:{height:"100%"},on:{input:function(a){e.data.shouldSaveSettings=!0}},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"d-flex align-center"},[t("v-icon",{staticClass:"mr-1",attrs:{color:"accent"}},[e._v(" "+e._s(n)+" ")]),t("h3",[e._v(" "+e._s(e.t(`sidebar.compiler.categories.watchMode.settings.${i}.name`))+" ")])],1)]},proxy:!0}],null,!0),model:{value:e.settingsState.compiler[i],callback:function(a){e.$set(e.settingsState.compiler,i,a)},expression:"settingsState.compiler[id]"}},[[e._v(" "+e._s(e.t(`sidebar.compiler.categories.watchMode.settings.${i}.description`))+" ")]],2)],1)})],2)},dy=[],uy=_(cy,ly,dy,!1,null,null,null,null);const py=uy.exports;class hy extends ee{constructor(){super(Lw,!1,!0);c(this,"sidebar",new Lt([],!1));c(this,"categories",x({watchMode:{component:py,data:F({shouldSaveSettings:!1})},buildProfiles:{component:Uw,data:F(null)},outputFolders:{component:ey,data:F(null)},logs:{component:Kw,data:F(null)}}));c(this,"activeCategoryChanged",x(new z));c(this,"lastUsedBuildProfile",null);c(this,"runLastProfileAction",new D({name:"sidebar.compiler.actions.runLastProfile",icon:"mdi-play",color:"accent",onTrigger:()=>{if(!this.lastUsedBuildProfile)throw new Error("Invalid state: Triggered runLastProfileAction without a last used build profile");this.lastUsedBuildProfile.trigger()}}));this.defineWindow();const t=new D({icon:"mdi-refresh",name:"general.reload",color:"accent",onTrigger:()=>{this.reload()}});this.state.actions.push(t);const i=new D({icon:"mdi-close-circle-outline",name:"general.clear",color:"accent",onTrigger:async()=>{(await u.getApp()).project.compilerService.clearCompilerLogs(),this.categories.logs.data.value=[]}});this.sidebar.on(n=>{this.activeCategoryChanged.dispatch(n),n==="logs"?this.state.actions.splice(this.state.actions.indexOf(t),0,i):this.state.actions=this.state.actions.filter(a=>a!==i)}),Wa.on(()=>this.close()),u.getApp().then(()=>{this.sidebar.addElement(new $e({id:"watchMode",text:ge.translate("sidebar.compiler.categories.watchMode.name"),color:"primary",icon:"mdi-eye-outline"})),this.sidebar.addElement(new $e({id:"buildProfiles",text:ge.translate("sidebar.compiler.categories.profiles"),color:"primary",icon:"mdi-motion-play-outline"})),this.sidebar.addElement(new $e({id:"outputFolders",text:ge.translate("sidebar.compiler.categories.outputFolders"),color:"primary",icon:"mdi-folder-open-outline"})),this.sidebar.addElement(new $e({id:"logs",text:ge.translate("sidebar.compiler.categories.logs.name"),color:"primary",icon:"mdi-format-list-text"})),this.sidebar.setDefaultSelected()})}async reload(){const t=await u.getApp();this.categories.buildProfiles.data.value=await this.loadProfiles(),this.categories.logs.data.value=await t.project.compilerService.getCompilerLogs(),this.categories.outputFolders.data.value=await this.loadOutputFolders()}async open(){const t=await u.getApp();await this.reload(),await t.project.compilerService.onConsoleUpdate(lt(async()=>{this.categories.logs.data.value=await t.project.compilerService.getCompilerLogs()})),this.lastUsedBuildProfile&&this.state.actions.unshift(this.runLastProfileAction),super.open()}async close(){await(await u.getApp()).project.compilerService.removeConsoleListeners(),this.state.actions=this.state.actions.filter(i=>i!==this.runLastProfileAction),super.close(),this.categories.watchMode.data.value.shouldSaveSettings&&(this.categories.watchMode.data.value.shouldSaveSettings=!1,await _e.saveSettings())}async loadProfiles(){const i=(await u.getApp()).project,n=await i.fileSystem.getDirectoryHandle(".bridge/compiler",{create:!0}),a=[{icon:"mdi-cog",name:"sidebar.compiler.default.name",description:"sidebar.compiler.default.description",onTrigger:async r=>{this.close(),this.lastUsedBuildProfile=r;const o=await i.createDashService("production");await o.setup(),await o.build()}}];for await(const r of n.values()){if(r.kind!=="file"||r.name===".DS_Store"||r.name==="default.json")continue;const o=await r.getFile();let l;try{l=L.parse(await o.text())}catch{continue}a.push({icon:l.icon,name:l.name,description:l.description,onTrigger:async d=>{this.close(),this.lastUsedBuildProfile=d;const p=await i.createDashService("production",`${i.projectPath}/.bridge/compiler/${r.name}`);await p.setup(),await p.build()}})}return a.map(r=>new D(r))}async loadOutputFolders(){const i=(await u.getApp()).comMojang,{hasComMojang:n,didDenyPermission:a}=i.status;let r;if(A.value)r={text:"comMojang.status.notAvailable",type:"error",isDismissible:!1};else if(!n&&a)r={text:"comMojang.status.deniedPermission",type:"warning",isDismissible:!1};else if(n&&!a)r={text:"comMojang.status.sucess",type:"success",isDismissible:!1};else if(!n)r={text:"comMojang.status.notSetup",type:"error",isDismissible:!1};else throw new Error("Invalid com.mojang status");return new Xs(r)}}class my{constructor(e){c(this,"settings");c(this,"socialsWindow",new Mw);c(this,"projectChooser");c(this,"createProject",new xt);c(this,"loadingWindow",new Zg);c(this,"createPreset",new mw);c(this,"extensionStore",new Jg);c(this,"browserUnsupported",new Ig);c(this,"changelogWindow",new Fw);c(this,"compilerWindow",new hy);this.app=e,this.settings=new _e(e),this.projectChooser=new Sw(e)}}const ms=1276368;function fy(s){return new Promise(e=>{typeof requestIdleCallback=="function"?requestIdleCallback(async()=>{await s(),e()}):setTimeout(async()=>{await s(),e()},10)})}class gy extends Z{constructor(t=!1){super();c(this,"_virtualFileSystem");this.isMainLoader=t}get virtualFileSystem(){if(!this._virtualFileSystem)throw new Error("DataLoader: virtualFileSystem is not initialized");return this._virtualFileSystem}async loadData(t=!1){if(this.hasFired){console.warn("This dataLoader instance already loaded data. You called loadData() twice.");return}let i=await he("savedDataForVersion");t&&(i=void 0,await ye("savedDataForVersion",void 0));const n=i?Q(de,i,"="):!1;this.isMainLoader&&console.log(n?"[APP] Data saved; restoring from cache...":"[APP] Latest data not saved; fetching now..."),console.time("[App] Data");const a=this.isMainLoader&&!n;if(this._virtualFileSystem=new ne(new ut("data-fs"),"bridgeFolder",n?void 0:new Map,a),await this._virtualFileSystem.setupDone.fired,n){this.setup(this._virtualFileSystem),console.timeEnd("[App] Data");return}const r=await fetch(Oa+"packages.zip").then(p=>p.arrayBuffer());if(r.byteLength!==ms)throw new Error(`Error: Data package was larger than the expected size of ${ms} bytes; got ${r.byteLength} bytes`);const o=await new Promise((p,h)=>en(new Uint8Array(r),async(m,f)=>{if(m)return h(m);p(f)})),d={".":await this._virtualFileSystem.getDirectoryHandle("data",{create:!0})};for(const p in o){const h=fe(p),m=ve(p);if(p.endsWith("/")){const f=await d[m].getDirectoryHandle(h,{create:!0});d[p.slice(0,-1)]=f}else await d[m].getFileHandle(h,{create:!0,initialData:o[p]})}this.setup(this._virtualFileSystem),console.timeEnd("[App] Data"),this.isMainLoader&&!t&&fy(async()=>{await this._virtualFileSystem.moveToIdb(),await ye("savedDataForVersion",de)})}}class wy{constructor(){c(this,"state",q({}))}addCategory(e){U(this.state,e.id,e)}disposeCategory(e){Se(this.state,e.id)}showMobileMenu(e){De(e,Object.values(this.state).map(t=>[{type:"divider"},t.toNestedMenu()]).flat(1).slice(1))}}class yy extends z{constructor(){super();c(this,"state",q({currentHeight:window.innerHeight,currentWidth:window.innerWidth}));window.addEventListener("resize",He(()=>this.dispatch(),50,{trailing:!0})),this.on(([t,i])=>{this.state.currentWidth=t,this.state.currentHeight=i}),u.getApp().then(t=>t.projectManager.projectReady.fired.then(()=>this.dispatch()))}dispatch(){super.dispatch([window.innerWidth,window.innerHeight])}}class vy extends gi{constructor(){super({message:"sidebar.notifications.installApp.message",color:"primary",icon:"mdi-download",textColor:"white",isVisible:!1});c(this,"isInstallable",new $);c(this,"isInstalled",new $);c(this,"installEvent");window.addEventListener("beforeinstallprompt",t=>this.onInstallPrompt(t)),window.addEventListener("appinstalled",()=>this.dispose()),this.addClickHandler(()=>this.prompt())}onInstallPrompt(t){t.preventDefault(),this.installEvent=t,this.show(),this.isInstallable.dispatch()}prompt(){this.installEvent?(this.installEvent.prompt(),this.installEvent.userChoice.then(t=>{t.outcome==="accepted"&&(this.dispose(),this.isInstalled.dispatch())})):this.dispose()}}const by=Ee?"bridge. Nightly":"bridge. v2";class _y{constructor(){c(this,"titleTag");c(this,"current",F(""));c(this,"appName",by);this.titleTag=document.head.getElementsByTagName("title")[0]}setProject(e){e===We?(this.titleTag.innerText="",this.current.value=""):(this.titleTag.innerText=e,this.current.value=e)}}class Sy extends ${constructor(t){super();c(this,"addedProject",new z);c(this,"activatedProject",new z);c(this,"state",wt({}));c(this,"title",x(new _y));c(this,"_selectedProject");c(this,"projectReady",new $);this.app=t,this.loadProjects()}get currentProject(){return this.selectedProject?this.state[this.selectedProject]:null}get selectedProject(){return this._selectedProject}get totalProjects(){return Object.keys(this.state).length}async getProjects(){return await this.fired,Object.values(this.state).filter(t=>!t.isVirtualProject)}getProject(t){return this.state[t]}async addProject(t,i=!0,n=this.app.bridgeFolderSetup.hasFired){const a=new St(this,this.app,t,{requiresPermissions:n});return await a.loadProject(),U(this.state,a.name,a),i&&(await this.selectProject(a.name),this.addedProject.dispatch(a)),a}async removeProject(t,i=!0){if(!this.state[t.name])throw new Error("Project to delete not found");this._selectedProject===t.name&&(await this.selectProject(We),t.dispose()),Se(this.state,t.name),i&&await this.app.fileSystem.unlink(t.projectPath),await this.storeProjects(t.name)}async removeProjectWithName(t){const i=this.state[t];if(!i)throw new Error(`Project with name "${t}" not found`);await this.removeProject(i)}async loadProjects(t=!1){await this.app.fileSystem.fired,await this.app.dataLoader.fired;const i=await this.app.fileSystem.getDirectoryHandle("projects",{create:!0}),n=this.app.bridgeFolderSetup.hasFired,a=[];for await(const r of i.values())r.kind==="directory"&&a.push(this.addProject(r,!1,t));if(n){const r=await this.app.fileSystem.getDirectoryHandle("~local/projects",{create:!0});for await(const o of r.values())o.kind==="directory"&&a.push(this.addProject(o,!1,!1))}await Promise.allSettled(a),n?this.storeProjects(void 0,!0):await this.createVirtualProject(),this.dispatch()}async createVirtualProject(){await this.app.fileSystem.unlink(`projects/${We}`);const t=await this.app.fileSystem.getDirectoryHandle(`projects/${We}`,{create:!0}),i=new Z(t),n={name:"bridge",namespace:"bridge",author:[],description:"",bpAsRpDependency:!1,experimentalGameplay:{},icon:null,packs:["behaviorPack",".bridge"],rpAsBpDependency:!1,targetVersion:await Ns(this.app.dataLoader),useLangForManifest:!1,bdsProject:!1,uuids:{data:E(),resources:E(),skin_pack:E(),world_template:E()}};await Promise.all(["BP",".bridge"].map(a=>i.mkdir(a))),await new $i().create(i,n),await this.addProject(t,!1)}async selectProject(t,i=!1){var n,a;if(this.app.viewComMojangProject.hasComMojangProjectLoaded&&await this.app.viewComMojangProject.clearComMojangProject(),this._selectedProject===t)return!0;if(this.state[t]===void 0){if(i)return new J({description:"packExplorer.noProjectView.projectNoLongerExists"}),!1;throw new Error(`Cannot select project "${t}" because it no longer exists`)}return!this.app.comMojang.hasFired&&t!==We&&this.app.comMojang.setupComMojang(),(n=this.currentProject)==null||n.deactivate(),this._selectedProject=t,u.eventSystem.dispatch("disableValidation",null),(a=this.currentProject)==null||a.activate(),await ye("selectedProject",t),this.app.themeManager.updateTheme(),u.eventSystem.dispatch("projectChanged",this.currentProject),await this.storeProjects(),this.projectReady.hasFired||this.projectReady.dispatch(),!0}async selectLastProject(){if(await this.fired,A.value){const t=await he("selectedProject");let i=!1;if(typeof t=="string"&&(i=await this.selectProject(t,!0)),i)return}await this.selectProject(We)}updateAllEditorOptions(t){Object.values(this.state).forEach(i=>i.tabSystems.forEach(n=>n.updateOptions(t)))}forEachProject(t){return Object.values(this.state).forEach(t),this.addedProject.on(t)}onActiveProject(t){return this.projectReady.hasFired&&this.currentProject&&t(this.currentProject),this.activatedProject.on(t)}someProject(t){return Object.values(this.state).some(t)}async recompileAll(t=!0){for(const i of Object.values(this.state))await i.recompile(t)}async loadAvailableProjects(t){return(await this.app.fileSystem.readJSON("~local/data/projects.json").catch(()=>[])).filter(i=>!t||i.name!==t)}async storeProjects(t,i=!1){let n=await this.loadAvailableProjects(t),a=i?[]:[...n];Object.values(this.state).forEach(r=>{var l,d;if(r.isVirtualProject)return;const o=n.find(p=>r.name===p.name&&r.requiresPermissions===p.requiresPermissions);!i&&o||a.push({name:r.name,displayName:(l=r.config.get().name)!=null?l:r.name,icon:r.projectData.imgSrc,requiresPermissions:r.requiresPermissions,isFavorite:(d=o==null?void 0:o.isFavorite)!=null?d:!1})}),await this.app.fileSystem.writeJSON("~local/data/projects.json",a),u.eventSystem.dispatch("availableProjectsFileChanged",void 0)}}class Cy{constructor(){c(this,"mayCloseOnClickOutside",!0);c(this,"isVisible",F(!1));c(this,"actionManager",F());c(this,"position",q({x:0,y:0}));c(this,"menuHeight",0)}show(e,t,i=!0){this.position.x=e.clientX,this.position.y=e.clientY,this.actionManager.value=x(t),this.mayCloseOnClickOutside=i,this.menuHeight=this.actionManager.value.getAllElements().reduce((n,a)=>{switch(a.type){case"submenu":return n+40;case"divider":return n+1;case"action":default:return n+40}},0)+16,this.isVisible.value=!0}setMayCloseOnClickOutside(e){setTimeout(()=>{this.mayCloseOnClickOutside=e},100)}}class xy extends fa{constructor(e){super(e.fileSystem,"~local/extensions","data/inactiveExtensions.json",!0),this.app=e}async getInstalledExtensions(){return await this.app.projectManager.projectReady.fired,new Set([...(await super.getInstalledExtensions()).values(),...(await this.app.project.extensionLoader.getInstalledExtensions()).values()])}mapActive(e){const t=this.app.project.extensionLoader.mapActive(e);for(const i of this._extensions.values())i.isActive&&t.push(e(i));return t}installFilesToCurrentProject(){return Promise.all([...this.extensions.values()].map(e=>e.installFilesToCurrentProject()))}async reload(){this.disposeAll(),this.loadExtensions()}}class ky{constructor(e){c(this,"fileHandlers",new Map);c(this,"defaultImporter");this.app=e,window.addEventListener("dragover",t=>{t.preventDefault()}),window.addEventListener("drop",t=>{var i,n;t.preventDefault(),!u.windowState.isAnyWindowVisible.value&&this.onDrop([...(n=(i=t.dataTransfer)==null?void 0:i.items)!=null?n:[]])})}async onDrop(e){for(const t of e){const i=await t.getAsFileSystemHandle();if(!i)return;await this.import(i)}}async import(e){e.kind==="directory"?await this.importFolder(e):e.kind==="file"&&await this.importFile(e)}async importFile(e){var n;await this.app.projectManager.projectReady.fired;const t=me(e.name);let i=(n=this.fileHandlers.get(t))!=null?n:this.defaultImporter;if(!i)return!1;try{await i(e)}catch(a){return console.error(a),!1}return!0}async importFolder(e){await this.app.folderImportManager.onImportFolder(e)}addFileImporter(e,t){if(this.fileHandlers.has(e))throw new Error(`Handler for ${e} already exists`);return this.fileHandlers.set(e,t),{dispose:()=>this.fileHandlers.delete(e)}}setDefaultFileImporter(e){return this.defaultImporter=e,{dispose:()=>this.defaultImporter=void 0}}}class kt{constructor(e,t,i=!1){c(this,"disposables",[]);for(const n of e)this.disposables.push(t.addFileImporter(n,this.onImport.bind(this)));i&&this.disposables.push(t.setDefaultFileImporter(this.onImport.bind(this)))}dispose(){this.disposables.forEach(e=>e.dispose())}}class Py extends kt{constructor(e){super([".mcaddon"],e)}async onImport(e){const t=await u.getApp();t.windows.loadingWindow.open();try{await In(e)}catch(i){console.error(i)}finally{t.windows.loadingWindow.close()}}}const jy=X({__name:"Window",props:["window"],setup(s){const e=s,{t}=O(),i=e.window.getState();function n(a){e.window.startCloseWindow(a)}return{__sfc:!0,t,props:e,state:i,onClose:n,PresetPath:Ia,BaseWindow:ce}}});var Fy=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:`[${i.t("windows.filePath.title")}${e.window.hasFilePath?`: ${i.state.fileName}${e.window.fileExt}`:""}]`,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,isPersistent:e.window.isPersistent,hasCloseButton:!1,width:440,height:170},on:{closeWindow:function(n){return i.onClose(!0)}},scopedSlots:e._u([{key:"default",fn:function(){return[e.window.hasFilePath?t("span",{staticClass:"d-flex align-center"},[t("v-text-field",{attrs:{dense:"",outlined:"","prepend-icon":"mdi-pencil-outline",rules:[n=>!!n.match(/^[a-zA-Z0-9_\.]*$/)||i.t("windows.createPreset.validationRule.alphanumeric"),n=>!!n||i.t("windows.createPreset.validationRule.required"),n=>n.toLowerCase()===n||i.t("windows.createPreset.validationRule.lowercase")]},model:{value:i.state.fileName,callback:function(n){e.$set(i.state,"fileName",n)},expression:"state.fileName"}}),t("span",{staticClass:"ml-3 mb-6"},[e._v(e._s(e.window.fileExt))])],1):e._e(),t(i.PresetPath,{model:{value:i.state.currentFilePath,callback:function(n){e.$set(i.state,"currentFilePath",n)},expression:"state.currentFilePath"}})]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary"},on:{click:function(n){return i.onClose(!1)}}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(" "+e._s(i.t("general.confirm"))+" ")])],1)]},proxy:!0}],null,!1,281310210)}):e._e()},Ty=[],Ay=_(jy,Fy,Ty,!1,null,null,null,null);const $y=Ay.exports;class Ey extends ee{constructor({fileName:t,startPath:i="",isPersistent:n=!1}){super($y,!0,!1);c(this,"fileExt");c(this,"isPersistent",!1);c(this,"hasFilePath",!1);c(this,"state",q({...super.state,fileName:"",currentFilePath:""}));this.state.currentFilePath=i,this.isPersistent=n,t&&(this.hasFilePath=!0,this.fileExt=me(t),this.state.fileName=fe(t,this.fileExt)),this.defineWindow(),this.open()}startCloseWindow(t){return this.close(t?null:{filePath:this.state.currentFilePath,fileName:this.hasFilePath?`${this.state.fileName}${this.fileExt}`:void 0})}}class Dy extends kt{constructor(e){super([".mcfunction",".mcstructure",".json",".molang",".js",".ts",".lang",".tga",".png",".jpg",".jpeg",".wav",".ogg",".mp3",".fsb"],e,!0)}async onImport(e){const t=await u.getApp(),i=R;if(await t.projectManager.projectReady.fired,t.project.isVirtualProject)return await this.onOpen(e);const n=new Wt("fileDropper.importMethod.name",{isPersistent:!1}),a=await n.actionManager;a.create({icon:"mdi-content-save-outline",name:"fileDropper.saveToProject.title",description:`[${i("fileDropper.saveToProject.description1")} "${e.name}" ${i("fileDropper.saveToProject.description2")}]`,onTrigger:()=>this.onSave(e)}),a.create({icon:"mdi-share-outline",name:"fileDropper.openFile.title",description:`[${i("fileDropper.openFile.description1")} "${e.name}" ${i("fileDropper.openFile.description2")}]`,onTrigger:()=>this.onOpen(e)}),n.open(),await n.fired}async onSave(e){const t=await u.getApp(),i=await u.fileType.guessFolder(e),n=new Ey({fileName:e.name,startPath:i?t.project.relativePath(i):"",isPersistent:!1});n.open();const a=await n.fired;if(a===null)return;const{filePath:r,fileName:o=e.name}=a,l=Be(r,o);if(await t.project.fileSystem.fileExists(l)){const h=new N({description:"windows.createPreset.overwriteFiles",confirmText:"windows.createPreset.overwriteFilesConfirm"});if(h.open(),!await h.fired)return}t.windows.loadingWindow.open();const p=await t.project.fileSystem.getFileHandle(l,!0);await t.project.fileSystem.copyFileHandle(e,p),u.eventSystem.dispatch("fileAdded",void 0),await t.project.updateFile(t.project.config.resolvePackPath(void 0,l)),await t.project.openFile(p,{isTemporary:!1}),t.windows.loadingWindow.close()}async onOpen(e){await(await u.getApp()).project.openFile(e)}}class My extends kt{constructor(e){super([".brproject"],e)}async onImport(e){await En(e)}}function Iy(s,e,t){return Math.min(Math.max(s,e),t)}class Oy extends kt{constructor(e){super([".bbmodel"],e)}async onImport(e){const t=await u.getApp(),i=await e.getFile(),n=JSON.parse(await i.text());t.windows.loadingWindow.open();const a=[];n.textures&&a.push(this.exportImages(t,n.textures)),n.elements&&n.outliner&&a.push(this.exportModel(t,n)),n.animations&&a.push(this.exportAnimations(t,n.animations,n.name)),a.length>0&&(await Promise.allSettled(a),u.eventSystem.dispatch("fileAdded",void 0)),t.windows.loadingWindow.close()}async exportImages(e,t){for(let i of t){const n=await fetch(i.source),a=await n.arrayBuffer(),r=n.headers.get("content-type");let o="png";switch(r){case"image/png":o="png";break;case"image/jpeg":case"image/jpg":o="jpg";break;case"image/tga":case"image/x-tga":case"image/x-targa":case"image/target":case"application/x-tga":case"application/x-targa":o="tga";break}const l=await new et({name:"general.textureLocation",default:"entity",options:["entity","blocks","items"]}).fired,d=Be("RP","textures",l,me(i.name)===""?`${i.name}.${o}`:i.name);if(await e.project.fileSystem.fileExists(d)){const m=new N({description:"general.confirmOverwriteFile",confirmText:"windows.createPreset.overwriteFilesConfirm"});if(m.open(),!await m.fired)continue}const h=await e.project.fileSystem.writeFile(d,a);e.project.updateFile(e.project.absolutePath(d)),await e.project.openFile(h,{isTemporary:!1})}}async exportModel(e,t){var h,m,f,g,w,y;const i={description:{identifier:"geometry."+(t.model_identifier||"unknown"),texture_width:t.resolution.width||16,texture_height:t.resolution.height||16,visible_bounds_width:(m=(h=t.visible_box)==null?void 0:h[0])!=null?m:0,visible_bounds_height:(g=(f=t.visible_box)==null?void 0:f[1])!=null?g:0,visible_bounds_offset:[0,(y=(w=t.visible_box)==null?void 0:w[2])!=null?y:0,0]}},n={format_version:"1.12.0","minecraft:geometry":[i]},a=this.extractCubes(t.elements,t.meta.box_uv),r=this.extractLocators(t.elements),o=this.createBones(t,a,r);o.size>0&&(i.bones=[...o.values()]);const l=Be("RP","models","entity",t.name+".json");if(await e.project.fileSystem.fileExists(l)){const S=new N({description:"general.confirmOverwriteFile",confirmText:"windows.createPreset.overwriteFilesConfirm"});if(S.open(),!await S.fired)return}const p=await e.project.fileSystem.getFileHandle(l,!0);await e.project.fileSystem.writeJSON(l,n,!0),e.project.updateFile(e.project.absolutePath(l)),await e.project.openFile(p,{isTemporary:!1})}extractCubes(e,t=!0){const i=new Map;return e.forEach(n=>{if(n.type==="locator")return;const a=Array.isArray(n.rotation)&&n.rotation.every(o=>o!==0),r={origin:n.from?[...n.from]:void 0,size:n.to.map((o,l)=>o-n.from[l]),rotation:a?n.rotation.map((o,l)=>l===2?o:-o):void 0,pivot:a?[n.origin[0]*-1,n.origin[1],n.origin[2]]:void 0,inflate:n.inflate};if(r.origin&&(r.origin[0]=-(r.origin[0]+r.size[0])),t)r.uv=n.uv_offset,n.mirror_uv&&(r.mirror=n.mirror_uv);else{r.uv={};for(const[o,l]of Object.entries(n.faces))l.texture!==null&&(r.uv[o]={uv:[l.uv[0],l.uv[1]],uv_size:[l.uv[2]-l.uv[0],l.uv[3]-l.uv[1]]},l.material_name&&(r.uv[o].material_instance=l.material_name),(o==="up"||o==="down")&&(r.uv[o].uv[0]+=r.uv[o].uv_size[0],r.uv[o].uv[1]+=r.uv[o].uv_size[1],r.uv[o].uv_size[0]*=-1,r.uv[o].uv_size[1]*=-1))}i.set(n.uuid,r)}),i}extractLocators(e){const t=new Map;return e.forEach(i=>{if(i.type!=="locator")return;const n={offset:[...i.from]};n.offset[0]*=-1,(i.rotation[0]!==0||i.rotation[1]!==0||i.rotation[2]!==0)&&(n.rotation=[-i.rotation[0],-i.rotation[0],i.rotation[0]]),t.set(i.name,n)}),t}createBones(e,t,i){const n=new Map;return Array.isArray(e.outliner)&&e.outliner.forEach(a=>this.parseOutlinerElement(a,n,t,i)),n}parseOutlinerElement(e,t,i,n,a){const r={name:e.name,parent:a==null?void 0:a.name,pivot:e.origin?[e.origin[0]*-1,e.origin[1],e.origin[2]]:void 0,rotation:e.rotation?[e.rotation[0]*-1,e.rotation[1]*-1,e.rotation[2]]:void 0,binding:e.bedrock_binding,mirror:e.mirror_uv,material:e.material,reset:e.reset,cubes:e.children.filter(o=>typeof o=="string").map(o=>i.get(o)).filter(o=>o!==void 0),locators:Object.fromEntries(e.children.filter(o=>typeof o=="string").map(o=>[o,n.get(o)]).filter(([o,l])=>l!==void 0))};if(r.cubes.length===0&&(r.cubes=void 0),Object.keys(r.locators).length===0&&(r.locators=void 0),t.set(e.name,r),Array.isArray(e.children))for(let o of e.children)o instanceof Object&&this.parseOutlinerElement(o,t,i,n,r)}async exportAnimations(e,t,i){const n={format_version:"1.8.0",animations:{}};for(let l of t){let d;l.loop==="hold"?d="hold_on_last_frame":(l.loop==="loop"||this.getAnimationLength(l)==0)&&(d=!0);const p={loop:d,animation_length:l.length?l.length:void 0,override_previous_animation:l.override?!0:void 0,anim_time_update:l.anim_time_update?l.anim_time_update.replace(/\n/g,""):void 0,blend_weight:l.blend_weight?l.blend_weight.replace(/\n/g,""):void 0,start_delay:l.start_delay?l.start_delay.replace(/\n/g,""):void 0,loop_delay:l.loop_delay&&d?l.loop_delay.replace(/\n/g,""):void 0,bones:{},sound_effects:{},particle_effects:{},timeline:{}};for(let h in l.animators){let m=l.animators[h];if(!!m.keyframes.length){if(m.type==="effect")m.keyframes.filter(f=>f.channel==="sound").sort((f,g)=>f.time-g.time).forEach(f=>{p.sound_effects[this.getTimecodeString(f.time)]=this.compileBedrockKeyframe(f,m)}),m.keyframes.filter(f=>f.channel==="particle").sort((f,g)=>f.time-g.time).forEach(f=>{p.particle_effects[this.getTimecodeString(f.time)]=this.compileBedrockKeyframe(f,m)}),m.keyframes.filter(f=>f.channel==="timeline").sort((f,g)=>f.time-g.time).forEach(f=>{p.timeline[this.getTimecodeString(f.time)]=this.compileBedrockKeyframe(f,m)});else if(m.type==="bone"||m.type===void 0){let f=p.bones[m.name]={},g={};m.keyframes.forEach(w=>{g[w.channel]||(g[w.channel]={});let y=this.getTimecodeString(w.time);g[w.channel][y]=this.compileBedrockKeyframe(w,m)});for(let w of["rotation","position","scale","particle","sound","timeline"])if(g[w]){let y=Object.keys(g[w]);y.length===1&&m.keyframes[0].data_points.length==1&&m.keyframes[0].interpolation!="catmullrom"?(f[w]=g[w][y[0]],w==="scale"&&g[w][y[0]]instanceof Array&&g[w][y[0]].every(S=>S!==g[w][y[0]][0])&&(f[w]=g[w][y[0]][0])):y.sort((S,v)=>parseFloat(S)-parseFloat(v)).forEach(S=>{f[w]||(f[w]={}),f[w][S]=g[w][S]})}}}}Object.keys(p.bones).length==0&&delete p.bones,Object.keys(p.sound_effects).length==0&&delete p.sound_effects,Object.keys(p.particle_effects).length==0&&delete p.particle_effects,Object.keys(p.timeline).length==0&&delete p.timeline,n.animations[l.name]=p}const a=Be("RP","animations",i+".animation.json");if(await e.project.fileSystem.fileExists(a)){const l=new N({description:"general.confirmOverwriteFile",confirmText:"windows.createPreset.overwriteFilesConfirm"});if(l.open(),!await l.fired)return}const o=await e.project.fileSystem.getFileHandle(a,!0);await e.project.fileSystem.writeJSON(a,n,!0),e.project.updateFile(e.project.absolutePath(a)),await e.project.openFile(o,{isTemporary:!1})}compileBedrockKeyframe(e,t){if(e.channel==="rotation"||e.channel==="position"||e.channel==="scale")if(e.interpolation!="linear"&&e.interpolation!="step"){let i=this.getPreviousKeyframe(e,t),n=!i&&e.time>0||i&&i.interpolation=="catmullrom";return{pre:n?this.getTransformArray(e,0):void 0,post:this.getTransformArray(e,n?1:0),lerp_mode:e.interpolation}}else if(e.data_points.length==1){let i=this.getPreviousKeyframe(e,t);return i&&i.interpolation=="step"?{pre:this.getTransformArray(i,1),post:this.getTransformArray(e)}:this.getTransformArray(e)}else return{pre:this.getTransformArray(e,0),post:this.getTransformArray(e,1)};else if(e.channel==="timeline"){let i=[];return e.data_points.forEach(n=>{n.script&&i.push(...n.script.split(`
`))}),i=i.filter(n=>!!n.replace(/[\n\s;.]+/g,"")),i.length<=1?i[0]:i}else{let i=[];return e.data_points.forEach(n=>{if(n.effect){let a=n.script||void 0;a&&!a.replace(/[\n\s;.]+/g,"")&&(a=void 0),a&&!a.match(/;$/)&&(a+=";"),i.push({effect:n.effect,locator:n.locator||void 0,pre_effect_script:a})}}),i.length<=1?i[0]:i}}getPreviousKeyframe(e,t){let i=t.keyframes.filter(n=>n.time<e.time&&n.channel==e.channel);return i.sort((n,a)=>a.time-n.time),i[0]}getTransformArray(e,t=0){function i(a,r,o){if(o&&(o=Iy(o,0,a.data_points.length-1)),o=a.data_points[o],!o||!o[r])return 0;if(isNaN(o[r]))return o[r];{let l=parseFloat(o[r]);return isNaN(l)?0:l}}let n=[i(e,"x",t),i(e,"y",t),i(e,"z",t)];return n.forEach((a,r)=>{a.replace&&(n[r]=a.replace(/\n/g,""))}),n}getAnimationLength(e){let t=e.length||0;for(let i in e.animators){let a=e.animators[i].keyframes;a.find(r=>r.interpolation==="catmullrom")&&(a=a.slice().sort((r,o)=>r.time-o.time)),a.forEach((r,o)=>{r.interpolation==="catmullrom"&&o==a.length-1||(t=Math.max(t,a[o].time))})}return t}getTimecodeString(e){let t=this.trimFloatNumber(e).toString();return t.includes(".")||(t+=".0"),t}trimFloatNumber(e){if(e==="")return e;let t=e.toFixed(4);return t=t.replace(/0+$/g,"").replace(/\.$/g,""),t==="-0"?0:t}}class Ry extends kt{constructor(e){super([".zip"],e)}async onImport(e){const t=await u.getApp(),i=t.fileSystem,n=await i.getDirectoryHandle("import",{create:!0}),a=new di(n),r=await e.getFile(),o=new Uint8Array(await r.arrayBuffer());if(a.createTask(t.taskManager),await a.unzip(o),await i.fileExists("import/config.json")||await i.directoryExists("import/data")||await i.directoryExists("import/projects")||await i.directoryExists("import/extensions"))await En(e,!1);else for await(const l of n.values())if(await i.fileExists(`import/${l.name}/manifest.json`)){await In(e,!1);break}}}async function Wy(s,e=!0){var p,h,m;const t=await u.getApp(),i=t.fileSystem,n=await i.getDirectoryHandle("import",{create:!0});if(await t.projectManager.projectReady.fired,e){const f=new di(n),g=await s.getFile(),w=new Uint8Array(await g.arrayBuffer());f.createTask(t.taskManager),await f.unzip(w)}const a=await ki(s.name.replace(".mcpack","").replace(".zip",""),await i.getDirectoryHandle("projects"));A.value&&!t.hasNoProjects&&await new N({description:"windows.projectChooser.openNewProject.saveCurrentProject",cancelText:"general.no",confirmText:"general.yes"}).fired&&await tt();let r,o;const l=[".bridge"];if(await i.fileExists("import/manifest.json")){const f=await i.readJSON("import/manifest.json"),g=(p=f==null?void 0:f.modules)!=null?p:[];r||(r=(h=f==null?void 0:f.metadata)==null?void 0:h.authors),o||(o=(m=f==null?void 0:f.header)==null?void 0:m.description);const w=Da(g);if(!w)return;l.push(w);const y=Ot[w];await i.move("import",`projects/${a}/${y}`)}else new J({description:"fileDropper.mcaddon.missingManifests"});const d=xt.getDefaultOptions();d.name=a,d.author=r!=null?r:["Unknown"],d.description=o!=null?o:"",d.packs=l,d.targetVersion=await it(),await new $i().create(new Z(await i.getDirectoryHandle(`projects/${a}`,{create:!0})),d),await i.mkdir(`projects/${a}/.bridge/extensions`),await i.mkdir(`projects/${a}/.bridge/compiler`),A.value&&!t.hasNoProjects&&await t.projectManager.removeProject(t.project),await t.projectManager.addProject(await i.getDirectoryHandle(`projects/${a}`),!0),await i.unlink("import")}class Ly extends kt{constructor(e){super([".mcpack"],e)}async onImport(e){const t=await u.getApp();t.windows.loadingWindow.open();try{await Wy(e)}catch(i){console.error(i)}finally{t.windows.loadingWindow.close()}}}class Ny{constructor(e){new Py(e),new Dy(e),new My(e),new Oy(e),new Ry(e),new Ly(e)}}function By(){try{const s=new RegExp('(?<!\\\\)"');return'\\"'.match(s)===null}catch{return!1}}class Vy extends z{constructor(){super();c(this,"currentLanguage");c(this,"loadedFileType");c(this,"baseKeywords",["minecraft"]);c(this,"dynamicKeywords",[]);c(this,"typeIdentifiers",[]);c(this,"variables",[]);c(this,"definitions",[]);u.getApp().then(async t=>{await t.projectManager.projectReady.fired,t.projectManager.onActiveProject(i=>{this.updateKeywords(i.config),i.fileSave.on(i.config.resolvePackPath(void 0,"config.json"),()=>this.updateKeywords(i.config))})}),u.eventSystem.on("currentTabSwitched",t=>{this.loadWords(t)}),this.loadWords()}get keywords(){return this.baseKeywords.concat(this.dynamicKeywords)}get knownWords(){return{keywords:this.keywords,typeIdentifiers:this.typeIdentifiers,variables:this.variables,definitions:this.definitions}}async updateKeywords(t){await t.refreshConfig(),this.baseKeywords=[...new Set(["minecraft","bridge",t.get().namespace].filter(i=>i!==void 0))],this.updateHighlighter()}async loadWords(t){var l,d,p,h,m,f;const i=await u.getApp();await i.projectManager.projectReady.fired,await u.fileType.ready.fired;const n=t!=null?t:(l=i.project.tabSystem)==null?void 0:l.selectedTab;if(!(n instanceof ht)&&!(n instanceof Mt))return;const{id:a,highlighterConfiguration:r={},type:o}=(d=u.fileType.get(n.getPath()))!=null?d:{};if(!a)return this.resetWords();a===this.loadedFileType||o!==void 0&&o!=="json"||(this.dynamicKeywords=(p=r.keywords)!=null?p:[],this.typeIdentifiers=(h=r.typeIdentifiers)!=null?h:[],this.variables=(m=r.variables)!=null?m:[],this.definitions=(f=r.definitions)!=null?f:[],this.updateHighlighter(),this.dispatch(this.knownWords),this.loadedFileType=a)}resetWords(){this.dynamicKeywords=[],this.typeIdentifiers=[],this.variables=[],this.definitions=[],this.updateHighlighter(),this.dispatch(this.knownWords),this.loadedFileType="unknown"}async updateHighlighter(){var n;const{languages:t}=await I(),i=t.setMonarchTokensProvider("json",{defaultToken:"invalid",tokenPostfix:".json",atoms:["false","true","null"],keywords:this.keywords,typeIdentifiers:this.typeIdentifiers,variables:this.variables,definitions:this.definitions,symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/[a-z_$][\w$]*/,{cases:{"@atoms":"atom","@default":"identifier"}}],{include:"@whitespace"},[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/(@digits)/,"number"],[/[:,]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"\//,{token:"identifier",next:"@embeddedCommand",nextEmbedded:"mcfunction"}],[/"/,"identifier","@string"]],embeddedCommand:[[/@escapes/,"string.escape"],[By()?new RegExp('(?<!\\\\)"'):/"/,{token:"identifier",next:"@pop",nextEmbedded:"@pop"}]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*\*(?!\/)/,"comment.doc","@jsdoc"],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],jsdoc:[[/[^\/*]+/,"comment.doc"],[/\*\//,"comment.doc","@pop"],[/[\/*]/,"comment.doc"]],string:[[/(\\"|[^\"\:])+/,{cases:{"@keywords":"keyword","@variables":"variable","@typeIdentifiers":"type.identifier","@definitions":"definition","@default":"string"}}],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"identifier","@pop"]]}});(n=this.currentLanguage)==null||n.dispose(),this.currentLanguage=i,this.dispatch(this.knownWords)}}class Hy{constructor(){c(this,"highlighter",new Vy);this.setModeConfiguration(),df(),el()}getHighlighter(){return this.highlighter}async setModeConfiguration(){const{languages:e}=await I();e.json.jsonDefaults.setModeConfiguration({colors:!1,tokens:!1,completionItems:!0,diagnostics:!0,hovers:!0,documentFormattingEdits:!0,documentRangeFormattingEdits:!0,documentSymbols:!0,foldingRanges:!0,selectionRanges:!0})}}class Uy{constructor(){c(this,"state",F({}));c(this,"isAnyWindowVisible",F(!0));c(this,"watchStop",new Map)}addWindow(e,t){U(this.state.value,e,x(t)),this.watchStop.set(e,dt(t.getState(),()=>this.onWindowsChanged())),this.onWindowsChanged()}deleteWindow(e){Se(this.state.value,e);const t=this.watchStop.get(e);t&&t(),this.watchStop.delete(e),this.onWindowsChanged()}onWindowsChanged(){for(const e of Object.values(this.state.value))if(e.getState().isVisible){this.isAnyWindowVisible.value=!0;return}this.isAnyWindowVisible.value=!1}}class zy{constructor(e){c(this,"change",new z);c(this,"is",F(this.isCurrentDevice()));this.vuetify=e,dt(e.breakpoint,()=>{this.is.value=this.isCurrentDevice(),this.change.dispatch(e.breakpoint.mobile)}),u.getApp().then(()=>{setTimeout(()=>this.change.dispatch(e.breakpoint.mobile),10)})}isCurrentDevice(){var e,t;return(t=(e=this.vuetify)==null?void 0:e.breakpoint)==null?void 0:t.mobile}}const Jy={mixins:[G],props:{color:{default:"background",type:String}},setup(){return{isUsingFileSystemPolyfill:A}},async mounted(){const s=await u.getApp();this.disposables.push(s.windowResize.on(()=>this.calculateAvailableWidth())),this.calculateAvailableWidth()},destroyed(){this.disposables.forEach(s=>s.dispose()),this.disposables=[]},data:()=>({availableWidth:0,disposables:[]}),methods:{async createProject(){(await u.getApp()).windows.createProject.open()},calculateAvailableWidth(){this.$refs.button&&(this.availableWidth=this.$refs.button.$el.getBoundingClientRect().width)}}};var qy=function(){var e=this,t=e._self._c;return t("v-tooltip",{attrs:{disabled:e.availableWidth>220,color:e.color?e.color:"tooltip",right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("v-btn",e._g({ref:"button",staticClass:"mb-2",style:{overflow:"hidden"},attrs:{color:e.color,block:"","max-width":"100%"},on:{click:function(n){return n.stopPropagation(),e.createProject.apply(null,arguments)}}},i),[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-plus")]),e.availableWidth>220?t("span",[e._v(" "+e._s(e.t("packExplorer.noProjectView.createLocalProject"))+" ")]):e._e()],1)]}}])},[t("span",[e._v(" "+e._s(e.t("packExplorer.noProjectView.createLocalProject"))+" ")])])},Gy=[],Ky=_(Jy,qy,Gy,!1,null,null,null,null);const La=Ky.exports,Yy={mixins:[G],props:{color:{default:"primary",type:String}},setup(){return{isUsingFileSystemPolyfill:A}},async mounted(){const s=await u.getApp();this.hasDirectorySelected=await he("bridgeBaseDir")!==void 0,this.disposables.push(s.bridgeFolderSetup.once(()=>{this.isBridgeFolderSelected=!0},!0)),this.disposables.push(s.windowResize.on(()=>this.calculateAvailableWidth())),this.calculateAvailableWidth()},destroyed(){this.disposables.forEach(s=>s.dispose()),this.disposable=[]},data(){return{hasDirectorySelected:!1,isBridgeFolderSelected:!1,disposables:[],availableWidth:0}},methods:{async selectBridgeFolder(){await(await u.getApp()).setupBridgeFolder(this.isBridgeFolderSelected)},calculateAvailableWidth(){this.$refs.button&&(this.availableWidth=this.$refs.button.$el.getBoundingClientRect().width)}}};var Qy=function(){var e=this,t=e._self._c;return e.isUsingFileSystemPolyfill?e._e():t("v-tooltip",{attrs:{disabled:e.availableWidth>220,color:e.color?e.color:"tooltip",right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("v-btn",e._g({ref:"button",staticClass:"mb-2",style:{overflow:"hidden"},attrs:{color:e.color,block:"","max-width":"100%"},on:{click:e.selectBridgeFolder}},i),[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-folder-outline")]),e.availableWidth>220?t("span",[e._v(" "+e._s(e.t(`packExplorer.noProjectView.${e.hasDirectorySelected&&!e.isBridgeFolderSelected?"accessBridgeFolder":"chooseBridgeFolder"}`))+" ")]):e._e()],1)]}}],null,!1,2208143815)},[t("span",[e._v(" "+e._s(e.t(`packExplorer.noProjectView.${e.hasDirectorySelected&&!e.isBridgeFolderSelected?"accessBridgeFolder":"chooseBridgeFolder"}`))+" ")])])},Zy=[],Xy=_(Yy,Qy,Zy,!1,null,null,null,null);const Na=Xy.exports,ev={mixins:[G],components:{BridgeSheet:Oe,CreateProjectBtn:La,BridgeFolderBtn:Na,ActionViewer:bt},setup(){return{isUsingFileSystemPolyfill:A}},async mounted(){var e;this.hasComMojangSetup=await he(Ze)!==void 0,this.didChooseEditorType=(e=await he("didChooseEditorType"))!=null?e:!1,this.setupStepCount=Number(!this.hasComMojangSetup)+Number(!this.didChooseEditorType);const s=await u.getApp();this.disposables.push(s.comMojang.setup.once(()=>{console.log(this.hasComMojangSetup),this.hasComMojangSetup=!0},!0)),this.disposables.push(u.installApp.isInstallable.once(()=>this.showInstallAppButton=!0,!0)),this.disposables.push(u.installApp.isInstalled.once(()=>this.showInstallAppButton=!1,!0))},destroyed(){this.disposables.forEach(s=>s.dispose())},data(){return{hasComMojangSetup:!0,didChooseEditorType:!1,showInstallAppButton:!1,setupStepCount:0,disposables:[],actions:[new D({icon:"mdi-text",name:"initialSetup.step.editorType.rawText.name",description:"initialSetup.step.editorType.rawText.description",onTrigger:async()=>{this.isLoading||(this.isLoading=!0,await this.setJsonEditor("rawText"),this.$emit("next"))}}),new D({icon:"mdi-file-tree",name:"initialSetup.step.editorType.treeEditor.name",description:"initialSetup.step.editorType.treeEditor.description",onTrigger:async()=>{this.isLoading||(this.isLoading=!0,await this.setJsonEditor("treeEditor"),this.$emit("next"))}})]}},methods:{async setJsonEditor(s){await _e.loadSettings(u.instance),b.editor||(b.editor={}),b.editor.jsonEditor=s,await _e.saveSettings(u.instance),this.didChooseEditorType=!0,await ye("didChooseEditorType",!0)},installApp(){u.installApp.prompt()}}};var tv=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{overflow:"hidden"}},[t("BridgeFolderBtn"),t("CreateProjectBtn",{attrs:{color:"success"}}),t("BridgeSheet",{staticClass:"pa-2 mb-2 d-flex flex-column",attrs:{dark:""}},[t("v-icon",{staticClass:"mb-4",staticStyle:{"font-size":"3rem"},attrs:{color:"error"}},[e._v(" mdi-folder-open-outline ")]),e._v(" "+e._s(e.t("packExplorer.noProjectView.noProjectsFound"))+" ")],1),e.showInstallAppButton?t("BridgeSheet",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"pa-2 mb-2 d-flex flex-column clickable",attrs:{dark:""},nativeOn:{click:function(i){return e.installApp.apply(null,arguments)}}},[t("v-icon",{staticClass:"mb-4",staticStyle:{"font-size":"3rem"},attrs:{color:"primary"}},[e._v(" mdi-download ")]),e._v(" "+e._s(e.t("initialSetup.step.installApp.description"))+" ")],1):e._e(),!e.hasComMojangSetup&&!e.isUsingFileSystemPolyfill?t("BridgeSheet",{staticClass:"pa-2 mb-2 d-flex flex-column",attrs:{dark:""}},[t("v-icon",{staticClass:"mb-4",staticStyle:{"font-size":"3rem"},attrs:{color:"success"}},[e._v(" mdi-minecraft ")]),e._v(" "+e._s(e.t("initialSetup.step.comMojang.description"))+" ")],1):e.didChooseEditorType?e._e():t("div",[t("BridgeSheet",{staticClass:"pa-2 mb-2 d-flex flex-column",attrs:{dark:""}},[t("v-icon",{staticClass:"mb-4",staticStyle:{"font-size":"3rem"},attrs:{color:"success"}},[e._v(" mdi-pencil-outline ")]),e._v(" "+e._s(e.t("initialSetup.step.editorType.description"))+" ")],1),e._l(e.actions,function(i,n){return t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],key:n,staticClass:"clickable",attrs:{dark:"",action:i,hideTriggerButton:""},nativeOn:{click:function(a){return i.trigger()}}})})],2),!e.isUsingFileSystemPolyfill&&e.setupStepCount===2&&(!e.didChooseEditorType||!e.hasComMojangSetup)?t("div",{staticClass:"d-flex justify-center"},[t("span",[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary",small:""}},[e._v("mdi-cog")]),t("strong",[e._v("Setup Step:")]),e._v(" "+e._s(e.hasComMojangSetup?2:1)+" / 2 ")],1),t("v-spacer"),e.hasComMojangSetup?e._e():t("v-btn",{attrs:{icon:"",small:""},on:{click:function(i){e.hasComMojangSetup=!0}}},[t("v-icon",[e._v("mdi-chevron-right")])],1)],1):e._e()],1)},iv=[],nv=_(ev,tv,iv,!1,null,null,null,null);const sv=nv.exports,av={components:{BridgeSheet:Oe},props:{project:Object,isLoading:Boolean},async mounted(){const s=await u.getApp();this.disposables.push(s.windowResize.on(()=>this.calculateAvailableWidth())),this.calculateAvailableWidth()},destroyed(){this.disposables.forEach(s=>s.dispose()),this.disposables=[]},data:()=>({disposables:[],availableWidth:0}),computed:{miniLayout(){return this.availableWidth<100}},methods:{calculateAvailableWidth(){this.$refs.sheet&&(this.availableWidth=this.$refs.sheet.$el.getBoundingClientRect().width)},onClick(){this.$emit("click")}}};var rv=function(){var e=this,t=e._self._c;return t("div",{staticClass:"clickable"},[t("v-tooltip",{attrs:{color:"tooltip",right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("BridgeSheet",e._g({ref:"sheet",staticClass:"d-flex align-center justify-center mb-2",class:{"flex-column":e.miniLayout},style:{overflow:"hidden",height:e.miniLayout?void 0:"5rem",border:`2px solid ${e.project.isFavorite?"var(--v-primary-base)":"var(--v-background-base)"}`},attrs:{dark:"",isLoading:e.isLoading},on:{click:e.onClick}},i),[e.project.icon?t("img",{staticClass:"rounded-lg",style:{margin:e.miniLayout?"0.5rem":"0 0.5rem",maxWidth:e.miniLayout?"2rem":"4rem",minWidth:e.availableWidth>124?"4rem":"2rem","image-rendering":"pixelated"},attrs:{src:e.project.icon,alt:e.project.displayName}}):t("div",{staticClass:"d-flex justify-center"},[t("v-icon",{style:{"font-size":"4rem"},attrs:{color:"primary",size:"xl"}},[e._v(" mdi-alpha-"+e._s(e.project.displayName[0].toLowerCase())+"-box-outline ")])],1),e.miniLayout&&e.availableWidth>65||e.availableWidth>154?t("span",{staticClass:"px-2",style:{textAlign:"center",width:e.miniLayout?"100%":null,overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[e._v(" "+e._s(e.project.displayName)+" ")]):e._e(),t("v-spacer"),t("BridgeSheet",{staticClass:"px-1 d-flex align-center justify-center",style:{margin:e.miniLayout?"0.5rem":"0 0.5rem 0 0",height:"4rem",width:e.miniLayout?"calc(100% - 1rem)":null}},[e.project.requiresPermissions?e._e():t("v-icon",{attrs:{color:"accent"}},[e._v(" mdi-lock-open-outline ")]),t("v-btn",{attrs:{icon:"",small:"",color:e.project.isFavorite?"primary":null},on:{click:function(n){return n.stopPropagation(),e.$emit("pin")}}},[t("v-icon",[e._v(" mdi-pin"+e._s(e.project.isFavorite?"":"-outline")+" ")])],1)],1)],1)]}}])},[t("span",[e._v(" "+e._s(e.project.displayName)+" ")])])],1)},ov=[],cv=_(av,rv,ov,!1,null,null,null,null);const lv=cv.exports,dv={components:{CreateProjectBtn:La,BridgeFolderBtn:Na,SetupView:sv,Project:lv},setup(){return{isUsingFileSystemPolyfill:A}},mounted(){this.loadProjects(),this.disposable=u.eventSystem.on("availableProjectsFileChanged",()=>this.loadProjects())},destroyed(){this.disposable&&(this.disposable.dispose(),this.disposable=null)},data(){return{isLoading:!0,projectData:[],disposable:null}},methods:{async loadProjects(){this.isLoading=!0;const s=await u.getApp();this.projectData=await s.fileSystem.readJSON("~local/data/projects.json").catch(()=>[]),this.projectData=this.projectData.map(e=>{var t;return{...e,isFavorite:(t=e.isFavorite)!=null?t:!1,isLoading:!1}}),this.sortProjects(),this.isLoading=!1},sortProjects(){this.projectData=this.projectData.sort((s,e)=>s.isFavorite&&!e.isFavorite?-1:!s.isFavorite&&e.isFavorite?1:s.displayName.localeCompare(e.displayName))},async saveProjects(){await(await u.getApp()).fileSystem.writeJSON("~local/data/projects.json",this.projectData.map(e=>({...e,isLoading:void 0})))},async selectProject(s){s.isLoading=!0;const e=await u.getApp();if(s.requiresPermissions&&!await e.setupBridgeFolder()){s.isLoading=!1;return}await e.projectManager.selectProject(s.name,!0),s.isLoading=!1},async onFavoriteProject(s){s.isFavorite=!s.isFavorite,this.sortProjects(),await this.saveProjects()}}};var uv=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pa-2"},[e.isLoading?t("v-progress-linear",{attrs:{indeterminate:""}}):e.projectData.length===0?t("SetupView"):[t("BridgeFolderBtn"),t("CreateProjectBtn"),t("v-slide-y-transition",{staticClass:"py-0",attrs:{group:""}},e._l(e.projectData,function(i){return t("Project",{key:`${i.name}//${i.requiresPermissions}`,attrs:{project:i,isLoading:i.isLoading},on:{click:function(n){return e.selectProject(i)},pin:function(n){return e.onFavoriteProject(i)}}})}),1)]],2)},pv=[],hv=_(dv,uv,pv,!1,null,null,null,null);const mv=hv.exports,fv={props:{sidebarContent:Object},components:{HomeView:mv,DirectoryViewer:Fi}};var gv=function(){var e=this,t=e._self._c;return e.sidebarContent.showNoProjectView?t("HomeView"):e.sidebarContent.selectedAction?t("DirectoryViewer",{key:e.sidebarContent.selectedAction.config.id,attrs:{directoryHandle:e.sidebarContent.directoryEntries[e.sidebarContent.selectedAction.config.id]}}):e._e()},wv=[],yv=_(fv,gv,wv,!1,null,null,null,null);const vv=yv.exports;const bv="/img/icons/android-chrome-192x192.png",_v={props:{imgSrc:{type:String,default:bv},name:{type:String,default:"Unknown"}},methods:{async onClick(){const s=await u.getApp();A.value?Rn():s.windows.projectChooser.open()}}};var Sv=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"d-flex align-center pa-2 clickable",on:{click:e.onClick}},[t("img",{staticClass:"rounded-lg",staticStyle:{"image-rendering":"pixelated"},attrs:{src:e.imgSrc,draggable:"false",height:"44px",alt:`Pack Icon of ${e.name}`}}),t("h1",{staticClass:"project-display-header ml-2",staticStyle:{opacity:"0.7",display:"block",width:"calc(100% - 52px)","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}},[e._v(" "+e._s(e.name)+" ")])])},Cv=[],xv=_(_v,Sv,Cv,!1,null,"b02f4382",null,null);const Ba=xv.exports,kv={components:{ProjectDisplay:Ba},data:()=>({imgSrc:void 0,name:void 0}),mounted(){this.onProjectChanged(),u.eventSystem.on("projectChanged",this.onProjectChanged)},destroyed(){u.eventSystem.off("projectChanged",this.onProjectChanged)},methods:{async onProjectChanged(){const s=await u.getApp();await s.projectManager.projectReady.fired;const e=s.project,t=e.projectData;this.name=e.displayName,this.imgSrc=t.imgSrc}}};var Pv=function(){var e=this,t=e._self._c;return t("ProjectDisplay",{attrs:{imgSrc:e.imgSrc,name:e.name}})},jv=[],Fv=_(kv,Pv,jv,!1,null,null,null,null);const Tv=Fv.exports;async function fs(s=!1){var h,m,f,g,w;const e=await u.getApp(),t=e.project,i=t.fileSystem;e.windows.loadingWindow.open();const n=await e.project.createDashService("production");await n.setup(),await n.build();let a=[];t.hasPacks(["worldTemplate"])&&a.push("WT"),await i.directoryExists("worlds")&&a.push(...(await i.readdir("worlds")).map(y=>`worlds/${y}`));let r;if(a.length===0){e.windows.loadingWindow.close();return}else a.length===1?r=a[0]:r=await new et({default:a[0],name:"packExplorer.exportAsMctemplate.chooseWorld",options:a}).fired;await i.mkdir("builds/mctemplate/behavior_packs",{recursive:!0}),await i.mkdir("builds/mctemplate/resource_packs",{recursive:!0});const o=await i.readdir("builds/dist"),l=Object.fromEntries(Object.entries({BP:o.find(y=>y.endsWith("BP")),RP:o.find(y=>y.endsWith("RP")),WT:o.find(y=>y.endsWith("WT"))}).map(([y,S])=>[y,`builds/dist/${S}`]));if(r==="WT"?await i.move(l.WT,"builds/mctemplate"):await i.copyFolder(r,"builds/mctemplate"),l.BP){const y=await i.readJSON(`${l.BP}/manifest.json`).catch(()=>null);y!==null&&((h=y==null?void 0:y.header)==null?void 0:h.uuid)&&((m=y==null?void 0:y.header)==null?void 0:m.version)&&await i.writeJSON("builds/mctemplate/world_behavior_packs.json",[{pack_id:y.header.uuid,version:y.header.version}])}if(l.RP){const y=await i.readJSON(`${l.RP}/manifest.json`).catch(()=>null);y!==null&&((f=y==null?void 0:y.header)==null?void 0:f.uuid)&&((g=y==null?void 0:y.header)==null?void 0:g.version)&&await i.writeJSON("builds/mctemplate/world_resource_packs.json",[{pack_id:y.header.uuid,version:y.header.version}])}l.BP&&await i.move(l.BP,`builds/mctemplate/behavior_packs/BP_${e.project.name}`),l.RP&&await i.move(l.RP,`builds/mctemplate/resource_packs/RP_${e.project.name}`),!await i.fileExists("builds/mctemplate/manifest.json")&&!s?await i.writeJSON("builds/mctemplate/manifest.json",{format_version:2,header:{name:"pack.name",description:"pack.description",version:[1,0,0],uuid:E(),lock_template_options:!0,base_game_version:((w=e.project.config.get().targetVersion)!=null?w:await it()).split(".").map(y=>Number(y))},modules:[{type:"world_template",version:[1,0,0],uuid:E()}]}):s&&r==="WT"&&await i.unlink("builds/mctemplate/manifest.json");const d=new ji(await e.project.fileSystem.getDirectoryHandle("builds/mctemplate",{create:!0})),p=`${e.project.projectPath}/builds/${e.project.name}.${s?"mcworld":"mctemplate"}`;try{await yi(p,await d.package(),e.fileSystem)}catch(y){console.error(y)}await i.unlink("builds/mctemplate"),t.app.windows.loadingWindow.close()}async function gs(){const s=await u.getApp();return s.project.hasPacks(["worldTemplate"])||await s.project.fileSystem.directoryExists("worlds")&&(await s.project.fileSystem.readdir("worlds")).length>0}const Av=async s=>{if(!s.path)return null;const e=await u.getApp(),t=e.project.packIndexer,i=ws(t.hasFired?await t.service.getConnectedFiles(s.path):[]),n=e.project.compilerReady.hasFired?await e.project.compilerService.getFileDependencies(s.path):[],a=[Ki(s.path,!1,!1)].concat(ws(n));return i.length===0&&a.length===1?Ki(s.path):{type:"submenu",icon:"mdi-spider-web",name:"actions.viewConnectedFiles.name",description:"actions.viewConnectedFiles.description",actions:[...a,i.length>0?{type:"divider"}:null,...i]}};function ws(s){return s.map(e=>{var n;const t=u.fileType.get(e),i=u.packType.get(e);return{icon:(n=t==null?void 0:t.icon)!=null?n:"mdi-file-outline",color:i==null?void 0:i.color,name:`[${fe(e)}]`,description:t?`fileType.${t.id}`:void 0,onTrigger:async()=>{const a=await u.getApp();await a.project.openFile(await a.fileSystem.getFileHandle(e))}}})}const $v=s=>({name:"packExplorer.move.toLocal",icon:"mdi-lock-open-outline",onTrigger:async()=>{s.switchProjectType()}}),Ev=s=>({name:"packExplorer.move.toBridgeFolder",icon:"mdi-folder-sync-outline",onTrigger:async()=>{let e=s.app.bridgeFolderSetup.hasFired;e||(e=await s.app.setupBridgeFolder()),e&&s.switchProjectType()}});class Dv extends Nt{constructor(){super();c(this,"component",x(vv));c(this,"actions",[]);c(this,"directoryEntries",{});c(this,"topPanel");c(this,"showNoProjectView",!1);c(this,"headerHeight","60px");u.eventSystem.on("projectChanged",()=>this.setup()),u.eventSystem.on("fileAdded",()=>this.refresh());const t=async()=>{const i=await u.getApp();await i.projectManager.projectReady.fired,i.mobile.isCurrentDevice()||i.isNoProjectSelected?this.headerSlot=void 0:this.headerSlot=Tv};u.getApp().then(i=>{t(),i.mobile.change.on(()=>t())}),u.eventSystem.on("projectChanged",()=>{t()})}async setup(){var i;const t=await u.getApp();if(await t.projectManager.projectReady.fired,this.actions=[],t.isNoProjectSelected){this.showNoProjectView=!0;return}else this.showNoProjectView=!1;this.unselectAllActions(),this.actions=[];for(const n of(i=t.project.projectData.contains)!=null?i:[]){const a=await t.fileSystem.getDirectoryHandle(n.packPath).catch(()=>null);if(!a)continue;const r=x(new Fe(null,a,{startPath:n.packPath,provideFileContextMenu:async o=>[await Av(o)],provideFileDiagnostics:async o=>{const l=t.project.packIndexer;await l.fired;const d=o.path;return d?l.service.getFileDiagnostics(d):[]},onHandleMoved:o=>this.onHandleMoved(o),onFilesAdded:o=>this.onFilesAdded(o)}));await r.open(),U(this.directoryEntries,n.packPath,r),this.actions.push(new ft(this,{id:n.packPath,name:`packType.${n.id}.name`,icon:n.icon,color:n.color}))}A.value&&this.actions.push(new mt({icon:"mdi-content-save-outline",name:"general.save",onTrigger:()=>tt()})),this.actions.push(new mt({icon:"mdi-dots-vertical",name:"general.more",onTrigger:n=>{this.showMoreMenu(n)}}))}async onHandleMoved({fromPath:t,toPath:i,movedHandle:n}){const a=await u.getApp();n.kind==="file"?await a.project.onMovedFile(t,i):await a.project.onMovedFolder(t,i)}async onFilesAdded(t){await(await u.getApp()).project.updateFiles(t)}onContentRightClick(t){var n;const i=(n=this.selectedAction)==null?void 0:n.getConfig().id;!i||jn(t,this.directoryEntries[i],{hideDelete:!0,hideRename:!0,hideDuplicate:!0})}async refresh(){await Promise.all(Object.values(this.directoryEntries).map(t=>t.refresh()))}async getContextMenu(t,i){if(t==="virtualFolder")return[];const a=(await u.getApp()).project;return[{icon:"mdi-file-search-outline",name:"actions.findInFolder.name",description:"actions.findInFolder.description",onTrigger:()=>{var r;(r=a.tabSystem)==null||r.add(new Pn(a.tabSystem,void 0,{searchType:It.matchCase}))}}]}async showMoreMenu(t){const i=await u.getApp(),n=i.project.isLocal?Ev(i.project):$v(i.project);De(t,[{icon:"mdi-plus",name:"packExplorer.createPreset",onTrigger:async()=>{await i.windows.createPreset.open()}},A.value?null:n,{type:"divider"},{icon:"mdi-refresh",name:"packExplorer.refresh.name",onTrigger:async()=>{i.actionManager.trigger("bridge.action.refreshProject")}},Ra(!1),{type:"divider"},{type:"submenu",icon:"mdi-export",name:"packExplorer.exportAs.name",actions:[{icon:"mdi-folder-zip-outline",name:"packExplorer.exportAs.brproject",onTrigger:()=>tt()},{icon:"mdi-minecraft",name:"packExplorer.exportAs.mcaddon",onTrigger:()=>Ma()},{icon:"mdi-earth-box",name:"packExplorer.exportAs.mcworld",isDisabled:!await gs(),onTrigger:()=>fs(!0)},{icon:"mdi-earth-box-plus",name:"packExplorer.exportAs.mctemplate",isDisabled:!await gs(),onTrigger:()=>fs()},...await i.project.exportProvider.getExporters()]},{type:"divider"},{icon:"mdi-cog-outline",name:"packExplorer.projectConfig.name",onTrigger:async()=>{var r;const a=i.project;if(!await a.fileSystem.fileExists("config.json")){new J({description:"packExplorer.projectConfig.missing"});return}await((r=a.tabSystem)==null?void 0:r.openPath(`${a.projectPath}/config.json`))}},{icon:"mdi-folder-open-outline",name:"packExplorer.openProjectFolder.name",onTrigger:async()=>{i.viewFolders.addDirectoryHandle({directoryHandle:i.project.baseDirectory,startPath:i.project.projectPath,onHandleMoved:a=>this.onHandleMoved(a),onFilesAdded:a=>this.onFilesAdded(a)})}}])}}class Mv{constructor(){c(this,"folderHandler",new Set);this.addImporter({icon:"mdi-minecraft",name:"fileDropper.importMethod.folder.output.name",description:"fileDropper.importMethod.folder.output.description",onSelect:async e=>{await(await u.getApp()).comMojang.handleComMojangDrop(e)}}),this.addImporter({icon:"mdi-folder-open-outline",name:"fileDropper.importMethod.folder.open.name",description:"fileDropper.importMethod.folder.open.description",onSelect:async e=>{const t=await u.getApp();try{await e.requestPermission({mode:"readwrite"})}catch{return}t.viewFolders.addDirectoryHandle({directoryHandle:e})}})}addImporter(e){return this.folderHandler.add(e),{dispose:()=>{this.folderHandler.delete(e)}}}async onImportFolder(e){const t=new Wt("fileDropper.importMethod.name",{isPersistent:!1}),i=await t.actionManager;this.folderHandler.forEach(({onSelect:n,...a})=>i.create({...a,onTrigger:()=>n(e)})),t.open(),await t.fired}}const Iv={type:"raw",name:"openFileUrl",onTrigger:async s=>{const e=await fetch(s).catch(()=>null);if(!e)return;const t=new ae(null,fe(s),new Uint8Array(await e.arrayBuffer()),!0),i=await u.getApp();await i.projectManager.projectReady.fired,await i.fileDropper.importFile(t)}},Ov={type:"raw",name:"setSidebarState",onTrigger:async s=>{s==="hidden"&&(u.sidebar.toggleSidebarContent(null),u.sidebar.forcedInitialState.value=!0)}},Rv={type:"encoded",name:"viewExtension",onTrigger:async s=>{(await u.getApp()).windows.extensionStore.open(s)}};class Wv{constructor(e=[]){c(this,"startActions",new Map);e.forEach(t=>this.addStartAction(t)),this.addStartAction(_c),this.addStartAction(Iv),this.addStartAction(Ov),this.addStartAction(Rv),this.parseRaw(window.location.search)}async parse(e){const t=e.split("?")[1];!t||await this.parseRaw(t)}async parseRaw(e){const t=new URLSearchParams(e);[...t.keys()].length!==0&&t.forEach(async(i,n)=>{const a=this.startActions.get(n);if(!a)return;let r;if(a.type==="compressed"){const o=atob(i);if(!o.startsWith("x\xDA")){const{decompressFromEncodedURIComponent:l}=await ue(()=>import("./lz-string.c3c0ce2d.js").then(p=>p.l),[]),d=l(i);if(!d)return;r=d}r=Qi(Br(_s(o,!0)))}else if(a.type==="encoded")r=decodeURIComponent(i);else if(a.type==="raw")r=i;else throw new Error(`Unknown start action type: "${a.type}"`);a.onTrigger(r)})}addStartAction(e){return this.startActions.set(e.name,e),{dispose:()=>this.startActions.delete(e.name)}}}async function Va(s,e=s.name){e===""&&(e="~local");const t=[];for await(const i of s.values())i.kind==="file"&&i.name!==".DS_Store"?t.push({handle:i,path:`${e}/${i.name}`}):i.kind==="directory"&&t.push(...await Va(i,`${e}/${i.name}`));return t}async function Ha(s,e){const t=await Va(s);let i=[];for(const n of t){const a=new D({icon:"mdi-file-outline",color:e,name:`[${n.path}]`,description:"actions.openFile.name",onTrigger:async()=>{(await u.getApp()).project.openFile(n.handle)}});i.push(cc(a))}return{dispose:()=>{i.forEach(n=>n.dispose()),i=[]}}}const Lv={props:{sidebarContent:Object},components:{DirectoryViewer:Fi}};var Nv=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-1"},e._l(e.sidebarContent.directoryHandles,function({directoryHandle:i,...n},a){return t("DirectoryViewer",{key:a,staticClass:"mb-2",attrs:{directoryHandle:i,renderTopLevelDirectory:!0,options:n}})}),1)},Bv=[],Vv=_(Lv,Nv,Bv,!1,null,null,null,null);const Hv=Vv.exports;class Uv extends Nt{constructor(){super();c(this,"component",Hv);c(this,"actions",[]);c(this,"topPanel");c(this,"directoryHandles",[]);c(this,"sidebarElement");c(this,"closeAction",new mt({icon:"mdi-close",name:"general.close",color:"error",onTrigger:async()=>{this.directoryHandles.forEach(t=>{var i;return(i=t.onDispose)==null?void 0:i.call(t)}),this.directoryHandles=[],this.updateVisibility()}}));this.actions=[this.closeAction],this.sidebarElement=x(new bn({id:"viewOpenedFolders",group:"packExplorer",sidebarContent:this,displayName:"sidebar.openedFolders.name",icon:"mdi-folder-open-outline",isVisible:()=>this.directoryHandles.length>0}))}async updateVisibility(){if(this.directoryHandles.length>0)return;(await u.getApp()).viewComMojangProject.hasComMojangProjectLoaded?u.sidebar.elements.viewComMojangProject.select():u.sidebar.elements.packExplorer.select()}async addDirectoryHandle({directoryHandle:t,...i}){if(await this.hasDirectoryHandle(t))return;const n={directoryHandle:t,...i,provideDirectoryContextMenu:a=>[a.getParent()===null?{name:"sidebar.openedFolders.removeFolder",icon:"mdi-eye-off-outline",onTrigger:async()=>{await this.removeDirectoryHandle(a.handle),await this.updateVisibility()}}:null],isDisposed:!1,disposable:null,onDispose(){var a;(a=this.disposable)==null||a.dispose(),this.isDisposed=!0}};Ha(n.directoryHandle).then(a=>{n.isDisposed?a.dispose():n.disposable=a}),this.directoryHandles.push(n),this.sidebarElement.isSelected||this.sidebarElement.select()}async removeDirectoryHandle(t){var i;for(let n=0;n<this.directoryHandles.length;n++){const a=this.directoryHandles[n];if(await a.directoryHandle.isSameEntry(t)){this.directoryHandles.splice(n,1),(i=a.onDispose)==null||i.call(a);return}}throw new Error("directoryHandle to remove not found")}async hasDirectoryHandle(t){for(const{directoryHandle:i}of this.directoryHandles)if(await xn(i,t))return!0;return!1}}class zv{constructor(){c(this,"elements",q({}));c(this,"isNavigationVisible",F(!0));c(this,"currentState",F(null));c(this,"isContentVisible",B(()=>this.currentState.value!==null));c(this,"forcedInitialState",F(!1));c(this,"groupOrder",["projectChooser","packExplorer"]);c(this,"sortedElements",F([]))}updateSortedElements(){this.sortedElements.value=Object.values(this.elements).sort((e,t)=>!e.group&&!t.group?0:e.group?t.group?this.groupOrder.indexOf(e.group)-this.groupOrder.indexOf(t.group):-1:1)}addSidebarElement(e,t){return U(this.elements,e,t),this.updateSortedElements(),{dispose:()=>{Se(this.elements,e),this.updateSortedElements()}}}toggleSidebarContent(e){if(e===null){this.hideSidebarContent();return}e===this.currentState.value?this.hideSidebarContent(!1):(this.currentState.value=e,this.isNavigationVisible.value||(this.isNavigationVisible.value=!0)),u.getApp().then(t=>t.windowResize.dispatch())}async hideSidebarContent(e=!0){(await u.getApp()).mobile.isCurrentDevice()?e&&(this.isNavigationVisible.value=!1):this.currentState.value=null}selectSidebarContent(e){this.currentState.value=e,u.getApp().then(t=>t.windowResize.dispatch())}hide(){this.isNavigationVisible.value=!1,u.getApp().then(e=>e.windowResize.dispatch())}}const Jv={props:{sidebarContent:Object},components:{DirectoryViewer:Fi}};var qv=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-1"},[e.sidebarContent.selectedAction?t("DirectoryViewer",{key:e.sidebarContent.selectedAction.config.id,staticClass:"mb-2",attrs:{directoryHandle:e.sidebarContent.directoryEntries[e.sidebarContent.selectedAction.config.id],options:{defaultIconColor:e.sidebarContent.selectedAction.config.color}}}):e._e()],1)},Gv=[],Kv=_(Jv,qv,Gv,!1,null,null,null,null);const Yv=Kv.exports,Qv={components:{ProjectDisplay:Ba},data:()=>({imgSrc:void 0,name:void 0}),async mounted(){const s=await u.getApp(),{projectIcon:e,projectName:t}=s.viewComMojangProject;this.name=t,this.imgSrc=e}};var Zv=function(){var e=this,t=e._self._c;return t("ProjectDisplay",{attrs:{imgSrc:e.imgSrc,name:e.name}})},Xv=[],eb=_(Qv,Zv,Xv,!1,null,null,null,null);const tb=eb.exports;class ib extends Nt{constructor(){super();c(this,"component",Yv);c(this,"actions",[]);c(this,"topPanel");c(this,"headerHeight","60px");c(this,"hasComMojangProjectLoaded",!1);c(this,"projectIcon");c(this,"projectName");c(this,"disposables",[]);c(this,"sidebarElement");c(this,"directoryEntries",{});c(this,"closeAction",new mt({icon:"mdi-close",name:"general.close",color:"error",onTrigger:()=>{this.clearComMojangProject()}}));this.actions=[this.closeAction],this.sidebarElement=x(new bn({id:"viewComMojangProject",group:"packExplorer",sidebarContent:this,displayName:"packExplorer.name",icon:"mdi-folder-outline",isVisible:()=>this.hasComMojangProjectLoaded}))}async loadComMojangProject(t){var n,a;const i=await u.getApp();this.hasComMojangProjectLoaded=!0,this.actions=[this.closeAction];for(const r of t.packs.reverse()){const o=u.packType.getFromId(r.type);if(!o)continue;const l=new ft(this,{icon:o.icon,name:`packType.${r.type}.name`,color:o.color,id:r.type});this.actions.unshift(l);const d=new Fe(null,r.directoryHandle,{startPath:r.packPath,defaultIconColor:o.color});await d.open(),Ha(d.handle,o.color).then(p=>{this.hasComMojangProjectLoaded?this.disposables.push(p):p.dispose()}),this.directoryEntries[r.type]=x(d),r.type==="behaviorPack"&&l.select()}this.projectName=t.name,this.projectIcon=(a=(n=t.packs.find(r=>r.type==="behaviorPack"))==null?void 0:n.packIcon)!=null?a:void 0,i.projectManager.title.setProject(this.projectName),this.headerSlot=tb,this.sidebarElement.select()}async clearComMojangProject(){const t=await u.getApp();this.headerSlot=void 0,this.hasComMojangProjectLoaded=!1,this.actions=[this.closeAction],this.directoryEntries={},t.projectManager.title.setProject(""),u.sidebar.elements.packExplorer.select(),this.disposables.forEach(i=>i.dispose()),this.disposables=[]}onContentRightClick(t){var n;const i=(n=this.selectedAction)==null?void 0:n.getConfig().id;!i||jn(t,this.directoryEntries[i],{hideDelete:!0,hideRename:!0,hideDuplicate:!0})}}const Ye=class{constructor(e){c(this,"viewFolders",new Uv);c(this,"viewComMojangProject",new ib);c(this,"packExplorer",new Dv);c(this,"keyBindingManager",new qs);c(this,"actionManager",new Rt(this.keyBindingManager));c(this,"themeManager");c(this,"taskManager",new _g);c(this,"dataLoader",x(new gy(!0)));c(this,"fileSystem",new Z);c(this,"projectManager",new Sy(this));c(this,"extensionLoader",new xy(this));c(this,"windowResize",new yy);c(this,"contextMenu",x(new Cy));c(this,"fileDropper",new ky(this));c(this,"fileImportManager",new Ny(this.fileDropper));c(this,"folderImportManager",new Mv);c(this,"comMojang",new rc(this));c(this,"configuredJsonLanguage",x(new Hy));c(this,"mobile");c(this,"languageManager",x(new _f));c(this,"startParams",new Wv);c(this,"_windows");c(this,"bridgeFolderSetup",new $);this.dataLoader.loadData(),this.themeManager=new jf(e.$vuetify),this._windows=new my(this),this.mobile=new zy(e.$vuetify);const t="Are you sure that you want to close bridge.? Unsaved progress will be lost.";window.addEventListener("beforeunload",i=>{var n;if(((n=this.tabSystem)==null?void 0:n.hasUnsavedTabs)||this.taskManager.hasRunningTasks||A.value)return i.preventDefault(),i.returnValue=t,t})}get windows(){return this._windows}get tabSystem(){var e;return(e=this.projectManager.currentProject)==null?void 0:e.tabSystem}get selectedProject(){return this.projectManager.selectedProject}get isNoProjectSelected(){return this.projectManager.currentProject===null||this.projectManager.currentProject.isVirtualProject}get hasNoProjects(){return this.isNoProjectSelected&&this.projectManager.totalProjects<=1}get project(){if(!this.projectManager.currentProject)throw new Error("Trying to access project before it is defined. Make sure to await app.projectManager.projectReady.fired");return this.projectManager.currentProject}get projects(){return Object.values(this.projectManager.state).filter(e=>!e.isVirtualProject)}get projectConfig(){try{return this.project.config}catch{throw new Error("Trying to access projectConfig before project is defined. Make sure to await app.projectManager.projectReady.fired")}}static get instance(){return this._instance}static getApp(){return new Promise(e=>Ye.ready.once(t=>e(t)))}static openUrl(e,t,i=!1){var n;return((n=b==null?void 0:b.general)==null?void 0:n.openLinksInBrowser)||i?window.open(e,"_blank"):window.open(e,t,"toolbar=no,menubar=no,status=no")}static async main(e){console.time("[APP] Ready"),this._instance=x(new Ye(e)),this.instance.windows.loadingWindow.open(),await this.instance.beforeStartUp(),this.instance.fileSystem.setup(await Bi()),await he("firstStartAfterUpdate")&&(await ye("firstStartAfterUpdate",!1),this.instance.windows.changelogWindow.open());const t=_e.loadSettings(this.instance);await t,t.then(async()=>{await this.instance.dataLoader.fired,this.instance.themeManager.loadDefaultThemes(this.instance)}),await this.instance.startUp(),this.ready.dispatch(this.instance),await this.instance.projectManager.selectLastProject(),this.instance.windows.loadingWindow.close(),console.timeEnd("[APP] Ready")}async beforeStartUp(){console.log(`--- Running bridge. ${de} on a "${H()}" machine ---`),console.time("[APP] beforeStartUp()"),navigator.clearAppBadge&&navigator.clearAppBadge(),vg(),Fg(this);{const e=new Gt({id:"bridge-social-links",icon:"mdi-link-variant",message:"sidebar.notifications.socials.message",color:"#1DA1F2",textColor:"white",onClick:()=>{this.windows.socialsWindow.open(),e.dispose()}}),t=new Gt({id:"bridge-getting-started",icon:"mdi-help-circle-outline",message:"sidebar.notifications.gettingStarted.message",onClick:()=>{Ye.openUrl("https://bridge-core.github.io/editor-docs/getting-started/"),t.dispose()}})}if(A.value){const e=new Gt({id:"bridge-save-warning",icon:"mdi-alert-circle-outline",message:"general.fileSystemPolyfill.name",color:"warning",textColor:"white",onClick:()=>{new J({title:"general.fileSystemPolyfill.name",description:"general.fileSystemPolyfill.description"}),e.dispose()}})}console.timeEnd("[APP] beforeStartUp()")}async startUp(){console.time("[APP] startUp()"),await Promise.all([this.fileSystem.mkdir("projects"),this.fileSystem.mkdir("extensions"),this.fileSystem.mkdir("data"),Ye.fileType.setup(this.dataLoader),Ye.packType.setup(this.dataLoader)]),this.projectManager.projectReady.fired.then(async()=>{this.extensionLoader.loadExtensions()}),console.timeEnd("[APP] startUp()")}async setupBridgeFolder(e=!1){if(!e&&this.bridgeFolderSetup.hasFired)return!0;let t=await he("bridgeBaseDir");if(t&&!e){if(await t.requestPermission({mode:"readwrite"})!=="granted")return!1}else{try{t=await window.showDirectoryPicker({mode:"readwrite"})}catch{return!1}await ye("bridgeBaseDir",t)}return this.fileSystem.setup(t),await this.fileSystem.fileExists("data/settings.json")&&(await this.fileSystem.copyFile("data/settings.json","~local/data/settings.json"),await this.fileSystem.unlink("data/settings.json"),await _e.loadSettings(this).then(async()=>{this.themeManager.loadDefaultThemes(this)})),this.bridgeFolderSetup.dispatch(),await this.projectManager.loadProjects(!0),!0}};let u=Ye;c(u,"windowState",new Uy),c(u,"installApp",new vy),c(u,"fileSystemSetup",new Qt),c(u,"toolbar",new wy),c(u,"eventSystem",new ga(["projectChanged","currentTabSwitched","refreshCurrentContext","disableValidation","fileAdded","fileChange","fileSave","fileUnlinked","presetsChanged","availableProjectsFileChanged"])),c(u,"ready",new $),c(u,"_instance"),c(u,"fileType",x(new wa)),c(u,"packType",x(new Tg)),c(u,"sidebar",new zv);const nb={name:"SidebarButton",props:{displayName:String,icon:String,iconColor:String,color:String,disabled:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},alwaysAllowClick:{type:Boolean,default:!1},opacity:{type:Number,default:1},badge:Object},setup(){const{t:s}=O();return{t:s}},data:()=>({settingsState:b,hasClicked:!1}),computed:{isSidebarRight(){return this.settingsState&&this.settingsState.sidebar&&this.settingsState.sidebar.isSidebarRight},smallerSidebarElements(){return this.settingsState&&this.settingsState.sidebar&&this.settingsState.sidebar.smallerSidebarElements},computedColor(){return this.color?this.color.startsWith("#")?this.color:`var(--v-${this.color}-base)`:this.isLoading||this.isSelected?"var(--v-primary-base)":"var(--v-sidebarSelection-base)"},canInteractWith(){return!this.disabled&&(this.alwaysAllowClick||!this.isLoading)}},methods:{onClick(s){this.disabled||(this.alwaysAllowClick||!this.isLoading)&&(this.$emit("click",s),this.hasClicked=!0,this.$nextTick(()=>this.hasClicked=!1))},onMiddleClick(){(this.alwaysAllowClick||!this.isLoading)&&(this.$emit("middleClick"),this.hasClicked=!0,this.$nextTick(()=>this.hasClicked=!1))}}};var sb=function(){var e=this,t=e._self._c;return t("v-tooltip",{attrs:{color:e.color?e.color:"tooltip",disabled:e.hasClicked||e.isSelected,right:!e.isSidebarRight,left:e.isSidebarRight},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("div",e._g({directives:[{name:"ripple",rawName:"v-ripple",value:e.canInteractWith,expression:"canInteractWith"}],staticClass:"rounded-lg ma-2 d-flex justify-center sidebar-button",class:{loading:e.isLoading,"pa-1":e.smallerSidebarElements,"pa-2":!e.smallerSidebarElements,"elevation-4":e.isSelected},style:{"background-color":e.computedColor,position:"relative",transform:e.isSelected?"scale(1.1)":void 0,cursor:e.canInteractWith?"pointer":void 0,height:e.smallerSidebarElements?"34px":"40px"},on:{click:e.onClick,mouseup:function(n){return"button"in n&&n.button!==1?null:e.onMiddleClick.apply(null,arguments)}}},i),[t("v-badge",{style:{position:e.isLoading?"absolute":"relative",marginTop:e.isLoading?"3px":0,marginLeft:e.isLoading?"1px":0},attrs:{value:e.badge&&!e.isLoading?e.badge.count:0,content:e.badge&&!e.badge.icon?e.badge.count:0,color:e.badge?e.badge.color:null,icon:e.badge?e.badge.icon:null,dot:e.badge&&e.badge.dot,overlap:"",bordered:""}},[t("v-icon",{style:{opacity:e.disabled?.4:void 0},attrs:{color:e.isLoading||e.isSelected?"white":e.iconColor,small:e.isLoading}},[e._v(" "+e._s(e.icon)+" ")])],1),e.isLoading?e._t("default",function(){return[t("v-progress-circular",{attrs:{size:"24",width:"2",color:"white",indeterminate:""}})]}):e._e()],2)]}}],null,!0)},[t("span",[e._v(e._s(e.t(e.displayName)))])])},ab=[],rb=_(nb,sb,ab,!1,null,"3e242799",null,null);const ob=rb.exports,Ua={data:()=>({windowControlsOverlay:navigator.windowControlsOverlay&&navigator.windowControlsOverlay.visible}),created(){navigator.windowControlsOverlay&&navigator.windowControlsOverlay.addEventListener("geometrychange",s=>{this.windowControlsOverlay=s.visible})}},Vt={mixins:[Ua],computed:{appToolbarHeight(){return ct.value?"0px":`env(titlebar-area-height, ${this.$vuetify.breakpoint.mobile?0:24}px)`},appToolbarHeightNumber(){return ct.value?0:this.windowControlsOverlay?33:this.$vuetify.breakpoint.mobile?0:24}}},cb={name:"Sidebar",mixins:[Vt],props:{app:Boolean},components:{SidebarButton:ob,BridgeLogo:an},setup(){return{rawSidebarElements:u.sidebar.sortedElements,rawIsNavigationVisible:u.sidebar.isNavigationVisible,appVersion:de}},data(){return{settingsState:b,tasks:jt,NotificationStore:Qe}},computed:{isMobile(){return this.$vuetify.breakpoint.mobile},isNavigationVisible:{get(){return!this.isMobile||u.sidebar.isNavigationVisible.value},set(s){u.sidebar.isNavigationVisible.value=s}},sidebarElements(){return this.rawSidebarElements.filter(s=>s.isVisible)},hasVisibleNotifications(){return Object.values(this.NotificationStore).some(({isVisible:s})=>s)},isSidebarRight(){return this.settingsState&&this.settingsState.sidebar&&this.settingsState.sidebar.isSidebarRight}},methods:{closeSidebar(){u.sidebar.isNavigationVisible.value=!1},showMobileMenu(s){u.toolbar.showMobileMenu(s)},async openChangelogWindow(){await(await u.getApp()).windows.changelogWindow.open()}}};var lb=function(){var e=this,t=e._self._c;return t("v-navigation-drawer",{staticClass:"my-2",class:{"rounded-r-lg":!e.isSidebarRight,"rounded-l-lg":e.isSidebarRight},style:{maxHeight:`calc(100% - ${e.appToolbarHeight} - 16px)`,top:e.appToolbarHeight},attrs:{"mini-variant":"","mini-variant-width":"60",stateless:"",app:e.app,absolute:"",floating:"",right:e.isSidebarRight,color:"sidebarNavigation",height:`calc(100% - ${e.appToolbarHeight})`},model:{value:e.isNavigationVisible,callback:function(i){e.isNavigationVisible=i},expression:"isNavigationVisible"}},[e.isMobile?[t("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"d-flex align-center justify-center mt-3 mb-2 mx-1 rounded-lg"},[t("BridgeLogo",{attrs:{height:32},nativeOn:{click:function(i){return e.openChangelogWindow.apply(null,arguments)}}})],1),t("SidebarButton",{attrs:{displayName:"general.close",icon:"mdi-close",color:"error"},on:{click:e.closeSidebar}}),t("SidebarButton",{attrs:{displayName:"actions.name",icon:"mdi-menu"},on:{click:e.showMobileMenu}})]:e._e(),t("v-list",e._l(e.sidebarElements,function(i,n){return t("SidebarButton",{key:`${i.uuid}//${n}`,attrs:{displayName:i.displayName,icon:i.icon,isLoading:i.isLoading,isSelected:i.isSelected,badge:i.badge,disabled:i.isDisabled},on:{click:function(a){return i.click()}}})}),1),e.hasVisibleNotifications?t("v-list",[t("v-divider",{staticClass:"mx-3 mb-6"}),e._l(e.NotificationStore,function(i){return[i.isVisible?t("SidebarButton",{key:i.id,attrs:{displayName:i.message,icon:i.icon,color:i.color,iconColor:i.textColor},on:{click:function(n){return i.onClick()},middleClick:function(n){return i.onMiddleClick()}}}):e._e()]})],2):e._e(),e.tasks.length>0?t("v-list",[t("v-divider",{staticClass:"mx-3 mb-6"}),e._l(e.tasks,function(i,n){return t("SidebarButton",{key:`${n}`,attrs:{displayName:i.name,icon:i.icon,color:"primary",isLoading:"",alwaysAllowClick:""},on:{click:function(a){return i.createWindow()}}},[t("v-progress-circular",{attrs:{rotate:"-90",size:"24",width:"2",color:"white",value:i.progress}})],1)})],2):e._e()],2)},db=[],ub=_(cb,lb,db,!1,null,null,null,null);const pb=ub.exports;const hb={name:"WindowAction",components:{},props:{action:Function,icon:String,color:String}};var mb=function(){var e=this,t=e._self._c;return t("v-btn",{staticClass:"toolbar-btn",attrs:{small:"",icon:"",color:e.color},on:{click:function(i){return i.stopPropagation(),e.action.apply(null,arguments)}}},[t("v-icon",{attrs:{small:""}},[e._v(e._s(e.icon))])],1)},fb=[],gb=_(hb,mb,fb,!1,null,"c20b0033",null,null);const wb=gb.exports,yb={__name:"MenuList",props:{elements:Object},setup(s){const{t:e}=O();function t(i){i.trigger()}return{__sfc:!0,t:e,onClick:t,useTranslations:O}}};var vb=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-list",{staticClass:"app-menu",staticStyle:{"border-radius":"0"},attrs:{color:"menu"}},[e._l(e.elements,function(n,a,r){return[n.type==="divider"?t("v-divider",{key:`menu.${r}.${Math.random()}`}):t("v-menu",{key:`menu.${r}.${Math.random()}`,attrs:{"open-on-hover":"","offset-x":"","z-index":"11","nudge-top":-8,rounded:"lg"},scopedSlots:e._u([{key:"activator",fn:function({on:o}){return[t("v-list-item",e._g({attrs:{dense:"",disabled:n.isDisabled},on:{click:function(l){return i.onClick(n)}}},n.type==="category"?o:void 0),[n.icon?t("v-list-item-icon",[t("v-icon",{attrs:{color:"accent",small:""}},[e._v(e._s(n.icon))])],1):e._e(),t("v-list-item-content",[t("v-list-item-title",[e._v(" "+e._s(i.t(n.name))+" ")])],1),t("v-list-item-action",[t("v-list-item-action-text",[n.type!=="category"&&n.keyBinding?t("span",[e._v(" "+e._s(n.keyBinding.toStrKeyCode())+" ")]):e._e(),n.type==="category"?t("v-icon",{attrs:{small:""}},[e._v(" mdi-chevron-right ")]):e._e()],1)],1)],1)]}}],null,!0)},[t("MenuList",{attrs:{elements:n.state}})],1)]})],2)},bb=[],_b=_(yb,vb,bb,!1,null,null,null,null);const Sb=_b.exports;const Cb={__name:"Button",props:{displayName:String,displayIcon:String,disabled:{type:Boolean}},setup(s){const{t:e}=O();return{__sfc:!0,t:e,useTranslations:O}}};var xb=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-btn",{staticClass:"toolbar-btn",class:{"btn-enabled":!e.disabled,"btn-disabled":e.disabled,"px-1":e.$vuetify.breakpoint.mobile},attrs:{small:"",text:"",disabled:e.disabled},on:{click:function(n){return e.$emit("click",n)}}},[e.displayIcon?t("v-icon",{staticClass:"pr-1",attrs:{color:"accent"}},[e._v(" "+e._s(e.displayIcon)+" ")]):e._e(),t("span",[e._v(" "+e._s(i.t(e.displayName))+" ")])],1)},kb=[],Pb=_(Cb,xb,kb,!1,null,"8f4edb45",null,null);const za=Pb.exports,jb={name:"MenuActivator",components:{MenuList:Sb,MenuButton:za},props:{item:Object,disabled:Boolean}};var Fb=function(){var e=this,t=e._self._c;return t("v-menu",{attrs:{"min-width":"260px","offset-y":"","z-index":"11","nudge-top":-8,rounded:"lg"},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("MenuButton",e._g({attrs:{disabled:e.disabled||e.item.isDisabled,displayIcon:e.item.icon,displayName:e.item.name}},i))]}}]),model:{value:e.item.isVisible,callback:function(i){e.$set(e.item,"isVisible",i)},expression:"item.isVisible"}},[e.item.isVisible?t("MenuList",{attrs:{elements:e.item.state}}):e._e()],1)},Tb=[],Ab=_(jb,Fb,Tb,!1,null,null,null,null);const $b=Ab.exports;const Eb={name:"Toolbar",mixins:[Ua,Vt],components:{WindowAction:wb,MenuActivator:$b,MenuButton:za,Logo:an},setup(){const s=q({title:"",appName:"",isAnyWindowVisible:u.windowState.isAnyWindowVisible});return u.getApp().then(e=>{s.title=e.projectManager.title.current,s.appName=e.projectManager.title.appName}),s},data:()=>({toolbar:u.toolbar.state,settingsState:b,isMacOS:H()==="darwin",appVersion:de}),computed:{isMobile(){return this.$vuetify.breakpoint.mobile},hideToolbarItemsSetting(){var s;return this.settingsState.appearance&&(s=this.settingsState.appearance.hideToolbarItems)!=null?s:!1},hideToolbarItems(){return this.hideToolbarItemsSetting&&this.windowControlsOverlay},composedTitle(){return this.title?`${this.appName} - ${this.title}`:this.appName}},methods:{async openChangelogWindow(){if(this.isAnyWindowVisible)return;await(await u.getApp()).windows.changelogWindow.open()},async openCommandBar(){this.isAnyWindowVisible||(rn.isWindowOpen=!0)}}};var Db=function(){var e=this,t=e._self._c;return e.isMobile?e._e():t("v-system-bar",{class:{"d-flex align-center justify-center":e.hideToolbarItems},style:{"padding-left":0,"margin-left":e.hideToolbarItems?0:"env(titlebar-area-x, 0)",width:e.hideToolbarItems?"100%":"env(titlebar-area-width, 100%)","z-index":e.windowControlsOverlay?1e3:void 0},attrs:{color:"toolbar",fixed:"",app:"",clipped:"",padless:"",height:e.appToolbarHeight}},[e.hideToolbarItems?[t("Logo",{staticStyle:{"padding-right":"8px"},attrs:{height:"22px",width:"22px",alt:"Logo of bridge. v2",draggable:"false"}}),t("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"toolbar-clickable outlined rounded-lg d-flex align-center justify-center",staticStyle:{height:"20px"},on:{click:e.openCommandBar}},[t("v-icon",{staticClass:"ml-1"},[e._v("mdi-magnify")]),t("span",{staticClass:"mr-1"},[e._v(" "+e._s(e.composedTitle)+" ")])],1)]:[!e.isMacOS||!e.windowControlsOverlay?t("Logo",{staticStyle:{"padding-right":"4px","padding-left":"calc(env(safe-area-inset-left) + 4px)"},attrs:{height:"24px",width:"24px",alt:"Logo of bridge. v2",draggable:"false"}}):e._e(),t("v-divider",{attrs:{vertical:""}}),t("v-toolbar-items",{staticClass:"px14-font"},[e._l(e.toolbar,function(i,n,a){return[i.type!=="category"?t("MenuButton",{key:`button.${n}`,attrs:{displayName:i.name,displayIcon:i.icon,disabled:e.isAnyWindowVisible||i.isDisabled},on:{click:()=>i.trigger()}}):i.shouldRender?t("MenuActivator",{key:`activator.${n}`,attrs:{item:i,disabled:e.isAnyWindowVisible||i.isDisabled}}):e._e(),i.shouldRender&&(e.windowControlsOverlay||a+1<Object.keys(e.toolbar).length)?t("v-divider",{key:`divider.${n}`,attrs:{vertical:""}}):e._e()]})],2),e.windowControlsOverlay?t("span",{staticClass:"pl-3"},[e._v(" "+e._s(e.composedTitle)+" ")]):e._e(),t("v-spacer"),t("div",{directives:[{name:"ripple",rawName:"v-ripple",value:!e.isAnyWindowVisible,expression:"!isAnyWindowVisible"}],staticClass:"px-1 mx-1 rounded-lg app-version-display",style:{opacity:e.isAnyWindowVisible?.4:null,"margin-right":"env(safe-area-inset-right, 0)"},on:{click:e.openChangelogWindow}},[e._v(" v"+e._s(e.appVersion)+" ")])]],2)},Mb=[],Ib=_(Eb,Db,Mb,!1,null,"22397726",null,null);const Ob=Ib.exports,Rb={components:{CommandBar:$s},data:()=>rn,watch:{isWindowOpen(){this.isWindowOpen?(this.shouldRender=!0,this.closeDelay&&clearTimeout(this.closeDelay)):this.closeDelay=setTimeout(()=>{this.shouldRender=!1,this.closeDelay=null},300)}}};var Wb=function(){var e=this,t=e._self._c;return e.shouldRender?t("v-dialog",{attrs:{"content-class":"elevation-0 d-flex pt-2 flex-column justify-center align-center",transition:"slide-y-reverse-transition",width:"60vw","max-width":"600px","hide-overlay":""},on:{keydown:function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"esc",27,i.key,["Esc","Escape"]))return null;e.isWindowOpen=!1}},model:{value:e.isWindowOpen,callback:function(i){e.isWindowOpen=i},expression:"isWindowOpen"}},[t("CommandBar",{attrs:{autofocus:""},on:{actionSelected:function(i){e.isWindowOpen=!1},blur:function(i){e.isWindowOpen=!1}}}),t("div",{style:{height:"80vh"},on:{click:function(i){e.isWindowOpen=!1}}})],1):e._e()},Lb=[],Nb=_(Rb,Wb,Lb,!1,null,null,null,null);const Bb=Nb.exports,Vb={name:"CollectedWindows",components:{CommandBarWindow:Bb},data:()=>({windows:u.windowState.state})};var Hb=function(){var e=this,t=e._self._c;return t("div",[t("CommandBarWindow"),e._l(e.windows,function(i,n){return t(i.component,{key:n,tag:"component",attrs:{currentWindow:i,window:i}})})],2)},Ub=[],zb=_(Vb,Hb,Ub,!1,null,null,null,null);const Jb=zb.exports,qb={__name:"List",props:{actions:{type:Object,required:!0}},emits:["click"],setup(s,{emit:e}){const t=s,{t:i}=O(),n=F(null);function a(l){e("click"),l.trigger()}function r(l){n.value===l?n.value=null:n.value=l}const o=B(()=>{const l=[];for(const[d,p]of Object.entries(t.actions)){if(p.type!=="submenu"||te.value!=="touch"){l.push([d,p]);continue}l.push([d,{type:"section",icon:p.icon,name:p.name}]),n.value===d&&l.push(...Object.entries(p.submenu.state).map(([h,m])=>[h,m.type==="action"?m.withPadding():m]))}return Object.fromEntries(l)});return{__sfc:!0,t:i,props:t,emit:e,openSection:n,onClick:a,toggleSection:r,renderActions:o,computed:B,ref:F,useTranslations:O,pointerDevice:te}}};var Gb=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-list",{attrs:{color:"menu",dense:""}},[e._l(i.renderActions,function(n,a){return[n.type==="divider"?t("v-divider",{key:a}):n.type==="submenu"?t("v-menu",{key:a,attrs:{"open-on-hover":"","offset-x":"","nudge-right":"8px",rounded:"lg","close-delay":"200",transition:"context-menu-transition","close-on-click":""},scopedSlots:e._u([{key:"activator",fn:function({on:r,attrs:o}){return[Object.keys(n.submenu.state).length>0?t("v-list-item",e._g(e._b({attrs:{disabled:n.isDisabled}},"v-list-item",o,!1),r),[t("v-list-item-icon",{staticClass:"mr-2",style:{opacity:n.isDisabled?"38%":null}},[t("v-icon",{attrs:{color:n.color||"accent"}},[e._v(" "+e._s(n.icon)+" ")])],1),t("v-list-item-action",{staticClass:"ma-0",style:{alignItems:"flex-start"}},[t("v-list-item-title",{style:{alignSelf:"flex-start"},domProps:{textContent:e._s(i.t(n.name))}}),n.description?t("v-list-item-subtitle",{domProps:{textContent:e._s(i.t(n.description))}}):e._e()],1),t("v-spacer"),t("v-icon",{attrs:{small:""}},[e._v("mdi-chevron-right")])],1):e._e()]}}],null,!0)},[t("List",{attrs:{actions:n.submenu.state},on:{click:function(r){return e.$emit("click")}}})],1):n.type==="section"?t("v-list-item",{key:a,on:{click:function(r){return i.toggleSection(a)}}},[t("v-list-item-icon",{staticClass:"mr-2",style:{opacity:n.isDisabled?"38%":null}},[t("v-icon",{attrs:{color:n.color||"accent"}},[e._v(" "+e._s(n.icon)+" ")])],1),t("v-list-item-title",{domProps:{textContent:e._s(i.t(n.name))}}),t("v-spacer"),t("v-icon",{attrs:{small:""}},[e._v(" "+e._s(a===i.openSection?"mdi-chevron-down":"mdi-chevron-right")+" ")])],1):t("v-list-item",{key:a,class:{"pl-6":n.addPadding},attrs:{disabled:n.isDisabled},on:{click:function(r){return i.onClick(n)}}},[t("v-list-item-icon",{staticClass:"mr-2",style:{opacity:n.isDisabled?"38%":null}},[t("v-icon",{attrs:{color:n.color||"accent"}},[e._v(" "+e._s(n.icon)+" ")])],1),t("v-list-item-action",{staticClass:"ma-0",style:{alignItems:"flex-start"}},[t("v-list-item-title",{style:{alignSelf:"flex-start"},domProps:{textContent:e._s(i.t(n.name))}}),n.description?t("v-list-item-subtitle",{domProps:{textContent:e._s(i.t(n.description))}}):e._e()],1)],1)]})],2)},Kb=[],Yb=_(qb,Gb,Kb,!1,null,null,null,null);const Qb=Yb.exports;const Zb=Vr("context-menu-transition");Ve.component("context-menu-transition",Zb);const Xb={components:{ContextMenuList:Qb},name:"ContextMenu",props:{contextMenu:Object,windowHeight:Number},data:()=>({shouldRender:!1,timeoutId:null}),computed:{x(){return this.contextMenu.position.x},y(){const s=this.contextMenu.position.y+this.contextMenu.menuHeight;if(s>this.windowHeight){const e=this.windowHeight-s;return this.contextMenu.position.y-e}return this.contextMenu.position.y},isVisible:{set(s){this.contextMenu.isVisible.value=s},get(){return this.contextMenu.isVisible.value}},actions(){return!this.contextMenu||!this.contextMenu.actionManager.value?{}:this.contextMenu.actionManager.value.state}},watch:{isVisible(){this.isVisible?(this.shouldRender=!0,this.timeoutId&&clearTimeout(this.timeoutId)):this.timeoutId=setTimeout(()=>{this.shouldRender=!1,this.timeoutId=null},500)}}};var e_=function(){var e=this,t=e._self._c;return t("v-menu",{ref:"menu",attrs:{"position-x":e.x,"position-y":e.y,rounded:"lg",absolute:"","offset-y":"",transition:"context-menu-transition","offset-overflow":!1,"close-on-click":e.contextMenu.mayCloseOnClickOutside,"close-on-content-click":!1,"min-width":"200px"},model:{value:e.isVisible,callback:function(i){e.isVisible=i},expression:"isVisible"}},[t("ContextMenuList",{attrs:{actions:e.actions},on:{click:function(i){e.isVisible=!1}}})],1)},t_=[],i_=_(Xb,e_,t_,!1,null,null,null,null);const n_=i_.exports;const s_={name:"TabSystemTab",props:{tab:yt,isActive:Boolean,isFirstTab:Boolean},data:()=>({hoveringBtn:!1}),setup(){return{pointerDevice:te}},mounted(){this.isSelected&&this.$refs.tabElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},computed:{isMobile(){return this.$vuetify.breakpoint.mobile},compactDesign(){return!b.editor||b.editor.compactTabDesign===void 0?!0:b.editor.compactTabDesign},floatingTabDesign(){return!this.tab.isSelected&&!this.isMobile},isSelected(){return this.tab.isSelected},tabName(){if(!this.compactDesign||this.isSelected)return this.tab.name;let s=this.tab.name.split(".");return s.pop(),s=s.join("."),s.length>5?s.slice(0,5)+"...":this.tab.name}},watch:{isSelected(){this.isSelected&&this.$refs.tabElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}};var a_=function(){var e=this,t=e._self._c;return t("div",{ref:"tabElement",staticClass:"cursor-pointer",class:{selected:e.tab.isSelected,"default-tab-style":!0,"d-flex":!0,"align-center":!0,inactive:!e.isActive,"px-3 py-2":!e.floatingTabDesign,"px-2 pb-1 mx-1 mt-2 my-1 rounded-lg":e.floatingTabDesign,"ml-0 pl-3":e.isFirstTab},staticStyle:{position:"relative"},on:{mousedown:[function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&i.button!==0)return null;e.hoveringBtn||e.tab.select()},function(i){if("button"in i&&i.button!==1)return null;i.preventDefault()}],mouseup:function(i){return"button"in i&&i.button!==1?null:e.tab.close()},contextmenu:function(i){return i.preventDefault(),e.tab.onContextMenu(i)},dblclick:function(i){e.tab.isTemporary=!1}}},[e.tab.isSelected&&e.pointerDevice==="touch"?t("v-btn",{attrs:{text:"",icon:"",small:""},on:{click:function(i){return e.tab.onContextMenu(i)},mouseenter:function(i){e.hoveringBtn=!0},mouseleave:function(i){e.hoveringBtn=!1}}},[t("v-icon",[e._v("mdi-dots-vertical")])],1):e._e(),t("v-badge",{class:{"mr-3":e.tab.isReadOnly,"mr-1":e.tab.isUnsaved},attrs:{value:e.tab.isReadOnly||e.tab.isUnsaved,color:e.tab.iconColor,icon:e.tab.isReadOnly?"mdi-lock-outline":null,bordered:"",overlap:"",depressed:"",dot:e.tab.isUnsaved&&!e.tab.isReadOnly}},[e.tab.isLoading?t("v-progress-circular",{staticClass:"mr-1",attrs:{indeterminate:"",color:e.tab.iconColor,size:"16",width:"2"}}):t("v-icon",{staticClass:"mr-1",attrs:{color:e.tab.iconColor,small:""}},[e._v(" "+e._s(e.tab.icon)+" ")])],1),t("v-tooltip",{attrs:{color:"tooltip","open-delay":"1500",disabled:e.pointerDevice==="touch"||!e.tab.path,bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("span",e._g({},i),[t("span",{style:{"font-style":e.tab.isTemporary?"italic":null,position:e.tab.folderName?"relative":null,top:e.tab.folderName?"-4px":null}},[e._v(" "+e._s(e.tabName)+" ")]),e.tab.folderName?t("span",{staticStyle:{position:"absolute",left:"32px","font-size":"12px",overflow:"hidden","text-overflow":"ellipsis"},style:{top:e.floatingTabDesign?"14px":"22px",left:e.tab.isSelected&&e.pointerDevice==="touch"?"60px":!e.floatingTabDesign||e.isFirstTab?"32px":"28px",width:e.tab.isSelected&&e.pointerDevice==="touch"?"calc(100% - 76px)":"calc(100% - 48px)"}},[e._v(" "+e._s(e.tab.folderName)+"/ ")]):e._e()])]}}])},[t("span",[e._v(e._s(e.tab.path))])]),t("v-btn",{attrs:{text:"",icon:"",small:""},on:{click:function(i){return i.stopPropagation(),e.tab.close()},mouseenter:function(i){e.hoveringBtn=!0},mouseleave:function(i){e.hoveringBtn=!1}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-close")])],1)],1)},r_=[],o_=_(s_,a_,r_,!1,null,"6d460e4c",null,null);const c_=o_.exports;const l_={__name:"Action",props:{action:{type:D,required:!0}},emits:["click"],setup(s,{emit:e}){const t=s,{t:i}=O();function n(){e("click"),t.action.trigger()}return{__sfc:!0,t:i,props:t,emit:e,onClick:n,useTranslations:O,SimpleAction:D}}};var d_=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("div",{directives:[{name:"ripple",rawName:"v-ripple",value:!e.action.isDisabled,expression:"!action.isDisabled"}],staticClass:"d-flex px-1 mx-1 align-center action",style:{opacity:e.action.isDisabled?.2:1,cursor:e.action.isDisabled?null:"pointer"},on:{click:i.onClick}},[t("v-icon",{staticClass:"mr-1",attrs:{color:e.action.color||"primary",small:""}},[e._v(" "+e._s(e.action.icon)+" ")]),t("span",{staticClass:"action-name"},[e._v(e._s(i.t(e.action.name)))])],1)},u_=[],p_=_(l_,d_,u_,!1,null,"b3a5a453",null,null);const h_=p_.exports;const m_={components:{Action:h_},props:{actions:Array}};var f_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-inline-flex mb-1 tab-action-bar"},e._l(e.actions,function(i){return t("Action",{key:i.id,attrs:{action:i},on:{click:function(n){return e.$emit("click")}}})}),1)},g_=[],w_=_(m_,f_,g_,!1,null,"776b3258",null,null);const y_=w_.exports;function v_(){const s=F(null);let e=null;return u.getApp().then(async t=>{await t.projectManager.projectReady.fired,s.value=t.project,e=u.eventSystem.on("projectChanged",i=>{s.value=i})}),Hr(()=>{e==null||e.dispose(),e=null}),{project:s}}function Ln(s=F(0)){const{project:e}=v_(),t=B(()=>{var r;return(r=e.value)==null?void 0:r.tabSystems[s.value]}),i=B(()=>{var r;return(r=e.value)==null?void 0:r.tabSystem}),n=B(()=>{var r;return(r=e.value)==null?void 0:r.tabSystems}),a=B(()=>{var r,o;return n.value&&(((r=n.value)==null?void 0:r[0].shouldRender.value)||((o=n.value)==null?void 0:o[1].shouldRender.value))});return{tabSystem:t,activeTabSystem:i,tabSystems:n,shouldRenderWelcomeScreen:a}}const b_={components:{TabSystemTab:c_,ActionBar:y_,Draggable:Zi},props:{id:Number},setup(s){const{id:e}=xs(s),{tabSystem:t}=Ln(e);return{tabSystem:t,pointerDevice:te}},methods:{updateTab({added:s}){!s||s.element.toOtherTabSystem(!1)}}};var __=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tab-bar"},[e.tabSystem&&e.tabSystem.shouldRender?t("Draggable",{style:"display: flex; overflow-x: scroll; white-space: nowrap; width: 100%; height: 48px;",attrs:{group:{name:"tabSystemTabRow"},disabled:e.pointerDevice==="touch"},on:{change:e.updateTab},nativeOn:{mousedown:function(i){return i.target!==i.currentTarget?null:e.tabSystem.setActive(!0)}},model:{value:e.tabSystem.tabs.value,callback:function(i){e.$set(e.tabSystem.tabs,"value",i)},expression:"tabSystem.tabs.value"}},e._l(e.tabSystem.tabs.value,function(i,n){return t("TabSystemTab",{key:i.uuid,attrs:{tab:i,isActive:e.tabSystem.isActive,isFirstTab:n===0}})}),1):e._e(),e.tabSystem&&e.tabSystem.selectedTab&&e.tabSystem.selectedTab.actions.length>0?t("ActionBar",{class:{"inactive-action-bar":!e.tabSystem.isActive},attrs:{actions:e.tabSystem.selectedTab.actions},on:{click:function(i){return e.tabSystem.setActive(!0)}}}):e._e()],1)},S_=[],C_=_(b_,__,S_,!1,null,"3edf1774",null,null);const x_=C_.exports,k_={name:"TabSystem",mixins:[Vt],props:{id:{type:Number,default:0}},setup(s){const{id:e}=xs(s),{tabSystem:t}=Ln(e);return dt(t,()=>{!t.value||dt(t.value.shouldRender,()=>{u.getApp().then(i=>i.windowResize.dispatch())})}),{tabSystem:t}},components:{TabBar:x_},data:()=>({windowHeight:window.innerHeight}),async mounted(){(await u.getApp()).windowResize.on(this.updateWindowHeight)},async destroyed(){const s=await u.getApp();s.windowResize.off(this.updateWindowHeight),s.windowResize.dispatch()},computed:{tabBarHeight(){return this.tabSystem.selectedTab&&this.tabSystem.selectedTab.actions.length>0?48+25:48},tabHeight(){return(this.windowHeight-this.appToolbarHeightNumber)/(this.tabSystem.isSharingScreen.value&&this.isMobile?2:1)-this.tabBarHeight},isMobile(){return this.$vuetify.breakpoint.mobile}},methods:{updateWindowHeight(){this.windowHeight=window.innerHeight}}};var P_=function(){var e=this,t=e._self._c;return e.tabSystem&&e.tabSystem.shouldRender.value?t("div",{style:{"margin-right":"1px",width:e.isMobile?"100%":"calc(50% - 100px)",height:e.isMobile?"50%":"100%"}},[t("TabBar",{attrs:{id:e.id}}),t("keep-alive",[t(e.tabSystem.currentComponent,{key:`${e.tabSystem.uuid}.${e.tabSystem.currentComponent.name||e.tabSystem.selectedTab.type||e.tabSystem.selectedTab.name}`,tag:"component",style:`height: ${e.tabHeight}px; width: 100%;`,attrs:{height:e.tabHeight,tab:e.tabSystem.selectedTab,id:e.id}})],1)],1):e._e()},j_=[],F_=_(k_,P_,j_,!1,null,null,null,null);const T_=F_.exports;const A_={__name:"Action",props:{color:String,icon:String,name:String,isSelected:Boolean},setup(s){const{t:e}=O();return{__sfc:!0,t:e,useTranslations:O}}};var $_=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-tooltip",{attrs:{color:e.color||"tooltip",disabled:e.$vuetify.breakpoint.mobile,"open-delay":500,bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:n,attrs:a}){return[t("div",e._g(e._b({directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"rounded-lg ma-1 d-flex justify-center sidebar-actions pa-2",class:{"elevation-4":e.isSelected},style:{background:e.isSelected?`var(--v-${e.color}-base)`:null,transform:e.isSelected?"scale(1.05)":null},on:{click:function(r){return e.$emit("click",r)}}},"div",a,!1),n),[t("v-icon",{attrs:{color:e.isSelected?"white":e.color}},[e._v(" "+e._s(e.icon)+" ")])],1)]}}])},[t("span",[e._v(e._s(i.t(e.name)))])])},E_=[],D_=_(A_,$_,E_,!1,null,"972e91ba",null,null);const M_=D_.exports;const I_={props:{actions:Array},components:{Action:M_},methods:{onClick(s,e){e instanceof ft?e.select():e.trigger(s)}}};var O_=function(){var e=this,t=e._self._c;return t("v-row",{staticClass:"action-bar pa-1",attrs:{cols:"5","no-gutters":""}},e._l(e.actions,function(i,n){return t("v-col",{key:n},[t("Action",{attrs:{color:i.config.color,icon:i.config.icon,name:i.config.name,isSelected:i.isSelected},on:{click:function(a){return e.onClick(a,i)}}})],1)}),1)},R_=[],W_=_(I_,O_,R_,!1,null,"146b8da3",null,null);const L_=W_.exports,N_={mixins:[Vt],components:{BridgeSheet:Oe,ActionBar:L_,InfoPanel:vn},mounted(){u.getApp().then(s=>{this.windowDimensions=s.windowResize.state})},data:()=>({windowDimensions:{currentHeight:window.innerHeight}}),computed:{content(){return u.sidebar.currentState.value}}};var B_=function(){var e=this,t=e._self._c;return e.content?t("div",{staticClass:"pa-2",style:{height:`calc(${e.windowDimensions.currentHeight}px - ${e.appToolbarHeight})`}},[e.content.headerSlot?t("BridgeSheet",{staticClass:"mb-2",style:{height:e.content.headerHeight,overflow:"auto"}},[t(e.content.headerSlot,{tag:"component"})],1):e._e(),t("BridgeSheet",{style:{height:e.content.headerSlot?`calc(100% - ${e.content.headerHeight} - 8px)`:"100%",overflow:"auto"},nativeOn:{contextmenu:function(i){return e.content.onContentRightClick(i)}}},[e.content.topPanel?t("InfoPanel",{staticClass:"ma-2",attrs:{infoPanel:e.content.topPanel}}):e._e(),e.content.actions&&e.content.actions.length>0?t("ActionBar",{attrs:{actions:e.content.actions}}):e._e(),t(e.content.component,{tag:"component",attrs:{sidebarContent:e.content}})],1)],1):e._e()},V_=[],H_=_(N_,B_,V_,!1,null,null,null,null);const U_=H_.exports;const z_={name:"App",mixins:[Vt],setup(){const{tabSystem:s,tabSystems:e,shouldRenderWelcomeScreen:t}=Ln(),{isInFullScreen:i}=Cc();return{tabSystem:s,tabSystems:e,shouldRenderWelcomeScreen:t,isInFullScreen:i}},mounted(){u.getApp().then(s=>{this.contextMenu=s.contextMenu,this.windowSize=s.windowResize.state}),Sc(this.$refs.appContainer.$el)},components:{Sidebar:pb,Toolbar:Ob,WindowRenderer:Jb,ContextMenu:n_,TabSystem:T_,WelcomeScreen:Es,SidebarContent:U_},data:()=>({isMacOs:H()==="darwin",contextMenu:null,settingsState:b,windowSize:{currentWidth:window.innerWidth,currentHeight:window.innerHeight}}),computed:{isSidebarContentVisible(){return this.isInFullScreen?!1:this.sidebarNavigationVisible&&u.sidebar.isContentVisible.value},sidebarNavigationVisible(){return u.sidebar.isNavigationVisible.value},isSidebarRight(){return this.settingsState&&this.settingsState.sidebar&&this.settingsState.sidebar.isSidebarRight},sidebarSize(){let s=this.settingsState&&this.settingsState.sidebar?this.settingsState.sidebar.sidebarSize:void 0;if(s||(s="normal"),this.$vuetify.breakpoint.mobile)return 9;switch(s){case"tiny":return-2;case"small":return-1;case"normal":return 0;case"large":return 1}},fontFamily(){return this.settingsState&&this.settingsState.appearance&&this.settingsState.appearance.font?`${this.settingsState.appearance.font}, system-ui !important`:"Roboto, system-ui !important"}},methods:{openSidebar(){u.sidebar.isNavigationVisible.value=!0}},watch:{"$vuetify.breakpoint.mobile"(){this.$nextTick(()=>{u.getApp().then(s=>s.windowResize.dispatch())})}}};var J_=function(){var e=this,t=e._self._c;return t("v-app",{ref:"appContainer",style:{fontFamily:e.fontFamily},nativeOn:{contextmenu:function(i){return i.preventDefault()}}},[e.isInFullScreen?e._e():t("Toolbar"),e.isInFullScreen?e._e():t("Sidebar",{attrs:{app:""}}),e.sidebarNavigationVisible?e._e():t("v-btn",{staticStyle:{bottom:"calc(env(safe-area-inset-bottom, 0) + 16px)"},attrs:{small:"",fab:"",fixed:"",left:!e.isSidebarRight,right:e.isSidebarRight,color:"primary"},on:{click:e.openSidebar}},[t("v-icon",[e._v("mdi-table-column")])],1),t("v-main",{style:{"padding-top":e.isInFullScreen?0:e.appToolbarHeight}},[t("WindowRenderer"),t("v-row",{staticClass:"d-flex fill-area",class:{"ml-2":!e.isSidebarContentVisible&&e.isSidebarRight,"mr-2":!e.isSidebarContentVisible&&!e.isSidebarRight,"flex-row-reverse":e.isSidebarRight},attrs:{"no-gutters":""}},[e.isSidebarContentVisible?t("v-col",{attrs:{cols:e.isSidebarContentVisible?3+e.sidebarSize:0}},[t("SidebarContent",{attrs:{isSidebarRight:e.isSidebarRight}})],1):e._e(),t("v-col",{staticClass:"flex-grow-1",attrs:{cols:e.isSidebarContentVisible?9-e.sidebarSize:12}},[e.shouldRenderWelcomeScreen?t("div",{staticClass:"d-flex",class:{"flex-column":e.$vuetify.breakpoint.mobile},style:{height:`calc(${e.windowSize.currentHeight}px - ${e.appToolbarHeight})`}},[t("TabSystem",{staticClass:"flex-grow-1",attrs:{showWelcomeScreen:""}}),e.tabSystems[0].shouldRender.value&&e.tabSystems[1].shouldRender.value?t("v-divider",{staticStyle:{"z-index":"1"},attrs:{vertical:!e.$vuetify.breakpoint.mobile}}):e._e(),t("TabSystem",{staticClass:"flex-grow-1",attrs:{id:1}})],1):t("WelcomeScreen",{attrs:{containerPadding:e.isSidebarContentVisible?e.isSidebarRight?"pl-2":"pr-2":"px-2"}})],1)],1)],1),e.contextMenu?t("ContextMenu",{attrs:{contextMenu:e.contextMenu,windowHeight:e.windowSize.currentHeight}}):e._e()],1)},q_=[],G_=_(z_,J_,q_,!1,null,null,null,null);const K_=G_.exports;Ve.use(vs);Ve.config.productionTip=!1;const Ja=new Ve({vuetify:Xt,render:s=>s(K_)});ge.setDefaultLanguage().then(()=>{Ja.$mount("#app")});self.MonacoEnvironment={getWorker(s,e){return e==="json"?new Ur:e==="css"||e==="scss"||e==="less"?new zr:e==="html"||e==="handlebars"||e==="razor"?new Jr:e==="typescript"||e==="javascript"?new qr:new Gr}};Kr(Yr);u.main(Ja);"launchQueue"in window&&window.launchQueue.setConsumer(async s=>{const e=await u.getApp();if(s.targetURL&&await e.startParams.parse(s.targetURL),!!s.files.length)for(const t of s.files)await e.fileDropper.importFile(t)});export{ue as _};
