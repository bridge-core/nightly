import{c as Oi,s as pe,g as fe,d as qe,a as Pa,b as ja,e as Fa,k as Ta,v as D,r as E,m as k,t as ni,f as si,h as G,i as V,V as Kn,j as K,l as Ue,n as X,o as Ee,p as We,q as ut,u as R,w as Dt,x as Ri,z as Yn,y as Qn,A as ai,B as ne,C as Aa,T as $a,D as Wi,E as ri,P as Da,F as Et,G as Li,H as st,R as Ea,I as Ma,J as Zn,K as Ia,L as Oa,M as Ra,N as Wa,O as La,Q as Na,S as Ba,U as Va,W as Ha,X as Ua,Y as za,Z as Ct,_ as qa,$ as Ja,a0 as Ga,a1 as Ka,a2 as Ya,a3 as Qa,a4 as Za,a5 as Xa,a6 as kt,a7 as Ni,a8 as er,a9 as tr,aa as bn,ab as ir,ac as nr,ad as sr,ae as ar,af as rr,ag as or,ah as Xn,ai as cr,aj as lr,ak as dr,al as pr,am as ur,an as hr,ao as fr,ap as mr,aq as es,ar as gr,as as wr,at as yr,au as vr,av as br,aw as _r,ax as Sr}from"./vendor.ed651d0f.js";const Cr=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}};Cr();class H{constructor(){this.listeners=new Set}get hasListeners(){return this.listeners.size>0}dispatch(e){this.listeners.forEach(t=>t(e))}on(e,t=!0){if(this.listeners.add(e),t)return{dispose:()=>{this.off(e)}}}off(e){this.listeners.delete(e)}once(e,t=!1){const i=n=>{e(n),this.off(i)};return this.on(i,t)}disposeListeners(){this.listeners=new Set}}class $ extends H{constructor(e=1){super(),this.needsToFireAmount=e,this.firedTimes=0}get fired(){return new Promise(e=>this.once(e,!1))}get hasFired(){return this.firedTimes>=this.needsToFireAmount}setFiredTimes(e){this.firedTimes=e}resetSignal(){this.data=void 0,this.firedTimes=0}dispatch(e){if(this.firedTimes<this.needsToFireAmount&&this.firedTimes++,this.data=e,this.hasFired)return super.dispatch(e)}on(e,t=!0){return this.hasFired&&e(this.data),super.on(e,t)}}const kr=Oi("virtual-fs","virtual-fs-store"),Bi=s=>fe(s,kr),xr=async s=>await Bi(s)!==void 0;class at{constructor(e="virtual-fs"){this.storeName=e,this.store=Oi(e,`${e}-store`)}set(e,t){return pe(e,t,this.store)}get(e){return fe(e,this.store)}del(e){return qe(e,this.store)}setMany(e){return Pa(e,this.store)}getMany(e){return ja(e,this.store)}clear(){return Fa(this.store)}async has(e){return await Bi(e)!==void 0}keys(){return Ta(this.store)}}class it{constructor(e,t,i=[],n=D()){this._name=t,this.basePath=i,this.uuid=n,this._idbWrapper=null,this.parent=null,this.isVirtual=!0,this.setupDone=new $,e===null?this._idbWrapper=new at:e instanceof at?this._idbWrapper=e:this.parent=e}get path(){return this.parent?this.parent.path.concat(this.name):this.basePath}get hasParentContext(){return this.path.length>1}get idbKey(){return this.path.length===0?this._name:this.path.join("/")}get idbWrapper(){return this._idbWrapper===null?this.parent.idbWrapper:this._idbWrapper}get name(){return this._name}getParent(){return this.parent}async isSameEntry(e){return e.idbKey===this.idbKey}async queryPermission(e){return"granted"}async requestPermission(e){return"granted"}}const Pr=new TextEncoder,ts=Symbol("writeMethod");class jr{constructor(e){this.fileHandle=e,this.tmpData=new Uint8Array,this.cursorOffset=0,this.locked=!1}async write(e){let t;if(typeof e=="string")t=Pr.encode(e);else if(e instanceof Blob)t=await e.arrayBuffer().then(i=>new Uint8Array(i));else if("type"in e){if(e.type==="seek")return await this.seek(e.position);if(e.type==="truncate")return await this.truncate(e.size);if(e.type==="write")return e.position&&await this.seek(e.position),await this.write(e.data);throw new Error(`Unknown data type: ${e.type}`)}else ArrayBuffer.isView(e)?t=new Uint8Array(e.buffer):t=new Uint8Array(e);this.tmpData=new Uint8Array([...this.tmpData.slice(0,this.cursorOffset),...t]),this.cursorOffset=this.tmpData.length}async seek(e){this.cursorOffset=Math.floor(e)}async truncate(e){this.tmpData=this.tmpData.slice(0,e),this.cursorOffset>e&&(this.cursorOffset=e)}async close(){await this.fileHandle[ts](this.tmpData)}async abort(){throw new Error("WriteStream was aborted")}getWriter(){}}class se extends it{constructor(e,t,i,n=!1,a){super(e,t,a),this.inMemory=n,this.kind="file",this.isFile=!0,this.isDirectory=!1,i?this.setup(i):this.setupDone.dispatch()}get isFileStoredInMemory(){return this.fileData!==void 0}moveData(){if(!this.fileData)throw new Error(`No file data to move to IDB for file "${this.name}"`);const e=this.fileData;return this.fileData=void 0,this.inMemory=!1,e}async setup(e){this.fileData=e;const t=this.path.join("/").startsWith("data/packages");if(this.inMemory||t&&e.length<5e4)return this.inMemory=!0,this.setupDone.dispatch();(!t||globalThis.document)&&await this.updateIdb(e),this.setupDone.dispatch()}async updateIdb(e){await this.idbWrapper.set(this.idbKey,e),this.fileData=void 0}async loadFromIdb(){if(this.fileData)return this.fileData;let e=await this.idbWrapper.get(this.idbKey);if(e===void 0)throw console.log(this.parent),new Error(`File not found: "${this.path.join("/")}"`);return e}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"file",name:this.name,path:this.path,fileData:this.fileData}}static deserialize(e){return new se(e.idbWrapper?new at(e.idbWrapper):null,e.name,e.fileData,e.fileData!==void 0,e.path)}async isSameEntry(e){return this.parent===null?!1:super.isSameEntry(e)}async removeSelf(e=!0){await this.idbWrapper.del(this.idbKey),this.parent&&e&&this.parent.deleteChild(this.name)}async getFile(){const e=await this.loadFromIdb();return new File([e],this.name)}async createWritable(){return new jr(this)}async[ts](e){this.inMemory?this.fileData=e:await this.updateIdb(e)}}class te extends it{constructor(e,t,i,n=!1,a=[]){super(e,t,a),this.children=i,this.kind="directory",this.isDirectory=!0,this.isFile=!1,this.updateIdb(n)}get isDirectoryInMemory(){return this.children!==void 0}async moveToIdb(){const e=this.allInMemoryChildren();this.idbWrapper.setMany(e.map(t=>[t.idbKey,t.moveData()]))}moveData(){if(!this.children)throw new Error(`No directory data to move to IDB for directory "${this.name}"`);const e=[...this.children.values()].map(t=>t.name);return this.children=void 0,e}allInMemoryChildren(){if(!this.children)return[];const e=[this];for(const t of this.children.values())t instanceof te?t.isDirectoryInMemory&&e.push(...t.allInMemoryChildren()):t.isFileStoredInMemory&&e.push(t);return e}async updateIdb(e=!1){e&&await this.idbWrapper.clear(),!this.children&&!await this.hasChildren()&&await this.idbWrapper.set(this.idbKey,[]),this.setupDone.dispatch()}async addChild(e){await this.has(e.name)||(this.children?this.children.set(e.name,e):await this.idbWrapper.set(this.idbKey,[...await this.fromIdb(),e.name]))}async fromIdb(){var e;return(e=await this.idbWrapper.get(this.idbKey))!=null?e:[]}async getChildren(){return this.children?[...this.children.values()]:await Promise.all((await this.fromIdb()).map(e=>this.getChild(e)).filter(e=>e!==void 0))}getChildPath(e){return this.path.concat(e).join("/")}async getChild(e){if(this.children)return this.children.get(e);if(await this.has(e)){const t=await this.idbWrapper.get(this.getChildPath(e));if(t instanceof Uint8Array)return new se(this,e);if(Array.isArray(t))return new te(this,e)}}async deleteChild(e){this.children?this.children.delete(e):await this.idbWrapper.set(this.idbKey,(await this.fromIdb()).filter(t=>t!==e))}async hasChildren(){return this.children?this.children.size>0:(await this.fromIdb()).length>0}async has(e){return this.children?this.children.has(e):(await this.fromIdb()).includes(e)}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"directory",name:this.name,path:this.path,children:this.children?[...this.children.values()].map(e=>e.serialize()):void 0}}static deserialize(e,t=null){var n;const i=new te(t||new at(e.idbWrapper),e.name,void 0,!1,e.path);for(const a of(n=e.children)!=null?n:[])a.kind==="directory"?i.addChild(te.deserialize(a,i)):i.addChild(new se(i,a.name,a.fileData));return i}async getDirectoryHandle(e,{create:t}={}){let i=await this.getChild(e);if(i&&i.kind==="file")throw new Error(`TypeMismatch: Expected directory with name "${e}", found file`);if(!i)if(t)i=new te(this,e,this.children?new Map:void 0),await i.setupDone.fired,await this.addChild(i);else throw new Error(`No file with the name ${e} exists in this folder`);return i}async getFileHandle(e,{create:t,initialData:i}={}){let n=await this.getChild(e);if(n&&n.kind==="directory")throw new Error(`TypeMismatch: Expected file with name "${e}", found directory`);if(!n)if(t)n=new se(this,e,i!=null?i:new Uint8Array),await n.setupDone.fired,await this.addChild(n);else throw new Error(`No file with the name ${e} exists in this folder`);return n}async removeEntry(e,{recursive:t}={}){const i=await this.getChild(e);if(i){if(i.kind==="directory"&&!t&&await i.hasChildren())throw new Error('Cannot remove directory with children without "recursive" option being set to true')}else throw new Error(`No entry with the name ${e} exists in this folder`);await i.removeSelf(),await this.deleteChild(e)}async resolve(e){const t=[e.name];let i=e.getParent();for(;i!==null&&!await i.isSameEntry(this);)t.unshift(i.name),i=i.getParent();return i===null?null:t}async removeSelf(e=!0){const t=await this.getChildren();for(const i of t)await i.removeSelf(!1);this.children||await this.idbWrapper.del(this.idbKey),this.parent&&e&&this.parent.deleteChild(this.name)}[Symbol.asyncIterator](){return this.entries()}keys(){return this.children?this.children.keys():{childNamesPromise:this.fromIdb(),[Symbol.asyncIterator](){return{i:0,childNamesPromise:this.childNamesPromise,async next(){const e=await this.childNamesPromise;return this.i<e.length?{done:!1,value:e[this.i++]}:{done:!0}}}}}}entries(){return this.children?this.children.entries():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const e=await this.childrenPromise;return this.i<e.length?{done:!1,value:[e[this.i].name,e[this.i++]]}:{done:!0}}}}}}values(){return this.children?this.children.values():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const e=await this.childrenPromise;return this.i<e.length?{done:!1,value:e[this.i++]}:{done:!0}}}}}}getEntries(){return this.values()}getDirectory(e,t={}){return this.getDirectoryHandle(e,t)}getFile(e,t={}){return this.getFileHandle(e,t)}}function oi(){const s=["93","94"],e=navigator.userAgentData;if(!e)return!0;const t=e.brands.find(({brand:a})=>a==="Google Chrome"),i=e.brands.find(({brand:a})=>a==="Microsoft Edge"),n=e.brands.find(({brand:a})=>a==="Opera GX"||a==="Opera");return t?s.includes(t.version):!(i||n)}let A=E(!1),is=!1,ns=!1;(oi()||typeof window.showDirectoryPicker!="function")&&(A.value=!0,window.showDirectoryPicker=async()=>k(new te(null,"bridgeFolder",void 0)));(oi()||typeof window.showOpenFilePicker!="function")&&(window.showOpenFilePicker=async s=>{var n;const e={types:[],...s},t=document.createElement("input");t.type="file",t.multiple=(n=e.multiple)!=null?n:!1,t.accept=e.types.map(a=>Object.values(a.accept)).flat(2).join(","),t.style.display="none",document.body.appendChild(t);let i=!1;return new Promise((a,r)=>{t.addEventListener("change",async o=>{var d;i=!0;const c=[...(d=t.files)!=null?d:[]];document.body.removeChild(t),a(await Promise.all(c.map(async p=>k(new se(null,p.name,new Uint8Array(await p.arrayBuffer()),!0)))))},{once:!0}),window.addEventListener("focus",()=>{setTimeout(()=>{i||(r("User aborted selecting file"),document.body.removeChild(t))},300)},{once:!0}),t.click()})});(oi()||typeof window.showSaveFilePicker!="function")&&(is=!0,window.showSaveFilePicker=async(s={})=>{var e;return new se(null,(e=s.suggestedName)!=null?e:"newFile.txt",new Uint8Array,!0)});(oi()||globalThis.DataTransferItem&&!DataTransferItem.prototype.getAsFileSystemHandle)&&(DataTransferItem.prototype.getAsFileSystemHandle=async function(){if(this.kind==="file"){const s=this.getAsFile();return s?new se(null,s.name,new Uint8Array(await s.arrayBuffer()),!0):null}else if(this.kind==="directory")return k(new te(null,"unknown"));return null});ni.set("VirtualFileHandle",{canHandle:s=>s instanceof se,serialize:s=>[s.serialize(),[]],deserialize:s=>new se(null,s.name,s.fileData)});ni.set("VirtualDirectoryHandle",{canHandle:s=>s instanceof te,serialize:s=>[s.serialize(),[]],deserialize:s=>te.deserialize(s)});ni.set("VirtualDirectoryHandleArray",{canHandle:s=>Array.isArray(s)&&s.every(({directory:e})=>e instanceof te),serialize:s=>[s.map(({directory:e,...t})=>({directory:e.serialize(),...t})),[]],deserialize:s=>s.map(({directory:e,...t})=>({directory:te.deserialize(e),...t}))});ni.set("VirtualFileHandleArray",{canHandle:s=>Array.isArray(s)&&s.every(({fileHandle:e})=>e instanceof se),serialize:s=>[s.map(({fileHandle:e,...t})=>({fileHandle:e.serialize(),...t})),[]],deserialize:s=>s.map(({fileHandle:e,...t})=>({fileHandle:se.deserialize(e),...t}))});const Fr="modulepreload",Tr=function(s){return"/"+s},_n={},ue=function(e,t,i){return!t||t.length===0?e():Promise.all(t.map(n=>{if(n=Tr(n),n in _n)return;_n[n]=!0;const a=n.endsWith(".css"),r=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${r}`))return;const o=document.createElement("link");if(o.rel=a?"stylesheet":Fr,a||(o.as="script",o.crossOrigin=""),o.href=n,document.head.appendChild(o),a)return new Promise((c,d)=>{o.addEventListener("load",c),o.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())},Ar=`{
	"general": {
		"yes": "Yes",
		"no": "No",
		"okay": "Okay",
		"confirm": "Confirm",
		"cancel": "Cancel",
		"close": "Close",
		"reload": "Reload",
		"information": "Information",
		"continue": "Continue",
		"delete": "Delete",
		"select": "Select",
		"skip": "Skip",
		"save": "Save",
		"shareFile": "Share File",
		"more": "More...",
		"selectFolder": "Select Folder",
		"fileName": "File Name",
		"folderName": "Folder Name",
		"inactive": "Inactive",
		"active": "Active",
		"later": "Later",
		"clear": "Clear",
		"reset": "Reset",
		"readMore": "Read More",
		"search": "Search...",
		"confirmOverwriteFile": "This action overwrites a file with the same name. Do you want to continue?",
		"confirmOverwriteFolder": "This action overwrites a folder with the same name. Do you want to continue?",
		"fileSystemPolyfill": {
			"name": "Save Your Projects!",
			"description": "Due to the browser you are using, you need to download your projects in order to actually save your progress. This is not necessary if you are using Chrome (excluding Chrome 93/94) or Edge!"
		},
		"successfulExport": {
			"title": "Export Successful",
			"description": "You can find the exported package here"
		},
		"experimentalGameplay": "Experimental Gameplay",
		"textureLocation": "Texture Location"
	},
	"openWith": {
		"snowstorm": "Snowstorm",
		"textEditor": "Text Editor",
		"treeEditor": "Tree Editor",
		"htmlPreviewer": "HTML Previewer",
		"blockbench": "Blockbench"
	},
	"packType": {
		"behaviorPack": {
			"name": "Behavior Pack",
			"description": "Create new game mechanics and change how Minecraft behaves"
		},
		"resourcePack": {
			"name": "Resource Pack",
			"description": "Used for changing Minecraft's look and sound"
		},
		"skinPack": {
			"name": "Skin Pack",
			"description": "Provide new appearances a player can select for their character"
		},
		"worldTemplate": {
			"name": "World Template",
			"description": "Create a world that users can create to experience your project"
		}
	},
	"fileType": {
		"manifest": "Manifest",
		"animation": "Animation",
		"animationController": "Animation Controller",
		"biome": "Biome",
		"block": "Block",
		"bridgeConfig": "Project Config",
		"dialogue": "Dialogue",
		"entity": "Entity",
		"feature": "Feature",
		"featureRule": "Feature Rule",
		"functionTick": "Function Tick",
		"function": "Function",
		"generatorScript": "Generator Script",
		"item": "Item",
		"lootTable": "Loot Table",
		"recipe": "Recipe",
		"clientScript": "Client Script",
		"serverScript": "Server Script",
		"script": "Script",
		"spawnRule": "Spawn Rule",
		"mcstructure": "Structure",
		"tradeTable": "Trade Table",
		"clientManifest": "Client Manifest",
		"skinManifest": "Skin Manifest",
		"geometry": "Geometry",
		"customCommand": "Command",
		"customComponent": "Component",
		"clientAnimation": "Client Animation",
		"clientAnimationController": "Client Animation Controller",
		"attachable": "Attachable",
		"clientEntity": "Client Entity",
		"clientItem": "Client Item",
		"clientLang": "Language",
		"fog": "Fog",
		"particle": "Particle",
		"renderController": "Render Controller",
		"texture": "Texture",
		"textureSet": "Texture Set",
		"itemTexture": "Item Texture",
		"clientBlock": "Client Block",
		"terrainTexture": "Terrain Texture",
		"flipbookTexture": "Flipbook Texture",
		"clientBiome": "Client Biome",
		"soundDefinition": "Sound Definition",
		"musicDefinition": "Music Definition",
		"clientSound": "Client Sound",
		"skins": "Skins",
		"langDef": "Language Definitions",
		"lang": "Language",
		"molang": "Molang",
		"gameTest": "Game Test",
		"unknown": "Other",
		"simpleFile": "Simple Files",
		"ui": "UI",
		"volume": "Volume",
		"worldManifest": "World Manifest"
	},
	"actions": {
		"name": "Actions",
		"download": {
			"name": "Download",
			"description": "Download this file or folder"
		},
		"viewConnectedFiles": {
			"name": "View Connected Files",
			"description": "View all files connected to this file"
		},
		"open": {
			"name": "Open",
			"description": "Open the file in the editor"
		},
		"openWith": {
			"name": "Open With",
			"description": "Open the file in the editor"
		},
		"openInSplitScreen": {
			"name": "Open in Split Screen",
			"description": "Open the file in split screen mode"
		},
		"edit": {
			"name": "Edit",
			"description": "Edit the file or folder"
		},
		"delete": {
			"name": "Delete",
			"description": "Delete a file or folder",
			"confirmText": "Are you sure that you want to delete ",
			"noRestoring": "You won't be able to restore it later!"
		},
		"rename": {
			"name": "Rename",
			"description": "Rename a file",
			"sameName": "Your new file name only differs in capitalization. This is not allowed on Windows."
		},
		"duplicate": {
			"name": "Duplicate",
			"description": "Duplicate a file"
		},
		"viewCompilerOutput": {
			"name": "Compiler Output",
			"view": "View Compiler Output",
			"description": "View the current compiler output for this file",
			"fileMissing": "It does not look like this file was compiled yet."
		},
		"revealPath": {
			"name": "Reveal Path",
			"description": "Reveals the location of a file or folder"
		},
		"createFile": {
			"name": "Create File",
			"description": "Create a new file"
		},
		"createFolder": {
			"name": "Create Folder",
			"description": "Create a new folder"
		},
		"findInFolder": {
			"name": "Find in Folder",
			"description": "Search the contents of a folder"
		},
		"goHome": {
			"name": "Go Home",
			"description": "Go back to the home screen"
		},
		"newProject": {
			"name": "New Project",
			"description": "Create a new bridge. project"
		},
		"newFile": {
			"name": "New File",
			"description": "Create a new Add-On feature"
		},
		"openFile": {
			"name": "Open File",
			"description": "Open a file to edit it with bridge."
		},
		"openFolder": {
			"name": "Open Folder",
			"description": "Open a folder to edit it, set it as an output folder or trigger other actions"
		},
		"searchFile": {
			"name": "Search File",
			"description": "Search and open a file from the current project"
		},
		"saveFile": {
			"name": "Save File",
			"description": "Save the currently opened file"
		},
		"saveAs": {
			"name": "Save As",
			"description": "Save the currently opened file under a different name"
		},
		"saveAll": {
			"name": "Save All",
			"description": "Save all currently opened files"
		},
		"closeFile": {
			"name": "Close File",
			"description": "Close the currently opened file"
		},
		"settings": {
			"name": "Settings",
			"description": "Open bridge.'s app settings"
		},
		"extensions": {
			"name": "Extensions",
			"description": "Install and manage your installed extensions"
		},
		"copy": {
			"name": "Copy",
			"description": "Copy selected text to the clipboard"
		},
		"cut": {
			"name": "Cut",
			"description": "Copy selected text to the clipboard and remove it from the original context"
		},
		"paste": {
			"name": "Paste",
			"description": "Paste clipboard content"
		},
		"docs": {
			"name": "Open bedrock.dev",
			"description": "Opens the Minecraft Add-On documentation"
		},
		"minecraftDocs": {
			"name": "Open Minecraft Documentation",
			"description": "Opens the Minecraft Bedrock Add-On documentation"
		},
		"releases": {
			"name": "Releases",
			"description": "View the latest bridge. releases"
		},
		"bugReports": {
			"name": "Bug Reports",
			"description": "Report an issue with bridge."
		},
		"twitter": {
			"name": "Twitter",
			"description": "Follow bridge. on Twitter"
		},
		"extensionAPI": {
			"name": "Extension API",
			"description": "Read more about bridge.'s extension API"
		},
		"gettingStarted": {
			"name": "Getting Started",
			"description": "Read our guide on how to get started with bridge."
		},
		"faq": {
			"name": "FAQ",
			"description": "Read through frequently asked questions about developing Add-Ons with bridge."
		},
		"reloadAutoCompletions": {
			"name": "Reload Auto-Completions",
			"description": "Reloads all auto-completion data"
		},
		"reloadExtensions": {
			"name": "Reload Extensions",
			"description": "Reloads all extensions"
		},
		"moveToSplitScreen": {
			"name": "Move to Split Screen",
			"description": "Opens a split screen view and moves this tab to it"
		},
		"closeTab": {
			"name": "Close Tab",
			"description": "Close this tab"
		},
		"closeAll": {
			"name": "Close All",
			"description": "Close all tabs"
		},
		"closeTabsToRight": {
			"name": "Close Tabs to the Right",
			"description": "Close all tabs to the right-hand side of this tab"
		},
		"closeAllSaved": {
			"name": "Close All Saved",
			"description": "Close all saved tabs"
		},
		"closeOtherTabs": {
			"name": "Close other Tabs",
			"description": "Close all tabs except this tab"
		},
		"clearAllNotifications": {
			"name": "Clear All Notifications",
			"description": "Clears all current notifications"
		},
		"pluginInstallLocation": {
			"global": {
				"name": "Install Globally",
				"description": "Global extensions are accessible in all of your projects"
			},
			"local": {
				"name": "Install Locally",
				"description": "Local extensions are only accessible inside of the projects you add them to"
			}
		},
		"toObject": {
			"name": "Transform to Object"
		},
		"toArray": {
			"name": "Transform to Array"
		},
		"documentationLookup": {
			"name": "View Documentation",
			"noDocumentation": "No documentation available for"
		},
		"toggleReadOnly": {
			"name": "Toggle Read-Only Mode",
			"description": "Toggle read-only mode for the currently opened file"
		},
		"keepInTabSystem": {
			"name": "Keep in Tab System",
			"description": "Converts this tab to a permanent tab"
		},
		"importBrproject": {
			"name": "Import Project",
			"description": "Import a project from a .brproject file"
		},
		"downloadFile": {
			"name": "Download File",
			"description": "Download the currently opened file"
		},
		"undo": {
			"name": "Undo",
			"description": "Undo the last action"
		},
		"redo": {
			"name": "Redo",
			"description": "Redo the last action"
		},
		"goToDefinition": {
			"name": "Go to Definition",
			"description": "Go to the definition of the selected symbol"
		},
		"goToSymbol": {
			"name": "Go to Symbol",
			"description": "Opens a dialog to select a symbol to go to"
		},
		"formatDocument": {
			"name": "Format Document",
			"description": "Format the currently opened document"
		},
		"changeAllOccurrences": {
			"name": "Change All Occurrences",
			"description": "Change all occurrences of the selected text"
		},
		"tgaMaskToggle": {
			"name": "Show/Hide Alpha Mask"
		},
		"recompileChanges": {
			"name": "Compile Changes",
			"description": "Compile all files that were edited without bridge. This will not compile any changes made in the editor itself after disabling watch mode"
		}
	},
	"toolbar": {
		"project": {
			"name": "Project"
		},
		"file": {
			"name": "File",
			"preferences": {
				"name": "Preferences"
			}
		},
		"edit": {
			"name": "Edit"
		},
		"view": {
			"name": "View",
			"togglePackExplorer": {
				"name": "Toggle Pack Explorer",
				"description": "Toggle the pack explorer that appears inside of bridge.'s sidebar"
			},
			"openFileSearch": {
				"name": "Open Find & Replace",
				"description": "Opens a new Find & Replace tab"
			}
		},
		"tools": {
			"name": "Tools"
		},
		"help": {
			"name": "Help"
		}
	},
	"packExplorer": {
		"name": "Pack Explorer",
		"searchFiles": "Search files...",
		"categories": "Categories",
		"move": {
			"toLocal": "Move to Local Folder",
			"toBridgeFolder": "Move to bridge. Folder"
		},
		"refresh": {
			"name": "Refresh Project",
			"description": "Fetch the current project for newly added files"
		},
		"noProjectView": {
			"noProjectsFound": "It does not look like you have any projects yet!",
			"createLocalProject": "Create Local Project",
			"chooseBridgeFolder": "Choose bridge. Folder",
			"accessBridgeFolder": "Access bridge. Folder",
			"projectNoLongerExists": "It looks like this project no longer exists!"
		},
		"restartWatchMode": {
			"name": "Restart Watch Mode",
			"description": "Restart the compiler's watch mode to delete the current build output, rebuild the complete project and then start watching for further changes.",
			"confirmDescription": "Are you sure that you want to restart the compiler's watch mode? This can take some time depending on the size of your project. Restarting the compiler deletes your add-on from the com.mojang folder and recompiles it based on your bridge. folder!"
		},
		"createPreset": "New File",
		"projectConfig": {
			"name": "Open Project Config",
			"missing": "It looks like this project has no config.json file. Every project needs a project config in order to work correctly."
		},
		"openProjectFolder": {
			"name": "Open Project Folder"
		},
		"exportAs": {
			"name": "Export As",
			"mcaddon": ".mcaddon",
			"brproject": ".brproject",
			"mcworld": ".mcworld",
			"mctemplate": ".mctemplate"
		},
		"fileDiagnostics": {
			"fileUnused": "This file is not used within your project"
		}
	},
	"sidebar": {
		"openedFolders": {
			"name": "Opened Folders",
			"removeFolder": "Remove From View"
		},
		"compiler": {
			"name": "Compiler",
			"categories": {
				"watchMode": {
					"name": "Watch Mode",
					"settings": {
						"watchModeActive": {
							"name": "Watch Mode",
							"description": "Enable or disable automatically recompiling files when you make changes with bridge."
						},
						"autoFetchChangedFiles": {
							"name": "Auto Fetch",
							"description": "Automatically search the project for changed files upon starting bridge."
						}
					}
				},
				"profiles": "Build Profiles",
				"outputFolders": "Output Folders",
				"logs": {
					"name": "Logs",
					"noLogs": "Dash did not produce any logs to show yet."
				}
			},
			"default": {
				"name": "Default Config",
				"description": "Run bridge.'s compiler with the default compiler configuration that is part of your project's \\"config.json\\" file."
			},
			"actions": {
				"runLastProfile": "Run Last Profile"
			}
		},
		"extensions": {
			"name": "Extensions"
		},
		"notifications": {
			"socials": {
				"message": "Socials"
			},
			"gettingStarted": {
				"message": "Getting Started"
			},
			"installApp": {
				"message": "Install App"
			},
			"updateAvailable": {
				"message": "Update Available"
			},
			"updateExtensions": "Update All Extensions"
		}
	},
	"experimentalGameplay": {
		"cavesAndCliffs": {
			"name": "Caves and Cliffs",
			"description": "Enables auto-completions for the new mountain generation inside of biomes."
		},
		"holidayCreatorFeatures": {
			"name": "Holiday Creator Features",
			"description": "Enables auto-completions for the data driven item and block features."
		},
		"creationOfCustomBiomes": {
			"name": "Creation of Custom Biomes",
			"description": "Enables the creation of custom biomes, features and feature rules."
		},
		"additionalModdingCapabilities": {
			"name": "Additional Modding Capabilities",
			"description": "Enables the Scripting API in the manifest and allows you to create scripts with auto-completions."
		},
		"upcomingCreatorFeatures": {
			"name": "Upcoming Creator Features",
			"description": "Enables the creation of fog volume files and provides auto-completions for entity properties."
		},
		"enableGameTestFramework": {
			"name": "Enable GameTest Framework",
			"description": "Enables the GameTest related modules in the manifest and allows you to create GameTest scripts with auto-completions."
		},
		"experimentalMolangFeatures": {
			"name": "Experimental Molang Features",
			"description": "Enables auto-completions for experimental Molang queries."
		},
		"theWildUpdate": {
			"name": "The Wild Update",
			"description": "Enables auto-completions for new features introduced in the Wild Update, such as entity components."
		},
		"educationEdition": {
			"name": "Enable Education Edition",
			"description": "Enables auto-completions for education features such as material reducer recipes."
		}
	},
	"windows": {
		"sidebar": {
			"disabledItem": "This item is disabled"
		},
		"changelogWindow": {
			"title": "What's new?"
		},
		"openFile": {
			"title": "Open",
			"search": "Search file...",
			"noData": "No results..."
		},
		"assetPreview": {
			"title": "Asset Preview",
			"previewScale": "Preview Scale",
			"assetName": "Asset Name",
			"boneVisibility": "Bone Visibility",
			"backgroundColor": "Background Color",
			"outputResolution": "Output Resolution"
		},
		"createProject": {
			"welcome": "Welcome to bridge.!",
			"welcomeDescription": "Please create your first project in order to get started.",
			"omitPack": "Omit",
			"selectedPack": "Selected",
			"title": "Create Project",
			"packIcon": "Project Icon (optional)",
			"projectName": {
				"name": "Project Name",
				"invalidLetters": "Project name must not contain the following characters: \\"  \\\\ / : | < >  * ? ~",
				"mustNotBeEmpty": "You must enter a project name",
				"endsInPeriod": "Project name cannot end with a period"
			},
			"projectDescription": "Project Description (optional)",
			"projectPrefix": "Project Prefix",
			"projectAuthor": "Project Author",
			"projectTargetVersion": "Project Target Version",
			"rpAsBpDependency": "Register resource pack as behavior pack dependency",
			"bpAsRpDependency": "Register behavior pack as a resource pack dependency",
			"useLangForManifest": "Add pack name/description directly to the manifest",
			"bdsProject": "Set project for use with Bedrock Dedicated Servers",
			"create": "Create",
			"saveCurrentProject": "Do you want to save your current project before creating the new one? Any unsaved changes will get lost!",
			"individualFiles": {
				"name": "Individual Files",
				"file": {
					"player": {
						"name": "player.json",
						"description": "Edit how the default player behaves"
					},
					"tick": {
						"name": "tick.json",
						"description": "Define which functions to execute every tick"
					},
					"skins": {
						"name": "skins.json",
						"description": "Register the skins you have created"
					},
					"blocks": {
						"name": "blocks.json",
						"description": "Used to define how multiple block faces are combined to a single block"
					},
					"terrainTexture": {
						"name": "terrain_texture.json",
						"description": "Used to assign textures to block faces"
					},
					"itemTexture": {
						"name": "item_texture.json",
						"description": "Used to assign textures to items"
					},
					"flipbookTextures": {
						"name": "flipbook_textures.json",
						"description": "Used for animating block textures"
					},
					"biomesClient": {
						"name": "biomes_client.json",
						"description": "Used to define how biome specific effects render"
					},
					"sounds": {
						"name": "sounds.json",
						"description": "Used to define sounds for specific game features"
					},
					"soundDefinitions": {
						"name": "sound_definitions.json",
						"description": "Used to register ids for sound files to be used elsewhere in the project"
					}
				}
			}
		},
		"createPreset": {
			"title": "Create Preset",
			"searchPresets": "Search presets...",
			"overwriteFiles": "This preset overwrites one or more existing files. Do you want to continue?",
			"overwriteFilesConfirm": "Continue",
			"overwriteUnsavedChanges": "This preset overwrites one or more files with unsaved changes. Do you want to continue?",
			"overwriteUnsavedChangesConfirm": "Continue",
			"validationRule": {
				"alphanumeric": "You may only use alphanumeric characters and/or underscores",
				"lowercase": "You may only use lowercase letters",
				"required": "This field is required",
				"noEmptyFolderNames": "Folder name may not be empty"
			},
			"showAllPresets": "Show all presets",
			"disabledPreset": {
				"experimentalGameplay": "Required experimental gameplay toggle condition(s) not met",
				"packTypes": "Required pack condition(s) not met",
				"targetVersion": "Required target version not met",
				"manifestDependency": "Required BP manifest dependencies are missing"
			}
		},
		"deleteProject": {
			"confirm": "Delete",
			"description": "Are you sure you want to delete this project?"
		},
		"socials": {
			"title": "Socials",
			"content": "Check out our Twitter, Github and join the official bridge. Discord server!",
			"discord": "Discord",
			"twitter": "Twitter",
			"github": "Github"
		},
		"projectChooser": {
			"title": "Choose Project",
			"description": "Select the currently active project",
			"searchProjects": "Search projects...",
			"loadAllProjects": "Load All",
			"openPacks": "Open Packs",
			"localProject": {
				"name": "Local Project",
				"description": "Local projects cannot be accessed outside of bridge."
			},
			"comMojangProject": {
				"name": "com.mojang Project",
				"description": "This project was loaded directly from your com.mojang folder",
				"uninstallWarning": "This project will be deleted if you uninstall Minecraft."
			},
			"newProject": {
				"name": "New Project",
				"description": "Create a new bridge. project."
			},
			"saveCurrentProject": {
				"name": "Save Project",
				"description": "Download your current project as a .brproject file to save changes that you have made."
			},
			"openNewProject": {
				"name": "Open Project",
				"description": "Open a different project by selecting the corresponding .brproject file.",
				"saveCurrentProject": "Do you want to save your current project before loading in the new one?"
			},
			"wrongFileType": "Project must be a .brproject or .mcaddon file",
			"addPack": "Add Pack"
		},
		"filePath": {
			"title": "Choose File Path"
		},
		"lootSimulatorSettings": {
			"title": "Simulator Settings",
			"repeat": {
				"name": "Repeat Options",
				"amount": {
					"name": "Repeat",
					"description": "Repeat the loot table a set amount of times"
				},
				"itemFound": {
					"name": "Item Identifier",
					"description": "Run the loot table until an item stack with the specified identifier is found"
				},
				"quantityFound": {
					"name": "Quantity",
					"description": "Run the loot table until an item stack with the specified quantity is found"
				}
			},
			"killConditions": {
				"looting": {
					"name": "Looting Enchant",
					"description": "The level of looting used to run the table, 0 for no looting"
				}
			}
		},
		"settings": {
			"title": "Settings",
			"searchSettings": "Search settings...",
			"reloadRequired": "You need to reload bridge. in order to apply the changes made to the settings.",
			"sidebar": {
				"name": "Sidebar",
				"sidebarRight": {
					"name": "Sidebar Right",
					"description": "Moves the sidebar to the right side of the screen"
				},
				"sidebarSize": {
					"name": "Sidebar Size",
					"description": "Changes the width of the expanded sidebar area."
				},
				"shrinkSidebarElements": {
					"name": "Shrink Sidebar Elements",
					"description": "Shrink the size of bridge.'s sidebar elements"
				}
			},
			"appearance": {
				"name": "Appearance",
				"colorScheme": {
					"name": "Color Scheme",
					"description": "Choose the color scheme of bridge.'s UI"
				},
				"darkTheme": {
					"name": "Dark Theme",
					"description": "Select the default dark theme bridge. uses"
				},
				"lightTheme": {
					"name": "Light Theme",
					"description": "Select the default light theme bridge. uses"
				},
				"localDarkTheme": {
					"name": "Local Dark Theme",
					"description": "Choose a dark theme for the currently active project"
				},
				"localLightTheme": {
					"name": "Local Light Theme",
					"description": "Choose a light theme for the currently active project"
				},
				"fontSize": {
					"name": "Font Size",
					"description": "Change the font size of bridge.'s text"
				},
				"editorFontSize": {
					"name": "Code Font Size",
					"description": "Change the font size of bridge.'s code editor"
				},
				"editorFont": {
					"name": "Code Font",
					"description": "Change the font of bridge.'s code editor"
				},
				"font": {
					"name": "Font",
					"description": "Change the font that is used inside of bridge.'s user interface"
				},
				"hideToolbarItems": {
					"name": "Hide Toolbar Items",
					"description": "Make bridge. feel at home on MacOS: Move all toolbar items into a new menu button"
				}
			},
			"general": {
				"name": "General",
				"language": {
					"name": "Language",
					"description": "Choose a language for bridge. to use"
				},
				"collaborativeMode": {
					"name": "Collaborative Mode",
					"description": "Forces full refresh of the cache upon switching projects. Disable when you work alone and you only use bridge. to edit your project"
				},
				"packSpider": {
					"name": "Pack Spider",
					"description": "Pack Spider connects files inside of your projects and presents the connections to you in a virtual file system"
				},
				"formatOnSave": {
					"name": "Format On Save",
					"description": "Formats your text files upon saving them"
				},
				"openLinksInBrowser": {
					"name": "Open Links in Default Browser",
					"description": "Open links inside of your default browser instead of a native app window"
				},
				"restoreTabs": {
					"name": "Restore Tabs",
					"description": "Restore your tabs from when you last used bridge. upon opening the app"
				},
				"resetBridgeFolder": {
					"name": "Select Root Folder",
					"description": "Choose the main folder bridge. operates on"
				}
			},
			"developer": {
				"name": "Developer",
				"simulateOS": {
					"name": "Simulate OS",
					"description": "Simulate a different OS for testing platform specific behavior"
				},
				"devMode": {
					"name": "Developer Mode",
					"description": "Enable the developer mode for this app"
				},
				"forceDataDownload": {
					"name": "Force Data Download",
					"description": "Ignore the cached app data and instead download the latest data"
				}
			},
			"actions": {
				"name": "Actions"
			},
			"projects": {
				"name": "Projects",
				"defaultAuthor": {
					"name": "Default Author",
					"description": "The default author for new projects"
				},
				"incrementVersionOnExport": {
					"name": "Increment Version",
					"description": "Automatically increment the version number inside of your pack manifests when exporting a project"
				},
				"addGeneratedWith": {
					"name": "Add \\"generated_with\\"",
					"description": "Add the \\"generated_with\\" metadata to your projects' manifests"
				}
			},
			"editor": {
				"jsonEditor": {
					"name": "JSON Editor",
					"description": "Choose how you want to edit JSON files"
				},
				"bridgePredictions": {
					"name": "bridge. Predictions",
					"description": "Enable bridge. predictions to let the app intelligently decide whether to add a value or object within bridge.'s tree editor. This simplifies editing JSON significantly"
				},
				"bracketPairColorization": {
					"name": "Bracket Pair Colorization",
					"description": "Give matching brackets an unique color"
				},
				"wordWrap": {
					"name": "Word Wrap",
					"description": "Wrap words to disable horizontal scrolling"
				},
				"wordWrapColumns": {
					"name": "Word Wrap Columns",
					"description": "Defines after how many columns the editor should wrap words"
				},
				"compactTabDesign": {
					"name": "Compact Tab Design",
					"description": "Display tabs inside of the tab system in a more compact way"
				},
				"keepTabsOpen": {
					"name": "Keep Tabs Open",
					"description": "By default, opening a new tab closes the previously opened tab if it was not interacted with"
				},
				"automaticallyOpenTreeNodes": {
					"name": "Automatically Open Tree Nodes",
					"description": "Inside of bridge.'s tree editor, automatically open nodes when you select them"
				},
				"dragAndDropTreeNodes": {
					"name": "Drag and Drop Tree Nodes",
					"description": "Disable/enable drag & drop for tree nodes inside of bridge.'s tree editor"
				}
			}
		},
		"projectFolder": {
			"title": "Project Folder",
			"content": "bridge. needs access to its project folder in order to work correctly."
		},
		"extensionStore": {
			"title": "Extension Store",
			"searchExtensions": "Search Extension...",
			"deleteExtension": "Delete Extension",
			"activateExtension": "Activate Extension",
			"deactivateExtension": "Deactivate Extension",
			"installLocal": "Install Local",
			"installGlobal": "Install Global",
			"offlineError": "Failed to load extensions. Please confirm that your device has an active network connection.",
			"incompatibleVersion": "Incompatible bridge. version",
			"compilerPluginDownload": {
				"compilerPlugins": "Compiler Plugins",
				"title": "Downloaded Compiler Plugin",
				"description": "You have just downloaded a new compiler plugin. Make sure to add it to your compiler config file or otherwise it won't have an effect.",
				"openConfig": "Open Config"
			}
		},
		"pluginInstallLocation": {
			"title": "Choose Install Location"
		},
		"unsavedFile": {
			"description": "Do you want to save your changes to this file before closing it?",
			"save": "Save & Close"
		},
		"browserUnsupported": {
			"title": "Browser Warning",
			"description": "In order to get the best experience with bridge., you need to use Chrome (excluding Chrome 93/94) or Edge (Chromium) on desktop. If you continue, you will not be able to save files directly and you will need to download your project in order to save it or test your changes in Minecraft.",
			"continue": "Continue Anyway"
		},
		"invalidJson": {
			"title": "Invalid JSON",
			"description": "bridge.'s tree editor cannot open files that contain invalid JSON. You can switch to the \\"Raw Text\\" editor type inside of the settings to manually fix the issue."
		},
		"loadingWindow": {
			"titles": {
				"loading": "Loading..."
			}
		},
		"upgradeFs": {
			"title": "Upgrade File System?",
			"description": "Your browser now supports saving files directly to your computer. Do you want to upgrade now?"
		}
	},
	"taskManager": {
		"tasks": {
			"packIndexing": {
				"title": "Indexing Packs",
				"description": "bridge. is collecting data about your pack that is needed for its intelligent features"
			},
			"compiler": {
				"title": "Compiling Project",
				"description": "bridge. is compiling your project to make it ready for import into Minecraft"
			},
			"unzipper": {
				"name": "Unpacking ZIP",
				"description": "bridge. is currently unpacking a ZIP file."
			},
			"loadingSchemas": {
				"name": "Loading Auto-Completions",
				"description": "bridge. is currently loading its auto-completion data."
			}
		}
	},
	"fileDropper": {
		"importFiles": "Drop files here to import them!",
		"importFailed": "bridge. was unable to import the following files:",
		"andMore": "...and more!",
		"importMethod": {
			"name": "Import Method",
			"folder": {
				"output": {
					"name": "Output Folder",
					"description": "Sets this folder as a new output folder"
				},
				"open": {
					"name": "Open Folder",
					"description": "Opens this folder in bridge.'s file explorer"
				}
			}
		},
		"mcaddon": {
			"missingManifests": "bridge. was unable to load data from your .mcaddon or .mpack file because it wasn't able to find a pack manifest file inside of it."
		},
		"saveToProject": {
			"title": "Save to Project",
			"description1": "Save the file ",
			"description2": " inside of your project."
		},
		"openFile": {
			"title": "Open File",
			"description1": "Open the file ",
			"description2": " and save edits to the original file."
		}
	},
	"comMojang": {
		"folderDropped": "Do you want to set this folder as your default com.mojang folder?",
		"title": "Access to folder \\"com.mojang\\"",
		"permissionRequest": "bridge. needs access to your \\"com.mojang\\" folder in order to compile projects to it.",
		"status": {
			"sucess": "Syncing your projects to com.mojang is setup correctly.",
			"deniedPermission": "You setup com.mojang syncing but you did not grant bridge. permission to the folder.",
			"notSetup": "You have not setup com.mojang syncing yet. Drag your com.mojang folder onto bridge. to do so.",
			"notAvailable": "Syncing projects to the com.mojang folder is only available for Chrome and Edge users."
		}
	},
	"findAndReplace": {
		"name": "Find & Replace",
		"findOnly": "Find",
		"search": "Search",
		"replace": "Replace",
		"replaceAll": "Replace All",
		"includeFiles": "Files to Include",
		"excludeFiles": "Files to Exclude",
		"noResults": "No results found.",
		"noSearch": "Once you start typing, results for your search query will appear here."
	},
	"preview": {
		"name": "Preview",
		"viewAnimation": "View Animation",
		"viewModel": "View Model",
		"viewParticle": "View Particle",
		"viewEntity": "View Entity",
		"viewBlock": "View Block",
		"simulateLoot": "Simulate Loot",
		"failedClientEntityLoad": "Failed to load connected client entity",
		"invalidEntity": "Cannot open preview for an entity with invalid JSON. Please fix JSON errors inside of the file and try again.",
		"chooseGeometry": "Choose Geometry",
		"noGeometry": "No valid geometry found inside of this file. Make sure that your JSON is valid, that the file structure is correct and that a geometry with the provided identifier exists.",
		"lootTableSimulator": {
			"emptyLootOutput": "Output is empty, try running the loot table to collect results.",
			"data": {
				"value": "Data Value",
				"enchantments": "Enchantments",
				"blockStates": "Block States",
				"itemAuxValue": "Aux Value",
				"eggIdentifier": "Spawns Entity",
				"bannerType": "Banner Type",
				"bookData": {
					"view": "View Book",
					"title": "Title",
					"author": "Author"
				},
				"durability": "Durability",
				"lore": "Lore",
				"displayName": "Display Name",
				"mapDestination": "Map Destination"
			}
		}
	},
	"initialSetup": {
		"welcome": "Welcome to bridge. v2!",
		"welcomeCaption": "A powerful IDE for Minecraft Add-Ons",
		"step": {
			"installApp": {
				"name": "Install bridge.",
				"description": "Click here to install bridge. v2 as an app to your device."
			},
			"bridge": {
				"name": "bridge. Folder",
				"description": "Please create a folder where bridge. can save app related data and your add-on projects."
			},
			"bridgeProject": {
				"name": "bridge. Project",
				"description": "Do you want to create a new project or import an existing project from a .brproject file?",
				"createNew": {
					"name": "New Project",
					"description": "Create a new project."
				},
				"importExisting": {
					"name": "Import Project",
					"description": "Import an existing project."
				}
			},
			"comMojang": {
				"name": "com.mojang Folder",
				"description": "Drag your com.mojang folder onto bridge. to setup syncing of projects to this folder. This makes your add-ons accessible inside of Minecraft for Windows 10 automatically. Setting up com.mojang syncing can be done at any point in time while bridge. is open.",
				"extraDescription": "Drag your com.mojang folder onto bridge."
			},
			"editorType": {
				"name": "Choose Editor Type",
				"description": "How do you want to edit JSON files? You can change your choice inside of bridge.'s settings later!",
				"rawText": {
					"name": "Raw Text",
					"description": "Edit JSON as raw text. Ideal for intermediate to advanced developers. Comes with advanced auto-completions and JSON validation."
				},
				"treeEditor": {
					"name": "Tree Editor",
					"description": "Edit JSON as a tree-like structure that requires little to no JSON knowledge. Ideal for beginners and intermediate creators."
				}
			}
		}
	},
	"editors": {
		"treeEditor": {
			"add": "Add",
			"addObject": "Add Object",
			"addArray": "Add Array",
			"addValue": "Add Value",
			"forceValue": "Force Value",
			"edit": "Edit"
		}
	},
	"functionValidator": {
		"actionName": "Validate Function",
		"tabName": "Function Validator",
		"errors": {
			"common": {
				"expectedEquals": "Expected equals!",
				"expectedValue": "Expected value!",
				"expectedType": {
					"part1": "Expected type '",
					"part2": "' but got type of '",
					"part3": "'!"
				},
				"expectedComma": "Expected comma!",
				"unclosedString": "Unclosed string!",
				"spaceAtStart": "Spaces at the start are not supported!",
				"expectedColon": "Expected colon!",
				"unexpectedOpenCurlyBracket": "Unexpected open curly bracket!",
				"unexpectedCloseCurlyBracket": "Unexpected close curly bracket!",
				"unexpectedOpenSquareBracket": "Unexpected open square bracket!",
				"unexpectedCloseSquareBracket": "Unexpected close square bracket!"
			},
			"command": {
				"empty": "Empty commands are not supported!",
				"invalid": {
					"part1": "Command: '",
					"part2": "' is not a valid command!"
				}
			},
			"identifiers": {
				"missingNamespace": "Missing namespace in identifier!"
			},
			"ranges": {
				"missingFirstNumber": "Missing first number in range!",
				"missingDot": "Missing dot in range!",
				"missingSecondNumber": "Missing second number in range!"
			},
			"selectors": {
				"emptyComplex": "Unexpected empty complex selector!",
				"expectedStringAsAttribute": "Selector attribute must be a string!",
				"invalidSelectorAttribute": {
					"part1": "'",
					"part2": "' is not a valid selector attribute!"
				},
				"unsupportedNegation": {
					"part1": "Selector attribute: '",
					"part2": "' does not support negation!"
				},
				"multipleInstancesNever": {
					"part1": "Selector attribute: '",
					"part2": "' does not support multiple instances!"
				},
				"multipleInstancesNegated": {
					"part1": "Selector attribute: '",
					"part2": "' only supports multiple instances when negated!"
				},
				"valueNotValid": {
					"part1": "Selector attribute does not support value '",
					"part2": "'!"
				},
				"expectedLetterAfterAt": "Expected letter after '@'!",
				"invalid": {
					"part1": "Selector: '",
					"part2": "' is not a valid selector!"
				},
				"selectorNotBeforeOpenSquareBracket": "Expected a selector before '['!"
			},
			"scoreData": {
				"empty": "Unexpected empty score data!",
				"expectedStringAsAttribute": "Score data attribute must be a string!",
				"invalidType": {
					"part1": "This score data value type: '",
					"part2": "' is not supported!"
				},
				"repeat": "Score data value must not repeat!"
			},
			"arguments": {
				"noneValid": {
					"part1": "No valid command variations found! Argument ",
					"part2": " may be invalid! It is of type '",
					"part3": "' but that type is not supported in the current variation tree."
				},
				"noneValidEnd": {
					"part1": "No valid command variations found! You may be missing some arguments or argument ",
					"part2": " may be invalid!"
				}
			}
		},
		"warnings": {
			"schema": {
				"familyNotFound": {
					"part1": "Could not find family '",
					"part2": "'. This could either be a mistake or the family is from another addon."
				},
				"typeNotFound": {
					"part1": "Could not find type '",
					"part2": "'. This could either be a mistake or the type is from another addon."
				},
				"tagNotFound": {
					"part1": "Could not find tag '",
					"part2": "'. This could either be a mistake or the tag is from another addon."
				},
				"schemaValueNotFound": {
					"part1": "Could not find schema value '",
					"part2": "'. This could either be a mistake or the schema value is from another addon."
				}
			},
			"data": {
				"missingData": "Some data was not correctly loaded!"
			}
		}
	}
}
`,_i=[{id:"english",name:"English",file:"en.json",codes:["en-US","en-UK"]},{id:"german",name:"Deutsch",file:"de.json",codes:["de-DE"]},{id:"japanese",name:"\u65E5\u672C\u8A9E",file:"ja.json",codes:["ja-JP"]},{id:"korean",name:"\uD55C\uAD6D\uC5B4",file:"ko.json",codes:["ko-KR"]},{id:"chineseCN",name:"\u4E2D\u6587",file:"zh-CN.json",codes:["zh-CN"]},{id:"chineseTW",name:"\u4E2D\u6587(\u81FA\u7063)",file:"zh-TW.json",codes:["zh-TW"]},{id:"netherlands",name:"Nederlands",file:"nl.json",codes:["nl-NL"]}],$r=Object.fromEntries(Object.entries(Object.assign({"../../locales/de.json":()=>ue(()=>import("./de.f392a7df.js"),[]).then(s=>s.default),"../../locales/ja.json":()=>ue(()=>import("./ja.be69ec83.js"),[]).then(s=>s.default),"../../locales/ko.json":()=>ue(()=>import("./ko.d3a6ccf6.js"),[]).then(s=>s.default),"../../locales/nl.json":()=>ue(()=>import("./nl.1bae55b2.js"),[]).then(s=>s.default),"../../locales/zh-CN.json":()=>ue(()=>import("./zh-CN.d15700c0.js"),[]).then(s=>s.default),"../../locales/zh-TW.json":()=>ue(()=>import("./zh-TW.f51a50b3.js"),[]).then(s=>s.default)})).map(([s,e])=>[s.split("/").pop(),e])),Pi=JSON.parse(Ar);class be{static getAvailableLanguages(){return _i.sort((e,t)=>e.name.localeCompare(t.name)).map(e=>({text:e.name,value:e.id}))}static getCurrentLanguageId(){return this.currentLanuageId}static async setDefaultLanguage(){const e=await fe("language");if(e)await this.applyLanguage(e);else for(const t of navigator.languages){const i=_i.find(({codes:n})=>n.includes(t));if(!!i){await this.applyLanguage(i.id);break}}}static async applyLanguage(e){var n;if(e===this.currentLanuageId)return;if(e==="english"){this.currentLanguage=Si(Pi),this.currentLanuageId=e;return}const t=(n=_i.find(a=>a.id===e))==null?void 0:n.file;if(!t)throw new Error(`[Locales] Language with id "${e}" not found`);const i=JSON.parse(await $r[t]());if(!i)throw new Error(`[Locales] Language with id "${e}" not found: File "${t}" does not exist`);this.currentLanguage=si(Si(Pi),Si({...i})),this.currentLanuageId=e}static translate(e){if(!e)return"";if(e.startsWith("[")&&e.endsWith("]"))return e.slice(1,-1);const t=e.split(".");let i=this.currentLanguage;for(const n of t)if(i=i[n],!i)return console.warn(`[Locales] Translation key "${e}" not found`),e;return typeof i!="string"?(console.warn(`[Locales] Translation key "${e}" not found`),e):i}}be.currentLanguage=Pi;be.currentLanuageId="english";function B(s){return be.translate(s)}function Si(s){return typeof window.structuredClone=="function"?window.structuredClone(s):JSON.parse(JSON.stringify(s))}function I(){return{t:s=>be.translate(s)}}let S=G({});function Dr(s){for(const e in s)V(S,e,s[e])}function J(){var e;if(((e=S==null?void 0:S.developers)==null?void 0:e.simulateOS)&&S.developers.simulateOS!=="auto")return S.developers.simulateOS;const s=navigator.platform.toLowerCase();return s.includes("win")?"win32":s.includes("linux")?"linux":s.includes("mac")?"darwin":(console.error(`Unknown platform: ${s}`),"win32")}class M extends H{constructor(e){var t;super(),this.config=e,this.type="action",this.addPadding=!1,this.id=(t=e.id)!=null?t:D()}get name(){return this.config.name}get icon(){return this.config.icon}get description(){return this.config.description}get color(){return this.config.color}get isDisabled(){var e,t,i,n;return typeof this.config.isDisabled=="function"?(i=(t=(e=this.config).isDisabled)==null?void 0:t.call(e))!=null?i:!1:(n=this.config.isDisabled)!=null?n:!1}getConfig(){return this.config}async trigger(){if(!this.isDisabled)return this.dispatch(),await this.config.onTrigger(this)}withPadding(){const e=new M(this.config);return e.addPadding=!0,e}}const Kt=new Kn({breakpoint:{mobileBreakpoint:"xs"},theme:{dark:!0,options:{customProperties:!0,variations:!1},themes:{dark:{primary:"#0073FF",secondary:"#0073FF",accent:"#0073FF",background:"#121212",sidebarNavigation:"#1F1F1F",expandedSidebar:"#1F1F1F",menu:"#424242",footer:"#111111",tooltip:"#1F1F1F"},light:{primary:"#0073FF",secondary:"#0073FF",accent:"#0073FF",background:"#fafafa",sidebarNavigation:"#FFFFFF",expandedSidebar:"#FFFFFF",tooltip:"#424242",toolbar:"#e0e0e0",footer:"#f5f5f5"}}}});function Sn(){return{isDarkMode:K(()=>Kt.framework.theme.dark)}}function Cn(){return{isMobile:K(()=>Kt.framework.breakpoint.mobile),isMinimalDisplay:K(()=>!Kt.framework.breakpoint.mdAndUp)}}function _(s,e,t,i,n,a,r,o){var c=typeof s=="function"?s.options:s;e&&(c.render=e,c.staticRenderFns=t,c._compiled=!0),i&&(c.functional=!0),a&&(c._scopeId="data-v-"+a);var d;if(r?(d=function(f){f=f||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!f&&typeof __VUE_SSR_CONTEXT__<"u"&&(f=__VUE_SSR_CONTEXT__),n&&n.call(this,f),f&&f._registeredComponents&&f._registeredComponents.add(r)},c._ssrRegister=d):n&&(d=o?function(){n.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:n),d)if(c.functional){c._injectStyles=d;var p=c.render;c.render=function(h,m){return d.call(m),p(h,m)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,d):[d]}return{exports:s,options:c}}const Er={__name:"DisplayAction",props:{action:{type:M,required:!0}},setup(s){const{t:e}=I(),{isDarkMode:t}=Sn(),{isMinimalDisplay:i}=Cn();return{__sfc:!0,t:e,isDarkMode:t,isMinimalDisplay:i,SimpleAction:M,platform:J,useDarkMode:Sn,useTranslations:I,useDisplay:Cn}}};var Mr=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-btn",{style:i.platform()==="darwin"?"border-radius: 8px":void 0,attrs:{text:!i.isMinimalDisplay,small:"",icon:i.isMinimalDisplay},on:{click:function(n){return e.action.trigger()}}},[t("v-icon",{class:{"mr-1":!0,"ml-1":i.isMinimalDisplay},attrs:{color:e.action.accent||"accent",small:""}},[e._v(" "+e._s(e.action.icon)+" ")]),i.isMinimalDisplay?e._e():t("span",{style:{"text-transform":"none","font-weight":"unset",color:i.isDarkMode?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.6)"}},[e._v(" "+e._s(i.t(e.action.name))+" ")])],1)},Ir=[],Or=_(Er,Mr,Ir,!1,null,null,null,null);const ss=Or.exports,Rr={name:"WindowsToolbar",components:{DisplayAction:ss},props:{windowTitle:String,actions:Array,sidebarWidth:{type:String,default:"25%"},hasCloseButton:{type:Boolean,default:!0},hasMaximizeButton:{type:Boolean,default:!0},hasSidebar:Boolean},computed:{isDarkMode(){return this.$vuetify.theme.dark}}};var Wr=function(){var e=this,t=e._self._c;return t("v-system-bar",{style:{"padding-right":"0px","padding-left":e.hasSidebar?`calc(${e.sidebarWidth} + 12px)`:void 0},attrs:{height:"30px",color:"toolbar"}},[t("span",[e._v(e._s(e.windowTitle))]),t("v-spacer"),t("v-toolbar-items",{staticClass:"px14-font"},[e._l(e.actions,function(i){return t("DisplayAction",{key:i.id,attrs:{action:i}})}),e._t("default"),e.hasMaximizeButton?t("v-btn",{attrs:{small:"",icon:""},on:{click:function(i){return i.stopPropagation(),e.$emit("toggleFullscreen")}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-plus")])],1):e._e(),e.hasCloseButton?t("v-btn",{staticClass:"mr-1",attrs:{small:"",icon:"",color:"error"},on:{click:function(i){return i.stopPropagation(),e.$emit("closeWindow")}}},[t("v-icon",{attrs:{color:e.isDarkMode?"white":"grey darken-1",small:""}},[e._v(" mdi-close ")])],1):e._e()],2)],1)},Lr=[],Nr=_(Rr,Wr,Lr,!1,null,null,null,null);const Br=Nr.exports;const Vr={props:{color:String,disabled:Boolean},data:()=>({windowHasFocus:!0}),mounted(){window.addEventListener("focus",this.enableButton),window.addEventListener("blur",this.disableButton)},destroyed(){window.removeEventListener("focus",this.enableButton),window.removeEventListener("blur",this.disableButton)},computed:{isDarkMode(){return this.$vuetify.theme.dark}},methods:{disableButton(){this.windowHasFocus=!1},enableButton(){this.windowHasFocus=!0}}};var Hr=function(){var e=this,t=e._self._c;return t("v-icon",{directives:[{name:"ripple",rawName:"v-ripple",value:!e.disabled,expression:"!disabled"}],staticClass:"mr-1",staticStyle:{"font-size":"15px"},attrs:{color:e.disabled||!e.windowHasFocus?e.isDarkMode?"grey darken-2":"grey":e.color,small:""},nativeOn:{click:function(i){return i.stopPropagation(),e.$emit("click")}}},[e._v(" mdi-checkbox-blank-circle ")])},Ur=[],zr=_(Vr,Hr,Ur,!1,null,null,null,null);const qr=zr.exports;const Jr={components:{MacButton:qr},props:{hasCloseButton:{type:Boolean,default:!0},hasMinimizeButton:{type:Boolean,default:!1},hasMaximizeButton:{type:Boolean,default:!0}},computed:{isDarkMode(){return this.$vuetify.theme.dark}}};var Gr=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{position:"fixed","z-index":"1"}},[e.hasCloseButton?t("MacButton",{attrs:{color:"error"},on:{click:function(i){return e.$emit("closeWindow")}}}):e._e(),e.hasCloseButton?t("MacButton",{attrs:{color:"warning",disabled:!e.hasMinimizeButton},on:{click:function(i){return e.$emit("minimizeWindow")}}}):e._e(),e.hasCloseButton?t("MacButton",{attrs:{color:"success",disabled:!e.hasMaximizeButton},on:{click:function(i){return e.$emit("toggleFullscreen")}}}):e._e()],1)},Kr=[],Yr=_(Jr,Gr,Kr,!1,null,null,null,null);const as=Yr.exports;const Qr={name:"MacToolbar",components:{MacWindowControls:as,DisplayAction:ss},props:{windowTitle:String,hasSidebar:Boolean,actions:Array,sidebarWidth:{type:String,default:"25%"},hasCloseButton:{type:Boolean,default:!0},hasMinimizeButton:{type:Boolean,default:!1},hasMaximizeButton:{type:Boolean,default:!0}}};var Zr=function(){var e=this,t=e._self._c;return t("v-system-bar",{attrs:{height:"30px",color:"toolbar"}},[t("span",{class:{"window-title":!e.hasSidebar},style:{"padding-left":e.hasSidebar?`calc(${e.sidebarWidth} + 12px)`:void 0}},[e._v(" "+e._s(e.windowTitle)+" ")]),t("div",{staticStyle:{position:"absolute",top:"3px"}},[e.hasSidebar?e._e():t("MacWindowControls",e._g({attrs:{hasCloseButton:e.hasCloseButton,hasMaximizeButton:e.hasMaximizeButton,hasMinimizeButton:e.hasMinimizeButton}},e.$listeners))],1),t("v-spacer"),e._l(e.actions,function(i){return t("DisplayAction",{key:i.id,attrs:{action:i}})}),e._t("default")],2)},Xr=[],eo=_(Qr,Zr,Xr,!1,null,"39653066",null,null);const to=eo.exports;const io={name:"BaseWindow",components:{WindowsToolbar:Br,MacToolbar:to,MacWindowControls:as},props:{isFullscreen:Boolean,isVisible:Object|Boolean,shouldRender:Object|Boolean,isPersistent:Boolean,actions:Array,sidebarWidth:{type:String,default:"25%"},blurBackground:{type:Boolean,default:!0},hideToolbar:Boolean,windowTitle:String,hasCloseButton:{type:Boolean,default:!0},hasMaximizeButton:{type:Boolean,default:!1},width:{type:Number,default:1600},maxWidth:{type:Number,default:1600},height:{type:Number,default:800},maxHeight:{type:Number,default:800},heightUnset:Boolean,percentageHeight:Number,percentageWidth:Number,maxPercentageHeight:Number,maxPercentageWidth:Number,isSmallPopup:Boolean},setup(){const{t:s}=I();return{t:s}},data(){return{platform:J(),globalWindowWidth:window.innerWidth,globalWindowHeight:window.innerHeight,updateWindowSize:Ue(function(){this.globalWindowWidth=window.innerWidth,this.globalWindowHeight=window.innerHeight},200).bind(this)}},mounted(){window.addEventListener("resize",this.updateWindowSize)},destroyed(){window.removeEventListener("resize",this.updateWindowSize)},computed:{calcSidebarWidth(){return this.$vuetify.breakpoint.mobile?"76px":this.sidebarWidth},isFullScreenOrMobile(){return!this.isSmallPopup&&this.$vuetify.breakpoint.mobile||this.isFullscreen},isDarkMode(){return this.$vuetify.theme.dark},windowWidth(){return this.percentageWidth==null?this.width:this.globalWindowWidth/100*this.percentageWidth},windowHeight(){return this.percentageHeight==null?this.height:this.globalWindowHeight/100*this.percentageHeight-150},maxWindowWidth(){return this.maxPercentageWidth==null?this.maxWidth:this.globalWindowWidth/100*this.maxPercentageWidth},maxWindowHeight(){return!this.isSmallPopup&&this.$vuetify.breakpoint.mobile?this.globalWindowHeight-!this.hideToolbar*30-!!this.$slots.actions*52:this.maxPercentageHeight==null?this.maxHeight:this.globalWindowHeight/100*this.maxPercentageHeight-150}}};var no=function(){var e=this,t=e._self._c;return t("v-dialog",{attrs:{value:e.isVisible,fullscreen:!e.isSmallPopup&&e.$vuetify.breakpoint.mobile,persistent:e.isPersistent,"hide-overlay":!e.blurBackground,"max-width":e.isFullScreenOrMobile?e.maxWindowWidth:e.windowWidth,"content-class":"no-overflow"},on:{input:function(i){return e.$emit("closeWindow")}}},[t("v-card",{ref:"card",attrs:{height:"100%",width:"100%",color:"background",rounded:"lg"}},[e.hideToolbar?e._e():t(e.platform==="darwin"?"MacToolbar":"WindowsToolbar",{tag:"component",attrs:{windowTitle:e.t(e.windowTitle),actions:e.actions,hasMaximizeButton:e.hasMaximizeButton,hasCloseButton:e.hasCloseButton,hasSidebar:!!e.$slots.sidebar,sidebarWidth:e.calcSidebarWidth},on:{toggleFullscreen:function(i){return e.$emit("toggleFullscreen")},closeWindow:function(i){return e.$emit("closeWindow")}}},[e._t("toolbar")],2),e.$slots.sidebar?t("v-navigation-drawer",{staticClass:"rounded-l-lg",staticStyle:{visibility:"visible",transform:"translateX(0)"},attrs:{absolute:"",width:e.calcSidebarWidth,permanent:"",clipped:"",stateless:"",color:"expandedSidebar"}},[e.platform==="darwin"?t("MacWindowControls",{staticClass:"pl-3 pt-1",staticStyle:{width:"calc(100% - 1px)","background-color":"var(--v-expandedSidebar-base)"},attrs:{hasMaximizeButton:e.hasMaximizeButton,hasCloseButton:e.hasCloseButton},on:{toggleFullscreen:function(i){return e.$emit("toggleFullscreen")},closeWindow:function(i){return e.$emit("closeWindow")}}}):e._e(),t("v-container",{class:{"pt-8":e.platform==="darwin"}},[e._t("sidebar")],2)],1):e._e(),t("v-card-text",{staticStyle:{"overflow-y":"auto"},style:{height:e.heightUnset?void 0:`${e.isFullScreenOrMobile?e.maxWindowHeight:e.windowHeight}px`,"max-height":`${e.maxWindowHeight}px`,"padding-top":e.hideToolbar?"24px":"12px","padding-left":e.$slots.sidebar?`calc(${e.calcSidebarWidth} + 12px)`:void 0}},[e._t("default")],2),e.$slots.actions?t("v-card-actions",{style:{"padding-left":e.$slots.sidebar?`calc(${e.sidebarWidth} + 12px)`:void 0},attrs:{"background-color":"footer"}},[e._t("actions")],2):e._e()],1)],1)},so=[],ao=_(io,no,so,!1,null,null,null,null);const de=ao.exports,ro=X({__name:"Information",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState();function n(){e.window.close()}return{__sfc:!0,t,props:e,state:i,close:n,BaseWindow:de}}});var oo=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,width:440,height:124,hasCloseButton:!1,isPersistent:e.window.isPersistent,isSmallPopup:!0},scopedSlots:e._u([{key:"default",fn:function(){return[t("p",{staticClass:"mt-2"},[e._v(e._s(i.t(e.window.description)))])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary"},on:{click:i.close}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(e._s(i.t("general.confirm")))])],1)]},proxy:!0}],null,!1,2422611214)}):e._e()},co=[],lo=_(ro,oo,co,!1,null,null,null,null);const po=lo.exports;class Y extends ${constructor(e,t=!1,i=!1){super(),this.disposeOnClose=t,this.keepAlive=i,this.windowUUID=D(),this.closeTimeout=null,this.state=G({isVisible:!1,shouldRender:!1,actions:[]}),this.component=k(e)}getState(){return this.state}defineWindow(){l.windowState.addWindow(this.windowUUID,this)}addAction(e){this.state.actions.push(e)}close(e){this.state.isVisible=!1,e!==null&&this.dispatch(e),this.keepAlive||(this.closeTimeout=window.setTimeout(()=>{this.state.shouldRender=!1,this.closeTimeout=null,this.disposeOnClose&&this.dispose()},600))}open(){this.state.shouldRender=!0,this.state.isVisible=!0,this.resetSignal(),this.closeTimeout!==null&&(window.clearTimeout(this.closeTimeout),this.closeTimeout=null)}dispose(){l.windowState.deleteWindow(this.windowUUID)}}class U extends Y{constructor(e){super(po,!0,!1),this.opts=e,this.defineWindow(),this.open()}get description(){return this.opts.description}get title(){var e,t;return(t=(e=this.opts.title)!=null?e:this.opts.name)!=null?t:"general.information"}get isPersistent(){var e;return(e=this.opts.isPersistent)!=null?e:!0}async close(){super.close(null),typeof this.opts.onClose=="function"&&await this.opts.onClose(),this.dispatch()}}const ze=G({});class ci{constructor(e){var t,i;this.config=e,this._isVisible=!1,this.id=(t=e.id)!=null?t:D(),V(ze,this.id,this),((i=this.config.isVisible)==null||i)&&this.show()}get icon(){return this.config.icon}get message(){return this.config.message}get color(){return this.config.color}get textColor(){return this.config.textColor}get isVisible(){return this._isVisible}onClick(){typeof this.config.onClick=="function"&&this.config.onClick()}onMiddleClick(){var e,t;(t=(e=this.config).onMiddleClick)==null||t.call(e),this.config.disposeOnMiddleClick&&Ee(ze,this.id)}addClickHandler(e){this.config.onClick=e}show(){this._isVisible||this.updateAppBadge(),this._isVisible=!0}dispose(){Ee(ze,this.id),this.updateAppBadge()}updateAppBadge(){typeof navigator.setAppBadge=="function"&&navigator.setAppBadge(Object.values(ze).filter(({isVisible:e})=>e).length)}}function li(s){return new ci(s)}function uo(){typeof navigator.clearAppBadge=="function"&&navigator.clearAppBadge();for(const[s]of Object.entries(ze))We.delete(ze,s)}function ho(s){var i;let t=((i=s.stack)!=null?i:"at unknown").split(`
`).map(n=>n.trim());return t.splice(t[0].startsWith("Error")?1:0)}function Oe(s){var n;const e=(n=s.message)!=null?n:"";let t=e;e.includes(": ")&&(t=e.split(": ").shift()),t.length>24&&(t=e.length>24?`${e.substr(0,23)}...`:e);const i=li({id:e,icon:"mdi-alert-circle-outline",message:`[${t}]`,color:"error",textColor:"white",disposeOnMiddleClick:!0,onClick:()=>{new U({name:`[ERROR: ${t}]`,description:`[${s.message} (${ho(s)})]`}),i.dispose()}});return i}window.addEventListener("error",s=>{var e,t;Oe((e=s.error)!=null?e:s),(t=l==null?void 0:l.ready)==null||t.once(i=>i.windows.loadingWindow.closeAll())});window.onunhandledrejection=s=>{var e;Oe(new Error(s.reason)),(e=l==null?void 0:l.ready)==null||e.once(t=>t.windows.loadingWindow.closeAll())};const rs=[[/§4/,"colorCode.darkRed"],[/§c/,"colorCode.red"],[/§6/,"colorCode.gold"],[/§e/,"colorCode.yellow"],[/§2/,"colorCode.darkGreen"],[/§a/,"colorCode.green"],[/§b/,"colorCode.aqua"],[/§3/,"colorCode.darkAqua"],[/§1/,"colorCode.darkBlue"],[/§9/,"colorCode.blue"],[/§d/,"colorCode.lightPurple"],[/§5/,"colorCode.darkPurple"],[/§[fr]/,"colorCode.white"],[/§7/,"colorCode.gray"],[/§8/,"colorCode.darkGray"],[/§0/,"colorCode.black"],[/§g/,"colorCode.minecoinGold"],[/§o/,"colorCode.italic"],[/§l/,"colorCode.bold"],[/§n/,"colorCode.underline"]],xt=new $;async function L(){return await xt.fired,await ue(()=>import("./editor.main.8d0d7a54.js").then(s=>s.e),["assets/editor.main.8d0d7a54.js","assets/editor.2dcbbb62.css"])}class Vi{constructor({id:e,extensions:t,config:i,tokenProvider:n,completionItemProvider:a}){this.disposables=[],this.models=new Map,this.id=e,L().then(({languages:r,editor:o})=>{r.register({id:e,extensions:t}),this.disposables=[r.setLanguageConfiguration(e,i),o.onDidCreateModel(this.onModelAdded.bind(this)),o.onWillDisposeModel(this.onModelRemoved.bind(this)),o.onDidChangeModelLanguage(c=>{this.onModelRemoved(c.model),this.onModelAdded(c.model)})],this.highlighter=r.setMonarchTokensProvider(e,n),a&&this.disposables.push(r.registerCompletionItemProvider(e,a))})}updateTokenProvider(e){L().then(({languages:t})=>{var i;(i=this.highlighter)==null||i.dispose(),this.highlighter=t.setMonarchTokensProvider(this.id,e)})}onModelAdded(e){return e.getLanguageId()!==this.id?!1:(this.validate(e),this.models.set(e.uri.toString(),e.onDidChangeContent(Ue(t=>this.validate(e,t),500))),!0)}onModelRemoved(e){var i;L().then(({editor:n})=>{n.setModelMarkers(e,this.id,[])});const t=e.uri.toString();(i=this.models.get(t))==null||i.dispose(),this.models.delete(t)}dispose(){var e;(e=this.highlighter)==null||e.dispose(),this.disposables.forEach(t=>t.dispose()),this.disposables=[]}}const fo={comments:{lineComment:"##"}},mo={tokenizer:{root:[[/##.*/,"comment"],[/=|\.|:/,"definition"],...rs]}};async function go(){var a,r,o;const e=(await l.getApp()).project.packIndexer;await e.fired;const t=(a=await e.service.getCacheDataFor("entity",void 0,"identifier"))!=null?a:[],i=(r=await e.service.getCacheDataFor("block",void 0,"identifier"))!=null?r:[],n=(o=await e.service.getCacheDataFor("item",void 0,"identifier"))!=null?o:[];return[...t.map(c=>`entity.${c}.name`),...t.map(c=>`item.spawn_egg.entity.${c}.name`),...n.map(c=>`item.${c}.name`),...i.map(c=>`tile.${c}.name`)]}const wo={provideCompletionItems:async(s,e)=>{var d,p;const{Range:t,languages:i}=await L(),n=await l.getApp();if(!(l.fileType.getId((p=(d=n.project.tabSystem)==null?void 0:d.selectedTab)==null?void 0:p.getPath())==="clientLang"))return{suggestions:[]};const r=s.getLineContent(e.lineNumber);let o=!1;for(let u=e.column-1;u>=0;u--)r[u]==="="&&(o=!0);const c=[];if(!o){const u=new Set(s.getValue().split(`
`).map(h=>h.split("=")[0].trim())),f=(await go()).filter(h=>!u.has(h));c.push(...f.map(h=>({range:new t(e.lineNumber,e.column,e.lineNumber,e.column),kind:i.CompletionItemKind.Text,label:h,insertText:h})))}return{suggestions:c}}};class yo extends Vi{constructor(){super({id:"lang",extensions:["lang"],config:fo,tokenProvider:mo,completionItemProvider:wo})}validate(){}}const Ae=location.origin==="https://nightly.bridge-core.app",vo={setup(){return{logoPath:Ae?"/img/icons/nightly/favicon.svg":"/img/icons/favicon.svg"}}};var bo=function(){var e=this,t=e._self._c;return t("img",{attrs:{draggable:"false",src:e.logoPath,alt:"Logo of bridge. v2"}})},_o=[],So=_(vo,bo,_o,!1,null,null,null,null);const os=So.exports,kn=Oi("app-notifications","app-notification-store");class zt extends ci{constructor(e){if(super(e),!e.id)throw new Error("PersistentNotification requires an id")}async show(){await fe(this.id,kn)||super.show()}dispose(){super.dispose(),pe(this.id,!0,kn)}}const Co=X({__name:"ConfirmWindow",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState();function n(){e.window.onCancel()}function a(){e.window.onConfirm()}return{__sfc:!0,t,props:e,state:i,onCancel:n,onConfirm:a,BaseWindow:de}}});var ko=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,isPersistent:!0,hasMaximizeButton:!1,isFullscreen:!1,width:440,height:e.window.height,hasCloseButton:!1,isSmallPopup:!0},scopedSlots:e._u([{key:"default",fn:function(){return[t("p",{staticClass:"mt-2"},[e._v(e._s(i.t(e.window.description)))])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"sidebarSelection"},on:{click:i.onCancel}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-close")]),t("span",[e._v(e._s(i.t(e.window.cancelText)))])],1),t("v-btn",{attrs:{color:"primary"},on:{click:i.onConfirm}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-check")]),t("span",[e._v(e._s(i.t(e.window.confirmText)))])],1)]},proxy:!0}],null,!1,2853835962)}):e._e()},xo=[],Po=_(Co,ko,xo,!1,null,null,null,null);const jo=Po.exports;class W extends Y{constructor(e){super(jo,!0,!1),this.opts=e,this.defineWindow(),this.open()}get confirmText(){var e;return(e=this.opts.confirmText)!=null?e:"general.okay"}get cancelText(){var e;return(e=this.opts.cancelText)!=null?e:"general.cancel"}get description(){return this.opts.description}get title(){var e;return(e=this.opts.title)!=null?e:"general.confirm"}get height(){var e;return(e=this.opts.height)!=null?e:130}onConfirm(){typeof this.opts.onConfirm=="function"&&this.opts.onConfirm(),this.close(!0)}onCancel(){typeof this.opts.onCancel=="function"&&this.opts.onCancel(),this.close(!1)}}const Fo={async mounted(){const{id:s,icon:e,title:t,description:i=t,textColor:n="white",color:a,link:r}=navigator.onLine?await fetch("https://raw.githubusercontent.com/bridge-core/editor-packages/main/remote/welcomeAlert.json").catch(()=>null).then(o=>o?o.json():{}):{};if(this.icon=e,this.title=t,this.color=a,this.textColor=n,this.link=r,t){const o=new zt({id:s,icon:e,message:`[${t}]`,color:a,textColor:n,onClick:()=>{const c={title:`[${t}]`,description:`[${i}]`};r?new W({...c,confirmText:"general.readMore",onConfirm:()=>{this.onClick()}}):new U(c),o.dispose()}})}},data:()=>({icon:null,title:null,color:null,textColor:null,link:null}),methods:{onClick(){l.openUrl(this.link,null,!0)}}};var To=function(){var e=this,t=e._self._c;return e.title?t("v-alert",{staticClass:"mt-2 mb-8 pa-3",style:`color: ${e.textColor}; width: calc(100% - 8px); position: absolute; top: 0; left: 0;`,attrs:{value:!!e.title,color:"purple",border:"bottom",rounded:"lg"}},[t("div",{staticClass:"d-flex align-center"},[e.icon?t("v-icon",{staticClass:"pr-2",attrs:{color:e.textColor,large:""}},[e._v(" "+e._s(e.icon)+" ")]):e._e(),t("span",[e._v(e._s(e.title))]),t("v-spacer"),e.link?t("v-btn",{style:`color: ${e.textColor}`,attrs:{text:"",dense:""},on:{click:e.onClick}},[e._v(" Read more "),t("v-icon",{staticClass:"pl-2",attrs:{color:e.textColor}},[e._v(" mdi-chevron-right ")])],1):e._e()],1)]):e._e()},Ao=[],$o=_(Fo,To,Ao,!1,null,null,null,null);const Do=$o.exports,ji=new Set,Eo=({disposables:s})=>({registerAction(e){const t=new M(e);ji.add(t);const i={dispose:()=>{ji.delete(t)}};return s.push(i),i}}),ye=ut.dirname,Re=ut.join,Pe=ut.extname,me=ut.basename,Mo=ut.resolve,cs=ut.relative,Io=Object.freeze(Object.defineProperty({__proto__:null,dirname:ye,join:Re,extname:Pe,basename:me,resolve:Mo,relative:cs},Symbol.toStringTag,{value:"Module"})),Oo={"mdi-file-image-outline":[".jpg",".jpeg",".png",".gif",".bmp",".webp",".tga"],"mdi-code-json":[".json"],"mdi-volume-high":[".mp3",".wav",".fsb",".ogg"],"mdi-language-html5":[".html"],"mdi-language-typescript":[".ts",".tsx"],"mdi-language-javascript":[".js",".jsx"],"mdi-web":[".lang"]};function Yt(s){const e=Pe(s);for(const[t,i]of Object.entries(Oo))if(i.includes(e))return t;return"mdi-file-outline"}async function ce(s,e,t=new Set,i=""){for await(const n of s.values()){const a=i.length===0?n.name:`${i}/${n.name}`;if(n.kind==="file"){if(n.name[0]===".")continue;await e(n,a,s)}else n.kind==="directory"&&!t.has(a)&&await ce(n,e,t,a)}}async function Ro(){return typeof(await(await navigator.storage.getDirectory()).getFileHandle("bridge-supports-writable-test",{create:!0})).createWritable=="function"}async function Fi(){var s;return typeof((s=navigator.storage)==null?void 0:s.getDirectory)!="function"||!await Ro()?new te(null,"bridgeFolder",void 0):await navigator.storage.getDirectory()}class Z extends ${constructor(e){super(),e&&this.setup(e)}get baseDirectory(){return this._baseDirectory}setup(e){this._baseDirectory=e,this.hasFired||this.dispatch()}async getDirectoryHandle(e,{create:t,createOnce:i}={}){if(e===""||e===".")return this.baseDirectory;let n=this.baseDirectory;const a=e.split(/\\|\//g);a[0]==="."&&a.shift(),a[0]==="extensions"&&(a[0]="~local",a.splice(1,0,"extensions")),a[0]==="~local"&&(n=await Fi(),a.shift());for(const r of a){try{n=await n.getDirectoryHandle(r,{create:i||t})}catch{throw new Error(`Failed to access "${e}": Directory does not exist`)}i&&(i=!1,t=!1)}return n}async getFileHandle(e,t=!1){if(e.length===0)throw new Error("Error: filePath is empty");const i=await this.getDirectoryHandle(ye(e),{create:t});try{return await i.getFileHandle(me(e),{create:t})}catch{throw new Error(`File does not exist: "${e}"`)}}async pathTo(e){const t=await Fi();if(e instanceof se&&!(t instanceof te))return;let i=await t.resolve(e).then(n=>n==null?void 0:n.join("/"));return i?i="~local/"+i:i=await this.baseDirectory.resolve(e).then(n=>n==null?void 0:n.join("/")),i}async mkdir(e,{recursive:t}={}){await this.getDirectoryHandle(e,{create:!0})}async readdir(e,{withFileTypes:t}={}){const i=await this.getDirectoryHandle(e),n=[];for await(const a of i.values())a.kind==="file"&&a.name===".DS_Store"||(t?n.push(a):n.push(a.name));return n}async readFilesFromDir(e,t=this.getDirectoryHandle(e)){t=await t;const i=[];for await(const n of t.values())n.kind==="file"&&n.name===".DS_Store"||(n.kind==="file"?i.push({name:n.name,kind:n.kind,path:`${e}/${n.name}`}):n.kind==="directory"&&i.push(...await this.readFilesFromDir(`${e}/${n.name}`,n)));return i}readFile(e){return this.getFileHandle(e).then(t=>t.getFile())}async unlink(e){if(e.length===0)throw new Error("Error: filePath is empty");const t=e.split(/\\|\//g),i=t.pop();let n;try{n=await this.getDirectoryHandle(t.join("/"))}catch{return}try{await n.removeEntry(i,{recursive:!0})}catch{}}async writeFile(e,t){const i=await this.getFileHandle(e,!0);return await this.write(i,t),i}async write(e,t){const i=await e.createWritable({keepExistingData:!1});await i.write(t),await i.close()}async readJSON(e){const t=await this.readFile(e);try{return await R.parse(await t.text())}catch{throw new Error(`Invalid JSON: ${e}`)}}writeJSON(e,t,i=!1){return this.writeFile(e,JSON.stringify(t,null,i?"	":void 0))}async move(e,t){if(await this.fileExists(e))await this.copyFile(e,t);else if(await this.directoryExists(e))await this.copyFolder(e,t);else throw new Error(`File or folder does not exist: ${e}`);await this.unlink(e)}async copyFile(e,t){const i=await this.getFileHandle(e,!1),n=await this.getFileHandle(t,!0);return await this.copyFileHandle(i,n)}async copyFileHandle(e,t){return await this.write(t,await e.getFile()),t}async copyFolder(e,t){const i=await this.getDirectoryHandle(e,{create:!1});await ce(i,async(n,a)=>{await this.copyFileHandle(n,await this.getFileHandle(Re(t,a),!0))})}async copyFolderByHandle(e,t){const i=new Z(t);await ce(e,async(n,a)=>{await this.copyFileHandle(n,await i.getFileHandle(a,!0))})}loadFileHandleAsDataUrl(e){return new Promise(async(t,i)=>{const n=new FileReader;try{const a=await e.getFile();n.addEventListener("load",()=>{t(n.result)}),n.addEventListener("error",i),n.readAsDataURL(a)}catch{i(`File does not exist: "${e.name}"`)}})}async fileExists(e){try{return await this.getFileHandle(e),!0}catch{return!1}}async directoryExists(e){try{return await this.getDirectoryHandle(e),!0}catch{return!1}}async getDirectoryHandlesFromGlob(e,t="."){const i=e.split(/\/|\\/g),n=new Set([await this.getDirectoryHandle(t)]);for(const a of i){if(a==="*")for(const r of[...n.values()]){n.delete(r);for await(const o of r.values())o.kind==="directory"&&n.add(o)}else{if(a==="**")return console.warn('"**" is not supported yet'),[];for(const r of[...n.values()]){n.delete(r);try{n.add(await r.getDirectoryHandle(a))}catch{}}}if(n.size===0)return[]}return[...n.values()]}}const Je="comMojangDirectory";class Wo extends ${constructor(e){super(),this.app=e,this.fileSystem=new Z,this.setup=new $,this._hasComMojang=!1,this._permissionDenied=!1}get hasComMojang(){return this._hasComMojang}get status(){return{hasComMojang:this._hasComMojang,didDenyPermission:this._permissionDenied}}async setupComMojang(){if(this._hasComMojang)return!1;const e=await fe(Je);return e&&(await this.requestPermissions(e).catch(async()=>{await this.createPermissionWindow(e)}),this._hasComMojang)?(this.setup.dispatch(),this.dispatch(),!0):(this.dispatch(),!1)}async createPermissionWindow(e){const t=new U({name:"comMojang.title",description:"comMojang.permissionRequest"});t.open(),await t.fired,await this.requestPermissions(e)}async requestPermissions(e){await e.requestPermission({mode:"readwrite"})!=="granted"?(this._hasComMojang=!1,this._permissionDenied=!0,this.app.projectManager.recompileAll()):(this.fileSystem.setup(e),this._hasComMojang=!0)}async set(e){pe(Je,e),await this.requestPermissions(e),this._hasComMojang&&this.setup.dispatch()}async handleComMojangDrop(e){await new W({description:"comMojang.folderDropped",confirmText:"general.yes",cancelText:"general.no"}).fired&&(await this.set(e),await this.app.projectManager.recompileAll())}async unlink(){await this.app.projectManager.recompileAll(),await qe(Je)}}const Lo=[{icon:"mdi-delete",name:"[Dev: Reset local fs]",description:"[Reset the local fs (navigator.storage.getDirectory()) to be completely emtpy]",onTrigger:async()=>{const s=await l.getApp(),e=new W({description:"[Are you sure you want to reset the local fs?]"});e.open(),await e.fired&&await Promise.all([s.fileSystem.unlink("~local/data"),s.fileSystem.unlink("~local/projects"),s.fileSystem.unlink("~local/extensions")])}},{icon:"mdi-delete",name:"[Dev: Reset 'com.mojang' folder]",description:"[Remove the 'com.mojang' folder from local storage]",onTrigger:async()=>{qe(Je)}},{icon:"mdi-cancel",name:"[Dev: Clear app data]",description:"[Clear data from bridge-core/editor-packages repository]",onTrigger:async()=>{await pe("savedAllDataInIdb",!1)}},{icon:"mdi-refresh",name:"[Dev: Reset initial setup]",description:"[Resets editor type and com.mojang selection]",onTrigger:async()=>{await qe("didChooseEditorType"),await qe(Je)}},{icon:"mdi-open-in-new",name:"[Dev: Open local fs]",description:"[Open the local fs within the editor]",onTrigger:async()=>{(await l.getApp()).viewFolders.addDirectoryHandle({directoryHandle:await navigator.storage.getDirectory(),startPath:"~local"})}},{icon:"mdi-database-outline",name:"[Dev: Open data directory]",description:"[Open the data directory within the editor]",onTrigger:async()=>{const s=await l.getApp();s.viewFolders.addDirectoryHandle({directoryHandle:s.dataLoader.baseDirectory})}},{icon:"mdi-minecraft",name:"[Dev: Open com.mojang]",description:"[Open the com.mojang folder within the editor]",onTrigger:async()=>{const s=await l.getApp();!s.comMojang.setup.hasFired||s.viewFolders.addDirectoryHandle({directoryHandle:s.comMojang.fileSystem.baseDirectory})}}];Lo.map(s=>new M(s));const Hi=G({isWindowOpen:!1,shouldRender:!1,closeDelay:null}),Ti=new Set;function No(s){return Ti.add(s),{dispose:()=>{Ti.delete(s)}}}function Bo(){return Array.from(Ti)}const Vo={props:{autofocus:{type:Boolean,default:!1}},setup(){const{t:s}=I();return{t:s}},async mounted(){this.updateActions(),this.disposables.push(l.eventSystem.on("projectChanged",async()=>this.updateActions()))},destroyed(){this.disposables.forEach(s=>s.dispose()),this.disposables=[]},data:()=>({currentItem:"",actions:[],disposables:[]}),methods:{async updateActions(){const s=await l.getApp(),e=s.actionManager.getAllActions(),t=[...ji.values()];this.actions=[...e,...s.isNoProjectSelected?[]:await this.loadFilesFromProject(s.project),...t,...Bo()]},onSelectedAction(s){this.$nextTick(()=>this.currentItem=""),s.trigger(),this.$emit("actionSelected")},async loadFilesFromProject(s){var t,i;return!s||s.isVirtualProject?void 0:(await s.packIndexer.fired,((i=await((t=s.packIndexer)==null?void 0:t.service.getAllFiles()))!=null?i:[]).map(n=>{var o,c;const a=l.packType.get(n),r=l.fileType.get(n);return new M({name:`[${s.relativePath(n)}]`,description:"actions.openFile.name",icon:(o=r==null?void 0:r.icon)!=null?o:Yt(n),color:(c=a==null?void 0:a.color)!=null?c:"primary",onTrigger:async()=>{const d=await s.app.fileSystem.getFileHandle(n);s.openFile(d)}})}))}}};var Ho=function(){var e=this,t=e._self._c;return t("v-autocomplete",{staticClass:"commandbar-input elevation-1",attrs:{"prepend-inner-icon":"mdi-magnify",solo:"",rounded:"","hide-details":"","background-color":"expandedSidebar","append-icon":null,"menu-props":{rounded:"lg",dense:!0,"nudge-top":-12,"min-width":"unset","max-width":"500px",transition:"slide-y-transition",contentClass:"commandbar-menu"},items:e.actions,"item-text":i=>`${e.t(i.name)}
${e.t(i.description)}`,"item-value":i=>i,placeholder:e.t("general.search"),"auto-select-first":"",autofocus:e.autofocus},on:{change:e.onSelectedAction,focus:e.updateActions,blur:function(i){return e.$emit("blur")}},scopedSlots:e._u([{key:"no-data",fn:function(){return[t("v-list-item",[t("v-list-item-title",[e._v(" Search for files, actions or projects. ")])],1)]},proxy:!0},{key:"item",fn:function({item:i}){return[t("v-list-item-avatar",{staticClass:"text-h5 font-weight-light white--text",attrs:{color:i.color||"warning"}},[t("v-icon",{attrs:{color:"white"}},[e._v(e._s(i.icon))])],1),t("v-list-item-content",[t("v-list-item-title",{domProps:{textContent:e._s(e.t(i.name))}}),t("v-list-item-subtitle",{domProps:{textContent:e._s(e.t(i.description))}})],1)]}}]),model:{value:e.currentItem,callback:function(i){e.currentItem=i},expression:"currentItem"}})},Uo=[],zo=_(Vo,Ho,Uo,!1,null,null,null,null);const ls=zo.exports;const qo={name:"welcome-screen",components:{Logo:os,WelcomeAlert:Do,CommandBar:ls},props:{containerPadding:String}};var Jo=function(){var e=this,t=e._self._c;return t("div",{class:`d-flex flex-column justify-center align-center ${e.containerPadding}`,style:"position: relative; height: 80vh;"},[t("WelcomeAlert"),t("div",{staticClass:"d-flex flex-column justify-center align-center",staticStyle:{width:"50vw","max-width":"500px"}},[t("Logo",{staticClass:"mt-4 mb-8",staticStyle:{height:"160px",width:"160px"},attrs:{alt:"Logo of bridge. v2"}}),t("CommandBar")],1)],1)},Go=[],Ko=_(qo,Jo,Go,!1,null,"5e689ba1",null,null);const ds=Ko.exports;function Yo(s,e=!1){const t=s.toLowerCase().split(" + "),i={key:""};return t.forEach(n=>{n==="\u2318"||(J()!=="darwin"||e)&&n==="ctrl"?i.ctrlKey=!0:n==="\u2325"||n==="alt"?i.altKey=!0:n==="\u21E7"||n==="shift"?i.shiftKey=!0:n==="\u2303"||n==="meta"?i.metaKey=!0:i.key=n}),i}function ps({key:s,ctrlKey:e,altKey:t,shiftKey:i,metaKey:n}){const a=J();let r=s.toUpperCase();return i&&(a==="darwin"?r="\u21E7 + "+r:r="Shift + "+r),t&&(a==="darwin"?r="\u2325 + "+r:r="Alt + "+r),n&&(a==="darwin"?r="\u2303 + "+r:r="Meta + "+r),e&&(a==="darwin"?r="\u2318 + "+r:r="Ctrl + "+r),r}class us extends H{constructor(e,t){super(),this.keyBindingManager=e,this.config=t}static fromStrKeyCode(e,t,i=!1,n){return e.create({...Yo(t,i),prevent:n})}toStrKeyCode(){return ps(this.config)}async trigger(){this.dispatch()}prevent(e){return typeof this.config.prevent=="function"?this.config.prevent(e):!1}dispose(){this.keyBindingManager.disposeKeyBinding(this.toStrKeyCode())}}class hs extends M{constructor(e,t){var i;super(t),this.actionManager=e,this.config=t,this.type="action",this.id=(i=t.id)!=null?i:D(),t.keyBinding&&(Array.isArray(t.keyBinding)?t.keyBinding:[t.keyBinding]).forEach(a=>this.addKeyBinding(us.fromStrKeyCode(e.keyBindingManager,a,!0,t.prevent)))}get keyBinding(){return this._keyBinding}addKeyBinding(e){return this._keyBinding=e,e.on(()=>this.trigger()),this}disposeKeyBinding(){this._keyBinding&&this._keyBinding.dispose()}dispose(){this.actionManager.disposeAction(this.id),this.disposeKeyBinding()}}class Mt{constructor(e){this._keyBindingManager=e,this.type="submenu",this.state=Dt({})}get keyBindingManager(){if(!this._keyBindingManager)throw new Error("No keyBindingManager was defined for this actionManager");return this._keyBindingManager}create(e){const t=new hs(this,e);return V(this.state,t.id,t),t}getAction(e){return this.state[e]}getAllActions(){return Object.values(this.state).filter(e=>e.type==="action")}getAllElements(){return Object.values(this.state)}addDivider(){this.state[D()]={type:"divider"}}addSubMenu(e){const t=new Qo;e.actions.forEach(i=>{i!==null&&(i.type==="divider"?t.addDivider():t.create(i))}),this.state[D()]={type:"submenu",icon:e.icon,name:e.name,submenu:t}}disposeAction(e){Ee(this.state,e)}dispose(){Object.values(this.state).forEach(e=>e.type==="action"?e.dispose():null)}async trigger(e){if(!this.state[e]||this.state[e].type!=="action")throw new Error(`Failed to trigger "${e}": Action does not exist.`);await this.state[e].trigger()}}class Qo extends Mt{constructor(){super(...arguments),this.type="submenu"}}async function $e(s,e,t=!0){let i=e.filter(r=>r!==null);if(s instanceof MouseEvent&&(s.preventDefault(),s.stopImmediatePropagation()),i.length===0)return;const n=await l.getApp(),a=new Mt;i.forEach(r=>{switch(r.type){case"submenu":a.addSubMenu(r);break;case"divider":a.addDivider();break;default:a.create(r);break}}),setTimeout(()=>n.contextMenu.show(s,a,t),60)}const Zo=new TextEncoder,Xo={type:"compressed",name:"openRawFile",onTrigger:async s=>{const e=s.indexOf(`
`),[t,i]=[s.slice(0,e),s.slice(e+1)],n=new se(null,t,Zo.encode(i),!0),a=await l.getApp();await a.projectManager.projectReady.fired,await a.fileDropper.importFile(n)}};async function fs(s){const e=await s.getFile().then(t=>t.text());if(typeof navigator.share=="function"){const t=new URL(window.location.href);l.sidebar.isContentVisible.value||t.searchParams.set("setSidebarState","hidden"),t.searchParams.set("openRawFile",btoa(Ri(Yn(Qn(`${s.name}
${e}`),{level:9}),!0))),await navigator.share({title:`View File: ${s.name}`,text:`Edit the file "${s.name}" file with bridge.!`,url:t.href}).catch(()=>{})}}class ht extends ${constructor(e){var t;super(),this.parent=e,this.uuid=D(),this.hasRemoteChange=!1,this._isUnsaved=!1,this.isForeignFile=!0,this.connectedTabs=[],this.isTemporary=!((t=S==null?void 0:S.editor)!=null&&t.keepTabsOpen),this.onClose=new H,this.path=void 0,this.folderName=null,this.actions=[],this.isActive=!1,this.isLoading=!0,window.setTimeout(()=>this.setup())}static is(e){return!1}async setup(){this.dispatch(this),this.isLoading=!1}get project(){return this.parent.project}setIsLoading(e){this.isLoading=e}setIsUnsaved(e){this._isUnsaved=e,this.isTemporary=!1}get isUnsaved(){return this._isUnsaved}updateParent(e){this.parent=e}get tabSystem(){return this.parent}get isSharingScreen(){return this.parent.isSharingScreen.value}setFolderName(e){this.folderName=e}getPath(){if(!this.path)throw new Error("Trying to access projectPath before tab finished loading");return this.path}getProjectPath(){if(console.warn("CommonTab.getProjectPath() is deprecated in favor of CommonTab.getPath()"),!this.path)throw new Error("Trying to access projectPath before tab finished loading");return this.path.split("/").slice(2).join("/")}get icon(){var e,t;return(t=(e=l.fileType.get(this.getPath()))==null?void 0:e.icon)!=null?t:Yt(this.getPath())}get iconColor(){var e;return this.hasFired?(e=l.packType.get(this.getPath()))==null?void 0:e.color:"accent"}get isSelected(){return this.parent.selectedTab===this}select(){return this.parent.select(this),this}async close(){this.parent.setActive(!0);const e=await this.parent.close(this);return e&&(this.connectedTabs.forEach(t=>t.close()),this.onClose.dispatch()),e}async is(e){return!1}focus(){}async onActivate(){this.isActive=!0}onDeactivate(){this.isActive=!1}onDestroy(){}async toOtherTabSystem(e=!0){var o;const i=(o=(await l.getApp()).projectManager.currentProject)==null?void 0:o.tabSystems,n=this.isSelected,a=i[0]===this.parent?i[0]:i[1],r=i[0]===this.parent?i[1]:i[0];this.parent=r,e?(a.remove(this,!1),await r.add(this,!0)):(this.isForeignFile||(await r.openedFiles.add(this.getPath()),await a.openedFiles.remove(this.getPath())),n&&await a.select(a.tabs.value[0]),await r.select(this))}addAction(...e){this.actions.push(...e)}clearActions(){this.actions=[]}async onContextMenu(e){const t=[];this.fileHandle&&t.push({icon:"mdi-share",name:"general.shareFile",onTrigger:async()=>{await fs(this.fileHandle)}}),this.isTemporary&&t.push({name:"actions.keepInTabSystem.name",icon:"mdi-pin-outline",onTrigger:()=>{this.isTemporary=!1}}),this.parent.tabs.value.length>1&&t.push({name:"actions.moveToSplitScreen.name",icon:"mdi-arrow-split-vertical",onTrigger:async()=>{this.toOtherTabSystem()}}),t.length>0&&t.push({type:"divider"}),await $e(e,[...t,{name:"actions.closeTab.name",icon:"mdi-close",onTrigger:()=>{this.close()}},{name:"actions.closeAll.name",icon:"mdi-table-row",onTrigger:()=>{this.parent.closeTabs(()=>!0)}},{name:"actions.closeTabsToRight.name",icon:"mdi-chevron-right",onTrigger:()=>{let i=!0;this.parent.closeTabs(n=>(n===this&&(i=!1),i))}},{name:"actions.closeAllSaved.name",icon:"mdi-content-save-outline",onTrigger:()=>{this.parent.closeTabs(i=>!i.isUnsaved)}},{name:"actions.closeOtherTabs.name",icon:"mdi-unfold-more-vertical",onTrigger:()=>{this.parent.closeTabs(i=>i!==this)}}])}copy(){document.execCommand("copy")}cut(){document.execCommand("cut")}paste(){}}async function di(s,e,t){const i=li({icon:"mdi-export",color:"success",textColor:"white",message:"general.successfulExport.title",isVisible:!0,onClick:async()=>{(await l.getApp()).project.isLocal||ns||A.value?rt(me(s),e):new U({description:`[${B("general.successfulExport.description")}: "${s}"]`}),i.dispose()}});await t.writeFile(s,e)}function rt(s,e){const t=URL.createObjectURL(new Blob([e])),i=document.createElement("a");i.download=s,i.href=t,i.click(),URL.revokeObjectURL(t)}const ec=new TextEncoder;async function tc(s){let e;return typeof s=="string"?e=ec.encode(s):s instanceof Blob?e=await s.arrayBuffer().then(t=>new Uint8Array(t)):ArrayBuffer.isView(s)?e=new Uint8Array(s.buffer):e=new Uint8Array(s),e}class O extends ht{constructor(e,t,i="off"){super(e),this.parent=e,this.fileHandle=t,this.readOnlyMode=i,this.isForeignFile=!1,this.isSaving=!1}get isReadOnly(){return this.readOnlyMode!=="off"}async setup(){var e;if(this.isForeignFile=!1,this.fileHandle instanceof se&&this.fileHandle.getParent()===null?this.path=void 0:this.path=await this.parent.app.fileSystem.pathTo(this.fileHandle),!this.path||!this.parent.project.isFileWithinProject(this.path)){await l.fileType.ready.fired,this.isForeignFile=!0;let t=(e=await l.fileType.guessFolder(this.fileHandle))!=null?e:D();t.endsWith("/")||(t+="/"),this.path=`${t}${D()}/${this.fileHandle.name}`}this.parent.project.packIndexer.once(async()=>{const t=this.parent.project.packIndexer;await t.hasFile(this.path)||(await t.updateFile(this.path,await this.getFile().then(i=>i.text()),this.isForeignFile),l.fileType.isJsonFile(this.getPath())&&this.parent.project.jsonDefaults.updateDynamicSchemas(this.getPath()))}),await super.setup()}get name(){return this.fileHandle.name}getFileType(){return l.fileType.getId(this.getPath())}async is(e){return e instanceof O?await this.isForFileHandle(e.fileHandle):!1}async isForFileHandle(e){return e.isVirtual!==this.fileHandle.isVirtual?!1:await e.isSameEntry(this.fileHandle)}getFile(){return this.fileHandle.getFile()}getFileHandle(){return this.fileHandle}async save(){this.isSaving||(this.isSaving=!0,await this._save(),this.isSaving=!1)}async saveAs(){if(is){const t=await this.fileHandle.getFile();rt(this.fileHandle.name,new Uint8Array(await t.arrayBuffer()));return}const e=await self.showSaveFilePicker({suggestedName:this.fileHandle.name,startIn:this.fileHandle}).catch(()=>null);!e||(this.isForeignFile||this.parent.openedFiles.remove(this.getPath()),this.fileHandle=e,this.resetSignal(),await this.setup(),await this.parent.save(this),this.isForeignFile||this.parent.openedFiles.add(this.getPath()))}async writeFile(e){if(this.fileHandle instanceof se&&!this.fileHandle.hasParentContext){if(A.value)rt(this.fileHandle.name,await tc(e));else{let t;try{t=await window.showSaveFilePicker({suggestedName:this.fileHandle.name,startIn:this.parent.app.fileSystem.baseDirectory})}catch{}if(!t)return!1;this.fileHandle=t,this.resetSignal(),await this.setup()}return!0}return await this.parent.app.fileSystem.write(this.fileHandle,e).then(()=>!0).catch(()=>!1)}}const ic={name:"TextTab",props:{tab:Object},computed:{tabSystem(){return this.tab.parent}},activated(){this.updateEditor()},mounted(){this.updateEditor()},methods:{updateEditor(){this.tabSystem.createMonacoEditor(this.$refs.monacoContainer)}}};var nc=function(){var e=this,t=e._self._c;return t("div",{ref:"monacoContainer",on:{click:function(i){return e.tab.parent.setActive(!0)},contextmenu:function(i){return e.tab.showContextMenu(i)}}})},sc=[],ac=_(ic,nc,sc,!1,null,null,null,null);const rc=ac.exports;function Ai(s){return new Promise(e=>setTimeout(()=>e(),s))}const oc=Ue(async s=>{var i;if(s.updateUnsavedStatus(),!s.editorModel||s.editorModel.isDisposed())return;const e=(i=s.editorModel)==null?void 0:i.getValue(),t=await l.getApp();t.project.fileChange.dispatch(s.getPath(),await s.getFile()),await t.project.packIndexer.updateFile(s.getPath(),e,s.isForeignFile,!0),await t.project.jsonDefaults.updateDynamicSchemas(s.getPath())},600);class ot extends O{constructor(e,t,i){super(e,t,i),this.component=rc,this.disposables=[],this.isActive=!1,this.modelLoaded=new $,this.initialVersionId=0,this.fired.then(async()=>{const n=await l.getApp();await n.projectManager.projectReady.fired,n.project.tabActionProvider.addTabActions(this)})}get editorInstance(){return this.parent.monacoEditor}async getFile(){return!this.editorModel||this.editorModel.isDisposed()?await super.getFile():new File([this.editorModel.getValue()],this.name)}updateUnsavedStatus(){var e;!this.editorModel||this.editorModel.isDisposed()||this.setIsUnsaved(this.initialVersionId!==((e=this.editorModel)==null?void 0:e.getAlternativeVersionId()))}async onActivate(){var i,n,a,r,o,c;if(this.isActive)return;this.isActive=!0,xt.hasFired||(this.isLoading=!0,xt.dispatch(),await this.parent.app.themeManager.applyMonacoTheme());const{editor:e,Uri:t}=await L();if(await this.parent.fired,await Ai(1),this.isLoading=!1,!this.editorModel||this.editorModel.isDisposed()){const p=await(await this.fileHandle.getFile()).text(),u=t.file(this.getPath());this.editorModel=k((a=e.getModel(u))!=null?a:e.createModel(p,(n=(i=l.fileType.get(this.getPath()))==null?void 0:i.meta)==null?void 0:n.language,u)),this.initialVersionId=this.editorModel.getAlternativeVersionId(),this.modelLoaded.dispatch(),await this.loadEditor(!1)}else await this.loadEditor();this.disposables.push((r=this.editorModel)==null?void 0:r.onDidChangeContent(()=>{oc(this)})),this.disposables.push((o=this.editorInstance)==null?void 0:o.onDidFocusEditorText(()=>{this.parent.setActive(!0)})),(c=this.editorInstance)==null||c.layout()}onDeactivate(){if(this.tabSystem.hasFired){const e=this.editorInstance.saveViewState();e&&(this.editorViewState=k(e))}this.disposables.forEach(e=>e==null?void 0:e.dispose()),this.isActive=!1}onDestroy(){var e;this.disposables.forEach(t=>t==null?void 0:t.dispose()),(e=this.editorModel)==null||e.dispose(),this.editorModel=void 0,this.editorViewState=void 0,this.isActive=!1,this.modelLoaded.resetSignal()}updateParent(e){super.updateParent(e)}focus(){var e;(e=this.editorInstance)==null||e.focus()}async loadEditor(e=!0){var t;await this.parent.fired,this.editorModel&&!this.editorModel.isDisposed()&&this.editorInstance.setModel(this.editorModel),this.editorViewState&&this.editorInstance.restoreViewState(this.editorViewState),(t=this.editorInstance)==null||t.updateOptions({readOnly:this.isReadOnly}),e&&setTimeout(()=>this.focus(),10)}async _save(){var n,a,r,o,c;this.isTemporary=!1,await l.getApp();const e=(n=this.editorInstance)==null?void 0:n.getAction("editor.action.formatDocument"),t=l.fileType.get(this.getPath()),i=(a=this.editorModel)==null?void 0:a.getValue();if(i&&i!==""&&e&&t&&((o=(r=S==null?void 0:S.general)==null?void 0:r.formatOnSave)!=null?o:!0)&&((c=t==null?void 0:t.formatOnSaveCapable)!=null?c:!0)){this.makeFakeEdit("	");const d=new Promise(f=>{var m;if(!this.editorModel||this.editorModel.isDisposed())return f();const h=(m=this.editorModel)==null?void 0:m.onDidChangeContent(()=>{h==null||h.dispose(),f()})}),p=e.run();let u=!1;await Promise.race([Promise.all([d,p]),Ai(1500).then(()=>{u||this.makeFakeEdit(null)})]),u=!0}await this.saveFile()}makeFakeEdit(e){var t;e?(this.editorInstance.pushUndoStop(),(t=this.editorInstance)==null||t.executeEdits("automatic",[{forceMoveMarkers:!1,range:{startLineNumber:1,endLineNumber:1,startColumn:1,endColumn:1},text:e}]),this.editorInstance.pushUndoStop()):this.editorInstance.trigger("automatic","undo",null)}async saveFile(){this.editorModel&&!this.editorModel.isDisposed()?await this.writeFile(this.editorModel.getValue())&&(this.setIsUnsaved(!1),this.initialVersionId=this.editorModel.getAlternativeVersionId()):console.error("Cannot save file content without active editorModel")}setReadOnly(e){var t;this.readOnlyMode=e,(t=this.editorInstance)==null||t.updateOptions({readOnly:e!=="off"})}async paste(){var e;this.isReadOnly||(this.focus(),(e=this.editorInstance)==null||e.trigger("keyboard","paste",{text:await navigator.clipboard.readText()}))}cut(){this.isReadOnly||(this.focus(),document.execCommand("cut"))}async close(){const e=await super.close();if(e&&this.isUnsaved){const t=await l.getApp();if(this.isForeignFile)await t.fileSystem.unlink(this.getPath());else{const n=await(await this.fileHandle.getFile()).text();await t.project.packIndexer.updateFile(this.getPath(),n)}}return e}showContextMenu(e){this.parent.showCustomMonacoContextMenu(e,this)}}const cc=X({__name:"UnsavedFile",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState();function n(){e.window.cancel()}function a(){e.window.noSave()}function r(){e.window.save()}return{__sfc:!0,t,props:e,state:i,onCancel:n,onNoSave:a,onSave:r,BaseWindow:de}}});var lc=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"general.confirm",isVisible:i.state.isVisible,isPersistent:!1,hasMaximizeButton:!1,isFullscreen:!1,width:440,height:130,hasCloseButton:!1,isSmallPopup:!0},scopedSlots:e._u([{key:"default",fn:function(){return[t("p",{staticClass:"mt-2"},[e._v(e._s(i.t("windows.unsavedFile.description")))])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"menu"},on:{click:i.onCancel}},[t("span",[e._v(e._s(i.t("general.cancel")))])]),t("v-btn",{attrs:{color:"error"},on:{click:i.onNoSave}},[t("span",[e._v(e._s(i.t("general.close")))])]),t("v-btn",{attrs:{color:"primary"},on:{click:i.onSave}},[t("span",[e._v(e._s(i.t("windows.unsavedFile.save")))])])]},proxy:!0}],null,!1,1792198457)}):e._e()},dc=[],pc=_(cc,lc,dc,!1,null,null,null,null);const uc=pc.exports,xn=new WeakMap;class hc extends Y{constructor(e){super(uc,!0,!1),xn.set(this,e),this.defineWindow(),this.open()}get tab(){return xn.get(this)}async noSave(){var t;this.close("close"),await((t=(await l.getApp()).tabSystem)==null?void 0:t.close(this.tab,!1))}async save(){var t,i;this.close("save");const e=await l.getApp();await((t=e.tabSystem)==null?void 0:t.save(this.tab)),await((i=e.tabSystem)==null?void 0:i.close(this.tab,!1))}async cancel(){this.close("cancel")}}class Pn{constructor(e=1/0,t){this.maxSize=e,this.array=[];for(const i of t!=null?t:[])this.add(i)}add(e,t=this.isEquals.bind(this)){const i=this.array.findIndex(n=>t(n,e));return i>-1?(this.array.splice(i,1),this.array.unshift(e),this):(this.array.length>=this.maxSize&&this.array.pop(),this.array.unshift(e),this)}remove(e,t=this.isEquals.bind(this)){const i=this.array.findIndex(n=>t(n,e));return i>-1&&this.array.splice(i,1),this}clear(){this.array=[]}isEquals(e,t){return e===t}toJSON(){return JSON.stringify(this.array)}fromArray(e){this.array=e}[Symbol.iterator](){return this.array.values()}get size(){return this.maxSize}get elementCount(){return this.array.length}get elements(){return[...this.array]}}class fc extends ${constructor(e,t,i,n=!0){super(),this.maxSize=t,this.savePath=i,V(this,"queue",new Pn(t)),this.app=k(e),n&&this.setup()}async setup(){await this.app.fileSystem.fired;let e=[];try{e=await this.app.fileSystem.readJSON(this.savePath)}catch{}this.queue.fromArray(e),this.dispatch(this.queue)}isEquals(e,t){return e===t}keep(e){const t=new Pn(this.maxSize);this.elements.filter(i=>e(i)).forEach(i=>t.add(i,this.isEquals.bind(this))),this.queue=t}async add(e){await this.fired,this.queue.add(e,this.isEquals.bind(this)),await this.saveQueue()}async remove(e){await this.fired,this.queue.remove(e,this.isEquals.bind(this)),await this.saveQueue()}clear(){return this.queue.clear(),this.saveQueue()}async saveQueue(){await this.app.fileSystem.mkdir(ye(this.savePath),{recursive:!0}),await this.app.fileSystem.writeFile(this.savePath,this.queue.toJSON())}get elements(){return this.queue.elements}}class mc extends fc{constructor(e,t,i){super(t,1/0,i),this.tabSystem=e}async restoreTabs(){var e,t;if((t=(e=S==null?void 0:S.general)==null?void 0:e.restoreTabs)==null||t){await this.fired;for(let i=0;i<this.queue.elements.length;i++)try{await this.tabSystem.openPath(this.queue.elements[i],{selectTab:i===0,isTemporary:!1})}catch{}}}}async function gc(){return await ue(()=>import("./jsoncParser.1459d33c.js"),[])}async function Ui(s,e){const{getLocation:t}=await gc(),i=t(s.getValue(),s.getOffsetAt(e)).path;return isNaN(Number(i[i.length-1]))||i.pop(),i.join("/")}async function zi(s,e){const{Range:t}=await L(),i=s.getLineContent(e.lineNumber),n=yc(i,e.column),a=wc(i,e.column);return{word:i.substring(n,a),range:new t(e.lineNumber,n,e.lineNumber,a)}}function wc(s,e){for(let t=e-1;t<s.length;t++)if(s[t]==='"')return t;return s.length}function yc(s,e){for(let t=e-2;t>0;t--)if(s[t]==='"')return t+1;return 0}function qi(s){return vc(s)(...Object.values(s.env))}function vc({script:s,env:e,language:t,modules:i,async:n=!1}){if(t==="typeScript")throw new Error(`bridge.'s legacy script runner no longer supports TypeScript. Use "bridge-js-runner" instead.`);let a=bc(s);if(i){const r=e.require;e.require=async o=>{if(i[o])return i[o];if(typeof r=="function")return await(r==null?void 0:r(o))}}try{return n?new Function(...Object.keys(e),`return (async () => {
${a}
})()`):new Function(...Object.keys(e),a)}catch(r){throw console.error(s),new Error(`Error within script: ${r}`)}}function bc(s){return s.replace(/export default([ \(])/g,(e,t)=>`module.exports =${t}`).replace(/import\s+(\* as [a-z][a-z0-9]*|[a-z][a-z0-9]+|{[a-z\s][a-z0-9,\s]*})\s+from\s+["'](.+)["']/gi,(e,t,i)=>(t.startsWith("* as ")&&(t=t.replace("* as ","")),`const ${t} = await require('${i}')`))}async function _c(s,e){const i=(await Promise.all(s.map(e))).findIndex(n=>n);return s[i]}async function ms(s,e,t){for(const i of t){const n=`${e}${i}`;if(await s.fileExists(n))return n}}function Sc(s,e){return{Bridge:{value:s,withExtension:(t,i)=>ms(e.fileSystem,t,i),resolvePackPath:(t,i)=>e.config.resolvePackPath(t,i)}}}class Cc{async provideDefinition(e,t,i){var P,x,b;const n=await l.getApp(),{word:a,range:r}=await zi(e,t),o=(x=(P=n.project.tabSystem)==null?void 0:P.selectedTab)==null?void 0:x.getPath();if(!o)return;const{definitions:c}=(b=l.fileType.get(o))!=null?b:{},d=await l.fileType.getLightningCache(o);if(!c||typeof d=="string"||d.length===0)return;const p=await Ui(e,t),{definitionId:u,transformedWord:f}=await this.getDefinition(a,p,d);if(!u||!f)return;let h=c[u];if(!h)return;Array.isArray(h)||(h=[h]);const m=await this.getFilePath(f,h),{editor:g,Uri:w,Range:v}=await L();return(await Promise.all(m.map(async y=>{const j=w.file(y);if(!g.getModel(j)){let T;try{T=await n.fileSystem.getFileHandle(y)}catch{return}const re=g.createModel(await T.getFile().then(_e=>_e.text()),void 0,j);setTimeout(()=>{n.project.getFileTab(T)||re.dispose()},5*1e3)}return{uri:j,range:new v(0,0,1/0,1/0)}}))).filter(y=>y!==void 0)}async getDefinition(e,t,i){var o;const n=await l.getApp();let a=e;const r=i.map(c=>[c.cacheKey,c.path,{script:c.script,filter:c.filter}]).filter(c=>c!==void 0);return{definitionId:await((o=_c(r,async([c,d,{script:p,filter:u}])=>d===""?!1:ai(t,d)?(u&&u.includes(e)&&(a=void 0),a&&p&&(a=await qi({script:p,async:!0,env:{...Sc(a,{fileSystem:n.fileSystem,config:n.project.config})}})),!0):!1))==null?void 0:o.then(c=>c==null?void 0:c[0])),transformedWord:a}}async getFilePath(e,t){var a,r;const i=await l.getApp(),n=[];for(const o of t){if(o.directReference){n.push(e);continue}const c=(r=await((a=i.project.packIndexer.service)==null?void 0:a.find(o.from,o.match,[e],!0)))!=null?r:[];n.push(...c)}return n}}async function gs(s,e){var r,o;await l.fileType.ready.fired;const t=c=>B(c),{id:i,documentation:n}=(r=l.fileType.get(s))!=null?r:{};if(!n){new U({description:`[${t("actions.documentationLookup.noDocumentation")} ${i?t(`fileType.${i}`):'"'+s+'"'}.]`});return}let a=n.baseUrl;e&&((o=n.supportsQuerying)!=null?o:!0)&&(a+=`#${e}`),l.openUrl(a)}function ws(s,e){let t;try{t=s.getLineContent(e.lineNumber)}catch{return!1}const i=xc(t,e.column),n=kc(t,e.column);return i&&n}function kc(s,e){for(let t=e-1;t<s.length;t++)if(s[t]==='"')return!0;return!1}function xc(s,e){for(let t=e-2;t>0;t--)if(s[t]==='"')return!0;return!1}async function Pc(s){const e=await l.getApp();return await e.dataLoader.fired,await e.projectManager.projectReady.fired,s||(s=e.projectConfig.get().targetVersion),Ji().then(t=>t.filter(i=>!s||ne(i,s,"<=")))}async function Ji(){const s=await l.getApp();return await s.dataLoader.fired,(await s.dataLoader.readJSON("data/packages/minecraftBedrock/formatVersions.json")).formatVersions.reverse()}function Qe(){return Ji().then(s=>s[0])}async function ys(s){return await s.fired,(await s.readJSON("data/packages/minecraftBedrock/formatVersions.json")).currentStable}async function jc(){const{languages:s}=await L();s.registerCompletionItemProvider("json",{provideCompletionItems:async(e,t)=>{var d;const i=await l.getApp(),n=await Ui(e,t),a=(d=i.project.tabSystem)==null?void 0:d.selectedTab;if(!(a instanceof O))return{suggestions:[]};const r=a.getFileType();let o;try{o=R.parse(e.getValue())}catch{o={}}const c=o.format_version||i.project.config.get().targetVersion||await Qe();return{suggestions:i.project.snippetLoader.getSnippetsFor(c,r,[n]).map(p=>({kind:s.CompletionItemKind.Snippet,label:p.displayData.name,documentation:p.displayData.description,insertText:p.insertText,insertTextRules:s.CompletionItemInsertTextRule.InsertAsSnippet}))}}})}async function Fc(){const{languages:s}=await L(),e={provideCompletionItems:async(t,i)=>{var c;const n=await l.getApp(),a=(c=n.project.tabSystem)==null?void 0:c.selectedTab;if(!(a instanceof O))return{suggestions:[]};const r=a.getFileType(),o=n.project.config.get().targetVersion||await Qe();return{suggestions:n.project.snippetLoader.getSnippetsFor(o,r,[]).map(d=>({kind:s.CompletionItemKind.Snippet,label:d.displayData.name,documentation:d.displayData.description,insertText:d.insertText,insertTextRules:s.CompletionItemInsertTextRule.InsertAsSnippet}))}}};["mcfunction","molang","javascript","typescript"].forEach(t=>s.registerCompletionItemProvider(t,e))}const vs=new $;class Tc{constructor(e){this.theme=e}async apply(){if(!xt.hasFired)return;const{editor:e}=await L();e.defineTheme("bridgeMonacoDefault",{base:this.theme.colorScheme==="light"?"vs":"vs-dark",inherit:!1,colors:{"editor.background":this.convertColor(this.theme.getColor("background")),"editor.lineHighlightBackground":this.convertColor(this.theme.getColor("lineHighlightBackground")),"editorWidget.background":this.convertColor(this.theme.getColor("background")),"editorWidget.border":this.convertColor(this.theme.getColor("sidebarNavigation")),"pickerGroup.background":this.convertColor(this.theme.getColor("background")),"pickerGroup.border":this.convertColor(this.theme.getColor("sidebarNavigation")),"badge.background":this.convertColor(this.theme.getColor("background")),"input.background":this.convertColor(this.theme.getColor("sidebarNavigation")),"input.border":this.convertColor(this.theme.getColor("menu")),"inputOption.activeBorder":this.convertColor(this.theme.getColor("primary")),focusBorder:this.convertColor(this.theme.getColor("primary")),"list.focusBackground":this.convertColor(this.theme.getColor("menu")),"list.hoverBackground":this.convertColor(this.theme.getColor("sidebarNavigation")),contrastBorder:this.convertColor(this.theme.getColor("sidebarNavigation")),"peekViewTitle.background":this.convertColor(this.theme.getColor("background")),"peekView.border":this.convertColor(this.theme.getColor("primary")),"peekViewResult.background":this.convertColor(this.theme.getColor("sidebarNavigation")),"peekViewResult.selectionBackground":this.convertColor(this.theme.getColor("menu")),"peekViewEditor.background":this.convertColor(this.theme.getColor("background")),"peekViewEditor.matchHighlightBackground":this.convertColor(this.theme.getColor("menu")),...this.theme.getMonacoDefinition()},rules:[{background:this.convertColor(this.theme.getColor("background")),foreground:this.convertColor(this.theme.getColor("text"))},...Object.entries(this.theme.getHighlighterDefinition()).map(([t,{color:i,background:n,textDecoration:a,isItalic:r}])=>({token:t,foreground:this.convertColor(i),background:n?this.convertColor(n):void 0,fontStyle:`${r?"italic ":""}${a}`})).filter(({foreground:t})=>t!==void 0)]}),e.setTheme("bridgeMonacoDefault"),vs.dispatch()}convertColor(e){return e&&(e.startsWith("#")?e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`:e:Aa.keyword.hex(e))}}let jn=!1;class Ac extends ${constructor(e){super(),this._app=e,this.disposables=[],jn||(jn=!0,L().then(({languages:t})=>{t.typescript.javascriptDefaults.setCompilerOptions({target:t.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,alwaysStrict:!0,checkJs:!0}),t.typescript.typescriptDefaults.setCompilerOptions({target:t.typescript.ScriptTarget.ESNext,allowNonTsExtensions:!0,alwaysStrict:!0,moduleResolution:t.typescript.ModuleResolutionKind.NodeJs,module:t.typescript.ModuleKind.ESNext}),t.registerDefinitionProvider("json",new Cc),Fc()}))}get monacoEditor(){if(!this._monacoEditor)throw new Error("Accessed Monaco Editor before it was defined");return this._monacoEditor}getMobileOptions(e){return{lineNumbers:e?"off":"on",minimap:{enabled:!e},tabSize:e?2:4,scrollbar:{horizontalScrollbarSize:e?15:void 0,verticalScrollbarSize:e?20:void 0,horizontalSliderSize:e?15:void 0,verticalSliderSize:e?20:void 0}}}async createMonacoEditor(e){var c,d,p,u,f,h,m,g,w;const{KeyCode:t,KeyMod:i,editor:n}=await L();await vs.fired,this.dispose(),this._monacoEditor=k(n.create(e,{wordBasedSuggestions:!1,theme:"bridgeMonacoDefault",roundedSelection:!1,autoIndent:"full",fontSize:Number(((d=(c=S==null?void 0:S.appearance)==null?void 0:c.editorFontSize)!=null?d:"14px").replace("px","")),"bracketPairColorization.enabled":(u=(p=S==null?void 0:S.editor)==null?void 0:p.bracketPairColorization)!=null?u:!1,fontFamily:((h=(f=S==null?void 0:S.appearance)==null?void 0:f.editorFont)!=null?h:J()==="darwin"?"Menlo":"Consolas")+", monospace",...this.getMobileOptions(this._app.mobile.isCurrentDevice()),contextmenu:!1,wordWrap:(m=S==null?void 0:S.editor)!=null&&m.wordWrap?"bounded":"off",wordWrapColumn:Number((w=(g=S==null?void 0:S.editor)==null?void 0:g.wordWrapColumns)!=null?w:"80")}));const a=this._monacoEditor._codeEditorService,r=a.openCodeEditor.bind(a);a.openCodeEditor=Ue(async(v,C,P)=>{var b,y;let x=await r(v,C,P);if(!x)try{const j=(b=this._app.tabSystem)==null?void 0:b.selectedTab;j&&(j.isTemporary=!1),await((y=this._app.project.tabSystem)==null?void 0:y.openPath(v.resource.path.slice(1)))}catch{console.error(`Failed to open file "${v.resource.path.slice(1)}"`)}return x},100);const o=this._monacoEditor.getAction("editor.action.commentLine");this._monacoEditor.addAction({...o,keybindings:[i.CtrlCmd|t.Backslash],run(...v){this._run(...v)}}),this._monacoEditor.onDidChangeModelContent(v=>{var b,y,j,T,re;const C=(y=(b=this._app.tabSystem)==null?void 0:b.selectedTab)==null?void 0:y.getPath();if(!C||!l.fileType.isJsonFile(C))return;const P=(j=this._monacoEditor)==null?void 0:j.getModel(),x=(re=(T=this._monacoEditor)==null?void 0:T.getSelection())==null?void 0:re.getPosition();P&&x&&ws(P,x)&&v.changes.some(_e=>_e.text===" ")&&setTimeout(()=>{var _e;(_e=this._monacoEditor)==null||_e.trigger("auto","editor.action.triggerSuggest",{})},50)}),this._monacoEditor.layout(),this.disposables.push(this._app.windowResize.on(()=>setTimeout(()=>{var v;return(v=this._monacoEditor)==null?void 0:v.layout()}))),this.disposables.push(this._app.mobile.change.on(v=>{var C;(C=this._monacoEditor)==null||C.updateOptions(this.getMobileOptions(v))})),this.dispatch()}updateOptions(e){var t;(t=this._monacoEditor)==null||t.updateOptions(e)}dispose(){var e;(e=this._monacoEditor)==null||e.dispose(),this.disposables.forEach(t=>t.dispose()),this.disposables=[],this._monacoEditor=void 0,this.resetSignal()}onReadonlyCustomMonacoContextMenu(){return[{name:"actions.documentationLookup.name",icon:"mdi-book-open-outline",onTrigger:async()=>{var a,r,o,c,d;const e=(a=this._monacoEditor)==null?void 0:a.getModel(),t=(r=this._monacoEditor)==null?void 0:r.getSelection();if(!e||!t)return;const i=(c=(o=this._app.tabSystem)==null?void 0:o.selectedTab)==null?void 0:c.getPath();if(!i)return;let n;l.fileType.isJsonFile(i)?n=await zi(e,t.getPosition()).then(p=>p.word):n=(d=e.getWordAtPosition(t.getPosition()))==null?void 0:d.word,gs(i,n)}},{name:"actions.goToDefinition.name",icon:"mdi-magnify",onTrigger:()=>{var e;(e=this._monacoEditor)==null||e.trigger("contextmenu","editor.action.revealDefinition",null)}},{name:"actions.goToSymbol.name",icon:"mdi-at",onTrigger:()=>{setTimeout(()=>{var e,t;(e=this._monacoEditor)==null||e.focus(),(t=this._monacoEditor)==null||t.trigger("contextmenu","editor.action.quickOutline",null)})}}]}showCustomMonacoContextMenu(e,t){if(t.isReadOnly)return $e(e,this.onReadonlyCustomMonacoContextMenu());$e(e,[...this.onReadonlyCustomMonacoContextMenu(),{type:"divider"},{name:"actions.changeAllOccurrences.name",icon:"mdi-pencil-outline",onTrigger:()=>{var i;(i=this._monacoEditor)==null||i.trigger("contextmenu","editor.action.rename",null)}},{name:"actions.formatDocument.name",icon:"mdi-text-box-check-outline",onTrigger:()=>{var i;(i=this._monacoEditor)==null||i.trigger("contextmenu","editor.action.formatDocument",null)}},{type:"divider"},{name:"actions.copy.name",icon:"mdi-content-copy",onTrigger:()=>{document.execCommand("copy")}},{name:"actions.cut.name",icon:"mdi-content-cut",onTrigger:()=>{t.cut()}},{name:"actions.paste.name",icon:"mdi-content-paste",onTrigger:()=>{t.paste()}}])}}async function Pt(s,e){return e||(e=(await l.getApp()).fileSystem),new Promise(async(t,i)=>{const n=new FileReader;try{const r=await(await e.getFileHandle(s)).getFile();n.addEventListener("load",()=>{t(n.result)}),n.addEventListener("error",i),n.readAsDataURL(r)}catch{i(`File does not exist: "${s}"`)}})}function $c(s){return new Promise(async(e,t)=>{const i=new FileReader;try{const n=await s.getFile();i.addEventListener("load",()=>{e(i.result)}),i.addEventListener("error",t),i.readAsDataURL(n)}catch{t(`File does not exist: "${s.name}"`)}})}const Dc={name:"ImageTab",props:{tab:Object}};var Ec=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex align-center justify-center",on:{click:function(i){return e.tab.parent.setActive(!0)}}},[t("img",{staticClass:"img-preview",attrs:{src:e.tab.dataUrl,alt:e.tab.path,draggable:"false"}})])},Mc=[],Ic=_(Dc,Ec,Mc,!1,null,"bd22dcf6",null,null);const Oc=Ic.exports;class bs extends O{constructor(){super(...arguments),this.component=Oc,this.dataUrl=void 0}static is(e){const t=e.name;return t.endsWith(".png")||t.endsWith(".jpg")||t.endsWith(".jpeg")}setReadOnly(e){this.readOnlyMode=e}async onActivate(){this.dataUrl=await $c(this.fileHandle)}get icon(){return"mdi-file-image-outline"}get iconColor(){return"primary"}_save(){}}class Rc extends bs{constructor(){super(...arguments),this.tga=new $a,this.maskIsApplied=!0}static is(e){return e.name.endsWith(".tga")}async setup(){await super.setup(),this.addAction(new M({icon:"mdi-image-filter-black-white",name:"actions.tgaMaskToggle.name",onTrigger:async()=>{if(this.maskIsApplied){await this.applyUnmaskedImageUrl(),this.maskIsApplied=!1;return}this.applyMaskedImageUrl(),this.maskIsApplied=!0}}))}async onActivate(){this.isLoading=!0;const e=await this.fileHandle.getFile();if(this.tga.load(new Uint8Array(await e.arrayBuffer())),this.isLoading=!1,this.maskIsApplied){this.applyMaskedImageUrl();return}await this.applyUnmaskedImageUrl()}_save(){}async saveAs(){}applyMaskedImageUrl(){this.dataUrl=this.tga.getDataURL("image/png")}async applyUnmaskedImageUrl(){const{width:e,height:t,data:i}=this.tga.getImageData(),n=new OffscreenCanvas(e,t),a=n.getContext("2d"),r=a.createImageData(e,t),o=i.length;for(let p=0;p<o;p+=4)r.data[p]=i[p],r.data[p+1]=i[p+1],r.data[p+2]=i[p+2],r.data[p+3]=255;a.putImageData(r,0,0);const c=await n.convertToBlob({type:"image/png"}),d=new FileReader;d.readAsDataURL(c),d.onload=()=>{var p;this.dataUrl=(p=d.result)==null?void 0:p.toString()},d.onerror=()=>{throw new Error("Failed reading OffscreenCanvas Blob")}}}const z={methods:{t(s){return B(s)}}};class Ze{}class jt extends Ze{constructor(e){super(),this.entries=e}get unselectTrees(){return this.entries.map(e=>e.unselectTrees).flat()}undo(){return new jt(this.entries.reverse().map(e=>e.undo()))}}class $i extends Ze{constructor(e,t,i=""){super(),this.tree=e,this.index=t,this.key=i,this.unselectTrees=[],this.unselectTrees=[this.tree]}undo(){const e=this.tree.getParent();if(!e)throw new Error("Invalid state: Undo delete action on global tree node");return e.type==="array"?e.children.splice(this.index,0,this.tree):e.children.splice(this.index,0,[this.key,this.tree]),new Qt(this.tree,this.index,this.key)}}class Qt extends Ze{constructor(e,t,i=""){super(),this.tree=e,this.index=t,this.key=i,this.unselectTrees=[],this.unselectTrees=[this.tree]}undo(){const e=this.tree.getParent();if(!e)throw new Error("Invalid state: Redo delete action on global tree node");return e.children.splice(this.index,1),new $i(this.tree,this.index,this.key)}}class Gi extends Ze{constructor(e,t,i){super(),this.parent=e,this.oldValue=t,this.newValue=i,this.unselectTrees=[e]}undo(){return this.parent.updatePropertyName(this.newValue,this.oldValue),new Gi(this.parent,this.newValue,this.oldValue)}}class Ki extends Ze{constructor(e,t){super(),this.tree=e,this.value=t,this.unselectTrees=[e]}undo(){const e=`${this.tree.value}`;return this.tree.edit(this.value),new Ki(this.tree,e)}}class Ie extends Ze{constructor(e,t){super(),this.oldTree=e,this.newTree=t,this.unselectTrees=[t]}undo(){return this.newTree.replace(this.oldTree),new Ie(this.newTree,this.oldTree)}}const Q=E("mouse");window.addEventListener("pointerdown",s=>{Q.value=s.pointerType},{passive:!0});const Ft=Q.value==="mouse"?19:26;class Yi{constructor(e){this.parent=e,this.uuid=D(),this.isSelected=!1}get value(){return this._value}getParent(){return this.parent}setParent(e){this.parent=e}get path(){return this.parent?[...this.parent.path,this.key]:[]}findParentIndex(){if(!this.parent)throw new Error("Cannot findParentIndex for tree without parent");let e;if(this.parent.type==="array"?e=this.parent.children.findIndex(t=>t===this):e=this.parent.children.findIndex(([t,i])=>i===this),e===-1)throw console.log(this),new Error("Invalid state: TreeChild with parent couldn't be found inside of parent's children");return e}get key(){if(!this.parent)throw new Error("Trees without parent do not have a key");const e=this.findParentIndex();return this.parent.type==="array"?e:this.parent.children[e][0]}setIsSelected(e){this.isSelected=e}replace(e){if(!this.parent)throw new Error("Cannot replace tree without parent");const t=this.findParentIndex();V(this.parent.children,t,this.parent.type==="array"?e:[this.key,e])}delete(){if(!this.parent)throw new Error("Cannot delete tree without parent");let e;if(this.parent.type==="array"){if(e=this.parent.children.findIndex(i=>i===this),e===-1)throw new Error("Invalid state: TreeChild with parent couldn't be found inside of parent's children")}else if(e=this.parent.children.findIndex(([i,n])=>n===this),e===-1)throw new Error("Invalid state: TreeChild with parent couldn't be found inside of parent's children");const[t]=this.parent.children.splice(e,1);return[e,Array.isArray(t)?t[0]:""]}}const Fn=s=>`${s}Def`,_s=s=>({data:()=>Object.fromEntries(s.map(e=>[Fn(e),{}])),mounted(){l.instance.themeManager.on(this.onThemeChanged),this.onThemeChanged()},destroyed(){l.instance.themeManager.off(this.onThemeChanged)},methods:{onThemeChanged(){s.forEach(e=>{this[Fn(e)]=l.instance.themeManager.getHighlighterInfo(e)})}}}),_t=new G({keywords:[],typeIdentifiers:[],variables:[],definitions:[]});setTimeout(()=>{l.getApp().then(s=>s.configuredJsonLanguage.getHighlighter().on(({keywords:e,typeIdentifiers:t,variables:i,definitions:n})=>{_t.keywords=e,_t.typeIdentifiers=t,_t.variables=i,_t.definitions=n}))});const Wc={props:{def:Object,value:String},mixins:[_s(["string","number","variable","definition","keyword","type"])],setup(){return{knownWords:_t}},data:()=>({skipRender:!0}),computed:{tokens(){return this.value.split(":").map(s=>({text:s,def:this.getDefinition(s)}))}},methods:{getDefinition(s){return this.knownWords.keywords.includes(s)?this.keywordDef:this.knownWords.typeIdentifiers.includes(s)?this.typeDef:this.knownWords.variables.includes(s)?this.variableDef:this.knownWords.definitions.includes(s)?this.definitionDef:this.stringDef},getTextDecoration(s){return s?(s.textDecoration||(s.textDecoration=""),s.isItalic&&(s.textDecoration+=" italic"),s.textDecoration):null},toStyle(s){return{color:s?s.color:null,backgroundColor:s?s.background:null,textDecoration:this.getTextDecoration(s)}},onIntersect(s){if(!this.skipRender)return;const e=!s[0].isIntersecting;this.skipRender=e}}};var Lc=function(){var e=this,t=e._self._c;return e.value===void 0?t("span",{style:e.toStyle(e.def)},[e._t("default")],2):t("span",{directives:[{name:"intersect",rawName:"v-intersect",value:e.skipRender?e.onIntersect:null,expression:"skipRender ? onIntersect : null"}],staticStyle:{"white-space":"nowrap"}},[e.skipRender?t("span",[e._v('"'+e._s(e.value)+'"')]):t("span",[e._v('"'),e._l(e.tokens,function({text:i,def:n},a){return[t("span",{key:i,style:e.toStyle(n)},[e._v(e._s(i))]),t("span",{key:`${i}.colon`},[e._v(e._s(e.tokens.length>a+1?":":""))])]}),e._v('"')],2)])},Nc=[],Bc=_(Wc,Lc,Nc,!1,null,null,null,null);const Ss=Bc.exports;class Qi extends Ze{constructor(e,t,i,n=""){super(),this.oldParent=e,this.tree=t,this.index=i,this.key=n,this.unselectTrees=[],this.unselectTrees=[this.tree]}undo(){const e=this.tree.getParent();if(!e)throw new Error("Invalid state: Undo delete action on global tree node");const t=this.tree.findParentIndex();return this.tree.delete(),this.oldParent.type==="array"?this.oldParent.children.splice(this.index,0,this.tree):this.oldParent.children.splice(this.index,0,[this.key,this.tree]),this.tree.setParent(this.oldParent),new Qi(e,this.tree,t,this.key)}}const Vc={name:"TreeChildren",components:{Highlight:Ss,Draggable:Wi},props:{tree:Object,treeEditor:Object},setup(){return{pointerDevice:Q}},methods:{wrapKey(s){return this.tree.type==="object"?`"${s}"`:`${s}`},onChange(s){if(s.removed||s.moved){const e=s.removed?s.removed.element[1]:s.moved.element[1],t=s.removed?s.removed.oldIndex:s.moved.oldIndex;this.treeEditor.history.push(new Qi(this.tree,e,t,e.key))}else s.added&&(s.added.element[1].parent=this.tree)}},computed:{dragAndDropEnabled(){var s,e;return(e=(s=S.editor)==null?void 0:s.dragAndDropTreeNodes)!=null?e:!0},children:{get(){return this.tree instanceof he?Object.entries(this.tree.children):this.tree.children},set(s){this.tree instanceof he?this.tree._children=s.map(e=>e[1]):this.tree._children=s}}}};var Hc=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pl-4"},[t("Draggable",{attrs:{group:{name:"treeEditorNode"},disabled:!e.dragAndDropEnabled||e.pointerDevice==="touch"},on:{change:e.onChange},model:{value:e.children,callback:function(i){e.children=i},expression:"children"}},e._l(e.children,function([i,n]){return t(n.component,{key:n.uuid,tag:"component",attrs:{tree:n,treeEditor:e.treeEditor},on:{setActive:function(a){return e.$emit("setActive")}}},[t("Highlight",{attrs:{value:i}})],1)}),1)],1)},Uc=[],zc=_(Vc,Hc,Uc,!1,null,null,null,null);const qc=zc.exports;function Di(s,e,t,i=500){let n=null;return{onTouchStart:(...o)=>{n=window.setTimeout(()=>{s(...o),n=null},i)},onTouchEnd:()=>{n&&(window.clearTimeout(n),n=null,e==null||e()),t==null||t()}}}const Cs={computed:{isDevMode(){var s,e;return(e=(s=S==null?void 0:S.developers)==null?void 0:s.isDevMode)!=null?e:!1}}};const et={array:"[]",object:"{}"},Jc={name:"ObjectTree",components:{TreeChildren:qc},mixins:[Cs],props:{tree:Object,treeKey:String,treeEditor:Object},setup(s){const{onTouchStart:e,onTouchEnd:t}=Di(i=>{s.treeEditor.onContextMenu(i,s.tree)},null,()=>{s.treeEditor.parent.app.contextMenu.setMayCloseOnClickOutside(!0)},800);return{onTouchStart:e,onTouchEnd:t,pointerDevice:Q}},computed:{openingBracket(){return this.tree.isOpen?et[this.tree.type][0]:Object.keys(this.tree.children).length>0?`${et[this.tree.type][0]}...${et[this.tree.type][1]}`:`${et[this.tree.type][0]}${et[this.tree.type][1]}`},closingBracket(){return this.tree.isOpen?et[this.tree.type][1]:void 0}},methods:{onClickKey(s){var e,t;this.$emit("setActive"),((t=(e=S.editor)==null?void 0:e.automaticallyOpenTreeNodes)==null||t)&&(!this.tree.isOpen||this.tree.isSelected)&&this.tree.toggleOpen(),s.altKey?this.treeEditor.toggleSelection(this.tree):this.treeEditor.setSelection(this.tree)}}};var Gc=function(){var e=this,t=e._self._c;return e.$slots.default?t("details",{attrs:{open:e.tree.isOpen,tabindex:"-1"}},[t("summary",{class:{"common-tree-key":!0,open:e.tree.isOpen,"tree-editor-selection":e.tree.isSelected},style:{height:e.pointerDevice==="touch"?"26px":null},attrs:{tabindex:"-1"},on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.onClickKey.apply(null,arguments)},contextmenu:function(i){return i.preventDefault(),e.treeEditor.onContextMenu(i,e.tree)},pointerdown:function(i){return e.onTouchStart(i)},pointerup:e.onTouchEnd,pointermove:e.onTouchEnd,pointercancel:e.onTouchEnd}},[t("v-icon",{staticClass:"mr-1 open-state-icon",style:{position:"relative",opacity:e.tree.hasChildren?null:"60%",top:e.tree.hasChildren?"0px":"-1.5px"},attrs:{small:""},nativeOn:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.tree.toggleOpen()}}},[e._v(" mdi-chevron-right ")]),e.tree.parent.type==="object"?t("span",[e.isDevMode?t("span",[e._v(" s: "+e._s(e.tree.type)+" p: "+e._s(e.tree.parent.type)+" ")]):e._e(),t("span",{on:{dblclick:function(i){return e.tree.toggleOpen()}}},[e._t("default")],2),e._v(":")]):t("span",{class:{"mx-2":e.pointerDevice!=="touch","mx-6":e.pointerDevice==="touch"}}),t("span",{staticClass:"px-1",on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.tree.toggleOpen()}}},[e._v(" "+e._s(e.openingBracket)+" ")])],1),e.tree.isOpen?t("TreeChildren",{attrs:{tree:e.tree,treeEditor:e.treeEditor},on:{setActive:function(i){return e.$emit("setActive")}}}):e._e(),e._v(" "+e._s(e.closingBracket)+" ")],1):t("TreeChildren",{attrs:{tree:e.tree,treeEditor:e.treeEditor},on:{setActive:function(i){return e.$emit("setActive")}}})},Kc=[],Yc=_(Jc,Gc,Kc,!1,null,"77eef739",null,null);const ks=Yc.exports;class ve extends Yi{constructor(e,t){super(e),this._value=t,this.component=k(ks),this._isOpen=!1,this.type="object",this._children=Object.entries(t).map(([i,n])=>[i,Zt(this,n)])}get height(){return this.isOpen?2*Ft+this._children.reduce((e,[t,i])=>e+i.height,0):Ft}get children(){return this._children}get hasChildren(){return this._children.length>0}get isOpen(){return this.hasChildren?this._isOpen:!1}hasChild(e){return this.children.some(([t,i])=>i===e)}addChild(e,t){this._children.push([e,t])}setOpen(e,t=!1){(this.hasChildren||t)&&(this._isOpen=e)}toggleOpen(){this.setOpen(!this._isOpen)}toJSON(){return Object.fromEntries(this._children.map(([e,t])=>[e,t.toJSON()]))}updatePropertyName(e,t){const i=this.children.findIndex(d=>d[0]===e);let[n,a]=this.children[i];if(!a)return;let r=0,o=t,c=this.children.findIndex(d=>d[0]===t);if(c!==i)for(;c!==-1;)c=this.children.findIndex(d=>d[0]===t),t=o+`_${r++}`;V(this.children,i,[t,a])}}const Qc={components:{Highlight:Ss},name:"PrimitiveTree",mixins:[_s(["atom","string","number"]),Cs],props:{tree:Object,treeEditor:Object},setup(s){const{onTouchStart:e,onTouchEnd:t}=Di(a=>{Q.value==="touch"&&s.treeEditor.onContextMenu(a,s.tree,!1)},null,()=>{s.treeEditor.parent.app.contextMenu.setMayCloseOnClickOutside(!0)}),{onTouchStart:i,onTouchEnd:n}=Di(a=>{Q.value==="touch"&&s.treeEditor.onContextMenu(a,s.tree)},null,()=>{s.treeEditor.parent.app.contextMenu.setMayCloseOnClickOutside(!0)});return{onTouchStart:e,onTouchEnd:t,onKeyTouchStart:i,onKeyTouchEnd:n,pointerDevice:Q}},computed:{treeValue(){return this.tree.value===null?"null":this.tree.type==="string"?this.tree.value:this.tree.value},highlighterInfoDef(){switch(this.tree.type){case"number":return"numberDef";case"string":return;case"boolean":return"atomDef";case"null":return"atomDef";default:throw new Error(`Unknown primitive type: "${this.tree.type}"`)}},highlighterInfo(){return this[this.highlighterInfoDef]},textDecoration(){return this.highlighterInfo.textDecoration||(this.highlighterInfo.textDecoration=""),this.highlighterInfo.isItalic&&(this.highlighterInfo.textDecoration+=" italic"),this.highlighterInfo.textDecoration}},methods:{onClickKey(s,e){this.$emit("setActive"),s.altKey?this.treeEditor.toggleSelection(this.tree,e):this.treeEditor.setSelection(this.tree,e)}}};var Zc=function(){var e=this,t=e._self._c;return t("div",{style:{display:"block",whiteSpace:"nowrap",height:e.pointerDevice==="touch"?"26px":null},attrs:{tabindex:"-1"}},[t("div",{class:{"tree-editor-selection":e.tree.type!=="object"&&e.tree.type!=="array"&&e.tree.isSelected},staticStyle:{display:"inline-block"},on:{contextmenu:function(i){return i.preventDefault(),i.stopPropagation(),e.treeEditor.onContextMenu(i,e.tree)},pointerdown:function(i){return e.onKeyTouchStart(i)},pointerup:e.onKeyTouchEnd}},[t("v-icon",{staticClass:"mr-1",style:{opacity:"60%",position:"relative",top:"-1.5px"},attrs:{small:""}},[e._v(" mdi-chevron-right ")]),e.tree.parent.type==="object"?t("span",[t("span",{on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.onClickKey.apply(null,arguments)}}},[e._t("default")],2),e._v(":")]):e._e()],1),e.isDevMode?t("span",[e._v(" s: "+e._s(e.tree.type)+" p: "+e._s(e.tree.parent.type))]):e._e(),t("Highlight",{class:{"tree-editor-selection":e.tree.isValueSelected,"px-1":!0},style:{height:"20.5px",display:"inline-block"},attrs:{def:e.highlighterInfo,value:this.tree.type==="string"?e.treeValue:void 0},on:{pointermove:e.onTouchEnd,pointercancel:e.onTouchEnd},nativeOn:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.onClickKey(i,!0)},contextmenu:function(i){return i.preventDefault(),e.treeEditor.onContextMenu(i,e.tree,!1)},pointerdown:function(i){return e.onTouchStart(i)},pointerup:function(i){return e.onTouchEnd.apply(null,arguments)}}},[e._v(" "+e._s(e.treeValue)+" ")])],1)},Xc=[],el=_(Qc,Zc,Xc,!1,null,null,null,null);const tl=el.exports;class ie extends Yi{constructor(e,t){super(e),this._value=t,this.component=k(tl),this.isValueSelected=!1}get type(){return this.value===null?"null":typeof this.value}get height(){return Ft}setValue(e){this._value=e}toJSON(){return this.value}edit(e){e==="true"||e==="false"?this.setValue(e==="true"):Number.isNaN(Number(e))?e==="null"?this.setValue(null):this.setValue(e):this.setValue(Number(e))}isEmpty(){return this.value===""}}function Zt(s,e){if(e===null)return new ie(s,null);if(Array.isArray(e))return new he(s,e);if(typeof e=="object")return new ve(s,e);if(["string","number","boolean"].includes(typeof e))return new ie(s,e);throw new Error(`Undefined type handler: "${typeof e}" -> ${e}`)}class he extends Yi{constructor(e,t){super(e),this._value=t,this.component=k(ks),this._isOpen=!1,this.type="array",this._children=t.map(i=>Zt(this,i))}get height(){return this.isOpen?2*Ft+this._children.reduce((e,t)=>e+t.height,0):Ft}get children(){return this._children}get hasChildren(){return this._children.length>0}get isOpen(){return this.hasChildren?this._isOpen:!1}hasChild(e){return this.children.includes(e)}addChild(e){this._children.push(e)}setOpen(e,t=!1){(this.hasChildren||t)&&(this._isOpen=e)}toggleOpen(){this.setOpen(!this._isOpen)}toJSON(){return this._children.map(e=>e.toJSON())}updatePropertyName(e,t){let i=this.children[e],n=this.children[t];return this.children[t]=i,delete this.children[e],{undo:()=>{this.children[e]=i,this.children[t]=n}}}}class Tn{constructor(e,t){this.parent=e,this.tree=t,t.setIsSelected(!0)}getTree(){return this.tree}getLocation(){return this.tree.path.join("/")}select(e){this.tree.setIsSelected(!1),this.tree=e,this.tree.setIsSelected(!0)}dispose(e=!0){this.tree.setIsSelected(!1),e&&this.parent.removeSelection(this)}edit(e){const t=this.tree.getParent();if(!t)throw new Error("Cannot edit property name without parent");if(t instanceof he)throw new Error("Cannot edit array indices");const i=this.tree.key;return t.updatePropertyName(i,e),new Gi(t,i,e)}addKey(e,t){if(this.tree instanceof ie)return;const i=this.tree.children.length,n=[];if(this.tree.setOpen(!0,!0),t==="objectArray"&&this.tree instanceof ve){this.dispose();const r=new he(this.tree.getParent(),[]);this.tree.replace(r),r.setOpen(!0,!0),n.push(new Ie(this.tree,r)),this.tree=r}const a=t==="object"?new ve(this.tree,{}):new he(this.tree,[]);if(this.tree instanceof he){this.tree.children.push(a);const r=new ve(a,{});a.type==="array"?a.children.push(r):a.children.push([e,r]),this.parent.setSelection(r),a.setOpen(!0)}else this.tree.children.push([e,a]),this.parent.setSelection(a);return this.tree.setOpen(!0),n.push(new Qt(a,i,e)),new jt(n)}addValue(e,t){const i=[];if(!(this.tree instanceof ie&&!this.tree.isEmpty())){if(t==="valueArray"&&this.tree instanceof ve){this.dispose();const n=new he(this.tree.getParent(),[]);n.setOpen(!0,!0),this.tree.replace(n),i.push(new Ie(this.tree,n)),this.tree=n}if(this.tree.type==="array"){const n=new ie(this.tree,e);this.tree.children.push(n),this.parent.setSelection(this.tree),i.push(new Qt(n,this.tree.children.length-1)),this.tree.setOpen(!0)}else if(this.tree instanceof ie||this.tree.children.length===0){const n=new ie(this.tree.getParent(),e);this.tree.replace(n),this.parent.setSelection(n.getParent()),this.dispose(),i.push(new Ie(this.tree,n))}return new jt(i)}}}class Fe{constructor(e,t){this.parent=e,this.tree=t,t.isValueSelected=!0}getTree(){return this.tree}getLocation(){return this.tree.path.join("/")}dispose(e=!0){this.tree.isValueSelected=!1,e&&this.parent.removeSelection(this)}edit(e){const t=`${this.tree.value}`;return this.tree.edit(e),new Ki(this.tree,t)}}const An=/^\d+(\.\d+)?$/;function xs(s){let e=s;return typeof s=="boolean"||s==="true"||s==="false"?e=typeof s=="boolean"?s:s==="true":An.test(s)?e=Number(s):(s==="null"||s===null)&&(e=null),An.lastIndex=0,e}const il={string:[],number:["string"],boolean:["string"],null:["string"],integer:["string","number"]};const nl={name:"TreeTab",mixins:[z],props:{tab:Object,height:Number},data:()=>({keyToAdd:"",valueToAdd:"",pressedShift:!1,triggerCooldown:!1,isUserControlledTrigger:!1}),mounted(){this.treeEditor.receiveContainer(this.$refs.editorContainer)},activated(){this.treeEditor.receiveContainer(this.$refs.editorContainer)},computed:{isUsingBridgePredictions(){var s,e;return(e=(s=S==null?void 0:S.editor)==null?void 0:s.bridgePredictions)!=null?e:!0},fontSize(){return S&&S.appearance&&S.appearance.editorFontSize?`${S.appearance.editorFontSize}`:"14px"},codeFontFamily(){return S&&S.appearance&&S.appearance.editorFont?`${S.appearance.editorFont}, monospace !important`:"Menlo, monospace !important"},fontFamily(){return this.settingsState&&this.settingsState.appearance&&this.settingsState.appearance.font?`${this.settingsState.appearance.font} !important`:"Roboto !important"},treeEditor(){return this.tab.treeEditor},currentValue(){let s;return this.treeEditor.forEachSelection(e=>{if(!e.getTree().parent)return;let t;try{e instanceof Fe?t=e.getTree().value:t=e.getTree().key}catch{}s===void 0?s=t:s!==t&&(s="")}),s},isGlobal(){let s=!1;return this.treeEditor.forEachSelection(e=>{s||e.getTree().parent||(s=!0)}),s},propertySuggestions(){return this.treeEditor.propertySuggestions.map(s=>({...s,text:s.value}))},valueSuggestions(){return this.treeEditor.valueSuggestions.map(s=>({...s,text:s.value}))},editSuggestions(){return this.treeEditor.editSuggestions.map(s=>({...s,text:s.value}))},allSuggestions(){return this.propertySuggestions.concat(this.valueSuggestions)}},methods:{focusEditor(){this.$refs.editorContainer&&this.$refs.editorContainer.focus()},onEdit(s){typeof s!="string"&&(s=s.value),this.treeEditor.edit(`${s}`)},onAdd(s,e=!1){if(this.triggerCooldown||!this.isUserControlledTrigger){this.isUserControlledTrigger||this.$nextTick(()=>{this.keyToAdd="",this.valueToAdd=""}),this.pressedShift=!1;return}if(!s)return this.pressedShift=!1,this.onTriggerCooldown();let t;if(e)this.pressedShift=!0;else if(typeof s=="string"){const a=this.allSuggestions.find(({label:r})=>r===s);if(a)s=a;else{const r=xs(s),o=typeof r=="number"?s.includes(".")?"number":"integer":typeof r,c=this.treeEditor.getSchemaTypes();(c.has(o)||il[o].some(d=>{if(c.has(d))return t=d,!0}))&&(this.pressedShift=!0)}}const{type:i=this.pressedShift?"value":"object",value:n=s}=s;this.pressedShift=!1,i==="snippet"?this.treeEditor.addFromJSON(n[1]):i==="object"||i==="array"?this.treeEditor.addKey(n,i):i==="value"||i==="valueArray"?this.treeEditor.addValue(n,i,t):console.error(`Unknown suggestion type: "${i}"`),this.$nextTick(()=>{this.keyToAdd="",this.valueToAdd=""}),this.onTriggerCooldown()},onTriggerCooldown(){this.triggerCooldown||(setTimeout(()=>{this.triggerCooldown=!1},100),this.triggerCooldown=!0)},mayTrigger(s){this.pressedShift=s.shiftKey,!this.isUserControlledTrigger&&(setTimeout(()=>{this.isUserControlledTrigger=!1},100),this.isUserControlledTrigger=!0)},forceValue(){this.$refs.addKeyInput.blur(),this.$nextTick(()=>{this.isUserControlledTrigger=!0,this.onAdd(this.keyToAdd,!0)})},onScroll(s){this.treeEditor.scrollTop=s.target.scrollTop},getIcon(s){switch(s.type){case"object":return"mdi-code-json";case"array":return"mdi-code-brackets";case"value":return"mdi-alphabetical";case"arrayValue":return"mdi-link-variant";case"objectArray":return"mdi-link-variant";case"snippet":return"mdi-attachment";default:return"mdi-text"}}},watch:{"tab.uuid"(){this.treeEditor.receiveContainer(this.$refs.editorContainer)},propertySuggestions(){if(this.isUsingBridgePredictions&&this.propertySuggestions.length>0){this.$refs.addKeyInput.focus();return}!this.$refs.addKeyInput||!this.$refs.addValueInput||!this.$refs.editValueInput||(this.propertySuggestions.length===0&&this.valueSuggestions.length>0?(this.$refs.editValueInput.blur(),this.$refs.addKeyInput.blur(),this.$refs.addValueInput.focus()):this.propertySuggestions.length>0?(this.$refs.editValueInput.blur(),this.$refs.addValueInput.blur(),this.$refs.addKeyInput.focus()):this.treeEditor.selections.some(s=>s.tree instanceof ie)&&(this.$refs.addKeyInput.blur(),this.$refs.addValueInput.blur(),this.$refs.editValueInput.focus()))}}};var sl=function(){var e=this,t=e._self._c;return t("div",{ref:"editorContainer",staticClass:"editor-container",style:{fontSize:e.fontSize,fontFamily:e.codeFontFamily},attrs:{tabindex:"-1"},on:{click:function(i){return e.tab.parent.setActive(!0)}}},[t("div",{staticClass:"pr-4",style:`height: ${e.height-!e.tab.isReadOnly*194}px; overflow: auto;`,on:{blur:e.focusEditor,scroll:e.onScroll,contextmenu:function(i){return i.preventDefault(),i.stopPropagation(),e.tab.treeEditor.onPasteMenu(i)}}},[t(e.tab.treeEditor.tree.component,{tag:"component",attrs:{tree:e.tab.treeEditor.tree,treeEditor:e.tab.treeEditor},on:{setActive:function(i){return e.tab.parent.setActive(!0)}}})],1),e.tab.isReadOnly?e._e():t("v-divider",{staticClass:"mb-4"}),e.tab.isReadOnly?e._e():t("div",{staticClass:"d-flex px-4",style:{fontFamily:e.fontFamily},on:{blur:e.focusEditor}},[t("v-combobox",{ref:"addKeyInput",attrs:{items:e.isUsingBridgePredictions?e.allSuggestions:e.propertySuggestions,"item-value":i=>i,"menu-props":{maxHeight:124,top:!1,contentClass:"json-editor-suggestions-menu",rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},label:e.isUsingBridgePredictions?e.t("editors.treeEditor.add"):e.t("editors.treeEditor.addObject"),outlined:"",dense:"","hide-details":""},on:{change:e.onAdd,keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.mayTrigger.apply(null,arguments)},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"tab",9,i.key,"Tab")?null:e.mayTrigger.apply(null,arguments)}]},scopedSlots:e._u([{key:"item",fn:function({item:i}){return[t("div",{staticStyle:{width:"100%"},on:{click:e.mayTrigger}},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary",small:""}},[e._v(" "+e._s(e.getIcon(i))+" ")]),t("span",{staticStyle:{"font-size":"0.8125rem","font-weight":"500","line-height":"1rem"}},[e._v(" "+e._s(i.label)+" ")])],1)]}}],null,!1,1072492042),model:{value:e.keyToAdd,callback:function(i){e.keyToAdd=i},expression:"keyToAdd"}}),e.isUsingBridgePredictions?t("v-tooltip",{attrs:{color:"tooltip",bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("v-btn",e._g({staticClass:"mx-4",on:{click:e.forceValue}},i),[t("v-icon",[e._v("mdi-alphabetical")])],1)]}}],null,!1,340804505)},[t("span",[e._v(e._s(e.t("editors.treeEditor.forceValue")))])]):t("v-combobox",{ref:"addValueInput",staticClass:"mx-4",attrs:{disabled:e.isGlobal,items:e.valueSuggestions,"item-value":i=>i,"menu-props":{maxHeight:124,top:!1,contentClass:"json-editor-suggestions-menu",rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},label:e.t("editors.treeEditor.addValue"),outlined:"",dense:"","hide-details":""},on:{change:i=>e.onAdd(i,!0),keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.mayTrigger.apply(null,arguments)},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"tab",9,i.key,"Tab")?null:e.mayTrigger.apply(null,arguments)}]},scopedSlots:e._u([{key:"item",fn:function({item:i}){return[t("div",{staticStyle:{width:"100%"},on:{click:e.mayTrigger}},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary",small:""}},[e._v(" "+e._s(e.getIcon(i))+" ")]),t("span",{staticStyle:{"font-size":"0.8125rem","font-weight":"500","line-height":"1rem"}},[e._v(" "+e._s(i.label)+" ")])],1)]}}],null,!1,1072492042),model:{value:e.valueToAdd,callback:function(i){e.valueToAdd=i},expression:"valueToAdd"}}),t("v-combobox",{ref:"editValueInput",attrs:{value:e.currentValue===void 0?void 0:`${e.currentValue}`,disabled:e.isGlobal,items:e.editSuggestions,"item-value":i=>i,"menu-props":{maxHeight:124,top:!1,contentClass:"json-editor-suggestions-menu",rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},label:e.t("editors.treeEditor.edit"),outlined:"",dense:"","hide-details":""},on:{change:i=>e.onEdit(i),keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.mayTrigger.apply(null,arguments)},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"tab",9,i.key,"Tab")?null:e.mayTrigger.apply(null,arguments)}]},scopedSlots:e._u([{key:"item",fn:function({item:i}){return[t("div",{staticStyle:{width:"100%"},on:{click:e.mayTrigger}},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary",small:""}},[e._v(" "+e._s(e.getIcon(i))+" ")]),t("span",{staticStyle:{"font-size":"0.8125rem","font-weight":"500","line-height":"1rem"}},[e._v(" "+e._s(i.label)+" ")])],1)]}}],null,!1,1072492042)})],1)],1)},al=[],rl=_(nl,sl,al,!1,null,null,null,null);const ol=rl.exports,cl=["Control","Alt","Meta"];class Ps{constructor(e=document){this.element=e,this.state=Dt({}),this.lastTimeStamp=0,this.onKeydown=t=>{const{key:i,ctrlKey:n,altKey:a,metaKey:r,shiftKey:o,code:c}=t;if(cl.includes(i))return;const d=ps({key:i,ctrlKey:J()==="darwin"?r:n,altKey:a,metaKey:J()==="darwin"?n:r,shiftKey:o}),p=this.state[d];if(p&&this.lastTimeStamp+100<Date.now()){if(p.prevent(t.target))return;this.lastTimeStamp=Date.now(),t.preventDefault(),t.stopImmediatePropagation(),p.trigger()}},e.addEventListener("keydown",this.onKeydown)}create(e){const t=new us(this,e),i=t.toStrKeyCode();if(this.state[i])throw new Error(`KeyBinding with keyCode "${i}" already exists!`);return V(this.state,i,t),t}disposeKeyBinding(e){Ee(this.state,e)}dispose(){this.element.removeEventListener("keydown",this.onKeydown)}}class ae{constructor(e,t,i){this.location=e,this.key=t,this.value=i}validate(e){return[]}isValid(e){return this.validate(e).length===0}}class js extends ae{constructor(e,t,i){super(e,t,i),this.schemaType="ifSchema",this.types=[],typeof i!="boolean"&&(this.rootSchema=new le(this.location,"if",i))}getSchemasFor(){return[]}getCompletionItems(){return[]}validate(){return[]}isTrue(e){var t;return typeof this.value=="boolean"?this.value:(t=this.rootSchema)==null?void 0:t.isValid(e)}}class Fs extends ae{constructor(e,t,i){if(typeof i!="boolean")throw new Error(`[${e}] Type of "doNotSuggest" must be boolean, found ${typeof i}`);super(e,t,i),this.types=[]}getSchemasFor(){return[]}getCompletionItems(){return[]}validate(){return[]}}class ft extends ae{get types(){return this.children.map(e=>e.types).flat()}get hasDoNotSuggest(){return this.children.some(e=>e instanceof Fs)}getCompletionItems(e){return this.hasDoNotSuggest?[]:this.children.map(t=>t.getCompletionItems(e)).flat()}getSchemasFor(e,t){return this.children.map(i=>i.getSchemasFor(e,[...t])).flat()}getFlatChildren(){const e=[];for(const t of this.children)t instanceof ft?e.push(...t.getFlatChildren()):e.push(t);return e}}class Ts extends ae{constructor(e,t,i){super(e,t,i),this.rootSchema=new le(this.location,"then",i)}get types(){return this.ifSchema.isTrue(this.value)?this.rootSchema.types:[]}receiveIfSchema(e){this.ifSchema=e}getSchemasFor(e,t){return this.ifSchema.isTrue(e)?this.rootSchema.getSchemasFor(e,[...t]):[]}getCompletionItems(e){return this.ifSchema.isTrue(e)?this.rootSchema.getCompletionItems(e):[]}validate(e){return this.ifSchema.isTrue(e)?this.rootSchema.validate(e):[]}}class le extends ft{constructor(e,t,i){super(e,t,i),(t==="$global"||t==="$ref")&&ge.addRootSchema(e,this),this.children=ge.createSchemas(this.location,i)}validate(e){return this.children.map(t=>t.validate(e)).flat()}getFreeIfSchema(){let e=!1;for(const t of this.getFlatChildren().reverse())if(t instanceof Ts)e=!0;else if(t instanceof js)if(e)e=!1;else return t}}class ll extends ae{constructor(e,t,i){super(e,t,i),this.types=[],typeof i=="object"&&(this.rootSchema=new le(e,t,i))}validate(e){var t,i;return(i=(t=this.rootSchema)==null?void 0:t.validate(e))!=null?i:[]}getCompletionItems(e){return[]}getSchemasFor(e,t){var n,a;if(t.length===0)return[];if(t.length===1)return this.rootSchema?[this.rootSchema]:[];const i=t.shift();return Array.isArray(e[i])?[]:(a=(n=this.rootSchema)==null?void 0:n.getSchemasFor(e[i],t))!=null?a:[]}}class dl extends ft{constructor(e,t,i){if(super(e,t,i),!Array.isArray(i))throw new Error(`"allOf" schema must be of type array, found "${typeof i}"`);this.children=i.map(n=>new le(this.location,"allOf",n))}validate(e){return this.children.map(t=>t.validate(e)).flat()}}class pl extends ft{constructor(e,t,i){if(super(e,t,i),!Array.isArray(i))throw new Error(`"anyOf" schema must be of type array, found "${typeof i}"`);this.children=i.map(n=>new le(this.location,"anyOf",n))}validate(e){const t=[];for(const i of this.children){const n=i.validate(e);if(n.length===0)return[];t.push(...n)}return t}}class As extends ae{constructor(){super(...arguments),this.types=[]}getSchemasFor(){return[]}getCompletionItems(){return[{type:"value",label:`${this.value}`,value:this.value}]}validate(e){return this.value!==e?[{message:`Found ${e}; expected ${this.value}`}]:[]}}class ul extends ae{constructor(){super(...arguments),this.types=[]}getSchemasFor(){return[]}getCompletionItems(){return typeof this.value!="object"&&!Array.isArray(this.value)?[{type:"value",label:`${this.value}`,value:this.value}]:[]}}class hl extends ae{constructor(e,t,i){super(e,t,i),this.rootSchema=new le(this.location,"else",i)}get types(){return this.ifSchema.isTrue(this.value)?[]:this.rootSchema.types}receiveIfSchema(e){this.ifSchema=e}getSchemasFor(e,t){return this.ifSchema.isTrue(e)?[]:this.rootSchema.getSchemasFor(e,[...t])}getCompletionItems(e){return this.ifSchema.isTrue(e)?[]:this.rootSchema.getCompletionItems(e)}validate(e){return this.ifSchema.isTrue(e)?[]:this.rootSchema.validate(e)}}class fl extends ae{constructor(e,t,i){if(super(e,t,i),this.types=[],!Array.isArray(i))throw new Error(`Enum must be of type array; found ${typeof i}`)}getSchemasFor(){return[]}getCompletionItems(){return this.value.map(e=>({type:"value",label:`${e}`,value:e}))}validate(e){return this.value.includes(e)?[]:[{message:`Found ${e}; expected one of ${this.value.join(", ")}`}]}}class ml extends ae{constructor(e,t,i){if(super(e,t,i),typeof i!="object"&&typeof i<"u")throw new Error(`Invalid usage of "properties" schema field. Expected type "object", received "${typeof i}"`);Array.isArray(i)?this.children=i.map(n=>new le(this.location,"items",n)):this.children=new le(this.location,"items",i)}get types(){return["array"]}get arrayChildren(){return Array.isArray(this.children)?this.children:[this.children]}getSchemasFor(e,t){var n,a;const i=t.shift();return typeof i=="string"?[]:i===void 0?this.arrayChildren:t.length===0?Array.isArray(this.children)?this.children[i]?[this.children[i]]:[]:[this.children]:Array.isArray(this.children)?(a=(n=this.children[i])==null?void 0:n.getSchemasFor(e[i],[...t]))!=null?a:[]:this.children.getSchemasFor(e[i],[...t])}getCompletionItems(e){return this.arrayChildren.filter(t=>!t.hasDoNotSuggest).map(t=>t.getCompletionItems(e).map(i=>({type:i.type==="object"?"objectArray":"valueArray",label:`${i.value}`,value:i.value}))).flat()}validate(e){return[]}}class gl extends ae{constructor(e,t,i){if(super(e,t,i),this.types=[],typeof i!="object")throw new Error(`[${e}] Type of "not" must be object, found ${typeof i}`);this.rootSchema=new le(this.location,"not",i)}getSchemasFor(){return[]}getCompletionItems(){return[]}validate(e){return[]}isValid(e){return this.rootSchema.validate(e).length>0}}class wl extends ft{constructor(e,t,i){if(super(e,t,i),!Array.isArray(i))throw new Error(`"oneOf" schema must be of type array, found "${typeof i}"`);this.children=i.map(n=>new le(this.location,"oneOf",n))}validate(e){const t=[];let i=!1,n=!1;for(const a of this.children){const r=a.validate(e);r.length===0&&(i&&(n=!0),i=!0),t.push(...r)}return n?[{message:"JSON matched more than one schema, expected exactly one match"}]:i?[]:t}}class yl extends ae{constructor(e,t,i){if(super(e,t,i),this.children={},typeof i!="object"&&typeof i<"u")throw new Error(`Invalid usage of "properties" schema field. Expected type "object", received "${typeof i}"`);this.children=Object.fromEntries(Object.entries(i!=null?i:{}).map(([n,a])=>[n,new le(this.location,n,a)]))}get types(){return["object"]}getSchemasFor(e,t){const i=t.shift();let n=[];if(typeof i=="number"||i===void 0)return n;if(Array.isArray(e[i]))return[];for(const[a,r]of Object.entries(this.children))i.match(new RegExp(a))!==null&&n.push(r);return t.length===0?n:n.map(a=>a.getSchemasFor(e[i],[...t])).flat()}getCompletionItems(){return[]}validate(e){if(typeof e!="object"||Array.isArray(e))return[{message:`Invalid type: Expected "object", received "${Array.isArray(e)?"array":typeof e}"`}];const t=[];for(const i in e)for(const[n,a]of Object.entries(this.children))i.match(new RegExp(n))===null&&t.push(...a.validate(e[i]));return t}}class vl extends ae{constructor(e,t,i){if(super(e,t,i),this.children={},typeof i!="object"&&typeof i<"u")throw new Error(`[${this.location}] Invalid usage of "properties" schema field. Expected type "object", received "${typeof i}"`);this.children=Object.fromEntries(Object.entries(i!=null?i:{}).map(([n,a])=>[n,new le(this.location,n,a)]))}get types(){return["object"]}getSchemasFor(e,t){var n,a;const i=t.shift();return i===void 0?Object.values(this.children):t.length===0?this.children[i]?[this.children[i]]:[]:(a=(n=this.children[i])==null?void 0:n.getSchemasFor(e[i],[...t]))!=null?a:[]}getCompletionItems(e){const t=Object.keys(typeof e=="object"?e!=null?e:{}:{});return Object.entries(this.children).filter(([i,n])=>!t.includes(i)&&!n.hasDoNotSuggest).map(([i,n])=>{const a=new Set(n.types),r=[],o=a.has("array");return o&&r.push({type:"array",label:`${i}`,value:i}),(!o||a.size>1)&&r.push({type:"object",label:`${i}`,value:i}),r}).flat()}validate(e){if(typeof e!="object"||Array.isArray(e))return[{message:`Invalid type: Expected "object", received "${Array.isArray(e)?"array":typeof e}"`}];const t=[];for(const i in e)this.children[i]&&t.push(...this.children[i].validate(e[i]));return t}}class bl extends ae{constructor(e,t,i){super(e,t,i),this.types=[],this.rootSchema=new le(this.location,"propertyNames",i)}getSchemasFor(){return[]}getCompletionItems(e){return this.rootSchema.getCompletionItems(e).filter(t=>t.type==="value").map(t=>({type:"object",label:`${t.value}`,value:t.value}))}validate(){return[]}isTrue(e){return this.rootSchema.isValid(e)}}class Zi extends ae{constructor(e,t,i){var n,a;if(super(e,t,i),this.schemaType="refSchema",typeof i!="string")throw new Error(`Invalid $ref type "${typeof i}": ${JSON.stringify(i)}`);if(i.startsWith("#")){const r=this.location.split("#/")[0],o=i==="#"?r:`${r}${i}`;this.rootSchema=(n=ge.requestRootSchema(o))!=null?n:new le(o,"$ref",ge.request(r,i==="#"?void 0:i.replace("#/","")))}else{const r=this.location.includes("#/")?ye(this.location.split("#/")[0]):ye(this.location);let o;i.startsWith("/")?o=`file://${i}`:o=Re(r,i).replace("file:/","file:///");let c;o.includes("#/")&&([o,c]=o.split("#/")),this.location=o,this.rootSchema=(a=ge.requestRootSchema(c?`${o}#/${c}`:o))!=null?a:new le(c?`${o}#/${c}`:o,"$ref",ge.request(this.location,c))}}get types(){return this.rootSchema.types}getCompletionItems(e){return this.rootSchema.getCompletionItems(e)}validate(e){return this.rootSchema.validate(e)}getSchemasFor(e,t){return this.rootSchema.getSchemasFor(e,[...t])}getFreeIfSchema(){return this.rootSchema.getFreeIfSchema()}}class _l extends ae{constructor(){super(...arguments),this.types=[]}getSchemasFor(){return[]}getCompletionItems(){return[]}validate(e){const t=Array.isArray(this.value)?this.value:[this.value];if(typeof e!="object"||Array.isArray(e))return[{message:`Required properties missing: ${t.join(", ")}`}];for(const i of t)if(e[i]===void 0||e[i]===null)return[{message:`Missing required property: ${i}`}];return[]}}function $n(s){return Array.isArray(s)?"array":typeof s}class Sl extends ae{get values(){return Array.isArray(this.value)?this.value:[this.value]}get types(){return this.values}getSchemasFor(){return[]}getCompletionItems(){const e=[];return this.values.includes("boolean")&&e.push(...[!0,!1].map(t=>({type:"value",label:`${t}`,value:t}))),this.values.includes("integer")&&e.push(...[0,1,2,3,4,5,6,7,8,9].map(t=>({type:"value",label:`${t}`,value:t}))),this.values.includes("number")&&e.push(...[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1].map(t=>({type:"value",label:`${t}`,value:t}))),this.values.includes("null")&&e.push({type:"value",label:"null",value:null}),e}validate(e){const t=Array.isArray(this.value)?this.value:[this.value];return t.includes($n(e))?[]:[{message:`Invalid type: Found ${$n(e)}; expected ${t.join(", ")}`}]}}const Dn=new Map([["$ref",Zi],["additionalProperties",ll],["allOf",dl],["anyOf",pl],["const",As],["enum",fl],["if",js],["items",ml],["oneOf",wl],["patternProperties",yl],["properties",vl],["propertyNames",bl],["required",_l],["then",Ts],["type",Sl],["default",ul],["else",hl],["doNotSuggest",Fs],["not",gl]]),Cl=new Set(["$schema","$id","description","title","definitions","pattern","min","max","maxItems","minItems","deprecationMessage","examples","minimum","maximum","format","maxLength","multipleOf"]);class ge{static setJSONDefaults(e){this.lib=e,this.rootSchemas.clear()}static request(e,t){const i=this.lib[e];if(!i)return console.warn(`Couldn't find schema for "${e}"${t?`(#${t})`:""}`),{};if(t){let n;return ri(t,i.schema,a=>n=a),n===void 0&&console.error(`Couldn't find hash ${t} @ ${e}`),n!=null?n:{}}else return i.schema}static addRootSchema(e,t){return this.rootSchemas.set(e,t),t}static requestRootSchema(e){return this.rootSchemas.get(e)}static createSchemas(e,t){if(typeof t!="object")return console.warn(`Unexpected schema type "${typeof t}" @ ${e}`),[new As(e,"",t)];let i=[];for(const[n,a]of Object.entries(t)){if(a===void 0)continue;const r=Dn.get(n);if(r===void 0){if(Cl.has(n))continue;console.warn(`Schema field not implemented: <${n}, ${a}> @ ${e}`);continue}const o=new r(e,n,a);if(n==="then"||n==="else"){let d=i.reverse().map(p=>{if(p.schemaType==="ifSchema")return p;if(p.schemaType==="refSchema")return p.getFreeIfSchema()}).filter(p=>p!==void 0)[0];d||(console.warn(`"${n}" schema without "if" @ ${e}`),d=new(Dn.get("if"))(e,"if",!0)),o.receiveIfSchema(d)}i.push(o)}return i}}ge.lib={};ge.rootSchemas=new Map;class kl extends H{constructor(e){super(),this.parent=e,this.changed=new H,this.undoStack=[],this.redoStack=[],this.lastUndoLength=0}get length(){return this.undoStack.length}updateHasChanges(){this.dispatch(this.undoStack.length!==this.lastUndoLength)}saveState(){this.lastUndoLength=this.undoStack.length,this.updateHasChanges()}undo(){const e=this.undoStack.pop();!e||(e.unselectTrees.forEach(t=>this.parent.removeSelectionOf(t)),this.redoStack.push(e.undo()),this.updateHasChanges(),this.changed.dispatch())}redo(){const e=this.redoStack.pop();!e||(e.unselectTrees.forEach(t=>this.parent.removeSelectionOf(t)),this.undoStack.push(e.undo()),this.updateHasChanges(),this.changed.dispatch())}push(e){this.undoStack.push(e),this.redoStack=[],this.updateHasChanges(),this.changed.dispatch()}pushAll(e){e.length!==0&&(e.length===1?this.push(e[0]):this.push(new jt(e)))}}const $s=J()==="darwin"?"Ctrl + Shift + Z":"Ctrl + Y";function xl(s){return`t-${s.type}:v-${s.value}`}function Bt(s){const e=new Set;return s.filter(t=>{const i=xl(t),n=!e.has(i);return e.add(i),n})}class Pl{constructor(e,t){this.parent=e,this.json=t,this.propertySuggestions=[],this.valueSuggestions=[],this.editSuggestions=[],this.selections=[],this.history=new kl(this),this.selectionChange=new H,this.scrollTop=0,this.updateSuggestions=Ue(async()=>{var o,c;const i=this.tree.toJSON().format_version||this.parent.project.config.get().targetVersion||await Qe(),{tree:n,isValueSelection:a}=this.getSelectedTree(),r=this.getSuggestions(n);this.propertySuggestions=Bt(r.filter(d=>{var p;return["object","array"].includes(d.type)&&!((p=(n!=null?n:this.tree).children)!=null&&p.find(u=>u.type==="array"?!1:u[0]===d.value))}).concat(this.parent.app.project.snippetLoader.getSnippetsFor(i,this.parent.getFileType(),this.selections.map(d=>d.getLocation())).map(d=>({type:"snippet",label:d.displayData.name,value:d.insertData})))),n instanceof ve&&((o=n==null?void 0:n.children)==null?void 0:o.length)===0||n instanceof he||n instanceof ie&&n.isEmpty()?this.valueSuggestions=Bt(r.filter(d=>d.type==="value"||d.type==="valueArray")):this.valueSuggestions=[],this.editSuggestions=[],a&&n instanceof ie&&(this.editSuggestions=Bt(r.filter(d=>d.type==="value"))),n instanceof ve&&(this.editSuggestions=Bt(this.getSuggestions((c=n.getParent())!=null?c:void 0).filter(d=>d.type==="object")))},50),this.tree=Zt(null,t),this.setSelection(this.tree),this.history.on(i=>{this.parent.setIsUnsaved(i)}),this.history.changed.on(()=>{this.propertySuggestions=[],this.valueSuggestions=[],this.parent.updateCache()}),l.getApp().then(async i=>{await i.projectManager.projectReady.fired,this.parent.once(()=>{i.project.jsonDefaults.isReady&&this.createSchemaRoot()}),i.project.jsonDefaults.on(()=>{this.parent.hasFired&&this.createSchemaRoot()})}),this.selectionChange.on(()=>this.updateSuggestions())}get keyBindings(){if(!this._keyBindings)throw new Error("Cannot access keyBindings before they were initialized.");return this._keyBindings}get actions(){if(!this._actions)throw new Error("Cannot access keyBindings before they were initialized.");return this._actions}createSchemaRoot(){var t;const e=(t=l.fileType.get(this.parent.getPath()))==null?void 0:t.schema;e&&(this.schemaRoot=ge.addRootSchema(e,new le(e,"$global",ge.request(e)))),this.updateSuggestions()}getSchemas(e,t=!1){var i,n;return this.selections.length===0||e===this.tree?this.schemaRoot?[this.schemaRoot]:[]:e?(n=(i=this.schemaRoot)==null?void 0:i.getSchemasFor(this.tree.toJSON(),t?[...e.path,void 0]:e.path))!=null?n:[]:[]}getSuggestions(e){const t=e==null?void 0:e.toJSON();return this.getSchemas(e).filter(n=>n!==void 0).map(n=>n.getCompletionItems(t)).flat()}getSchemaTypes(e){const{tree:t,isValueSelection:i}=this.getSelectedTree();if(i)return new Set;e===void 0&&(e=t instanceof he);const n=this.getSchemas(t,e);return n.length===0?new Set:new Set(n.reduce((a,r)=>a.concat(r.types),[]))}getSelectedTree(){if(this.selections.length===0)return{tree:this.tree,isValueSelection:!1};const e=this.selections[0];return{tree:e==null?void 0:e.getTree(),isValueSelection:e instanceof Fe}}receiveContainer(e){var t,i;(t=this._keyBindings)==null||t.dispose(),(i=this._actions)==null||i.dispose(),this._keyBindings=new Ps(e),this._actions=new Mt(this._keyBindings),this.containerElement=e,this.actions.create({keyBinding:["Ctrl + DELETE","Ctrl + BACKSPACE"],onTrigger:()=>{const n=[];this.forEachSelection(a=>{const r=a.getTree();if(!!r.getParent())if(a.dispose(),a instanceof Fe&&r.getParent().type==="object"){const o=new ve(r.getParent(),{});this.setSelection(o),r.replace(o),n.push(new Ie(r,o))}else{this.toggleSelection(r.getParent());const[o,c]=r.delete();n.push(new $i(r,o,c))}}),this.history.pushAll(n)}}),this.actions.create({keyBinding:["ESCAPE"],onTrigger:()=>{this.setSelection(this.tree)}}),this.actions.create({keyBinding:["CTRL + Z"],onTrigger:()=>{this.undo()}}),this.actions.create({keyBinding:[$s],onTrigger:()=>{this.redo()}})}deactivate(){var e,t;(e=this._keyBindings)==null||e.dispose(),(t=this._actions)==null||t.dispose()}activate(){!this.containerElement||(this.receiveContainer(this.containerElement),this.containerElement.children[0].scrollTop=this.scrollTop)}saveState(){this.history.saveState()}toJSON(){return this.tree.toJSON()}toJsonString(e=!1){return JSON.stringify(this.toJSON(),null,e?"	":void 0).replaceAll("\\\\","\\")}forEachSelection(e){this.selections.forEach(e)}removeSelection(e){this.selections=this.selections.filter(t=>e!==t),this.selectionChange.dispatch()}removeSelectionOf(e){this.selections=this.selections.filter(t=>{const i=t.getTree();return i!==e&&(e instanceof ie||!e.hasChild(i))?!0:(t.dispose(!1),!1)}),this.selectionChange.dispatch()}setSelection(e,t=!1){this.selections.forEach(i=>i.dispose(!1)),this.selections=[t&&e instanceof ie?new Fe(this,e):new Tn(this,e)],this.selectionChange.dispatch()}toggleSelection(e,t=!1){let i=!1;this.selections=this.selections.filter(n=>n.getTree()!==e||n instanceof Fe!==t?!0:(n.dispose(!1),i=!0,!1)),i||this.selections.push(t&&e instanceof ie?new Fe(this,e):new Tn(this,e)),this.selectionChange.dispatch()}addKey(e,t){const i=[];this.forEachSelection(n=>{if(n instanceof Fe)return;const a=n.addKey(e,t);a&&i.push(a)}),this.history.pushAll(i)}addValue(e,t,i){let n=xs(e);i&&(i==="string"?n=e:i==="integer"?n=parseInt(e):i==="number"?n=parseFloat(e):i==="boolean"?n=e==="true":i==="null"&&(n=null));const a=[];this.forEachSelection(r=>{if(r instanceof Fe)return;const o=r.addValue(n,t);o&&a.push(o)}),this.history.pushAll(a)}addFromJSON(e){if(typeof e!="object")return;let t=[];this.forEachSelection(i=>{if(i instanceof Fe)return;const n=i.getTree();if(n instanceof ie)return;const a=n.children.length;for(const r in e){const o=Zt(n,e[r]);n instanceof ve?n.addChild(r,o):n.addChild(o),t.push(new Qt(o,a,n instanceof ve?r:void 0))}}),this.history.pushAll(t)}edit(e){const t=[];this.forEachSelection(i=>{const n=i.edit(e);n&&t.push(n)}),this.history.pushAll(t)}delete(e){this.removeSelectionOf(e);const[t,i]=e.delete();this.history.push(new $i(e,t,i))}objectValueDeletion(e){this.removeSelectionOf(e);const t=new ve(e.getParent(),{});e.replace(t),this.history.push(new Ie(e,t))}onPasteMenu(e,t=this.tree){const i=[{name:"actions.paste.name",icon:"mdi-content-paste",onTrigger:()=>{this.setSelection(t),this.parent.paste()}}];return e&&!this.parent.isReadOnly&&$e(e,i,!1),i}onReadOnlyMenu(e,t=this.tree,i=!0){const n=[{name:"actions.documentationLookup.name",icon:"mdi-book-open-outline",onTrigger:()=>{const a=i?t.key:t.value;typeof a=="string"&&gs(this.parent.getPath(),a)}},{name:"actions.copy.name",icon:"mdi-content-copy",onTrigger:()=>{this.setSelection(t,!i),this.parent.copy()}}];return e&&$e(e,n,!1),n}onContextMenu(e,t,i=!0){if(this.parent.isReadOnly)return this.onReadOnlyMenu(e,t,i);const[n,a]=this.onReadOnlyMenu(void 0,t,i),r=[n];t instanceof ie?r.push({name:"general.delete",icon:"mdi-delete-outline",onTrigger:()=>{t.getParent().type==="object"&&!i?this.objectValueDeletion(t):this.delete(t)}}):r.push({name:"general.delete",icon:"mdi-delete-outline",onTrigger:()=>{this.delete(t)}}),r.push(a,{name:"actions.cut.name",icon:"mdi-content-cut",onTrigger:()=>{this.setSelection(t,!i),this.parent.cut()}},...t instanceof ie?[]:this.onPasteMenu(void 0,t)),!(t instanceof ie)&&t.children.length===0&&r.push({name:t instanceof he?"actions.toObject.name":"actions.toArray.name",icon:t instanceof he?"mdi-code-braces-box":"mdi-code-array",onTrigger:()=>{if(this.removeSelectionOf(t),t instanceof he){const o=new ve(t.getParent(),{});t.replace(o),this.history.push(new Ie(t,o))}else{const o=new he(t.getParent(),[]);t.replace(o),this.history.push(new Ie(t,o))}}}),$e(e,r,!1)}undo(){this.history.undo()}redo(){this.history.redo()}}const jl=Ue(async s=>{const e=s.treeEditor.toJsonString(),t=await l.getApp();t.project.fileChange.dispatch(s.getPath(),await s.getFile()),await t.project.packIndexer.updateFile(s.getPath(),e,s.isForeignFile,!0),await t.project.jsonDefaults.updateDynamicSchemas(s.getPath())},600);class Tt extends O{constructor(e,t,i){super(e,t,i),this.component=ol,this.fired.then(async()=>{const n=await l.getApp();await n.projectManager.projectReady.fired,n.project.tabActionProvider.addTabActions(this)})}get app(){return this.parent.app}get project(){return this.parent.project}static is(e){var t;return((t=S==null?void 0:S.editor)==null?void 0:t.jsonEditor)==="treeEditor"&&e.name.endsWith(".json")}get treeEditor(){if(!this._treeEditor)throw new Error("Trying to access TreeEditor before it was setup.");return this._treeEditor}async setup(){let e;try{const t=await this.fileHandle.getFile().then(i=>i.text());t===""?e={}:e=R.parse(t.replaceAll("\\n","\\\\n"))}catch{new U({name:"windows.invalidJson.title",description:"windows.invalidJson.description"}),this.close();return}this._treeEditor=new Pl(this,e),await super.setup()}async getFile(){return new File([JSON.stringify(this.treeEditor.toJsonString())],this.name)}updateCache(){jl(this)}async onActivate(){this.treeEditor.activate()}onDeactivate(){var e;(e=this._treeEditor)==null||e.deactivate()}loadEditor(){}setReadOnly(e){this.readOnlyMode=e}async _save(){this.isTemporary=!1;const e=this.treeEditor.toJsonString(!0);await this.writeFile(e)&&this.treeEditor.saveState()}async paste(){if(this.isReadOnly)return;const e=await navigator.clipboard.readText();let t;try{t=R.parse(e)}catch{try{t=R.parse(`{${e}}`)}catch{return}}t!==void 0&&this.treeEditor.addFromJSON(t)}async copy(){let e="";this.treeEditor.forEachSelection(t=>{const i=t.getTree();t instanceof Fe?i.isValueSelected?e+=i.toJSON():e+=i.key:e+=`"${i.key}": ${JSON.stringify(t.getTree().toJSON(),null,"	")}`}),e!==""&&await navigator.clipboard.writeText(e)}async cut(){this.isReadOnly||(await this.copy(),this.treeEditor.forEachSelection(e=>this.treeEditor.delete(e.getTree())))}async close(){const e=await super.close();if(!this.isForeignFile&&e&&this.isUnsaved)if(this.isForeignFile)await this.app.fileSystem.unlink(this.getPath());else{const i=await(await this.fileHandle.getFile()).text();await this.project.packIndexer.updateFile(this.getPath(),i)}return e}}class Xi{static get tabs(){return[...this._tabs].reverse()}static register(e){return this._tabs.add(e),{dispose:()=>this._tabs.delete(e)}}}Xi._tabs=new Set([ot,Tt,bs,Rc]);class En extends Ac{constructor(e,t=0){super(e.app),this._project=e,this.uuid=D(),this.tabs=E([]),this._selectedTab=E(void 0),this._isActive=!0,this.shouldRender=K(()=>this.tabs.value.length>0),this.isSharingScreen=K(()=>{var n;const i=this.project.tabSystems.find(a=>a!==this);return(n=i==null?void 0:i.shouldRender.value)!=null?n:!1}),this.openedFiles=new mc(this,e.app,`${e.projectPath}/.bridge/openedFiles_${t}.json`)}get tabTypes(){return Xi.tabs}get isActive(){return this._isActive}get app(){return this._app}get project(){return this._project}get hasUnsavedTabs(){return this.tabs.value.some(e=>e.isUnsaved)}get selectedTab(){return this._selectedTab.value}get currentComponent(){var e,t;return(t=(e=this._selectedTab.value)==null?void 0:e.component)!=null?t:ds}get projectRoot(){return this.project.baseDirectory}get projectName(){return this.project.name}async open(e,{selectTab:t=!0,readOnlyMode:i="off",isTemporary:n=!0}={}){const a=await this.getTabFor(e,i);return n||(a.isTemporary=!1),await this.add(a,t),a}async openPath(e,t={}){const i=await this.project.app.fileSystem.getFileHandle(e);return await this.open(i,t)}async getTabFor(e,t="off"){let i;for(const n of this.tabTypes)if(await n.is(e)){i=new n(this,e,t);break}return i||(i=new ot(this,e,t)),await i.fired}async hasTab(e){for(const t of this.tabs.value)if(await t.is(e))return!0;return!1}async add(e,t=!0,i=!1){if(this.closeAllTemporary(),!i){for(const n of this.tabs.value)if(await n.is(e))return e.onDeactivate(),t?n.select():n}return e.hasFired||await e.fired,this.tabs.value=[...this.tabs.value,e],!e.isForeignFile&&!(e instanceof O&&e.isReadOnly)&&await this.openedFiles.add(e.getPath()),t&&e.select(),this.project.updateTabFolders(),e}remove(e,t=!0,i=!0){e.onDeactivate();const n=this.tabs.value.findIndex(a=>a===e);if(n!==-1)return this.tabs.value.splice(n,1),t&&e.onDestroy(),i&&e===this.selectedTab&&this.select(this.tabs.value[n===0?0:n-1]),e.isForeignFile||this.openedFiles.remove(e.getPath()),this.project.updateTabFolders(),e}async close(e=this.selectedTab,t=!0){return e?t&&e.isUnsaved?await new hc(e).fired!=="cancel":(this.remove(e),!0):!1}async closeTabWithHandle(e){const t=await this.getTab(e);t&&this.close(t)}async select(e){var t,i;this.isActive!==!!e&&this.setActive(!!e),this.app.mobile.isCurrentDevice()&&l.sidebar.hide(),!(e!=null&&e.isSelected)&&((t=this.selectedTab)==null||t.onDeactivate(),e&&e!==this.selectedTab&&this.project.isActiveProject&&l.eventSystem.dispatch("currentTabSwitched",e),this._selectedTab.value=e,e&&(await((i=this.selectedTab)==null?void 0:i.onActivate()),We.nextTick(async()=>{var n;(n=this._monacoEditor)==null||n.layout()})))}async save(e=this.selectedTab){if(!e||e instanceof O&&e.isReadOnly)return;e==null||e.setIsLoading(!0);const t=this.selectedTab===e,i=this.selectedTab;i!==e&&await this.select(e),e instanceof O&&await e.save(),i!==e&&await this.select(i),!e.isForeignFile&&e instanceof O&&(await this.project.updateFile(e.getPath()),this.project.fileSave.dispatch(e.getPath(),await e.getFile()),t&&l.eventSystem.dispatch("refreshCurrentContext",e.getPath())),e.focus(),e==null||e.setIsLoading(!1)}async saveAs(){this.selectedTab instanceof O&&await this.selectedTab.saveAs()}async saveAll(){const e=await l.getApp();e.windows.loadingWindow.open();for(const t of this.tabs.value)t.isUnsaved&&await this.save(t);e.windows.loadingWindow.close()}closeAllTemporary(){for(const e of[...this.tabs.value])!e.isTemporary||this.remove(e,!0,!1)}async activate(){var e;await this.openedFiles.restoreTabs(),this.tabs.value.length>0&&this.setActive(!0),!this.selectedTab&&this.tabs.value.length>0&&this.tabs.value[0].select(),await((e=this.selectedTab)==null?void 0:e.onActivate())}deactivate(){var e;(e=this.selectedTab)==null||e.onDeactivate(),this.dispose()}setActive(e,t=!0){t&&this.project.setActiveTabSystem(this,!e),e!==this._isActive&&(this._isActive=e,e&&this._selectedTab&&this.project.isActiveProject&&l.eventSystem.dispatch("currentTabSwitched",this._selectedTab))}async getTab(e){for(const t of this.tabs.value)if(t instanceof O&&await t.isForFileHandle(e))return t}closeTabs(e){const t=[...this.tabs.value].reverse();for(const i of t)e(i)&&i.close()}forceCloseTabs(e){const t=[...this.tabs.value].reverse();for(const i of t)e(i)&&this.remove(i)}has(e){for(const t of this.tabs.value)if(e(t))return!0;return!0}get(e){for(const t of this.tabs.value)if(e(t))return t}}class Fl extends Da{constructor(e,t,i){super(t),this.fileSystem=e,this.project=i,i&&i.fileSave.on(this.resolvePackPath(void 0,"config.json"),()=>{this.refreshConfig(),this.project.app.windows.createPreset.onPresetsChanged(),this.project.compilerService.reloadPlugins()})}readConfig(){return this.fileSystem.readJSON("config.json").catch(()=>({}))}async writeConfig(e){await this.fileSystem.writeJSON("config.json",e,!0)}async setup(e=!0){var n,a,r,o,c,d,p;if(e&&await this.fileSystem.fileExists(".bridge/config.json")){const{darkTheme:u,lightTheme:f,gameTestAPI:h,scriptingAPI:m,prefix:g,...w}=await this.fileSystem.readJSON(".bridge/config.json");await this.fileSystem.unlink(".bridge/config.json");const v={};h&&(v.enableGameTestFramework=!0),m&&(v.additionalModdingCapabilities=!0);const C={type:"minecraftBedrock",name:this.fileSystem.baseDirectory.name,namespace:g,experimentalGameplay:v,...w,authors:w.author?[w.author]:["Unknown"],packs:Et,bridge:{darkTheme:u,lightTheme:f}};await this.fileSystem.writeJSON("config.json",C,!0),this.data=C;return}await super.setup();const t=(a=(n=this.data.bridge)==null?void 0:n.formatVersion)!=null?a:0;this.data.bridge||(this.data.bridge={});let i=!1;if(e&&this.project&&this.data.capabilities){const u=await this.project.app.dataLoader.readJSON("data/packages/minecraftBedrock/experimentalGameplay.json"),f=(r=this.data.experimentalGameplay)!=null?r:{},h=(o=this.data.capabilities)!=null?o:[];f.enableGameTestFramework=h.includes("gameTestAPI"),f.additionalModdingCapabilities=h.includes("scriptingAPI");for(const m of u)(d=f[c=m.id])!=null||(f[c]=!0);this.data.experimentalGameplay=f,this.data.capabilities=void 0,i=!0}if(e&&this.data.author&&!this.data.authors&&(this.data.authors=typeof this.data.author=="string"?[this.data.author]:this.data.author,this.data.author=void 0,i=!0),e&&await this.fileSystem.fileExists(".bridge/compiler/default.json")){const u=await this.fileSystem.readJSON(".bridge/compiler/default.json");this.data.compiler={plugins:u.plugins},await this.fileSystem.unlink(".bridge/compiler/default.json"),i=!0}e&&t===0&&((p=this.data.compiler)==null?void 0:p.plugins)&&!this.data.compiler.plugins.includes("formatVersionCorrection")&&(this.data.bridge.formatVersion=1,this.data.compiler.plugins.push("formatVersionCorrection"),i=!0),i&&await this.writeConfig(this.data)}async getWorldHandles(){var i;if(!this.project)throw new Error("Cannot use getWorldHandles() within web workers yet");const e=this.project.app,t=((i=this.get().worlds)!=null?i:["./worlds/*"]).map(n=>this.resolvePackPath(void 0,n));return(await Promise.all(t.map(n=>e.fileSystem.getDirectoryHandlesFromGlob(n)))).flat()}getAuthorImage(){var t;const e=(t=this.get().authors)==null?void 0:t.find(i=>typeof i!="string"&&i.logo);if(!!e)return this.resolvePackPath(void 0,e.logo)}async toggleExperiment(e,t){var n,a;e.app.windows.loadingWindow.open();const i=(a=(n=this.get())==null?void 0:n.experimentalGameplay)!=null?a:{};i[t]=!i[t],await this.save(),e.isActiveProject&&await e.refresh(),e.app.windows.loadingWindow.close()}}async function Tl(s,e){const t=s.config,i=Object.values(t.getAvailablePacks());if(i.length!==0)return await Pt(Re(i[0],"pack_icon.png"),e).catch(()=>{})}const we="2.3.0",Ds={"@mdi/font":"^6.9.96","@types/lz-string":"^1.3.34","bridge-common-utils":"^0.3.3","bridge-iframe-api":"^0.4.6","bridge-js-runtime":"^0.3.4","bridge-model-viewer":"^0.7.7",buffer:"^6.0.3","color-convert":"^2.0.1",comlink:"^4.3.0","compare-versions":"^3.6.0","core-js":"^3.6.5","dash-compiler":"^0.9.26","escape-string-regexp":"^5.0.0",fflate:"^0.6.7","idb-keyval":"^5.1.3","is-glob":"^4.0.1",json5:"^2.1.3","jsonc-parser":"^3.0.0","lodash-es":"^4.17.20","lz-string":"^1.4.4","mc-project-core":"^0.3.21",molang:"^1.13.11","monaco-editor":"^0.33.0","path-browserify":"^1.0.1","prismarine-nbt":"^1.6.0","quick-score":"^0.0.13","tga-js":"^1.1.1",three:"^0.139.2",uuid:"^8.3.1",vue:"^2.7.8","vue-template-compiler":"^2.7.8",vuedraggable:"^2.24.3",vuetify:"^2.6.7",wintersky:"^1.1.0"};let Ce=Ds["dash-compiler"];Ce.startsWith("^")||Ce.startsWith("~")||Ce.startsWith(">")||Ce.startsWith("<")?Ce=Ce.substring(1):(Ce.startsWith(">=")||Ce.startsWith("<="))&&(Ce=Ce.substring(2));const qt=Ce;async function Al(s,e){var r,o,c,d,p,u,f,h,m,g,w;let t=await s.fileSystem.readJSON(e),i=(c=(o=(r=t==null?void 0:t.metadata)==null?void 0:r.generated_with)==null?void 0:o.bridge)!=null?c:[],n=(u=(p=(d=t==null?void 0:t.metadata)==null?void 0:d.generated_with)==null?void 0:p.dash)!=null?u:[],a=!1;return((h=(f=S==null?void 0:S.projects)==null?void 0:f.addGeneratedWith)==null||h)&&((!i.includes(we)||i.length>1)&&(i=[we],a=!0),(!n.includes(qt)||n.length>1)&&(n=[qt],a=!0)),a&&(t={...t!=null?t:{},metadata:{...(m=t==null?void 0:t.metadata)!=null?m:{},generated_with:{...(w=(g=t==null?void 0:t.metadata)==null?void 0:g.generated_with)!=null?w:{},bridge:[we],dash:[qt]}}},await s.fileSystem.writeJSON(e,t,!0)),t}async function $l(s,e){var a,r,o;await l.packType.ready.fired;const t=[],i=e.config,n=i.getAvailablePacks();for(const[c,d]of Object.entries(n)){let p={};try{p=await Al(s,i.resolvePackPath(c,"manifest.json"))}catch{}t.push({...l.packType.getFromId(c),packPath:d,version:(r=(a=p==null?void 0:p.header)==null?void 0:a.version)!=null?r:[1,0,0],uuid:(o=p==null?void 0:p.header)==null?void 0:o.uuid})}return t}const Dl=2*60*1e3;class El extends ${constructor(e,t){super(),this.taskOptions=e,this.app=t,this.worker=null,this.workerClass=null,this._service=null,this.task=null}get service(){if(!this._service)throw new Error("Accessing service without service being defined");return this._service}async activate(e){var i;this.disposeTimeout!==void 0&&(window.clearTimeout(this.disposeTimeout),this.disposeTimeout=void 0);const t=(i=this.app)!=null?i:await l.getApp();if(this.task=t.taskManager.create(this.taskOptions),!this.worker){if(this.createWorker(),!this.worker)throw new Error("Method WorkerManager.createWorker() doesn't create worker");this.workerClass=Li(this.worker)}this.resetSignal(),await this.start(e).then(n=>{var a;(a=this.task)==null||a.complete(),this.dispatch(n)})}deactivate(){this.disposeTimeout=window.setTimeout(()=>this.dispose(),Dl)}dispose(){var e,t;this.disposeTimeout&&window.clearTimeout(this.disposeTimeout),this.resetSignal(),(e=this.worker)==null||e.terminate(),(t=this.task)==null||t.dispose(),this.worker=null,this._service=null,this.workerClass=null,this.disposeTimeout=void 0}}function Ml(){return new Worker("/assets/Main.ee35bcb9.js")}class Es{constructor(){this.listeners=[],this.isLocked=!1}lock(){return new Promise(async(e,t)=>{this.isLocked?this.listeners.push(()=>{this.isLocked=!0,e()}):(this.isLocked=!0,e())})}unlock(){if(!this.isLocked)throw new Error("Trying to unlock a mutex that is not locked");this.isLocked=!1,this.listeners.length>0&&this.listeners.shift()()}}class Il extends El{constructor(e,t){super({icon:"mdi-flash-outline",name:"taskManager.tasks.packIndexing.title",description:"taskManager.tasks.packIndexing.description"}),this.project=e,this.baseDirectory=t,this.isPackIndexerFree=new Es}createWorker(){this.worker=new Ml}deactivate(){super.deactivate()}async start(e){var n,a,r;console.time("[TASK] Indexing Packs (Total)"),await this.isPackIndexerFree.lock(),this._service=await new this.workerClass(this.baseDirectory,this.project.app.fileSystem.baseDirectory,{disablePackSpider:!((a=(n=S==null?void 0:S.general)==null?void 0:n.enablePackSpider)!=null&&a),pluginFileTypes:l.fileType.getPluginFileTypes(),noFullLightningCacheRefresh:!e&&!((r=S==null?void 0:S.general)!=null&&r.fullLightningCacheRefresh),projectPath:this.project.projectPath}),await this.service.on(st(([o,c])=>{var d;(d=this.task)==null||d.update(o,c)}),!1);const[t,i]=await this.service.start(e);return await this.service.disposeListeners(),this.isPackIndexerFree.unlock(),console.timeEnd("[TASK] Indexing Packs (Total)"),[t,i]}async updateFile(e,t,i=!1,n=!1){await this.isPackIndexerFree.lock(),await this.service.updatePlugins(l.fileType.getPluginFileTypes());const a=await this.service.updateFile(e,t,i,n);return this.isPackIndexerFree.unlock(),a}async rename(e,t){await this.isPackIndexerFree.lock(),await this.service.updatePlugins(l.fileType.getPluginFileTypes()),await this.service.unlinkFile(e,!1),await this.service.updateFile(t,void 0,void 0,!0),await this.service.saveCache(),this.isPackIndexerFree.unlock()}async hasFile(e){await this.isPackIndexerFree.lock();const t=await this.service.hasFile(e);return this.isPackIndexerFree.unlock(),t}async updateFiles(e,t=!1){await this.isPackIndexerFree.lock(),await this.service.updatePlugins(l.fileType.getPluginFileTypes());const i=await this.service.updateFiles(e,t);return this.isPackIndexerFree.unlock(),i}async unlinkFile(e,t=!0){await this.isPackIndexerFree.lock(),await this.service.updatePlugins(l.fileType.getPluginFileTypes()),await this.service.unlinkFile(e,t),this.isPackIndexerFree.unlock()}async saveCache(){await this.isPackIndexerFree.lock(),await this.service.saveCache(),this.isPackIndexerFree.unlock()}}class Ol{constructor(e,t,i){this.jsonDefaults=e,this.app=t,this.filePath=i}async runScript(e,t){const i=this.app.fileSystem;let n={},a=!0;if(this.filePath)try{const r=await this.app.project.getFileFromDiskOrTab(this.filePath);n=R.parse(await r.text()),a=!1}catch{}try{return await qi({async:!0,script:t,env:{readdir:r=>i.readFilesFromDir(r).catch(()=>[]),uuid:D,getFormatVersions:Pc,getCacheDataFor:async(r,o,c)=>{const d=this.app.project.packIndexer;return await d.fired,d.service.getCacheDataFor(r,o,c)},getIndexedPaths:async(r,o)=>{const c=this.app.project.packIndexer;return await c.fired,await c.service.getAllFiles(r,o)},getProjectPrefix:()=>{var r;return(r=this.app.projectConfig.get().namespace)!=null?r:"bridge"},getProjectConfig:()=>this.app.projectConfig.get(),getFileName:()=>this.filePath?this.filePath.split(/\/|\\/g).pop():void 0,customComponents:r=>this.jsonDefaults.componentSchemas.get(r),get:r=>{const o=[];return ri(r,n,c=>o.push(c)),o},compare:ne,resolvePackPath:(r,o)=>this.app.projectConfig.resolvePackPath(r,o),failedCurrentFileLoad:a}})}catch(r){console.error(`Error evaluating schemaScript "${e}": ${r.message}`)}}async runSchemaScripts(e){const t=await this.app.dataLoader.readJSON("data/packages/minecraftBedrock/schemaScripts.json");for(const[i,n]of Object.entries(t)){let a;i.endsWith(".js")?a={script:n}:a=n;let r=await this.runScript(i,a.script);if(r){if(i.endsWith(".js")){if(r.keep)continue;a={...a,type:r.type,generateFile:r.generateFile},r=r.data}a.type==="object"&&!Array.isArray(r)&&typeof r=="object"?e[`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`]={uri:`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`,schema:{type:"object",properties:r}}:a.type==="custom"?e[`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`]={uri:`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`,schema:r}:e[`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`]={uri:`file:///data/packages/minecraftBedrock/schema/${a.generateFile}`,schema:{type:a.type==="enum"?"string":"object",enum:a.type==="enum"?r:void 0,properties:a.type==="properties"?Object.fromEntries(r.map(o=>[o,{}])):void 0}}}}}}class Xt extends Ea{async readFile(e){return await(await(await l.getApp()).fileSystem.readFile(e)).text()}run(e,t={},i){return super.run(e,Object.assign(t,{require:n=>this.require(n,ye(e))}),i)}}const Ci=["block","item","entity"];class Rl{constructor(){this.schemas={block:{},item:{},entity:{}},this.schemaLookup=new Map}get(e){return this.schemas[e]}async activate(){this.disposables=[l.eventSystem.on("fileSave",async([t,i])=>{var u,f;const a=(await l.getApp()).project,r=a.config.resolvePackPath("behaviorPack","components"),o=(f=(u=a.config.get().bridge)==null?void 0:u.v1CompatMode)!=null?f:!1;if(!t.startsWith(r))return;const c=new Xt,d=t.replace(r+"/","").split("/")[0],p=Ci.includes(d);!p&&o?await Promise.all(Ci.map(h=>this.evalComponentSchema(c,h,t,i,!0))):p&&await this.evalComponentSchema(c,d,t,i,o)}),l.eventSystem.on("fileUnlinked",t=>{var a;const[i,n]=(a=this.schemaLookup.get(t))!=null?a:[];!i||!n||(this.schemas[i][n]=void 0,this.schemaLookup.delete(t))})];const e=new Xt;await Promise.all(Ci.map(t=>this.generateComponentSchemas(e,t)))}dispose(){var e;(e=this.disposables)==null||e.forEach(t=>t.dispose()),this.disposables=void 0}async generateComponentSchemas(e,t){var c,d;const i=await l.getApp(),n=i.project;await(await n.compilerService.completedStartUp).fired;const a=(d=(c=n.config.get().bridge)==null?void 0:c.v1CompatMode)!=null?d:!1,r=a?n.config.resolvePackPath("behaviorPack","components"):n.config.resolvePackPath("behaviorPack",`components/${t}`);let o;try{o=await i.fileSystem.getDirectoryHandle(r)}catch{return{}}this.schemas[t]={},await ce(o,async(p,u)=>{await this.evalComponentSchema(e,t,u,await p.getFile(),a)},void 0,r)}async evalComponentSchema(e,t,i,n,a){const o=(await l.getApp()).project;await(await o.compilerService.completedStartUp).fired;const[c,d]=await o.compilerService.compileFile(i,new Uint8Array(await n.arrayBuffer())),p=new File([d],n.name),u=new Ma(new Zn,t,await p.text(),"development",a);await u.load(e,i,"client")&&u.name&&(this.schemas[t][u.name]=u.getSchema(),this.schemaLookup.set(i,[t,u.name]))}}let je={},Vt=!1;class Wl extends H{constructor(e){super(),this.project=e,this.loadedSchemas=!1,this.localSchemas={},this.disposables=[],this.componentSchemas=new Rl}get isReady(){return this.loadedSchemas&&Vt}async activate(){console.time("[SETUP] JSONDefaults"),await this.project.app.project.packIndexer.fired,await this.componentSchemas.activate(),this.disposables=[l.eventSystem.on("currentTabSwitched",e=>{e instanceof O&&l.fileType.isJsonFile(e.getPath())&&this.updateDynamicSchemas(e.getPath())}),l.eventSystem.on("refreshCurrentContext",e=>this.updateDynamicSchemas(e)),l.eventSystem.on("disableValidation",()=>{this.setJSONDefaults(!1)})].filter(e=>e!==void 0),await this.loadAllSchemas(),await this.setJSONDefaults(),console.timeEnd("[SETUP] JSONDefaults")}deactivate(){this.disposables.forEach(e=>e.dispose()),this.componentSchemas.dispose(),this.disposables=[]}async loadAllSchemas(){var a;this.localSchemas={};const e=await l.getApp(),t=e.taskManager.create({icon:"mdi-book-open-outline",name:"taskManager.tasks.loadingSchemas.name",description:"taskManager.tasks.loadingSchemas.description",totalTaskSteps:10});await e.dataLoader.fired,t.update(1);const i=await e.dataLoader.readdir("data/packages");t.update(2);for(const r of i)try{await this.loadStaticSchemas(await e.dataLoader.getFileHandle(`data/packages/${r}/schemas.json`),r==="minecraftBedrock")}catch(o){console.error(o);continue}Vt=!0,t.update(3),await this.runSchemaScripts(e),t.update(5);const n=(a=this.project.tabSystem)==null?void 0:a.selectedTab;if(n&&n instanceof O){const r=l.fileType.getId(n.getPath());this.addSchemas(await this.requestSchemaFor(r,n.getPath())),await this.runSchemaScripts(e,n.isForeignFile?void 0:n.getPath())}this.addSchemas(await this.getDynamicSchemas()),t.update(4),this.loadedSchemas=!0,t.update(6),t.complete()}async setJSONDefaults(e=!0){const t=Object.assign({},je,this.localSchemas);if(xt.hasFired){const{languages:i}=await L();i.json.jsonDefaults.setDiagnosticsOptions({enableSchemaRequest:!1,allowComments:!0,validate:e,schemas:Object.values(t)})}ge.setJSONDefaults(t),this.dispatch()}async reload(){const e=await l.getApp();e.windows.loadingWindow.open(),this.loadedSchemas=!1,this.localSchemas={},Vt=!1,je={},await this.deactivate(),await this.activate(),e.windows.loadingWindow.close()}async updateDynamicSchemas(e){const t=await l.getApp(),i=l.fileType.getId(e);this.addSchemas(await this.requestSchemaFor(i,e)),this.addSchemas(await this.requestSchemaFor(i)),await this.runSchemaScripts(t,e),await this.setJSONDefaults()}async updateMultipleDynamicSchemas(e){const t=await l.getApp(),i=new Set;for(const n of e){const a=l.fileType.getId(n);i.has(a)||(this.addSchemas(await this.requestSchemaFor(a)),await this.runSchemaScripts(t,n),i.add(a))}await this.setJSONDefaults()}addSchemas(e){e.forEach(t=>{this.localSchemas[t.uri]?(t.schema&&(this.localSchemas[t.uri].schema=t.schema),t.fileMatch&&(this.localSchemas[t.uri].fileMatch=t.fileMatch)):this.localSchemas[t.uri]=t})}async requestSchemaFor(e,t){const i=this.project.packIndexer;return await i.fired,await i.service.getSchemasFor(e,t)}async getDynamicSchemas(){return(await Promise.all(l.fileType.getIds().map(e=>this.requestSchemaFor(e)))).flat()}async loadStaticSchemas(e,t=!1){if(!Vt){const i=await e.getFile(),n=JSON.parse(await i.text());for(const a in n)je[a]={uri:a,schema:n[a]}}if(t){const i=l.fileType.getMonacoSchemaEntries();i.forEach(n=>{if(!n.uri)return;const a=je[n.uri];a&&a.fileMatch&&n.fileMatch&&(a.fileMatch=void 0)}),i.forEach(n=>{!n.uri||(je[n.uri]?(n.schema&&(je[n.uri].schema=n.schema),n.fileMatch&&(je[n.uri].fileMatch?je[n.uri].fileMatch.push(...n.fileMatch):je[n.uri].fileMatch=n.fileMatch)):je[n.uri]=n)})}}addSchemaEntries(){}async runSchemaScripts(e,t){await new Ol(this,e,t).runSchemaScripts(this.localSchemas)}}class ei{constructor(){this.experimentalGameplay={},this.projectTargetVersion="",this.failures=[],this.isSetup=!1}async setup(){var a,r;if(this.isSetup)return;this.app=await l.getApp();const[e,t,i]=await Promise.all([this.app.projectManager.projectReady.fired,Qe(),this.app.fileSystem.readJSON(this.app.project.config.resolvePackPath("behaviorPack","manifest.json")).catch(()=>null)]),n=this.app.project.config.get();this.experimentalGameplay=(a=n.experimentalGameplay)!=null?a:{},this.projectTargetVersion=(r=n.targetVersion)!=null?r:this.latestFormatVersion,this.latestFormatVersion=t,this.bpManifest=i,this.isSetup=!0}resetFailures(){this.failures=[]}isValid(e){var o,c,d,p,u,f,h;if(this.resetFailures(),!e)return!0;if(!this.isSetup)throw new Error("RequiresMatcher is not setup. Make sure to call setup() before isValid().");const t=this.app.project.hasPacks((o=e.packTypes)!=null?o:[]),i=!e.targetVersion||(Array.isArray(e.targetVersion)?ne(this.projectTargetVersion,e.targetVersion[1],e.targetVersion[0]):ne(this.projectTargetVersion,(d=(c=e.targetVersion)==null?void 0:c.min)!=null?d:"1.8.0",">=")&&ne(this.projectTargetVersion,(u=(p=e.targetVersion)==null?void 0:p.max)!=null?u:"1.18.0","<=")),n=!e.experimentalGameplay||e.experimentalGameplay.some(m=>m.startsWith("!")?!this.experimentalGameplay[m.replace("!","")]:this.experimentalGameplay[m]),a=(h=(f=this.bpManifest)==null?void 0:f.dependencies)==null?void 0:h.map(m=>{var g;return(g=m.uuid)!=null?g:""}),r=!e.dependencies||!a||(e==null?void 0:e.dependencies.every(m=>a.includes(m)));return t||this.failures.push({type:"packTypes"}),i||this.failures.push({type:"targetVersion"}),n||this.failures.push({type:"experimentalGameplay"}),r||this.failures.push({type:"manifestDependency"}),t&&n&&i&&r}}const Mn=new Map;class Ll{constructor(e){this.dataLoader=e,this.disposables=[],this.typeDisposables=[],this.userTypeDisposables=[],this.currentTypeEnv=null}async activate(e){this.disposables=[l.eventSystem.on("currentTabSwitched",async t=>{!t.isForeignFile&&t instanceof O&&(await this.setTypeEnv(t.getPath()),await this.loadUserTypes())})],e&&await this.setTypeEnv(e),await this.loadUserTypes()}deactivate(){this.currentTypeEnv=null,this.typeDisposables.forEach(e=>e.dispose()),this.disposables.forEach(e=>e.dispose()),this.typeDisposables=[],this.disposables=[]}async load(e){let t=Mn.get(e);return t||(await this.dataLoader.fired,t=await(await this.dataLoader.readFile(`data/packages/minecraftBedrock/${e}`)).text(),Mn.set(e,t),t)}async setTypeEnv(e){var c;if(e===this.currentTypeEnv)return;const{languages:t,Uri:i}=await L();this.currentTypeEnv=e,this.typeDisposables.forEach(d=>d.dispose()),this.typeDisposables=[],await l.fileType.ready.fired;const{types:n=[]}=(c=l.fileType.get(e))!=null?c:{},a=new ei;await a.setup();const o=(await Promise.all(n.map(async d=>{if(typeof d=="string")return[d,await this.load(d)];const{definition:p,requires:u}=d;if(u?a.isValid(u):!0)return[p,await this.load(p)]}))).filter(d=>d!==void 0);for(const[d,p]of o){const u=i.file(d);this.typeDisposables.push(t.typescript.javascriptDefaults.addExtraLib(p,u.toString()),t.typescript.typescriptDefaults.addExtraLib(p,u.toString()))}}async loadUserTypes(){const e=await l.getApp();await e.project.packIndexer.fired;const i=(await e.project.packIndexer.service.getAllFiles()).filter(r=>r.endsWith(".ts")||r.endsWith(".js")),{languages:n,Uri:a}=await L();this.userTypeDisposables.forEach(r=>{r.dispose()}),this.userTypeDisposables=[];for(const r of i){const o=a.file(r),c=await e.fileSystem.readFile(r).catch(()=>null);!c||this.userTypeDisposables.push(n.typescript.typescriptDefaults.addExtraLib(await c.text(),o.toString()))}}}function Nl(s){const e=document.createElement("style");return e.innerHTML=s,document.head.appendChild(e),{dispose:()=>{document.head.contains(e)&&document.head.removeChild(e)}}}async function Bl(){return await ue(()=>import("./vueTemplateCompiler.288184c3.js"),["assets/vueTemplateCompiler.288184c3.js","assets/vendor.ed651d0f.js","assets/vendor.fa5a5182.css"])}const Vl={VBtn:Ia,VAlert:Oa,VApp:Ra,VToolbar:Wa,VToolbarItems:La,VAutocomplete:Na,VCombobox:Ba,VSwitch:Va,VTextField:Ha,VWindow:Ua,VTooltip:za};async function Hl(s,e,t,i){await ce(e,async(n,a)=>{await Ul(s,a,await n.getFile().then(r=>r.text()),t,i)},void 0,"ui")}async function Ul(s,e,t,i,n){if(Pe(e)!==".vue"){Oe(new Error(`NOT A VUE FILE: Provided UI file "${me(e)}" is not a vue file!`));return}const{parseComponent:a}=await Bl(),r=new Promise(async(o,c)=>{var g,w,v;const{template:d,script:p,styles:u,errors:f}=a(t);if(f.length>0)return f.forEach(C=>Oe(C)),c(f[0]);const{__default__:h}=p!=null&&p.content?await s.run(e,void 0,(g=p==null?void 0:p.content)!=null?g:""):{__default__:{}},m={name:me(e),...h,...We.compile((w=d==null?void 0:d.content)!=null?w:'<p color="red">NO TEMPLATE DEFINED</p>')};m.components=Object.assign((v=m.components)!=null?v:{},Vl),u.forEach(C=>n.push(Nl(C.content))),o(m)});i.set(e.replace("ui/","").split("/"),()=>r)}function zl(){let s={};return D(),{get UI(){return s},set(e,t){let i=s;for(;e.length>1;){const a=e.shift();i[a]===void 0&&(i[a]={}),i=i[a]}const n=e.shift();i[me(n,Pe(n))]=t},dispose(){s=null}}}async function ql(s,e){await ce(e,async(t,i)=>{const n=await t.getFile().then(a=>a.text());await s.run(i,void 0,n)},void 0,"scripts")}const Jl={props:{action:Object,hideTriggerButton:Boolean,dense:Boolean,dark:Boolean,selected:{type:Boolean,default:void 0}},mixins:[z],methods:{onTrigger(){this.action.trigger()}}};var Gl=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pa-4 mb-2 rounded-lg control-bg",class:{selected:e.selected,dark:e.dark}},[t("div",{staticClass:"d-flex align-center"},[e.action.icon?t("v-icon",{staticClass:"mr-1",attrs:{color:e.action.color||"accent"}},[e._v(" "+e._s(e.action.icon)+" ")]):e._e(),t("h3",[e._v(e._s(e.t(e.action.name)))]),t("v-spacer"),e.action.keyBinding?t("span",[e._v(" "+e._s(e.action.keyBinding.toStrKeyCode())+" ")]):e._e(),e.hideTriggerButton?e._e():t("v-btn",{attrs:{color:e.action.color||"accent",small:"",icon:""}},[t("v-icon",{on:{click:e.onTrigger}},[e._v("mdi-play")])],1),e.selected!==void 0?t("v-icon",[e._v(" "+e._s(e.selected?"mdi-check-circle-outline":"mdi-checkbox-blank-circle-outline")+" ")]):e._e()],1),!e.dense&&e.action.description?t("p",[e._v(" "+e._s(e.t(e.action.description))+" ")]):e._e()])},Kl=[],Yl=_(Jl,Gl,Kl,!1,null,"b0bf7f72",null,null);const mt=Yl.exports;class Ms{constructor({type:e,text:t,isDismissible:i}){this.isVisible=!0,this.type=e,this.text=t,this.isDismissible=i!=null?i:!1}}const Ql={mixins:[z],props:{infoPanel:Ms}};var Zl=function(){var e=this,t=e._self._c;return t("v-alert",{attrs:{type:e.infoPanel.type,rounded:"lg",border:"bottom",dismissible:e.infoPanel.isDismissible},model:{value:e.infoPanel.isVisible,callback:function(i){e.$set(e.infoPanel,"isVisible",i)},expression:"infoPanel.isVisible"}},[e._v(" "+e._s(e.t(e.infoPanel.text))+" ")])},Xl=[],ed=_(Ql,Zl,Xl,!1,null,null,null,null);const en=ed.exports,td=X({__name:"InformedChoice",props:["window"],setup(s){const e=s,t=e.window.getState();function i(){e.window.close()}function n(a){a.trigger(),e.window.close()}return{__sfc:!0,props:e,state:t,onClose:i,onClick:n,BaseWindow:de,ActionViewer:mt,InfoPanel:en}}});var id=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,hasCloseButton:!e.window.opts.isPersistent,hasMaximizeButton:!1,percentageWidth:50,maxPercentageHeight:80,isPersistent:e.window.opts.isPersistent,heightUnset:""},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[e.window.topPanel?t(i.InfoPanel,{staticClass:"mb-2",attrs:{infoPanel:e.window.topPanel}}):e._e(),e._l(i.state.actionManager.state,function(n,a){return t(i.ActionViewer,{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,staticStyle:{cursor:"pointer"},attrs:{action:n,hideTriggerButton:!0},nativeOn:{click:function(r){return i.onClick(n)}}})})]},proxy:!0}])})},nd=[],sd=_(td,id,nd,!1,null,null,null,null);const ad=sd.exports;class It extends Y{constructor(e,t={}){super(ad,!0),this.title=e,this.opts=t,this._ready=new $,this.state=G({...super.state,actionManager:new Mt}),this.defineWindow(),this.open()}get actionManager(){return this.state.actionManager}async open(){super.open()}dispose(){super.dispose(),this.actionManager.dispose()}}class pi{constructor({items:e,text:t,isOpen:i,shouldSort:n}){this.type="category",this.id=D(),this.showDisabled=!1,this.text=t,this.items=e,this.isOpen=i!=null?i:!0,this.shouldSort=n!=null?n:!0,this.shouldSort&&this.sortCategory()}get isDisabled(){return this.items.every(e=>e.isDisabled)}addItem(e){this.items.push(e),this.shouldSort&&this.sortCategory()}removeItems(){this.items=[]}getText(){return this.text}getSearchText(){return this.text.toLowerCase()}getItems(e=this.showDisabled){return e?this.items:this.items.filter(t=>!t.isDisabled)}setOpen(e){this.isOpen=e}getCurrentElement(e){return this.items.find(({id:t})=>t===e)}sortCategory(){this.items=this.items.sort((e,t)=>e.getSearchText().localeCompare(t.getSearchText()))}hasFilterMatches(e){return e===""?this.items.length>0:this.items.find(t=>t.getSearchText().includes(e))!==void 0}filtered(e){if(e.length===0)return this;const t=new pi({items:this.getItems().filter(i=>i.getSearchText().includes(e)),text:this.text,shouldSort:this.shouldSort,isOpen:!0});return t.showDisabled=this.showDisabled,t}}class Te{constructor({id:e,text:t,icon:i,color:n,isDisabled:a,disabledText:r}){this.type="item",this.id=e,this.text=t,this.icon=i,this.color=n,this.isDisabled=a!=null?a:!1,this.disabledText=r}getText(){return this.text}getSearchText(){return this.text.toLowerCase()}}class ct extends H{constructor(e,t=!0){super(),this.shouldSortSidebar=t,this._selected=E(""),this._filter=E(""),this.reselectedForFilter="",this.state=G({}),this._showDisabled=E(!1),this._elements=E([]),this.selected=this.findDefaultSelected()}get showDisabled(){return this._showDisabled.value}set showDisabled(e){this._showDisabled.value=e,this.rawElements.forEach(t=>{t.type==="category"&&(t.showDisabled=e)})}addElement(e,t){e.type==="item"&&t&&V(this.state,e.id,t),this.has(e)?this.replace(e):this._elements.value.push(e)}has(e){return this._elements.value.find(t=>t.id===e.id)!==void 0}replace(e){this._elements.value=this._elements.value.map(t=>t.id===e.id?e:t)}removeElements(){this._elements.value=[]}get filter(){return this._filter.value.toLowerCase()}set filter(e){this._filter.value=e.toLowerCase()}setFilter(e){this._filter.value=e.toLowerCase()}get elements(){const e=this.sortSidebar(this._elements.value.filter(t=>!this.showDisabled&&t.isDisabled?!1:t.type==="item"?t.getSearchText().includes(this.filter):t.hasFilterMatches(this.filter)).map(t=>t.type==="item"?t:t.filtered(this.filter)));if(this.filter!==this.reselectedForFilter&&e.length>0){const t=e.find(i=>!i.isDisabled);if(!t)return e;if(t.type==="category"&&t.getItems(!1).length>0){t.setOpen(!0);const i=t.getItems(!1)[0];i&&this.setDefaultSelected(i.id)}else t.type==="item"&&this.setDefaultSelected(t.id);this.reselectedForFilter=this.filter}return e}get rawElements(){return this._elements.value}get currentElement(){if(!!this.selected)for(const e of this._elements.value){if(e.type==="item"){if(e.id===this.selected)return e;continue}const t=e.getCurrentElement(this.selected);if(t)return t}}get currentState(){var e;return this.selected?(e=this.state[this.selected])!=null?e:{}:{}}getState(e){var t;return(t=this.state[e])!=null?t:{}}setState(e,t){V(this.state,e,t)}sortSidebar(e){return this.shouldSortSidebar?e.sort((t,i)=>t.type!==i.type?t.type.localeCompare(i.type):t.getSearchText().localeCompare(i.getSearchText())):e}findDefaultSelected(){for(const e of this.sortSidebar(this.elements))if(!e.isDisabled){if(e.type==="category"&&e.getItems(!1).length>0){const t=e.getItems(!1)[0];if(t)return t.id}else if(e.type==="item")return e.id}}setDefaultSelected(e){e?this.selected=e:this.selected||(this.selected=this.findDefaultSelected())}resetSelected(){this.selected=void 0}clearFilter(){this._filter.value=""}get selected(){return this._selected.value}set selected(e){this._selected.value!==e&&(this.dispatch(e),this._selected.value=e)}}class rd{constructor(e,t){this.parent=e,this.icon=this.parent.getTagIcon(t),this.text=t,this.color=this.parent.getTagColor(t)}getText(){return this.text}asSidebarElement(){return new Te({id:this.text.toLowerCase(),text:this.text,color:this.color,icon:this.icon})}}const od=s=>[new M({name:"windows.extensionStore.deleteExtension",icon:"mdi-delete",onTrigger:()=>{s.delete(),s.closeActionMenu()}}),new M({name:`windows.extensionStore.${s.isActive?"deactivateExtension":"activateExtension"}`,icon:s.isActive?"mdi-close":"mdi-check",onTrigger:()=>{s.setActive(!s.isActive),s.closeActionMenu()}}),s.isInstalledLocallyAndGlobally?null:new M({name:`windows.extensionStore.${s.isGlobal?"installLocal":"installGlobal"}`,icon:"mdi-download",onTrigger:()=>{s.download(!s.isGlobal),s.closeActionMenu()}})];class Is{constructor(e,t,i=!1){this.parent=e,this.config=t,this.isLocalOnly=i,this.isLoading=!1,this._isInstalled=!1,this.isUpdateAvailable=!1,this.connected=[],this.showMenu=!1,this.isActive=!0,this.tags=this.config.tags.map(n=>(this.parent.tags[n]||(this.parent.tags[n]=new rd(this.parent,n)),this.parent.tags[n])).sort((n,a)=>n.getText().localeCompare(a.getText()))}get author(){return this.manifest.author}get name(){return this.manifest.name}get version(){return this.manifest.version}get description(){return this.manifest.description}get icon(){return this.manifest.icon}get id(){return this.manifest.id}get releaseTimestamp(){var e;return(e=this.config.releaseTimestamp)!=null?e:Date.now()}get readme(){return this.manifest.readme}get manifest(){var e,t;return this.isUpdateAvailable?this.config:(t=(e=this.extension)==null?void 0:e.manifest)!=null?t:this.config}get isInstalled(){return this._isInstalled}get actions(){return od(this).filter(e=>e!==null)}get isGlobal(){var e,t;return(t=(e=this.extension)==null?void 0:e.isGlobal)!=null?t:!1}get onlineVersion(){return this.config.version}get isInstalledLocallyAndGlobally(){return this.connected.length===2}get extension(){if(this.connected.length===0)return null;const e=this.connected.find(t=>!t.isGlobal);return e||this.connected[0]}hasTag(e){return this.tags.includes(e)}isCompatibleVersion(){return!this.config.compatibleAppVersions||(this.config.compatibleAppVersions.min&&ne(we,this.config.compatibleAppVersions.min,">=")||!this.config.compatibleAppVersions.min)&&(this.config.compatibleAppVersions.max&&ne(we,this.config.compatibleAppVersions.max,"<")||!this.config.compatibleAppVersions.max)}async download(e){if(e!==void 0)return this.downloadExtension(e);const i=await new It("windows.pluginInstallLocation.title").actionManager;i.create({icon:"mdi-folder-multiple-outline",name:"actions.pluginInstallLocation.global.name",description:"actions.pluginInstallLocation.global.description",onTrigger:()=>{this.downloadExtension(!0)}}),i.create({icon:"mdi-folder-outline",name:"actions.pluginInstallLocation.local.name",description:"actions.pluginInstallLocation.local.description",onTrigger:()=>{this.downloadExtension(!1)}})}async downloadExtension(e,t=!1,i=!0){var p,u;this.isLoading=!0;const n=await l.getApp(),a=await fetch(this.parent.getBaseUrl()+this.config.link).then(f=>f.arrayBuffer()),r=e?"~local/extensions":`${n.project.projectPath}/.bridge/extensions`,o=e?n.extensionLoader:n.project.extensionLoader,c=r+`/${this.name.replace(/\s+/g,"")}.zip`;await n.fileSystem.writeFile(c,a);try{await n.fileSystem.unlink(c.replace(".zip",""))}catch{}for(const f of(p=this.config.dependencies)!=null?p:[]){const h=this.parent.getExtensionById(f);h&&(h.isInstalled?!h.isActive&&h.connected&&h.connected.forEach(m=>m.activate()):await h.downloadExtension(e))}const d=await o.loadExtension(await n.fileSystem.getDirectoryHandle(r),await n.fileSystem.getFileHandle(c),i&&(this.connected.length===0||((u=this.extension)==null?void 0:u.isGlobal)));d&&this.setConnected(d),this.setInstalled(),this.isUpdateAvailable=!1,this.isLoading=!1,t||d!=null&&d.contributesCompilerPlugins&&new W({title:"windows.extensionStore.compilerPluginDownload.title",description:"windows.extensionStore.compilerPluginDownload.description",cancelText:"general.later",confirmText:"windows.extensionStore.compilerPluginDownload.openConfig",onConfirm:async()=>{this.parent.close();const h=(await l.getApp()).project;h.config.get().compiler?await h.openFile(await h.fileSystem.getFileHandle("config.json")):await h.openFile(await h.fileSystem.getFileHandle(".bridge/compiler/default.json"))}})}async update(e=!0){if(this.connected.length===0)return;e&&this.parent.updateInstalled(this);const t=this.connected.map(i=>i.isActive);this.connected.forEach(i=>i.deactivate()),await Promise.all(this.connected.map(async(i,n)=>{await i.resetInstalled(),await this.downloadExtension(i.isGlobal,!0,t[n])}))}delete(){var e;this.connected.length!==0&&((e=this.extension)==null||e.delete(),this.connected=this.connected.filter(t=>t!==this.extension),this.connected.length===0&&(this.parent.delete(this),this._isInstalled=!1))}setInstalled(){this._isInstalled=!0,this.parent.addInstalledExtension(this)}setIsUpdateAvailable(){this.isUpdateAvailable=!0}setConnected(e){var t,i;this.connected.push(e),this.isActive=(i=(t=this.extension)==null?void 0:t.isActive)!=null?i:!1}setActive(e){var t;if(!this.connected)throw new Error("No extension connected to ExtensionViewer");e?(t=this.extension)==null||t.setActive(e):this.connected.forEach(i=>i.setActive(e)),this.isActive=e}closeActionMenu(){this.showMenu=!1}get canShare(){return typeof navigator.share=="function"}async share(){if(!this.canShare)return;const e=new URL(window.location.href);e.searchParams.set("viewExtension",encodeURIComponent(this.id)),await navigator.share({title:`Extension: ${this.name}`,text:`View the extension "${this.name}" within bridge.!`,url:e.href}).catch(()=>{})}}function cd(s,e){return ce(s,async t=>{const i=await t.getFile(),n=R.parse(await i.text());e.push(l.fileType.addPluginFileType(n))})}class ld{constructor(e,t){this.fileSystem=e,this.contributeFiles=t}async execute(e){const t=l.instance;await t.projectManager.projectReady.fired;for(const[i,n]of Object.entries(this.contributeFiles)){const a=e?t.projects:[t.project];if(await this.fileSystem.fileExists(i)){const r=await this.fileSystem.readFile(i);for(const o of a){const c=o.config.resolvePackPath(n.pack,n.path);await t.fileSystem.writeFile(c,await r.arrayBuffer())}}else if(await this.fileSystem.directoryExists(i))await ce(await this.fileSystem.getDirectoryHandle(i),async(r,o)=>{for(const c of a){const d=c.config.resolvePackPath(n.pack,n.path),p=await t.fileSystem.getFileHandle(Re(d,o),!0);await t.fileSystem.copyFileHandle(r,p)}});else{console.warn(`Failed to install files from "${i}": No such file or directory`);continue}}}}const Jt=new at("persistent-extension-storage"),dd=({extensionId:s})=>({async save(e){await Jt.set(s,e)},async load(){return await Jt.get(s)},async delete(){await Jt.del(s)}});class lt{constructor(e){this.config=e}getConfig(){return this.config}trigger(e){var t,i;(i=(t=this.config).onTrigger)==null||i.call(t,e)}}class dt extends lt{constructor(e,t){super(t),this.parent=e,this._isSelected=!1,this.parent.selectedAction||this.select()}get isSelected(){return this._isSelected}select(){this.parent.unselectAllActions(),this._isSelected=!0,this.parent.selectedAction=this}unselect(){this._isSelected&&(this.parent.selectedAction=void 0),this._isSelected=!1}}class Ot{constructor(){this.actions=[],this.selectedAction=void 0}unselectAllActions(){var e;(e=this.actions)==null||e.forEach(t=>t instanceof dt?t.unselect():void 0),this.selectedAction=void 0}getSelectedAction(){var e;return(e=this.actions)==null?void 0:e.find(t=>t instanceof dt&&t.isSelected)}onContentRightClick(e){}}function nt(s){return new tn(s)}class tn{constructor(e){var t;if(this.config=e,this.isLoading=!1,this.isSelected=!1,this.badge=null,this.isVisibleSetting=void 0,this.sidebarUUID=(t=e.id)!=null?t:D(),this.disposable=l.sidebar.addSidebarElement(this.sidebarUUID,this),this.config.component){const i=this.config.component;this.config.sidebarContent=new class extends Ot{constructor(){super(...arguments),this.component=i,this.actions=void 0,this.topPanel=void 0}}}this.stopHandle=Ct(l.sidebar.currentState,()=>{var i;this.isSelected=((i=l.sidebar.currentState.value)!=null?i:!1)&&l.sidebar.currentState.value===this.config.sidebarContent},{deep:!1})}get isDisabled(){var e,t,i;return(i=(t=(e=this.config).disabled)==null?void 0:t.call(e))!=null?i:!1}get isVisible(){var e;return typeof this.config.isVisible=="function"?this.config.isVisible():(e=this.config.isVisible)!=null?e:!!this.isVisibleSetting}get icon(){return this.config.icon}get uuid(){return this.sidebarUUID}get displayName(){return this.config.displayName}get group(){return this.config.group}get component(){return this.config.component}dispose(){var e;this.disposable.dispose(),(e=this.stopHandle)==null||e.call(this),this.stopHandle=void 0}setSidebarContent(e){this.config.sidebarContent=e}setIsVisible(e){this.config.isVisible=e}attachBadge(e){return this.badge=e,this}async click(){this.isLoading=!0,this.config.sidebarContent&&l.sidebar.toggleSidebarContent(this.config.sidebarContent),typeof this.config.onClick=="function"&&await this.config.onClick(this),this.isLoading=!1}select(){if(!this.config.sidebarContent)throw new Error("Cannot select sidebar element without sidebar content");l.sidebar.selectSidebarContent(this.config.sidebarContent)}}const pd={methods:{t(s){return B(s)}}};const ud={name:"SidebarItem",mixins:[pd],props:{isSelected:Boolean,isDisabled:Boolean,disabledText:String,text:String,icon:String,color:String,compact:Boolean}};var hd=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"ripple",rawName:"v-ripple",value:!e.isSelected&&!e.isDisabled,expression:"!isSelected && !isDisabled"}],staticClass:"pa-1 rounded-lg category",class:{selected:e.isSelected,"is-disabled":e.isDisabled},on:{click:function(i){e.isDisabled||e.$emit("click")}}},[t("v-tooltip",{attrs:{disabled:!e.isDisabled,right:"",color:"tooltip"},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("span",e._g({staticClass:"d-flex align-center",class:{"justify-center":e.compact}},i),[t("v-icon",{class:{"pr-1":!e.compact},style:{"font-size":`${e.compact?30:22}px`},attrs:{color:e.isDisabled?null:e.color}},[e._v(" "+e._s(e.icon)+" ")]),e.compact?e._e():t("span",[e._v(e._s(e.text))]),e.isDisabled?t("v-spacer"):e._e(),e.isDisabled?t("v-icon",{attrs:{small:"",color:"error"}},[e._v(" mdi-alert-circle-outline ")]):e._e()],1)]}}])},[t("span",[e._v(e._s(e.disabledText||e.t("windows.sidebar.disabledItem")))])])],1)},fd=[],md=_(ud,hd,fd,!1,null,"b5f4a380",null,null);const Os=md.exports;const gd={name:"SidebarGroup",mixins:[z],components:{SidebarItem:Os},props:{text:String,isOpen:Boolean,items:Array,selected:String,compact:Boolean}};var wd=function(){var e=this,t=e._self._c;return t("details",{attrs:{open:e.isOpen}},[t("summary",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"rounded-lg",on:{click:function(i){return i.preventDefault(),e.$emit("toggleOpen")}}},[t("span",{staticClass:"d-flex",class:{"justify-center":e.compact}},[e.compact?e._e():t("h2",{staticClass:"d-inline"},[e._v(e._s(e.t(e.text)))]),e.compact?e._e():t("v-spacer"),t("v-icon",{attrs:{color:"primary",large:""}},[e._v(" "+e._s(e.isOpen?"mdi-chevron-down":"mdi-chevron-right")+" ")])],1)]),e._l(e.items,function({text:i,icon:n,color:a,id:r,isDisabled:o,disabledText:c},d){return t("SidebarItem",{key:`${i}.${d}`,attrs:{icon:n,color:a,text:i,isSelected:e.selected===r,isDisabled:o,disabledText:c,compact:e.compact},on:{click:function(p){return e.$emit("click",r)}}})}),e.compact?t("v-divider"):e._e()],2)},yd=[],vd=_(gd,wd,yd,!1,null,"7d0b77cf",null,null);const bd=vd.exports,_d={inheritAttrs:!1,components:{BaseWindow:de,SidebarItem:Os,SidebarGroup:bd},props:{sidebarItems:Array,value:{type:String,default:void 0}},computed:{selected(){return this.value},isMobile(){return this.$vuetify.breakpoint.mobile}},methods:{onSidebarChanged(s){this.$emit("input",s)},toggleOpenCategory(s){s.isOpen=!s.isOpen}}};var Sd=function(){var e=this,t=e._self._c;return t("BaseWindow",e._g(e._b({scopedSlots:e._u([{key:"toolbar",fn:function(){return[e._t("toolbar",null,{selectedTab:e.selected})]},proxy:!0},{key:"sidebar",fn:function(){return[e.isMobile?e._e():e._t("sidebar",null,{selectedSidebar:e.selected}),e._l(e.sidebarItems,function(i){return[i.type==="item"?t("SidebarItem",{key:`${i.text}`,attrs:{icon:i.icon,color:i.color,text:i.text,isSelected:e.selected===i.id,isDisabled:i.isDisabled,disabledText:i.disabledText,compact:e.isMobile},on:{click:function(n){return e.onSidebarChanged(i.id)}}}):t("SidebarGroup",{key:`${i.text}.${i.isOpen}`,attrs:{isOpen:i.isOpen,items:i.getItems(),text:i.text,selected:e.selected,compact:e.isMobile},on:{toggleOpen:function(n){return e.toggleOpenCategory(i)},click:e.onSidebarChanged}})]})]},proxy:!0},{key:"default",fn:function(){return[e._t("default",null,{selectedSidebar:e.selected})]},proxy:!0},{key:"actions",fn:function(){return[e._t("actions",null,{selectedSidebar:e.selected})]},proxy:!0}],null,!0)},"BaseWindow",e.$attrs,!1),e.$listeners))},Cd=[],kd=_(_d,Sd,Cd,!1,null,null,null,null);const gt=kd.exports,xd=X({__name:"SettingsWindow",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState(),n=e.window.sidebar,a=K(()=>n.currentElement?`[${n.currentElement.text} - ${t("windows.settings.title")}]`:"windows.settings.title");function r(){e.window.close()}function o(){location.reload()}return{__sfc:!0,t,props:e,state:i,sidebar:n,title:a,onClose:r,onReload:o,SidebarWindow:gt,pointerDevice:Q}}});var Pd=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.SidebarWindow,{attrs:{windowTitle:i.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:i.sidebar.elements},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"sidebar",fn:function(){return[t("v-text-field",{staticClass:"pt-2",attrs:{"prepend-inner-icon":"mdi-magnify",label:i.t("windows.settings.searchSettings"),autocomplete:"off",autofocus:i.pointerDevice==="mouse",outlined:"",dense:""},model:{value:i.sidebar.filter,callback:function(n){e.$set(i.sidebar,"filter",typeof n=="string"?n.trim():n)},expression:"sidebar.filter"}})]},proxy:!0},{key:"default",fn:function({selectedSidebar:n}){return[i.state.reloadRequired?t("v-alert",{attrs:{border:"bottom",type:"info"}},[t("div",{staticClass:"d-flex align-center"},[t("span",[e._v(e._s(i.t("windows.settings.reloadRequired")))]),t("v-spacer"),t("v-btn",{attrs:{text:"",dense:""},on:{click:i.onReload}},[t("v-icon",{staticClass:"pr-1",attrs:{small:""}},[e._v(" mdi-refresh ")]),e._v(" "+e._s(i.t("general.reload"))+" ")],1)],1)]):e._e(),i.sidebar.currentState.length===0&&i.sidebar.filter!==""?t("span",[e._v(' No setting matches your search for "'+e._s(i.sidebar.filter)+'". ')]):e._e(),e._l(i.sidebar.currentState,function(a,r){return t(a.component,{key:`${n}.${r}.${a.value}`,tag:"component",staticClass:"mb-6",attrs:{config:a.config,value:a.value},on:{change:a.onChange,closeWindow:i.onClose}})})]}}]),model:{value:i.sidebar.selected,callback:function(n){e.$set(i.sidebar,"selected",n)},expression:"sidebar.selected"}})},jd=[],Fd=_(xd,Pd,jd,!1,null,null,null,null);const Td=Fd.exports;class Xe{constructor(e,t,i=S){this.state=i,this.rawValue=void 0,this.onChange=async n=>{this.value!==n&&(await(this.value=n),typeof this.config.onChange=="function"&&await this.config.onChange(n))},V(this,"config",t),V(this,"component",e),this.value===void 0&&t.default!==void 0&&(this.value=t.default)}set value(e){if(this.config.omitFromSaveFile){this.rawValue=e;return}this.state[this.config.category]===void 0&&V(this.state,this.config.category,{}),V(this.state[this.config.category],this.config.key,e)}get value(){var e;return this.config.omitFromSaveFile?this.rawValue:(e=this.state[this.config.category])==null?void 0:e[this.config.key]}}const Ad={props:{config:Object,value:String},mixins:[z],data:()=>({value_:void 0}),created(){this.value_=this.config.options.findIndex(s=>s===this.value)||0},methods:{onChange(s){this.$nextTick(()=>this.$emit("change",this.config.options[s]))}}};var $d=function(){var e=this,t=e._self._c;return t("div",[t("h3",[e._v(e._s(e.t(e.config.name)))]),t("div",{staticClass:"d-flex"},[t("div",[t("v-btn-toggle",{attrs:{inset:"",dense:"",mandatory:"",label:e.config.description,value:e.value_},on:{change:e.onChange}},e._l(e.config.options,function(i){return t("v-btn",{key:i,attrs:{color:"sidebarSelection"}},[e._v(" "+e._s(i)+" ")])}),1)],1),t("span",{staticClass:"ml-4 text-normal"},[e._v(e._s(e.t(e.config.description)))])])])},Dd=[],Ed=_(Ad,$d,Dd,!1,null,null,null,null);const Md=Ed.exports;class In extends Xe{constructor(e){super(Md,e)}matches(e){return this.config.name.toLowerCase().includes(e)||this.config.description.toLowerCase().includes(e)||this.config.options.some(t=>t.toLowerCase().includes(e))}}const Id={props:{value:[Boolean,Promise],config:Object},mixins:[z],data:()=>({value_:void 0}),async mounted(){this.value_=await this.value},methods:{onChange(s){this.$emit("change",s===null?!1:s)}}};var Od=function(){var e=this,t=e._self._c;return t("div",[t("h3",[e._v(e._s(e.t(e.config.name)))]),t("v-switch",{staticStyle:{"margin-top":"0"},attrs:{inset:"",dense:"",label:e.t(e.config.description),value:e.value_},on:{change:e.onChange}})],1)},Rd=[],Wd=_(Id,Od,Rd,!1,null,null,null,null);const Ld=Wd.exports;class oe extends Xe{constructor(e){super(Ld,e)}matches(e){return this.config.name.toLowerCase().includes(e)||this.config.description.toLowerCase().includes(e)}}const Nd={props:{config:Object},components:{ActionViewer:mt},mixins:[z]};var Bd=function(){var e=this,t=e._self._c;return t("ActionViewer",{attrs:{action:e.config.action}})},Vd=[],Hd=_(Nd,Bd,Vd,!1,null,null,null,null);const Ud=Hd.exports;class zd extends Xe{constructor(e,t="actions"){var i,n;super(Ud,{category:t,action:{},description:(i=e.description)!=null?i:"No description provided",key:e.id,name:(n=e.name)!=null?n:"general.unknown"},void 0),this.config=Dt({category:"actions",action:{}}),this.onChange=async()=>{},this.config.category=t,this.config.action=e}matches(e){return this.config.action.name.includes(e)||this.config.action.description.includes(e)}}const qd={props:{config:Object,value:[String,Promise]},mixins:[z],data:()=>({value_:void 0}),async mounted(){this.value_=await this.value||this.config.default},methods:{onChange(s){this.$nextTick(()=>this.$emit("change",s))},async onClick(){this.config.onClick&&await this.config.onClick()}}};var Jd=function(){var e=this,t=e._self._c;return t("div",[t("h3",[e._v(e._s(e.t(e.config.name)))]),t("div",{staticClass:"d-flex align-center"},[t("div",[t("v-autocomplete",{attrs:{inset:"",dense:"",mandatory:"",outlined:"",value:e.value_,items:e.config.options,"hide-details":"","menu-props":{maxHeight:220,rounded:"lg","nudge-top":-8,transition:"slide-y-transition"}},on:{change:e.onChange},nativeOn:{click:function(i){return e.onClick.apply(null,arguments)}}})],1),t("span",{staticClass:"ml-4 text-normal"},[e._v(e._s(e.t(e.config.description)))])])])},Gd=[],Kd=_(qd,Jd,Gd,!1,null,null,null,null);const Yd=Kd.exports;class Ve extends Xe{constructor(e){super(Yd,e)}matches(e){return this.config.name.toLowerCase().includes(e)||this.config.description.toLowerCase().includes(e)||this.config.options.some(t=>typeof t=="string"?t.toLowerCase().includes(e):t.text.toLowerCase().includes(e))}}class On extends Ve{get value(){return l.getApp().then(e=>{var t;return(t=e.projectConfig.get().bridge)==null?void 0:t[this.config.key]})}set value(e){l.getApp().then(async t=>{t.projectConfig.get().bridge||(t.projectConfig.get().bridge={}),t.projectConfig.get().bridge[this.config.key]=e,await t.projectConfig.save()})}}const Qd={props:{config:Object},mixins:[z]};var Zd=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex align-center"},[t("v-btn",{attrs:{color:"primary"},on:{click:e.config.onClick}},[e._v(" "+e._s(e.t(e.config.name))+" ")]),t("span",{staticClass:"ml-4 text-normal"},[e._v(e._s(e.t(e.config.description)))])],1)},Xd=[],ep=_(Qd,Zd,Xd,!1,null,null,null,null);const tp=ep.exports;class ip extends Xe{constructor(e){super(tp,{...e,key:"N/A"}),this.onChange=async()=>{}}matches(e){return this.config.name.includes(e)||this.config.description.includes(e)}}const np={setup(){return{sidebarElements:l.sidebar.elements}},components:{ActionViewer:mt},methods:{onClick(s){s.isVisibleSetting=!s.isVisibleSetting,S.sidebar||(S.sidebar={}),S.sidebar.sidebarElements||(S.sidebar.sidebarElements={}),S.sidebar.sidebarElements[s.uuid]=s.isVisibleSetting}}};var sp=function(){var e=this,t=e._self._c;return t("div",e._l(e.sidebarElements,function(i,n){return t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],key:n,attrs:{selected:i.isVisibleSetting,action:{...i.config,name:i.displayName},hideTriggerButton:""},nativeOn:{click:function(a){return e.onClick(i)}}})}),1)},ap=[],rp=_(np,sp,ap,!1,null,null,null,null);const op=rp.exports;class cp extends Xe{constructor(e){super(op,e)}matches(e){return Object.values(l.sidebar.elements).some(t=>B(t.displayName).includes(e))}}const lp={props:{config:Object,value:[String,Promise]},mixins:[z],data:()=>({value_:void 0}),async created(){this.value_=await this.value||this.config.default},methods:{onChange(s){this.$nextTick(()=>this.$emit("change",s))}}};var dp=function(){var e=this,t=e._self._c;return t("div",[t("h3",[e._v(e._s(e.t(e.config.name)))]),t("div",{staticClass:"d-flex align-center"},[t("div",[t("v-text-field",{attrs:{inset:"",dense:"",mandatory:"",outlined:"",value:e.value_,items:e.config.options,"hide-details":"","menu-props":{maxHeight:220}},on:{change:e.onChange}})],1),t("span",{staticClass:"ml-4 text-normal"},[e._v(e._s(e.t(e.config.description)))])])])},pp=[],up=_(lp,dp,pp,!1,null,null,null,null);const hp=up.exports;class fp extends Xe{constructor(e){super(hp,e)}matches(e){return this.config.name.toLowerCase().includes(e)||this.config.description.toLowerCase().includes(e)}}class Rn extends Ve{constructor(e){var t;super(e),this.didLoadFonts=!1,e.onClick=()=>this.onClick(),typeof((t=navigator==null?void 0:navigator.permissions)==null?void 0:t.query)=="function"&&navigator.permissions.query({name:"local-fonts"}).then(({state:i})=>{i==="granted"&&this.onClick()}).catch(()=>{})}async onClick(){!window.queryLocalFonts||this.didLoadFonts||await window.queryLocalFonts().then(e=>{this.didLoadFonts=!0,this.config.options.push(...e.filter(t=>t.style==="Regular").map(t=>({text:t.fullName,value:t.family})))}).catch(e=>console.error(e))}}async function mp(s){s.addControl(new In({category:"appearance",name:"windows.settings.appearance.colorScheme.name",description:"windows.settings.appearance.colorScheme.description",key:"colorScheme",options:["auto","dark","light"],default:"auto",onChange:()=>{l.getApp().then(t=>t.themeManager.updateTheme())}})),s.addControl(new Ve({category:"appearance",name:"windows.settings.appearance.darkTheme.name",description:"windows.settings.appearance.darkTheme.description",key:"darkTheme",get options(){return s.parent.themeManager.getThemes("dark").map(t=>({text:t.name,value:t.id}))},default:"bridge.default.dark",onChange:()=>{l.getApp().then(t=>t.themeManager.updateTheme())}})),s.addControl(new Ve({category:"appearance",name:"windows.settings.appearance.lightTheme.name",description:"windows.settings.appearance.lightTheme.description",key:"lightTheme",get options(){return s.parent.themeManager.getThemes("light").map(t=>({text:t.name,value:t.id}))},default:"bridge.default.light",onChange:()=>{l.getApp().then(t=>t.themeManager.updateTheme())}})),s.addControl(new On({category:"appearance",name:"windows.settings.appearance.localDarkTheme.name",description:"windows.settings.appearance.localDarkTheme.description",key:"darkTheme",get options(){return s.parent.themeManager.getThemes("dark",!1).map(t=>({text:t.name,value:t.id})).concat([{text:"None",value:"bridge.noSelection"}])},default:"bridge.noSelection",onChange:()=>{l.getApp().then(t=>t.themeManager.updateTheme())}})),s.addControl(new On({category:"appearance",name:"windows.settings.appearance.localLightTheme.name",description:"windows.settings.appearance.localLightTheme.description",key:"lightTheme",get options(){return s.parent.themeManager.getThemes("light",!1).map(t=>({text:t.name,value:t.id})).concat([{text:"None",value:"bridge.noSelection"}])},default:"bridge.noSelection",onChange:()=>{l.getApp().then(t=>t.themeManager.updateTheme())}})),s.addControl(new Rn({category:"appearance",name:"windows.settings.appearance.font.name",description:"windows.settings.appearance.font.description",key:"font",default:"Roboto",options:["Roboto","Arial","Verdana","Helvetica","Tahome","Trebuchet MS","Menlo","Monaco","Courier New","monospace"]})),s.addControl(new Rn({category:"appearance",name:"windows.settings.appearance.editorFont.name",description:"windows.settings.appearance.editorFont.description",key:"editorFont",default:J()==="darwin"?"Menlo":"Consolas",options:["Roboto","Arial","Consolas","Menlo","Monaco",'"Courier New"',"monospace"],onChange:async t=>{(await l.getApp()).projectManager.updateAllEditorOptions({fontFamily:t})}})),s.addControl(new Ve({category:"appearance",name:"windows.settings.appearance.editorFontSize.name",description:"windows.settings.appearance.editorFontSize.description",key:"editorFontSize",default:"14px",options:["8px","10px","12px","14px","16px","18px","20px"],onChange:async t=>{(await l.getApp()).projectManager.updateAllEditorOptions({fontSize:Number(t.replace("px",""))})}})),s.addControl(new oe({category:"appearance",name:"windows.settings.appearance.hideToolbarItems.name",description:"windows.settings.appearance.hideToolbarItems.description",key:"hideToolbarItems",default:!1})),s.addControl(new oe({category:"sidebar",name:"windows.settings.sidebar.sidebarRight.name",description:"windows.settings.sidebar.sidebarRight.description",key:"isSidebarRight",default:!1})),s.addControl(new oe({category:"sidebar",name:"windows.settings.sidebar.shrinkSidebarElements.name",description:"windows.settings.sidebar.shrinkSidebarElements.description",key:"smallerSidebarElements",default:!1})),s.addControl(new In({category:"sidebar",name:"windows.settings.sidebar.sidebarSize.name",description:"windows.settings.sidebar.sidebarSize.description",key:"sidebarSize",options:["tiny","small","normal","large"],default:"normal",onChange:()=>{l.getApp().then(t=>t.windowResize.dispatch())}})),s.addControl(new cp({category:"sidebar",name:"windows.settings.sidebar.shrinkSidebarElements.name",description:"windows.settings.sidebar.shrinkSidebarElements.description",key:"hideElements"})),s.addControl(new Ve({omitFromSaveFile:!0,category:"general",name:"windows.settings.general.language.name",description:"windows.settings.general.language.description",key:"locale",options:be.getAvailableLanguages(),default:be.getCurrentLanguageId(),onChange:t=>{s.getState().reloadRequired=!0,pe("language",t)}})),s.addControl(new oe({category:"general",name:"windows.settings.general.collaborativeMode.name",description:"windows.settings.general.collaborativeMode.description",key:"fullLightningCacheRefresh",default:!0})),s.addControl(new oe({category:"general",name:"windows.settings.general.formatOnSave.name",description:"windows.settings.general.formatOnSave.description",key:"formatOnSave",default:!0})),s.addControl(new oe({category:"general",name:"windows.settings.general.openLinksInBrowser.name",description:"windows.settings.general.openLinksInBrowser.description",key:"openLinksInBrowser",default:!1})),s.addControl(new oe({category:"general",name:"windows.settings.general.restoreTabs.name",description:"windows.settings.general.restoreTabs.description",key:"restoreTabs",default:!0})),A.value||s.addControl(new ip({category:"general",name:"windows.settings.general.resetBridgeFolder.name",description:"windows.settings.general.resetBridgeFolder.description",onClick:async()=>{await qe("bridgeBaseDir"),await qe(Je),location.reload()}})),s.addControl(new Ve({category:"editor",name:"windows.settings.editor.jsonEditor.name",description:"windows.settings.editor.jsonEditor.description",key:"jsonEditor",options:[{text:"Tree Editor",value:"treeEditor"},{text:"Raw Text",value:"rawText"}],default:"rawText"})),s.addControl(new oe({category:"editor",name:"windows.settings.editor.bridgePredictions.name",description:"windows.settings.editor.bridgePredictions.description",key:"bridgePredictions",default:!0})),s.addControl(new oe({category:"editor",name:"windows.settings.editor.bracketPairColorization.name",description:"windows.settings.editor.bracketPairColorization.description",key:"bracketPairColorization",default:!1,onChange:async t=>{(await l.getApp()).projectManager.updateAllEditorOptions({"bracketPairColorization.enabled":t})}})),s.addControl(new oe({category:"editor",name:"windows.settings.editor.wordWrap.name",description:"windows.settings.editor.wordWrap.description",key:"wordWrap",default:!1,onChange:async t=>{(await l.getApp()).projectManager.updateAllEditorOptions({wordWrap:t?"bounded":"off"})}})),s.addControl(new Ve({category:"editor",name:"windows.settings.editor.wordWrapColumns.name",description:"windows.settings.editor.wordWrapColumns.description",key:"wordWrapColumns",default:"80",options:["40","60","80","100","120","140","160"],onChange:async t=>{(await l.getApp()).projectManager.updateAllEditorOptions({wordWrapColumn:Number(t)})}})),s.addControl(new oe({category:"editor",name:"windows.settings.editor.compactTabDesign.name",description:"windows.settings.editor.compactTabDesign.description",key:"compactTabDesign",default:!0})),s.addControl(new oe({category:"editor",name:"windows.settings.editor.keepTabsOpen.name",description:"windows.settings.editor.keepTabsOpen.description",key:"keepTabsOpen",default:!1})),s.addControl(new oe({category:"editor",name:"windows.settings.editor.automaticallyOpenTreeNodes.name",description:"windows.settings.editor.automaticallyOpenTreeNodes.description",key:"automaticallyOpenTreeNodes",default:!0})),s.addControl(new oe({category:"editor",name:"windows.settings.editor.dragAndDropTreeNodes.name",description:"windows.settings.editor.dragAndDropTreeNodes.description",key:"dragAndDropTreeNodes",default:!0})),s.addControl(new fp({category:"projects",name:"windows.settings.projects.defaultAuthor.name",description:"windows.settings.projects.defaultAuthor.description",key:"defaultAuthor",default:""})),s.addControl(new oe({category:"projects",name:"windows.settings.projects.incrementVersionOnExport.name",description:"windows.settings.projects.incrementVersionOnExport.description",key:"incrementVersionOnExport",default:A.value})),s.addControl(new oe({category:"projects",name:"windows.settings.projects.addGeneratedWith.name",description:"windows.settings.projects.addGeneratedWith.description",key:"addGeneratedWith",default:!0}));const e=await l.getApp();Object.values(e.actionManager.state).forEach(t=>{t.type==="action"&&s.addControl(new zd(t))})}class gp extends ct{get elements(){let e;const t=this._elements.value.filter(i=>{if(i.type==="category")return!0;const a=this.getState(i.id).some(r=>r.matches(this.filter));return!e&&a&&(e=i.id),a});return e&&this.lastFilter!==this.filter&&this.currentState.length===0&&this.setDefaultSelected(e),this.lastFilter=this.filter,this.sortSidebar(t)}get currentState(){var e;return this.selected?((e=this.state[this.selected])!=null?e:[]).filter(t=>t.matches(this.filter)):[]}}const Rs=class extends Y{constructor(s){super(Td,!1,!0),this.parent=s,this.sidebar=new gp([]),this.bridgeCategory=new pi({items:[],text:"bridge."}),this.state=G({...super.getState(),reloadRequired:!1}),this.defineWindow()}async setup(){this.addCategory("general",B("windows.settings.general.name"),"mdi-circle-outline"),this.addCategory("appearance",B("windows.settings.appearance.name"),"mdi-palette-outline"),this.addCategory("editor","Editor","mdi-pencil-outline"),this.addCategory("actions",B("windows.settings.actions.name"),"mdi-keyboard-outline"),this.addCategory("sidebar",B("windows.settings.sidebar.name"),"mdi-table-column"),this.addCategory("developers",B("windows.settings.developer.name"),"mdi-wrench-outline"),this.addCategory("projects",B("windows.settings.projects.name"),"mdi-folder-open-outline"),await mp(this),this.sidebar.setDefaultSelected()}addCategory(s,e,t){S[s]===void 0&&(S[s]={}),this.sidebar.addElement(new Te({color:"primary",text:e,icon:t,id:s}),[])}addControl(s){const e=this.sidebar.state[s.config.category];if(!e)throw new Error(`Undefined settings category: ${s.config.category}`);e.push(s)}static async saveSettings(s){s||(s=await l.getApp()),await s.fileSystem.writeJSON("~local/data/settings.json",S)}static async loadSettings(s){try{Dr(await s.fileSystem.readJSON("~local/data/settings.json"))}catch{}finally{this.loadedSettings.dispatch(S)}}async open(){this.state.isVisible||(this.sidebar.removeElements(),await this.setup(),super.open())}async close(){super.close();const s=await l.getApp();s.windows.loadingWindow.open(),await Rs.saveSettings(),s.windows.loadingWindow.close()}};let Me=Rs;Me.loadedSettings=new $;const wp=({disposables:s,extensionId:e})=>({SidebarContent:Ot,SidebarAction:lt,SelectableSidebarAction:dt,create(t){t.id||(console.error("SidebarModule: config.id is required"),t.id=`${e}//${t.displayName}`);const i=nt(t);return t.id&&Me.loadedSettings.once(n=>{var a,r,o;i.isVisibleSetting=(o=(r=(a=n==null?void 0:n.sidebar)==null?void 0:a.sidebarElements)==null?void 0:r[t.id])!=null?o:!0}),s.push(i),i},getSelected(){throw new Error("This function no longer works with bridge. v2")},onChange(){throw new Error("This function no longer works with bridge. v2")},select(){throw new Error("This function no longer works with bridge. v2")}});async function nn({directoryHandle:s,name:e,forceWrite:t}){let i;try{i=await s.getFileHandle(e)}catch{return i=await s.getFileHandle(e,{create:!0}),{type:"create",handle:i}}return t?{type:"overwrite",handle:i}:await new W({description:"general.confirmOverwriteFile"}).fired?{type:"overwrite",handle:i}:{type:"cancel"}}async function ui(s,e){return s.getDirectoryHandle(e).then(()=>!0).catch(()=>!1)}async function Ws(s,e){return s.getFileHandle(e).then(()=>!0).catch(()=>!1)}async function Ls({toDirectory:s,moveHandle:e,forceWrite:t}){const i=await ui(s,e.name);let n="move";if(!t&&(i||await Ws(s,e.name))){if(!await new W({description:i?"general.confirmOverwriteFolder":"general.confirmOverwriteFile"}).fired)return"cancel";n="overwrite"}try{return await e.move(s),n}catch{return"moveFailed"}}async function Ns(s){return s.moveHandle.kind==="file"?await sn(s):s.moveHandle.kind==="directory"?await yp(s):{type:"cancel"}}async function sn({fromHandle:s,toHandle:e,moveHandle:t},i=!1){if(typeof t.move=="function"){const c=await Ls({toDirectory:e,moveHandle:t,forceWrite:i});if(c!=="moveFailed")return{type:c,handle:t}}const n=await t.getFile(),{type:a,handle:r}=await nn({directoryHandle:e,name:t.name,forceWrite:i});if(!r)return{type:"cancel"};const o=await r.createWritable();return await o.write(n),await o.close(),s&&await s.removeEntry(t.name),{type:a==="overwrite"?"overwrite":"move",handle:r}}async function yp({fromHandle:s,toHandle:e,moveHandle:t}){if(typeof t.move=="function"){const r=await Ls({moveHandle:t,toDirectory:e});if(r!=="moveFailed")return{type:r,handle:t}}const i=new Z(e);let n="move";if(await ui(e,t.name)&&(n="overwrite",!await new W({description:"general.confirmOverwriteFolder"}).fired))return{type:"cancel"};const a=await i.getDirectoryHandle(t.name,{create:!0});return await ce(t,async(r,o,c)=>{await sn({moveHandle:r,fromHandle:c,toHandle:await i.getDirectoryHandle(ye(o),{create:!0})},!0)},new Set,t.name),s&&await s.removeEntry(t.name,{recursive:!0}),{type:n,handle:a}}async function Bs({newName:s,parentHandle:e,renameHandle:t,forceWrite:i}){const n=await ui(e,s);let a="rename";if(!i&&(n||await Ws(e,s))){if(!await new W({description:n?"general.confirmOverwriteFolder":"general.confirmOverwriteFile"}).fired)return"cancel";a="overwrite"}try{return await t.move(s),a}catch{return"renameFailed"}}async function vp(s){return s.renameHandle.kind==="file"?await bp(s):s.renameHandle.kind==="directory"?await _p(s):{type:"cancel"}}async function bp({renameHandle:s,newName:e,parentHandle:t},i=!1){if(typeof s.move=="function"){const c=await Bs({parentHandle:t,renameHandle:s,newName:e,forceWrite:i});if(c!=="renameFailed")return{type:c,handle:s}}const n=await s.getFile(),{type:a,handle:r}=await nn({directoryHandle:t,name:e,forceWrite:i});if(!r)return{type:"cancel"};const o=await r.createWritable();return await o.write(n),await o.close(),await t.removeEntry(s.name),{type:a==="create"?"rename":"overwrite",handle:r}}async function _p({parentHandle:s,renameHandle:e,newName:t}){if(typeof e.move=="function"){const o=await Bs({parentHandle:s,renameHandle:e,newName:t});if(o!=="renameFailed")return{type:o,handle:e}}const i=new Z(s),n=e.name;let a="rename";if(await ui(s,t)&&(a="overwrite",!await new W({description:"general.confirmOverwriteFolder"}).fired))return{type:"cancel"};const r=await i.getDirectoryHandle(t,{create:!0});return await ce(e,async(o,c,d)=>{await sn({moveHandle:o,fromHandle:d,toHandle:await i.getDirectoryHandle(ye(c),{create:!0})},!0)},new Set,t),s&&await s.removeEntry(n,{recursive:!0}),{type:a,handle:r}}function an(s,e){return s instanceof it&&e instanceof it?s.isSameEntry(e):s instanceof it||e instanceof it?!1:s.isSameEntry(e)}class rn{constructor(e,t,i){this.parent=e,this.handle=t,this.options=i,this.isSelected=E(!1),this.isEditingName=E(!1)}get name(){var e;return this.handle.name===""?(e=this.options.startPath)!=null?e:"":this.handle.name}get path(){var t;if(!this.parent)return(t=this.options.startPath)!=null?t:null;const e=this.parent.path;return e?`${e}/${this.name}`:this.name}get color(){var t,i,n,a;const e=this.path;return e?(a=(n=(i=l.packType.get(e))==null?void 0:i.color)!=null?n:this.options.defaultIconColor)!=null?a:"accent":(t=this.options.defaultIconColor)!=null?t:"accent"}getParent(){return this.parent}async isSame(e){return await an(e.handle,this.handle)}onRightClick(e,t){this._onRightClick(e,t),this.unselectAll(),this.isSelected.value=!0}onClick(e,t=!1){this._onClick(e,t),(J()==="darwin"&&!e.metaKey||J()!=="darwin"&&!e.ctrlKey)&&this.unselectAll(),this.isSelected.value=!0;const i=e.composedPath().find(n=>n.classList.contains("directory-viewer-name"));i&&i.focus()}async move(e){var r,o;if(this.parent===e)return;const t=this.path,i=this.parent;this.parent=e;const{type:n,handle:a}=await Ns({fromHandle:i.handle,toHandle:this.parent.handle,moveHandle:this.handle});a&&(this.handle=a),n==="cancel"?(this.parent=i,e.children.value=e.children.value.filter(c=>c!==this),i.children.value.push(this),i.sort()):n==="overwrite"&&(e.children.value=e.children.value.filter(c=>c===this||!c.isSame(this))),(o=(r=this.options).onHandleMoved)==null||o.call(r,{movedHandled:this.handle,fromHandle:this.parent.handle,fromPath:t,toPath:this.path,toHandle:this.parent.handle}),e.sort()}async rename(e){var r,o;if(this.name===e)return;const t=this.path,i=this.parent,{type:n,handle:a}=await vp({parentHandle:i.handle,renameHandle:this.handle,newName:e});a&&(this.handle=a),n!=="cancel"&&(n==="overwrite"&&(this.getParent().children.value=this.getParent().children.value.filter(c=>c===this||!c.isSame(this))),(o=(r=this.options).onHandleMoved)==null||o.call(r,{movedHandled:this.handle,fromHandle:i.handle,fromPath:t,toPath:this.path,toHandle:this.parent.handle}),await this.parent.refresh())}startRename(){this.options.isReadOnly||this.parent===null||(this.isEditingName.value=!0)}async confirmRename(e){!e||(this.isEditingName.value=!1,await this.rename(e))}}const Ge={item:null},hi=s=>({icon:"mdi-content-copy",name:"actions.copy.name",onTrigger:async()=>{Ge.item=s.handle}}),Sp=s=>({icon:"mdi-plus",name:"actions.open.name",onTrigger:async()=>{(await l.getApp()).project.openFile(s.handle,{readOnlyMode:s.options.isReadOnly?"forced":"off"})}}),Cp=s=>({icon:"mdi-arrow-split-vertical",name:"actions.openInSplitScreen.name",onTrigger:async()=>{(await l.getApp()).project.openFile(s.handle,{openInSplitScreen:!0,readOnlyMode:s.options.isReadOnly?"forced":"off"})}});const kp={name:"HTMLPreviewTab",props:{tab:Object},async mounted(){const s=await l.getApp();setTimeout(()=>this.updateIframe(),50),this.disposable=s.windowResize.on(()=>{setTimeout(()=>this.updateIframe(),50)})},destroyed(){this.disposable&&(this.disposable.dispose(),this.disposable=null)},data:()=>({disposable:null}),methods:{async updateIframe(){if(await this.tab.fired,!this.$refs.container)return;if(!this.$refs.container.isConnected){setTimeout(()=>this.updateIframe(),50);return}const{width:s,height:e,top:t,left:i}=this.$refs.container.getBoundingClientRect();this.tab.iframe.height=`${e-16}px`,this.tab.iframe.width=`${s-16}px`,this.tab.iframe.style.top=`${t}px`,this.tab.iframe.style.left=`${i}px`}},watch:{tab(){setTimeout(()=>this.updateIframe(),50)}}};var xp=function(){var e=this,t=e._self._c;return t("div",{ref:"container"})},Pp=[],jp=_(kp,xp,Pp,!1,null,null,null,null);const Fp=jp.exports;class Tp{constructor(e){this.api=e,this.disposables=[],this.disposables.push(this.api.loaded.on(()=>this.onApiLoaded(),!0),this.api.loaded.once(()=>this.setup(),!0))}onApiLoaded(){}dispose(){this.disposables.forEach(e=>e.dispose()),this.disposables=[]}}class Ap extends Tp{async setup(){const e=await l.getApp();this.disposables.push(e.themeManager.on(()=>{this.api.trigger("themeManager.themeChange",e.themeManager.getCurrentTheme())})),this.api.trigger("themeManager.themeChange",e.themeManager.getCurrentTheme())}}class $p{constructor(e,t){this.api=t,this.disposables=[],this.api.loaded.once(()=>{this.api.channel.on(e,(i,n)=>this.handle(i,n))}),this.disposables.push()}dispose(){this.disposables.forEach(e=>e.dispose()),this.disposables=[]}}class Dp extends $p{constructor(e){super("fs.readFile",e)}async handle(e,t){const n=await(await l.getApp()).fileSystem.readFile(e);return new Uint8Array(await n.arrayBuffer())}}class Ep{constructor(e){this.iframe=e,this.didSetup=!1,this.loaded=new $,this.disposables=[],this.events=[new Ap(this)],this.requests=[new Dp(this)],this.iframe.addEventListener("load",async()=>{!e.src&&!e.srcdoc||(this._channel=new qa(this.iframe.contentWindow),await this.channel.open(),this.onLoad(),this.loaded.dispatch())})}get channel(){if(!this._channel)throw new Error("Channel is not initialized yet. Make sure to await iframeApi.loaded.fired");return this._channel}on(e,t){return this.channel.on(e,t)}trigger(e,t){return this.channel.simpleTrigger(e,t)}onLoad(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.trigger("app.buildInfo",{appVersion:we,isNightlyBuild:Ae})}dispose(){this.events.forEach(e=>e.dispose()),this.events=[],this.requests.forEach(e=>e.dispose()),this.requests=[]}}class He extends ht{constructor(e,t={}){super(e),this.options=t,this.component=Fp,this.iframe=document.createElement("iframe"),this.api=k(new Ep(this.iframe)),this.isTemporary=!1,this.iframe.setAttribute("sandbox","allow-scripts allow-same-origin allow-modals allow-popups allow-forms allow-downloads"),this.loaded=new Promise(i=>this.iframe.addEventListener("load",()=>i())),this.url&&this.setUrl(this.url),this.options.html&&(this.iframe.srcdoc=this.options.html),this.iframe.width="100%",this.iframe.style.display="none",this.iframe.style.position="absolute",this.iframe.classList.add("outlined"),this.iframe.style.borderRadius="12px",this.iframe.style.margin="8px",document.body.appendChild(this.iframe)}async setup(){await super.setup()}async onActivate(){this.isLoading=!0,await this.loaded,this.isLoading=!1,this.iframe.style.display="block"}onDeactivate(){this.iframe.style.display="none"}onDestroy(){document.body.removeChild(this.iframe),this.api.dispose()}get icon(){var e;return(e=this.options.icon)!=null?e:"mdi-web"}get iconColor(){return this.options.iconColor}get name(){var e;return(e=this.options.name)!=null?e:"Web"}get url(){return this.options.url}set srcdoc(e){this.api.loaded.resetSignal(),this.iframe.srcdoc=e}set src(e){this.api.loaded.resetSignal(),this.iframe.src=e}setUrl(e){this.iframe.src=e}async is(e){return e instanceof He&&e.url===this.url}}let ke=Ds["bridge-iframe-api"];ke.startsWith("^")||ke.startsWith("~")||ke.startsWith(">")||ke.startsWith("<")?ke=ke.substring(1):(ke.startsWith(">=")||ke.startsWith("<="))&&(ke=ke.substring(2));const Mp=ke;class fi extends He{constructor(e,t){super(e),this.previewOptions=t,this.rawHtml="",this.defaultStyles="",this.scrollY=0;const i=e.app.themeManager;this.updateDefaultStyles(i),this.themeListener=i.on(()=>this.updateDefaultStyles(i)),t.filePath&&(this.fileListener=e.app.project.fileChange.on(t.filePath,async n=>{await this.load(n)})),this.api.loaded.once(()=>{this.api.on("saveScrollPosition",n=>{console.log("SAVE",n),n!==0&&(this.scrollY=n)})})}async setup(){await this.load(),await super.setup()}async onActivate(){console.log(this.scrollY),this.api.trigger("loadScrollPosition",this.scrollY),await super.onActivate()}onDeactivate(){var e;(e=this.messageListener)==null||e.dispose(),this.messageListener=void 0,super.onDeactivate()}onDestroy(){var e,t;(e=this.themeListener)==null||e.dispose(),this.themeListener=void 0,(t=this.fileListener)==null||t.dispose(),this.fileListener=void 0}get icon(){return"mdi-language-html5"}get iconColor(){return"behaviorPack"}get name(){return`${B("preview.name")}: ${this.fileHandle.name}`}get fileHandle(){return this.previewOptions.fileHandle}get html(){return this.rawHtml.replaceAll('href="#','href="about:srcdoc#')+`<link
				rel="stylesheet"
				href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"
			/><style>${this.defaultStyles}</style><script type="module">
				import { Channel } from "https://unpkg.com/bridge-iframe-api@${Mp}/dist/bridge-iframe-api.es.js"

				const channel = new Channel()

				await channel.connect()
	
				window.addEventListener('scroll', () => {
					console.log('SCROLL')
					channel.simpleTrigger('saveScrollPosition', window.scrollY)
				})
	
	
				channel.on('loadScrollPosition', (scrollY) => {
					console.log('LOAD', scrollY)
					window.scrollTo(0, scrollY)
				})
				
			<\/script>`}updateDefaultStyles(e){this.defaultStyles=`html {
			color: ${e.getColor("text")};
			font-family: Roboto;
		}
		
		a {
			color: ${e.getColor("primary")};
		}
	
		textarea, input {
			background-color: ${e.getColor("background")};
			color: ${e.getColor("text")};
		}`,this.rawHtml!==""&&this.updateHtml()}updateHtml(){this.srcdoc=this.html,this.api.trigger("loadScrollPosition",this.scrollY)}async load(e){e||(e=await this.fileHandle.getFile()),this.rawHtml=await e.text(),this.updateHtml()}async is(e){return e instanceof fi&&await e.fileHandle.isSameEntry(this.fileHandle)}}const Ip=(s,e)=>s.name.endsWith(".html")?{icon:"mdi-language-html5",name:"openWith.htmlPreviewer",onTrigger:async()=>{const i=(await l.getApp()).tabSystem;!i||i.add(new fi(i,{fileHandle:s,filePath:e!=null?e:void 0}))}}:null,Op=s=>s.name.endsWith(".json")?{icon:"mdi-file-tree-outline",name:"openWith.treeEditor",onTrigger:async()=>{const t=(await l.getApp()).tabSystem;!t||t.add(new Tt(t,s.handle,s.options.isReadOnly?"forced":"off"))}}:null,Rp=[".png",".jpg",".jpeg",".tga",".fsb",".wav",".ogg"],Wp=s=>{const e=Pe(s.name);return Rp.includes(e)?null:{icon:"mdi-pencil-outline",name:"openWith.textEditor",onTrigger:async()=>{const i=(await l.getApp()).tabSystem;!i||i.add(new ot(i,s.handle,s.options.isReadOnly?"forced":"off"))}}},Lp=s=>{if(!s.name.endsWith(".json"))return null;const e=s.path;if(!e)return null;const t=l.fileType.getId(e);return t==="particle"||t==="unknown"&&e.includes("particles/")?{icon:"mdi-snowflake",name:"openWith.snowstorm",onTrigger:async()=>{const n=(await l.getApp()).tabSystem;if(!n)return;const a=await s.handle.getFile();R.parse(await a.text());const r=new Uint8Array(await a.arrayBuffer()),o=btoa(Ri(Yn(r,{level:9}),!0)),c=new URL("https://snowstorm.app/");c.searchParams.set("loadParticle",o),n.add(new He(n,{icon:"mdi-snowflake",name:`Snowstorm: ${s.name}`,url:c.href,iconColor:"primary"}))}}:null},Ei=new Set,Np=async s=>{var i,n,a;const e=[Wp(s),Op(s),Ip(s.handle,(i=s.path)!=null?i:void 0)].filter(r=>r!==null),t=[Lp(s)].filter(r=>r!==null);for(const r of Ei){const o={isReadOnly:s.options.isReadOnly,fileHandle:s.handle,filePath:s.path};!((a=await((n=r.isAvailable)==null?void 0:n.call(r,o)))==null||a)||t.push({icon:r.icon,name:r.name,onTrigger:async()=>{await r.onOpen(o)}})}return{type:"submenu",icon:"mdi-open-in-app",name:"actions.openWith.name",actions:[...e,e.length>0&&t.length>0?{type:"divider"}:null,...t]}},Vs=s=>A.value?null:{icon:s.kind==="directory"?"mdi-folder-marker-outline":"mdi-file-marker-outline",name:"actions.revealPath.name",onTrigger:async()=>{new U({name:"actions.revealPath.name",description:`[${s.path}]`,isPersistent:!1}).open()}},mi=s=>({icon:"mdi-content-paste",name:"actions.paste.name",onTrigger:async()=>{if(s.options.isReadOnly||!Ge.item)return;const e=Ge.item,t=await l.getApp(),i=t.project;s.isOpen.value||await s.open();let n;if(e.kind==="file"){const a=Bp(e.name,s);n=await s.handle.getFileHandle(a,{create:!0}),await t.fileSystem.copyFileHandle(e,n)}else if(e.kind==="directory"){t.windows.loadingWindow.open();const a=Vp(e.name,s);n=await s.handle.getDirectoryHandle(a,{create:!0}),await t.fileSystem.copyFolderByHandle(e,n),t.windows.loadingWindow.close()}else throw new Error("Invalid handle kind: "+e.kind);return await s.refresh(),n&&await i.updateHandle(n),n}});function Bp(s,e){var a,r;const t=e.children.value,i=Pe(s);let n=me(s,i);for(;t!=null&&t.find(o=>o.name===n+i);)if(!n.includes(" copy"))n=`${n} copy`;else{const o=parseInt((r=(a=n.match(/copy (\d+)/))==null?void 0:a[1])!=null?r:"1");n=n.replace(/ \d+$/,"")+` ${o+1}`}return n+i}function Vp(s,e){var n,a;const t=e.children.value;let i=s;for(;t!=null&&t.find(r=>r.name===i);){if(console.log(i),!i.includes(" copy"))i=`${i} copy`;else{const r=parseInt((a=(n=i.match(/copy (\d+)/))==null?void 0:n[1])!=null?a:"1");i=i.replace(/ \d+$/,"")+` ${r+1}`}console.log("After: "+i)}return i}const Hp=s=>({icon:"mdi-content-duplicate",name:"actions.duplicate.name",onTrigger:async()=>{const e=s.getParent();if(!e)return;Ge.item=s.handle;const t=await mi(e).onTrigger();if(!t)return;const i=e.getChild(t.name);!i||(i.isEditingName.value=!0)}}),Up=s=>({icon:"mdi-pencil-outline",name:"actions.rename.name",onTrigger:()=>{s.isEditingName.value=!0}}),Hs=s=>({icon:"mdi-delete-outline",name:"actions.delete.name",onTrigger:async()=>{var r,o;const e=s.getParent();if(s.options.isReadOnly||e===null)return;const t=await l.getApp(),i=c=>B(c);if(!await new W({description:`[${i("actions.delete.confirmText")} "${(r=s.path)!=null?r:s.name}"? ${i("actions.delete.noRestoring")}]`}).fired)return;await t.project.unlinkHandle(s.handle)||await e.handle.removeEntry(s.name,{recursive:!0}),await((o=s.getParent())==null?void 0:o.refresh())}}),Us=async(s,e={})=>({type:"submenu",icon:s instanceof xe?"mdi-folder-edit-outline":"mdi-file-edit-outline",name:"actions.edit.name",actions:[hi(s),mi(s instanceof xe?s:s.getParent()),e.hideDuplicate?null:Hp(s),e.hideRename?null:Up(s),e.hideDelete?null:Hs(s)]});class gi{constructor(e){this.handle=e}async package(){let e={};return await ce(this.handle,async(t,i)=>{const n=await t.getFile();e[i]=new Uint8Array(await n.arrayBuffer())}),new Promise((t,i)=>Ja(e,{level:6},(n,a)=>{if(n){i(n);return}t(a)}))}}const zs=s=>({icon:s.kind==="directory"?"mdi-folder-download-outline":"mdi-file-download-outline",name:"actions.download.name",onTrigger:async()=>{if(s.kind==="file"){const e=await s.handle.getFile();rt(s.name,new Uint8Array(await e.arrayBuffer()))}else{const e=new gi(s.handle);rt(`${s.name}.zip`,await e.package())}}});async function zp(s,e){var i,n;const t=await((n=(i=e.options).provideFileContextMenu)==null?void 0:n.call(i,e));$e(s,[Sp(e),await Np(e),Cp(e),{type:"divider"},e.options.isReadOnly?hi(e):await Us(e),{type:"divider"},{icon:"mdi-share",name:"general.shareFile",onTrigger:async()=>{await fs(e.handle)}},zs(e),Vs(e),...t!=null?t:[]])}class qs extends rn{constructor(e,t,i){super(e,t,i),this.kind="file"}get icon(){var t,i;const e=this.path;return e?(i=(t=l.fileType.get(e))==null?void 0:t.icon)!=null?i:Yt(this.handle.name):Yt(this.handle.name)}async getFirstDiagnostic(){return null}async openFile(e=!1){await(await l.getApp()).project.openFile(this.handle,{selectTab:!0,readOnlyMode:this.options.isReadOnly?"forced":"off",isTemporary:!e})}_onRightClick(e){var t,i;zp(e,this),(i=(t=this.options).onFileRightClick)==null||i.call(t,e,this)}async _onClick(e,t){var i;if(t){const a=(i=(await l.getApp()).project.tabSystem)==null?void 0:i.selectedTab;a&&a.isTemporary&&(a.isTemporary=!1)}this.openFile()}unselectAll(){var e;(e=this.parent)==null||e.unselectAll()}}const At={matchCase:0,ignoreCase:1,useRegExp:2},qp={name:"SearchType",props:{value:Number}};var Jp=function(){var e=this,t=e._self._c;return t("v-btn-toggle",{attrs:{dense:"",mandatory:"",value:e.value},on:{change:i=>e.$emit("input",i)}},[t("v-btn",{staticStyle:{"min-width":"unset"},attrs:{title:"Match Case",color:"menu"}},[t("v-icon",[e._v("mdi-format-letter-case-upper")])],1),t("v-btn",{staticStyle:{"min-width":"unset"},attrs:{title:"Ignore Case",color:"menu"}},[t("v-icon",[e._v("mdi-format-letter-case")])],1),t("v-btn",{staticStyle:{"min-width":"unset"},attrs:{title:"Use Regular Expression",color:"menu"}},[t("v-icon",[e._v("mdi-regex")])],1)],1)},Gp=[],Kp=_(qp,Jp,Gp,!1,null,null,null,null);const Yp=Kp.exports;const Qp={name:"Match",props:{replaceWith:String,showReplaceWith:Boolean,item:Object}};var Zp=function(){var e=this,t=e._self._c;return t("div",{staticClass:"code-font code-match",staticStyle:{width:"100%","overflow-x":"hidden"}},[t("span",[e._v(e._s(e.item.isStartOfFile?"":"...")+e._s(e.item.beforeMatch))]),t("span",{class:{"error--text text-decoration-line-through":e.showReplaceWith,"success--text":!e.showReplaceWith}},[e._v(e._s(e.item.match))]),e.showReplaceWith?t("span",{staticClass:"success--text"},[e._v(e._s(e.replaceWith))]):e._e(),t("span",[e._v(e._s(e.item.afterMatch)+"...")])])},Xp=[],eu=_(Qp,Zp,Xp,!1,null,"3d3eaa64",null,null);const tu=eu.exports;const iu={name:"FileName",props:{displayFilePath:String,filePath:String,fileHandle:{}},methods:{getFileIcon(s){var e;return(e=(l.fileType.get(s)||{}).icon)!=null?e:"mdi-file-outline"},getIconColor(s){return(l.packType.get(s)||{}).color},async openFile(){(await l.getApp()).project.openFile(this.fileHandle)}}};var nu=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"font-weight-black clickable px-1",staticStyle:{display:"inline-block",width:"fit-content"},on:{click:e.openFile}},[t("v-icon",{staticStyle:{position:"relative",top:"-2px"},attrs:{small:"",color:e.getIconColor(e.filePath)}},[e._v(" "+e._s(e.getFileIcon(e.filePath))+" ")]),e._v(" "+e._s(e.displayFilePath)+" ")],1)},su=[],au=_(iu,nu,su,!1,null,null,null,null);const ru=au.exports;function ou(s,e,t){return s.replace(e,(i,...n)=>(n=n.slice(0,-2),t.replace(/{(\d+)}/g,(a,...r)=>{var o;return(o=n[Number(r[0])])!=null?o:a})))}function cu(s,e){let t;try{t=new RegExp(e===At.useRegExp?s:Ga(s),`g${e===At.ignoreCase?"i":""}`)}catch{return}return t}const lu={name:"FindAndReplaceTab",mixins:[z],components:{SearchType:Yp,Match:tu,FilePath:ru},props:{tab:Object,height:Number},setup(){return{pointerDevice:Q}},mounted(){this.$refs.virtualScroller.$el.scrollTop=this.scrollTop},activated(){this.$refs.virtualScroller.$el.scrollTop=this.scrollTop},data(){return this.tab.state},methods:{updateQuery:Ue(async function(){await this.tab.updateQuery()},250),onScroll(s){this.scrollTop=s.target.scrollTop},onReplaceAll(){this.tab.executeQuery()},processReplaceWith(s){return ou(s,cu(this.searchFor,this.queryOptions.searchType),this.replaceWith)},onReplaceSingleFile(s,e){this.tab.executeSingleQuery(s,e)}},computed:{hasLimitedSpace(){return this.$vuetify.breakpoint.mobile||this.tab.parent.isSharingScreen.value}},watch:{"tab.uuid"(){for(const s in this.tab.state)V(this,s,this.tab.state[s])},searchFor(){this.updateQuery()},"queryOptions.searchType"(){this.updateQuery()},"queryOptions.includeFiles"(){this.updateQuery()},"queryOptions.excludeFiles"(){this.updateQuery()},scrollTop(){this.$refs.virtualScroller.$el.scrollTop=this.scrollTop}}};var du=function(){var e=this,t=e._self._c;return t("div",{staticClass:"px-3"},[t("div",{staticClass:"d-flex",class:{"flex-column":e.hasLimitedSpace}},[t("v-col",{staticClass:"flex-grow-0 flex-shrink-0 align-center",attrs:{cols:e.hasLimitedSpace?12:3}},[t("v-text-field",{staticClass:"mb-2",attrs:{"prepend-inner-icon":"mdi-magnify",outlined:"",dense:"","hide-details":"",autofocus:e.pointerDevice==="mouse",label:e.t("findAndReplace.search")},model:{value:e.searchFor,callback:function(i){e.searchFor=i},expression:"searchFor"}}),e.queryOptions.isReadOnly?e._e():t("v-text-field",{staticClass:"mb-2",attrs:{"prepend-inner-icon":"mdi-file-replace-outline",outlined:"",dense:"","hide-details":"",label:e.t("findAndReplace.replace")},model:{value:e.replaceWith,callback:function(i){e.replaceWith=i},expression:"replaceWith"}}),e.queryOptions.isReadOnly?e._e():t("v-btn",{staticClass:"mb-2",attrs:{color:"primary",block:"",disabled:e.replaceWith===""||e.searchFor==="",loading:e.tab.isLoading},on:{click:function(i){return e.onReplaceAll()}}},[t("v-icon",{staticClass:"mr-1",attrs:{small:""}},[e._v("mdi-file-replace-outline")]),e._v(" "+e._s(e.t("findAndReplace.replaceAll"))+" ")],1),t("SearchType",{staticClass:"mb-2",model:{value:e.queryOptions.searchType,callback:function(i){e.$set(e.queryOptions,"searchType",i)},expression:"queryOptions.searchType"}})],1),t("v-col",{staticClass:"flex-grow-1 flex-shrink-0",attrs:{cols:e.hasLimitedSpace?12:9}},[t("v-card",{staticClass:"pa-2",staticStyle:{background:"var(--v-expandedSidebar-base)"},style:`white-space: nowrap; height: ${(e.hasLimitedSpace?400:e.height)-24}px`,attrs:{outlined:"",rounded:""}},[e.queryResults.length===0?t("p",{staticStyle:{"white-space":"normal"}},[e._v(" "+e._s(e.t(`findAndReplace.no${e.searchFor===""?"Search":"Results"}`))+" ")]):e._e(),t("v-virtual-scroll",{ref:"virtualScroller",attrs:{items:e.tab.displayQueryResults,height:(e.hasLimitedSpace?400:e.height)-40,bench:30,"item-height":"22"},nativeOn:{scroll:function(i){return e.onScroll.apply(null,arguments)}},scopedSlots:e._u([{key:"default",fn:function({item:i}){return[i.filePath?t("div",{staticStyle:{display:"inline-flex",width:"calc(100% - 8px)"}},[t("FilePath",{attrs:{filePath:i.filePath,displayFilePath:i.displayFilePath,fileHandle:i.fileHandle}}),t("v-spacer"),e.queryOptions.isReadOnly?e._e():t("v-btn",{staticStyle:{position:"relative",top:"3px"},attrs:{icon:"","x-small":"",disabled:e.replaceWith===""},on:{click:function(n){return e.onReplaceSingleFile(i.filePath,i.fileHandle)}}},[t("v-icon",[e._v("mdi-file-replace-outline")])],1)],1):t("Match",{attrs:{showReplaceWith:!!e.replaceWith,replaceWith:e.processReplaceWith(i.match),item:i}})]}}])})],1)],1)],1)])},pu=[],uu=_(lu,du,pu,!1,null,null,null,null);const hu=uu.exports;function fu(){return new Worker("/assets/Worker.c4b6f165.js")}const mu=Li(new fu);class on extends ht{constructor(e,t,i){super(e),this.parent=e,this.component=k(hu),this.directories=k([]),this.state=G({scrollTop:0,searchFor:"",replaceWith:"",queryOptions:{isReadOnly:!1,searchType:At.matchCase},queryResults:[]}),this.shouldLoadPackDirs=!1,this.isSearchFree=new Es,i&&(this.state.queryOptions=i),t?this.directories=k(t):this.shouldLoadPackDirs=!0}get displayQueryResults(){return this.state.queryResults.map(({matches:e,...t})=>[t,...e]).flat()}async setup(){if(await this.isSearchFree.lock(),this.shouldLoadPackDirs){this.shouldLoadPackDirs=!1;const e=this.parent.app,t=e.project,i=t.getPacks();for(const n of i){const a=t.config.resolvePackPath(n),r=await e.fileSystem.getDirectoryHandle(a).catch(()=>null);r&&this.directories.push({directory:r,path:a})}}this.findAndReplace=await new mu(this.parent.projectRoot,this.parent.project.projectPath),await super.setup(),this.isSearchFree.unlock()}async updateQuery(){this.isTemporary=!1,await this.isSearchFree.lock(),this.isLoading=!0,this.state.queryResults=await this.findAndReplace.createQuery(this.directories,this.state.searchFor,this.state.queryOptions),this.isLoading=!1,this.state.scrollTop=0,this.isSearchFree.unlock()}async executeQuery(){await this.isSearchFree.lock(),this.isLoading=!0,await this.findAndReplace.executeQuery(this.directories,this.state.searchFor,this.state.replaceWith,this.state.queryOptions),await Promise.all(this.state.queryResults.map(({fileHandle:e})=>this.parent.app.project.updateHandle(e))),this.state.queryResults=[],this.state.scrollTop=0,this.isLoading=!1,this.isSearchFree.unlock()}async executeSingleQuery(e,t){await this.isSearchFree.lock(),this.isLoading=!0;const i=await this.findAndReplace.setMatchedFiles([e]);await this.findAndReplace.executeQuery(this.directories,this.state.searchFor,this.state.replaceWith,this.state.queryOptions),await this.findAndReplace.setMatchedFiles(i.filter(n=>n!==e)),await this.parent.app.project.updateHandle(t),this.state.queryResults=this.state.queryResults.filter(n=>n.filePath!==e),this.isLoading=!1,this.isSearchFree.unlock()}static is(){return!1}async is(){return!1}async onActivate(){}get icon(){return"mdi-file-search-outline"}get iconColor(){return"success"}get name(){const e=t=>B(t);return(this.state.queryOptions.isReadOnly?e("findAndReplace.findOnly"):e("findAndReplace.name"))+(this.directories.length===1?`: "${this.directories[0].directory.name}"`:"")}save(){}}const Wn=s=>({icon:"mdi-file-search-outline",name:"actions.findInFolder.name",onTrigger:async()=>{var i,n;const t=(await l.getApp()).project;(n=t.tabSystem)==null||n.add(new on(t.tabSystem,[{directory:s.handle,path:(i=s.path)!=null?i:""}],{searchType:At.matchCase,isReadOnly:s.options.isReadOnly}))}}),gu=X({__name:"Input",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState();function n(){e.window.close(null),i.inputValue=""}function a(){e.window.confirm(),i.inputValue=""}return{__sfc:!0,t,props:e,state:i,onClose:n,onConfirm:a,BaseWindow:de,pointerDevice:Q}}});var wu=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,width:440,height:120},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"d-flex justify-center align-center"},[t("v-text-field",{staticClass:"mr-2",attrs:{label:i.t(e.window.label),outlined:"",dense:"",autofocus:i.pointerDevice==="mouse","hide-details":""},nativeOn:{keydown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:i.onConfirm.apply(null,arguments)}},model:{value:i.state.inputValue,callback:function(n){e.$set(i.state,"inputValue",n)},expression:"state.inputValue"}}),e.window.expandText!==""?t("span",{staticClass:"expand-text text--secondary"},[e._v(" "+e._s(e.window.expandText)+" ")]):e._e()],1)]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary",disabled:i.state.inputValue===""},on:{click:i.onConfirm}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(e._s(i.t("general.confirm")))])],1)]},proxy:!0}],null,!1,1573498354)}):e._e()},yu=[],vu=_(gu,wu,yu,!1,null,null,null,null);const bu=vu.exports;class Mi extends Y{constructor(e){var t;super(bu,!0,!1),this.opts=e,this.state=G({...super.getState(),inputValue:""}),this.state.inputValue=(t=e.default)!=null?t:"",super.defineWindow(),super.open()}get title(){return this.opts.name}get label(){return this.opts.label}get expandText(){return this.opts.expandText}async confirm(){var t;const e=this.state.inputValue+((t=this.expandText)!=null?t:"");typeof this.opts.onConfirm=="function"&&await this.opts.onConfirm(e),super.close(e)}}async function _u({directoryHandle:s,name:e,forceWrite:t}){let i;try{i=await s.getDirectoryHandle(e)}catch{return i=await s.getDirectoryHandle(e,{create:!0}),{type:"create",handle:i}}return t?{type:"overwrite",handle:i}:await new W({description:"general.confirmOverwriteFolder"}).fired?{type:"overwrite",handle:i}:{type:"cancel"}}async function cn(s,e,t={}){var r,o;const i=await l.getApp();e.path;const n=[{icon:"mdi-file-plus-outline",name:"actions.createFile.name",onTrigger:async()=>{const d=await new Mi({name:"actions.createFile.name",label:"general.fileName",default:""}).fired;if(!d)return;const{type:p,handle:u}=await nn({directoryHandle:e.handle,name:d});p!=="cancel"&&(u&&(i.project.updateHandle(u),await i.project.openFile(u,{selectTab:!0})),e.refresh())}},{icon:"mdi-folder-plus-outline",name:"actions.createFolder.name",onTrigger:async()=>{const d=await new Mi({name:"actions.createFolder.name",label:"general.folderName",default:""}).fired;if(!d)return;const{type:p}=await _u({directoryHandle:e.handle,name:d});p!=="cancel"&&e.refresh()}},Wn(e),{type:"divider"},await Us(e,t)].filter(c=>c!==null),a=await((o=(r=e.options).provideDirectoryContextMenu)==null?void 0:o.call(r,e));$e(s,[...e.options.isReadOnly?[Wn(e),hi(e)]:n,{type:"divider"},zs(e),Vs(e),...a!=null?a:[]])}const Su=[".DS_Store"];class xe extends rn{constructor(e,t,i){super(e,t,i),this.kind="directory",this.isOpen=E(!1),this.isLoading=E(!1),this.children=E(null)}get icon(){return this.isOpen.value?"mdi-folder-open":"mdi-folder"}async getChildren(){const e=[];try{for await(const t of this.handle.values())t.kind==="directory"?e.push(k(new xe(this,t,this.options))):t.kind==="file"&&!Su.includes(t.name)&&e.push(k(new qs(this,t,this.options)))}catch{console.error("Trying to access non-existent directory",this.path)}return this.sortChildren(e),e}sortChildren(e){return e.sort((t,i)=>t.kind===i.kind?t.name.localeCompare(i.name):t.kind==="directory"?-1:i.kind==="directory"?1:0)}async load(){if(this.children.value){console.warn("Children are already loaded");return}this.children.value=await this.getChildren()}getOpenFolders(e=[]){const t=[];return this.isOpen.value&&e.length!==0&&t.push(e),this.children.value&&this.children.value.forEach(i=>{i.kind==="directory"&&t.push(...i.getOpenFolders(e?[...e,i.name]:[i.name]))}),t}async openFolderPaths(e,t){if(e.length!==0)for(const i of e){const n=t.find(a=>a.name===i[0]&&a.kind==="directory");n&&(await n.open(),n.children.value&&await n.openFolderPaths([i.slice(1)],n.children.value))}}async refresh(){const e=this.getOpenFolders([]),t=await this.getChildren();await this.openFolderPaths(e,t),this.children.value=t}sort(){this.children.value&&this.sortChildren(this.children.value)}async toggleOpen(e=!1){this.isOpen.value?this.close(e):await this.open(e)}async close(e=!1){var t;this.isOpen.value=!1,e&&((t=this.children.value)==null||t.forEach(i=>{i instanceof xe&&i.close(!0)}))}async open(e=!1){var t;this.isOpen.value&&!e||(this.children.value?this.isOpen.value=!0:(this.isLoading.value=!0,await this.load(),this.isOpen.value=!0,this.isLoading.value=!1),e&&((t=this.children.value)==null||t.forEach(i=>{i instanceof xe&&i.open(!0)})))}getChild(e){var t;if(!this.children.value)throw new Error("Cannot use directoryWrapper.getChild(..) because children are not loaded yet");return(t=this.children.value)==null?void 0:t.find(i=>i.name===e)}_unselectAll(){var e;this.isSelected.value=!1,(e=this.children.value)==null||e.forEach(t=>{t.isSelected.value=!1,t.kind==="directory"&&t._unselectAll()})}unselectAll(){if(this.parent===null)return this._unselectAll();this.parent.unselectAll()}_onRightClick(e){var t,i;cn(e,this,{hideDelete:this.parent===null,hideRename:this.parent===null,hideDuplicate:this.parent===null}),(i=(t=this.options).onDirectoryRightClick)==null||i.call(t,e,this)}_onClick(e,t){t?this.isOpen.value?this.open(!0):this.close(!0):this.toggleOpen(t)}}class Js{static async getCachedDirectoryHandle(e){for(const[t,i]of this.cache.entries())if(await an(t,e))return await i.refresh(),i;return null}static async getDirectory(e,t={}){const i=await this.getCachedDirectoryHandle(e);if(i)return i;const n=new xe(null,e,t);return await n.open(),this.cache.set(e,k(n)),n}static async disposeDirectory(e){this.cache.delete(e)}}Js.cache=new Map;const Cu={props:{name:String,icon:String,color:String,opacity:Number,showName:{type:Boolean,default:!0}}};var ku=function(){var e=this,t=e._self._c;return t("span",e._g({staticClass:"icon-name",style:{opacity:e.opacity}},e.$listeners),[t("v-icon",{staticClass:"pr-1",attrs:{color:e.color,small:""}},[e._v(" "+e._s(e.icon)+" ")]),e.showName?t("span",{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},[e._v(" "+e._s(e.name)+" ")]):e._e()],1)},xu=[],Pu=_(Cu,ku,xu,!1,null,"1216ba2d",null,null);const ju=Pu.exports;function Fu(s,e=!1){let t=null,i=0;return(...n)=>{if(Q.value==="touch")return s(!1,...n);i===0?(i++,e&&s(!1,...n),t=window.setTimeout(()=>{i=0,t=null,e||s(!1,...n)},500)):(t&&window.clearTimeout(t),i=0,s(!0,...n))}}const Tu={components:{BasicIconName:ju},mixins:[z],props:{type:{type:String,default:"file"},tagName:{type:String,default:"div"},baseWrapper:{type:rn,required:!0},diagnostic:Object},setup(s){return{onClick:Fu((t,i)=>{s.baseWrapper.onClick(i,t)},!0),pointerDevice:Q}},data(){return{isFocused:!1,currentName:"",rules:{required:s=>!!s,validName:s=>/^[^\\/:*?"<>|]*$/.test(s),notSameName:s=>J()==="win32"?s.toUpperCase()!==this.baseWrapper.name.toUpperCase():s!==this.baseWrapper.name}}},computed:{diagnosticIcon(){return this.diagnostic.icon||"mdi-alert-circle"},diagnosticIconColor(){switch(this.diagnostic.type){case"info":return"info";case"warning":return"warning";default:case"error":return"error"}},diagnosticOpacity(){return this.diagnostic&&this.diagnostic.opacity||1},hasDiagnostic(){return this.diagnostic!==void 0&&this.diagnostic!==null}},methods:{onEnter(s){J()==="darwin"?this.baseWrapper.startRename():this.onClick(s)},onFocus(){this.isFocused=!0,!this.baseWrapper.isSelected.value&&this.select()},onKeyDown(s){s.code==="Enter"?this.onEnter(s):J()!=="darwin"&&s.code==="F2"&&this.baseWrapper.startRename(),!(J()==="darwin"&&!s.metaKey)&&(J()!=="darwin"&&!s.ctrlKey||(s.code==="KeyC"?hi(this.baseWrapper).onTrigger():s.code==="KeyV"?mi(this.baseWrapper.kind==="directory"?this.baseWrapper:this.baseWrapper.getParent()).onTrigger():s.code==="Backspace"&&Hs(this.baseWrapper).onTrigger()))},cancelRename(){this.baseWrapper.isEditingName.value=!1},confirmRename(){if(!this.rules.notSameName(this.currentName)){this.cancelRename();return}!this.rules.validName(this.currentName)||this.currentName.length===0||this.baseWrapper.confirmRename(this.currentName)},focus(){this.$refs.name&&this.$refs.name.focus()},select(){this.baseWrapper.unselectAll(),this.baseWrapper.isSelected.value=!0}},watch:{"baseWrapper.isEditingName.value"(){this.baseWrapper.isEditingName.value?this.currentName=this.baseWrapper.name:this.focus()}}};var Au=function(){var e=this,t=e._self._c;return t(e.tagName,{directives:[{name:"ripple",rawName:"v-ripple",value:!e.baseWrapper.isEditingName.value,expression:"!baseWrapper.isEditingName.value"}],ref:"name",tag:"component",staticClass:"directory-viewer-name d-flex justify-center align-center px-1 rounded-lg",class:{selected:e.baseWrapper.isSelected.value,"drag-handle":!e.baseWrapper.isEditingName.value},attrs:{tabindex:"0"},on:{click:function(i){return i.preventDefault(),e.onClick(i)},keydown:[function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"space",32,i.key,[" ","Spacebar"]))return null;i.preventDefault(),e.isFocused&&e.onClick(i)},function(i){return i.stopPropagation(),e.onKeyDown.apply(null,arguments)}],contextmenu:function(i){return i.preventDefault(),i.stopPropagation(),e.baseWrapper.onRightClick(i)},focus:function(i){return i.ctrlKey||i.shiftKey||i.altKey||i.metaKey?null:e.onFocus.apply(null,arguments)},blur:function(i){e.isFocused=!1}}},[e.hasDiagnostic&&!e.baseWrapper.isEditingName.value?t("v-tooltip",{attrs:{color:e.diagnosticIconColor,right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("BasicIconName",e._g({attrs:{name:e.baseWrapper.name,icon:e.diagnosticIcon,color:e.diagnosticIconColor,opacity:e.diagnosticOpacity,showName:!e.baseWrapper.isEditingName.value}},i))]}}],null,!1,2634215617)},[t("span",[e._v(e._s(e.diagnostic?e.t(e.diagnostic.text):""))])]):[t("BasicIconName",{attrs:{name:e.baseWrapper.name,icon:e.baseWrapper.icon,color:e.baseWrapper.color,showName:!e.baseWrapper.isEditingName.value}})],e.baseWrapper.isEditingName.value?t("v-text-field",{style:{position:"relative",top:"-3px"},attrs:{autofocus:"",dense:"","hide-details":"",height:"20px",rules:[e.rules.validName,e.rules.required]},on:{blur:e.cancelRename,keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:(i.stopPropagation(),i.preventDefault(),e.confirmRename.apply(null,arguments))},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"esc",27,i.key,["Esc","Escape"])?null:(i.stopPropagation(),i.preventDefault(),e.cancelRename.apply(null,arguments))}],click:function(i){i.stopPropagation()}},nativeOn:{keydown:function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"space",32,i.key,[" ","Spacebar"]))return null;i.preventDefault(),i.stopPropagation()}},model:{value:e.currentName,callback:function(i){e.currentName=i},expression:"currentName"}}):e._e(),t("v-spacer"),e.isFocused?t("v-icon",{attrs:{color:e.baseWrapper.color}},[e._v(" mdi-circle-small ")]):e._e(),e.pointerDevice==="touch"?t("v-btn",{attrs:{text:"",icon:"",small:""},on:{click:function(i){return i.stopPropagation(),e.baseWrapper.onRightClick(i)}}},[t("v-icon",[e._v(" mdi-dots-vertical-circle-outline ")])],1):e._e()],2)},$u=[],Du=_(Tu,Au,$u,!1,null,"c190a449",null,null);const Gs=Du.exports,Eu={components:{Name:Gs},name:"FileView",props:{fileWrapper:qs},mounted(){this.fileWrapper.getFirstDiagnostic().then(s=>{this.diagnostic=s})},data:()=>({isFocused:!1,diagnostic:void 0})};var Mu=function(){var e=this,t=e._self._c;return t("Name",{attrs:{baseWrapper:e.fileWrapper,diagnostic:e.diagnostic}})},Iu=[],Ou=_(Eu,Mu,Iu,!1,null,null,null,null);const Ru=Ou.exports,Wu=E(!1);const Lu={name:"DirectoryView",components:{Draggable:Wi,FileView:Ru,Name:Gs},props:{directoryWrapper:xe,renderDirectoryName:{default:!0,type:Boolean}},setup(){return{isDraggingWrapper:Wu,pointerDevice:Q}},data:()=>({selectedFromFileDrag:!1,openedFromFileDrag:!1}),computed:{isReadOnly(){return this.directoryWrapper.options.isReadOnly}},methods:{async onDragEnter(s){this.isReadOnly||this.isDraggingWrapper||(s.preventDefault(),s.stopPropagation(),this.select(!0),this.directoryWrapper.kind==="directory"&&!this.directoryWrapper.isOpen.value&&(this.openedFromFileDrag=!0,await this.directoryWrapper.open(!0)))},async onDrop(s){var n,a;if(this.isReadOnly||this.isDraggingWrapper)return;s.preventDefault(),s.stopPropagation(),this.isOpenedFromFileDrag=!1,this.selectedFromFileDrag=!1;const e=Ge.item,t=[...(a=(n=s.dataTransfer)==null?void 0:n.items)!=null?a:[]];if(t.length===0)return;s.preventDefault(),s.stopPropagation();const i=mi(this.directoryWrapper);for(const r of t){const o=await r.getAsFileSystemHandle();!o||(Ge.item=o,await i.onTrigger())}await this.directoryWrapper.refresh(),Ge.item=e},onDragLeave(s){this.isReadOnly||this.isDraggingWrapper||(s.preventDefault(),s.stopPropagation(),this.selectedFromFileDrag&&(this.directoryWrapper.isSelected.value=!1),this.selectedFromFileDrag=!1,this.openedFromFileDrag&&this.directoryWrapper.close(!1))},select(s=!1){s?this.selectedFromFileDrag=!0:this.directoryWrapper.unselectAll(),this.directoryWrapper.isSelected.value=!0},draggedHandle(s){if(s.moved){const{newIndex:e,oldIndex:t,element:i}=s.moved;this.directoryWrapper.children.value.splice(e,1),this.directoryWrapper.children.value.splice(t,0,i)}else s.added&&s.added.element.move(this.directoryWrapper)}}};var Nu=function(){var e=this,t=e._self._c;return t(e.renderDirectoryName?"details":"div",{tag:"component",attrs:{open:e.directoryWrapper.isOpen.value},on:{dragenter:e.onDragEnter,dragleave:e.onDragLeave,drop:e.onDrop}},[e.renderDirectoryName?t("Name",{attrs:{type:"directory",tagName:"summary",baseWrapper:e.directoryWrapper}}):e._e(),e.directoryWrapper.isOpen.value?t("Draggable",{class:{"ml-2":e.renderDirectoryName},attrs:{group:"directory-view",handle:".drag-handle",disabled:e.isReadOnly||e.pointerDevice==="touch"},on:{start:function(i){e.isDraggingWrapper=!0},end:function(i){e.isDraggingWrapper=!1},change:e.draggedHandle},model:{value:e.directoryWrapper.children.value,callback:function(i){e.$set(e.directoryWrapper.children,"value",i)},expression:"directoryWrapper.children.value"}},[e._l(e.directoryWrapper.children.value,function(i,n){return[i.kind==="directory"?t("DirectoryView",{key:`${n}//${i.name}`,attrs:{directoryWrapper:i}}):i.kind==="file"?t("FileView",{key:`${n}//${i.name}`,attrs:{fileWrapper:i}}):t("div",{key:`${n}//${i.name}`},[t("v-icon",{attrs:{color:"error",small:""}},[e._v(" mdi-alert-circle-outline ")]),e._v(' Unknown directory entry kind: "'+e._s(i.kind)+'" ')],1)]})],2):e._e()],1)},Bu=[],Vu=_(Lu,Nu,Bu,!1,null,"6146b46b",null,null);const Hu=Vu.exports,Uu={components:{DirectoryView:Hu},props:{directoryHandle:{required:!0},renderTopLevelDirectory:Boolean,options:Object},setup(s){const e=E(null);return s.directoryHandle instanceof xe?e.value=s.directoryHandle:Js.getDirectory(s.directoryHandle,s.options).then(t=>{e.value=t}),{directoryWrapper:e}}};var zu=function(){var e=this,t=e._self._c;return e.directoryWrapper?t("DirectoryView",{staticClass:"mx-1",attrs:{directoryWrapper:e.directoryWrapper,renderDirectoryName:e.renderTopLevelDirectory}}):t("v-progress-linear",{attrs:{indeterminate:""}})},qu=[],Ju=_(Uu,zu,qu,!1,null,null,null,null);const wi=Ju.exports;const Gu={name:"BridgeSheet",props:{dark:Boolean,isLoading:Boolean},computed:{nonClickListeners(){return Object.fromEntries(Object.entries(this.$listeners).filter(([s,e])=>s!=="click"))},hasClickListener(){return!!this.$listeners.click}}};var Ku=function(){var e=this,t=e._self._c;return t("div",e._g({directives:[{name:"ripple",rawName:"v-ripple",value:e.hasClickListener&&!e.isLoading,expression:"hasClickListener && !isLoading"}],staticClass:"rounded-lg",class:{"bg-dark":e.dark,bg:!e.dark},on:{click:function(i){e.isLoading||e.$emit("click")}}},e.nonClickListeners),[e.isLoading?t("v-progress-circular",{attrs:{color:"accent",indeterminate:""}}):e._t("default")],2)},Yu=[],Qu=_(Gu,Ku,Yu,!1,null,"ce3c4e27",null,null);const Ne=Qu.exports,Zu=({uiStore:s})=>({...s==null?void 0:s.UI,BuiltIn:{BaseWindow:de,SidebarWindow:gt,DirectoryViewer:wi,BridgeSheet:Ne}}),Xu=({disposables:s})=>({create(e){const t=li(e);return s.push(t),t},createError(e){const t=Oe(e);return s.push(t),t}}),eh=({disposables:s})=>new Promise(e=>{l.ready.once(t=>{const i={onBridgeFolderSetup:n=>{s.push(t.bridgeFolderSetup.once(n,!0))}};for(const n of Object.getOwnPropertyNames(Object.getPrototypeOf(t.fileSystem)))n!=="constructor"&&typeof t.fileSystem[n]=="function"&&(i[n]=t.fileSystem[n].bind(t.fileSystem));e(i)})}),th=({})=>({APP_VERSION:we,isNightlyBuild:Ae,getCurrentBP(){return`${l.instance.project.projectPath}/BP`},getCurrentRP(){return`${l.instance.project.projectPath}/RP`},getCurrentProject(){return l.instance.project.projectPath},getProjectPrefix(){return l.getApp().then(s=>s.projectConfig.get().namespace)},getProjectTargetVersion(){return l.getApp().then(s=>s.projectConfig.get().targetVersion)},getProjectAuthor(){return l.getApp().then(s=>s.projectConfig.get().author)},getContext(){return console.warn("This API is deprecated!"),{}}}),ih=({})=>({openExternal:s=>window.open(s,"_blank")}),nh=()=>Io,sh=({})=>({fetchDefinition:async(s,e,t,i=!1)=>{var o;const a=(o=(await l.getApp()).project)==null?void 0:o.packIndexer;return a?(await Promise.all(e.map(c=>{var d,p;return(p=(d=a.service)==null?void 0:d.find(s,c,[t],i))!=null?p:[]}))).flat():[]}});function ah(s,e={},t=!0,i=()=>{}){const n={};n.done=new Promise(c=>{n.setDone=c});const a=D(),r=Dt(Object.assign(e,{isVisible:!1,shouldRender:!1})),o={component:s,getState:()=>r,close:()=>{i(),r.isVisible=!1,setTimeout(()=>{r.shouldRender=!1,t&&o.dispose()},600)},open:()=>{r.shouldRender=!0,r.isVisible=!0},dispose:()=>Ee(l.windowState.state,a),status:n,get isVisible(){return r.isVisible}};return V(l.windowState.state,a,o),o}const rh=X({__name:"Dropdown",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState();function n(){e.window.close()}function a(){e.window.close()}return{__sfc:!0,t,props:e,state:i,onClose:n,onConfirm:a,BaseWindow:de,pointerDevice:Q}}});var oh=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,isPersistent:!e.window.isClosable,hasCloseButton:!1,width:440,height:140},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("v-select",{staticClass:"mt-4",attrs:{autofocus:i.pointerDevice==="mouse",outlined:"",dense:"",items:e.window.options,"background-color":"background"},model:{value:i.state.currentSelection,callback:function(n){e.$set(i.state,"currentSelection",n)},expression:"state.currentSelection"}})]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary",disabled:!i.state.currentSelection},on:{click:i.onConfirm}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(e._s(i.t("general.confirm")))])],1)]},proxy:!0}],null,!1,3324206528)}):e._e()},ch=[],lh=_(rh,oh,ch,!1,null,null,null,null);const dh=lh.exports;class pt extends Y{constructor(e){var t;super(dh,!0,!1),this.opts=e,this.state=G({...super.state,currentSelection:void 0}),this.state.currentSelection=(t=e.default)!=null?t:void 0,this.defineWindow(),this.open()}get title(){return this.opts.name}get options(){return this.opts.options}get placeholder(){return this.opts.placeholder}get isClosable(){return this.opts.isClosable}async confirm(){var e;typeof this.opts.onConfirm=="function"&&await this.opts.onConfirm(this.state.currentSelection),super.close((e=this.state.currentSelection)!=null?e:null)}}const ph=({})=>({NewBaseWindow:Y,createWindow:(s,e)=>(console.warn('[@bridge/windows] Calling "createWindow" is deprecated. Please replace direct function calls by defining a class based window instead.'),ah(s,e)),createInformationWindow:(s,e)=>new U({name:s,description:e}),createInputWindow:(s,e,t,i,n)=>new Mi({name:s,label:e,default:t,expandText:n,onConfirm:i}),createDropdownWindow:(s,e,t,i,n)=>new pt({name:s,default:i,options:t,placeholder:e,onConfirm:n}),createConfirmWindow:(s,e,t,i,n)=>new W({description:s,confirmText:e,cancelText:t,onConfirm:i,onCancel:n})});let Ht;const uh=async({})=>{try{if(Ht===void 0)return new Promise(s=>{l.ready.once(async e=>{Ht=await e.fileSystem.readJSON(`${e.project.projectPath}/globals.json`).catch(()=>{}),s(Ht)})})}catch{return{}}return{...Ht}};class Le extends H{constructor(){super(...arguments),this.id=D(),this.type="divider"}}class Be extends H{constructor(e,t){super(),this.icon=e,this.name=t,this.id=D(),this.type="category",this.shouldRender=!0,this.isVisible=!1,this.state=G({}),this.disposables={},l.getApp().then(i=>{i.mobile.change.on(n=>this.setShouldRender(!n))})}setShouldRender(e){this.shouldRender=e}addItem(e){return V(this.state,e.id,e),this.disposables[e.id]=e.on(()=>this.trigger()),this}disposeItem(e){var t;Ee(this.state,e.id),(t=this.disposables[e.id])==null||t.dispose(),this.disposables[e.id]=void 0}toNestedMenu(){return{type:"submenu",icon:this.icon,name:this.name,actions:Object.values(this.state).map(e=>{if(e instanceof hs)return{...e.getConfig(),description:void 0,keyBinding:void 0};if(e instanceof Be)return null;if(e instanceof Le)return{type:"divider"};throw new Error(`Unknown toolbar item type: ${e}`)})}}trigger(){this.isVisible=!1,this.dispatch()}dispose(){l.toolbar.disposeCategory(this)}}const hh=async({disposables:s})=>({ToolbarCategory:Be,actionManager:(await l.getApp()).actionManager,addCategory(e){l.toolbar.addCategory(e),s.push(e)}}),fh=()=>({compare:ne}),mh=({disposables:s})=>({registerDocumentFormattingEditProvider:async(e,t)=>{const{languages:i}=await L();s.push(i.registerDocumentFormattingEditProvider(e,t))}}),gh=()=>({parse:s=>R.parse(s),stringify:(s,e,t)=>JSON.stringify(s,e,t)}),wh=async({})=>{const s=await l.getApp();return{setup:s.comMojang.setup,requestFileSystem:async()=>{const e={};for(const t of Object.getOwnPropertyNames(Object.getPrototypeOf(s.comMojang.fileSystem)))t!=="constructor"&&typeof s.comMojang.fileSystem[t]=="function"&&(e[t]=s.comMojang.fileSystem[t].bind(s.comMojang.fileSystem));return e}}},yh={name:"ThreePreviewTab",props:{tab:Object},activated(){this.tab.receiveCanvas(this.$refs.canvas)},mounted(){this.tab.receiveCanvas(this.$refs.canvas)},watch:{"tab.uuid"(){this.tab.receiveCanvas(this.$refs.canvas)}}};var vh=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{position:"relative"}},[t("div",{staticStyle:{width:"100%",height:"100%"},on:{click:function(i){return e.tab.parent.setActive(!0)}}},[t("canvas",{ref:"canvas"})])])},bh=[],_h=_(yh,vh,bh,!1,null,null,null,null);const Sh=_h.exports;class Ch extends ht{constructor(e,t){super(t),this.tab=e,this.isForeignFile=!0,this.onCreate()}static is(){return!1}onCreate(){}async onActivate(){this.onChange(),this.isActive=!0}get name(){return`${B("preview.name")}: ${this.tab.name}`}save(){}getFile(){return this.tab.getFile()}}class ln extends Ch{constructor(){super(...arguments),this.component=Sh,this.setupComplete=new $,this.disposables=[],this.renderingRequested=!1,this.width=0,this.height=0}get scene(){if(!this._scene)throw new Error("Scene is not defined yet");return this._scene}get camera(){if(!this._camera)throw new Error("Camera is not defined yet");return this._camera}async is(){return!1}async receiveCanvas(e){var i;const t=await l.getApp();this.canvas=k(e),this.renderer=k(new Ka({antialias:!0,canvas:e})),this.renderer.setPixelRatio(window.devicePixelRatio),this._camera||(this._camera=k(new Ya(70,2,.1,1e3)),this._camera.position.x=-16,this._camera.position.y=16,this._camera.position.z=-16),(i=this.controls)==null||i.dispose(),this.controls=k(new Qa(this.camera,e)),this.controls.addEventListener("change",()=>{this.requestRendering(),this.parent.isActive||this.parent.setActive(!0)}),this._scene||(this._scene=k(new Za),this._scene.add(new Xa(16777215))),this._scene.background=new kt(t.themeManager.getColor("background")),this.disposables.push(t.windowResize.on(()=>setTimeout(()=>this.onResize()))),this.onResize(),await this.fired,this.setupComplete.dispatch()}async onActivate(){await this.setupComplete.fired,await super.onActivate();const e=await l.getApp();this.disposables.push(e.themeManager.on(()=>{const t=e.themeManager.getColor("background");this.scene.background=new kt(t),this.requestRendering()}))}onDeactivate(){var e,t,i;this.setupComplete.resetSignal(),(e=this.controls)==null||e.dispose(),(t=this.renderer)==null||t.resetState(),(i=this.renderer)==null||i.dispose(),this.renderer=void 0,this.controls=void 0,super.onDeactivate()}render(){var e,t;(e=this.controls)==null||e.update(),(t=this.renderer)==null||t.render(this.scene,this.camera),this.renderingRequested=!1}async requestRendering(){this.renderingRequested||(this.renderingRequested=!0,await this.setupComplete.fired,requestAnimationFrame(()=>this.render()))}onResize(){var t,i,n,a,r;const e=(i=(t=this.canvas)==null?void 0:t.parentElement)==null?void 0:i.getBoundingClientRect();this.width=(n=e==null?void 0:e.width)!=null?n:0,this.height=(a=e==null?void 0:e.height)!=null?a:0,(r=this.renderer)==null||r.setSize(this.width,this.height,!0),this.camera&&(this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix()),this.requestRendering()}async toOtherTabSystem(e){await super.toOtherTabSystem(e),await this.setupComplete.fired,this.onResize()}}const kh=async({disposables:s})=>{const e=await l.getApp(),t=()=>e.project;return{ContentTab:ht,FileTab:O,ThreePreviewTab:ln,IframeTab:He,register:i=>{const n=Xi.register(i);return s.push(n),n},openTab:async(i,n=!1)=>{const a=n?t().inactiveTabSystem:t().tabSystem;if(!a)return;const r=new i(a);return n&&a.setActive(!0),s.push({dispose:()=>a.remove(r)}),r},addTab(i){const n=t().tabSystem;!n||(n.add(i,!0),s.push({dispose:()=>n.remove(i)}))},getCurrentTabSystem(){return t().tabSystem},openFilePath:async(i,n=!1)=>{const a=await t().fileSystem.getFileHandle(i);await t().openFile(a,{selectTab:n})}}};function Ln({isGlobal:s,func:e,disposables:t,app:i}){s?t.push(i.projectManager.forEachProject(e)):e(i.project)}const xh=async({disposables:s,isGlobal:e})=>({addTabActions:async t=>{(await l.getApp()).project.tabActionProvider.addTabActions(t)},register:async t=>{const i=await l.getApp();Ln({app:i,disposables:s,isGlobal:e,func:n=>{s.push(n.tabActionProvider.register(t))}})},registerPreview:async t=>{const i=await l.getApp();Ln({app:i,disposables:s,isGlobal:e,func:n=>{s.push(n.tabActionProvider.registerPreview(t))}})}}),Ph=async({disposables:s})=>{const e=await l.getApp(),t=e.themeManager;return{onChange:i=>{const n=t.on(i);return s.push(n),n},getCurrentMode(){return e.themeManager.getCurrentMode()},getColor(i){return t.getColor(i)},getHighlighterInfo(i){return t.getHighlighterInfo(i)}}};class Nn{constructor(e){this.config=e}get displayData(){return{icon:this.config.icon,name:this.config.name}}isDisabled(){if(typeof this.config.isDisabled=="function")return this.config.isDisabled()}export(){if(typeof this.config.export=="function")return this.config.export()}}const jh=async({disposables:s,isGlobal:e})=>{const t=await l.getApp();return{hasPacks(i){return t.project.hasPacks(i)},registerExporter(i){e?t.projectManager.forEachProject(n=>{s.push(n.exportProvider.register(new Nn(i)))}):s.push(t.project.exportProvider.register(new Nn(i)))},async compile(i){await(await t.project.createDashService("production",i==="default"?void 0:`${t.project.projectPath}/.bridge/compiler/${i}`)).build()},async compileFiles(i){await t.project.compilerService.updateFiles(i)},async unlinkFile(i){await t.project.unlinkFile(i)},onProjectChanged(i){const n=l.eventSystem.on("projectChanged",a=>i(a.name));return s.push(n),n},onFileChanged(i,n){const a=l.eventSystem.on("fileChange",([r,o])=>{r===i&&n(o)});return s.push(a),a},async openFile(i,n){await t.project.openFile(i,n)}}},Fh=()=>ue(()=>import("./vendor.ed651d0f.js").then(s=>s.b4),["assets/vendor.ed651d0f.js","assets/vendor.fa5a5182.css"]);async function ti(){return await ue(()=>import("./model-viewer.es.3645879b.js"),["assets/model-viewer.es.3645879b.js","assets/vendor.ed651d0f.js","assets/vendor.fa5a5182.css","assets/wintersky.esm.fee2c54d.js"])}const Th=async()=>{const{Model:s,StandaloneModelViewer:e}=await ti();return{Model:s,StandaloneModelViewer:e}},Ah=({disposables:s})=>({addFolderImporter:async e=>{const t=await l.getApp();s.push(t.folderImportManager.addImporter(e))},async importHandle(e){await(await l.getApp()).fileDropper.import(e)},registerOpenWithHandler:e=>{Ei.add(e);const t={dispose:()=>{Ei.delete(e)}};return s.push(t),t}}),$h=()=>ue(()=>import("./vendor.ed651d0f.js").then(s=>s.b3),["assets/vendor.ed651d0f.js","assets/vendor.fa5a5182.css"]),Dh=new Map([["@bridge/ui",Zu],["@bridge/sidebar",wp],["@bridge/notification",Xu],["@bridge/fs",eh],["@bridge/path",nh],["@bridge/env",th],["@bridge/project",jh],["@bridge/globals",uh],["@bridge/utils",ih],["@bridge/fetch-definition",sh],["@bridge/windows",ph],["@bridge/toolbar",hh],["@bridge/compare-versions",fh],["@bridge/monaco",mh],["@bridge/json5",gh],["@bridge/com-mojang",wh],["@bridge/tab",kh],["@bridge/tab-actions",xh],["@bridge/theme",Ph],["@bridge/three",Fh],["@bridge/model-viewer",Th],["@bridge/import",Ah],["@bridge/persistent-storage",dd],["@bridge/command-bar",Eo],["@bridge/fflate",$h]]);function Eh(s,e=[],t,i=!1,n=Dh){return[...n.entries()].map(([a,r])=>[a,()=>r({extensionId:s,disposables:e,uiStore:t,isGlobal:i})])}function Mh(s,e=[],t,i=!1){return Eh(s,e,t,i)}class Ih{constructor(e,t,i,n=!1){var a;this.parent=e,this._manifest=t,this.baseDirectory=i,this._isGlobal=n,this.disposables=[],this.uiStore=zl(),this._compilerPlugins={},this.isLoaded=!1,this.hasPresets=!1,this.jsRuntime=new Xt(Mh(this.id,this.disposables,this.uiStore,this.isGlobal)),this.fileSystem=new Z(this.baseDirectory),this.installFiles=new ld(this.fileSystem,(a=t==null?void 0:t.contributeFiles)!=null?a:{})}get isActive(){var e;if(!this.parent.activeStatus)throw new Error("Accessed activeStatus property before the corresponding ActiveClass instance was initialized");return(e=this.parent.activeStatus)==null?void 0:e.isActive(this.manifest.id)}get compilerPlugins(){return this._compilerPlugins}get contributesCompilerPlugins(){var e,t,i;return Object.keys((i=(t=(e=this.manifest)==null?void 0:e.compiler)==null?void 0:t.plugins)!=null?i:{}).length>0}get description(){return this.manifest.description}get version(){return this.manifest.version}get isGlobal(){return this._isGlobal}get id(){return this.manifest.id}get manifest(){return this._manifest}isCompatibleAppEnv(){return this.manifest.compatibleAppVersions?(this.manifest.compatibleAppVersions.min&&ne(we,this.manifest.compatibleAppVersions.min,">=")||!this.manifest.compatibleAppVersions.min)&&(this.manifest.compatibleAppVersions.max&&ne(we,this.manifest.compatibleAppVersions.max,"<")||!this.manifest.compatibleAppVersions.max):!0}async activate(){var a,r,o,c;if(this.isLoaded||!this.isCompatibleAppEnv())return;this.isLoaded=!0;const e=await l.getApp(),t=((a=await e.fileSystem.baseDirectory.resolve(this.baseDirectory))!=null?a:[]).join("/");for(const d of(r=this.manifest.dependencies)!=null?r:[])if(!await this.parent.activate(d)){Oe(new Error(`Failed to activate extension "${this.manifest.name}": Failed to load one of its dependencies`));return}if(!this.isGlobal){const d=l.instance.extensionLoader;d.has(this.id)&&d.deactivate(this.id)}for(const[d,p]of Object.entries((c=(o=this.manifest.compiler)==null?void 0:o.plugins)!=null?c:{}))this._compilerPlugins[d]=`${t}/${p}`;await this.fileSystem.fileExists("presets.json")?(this.hasPresets=!0,l.eventSystem.dispatch("presetsChanged",null),this.disposables.push(e.windows.createPreset.addPresets(`${t}/presets.json`))):await this.fileSystem.directoryExists("presets")&&(this.hasPresets=!0,this.disposables.push(e.windows.createPreset.addPresets(`${t}/presets`)),l.eventSystem.dispatch("presetsChanged",null));try{await ce(await this.baseDirectory.getDirectoryHandle("themes"),d=>e.themeManager.loadTheme(d,this.isGlobal,this.disposables))}catch{}try{await cd(await this.baseDirectory.getDirectoryHandle("fileDefinitions"),this.disposables)}catch{}let i=null;try{i=await this.baseDirectory.getDirectoryHandle("scripts")}catch{}let n=null;try{n=await this.baseDirectory.getDirectoryHandle("ui")}catch{}if(n&&await Hl(this.jsRuntime,n,this.uiStore,this.disposables),i&&await ql(this.jsRuntime,i),await this.fileSystem.directoryExists("snippets")){const d=await this.baseDirectory.getDirectoryHandle("snippets");this.isGlobal?this.disposables.push(e.projectManager.onActiveProject(async p=>{this.disposables.push(...await p.snippetLoader.loadFrom(d))})):this.disposables.push(...await e.project.snippetLoader.loadFrom(d))}await this.fileSystem.fileExists(".installed")||(await this.installFiles.execute(this.isGlobal),await this.fileSystem.writeFile(".installed",""))}async resetInstalled(){await this.fileSystem.unlink(".installed")}deactivate(){if(this.hasPresets&&l.eventSystem.dispatch("presetsChanged",null),this.disposables.forEach(e=>e.dispose()),this.jsRuntime.clearCache(),this.isLoaded=!1,!this.isGlobal){const e=l.instance.extensionLoader;e.has(this.id)&&e.activate(this.id)}}async delete(){this.deactivate(),await Jt.del(this.id),this.parent.deleteExtension(this.manifest.id)}async setActive(e){var t;e?await this.activate():this.deactivate(),await((t=this.parent.activeStatus)==null?void 0:t.setActive(this.manifest.id,e))}forStore(e){const t=new Is(e,this.manifest,!0);return t.setInstalled(),t.setConnected(this),t}async installFilesToCurrentProject(){await this.installFiles.execute(!1)}}class Oh extends ${constructor(e,t){super(),this.fileSystem=e,this.savePath=t,this.inactiveExtensions=new Set,this.loadFile().finally(()=>this.dispatch())}async loadFile(){try{this.inactiveExtensions=new Set(await this.fileSystem.readJSON(this.savePath))}catch{}}async save(){await this.fileSystem.writeJSON(this.savePath,[...this.inactiveExtensions])}async setActive(e,t){t?this.inactiveExtensions.delete(e):this.inactiveExtensions.add(e),await this.save()}isActive(e){return!this.inactiveExtensions.has(e)}}class Ks extends ${constructor(e,t,i,n=!1){super(),this.fileSystem=e,this.loadExtensionsFrom=t,this.saveInactivePath=i,this.isGlobal=n,this._extensions=new Map,this.extensionPaths=new Map,this._loadedInstalledExtensions=new $(2)}get extensions(){return this._extensions}async loadActiveExtensions(){this.activeStatus=new Oh(this.fileSystem,this.saveInactivePath),await this.activeStatus.fired}async getInstalledExtensions(){return await this.fired,new Set(this.extensions.values())}async loadExtensions(e=this.loadExtensionsFrom){const t=await this.fileSystem.getDirectoryHandle(e,{create:!0});await this.loadActiveExtensions();const i=[];for await(const n of t.values())n.name!==".DS_Store"&&i.push(this.loadExtension(t,n,!1));await Promise.all(i),this._loadedInstalledExtensions.dispatch();for(const[n,a]of this._extensions)a.isActive&&await a.activate();this.dispatch()}async loadExtension(e,t,i=!1){let n;return t.kind==="file"&&t.name.endsWith(".zip")?(n=await this.unzipExtension(t,await e.getDirectoryHandle(t.name.replace(".zip",""),{create:!0})),await e.removeEntry(t.name)):t.kind==="directory"&&(n=await this.loadManifest(t)),i&&n&&await n.activate(),n}async unzipExtension(e,t){const i=new Z(t),n=await e.getFile(),a=await new Promise(async(r,o)=>Ni(new Uint8Array(await n.arrayBuffer()),(c,d)=>{c?o(c):r(d)}));for(const r in a)if(!r.startsWith(".")){if(r.endsWith("/")){await i.mkdir(r.slice(0,-1),{recursive:!0});continue}await i.writeFile(r,a[r])}return await this.loadManifest(t)}async loadManifest(e){var a;let t;try{t=await e.getFileHandle("manifest.json")}catch{return}const n=await(await t.getFile()).text().then(r=>JSON.parse(r));if(n.id){const r=new Ih(this,n,e,this.isGlobal);return this._extensions.set(n.id,r),this.extensionPaths.set(n.id,`${this.loadExtensionsFrom}/${e.name}`),r}else Oe(new Error(`Failed to load extension "${(a=n.name)!=null?a:e.name}": Invalid extension ID`))}async activate(e){const t=this.extensions.get(e);return t?(t.isActive&&await t.activate(),!0):(Oe(new Error(`Failed to activate extension with ID "${e}": Extension not found`)),!1)}deactivate(e){const t=this.extensions.get(e);return t?(t.deactivate(),!0):(Oe(new Error(`Failed to deactivate extension with ID "${e}": Extension not found`)),!1)}has(e){return this.extensions.has(e)}deactiveAll(e=!1){for(const[t,i]of this._extensions)i.deactivate(),e&&this._extensions.delete(t)}disposeAll(){this.deactiveAll(!0),this.resetSignal()}deleteExtension(e){const t=this.extensionPaths.get(e);t&&(this.fileSystem.unlink(t),this.extensionPaths.delete(e),this.extensions.delete(e))}mapActive(e){const t=[];for(const i of this._extensions.values())i.isActive&&t.push(e(i));return t}}class Ys{constructor(e=[],t=!1){this.autoCleanEmptyDispatchers=t,this.events=new Map,this.any=new H,e.forEach(i=>this.create(i))}create(e){if(this.events.get(e)!==void 0)throw new Error(`Dispatcher for event "${e}" is already defined.`);return this.events.set(e,new H),{dispose:()=>{this.events.delete(e)}}}hasEvent(e){return this.events.has(e)}getDispatcher(e){const t=this.events.get(e);if(t===void 0)throw new Error(`No dispatcher defined for event "${e}".`);return t}dispatch(e,t){return this.any.dispatch([e,t]),this.getDispatcher(e).dispatch(t)}on(e,t){const i=this.getDispatcher(e),n=i.on(t);return{dispose:()=>{n.dispose(),this.autoCleanEmptyDispatchers&&!i.hasListeners&&this.events.delete(e)}}}off(e,t){const i=this.getDispatcher(e);i.off(t),this.autoCleanEmptyDispatchers&&!i.hasListeners&&this.events.delete(e)}once(e,t){const i=this.getDispatcher(e);i.once(n=>{t(n),this.autoCleanEmptyDispatchers&&!i.hasListeners&&this.events.delete(e)})}}class ki extends Ys{constructor(){super([],!0)}dispatch(e,t){this.any.dispatch([e,t]),this.hasEvent(e)&&super.dispatch(e,t)}on(e,t){return this.hasEvent(e)||this.create(e),super.on(e,t)}}class Rh{constructor(){this.definitions=new Set,this.processedFileTabs=new Set}register(e){return this.definitions.add(e),this.processedFileTabs.forEach(t=>{e.isFor(t)&&t.addAction(new M({icon:e.icon,name:e.name,isDisabled:()=>{var i,n;return(n=(i=e.isDisabled)==null?void 0:i.call(e,t))!=null?n:!1},onTrigger:()=>e.trigger(t)}))}),{dispose:()=>{this.definitions.delete(e),this.processedFileTabs.forEach(t=>{e.isFor(t)&&(t.clearActions(),this.addTabActions(t))})}}}registerPreview(e){return this.register({icon:"mdi-play",name:e.name,isFor:t=>{if(t instanceof O){if(e.fileType)return t.getFileType()===e.fileType;if(e.fileMatch)return t.getProjectPath().startsWith(e.fileMatch)}else return!1;return!1},trigger:async t=>{var a,r;const i=await l.getApp(),n=await e.createPreview(i.project.inactiveTabSystem,t);!n||(n.isTemporary=!1,t.connectedTabs.push(n),(a=i.project.inactiveTabSystem)==null||a.add(n,!0),(r=i.project.inactiveTabSystem)==null||r.setActive(!0))}})}async addTabActions(e){this.processedFileTabs.add(e),e.onClose.on(()=>this.processedFileTabs.delete(e));for(const t of this.definitions)await t.isFor(e)&&e.addAction(new M({icon:t.icon,name:t.name,onTrigger:()=>t.trigger(e)}))}}class Wh{constructor({name:e,description:t,fileTypes:i,locations:n,data:a,targetFormatVersion:r}){this.name=e,this.description=t,this.fileTypes=new Set(i),this.locations=n!=null?n:[],this.data=a,this.minTargetFormatVersion=r==null?void 0:r.min,this.maxTargetFormatVersion=r==null?void 0:r.max}get displayData(){return{name:this.name,description:this.description}}get insertData(){return[this.name,this.data]}get insertText(){return typeof this.data=="string"?this.data:Array.isArray(this.data)?this.data.join(`
`):JSON.stringify(this.data,null,"	").slice(1,-1).replaceAll(`
	`,`
`).trim()}isValid(e,t,i){return(typeof e!="string"||(!this.minTargetFormatVersion||ne(e,this.minTargetFormatVersion,">="))&&(!this.maxTargetFormatVersion||ne(e,this.maxTargetFormatVersion,"<=")))&&this.fileTypes.has(t)&&(this.locations.length===0||this.locations.some(a=>i.some(r=>a===r||(a!==""?ai(r,a):!1))))}}class Lh{constructor(e){this.project=e,this.snippets=new Set}async activate(){const i=await(await(await l.getApp()).project.getCurrentDataPackage()).getDirectoryHandle("snippet",{create:!0});await this.loadFrom(i)}async loadFrom(e){const t=[];return await ce(e,async(i,n)=>{let a;try{a=R.parse(await i.getFile().then(r=>r.text()))}catch{console.error(`Invalid JSON within snippet "${n}"`);return}t.push(this.addSnippet(new Wh(a)))}),t}async deactivate(){this.snippets.clear()}addSnippet(e){return this.snippets.add(e),{dispose:()=>{this.snippets.delete(e)}}}getSnippetsFor(e,t,i){return[...this.snippets].filter(n=>n.isValid(e,t,i))}}class Nh{constructor(){this.exports=new Set}register(e){return this.exports.add(e),{dispose:()=>this.exports.delete(e)}}async getExporters(){return await Promise.all([...this.exports].map(async e=>({...e.displayData,isDisabled:await e.isDisabled(),onTrigger:()=>e.export()})))}}function Bh(s){let e=s.map(n=>n.split("/").reverse());const t=e.map(()=>null),i=e.map(()=>0);if(!s.every(n=>n.split("/").reverse()[0]===s[0].split("/").reverse()[0]))throw new Error("All files must have the same name");for(;i.some((n,a)=>n<e[a].length);){const n=e.map((r,o)=>r[i[o]]);n.every(r=>r===n[0])||t.forEach((r,o)=>{r===null&&(t[o]=n[o])}),i.forEach((r,o)=>{r<e[o].length&&i[o]++})}return t}class Qs extends er{constructor(e){super(e,ai),this.ready=new $,this.lCacheFiles={},this.lCacheFilesLoaded=new $,this.packSpiderFiles={},this.packSpiderFilesLoaded=new $}setProjectConfig(e){this.projectConfig=e}async setup(e){this.fileTypes.length>0||(await e.fired,this.fileTypes=await e.readJSON("data/packages/minecraftBedrock/fileDefinitions.json"),this.loadLightningCache(e),this.loadPackSpider(e),this.ready.dispatch())}getMonacoSchemaEntries(){return this.fileTypes.map(({detect:e={},schema:t})=>{if(!e.matcher)return null;const i=(e==null?void 0:e.packType)===void 0?[]:Array.isArray(e==null?void 0:e.packType)?e==null?void 0:e.packType:[e==null?void 0:e.packType];return{fileMatch:this.prefixMatchers(i,Array.isArray(e.matcher)?[...e.matcher]:[e.matcher]).map(n=>encodeURI(n).replaceAll(/;|,|@|&|=|\+|\$|\.|!|'|\(|\)|#/g,"*")),uri:t}}).filter(e=>e!==null).flat()}async loadLightningCache(e){var n;const t=await e.readJSON("data/packages/minecraftBedrock/lightningCaches.json"),i=a=>Object.entries(t).find(([r])=>r.endsWith(a));for(const a of this.fileTypes){if(!a.lightningCache)continue;const[r,o]=(n=i(a.lightningCache))!=null?n:[];if(!r)throw new Error(`Lightning cache file "${a.lightningCache}" for file type "${a.id}" not found`);this.lCacheFiles[a.lightningCache]=o}this.lCacheFilesLoaded.dispatch()}async getLightningCache(e){var i,n;const{lightningCache:t}=(i=this.get(e))!=null?i:{};return t?(await this.lCacheFilesLoaded.fired,(n=this.lCacheFiles[t])!=null?n:[]):[]}async loadPackSpider(e){const t=await e.readJSON("data/packages/minecraftBedrock/packSpiders.json");this.packSpiderFiles=Object.fromEntries(this.fileTypes.map(({id:i,packSpider:n})=>{if(!!n)return[i,t[`file:///data/packages/minecraftBedrock/packSpider/${n}`]]}).filter(i=>i!==void 0)),this.packSpiderFilesLoaded.dispatch()}async getPackSpiderData(){return await this.packSpiderFilesLoaded.fired,this.packSpiderFiles}}function Vh(){return new Worker("/assets/Service.214db5c9.js")}const Hh=new Vh,Uh=Li(Hh),Ke="bridge-temp-project";class zh{constructor(e,t,i,{requiresPermissions:n}={}){this.parent=e,this.app=t,this._baseDirectory=i,this.compilerReady=new $,this.jsonDefaults=k(new Wl(this)),this.fileChange=new ki,this.fileSave=new ki,this.fileUnlinked=new ki,this.tabActionProvider=new Rh,this.snippetLoader=new Lh(this),this.exportProvider=new Nh,this.isVirtualProject=Ke===this.name,this.requiresPermissions=n!=null?n:!1,this._fileSystem=k(new Z(i)),this.config=k(new Fl(this._fileSystem,this.projectPath,this)),this.fileTypeLibrary=k(new Qs(this.config)),this.packIndexer=k(new Il(this,i)),this.extensionLoader=k(new Ks(t.fileSystem,`${this.projectPath}/.bridge/extensions`,`${this.projectPath}/.bridge/inactiveExtensions.json`)),this.typeLoader=k(new Ll(this.app.dataLoader)),this.fileChange.any.on(a=>l.eventSystem.dispatch("fileChange",a)),this.fileSave.any.on(a=>l.eventSystem.dispatch("fileSave",a)),this.fileUnlinked.any.on(a=>l.eventSystem.dispatch("fileUnlinked",a[0])),this.tabSystems=[k(new En(this)),k(new En(this,1))],this.createDashService("development").then(a=>{this._compilerService=k(a),this.compilerReady.dispatch()}),setTimeout(()=>this.onCreate(),0)}get projectData(){return this._projectData}get name(){return this.baseDirectory.name}get tabSystem(){if(this.tabSystems[0].isActive)return this.tabSystems[0];if(this.tabSystems[1].isActive)return this.tabSystems[1]}get inactiveTabSystem(){if(!this.tabSystems[0].isActive)return this.tabSystems[0];if(!this.tabSystems[1].isActive)return this.tabSystems[1]}get baseDirectory(){return this._baseDirectory}get fileSystem(){return this._fileSystem}get isActiveProject(){return this.name===this.parent.selectedProject}get compilerService(){if(this._compilerService===void 0)throw console.log(this._compilerService,this._compilerService===void 0),new Error("Trying to access compilerService before it was setup. Make sure to await compilerReady.fired before accessing it.");return this._compilerService}get watchModeActive(){var e,t;return((t=(e=S.compiler)==null?void 0:e.watchModeActive)!=null?t:!0)&&!this.isVirtualProject&&!A.value}get projectPath(){return this.requiresPermissions?`projects/${this.name}`:`~local/projects/${this.name}`}get bpUuid(){var e,t;return(t=(e=this.projectData.contains)==null?void 0:e.find(i=>i.id==="behaviorPack"))==null?void 0:t.uuid}get isLocal(){return!this.requiresPermissions}async createDashService(e,t){this.isVirtualProject||await this.app.comMojang.fired;const i=await new Uh(this.app.fileSystem.baseDirectory,this.app.comMojang.hasComMojang?this.app.comMojang.fileSystem.baseDirectory:void 0,{config:`${this.projectPath}/config.json`,compilerConfig:t,mode:e,projectName:this.name,pluginFileTypes:this.fileTypeLibrary.getPluginFileTypes()});return i.on(st(async()=>{const n=this.app.taskManager.create({icon:"mdi-cogs",name:"taskManager.tasks.compiler.title",description:"taskManager.tasks.compiler.description",totalTaskSteps:100});i.onProgress(st(a=>{a===1?n.complete():n.update(100*a)}))}),!1),i}async activate(e=!1){var r,o,c;if(l.fileType.setProjectConfig(this.config),l.packType.setProjectConfig(this.config),this.parent.title.setProject(this.name),this.parent.activatedProject.dispatch(this),await this.fileTypeLibrary.setup(this.app.dataLoader),await this.compilerReady.fired,!e)for(const d of this.tabSystems)await d.activate();await this.extensionLoader.loadExtensions();const t=(r=this.tabSystem)==null?void 0:r.selectedTab;this.typeLoader.activate(t instanceof O?t.getPath():void 0),await this.app.dataLoader.fired,await Promise.all([this.packIndexer.activate(e),this.compilerService.setup()]);const[i,n]=await this.packIndexer.fired,a=((c=(o=S.compiler)==null?void 0:o.autoFetchChangedFiles)!=null?c:!0)&&!this.isVirtualProject;await Promise.all([this.jsonDefaults.activate(),a?this.compilerService.start(i,n):Promise.resolve()]),this.snippetLoader.activate()}deactivate(e=!1){e||this.tabSystems.forEach(t=>t.deactivate()),this.typeLoader.deactivate(),this.packIndexer.deactivate(),this.jsonDefaults.deactivate(),this.extensionLoader.disposeAll(),this.snippetLoader.deactivate()}disposeWorkers(){this.packIndexer.dispose()}dispose(){this.disposeWorkers(),this.tabSystems.forEach(e=>e.dispose()),this.extensionLoader.disposeAll()}async refresh(){this.app.packExplorer.refresh(),this.deactivate(!0),this.disposeWorkers(),await this.activate(!0)}async openFile(e,t={}){var i,n,a;for(const r of this.tabSystems){const o=await r.getTab(e);if(o)return(i=t.selectTab)==null||i?r.select(o):void 0}t.openInSplitScreen?await((a=this.inactiveTabSystem)==null?void 0:a.open(e,t)):await((n=this.tabSystem)==null?void 0:n.open(e,t))}async closeFile(e){for(const t of this.tabSystems){const i=await t.getTab(e);i==null||i.close()}}async getFileTab(e){for(const t of this.tabSystems){const i=await t.getTab(e);if(i!==void 0)return i}}async getFileTabWithPath(e){for(const t of this.tabSystems){const i=await t.get(n=>n instanceof O&&n.getPath()===e);if(i!==void 0)return i}}async openTab(e,t=!0){var i;for(const n of this.tabSystems)if(await n.hasTab(e)){t&&n.select(e);return}(i=this.tabSystem)==null||i.add(e,t)}updateTabFolders(){const e={};for(const t of this.tabSystems)t.tabs.value.forEach(i=>{if(!(i instanceof O))return;const n=i.name;e[n]||(e[n]=[]),e[n].push(i)});for(const t in e){const i=e[t];if(i.length===1)i[0].setFolderName(null);else{const n=Bh(i.map(a=>a.getPath()));i.forEach((a,r)=>a.setFolderName(n[r]))}}}absolutePath(e){return`${this.projectPath}/${e}`}relativePath(e){return cs(this.projectPath,e)}async updateHandle(e){const t=await this.app.fileSystem.pathTo(e);if(!t)return;if(e.kind==="file")return await this.updateFile(t);const i=[];await ce(e,(n,a)=>{i.push(a)},void 0,t),await this.updateFiles(i)}async updateFile(e){const[t]=await Promise.all([this.packIndexer.updateFile(e),this.watchModeActive?this.compilerService.updateFiles([e]):Promise.resolve()]);t&&await this.jsonDefaults.updateDynamicSchemas(e)}async updateFiles(e){const t=await this.packIndexer.updateFiles(e);this.watchModeActive&&await this.compilerService.updateFiles(e),t&&await this.jsonDefaults.updateMultipleDynamicSchemas(e)}async unlinkFile(e){await this.unlinkFiles([e])}async unlinkFiles(e){var i,n;await Promise.allSettled([...e.map(a=>this.packIndexer.unlinkFile(a,!1)),...e.map(a=>this.app.fileSystem.unlink(a))]),await this.packIndexer.saveCache(),this.watchModeActive&&await this.compilerService.unlinkMultiple(e),e.forEach(a=>{this.fileUnlinked.dispatch(a);for(const r of this.tabSystems)r.forceCloseTabs(o=>o.getPath()===a)});const t=(n=(i=this.tabSystem)==null?void 0:i.selectedTab)==null?void 0:n.getPath();t&&await this.jsonDefaults.updateDynamicSchemas(t)}async unlinkHandle(e){const t=await this.app.fileSystem.pathTo(e);if(!t)return!1;if(e.kind==="file")return await this.unlinkFile(t);const i=[];return await ce(e,(n,a)=>{i.push(a)},void 0,t),await this.unlinkFiles(i),await this.app.fileSystem.unlink(t),!0}async onMovedFile(e,t){await Promise.all([this.compilerService.rename(e,t),this.packIndexer.rename(e,t)]),await this.jsonDefaults.updateDynamicSchemas(t)}async updateChangedFiles(){this.packIndexer.deactivate(),await this.packIndexer.activate(!0),await this.compilerService.build()}async getFileFromDiskOrTab(e){const t=await this.getFileTabWithPath(e);return t&&t instanceof O?await t.getFile():await this.app.fileSystem.readFile(e)}setActiveTabSystem(e,t){this.tabSystems.forEach(i=>e!==i?i.setActive(t,!1):void 0)}hasPacks(e){var t;for(const i of e)if(!((t=this._projectData.contains)!=null&&t.some(({id:n})=>n===i)))return!1;return!0}getPacks(){var e;return((e=this._projectData.contains)!=null?e:[]).map(t=>t.id)}addPack(e){this._projectData.contains.push(e)}getFilePath(e,t){return this.config.resolvePackPath(e,t)}isFileWithinAnyPack(e){return this.getPacks().map(t=>this.config.resolvePackPath(t)).some(t=>e.startsWith(t))}isFileWithinProject(e){return e.startsWith(`${this.projectPath}/`)||this.isFileWithinAnyPack(e)}isFileOpen(e){return this.tabSystems.some(t=>t.tabs.value.some(i=>i instanceof O&&i.getPath()===e))}async loadProject(){await this.config.setup();const[e,t]=await Promise.all([Tl(this,this.app.fileSystem),$l(this.app,this)]);V(this,"_projectData",{...this.config.get(),path:this.name,name:this.name,imgSrc:e,contains:t.sort((i,n)=>i.id.localeCompare(n.id))})}async recompile(e=!0){this._compilerService=k(await this.createDashService("development")),e&&this.isActiveProject?(await this.fileSystem.writeFile(".bridge/.restartWatchMode",""),await this.compilerReady.fired,await this.compilerService.start([],[])):await this.fileSystem.writeFile(".bridge/.restartWatchMode","")}async switchProjectType(){this.app.windows.loadingWindow.open();const e=this.requiresPermissions?"projects":"~local/projects",t=this.requiresPermissions?"~local/projects":"projects",{type:i,handle:n}=await Ns({moveHandle:this.baseDirectory,fromHandle:await this.app.fileSystem.getDirectoryHandle(e),toHandle:await this.app.fileSystem.getDirectoryHandle(t)});if(i==="cancel"||!n||n.kind!=="directory"){this.app.windows.loadingWindow.close();return}await this.parent.removeProject(this,!1),await this.parent.addProject(n,!0,!this.requiresPermissions),this.app.windows.loadingWindow.close()}}function Zs(s){if(s["minecraft:geometry"])return s;const e=Object.entries(s).filter(([i,n])=>typeof n!="string"),t=[];for(const[i,n]of e)t.push({description:{identifier:i,texture_width:n.texturewidth,texture_height:n.textureheight},bones:n.bones});return{format_version:"1.12.0","minecraft:geometry":t}}class dn extends H{constructor(e,t){super(),this.app=e,this.filePath=t,this.children=[],this.ready=new $,this.activate(),e.project.getFileFromDiskOrTab(t).then(async i=>{await this.onFileChange(i),await this.setup(i),this.ready.dispatch()})}async setup(e){}async activate(){this.disposable===void 0&&(this.disposable=this.app.project.fileChange.on(this.filePath,e=>this.onFileChange(e)))}async requestFile(e){return await this.onFileChange(e),new Promise(t=>{this.once(i=>t(i))})}async compileFile(e){const[t,i]=await this.app.project.compilerService.compileFile(this.filePath,new Uint8Array(await e.arrayBuffer()));return this.children.forEach(n=>n.dispose()),this.children=[],t.forEach(n=>{const a=new qh(this.app,n);this.children.push(a),a.on(()=>this.onFileChange(e))}),new File([i],e.name)}async onFileChange(e){this.dispatch(await this.compileFile(e))}async getFile(){return this.compileFile(await this.app.project.getFileFromDiskOrTab(this.filePath))}dispose(){var e;(e=this.disposable)==null||e.dispose(),this.disposable=void 0,this.children.forEach(t=>t.dispose())}}class qh extends H{constructor(e,t){super(),this.app=e,this.filePath=t,this.activate()}async activate(){this.disposable===void 0&&(this.disposable=this.app.project.fileSave.on(this.filePath,e=>this.onFileChange(e)))}async onFileChange(e){this.dispatch()}dispose(){var e;(e=this.disposable)==null||e.dispose(),this.disposable=void 0}}class Rt extends dn{constructor(e,t){super(e,t),this.ready.on(()=>{this.on(i=>this.onChange(i))})}async setup(e){return await this.onChange(await this.compileFile(e),!0)}}class Jh extends Rt{constructor(e,t,i){super(e.app,t),this.parent=e,this.includedGeometryIdentifiers=i,this.geometryJson={}}select(e){this.selected=e}async onChange(e,t=!1){try{this.geometryJson=Zs(R.parse(await e.text())),t||this.parent.onChange()}catch{}}get includedGeometries(){var e,t,i,n,a;return this.includedGeometryIdentifiers===void 0?(t=(e=this.geometryJson)==null?void 0:e["minecraft:geometry"])!=null?t:[]:(a=(n=(i=this.geometryJson)==null?void 0:i["minecraft:geometry"])==null?void 0:n.filter(({description:r})=>!this.includedGeometryIdentifiers.includes(r.identifier)))!=null?a:[]}get identifiers(){return this.includedGeometries.map(({description:e})=>e.identifier)}get geometry(){return this.includedGeometries.find(({description:e})=>e.identifier===this.selected)}get fallbackGeometry(){return this.includedGeometries[0]}}class Gh extends Rt{constructor(e,t,i){super(e.app,t),this.parent=e,this.includedAnimationIdentifiers=i,this.animationJson={}}async onChange(e,t=!1){try{this.animationJson=R.parse(await e.text()),t||this.parent.onChange()}catch{}}get includedAnimations(){var e,t;return this.includedAnimationIdentifiers===void 0?Object.entries((t=(e=this.animationJson)==null?void 0:e.animations)!=null?t:{}):Object.entries(this.animationJson.animations).filter(([i,{description:n}])=>!this.includedAnimationIdentifiers.includes(n.identifier))}get identifiers(){return this.includedAnimations.map(([e])=>e)}}class Kh extends Rt{constructor(e,t,i){super(e.app,i),this.parent=e,this.shortName=t,this.particleData={}}async onChange(e,t=!1){try{this.particleData=R.parse(await e.text()),t||this.parent.onChange()}catch{}}get identifier(){var e,t,i;return(i=(t=(e=this.particleData)==null?void 0:e.particle_effect)==null?void 0:t.description)==null?void 0:i.identifier}get json(){return this.particleData}}class Yh extends Rt{constructor(e,t){super(e.app,t),this.parent=e,this.entityData={}}async onChange(e,t=!1){try{this.entityData=R.parse(await e.text()),t||this.parent.onChange()}catch{}}findComponent(e){const t=[],i=a=>t.push(a);return[`*/components/${e}`,`*/component_groups/*/${e}`].forEach(a=>ri(a,this.entityData,i)),t}getSeatBoxHelpers(){var i;const e=this.findComponent("minecraft:rideable"),t={x:16*.8,y:16*1.8,z:16*.8};return(i=e.map(n=>{var a;return(a=n==null?void 0:n.seats)!=null?a:[]}).flat().map(n=>n==null?void 0:n.position).filter(n=>Array.isArray(n)&&typeof n[0]=="number"&&typeof n[1]=="number"&&typeof n[2]=="number"))==null?void 0:i.map(n=>({color:"#ff0000",position:{x:n[0]*-16,y:n[1]*16,z:n[2]*-16},size:t}))}getCollisionBoxes(){return this.findComponent("minecraft:collision_box").filter(e=>typeof(e==null?void 0:e.width)=="number"&&typeof(e==null?void 0:e.height)=="number").map(e=>({color:"#ffff00",position:{x:0,y:0,z:0},size:{x:e.width*16,y:e.height*16,z:e.width*16}}))}getHitboxes(){return this.findComponent("minecraft:custom_hit_test").map(e=>{var t;return(t=e==null?void 0:e.hitboxes)!=null?t:[]}).flat().filter(e=>typeof(e==null?void 0:e.width)=="number"&&typeof(e==null?void 0:e.height)=="number"&&((e==null?void 0:e.pivot)===void 0||Array.isArray(e==null?void 0:e.pivot)&&typeof e.pivot[0]=="number"&&typeof e.pivot[1]=="number"&&typeof e.pivot[2]=="number")).map(e=>{var t,i,n,a,r,o;return{color:"#0000ff",position:{x:((i=(t=e==null?void 0:e.pivot)==null?void 0:t[0])!=null?i:0)*-16,y:(((a=(n=e==null?void 0:e.pivot)==null?void 0:n[1])!=null?a:0)-e.height/2)*16,z:((o=(r=e==null?void 0:e.pivot)==null?void 0:r[2])!=null?o:0)*-16},size:{x:e.width*16,y:e.height*16,z:e.width*16}}})}}class Xs extends H{constructor(e,t){super(),this.app=e,this.renderData=t,this._geometries=[],this._animations=[],this.readyPromises=[],this._runningAnimations=new Set,this.particleEffects=[],this._currentTexturePath=this.texturePaths[0]}get ready(){return Promise.all(this.readyPromises)}update(e){this.renderData=e}createGeometry(e,t){const i=new Jh(this,e,t);this._geometries.push(i),this.readyPromises.push(i.ready.fired)}createAnimation(e,t){const i=new Gh(this,e,t);this._animations.push(i),this.readyPromises.push(i.ready.fired)}createParticle(e,t){const i=new Kh(this,e,t);this.particleEffects.push(i),this.readyPromises.push(i.ready.fired)}addServerEntity(e){this._serverEntity=new Yh(this,e),this.readyPromises.push(this._serverEntity.ready.fired)}selectGeometry(e){for(const t of this._geometries)if(t.identifiers.includes(e))return t.select(e);throw new Error(`Failed to find geometry with ID "${e}"`)}selectTexturePath(e){this._currentTexturePath=e}onChange(){this.dispatch()}get identifier(){return this.renderData.identifier}get texturePaths(){return this.renderData.texturePaths}get geometryIdentifiers(){return this._geometries.map(e=>e.identifiers).flat()}get animations(){return this._animations.map(e=>e.includedAnimations).flat().filter(([e])=>this.renderData.connectedAnimations.has(e))}get runningAnimations(){return this._runningAnimations}get modelData(){for(const e of this._geometries){let t=e.geometry;if(t)return t}return this._geometries[0].fallbackGeometry}get currentTexturePath(){return this._currentTexturePath}get particles(){return this.particleEffects.map(e=>[e.shortName,e.json])}get serverEntity(){return this._serverEntity}activate(){this._geometries.forEach(e=>e.activate())}dispose(){var e;this._geometries.forEach(t=>t.dispose()),this._animations.forEach(t=>t.dispose()),(e=this._serverEntity)==null||e.dispose()}}const Qh=X({__name:"Window",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState();function n(){e.window.close(e.window.options.filter(({isSelected:a})=>a).map(({name:a})=>a))}return{__sfc:!0,t,props:e,state:i,onClose:n,BaseWindow:de}}});var Zh=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:e.window.name,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,isPersistent:!e.window.isClosable,hasCloseButton:!1,width:440,height:400},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return e._l(e.window.options,function(n,a){return t("v-checkbox",{key:a,attrs:{label:n.name,"hide-details":""},model:{value:n.isSelected,callback:function(r){e.$set(n,"isSelected",r)},expression:"option.isSelected"}})})},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary"},on:{click:i.onClose}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(" "+e._s(i.t("general.confirm"))+" ")])],1)]},proxy:!0}],null,!1,862505436)}):e._e()},Xh=[],ef=_(Qh,Zh,Xh,!1,null,null,null,null);const tf=ef.exports;class nf extends Y{constructor(e){super(tf,!0,!1),this.config=e,this.defineWindow(),this.open()}get name(){return this.config.name}get options(){return this.config.options}get isClosable(){return this.config.isClosable}}const sf=X({__name:"Window",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState(),n=e.window,a=E(null);function r(c){e.window.startClosing(c)}function o(c,d){!n.modelViewer||(d?n.modelViewer.getModel().showBone(c):n.modelViewer.getModel().hideBone(c),n.modelViewer.requestRendering())}return tr(async()=>{await e.window.receiveCanvas(a.value),bn(()=>{n.modelViewer.positionCamera(i.previewScale)}),bn(()=>{n.modelViewer.scene.background=new kt(i.backgroundColor),n.modelViewer.requestRendering()})}),{__sfc:!0,t,props:e,state:i,window:n,canvas:a,onClose:r,onBoneVisibilityChange:o,BaseWindow:de}}});var af=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"windows.assetPreview.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,isPersistent:!1,hasCloseButton:!0,width:760,height:560},on:{closeWindow:function(n){return i.onClose(!0)}},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"d-flex"},[t("div",{staticStyle:{width:"200px"}},[t("v-text-field",{attrs:{outlined:"",dense:"",label:i.t("windows.assetPreview.assetName")},model:{value:i.state.assetName,callback:function(n){e.$set(i.state,"assetName",n)},expression:"state.assetName"}}),t("v-slider",{attrs:{min:"1",max:"4",step:"0.1",discrete:"","thumb-size":24,"thumb-label":"always","hide-details":"",label:i.t("windows.assetPreview.previewScale")},model:{value:i.state.previewScale,callback:function(n){e.$set(i.state,"previewScale",n)},expression:"state.previewScale"}}),t("v-slider",{attrs:{min:"1",max:"10",step:"1",discrete:"","thumb-size":24,"thumb-label":"always","hide-details":"",label:i.t("windows.assetPreview.outputResolution")},model:{value:i.state.outputResolution,callback:function(n){e.$set(i.state,"outputResolution",n)},expression:"state.outputResolution"}}),t("h2",{staticClass:"mt-8 mb-3"},[e._v(" "+e._s(i.t("windows.assetPreview.backgroundColor"))+" ")]),t("v-color-picker",{attrs:{width:"220px","hide-mode-switch":"",elevation:"2",mode:"hexa"},model:{value:i.state.backgroundColor,callback:function(n){e.$set(i.state,"backgroundColor",n)},expression:"state.backgroundColor"}}),i.state.bones.length>0?t("h2",{staticClass:"mt-8"},[e._v(" "+e._s(i.t("windows.assetPreview.boneVisibility"))+" ")]):e._e(),e._l(i.state.bones,function(n,a){return t("v-checkbox",{key:a,attrs:{label:a,"hide-details":""},on:{change:r=>i.onBoneVisibilityChange(a,r)},model:{value:i.state.bones[a],callback:function(r){e.$set(i.state.bones,a,r)},expression:"state.bones[boneName]"}})})],2),t("canvas",{ref:"canvas",staticClass:"ml-4 pa-1 rounded-lg outlined",staticStyle:{position:"sticky",top:"0"},attrs:{height:"500",width:"500"}})])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary"},on:{click:function(n){return i.onClose(!1)}}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(" "+e._s(i.t("general.confirm"))+" ")])],1)]},proxy:!0}],null,!1,1964320974)}):e._e()},rf=[],of=_(sf,af,rf,!1,null,null,null,null);const cf=of.exports;class lf extends Y{constructor({assetName:e,textureUrl:t,modelData:i}){super(cf,!0,!1),this.state=G({...super.state,bones:{},assetName:"",backgroundColor:"#121212",previewScale:1.5,outputResolution:4}),this.state.assetName=e,this.textureUrl=t,this.modelData=k(i),this.defineWindow(),this.open()}async receiveCanvas(e){const{StandaloneModelViewer:t}=await ti(),i=new t(e,this.modelData,this.textureUrl,{antialias:!0,height:500,width:500});await i.loadedModel,this.state.bones=Object.fromEntries(i.getModel().bones.map(n=>[n,!0])),i.scene.background=new kt(this.state.backgroundColor),i.positionCamera(this.state.previewScale),this.modelViewer=k(i)}startClosing(e){this.close(e?null:{assetName:this.state.assetName,previewScale:this.state.previewScale,boneVisibility:this.state.bones,backgroundColor:this.state.backgroundColor,outputResolution:this.state.outputResolution})}}async function ii(){return await ue(()=>import("./wintersky.esm.fee2c54d.js"),["assets/wintersky.esm.fee2c54d.js","assets/vendor.ed651d0f.js","assets/vendor.fa5a5182.css"])}class ea extends ln{constructor(e,t){super(e,t),this.boxHelperDisposables=[]}async setup(){const{default:e}=await ii();this.winterskyScene=k(new e.Scene({fetchTexture:async t=>{const i=await l.getApp();try{return await Pt(t.particle_texture_path,i.project.fileSystem)}catch{}}})),this.winterskyScene.global_options.loop_mode="once",this.winterskyScene.global_options.tick_rate=60,this.winterskyScene.global_options.max_emitter_particles=1e3,this.winterskyScene.global_options.scale=16,this.setupComplete.once(()=>this.scene.add(this.winterskyScene.space)),await super.setup()}get renderContainer(){if(!this._renderContainer)throw new Error("Preview.renderContainer was not defined yet");return this._renderContainer}get icon(){return this.tab.icon}get iconColor(){return this.tab.iconColor}async onActivate(){var e;await super.onActivate(),(e=this._renderContainer)==null||e.activate()}onCreate(){this.registerActions()}registerActions(){this.actions=[],this.addAction(new M({icon:"mdi-refresh",name:"general.reload",onTrigger:()=>this.reload()}),new M({icon:"mdi-image-outline",name:"fileType.texture",isDisabled:()=>{var e,t,i;return((i=(t=(e=this._renderContainer)==null?void 0:e.texturePaths)==null?void 0:t.length)!=null?i:0)<=1},onTrigger:async()=>{const e=this.renderContainer.texturePaths,i=await new pt({name:"fileType.texture",isClosable:!1,options:e,default:this.renderContainer.currentTexturePath}).fired;this.renderContainer.selectTexturePath(i),this.createModel()}}),new M({icon:"mdi-cube-outline",name:"fileType.geometry",isDisabled:()=>{var e,t,i;return((i=(t=(e=this._renderContainer)==null?void 0:e.geometryIdentifiers)==null?void 0:t.length)!=null?i:0)<=1},onTrigger:async()=>{const e=this.renderContainer.geometryIdentifiers,i=await new pt({name:"fileType.geometry",isClosable:!1,options:e,default:e[0]}).fired;this.renderContainer.selectGeometry(i),this.createModel()}}),new M({icon:"mdi-movie-open-outline",name:"fileType.clientAnimation",isDisabled:()=>{var e,t,i;return((i=(t=(e=this._renderContainer)==null?void 0:e.animations)==null?void 0:t.length)!=null?i:0)==0},onTrigger:async()=>{var n;const e=this.renderContainer.animations,i=await new nf({name:"fileType.clientAnimation",options:e.map(([a])=>({name:a,isSelected:this.renderContainer.runningAnimations.has(a)}))}).fired;(n=this.model)==null||n.animator.pauseAll(),this.renderContainer.runningAnimations.clear(),i.forEach(a=>{this.renderContainer.runningAnimations.add(a)}),this.createModel()}}),new M({icon:"mdi-collage",name:"[Asset Preview]",onTrigger:()=>{this.renderAssetPreview()}}))}onDestroy(){var e;(e=this._renderContainer)==null||e.dispose(),super.onDestroy()}onChange(){}async createModel(){var a;if(!this._renderContainer)return;const e=await l.getApp(),{Model:t}=await ti();if(this.model&&((a=this.scene)==null||a.remove(this.model.getGroup()),this.model.animator.disposeAnimations(),this.boxHelperDisposables.forEach(r=>r.dispose())),this.registerActions(),!this.renderContainer.currentTexturePath)return;this.model=k(new t(this.renderContainer.modelData,await Pt(this.renderContainer.currentTexturePath,e.fileSystem))),await this.model.create(),this.scene.add(this.model.getGroup()),this.model.animator.setupWintersky(this.winterskyScene);const{default:i}=await ii();this.renderContainer.particles.forEach(([r,o])=>{var c;!r||(c=this.model)==null||c.animator.addEmitter(r,new i.Config(this.winterskyScene,o))});for(const[r,o]of this.renderContainer.animations)this.model.animator.addAnimation(r,o);this.renderContainer.runningAnimations.forEach(r=>{var o;return(o=this.model)==null?void 0:o.animator.play(r)});const n=this.renderContainer.serverEntity;n&&(this.boxHelperDisposables.push(),this.createOutlineBoxes([...n.getHitboxes(),...n.getCollisionBoxes(),...n.getSeatBoxHelpers()])),this.requestRendering(),setTimeout(()=>{this.requestRendering()},100)}createOutlineBoxes(e){this.boxHelperDisposables=e.map(t=>this.model.createOutlineBox(t.color,t.position,t.size))}render(e=!0){this.winterskyScene.updateFacingRotation(this.camera),super.render(),e&&this.model&&this.model.shouldTick&&(this.model.tick(),this.isActive&&this.requestRendering())}async close(){var t;const e=await super.close();return e&&((t=this._renderContainer)==null||t.dispose(),this._renderContainer=void 0),e}async renderAssetPreview(){if(!this._renderContainer||!this.renderContainer.currentTexturePath)return;const{StandaloneModelViewer:e}=await ti(),t=this.parent.app.fileSystem,i=await t.loadFileHandleAsDataUrl(await t.getFileHandle(this.renderContainer.currentTexturePath)),a=await new lf({assetName:this.tab.getFileHandle().name.split(".").shift(),modelData:this.renderContainer.modelData,textureUrl:i}).fired;if(!a)return;const{backgroundColor:r,boneVisibility:o,previewScale:c,outputResolution:d}=a;let p=a.assetName;const u=document.createElement("canvas");u.width=500*d,u.height=500*d;const f=new e(u,this.renderContainer.modelData,i,{antialias:!0,height:500*d,width:500*d});await f.loadedModel;for(const[q,Nt]of Object.entries(o))Nt||f.getModel().hideBone(q);f.scene.background=new kt(r);const h=document.createElement("canvas");h.width=1400*d,h.height=600*d;const m=h.getContext("2d");if(!m)return;m.imageSmoothingEnabled=!1;const g=f.getModel().getGroup();f.positionCamera(c),f.requestRendering(),await Ai(100);const w=[];for(let q=0;q<5;q++)q===1&&g.rotateY(Math.PI/4),q!==0&&g.rotateY(Math.PI/2),f.requestRendering(!0),w.push(u.toDataURL("image/png"));const C=new ir().setFromObject(g).getCenter(new nr);g.position.setY(C.y),g.rotation.set(.25*Math.PI,1.75*Math.PI,.75*Math.PI),f.positionCamera(c,!1),f.requestRendering(!0),w.push(u.toDataURL("image/png")),g.position.setY(0),g.rotation.set(0,1.75*Math.PI,1.75*Math.PI),f.positionCamera(c,!1),f.requestRendering(!0),w.push(u.toDataURL("image/png"));const P=this.parent.project.config.getAuthorImage(),[x,b,...y]=await Promise.all([this.loadImageFromDisk(this.renderContainer.currentTexturePath),P?this.loadImageFromDisk(P):null,...w.map(q=>this.loadImage(q))]);m.fillStyle=r,m.fillRect(0,0,h.width,h.height),m.drawImage(y[0],0,100*d,400*d,400*d);for(let q=0;q<3;q++)m.drawImage(y[q+1],650*d,q*200*d,200*d,200*d);for(let q=0;q<3;q++)m.drawImage(y[q+4],1050*d,q*200*d,200*d,200*d);const j=(x.width>x.height?0:(x.height-x.width)/x.width/2)*200,T=(x.height>x.width?0:(x.width-x.height)/x.height/2)*200,re=x.width>x.height?200:x.width/x.height*200,_e=x.height>x.width?200:x.height/x.width*200;m.drawImage(x,(400+j)*d,(200+T)*d,re*d,_e*d),b&&m.drawImage(b,h.width-50*d,h.height-50*d,50*d,50*d),p!==""?(m.fillStyle="#ffffff",m.font=30*d+"px Arial",m.fillText(p,20*d,50*d)):p=this.tab.getFileHandle().name.split(".")[0],await new Promise(q=>{h.toBlob(async Nt=>{!Nt||(await di(`previews/${p}.png`,new Uint8Array(await Nt.arrayBuffer()),this.parent.project.fileSystem),q())})}),f.dispose()}loadImage(e){return new Promise(async(t,i)=>{const n=new Image;n.addEventListener("load",()=>t(n)),n.src=e})}async loadImageFromDisk(e){const t=this.parent.app.fileSystem;return await this.loadImage(await t.loadFileHandleAsDataUrl(await t.getFileHandle(e)))}}function Bn(s){return Array.isArray(s)&&s.length===3&&typeof s[0]=="number"&&typeof s[1]=="number"&&typeof s[2]=="number"}const df={"1.16.100":[{name:"minecraft:entity_collision",color:"#ffff00"},{name:"minecraft:pick_collision",color:"#0000ff"}],"1.18.0":[{name:"minecraft:block_collision",color:"#ffff00"},{name:"minecraft:aim_collision",color:"#0000ff"}],"1.19.10":[{name:"minecraft:collision_box",color:"#ffff00"},{name:"minecraft:aim_collision",color:"#0000ff"}]};function pf(s="1.16.100"){for(const[e,t]of Object.entries(df))if(!sr.exports.compare(e,s,"<"))return t}class ta extends ea{constructor(e,t,i){super(t,i),this.blockFilePath=e,this.blockJson={},this.formatVersion="1.16.100",this.previewOptions={},this.blockWatcher=new dn(l.instance,e),this.blockWatcher.on(n=>this.reload(n))}setPreviewOptions({loadComponents:e=!0}){this.previewOptions={loadComponents:e}}async close(){const e=await super.close();return e&&this.blockWatcher.dispose(),e}async reload(e){var t;e||(e=await this.blockWatcher.getFile()),(t=this._renderContainer)==null||t.dispose(),this._renderContainer=void 0,this.loadRenderContainer(e)}async loadRenderContainer(e){var u,f,h,m,g,w;if(this._renderContainer!==void 0)return;await this.setupComplete;const t=await l.getApp();await t.project.packIndexer.fired;const i=t.project.packIndexer.service,n=t.project.config;if(!i)return;let a;try{a=R.parse(await e.text())}catch{console.error("Invalid JSON within block file");return}this.blockJson=k((u=a==null?void 0:a["minecraft:block"])!=null?u:{}),this.formatVersion=(f=a==null?void 0:a.format_version)!=null?f:"1.16.100";const r=await i.getCacheDataFor("block",this.blockFilePath),o=(h=r==null?void 0:r.texture)!=null?h:[];let c;try{c=(g=(m=R.parse(await t.project.getFileFromDiskOrTab(n.resolvePackPath("resourcePack","textures/terrain_texture.json")).then(v=>v.text())))==null?void 0:m.texture_data)!=null?g:{}}catch{console.error("Invalid JSON within terrain_texture.json file");return}const d=await Promise.all(o.map(v=>{var C,P;return(P=(C=c[v])==null?void 0:C.textures)!=null?P:[]}).flat().map(v=>ms(t.fileSystem,n.resolvePackPath("resourcePack",v),[".tga",".png",".jpg",".jpeg"])));if(d.length===0)return;const p=await i.find("geometry","identifier",(w=r.geometryIdentifier)!=null?w:[]);p.length!==0&&(this._renderContainer=k(new Xs(t,{identifier:r.geometryIdentifier[0],texturePaths:d.filter(v=>v!==void 0),connectedAnimations:new Set([])})),this._renderContainer.createGeometry(p[0]),this.renderContainer.ready.then(()=>{this.createModel()}),this._renderContainer.on(()=>{this.createModel()}))}async createModel(){var e;if(await super.createModel(),this.previewOptions.loadComponents){const i=((e=pf(this.formatVersion))!=null?e:[]).map(({name:n,color:a})=>this.loadCollisionBoxes(n,a)).flat();this.createOutlineBoxes(i)}}findComponents(e,t){const i=[],n=r=>i.push(r);return[`components/${t}`,`permutations/*/components/${t}`].forEach(r=>ri(r,e,n)),i}loadCollisionBoxes(e,t){return this.findComponents(this.blockJson,e).filter(i=>Bn(i.origin)&&Bn(i.size)).map(({origin:i,size:n})=>({color:t,position:{x:i[0]+n[0]/2,y:i[1],z:i[2]+n[2]/2},size:{x:n[0],y:n[1],z:n[2]}}))}}class pn extends ea{constructor(e,t,i){super(t,i),this.clientEntityFilePath=e,this.previewOptions={},this.clientEntityWatcher=new dn(l.instance,e),this.clientEntityWatcher.on(n=>this.reload(n))}setPreviewOptions(e){this.previewOptions=e}async close(){const e=await super.close();return e&&this.clientEntityWatcher.dispose(),e}async reload(e){var i,n;e||(e=await this.clientEntityWatcher.getFile());const t=(i=this._renderContainer)==null?void 0:i.runningAnimations;(n=this._renderContainer)==null||n.dispose(),this._renderContainer=void 0,this.loadRenderContainer(e,t)}async loadRenderContainer(e,t=new Set){var u,f,h,m,g,w,v,C;if(this._renderContainer!==void 0)return;await this.setupComplete;const i=await l.getApp(),n=i.project.packIndexer.service;if(!n)return;let a;try{a=(f=(u=R.parse(await e.text()))==null?void 0:u["minecraft:client_entity"])!=null?f:{}}catch{return}const r=await n.getCacheDataFor("clientEntity",this.clientEntityFilePath),o=r.texturePath,c=await n.find("clientAnimation","identifier",(h=r.animationIdentifier)!=null?h:[],!0),d=await n.find("geometry","identifier",(m=r.geometryIdentifier)!=null?m:[]);if(d.length===0){new U({description:"preview.noGeometry"}),this.close();return}const p=await Promise.all(Object.entries((w=(g=a==null?void 0:a.description)==null?void 0:g.particle_effects)!=null?w:{}).map(async([P,x])=>[P,(await n.find("particle","identifier",[x],!1))[0]]));if(this._renderContainer=k(new Xs(i,{identifier:r.geometryIdentifier[0],texturePaths:o,connectedAnimations:new Set(r.animationIdentifier)})),this._renderContainer.createGeometry(d[0]),c.forEach(P=>this._renderContainer.createAnimation(P)),p.forEach(([P,x],b)=>{!x||this._renderContainer.createParticle(P,x)}),t&&t.forEach(P=>{var x;return(x=this._renderContainer)==null?void 0:x.runningAnimations.add(P)}),this.previewOptions.loadServerEntity&&((v=a==null?void 0:a.description)==null?void 0:v.identifier)){const P=await n.find("entity","identifier",[(C=a==null?void 0:a.description)==null?void 0:C.identifier],!1);P.length>0&&this._renderContainer.addServerEntity(P[0])}this.renderContainer.ready.then(()=>{this.createModel()}),this._renderContainer.on(()=>{this.createModel()})}}async function uf(s,e){const t=await l.getApp();await t.project.packIndexer.fired;const i=t.project.packIndexer.service,a=await(await e.getFile()).text();let r;try{r=Zs(R.parse(a))}catch{return}const o=r["minecraft:geometry"].map(p=>{var u;return(u=p==null?void 0:p.description)==null?void 0:u.identifier}).filter(p=>p!==void 0);let c=o[0];if(o.length>1&&(c=await new pt({default:o[0],options:o,name:"preview.chooseGeometry",isClosable:!1}).fired),!c){new U({description:"preview.noGeometry"});return}const d=await i.find("clientEntity","geometryIdentifier",[c]);if(d.length===0){const p=await i.find("block","geometryIdentifier",[c]);if(p.length>0){const u=new ta(p[0],e,s);return u.setPreviewOptions({loadComponents:!1}),u}new U({description:"preview.failedClientEntityLoad"});return}return new pn(d[0],e,s)}async function hf(s,e){return new pn(e.getPath(),e,s)}async function ff(s,e){var d,p,u;const t=await l.getApp();await t.project.packIndexer.fired;const i=t.project.packIndexer.service,a=await(await e.getFile()).text();let r;try{r=(p=(d=R.parse(a))==null?void 0:d["minecraft:entity"])!=null?p:{}}catch{new U({description:"preview.invalidEntity"});return}const o=await i.find("clientEntity","identifier",[(u=r==null?void 0:r.description)==null?void 0:u.identifier]);if(o.length===0){new U({description:"preview.failedClientEntityLoad"});return}const c=new pn(o[0],e,s);return c.setPreviewOptions({loadServerEntity:!0}),c}class mf extends Rt{constructor(e,t){super(e.tabSystem.app,t),this.tab=e}onChange(e){this.tab.onChange(e)}}class gf extends ln{constructor(e,t){super(e,t),this.isReloadingDone=new $,this.setupComplete.once(()=>{this.scene.add(new ar(16)),this.wintersky.global_options.tick_rate=60,this.wintersky.global_options.max_emitter_particles=1e3,this.wintersky.global_options.scale=16}),this.isReloadingDone.dispatch()}async setup(){const{default:e}=await ii();this.wintersky=k(new e.Scene({fetchTexture:async t=>{const i=await l.getApp(),n=i.project.config;try{return await Pt(n.resolvePackPath("resourcePack",`${t.particle_texture_path}.png`),i.fileSystem)}catch{}}})),await super.setup()}async onActivate(){await super.onActivate(),await this.onChange()}onDeactivate(){var e;(e=this.emitter)==null||e.stop(!0),super.onDeactivate()}onDestroy(){var e,t;(e=this.fileWatcher)==null||e.dispose(),(t=this.emitter)==null||t.delete(),super.onDestroy()}onCreate(){this.addAction(new M({icon:"mdi-refresh",name:"general.reload",onTrigger:()=>this.reload()}))}async receiveCanvas(e){const t=!this._camera;await super.receiveCanvas(e),t&&this.camera.position.set(60,30,60)}async loadParticle(e){var n,a,r;this.fileWatcher||(this.fileWatcher=k(new mf(this,this.tab.getPath()))),e||(e=(a=await((n=this.fileWatcher)==null?void 0:n.requestFile(await this.getFile())))!=null?a:await this.getFile());let t;try{t=R.parse(await e.text())}catch{return}const{default:i}=await ii();(r=this.emitter)==null||r.delete(),this.scene.children.includes(this.wintersky.space)||this.scene.add(this.wintersky.space),this.config=k(new i.Config(this.wintersky,t,{path:this.tab.getPath()})),this.emitter=k(new i.Emitter(this.wintersky,this.config,{loop_mode:"looping",parent_mode:"world"})),this.emitter.start()}render(){var e,t,i;(e=this.controls)==null||e.update(),this.wintersky.updateFacingRotation(this.camera),(t=this.emitter)==null||t.tick(),(i=this.renderer)==null||i.render(this.scene,this.camera),this.renderingRequested=!1,this.isActive&&this.requestRendering()}async onChange(e){await this.isReloadingDone.fired,this.isReloadingDone.resetSignal(),await this.loadParticle(e),this.isReloadingDone.dispatch()}async close(){var t;const e=await super.close();return e&&((t=this.fileWatcher)==null||t.dispose()),e}async reload(){await this.onChange()}get icon(){return this.tab.icon}get iconColor(){return this.tab.iconColor}}async function wf(){var o,c;const s=await l.getApp(),e=s.project,t=new Xt;await(await e.compilerService.completedStartUp).fired;const i=(c=(o=e.config.get().bridge)==null?void 0:o.v1CompatMode)!=null?c:!1,n=e.config.resolvePackPath("behaviorPack","commands");let a;try{a=await s.fileSystem.getDirectoryHandle(n)}catch{return[]}const r=[];return await ce(a,async(d,p)=>{const[u,f]=await e.compilerService.compileFile(p,await d.getFile().then(async g=>new Uint8Array(await g.arrayBuffer()))),h=new File([f],d.name),m=new rr(new Zn,await h.text(),"development",i);await m.load(t,p,"client"),r.push(...m.getSchema())},void 0,n),r}function Vn(s,e){return e.includes(s)?"full":e.some(t=>t.includes(s))?"partial":"none"}class yf{constructor(e){this.commandData=e}getSchema(){return this.commandData.getSelectorArgumentsSchema()}async getNextCompletionItems(e){if(e.length===1||e[e.length-2]===",")return this.getArgumentNameCompletions();if(e[e.length-2]==="="||e[e.length-2]==="=!"){const t=e[e.length-3];return await this.getArgumentTypeCompletions(t)}return[]}async getArgumentFromWord(e){return(await this.getSchema()).find(i=>i.argumentName===e)}async getArgumentNameCompletions(){const{languages:e}=await L();return(await this.getSchema()).map(i=>({label:i.argumentName,insertText:i.argumentName,kind:e.CompletionItemKind.Property,documentation:i.description}))}async getArgumentTypeCompletions(e){const t=await this.getSchema();return(await Promise.all(t.filter(n=>n.argumentName===e).map(n=>this.commandData.getCompletionItemsForArgument(n)))).flat()}}class vf extends ${constructor(){super(...arguments),this.selectorArguments=new yf(this)}async loadCommandData(e){var n;const t=await l.getApp();this._data=k(await t.dataLoader.readJSON(`data/packages/${e}/language/mcfunction/main.json`));const i=(n=this._data.$customTypes)!=null?n:{};for(const{commands:a}of this._data.vanilla)for(const r of a)!r.arguments||(r.arguments=r.arguments.map(o=>{if(!o.type||!o.type.startsWith("$"))return o;const c=i[o.type.slice(1)];return c?c.map(d=>({...o,...d})):o}).flat());this.dispatch()}get shouldIgnoreCustomCommands(){return l.getApp().then(e=>!e.projectManager.projectReady.hasFired)}async getSchema(){if(!this._data)throw new Error("Acessing commandData before it was loaded.");const e=[],t=new ei;await t.setup();for await(const i of this._data.vanilla)t.isValid(i.requires)?e.push(i):i.requires||e.push(i);return e}async getCommandsSchema(e=!1){return(await this.getSchema()).map(t=>t.commands).flat().concat(e?[]:await wf()).filter(t=>t!==void 0)}async getSelectorArgumentsSchema(){return(await this.getSchema()).map(e=>e.selectorArguments).flat().filter(e=>e!==void 0)}allCommands(e,t=!1){return this.getCommandsSchema(t).then(i=>[...new Set(i.map(n=>n==null?void 0:n.commandName).filter(n=>!e||(n==null?void 0:n.includes(e))))])}allSelectorArguments(){return this.getSelectorArgumentsSchema().then(e=>[...new Set(e.map(t=>t==null?void 0:t.argumentName))])}async getCommandCompletionItems(e,t=!1){const{languages:i}=await L(),n=await this.getCommandsSchema(t),a=[];return n.filter(r=>{var o;return!e||((o=r.commandName)==null?void 0:o.includes(e))}).forEach(r=>{a.some(o=>o.label===r.commandName)||a.push({insertText:r.commandName,label:r.commandName,documentation:r.description,kind:i.CompletionItemKind.Method})}),a}async getCommandDefinitions(e,t){return await this.getCommandsSchema(t).then(n=>n.filter(a=>a.commandName===e))}async getNextCompletionItems(e){if(e.length<=1)return await this.getCommandCompletionItems(e[0],await this.shouldIgnoreCustomCommands);const t=e.shift(),i=await this.getCommandDefinitions(t,await this.shouldIgnoreCustomCommands);if(!i||i.length===0)return[];const n=[];return(await Promise.all(i.map(async a=>{const r=await this.getNextCommandArgument(a,[...e]);return r.length===0?[]:await Promise.all(r.map(o=>this.getCompletionItemsForArgument(o)))}))).flat(2).forEach(a=>{n.some(r=>r.label===a.label)||n.push(a)}),n}async getNextCommandArgument(e,t){var a;if(!e.arguments||e.arguments.length===0)return[];const i=(a=e.arguments)!=null?a:[];let n=0;for(let r=0;r<t.length;r++){const o=t[r];if(o==="")continue;const c=await this.isArgumentType(o,i[n]);if(c==="none")return[];if(c==="partial")return t.length===r+1?[i[n]]:[];if(i[n].type==="command"&&r+1<t.length)return(await Promise.all((await this.getCommandDefinitions(o,await this.shouldIgnoreCustomCommands)).map(d=>this.getNextCommandArgument(d,t.slice(r+1))))).flat();if(n++,n>=i.length)return[]}return i[n]?[i[n]]:[]}async isArgumentType(e,t){var i,n,a,r;switch(t.type){case"string":{if(!((i=t.additionalData)!=null&&i.values))return"full";const o=(r=(a=(n=t.additionalData)==null?void 0:n.values)!=null?a:this.resolveDynamicReference(t.additionalData.schemaReference))!=null?r:[];return Vn(e,o)}case"command":return Vn(e,await this.allCommands(void 0,await this.shouldIgnoreCustomCommands));case"number":return isNaN(Number(e))?"none":"full";case"selector":return e.startsWith("@")?"full":"none";case"boolean":return e==="true"||e==="false"?"full":"none";case"coordinate":return e.startsWith("~")||e.startsWith("^")||!isNaN(Number(e))?"full":"none";case"jsonData":return/^\{.*\}$/.test(e)?"full":"none";case"blockState":return/^\[.*\]$/.test(e)?"full":"none";case"molang":{const o=new or;try{o.parse(e)}catch{return"none"}return"full"}default:return"none"}}async getCompletionItemsForArgument(e){var i,n,a,r,o;const{languages:t}=await L();if(!e.type)return(i=e.additionalData)!=null&&i.values?this.toCompletionItem((n=e.additionalData)==null?void 0:n.values):(a=e.additionalData)!=null&&a.schemaReference?this.toCompletionItem(this.resolveDynamicReference(e.additionalData.schemaReference).map(({value:c})=>c)):[];switch(e.type){case"command":return this.mergeCompletionItems(await this.getCommandCompletionItems(),{documentation:e.description});case"selector":return this.toCompletionItem(["@a","@e","@p","@s","@r","@initiator"],e.description);case"boolean":return this.toCompletionItem(["true","false"],e.description,t.CompletionItemKind.Value);case"number":return this.toCompletionItem(["0","1","2","3","4","5","6","7","8","9"],e.description,t.CompletionItemKind.Value);case"coordinate":return this.toCompletionItem(["~","^"],e.description,t.CompletionItemKind.Operator);case"string":return(r=e.additionalData)!=null&&r.values?this.toCompletionItem(e.additionalData.values,e.description):(o=e.additionalData)!=null&&o.schemaReference?this.toCompletionItem(this.resolveDynamicReference(e.additionalData.schemaReference).map(({value:c})=>c),e.description):[];case"jsonData":return this.toCompletionItem([["{}","{${1:json data}}"]],e.description,t.CompletionItemKind.Struct);case"blockState":return this.toCompletionItem([["[]","[${1:block states}]"]],e.description,t.CompletionItemKind.Struct);case"scoreData":return this.toCompletionItem([["{}","{${1:scores}}"]],e.description,t.CompletionItemKind.Struct)}return[]}async toCompletionItem(e,t,i){const{languages:n}=await L();return i||(i=n.CompletionItemKind.Text),e.map(a=>({label:Array.isArray(a)?`${a[0]}`:`${a}`,insertText:Array.isArray(a)?`${a[1]}`:`${a}`,kind:i,documentation:t,insertTextRules:Array.isArray(a)?n.CompletionItemInsertTextRule.InsertAsSnippet:void 0}))}mergeCompletionItems(e,t){return e.map(i=>{var n;return{...i,documentation:t.documentation?`${t.documentation}

${(n=i.documentation)!=null?n:""}`:i.documentation}})}resolveDynamicReference(e){return new Zi(e,"$ref",e).getCompletionItems({})}}const bf=[{name:"preview.viewModel",fileType:"geometry",createPreview:(s,e)=>uf(s,e)},{name:"preview.viewModel",fileType:"clientEntity",createPreview:(s,e)=>hf(s,e)},{name:"preview.viewEntity",fileType:"entity",createPreview:(s,e)=>ff(s,e)},{name:"preview.viewParticle",fileType:"particle",createPreview:async(s,e)=>new gf(e,s)},{name:"preview.viewBlock",fileType:"block",createPreview:async(s,e)=>{const t=new ta(e.getPath(),e,s);return t.setPreviewOptions({loadComponents:!0}),t}}];class Wt extends zh{constructor(){super(...arguments),this.commandData=new vf}onCreate(){bf.forEach(e=>this.tabActionProvider.registerPreview(e)),this.tabActionProvider.register({name:"preview.name",icon:"mdi-play",isFor:e=>e instanceof O&&e.getFileHandle().name.endsWith(".html"),trigger:e=>{const t=this.app.project.inactiveTabSystem;!t||(t.add(new fi(t,{filePath:e.getPath(),fileHandle:e.getFileHandle()})),t.setActive(!0))}}),this.commandData.loadCommandData("minecraftBedrock")}getCurrentDataPackage(){return this.app.dataLoader.getDirectoryHandle("data/packages/minecraftBedrock")}}async function _f(){const{languages:s,Range:e}=await L();s.registerCompletionItemProvider("json",{provideCompletionItems:async(t,i)=>{var x,b,y;const n=await l.getApp(),a=n.project;if(!(a instanceof Wt))return;const r=a.commandData,o=await Ui(t,i),c=(x=n.project.tabSystem)==null?void 0:x.selectedTab;if(!c)return;const d=await n.dataLoader.readJSON("data/packages/minecraftBedrock/location/validCommand.json"),{id:p,meta:{commandsUseSlash:u}={commandsUseSlash:!1}}=(b=l.fileType.get(c.getPath()))!=null?b:{id:"unknown",meta:{commandsUseSlash:!1}},f=(y=d[p])!=null?y:[];if(f.length===0||!ai(o,f)||!ws(t,i))return;let{word:m,range:g}=await zi(t,i);if(u&&!m.startsWith("/"))return;let w=!1;m.startsWith("/")&&(m=m.slice(1),w=!0);const{tokens:v}=Xn(m),C=v[v.length-1];return{suggestions:(await r.getNextCompletionItems(v.map(j=>j.word))).map(({label:j,insertText:T,documentation:re,kind:_e})=>({label:j!=null?j:T,insertText:T,documentation:re,kind:_e,range:new e(i.lineNumber,Math.min(g.endColumn+1,g.startColumn+C.startColumn+(w?2:1)),i.lineNumber,Math.min(g.endColumn+1,i.column+T.length))}))}}})}const Gt={brackets:[["(",")","delimiter.parenthesis"],["[","]","delimiter.square"],["{","}","delimiter.curly"]],keywords:[],selectors:["@a","@e","@p","@r","@s","@initiator"],targetSelectorArguments:[],tokenizer:{root:[[/#.*/,"comment"],[/\{/,{token:"delimiter.bracket",bracket:"@open",next:"@embeddedJson"}],[/\[/,{token:"delimiter.bracket",next:"@targetSelectorArguments",bracket:"@open"}],{include:"@common"},...rs,[/[a-z_][\w\/]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],[/(@[a-z]+)/,{cases:{"@selectors":"type.identifier","@default":"identifier"}}]],common:[[/(\\)?"[^"]*"|'[^']*'/,"string"],[/\=|\,|\!|%=|\*=|\+=|-=|\/=|<|=|>|<>/,"definition"],[/true|false/,"number"],[/-?([0-9]+(\.[0-9]+)?)|((\~|\^)-?([0-9]+(\.[0-9]+)?)?)/,"number"]],embeddedJson:[[/\{/,"delimiter.bracket","@embeddedJson"],[/\}/,"delimiter.bracket","@pop"],{include:"@common"}],targetSelectorArguments:[[/\]/,{token:"@brackets",bracket:"@close",next:"@pop"}],[/{/,{token:"@brackets",bracket:"@open",next:"@targetSelectorScore"}],[/[a-z_][\w\/]*/,{cases:{"@targetSelectorArguments":"variable","@default":"identifier"}}],{include:"@common"}],targetSelectorScore:[[/}/,{token:"@brackets",bracket:"@close",next:"@pop"}],{include:"@common"}]}};function Sf(s,e){const t=Cf(s,e-1);if(t===-1)return!1;let i="",n=t-1;for(;n>=0&&s[n]!==" ";)i=s[n]+i,n--;return i.startsWith("@")?{selectorStart:t+1,selectorEnd:kf(s,e)}:!1}function Cf(s,e){for(let t=e;t>=0;t--){if(s[t]=="[")return t;if(s[t]==="]")return-1}return-1}function kf(s,e){for(let t=e;t<s.length;t++)if(s[t]=="]")return t;return-1}class F{constructor(e,t=0,i=0){this.value=e,this.start=t,this.end=i}}class bt{constructor(e,t,i){this.value=e,this.start=t,this.end=i}}class N{constructor(e,t,i=0,n=0){this.value=e,this.type=t,this.start=i,this.end=n}}class xf{constructor(){this.validCommands=[],this.validSelectorArgs=[],this.loadedCommandData=!1,this.specialSymbols=["[","]","!","=","@","~","^","!",",","{","}",".",":"],this.whiteSpace=[" ","	",`
`,"\r"],this.selectorTargets=["a","s","p","r","e"]}DoesStringArrayMatchArray(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0}LateLoadData(){setTimeout(()=>{if(!this.blockStateData){let e=k(ge.request("file:///data/packages/minecraftBedrock/schema/general/vanilla/blockState.json"));e.type?this.blockStateData=e:this.LateLoadData()}},1e3)}async LoadCommandData(){this.loadedCommandData=!0;const t=await(await l.getApp()).project;if(t instanceof Wt&&(this.commandData=t.commandData),this.validCommands=[],this.validSelectorArgs=[],this.generalCommandData=[],this.generalSelectorArgsData=[],this.commandData)for(let n=0;n<this.commandData._data.vanilla.length;n++){const a=this.commandData._data.vanilla[n];for(let r=0;r<a.commands.length;r++)this.validCommands.includes(a.commands[r].commandName)||this.validCommands.push(a.commands[r].commandName),this.generalCommandData.push(k(a.commands[r]));if(a.selectorArguments)for(let r=0;r<a.selectorArguments.length;r++)this.validSelectorArgs.includes(a.selectorArguments[r].argumentName)||this.validSelectorArgs.push(a.selectorArguments[r].argumentName),this.generalSelectorArgsData.push(k(a.selectorArguments[r]))}else console.error("Unable to load commands.json");let i=k(ge.request("file:///data/packages/minecraftBedrock/schema/general/vanilla/blockState.json"));i.type?this.blockStateData=i:this.LateLoadData()}async GetDocs(e=""){if(this.commandData){for(let t=0;t<this.generalCommandData.length;t++)if(this.generalCommandData[t].commandName==e)return this.generalCommandData[t].description}else console.error("Unable to load commands.json");return"Unable to get docs for this command!"}isInt(e){return/^-?\d+$/.test(e)}isFloat(e){return/^\d+\.\d+$/.test(e)}ParseDirty(e){let t=0,i=e.value.length,n=[],a=-1;for(;t<e.value.length;){let r=!1,o=!1;for(;i>t&&!r;){let c=e.value.substring(t,i);this.specialSymbols.includes(c)?(n.push(new N(c,"Symbol",t,i)),r=!0):this.isInt(c)?(n.push(new N(c,"Integer",t,i)),r=!0,o=!0):this.isFloat(c)?(n.push(new N(c,"Float",t,i)),r=!0):c=="true"||c=="false"?(n.push(new N(c,"Boolean",t,i)),r=!0):c==" "&&(n.push(new N(c,"Space",t,i)),r=!0),i--}if(r){if(a!=-1){if(o){let c=n[n.length-1].value;n.splice(n.length-1,1,new N(e.value.substring(a,t)+c,"String",a,t+c.length)),n.length-3>=0&&n[n.length-3].type=="Integer"&&n.splice(n.length-3,2,new N(n[n.length-3].value+n[n.length-2].value,"String",n[n.length-3].start,n[n.length-2].end))}else n.splice(n.length-1,0,new N(e.value.substring(a,t),"String",a,t)),n.length-3>=0&&n[n.length-3].type=="Integer"&&n.splice(n.length-3,2,new N(n[n.length-3].value+n[n.length-2].value,"String",n[n.length-3].start,n[n.length-2].end));a=-1}}else a==-1&&(a=t);t=i+1,i=e.value.length}return a!=-1&&(n.push(new N(e.value.substring(a,i),"String",a,i)),n.length-3>=0&&n[n.length-3].type=="Integer"&&n.splice(n.length-3,2,new N(n[n.length-3].value+n[n.length-2].value,"String",n[n.length-3].start,n[n.length-2].end)),a=-1),n}MatchTypes(e,t){if(e==t)return!0;switch(t){case"string":if(e=="String")return!0;break;case"number":if(e=="Integer")return!0;break;case"selector":if(e=="Selector"||e=="String"||e=="Long String"||e=="Complex Selector")return!0;break;case"coordinate":if(e=="Integer"||e=="Position")return!0;break;case"boolean":if(e=="Boolean")return!0;break;case"jsonData":if(e=="JSON")return!0;break;case"scoreData":if(e=="Score Data")return!0;break;case"Score":if(e=="Range"||e=="Integer")return!0;break;case"blockState":if(e=="Block State")return!0;break}return!1}ValidateSelector(e,t,i){let n=[],a=[];if(e.length==0)return n.push(new F("selectors.emptyComplex",t,i)),[n,a];let r=[];for(let o=0;o<e.length/4;o++){const c=o*4;if(e[c].type!="String")return n.push(new F("selectors.expectedStringAsAttribute",e[c].start,e[c].end)),[n,a];let d=e[c].value,p=!1,u=null;for(let g=0;g<this.generalSelectorArgsData.length;g++){const w=this.generalSelectorArgsData[g];if(w.argumentName==d){u=w,p=!0;break}}if(!p)return n.push(new F(["selectors.invalidSelectorAttribute.part1","$"+d,"selectors.invalidSelectorAttribute.part2"],e[c].start,e[c].end)),[n,a];if(1+c>=e.length)return n.push(new F("common.expectedEquals",e[c].start,e[c].end)),[n,a];if(!(e[1+c].value=="="&&e[1].type=="Symbol"))return n.push(new F("common.expectedEquals",e[c+1].start,e[c+1].end)),[n,a];if(2+c>=e.length)return n.push(new F("common.expectedValue",e[c+1].start,e[c+1].end)),[n,a];let f=!1,h=e[2+c];if(e[2+c].value=="!"&&e[2+c].type=="Symbol"&&(h=e[3+c],f=!0),u.additionalData){if(!u.additionalData.supportsNegation&&f)return n.push(new F(["selectors.unsupportedNegation.part1","$"+d,"selectors.unsupportedNegation.part2"],e[2+c].start,h.end)),[n,a];if(u.additionalData.multipleInstancesAllowed=="never"&&r.includes(d))return n.push(new F(["selectors.multipleInstancesNever.part1","$"+d,"selectors.multipleInstancesNever.part2"],e[c].start,h.end)),[n,a];if(u.additionalData.multipleInstancesAllowed=="whenNegated"&&!f&&r.includes(d))return n.push(new F(["selectors.multipleInstancesNegated.part1","$"+d,"selectors.multipleInstancesNegated.part1"],e[c].start,h.end)),[n,a];let g=u.type;if(d=="name"&&(g="selector"),!this.MatchTypes(h.type,g))return n.push(new F(["common.expectedType.part1","$"+g,"common.expectedType.part2","$"+h.type,"common.expectedType.part3"],h.start,h.end)),[n,a];if(u.additionalData.values&&!u.additionalData.values.includes(h.value))return n.push(new F(["selectors.valueNotValid.part1","$"+h.value,"selectors.valueNotValid.part2"],h.start,h.end)),[n,a];if(u.additionalData.schemaReference){let w=u.additionalData.schemaReference,C=new Zi(w,"$ref",w).getCompletionItems({}),P=!1;for(let x=0;x<C.length;x++)C[x].value==h.value&&(P=!0);P||(d=="family"?a.push(new bt(["schema.familyNotFound.part1","$"+h.value,"schema.familyNotFound.part2"],h.start,h.end)):d=="type"?a.push(new bt(["schema.typeNotFound.part1","$"+h.value,"schema.typeNotFound.part2"],h.start,h.end)):d=="tag"?a.push(new bt(["schema.tagNotFound.part1","$"+h.value,"schema.tagNotFound.part2"],h.start,h.end)):a.push(new bt(["schema.schemaValueNotFound.part1","$"+h.value,"schema.schemaValueNotFound.part2"],h.start,h.end)))}}let m=3;if(f&&(m=4),m+c<e.length&&!(e[m+c].value==","&&e[m+c].type=="Symbol"))return n.push(new F("common.expectedComma",e[m+c].start,e[m+c].end)),[n,a]}return[n,a]}ValidateJSON(e){let t=[],i=[],n="{";for(let a=0;a<e.length;a++)e[a].type=="Long String"?n+='"'+e[a].value+'"':n+=e[a].value;n+="}";try{JSON.parse(n)}catch{t.push("jsonNotValid")}return[t,i]}ValidateScoreData(e,t,i){let n=[],a=[];if(e.length==0)return n.push(new F("scoreData.empty",t,i)),[n,a];let r=[];for(let o=0;o<e.length/4;o++){const c=o*4;let d=e[c].value;if(e[c].type!="String")return n.push(new F("scoreData.expectedStringAsAttribute",e[c].start,e[c].end)),[n,a];if(1+c>=e.length)return n.push(new F("common.expectedEquals",e[c].start,e[c].end)),[n,a];if(!(e[1+c].value=="="&&e[1].type=="Symbol"))return n.push(new F("common.expectedEquals",e[c+1].start,e[c+1].end)),[n,a];if(2+c>=e.length)return n.push(new F("common.expectedValue",e[c+1].start,e[c+1].end)),[n,a];let p=e[2+c];if(!this.MatchTypes(p.type,"Score"))return n.push(new F(["scoreData.invalidType.part1","$"+p.type,"scoreData.invalidType.part2"],e[c+2].start,e[c+2].end)),[n,a];if(r.includes(p.value))return n.push(new F("scoreData.repeat",e[c+2].start,e[c+2].end)),[n,a];if(3+c<e.length&&!(e[3+c].value==","&&e[3+c].type=="Symbol"))return n.push(new F("common.expectedComa",e[c+3].start,e[c+3].end)),[n,a];r.push(d)}return[n,a]}ValidateBlockState(e){let t=[],i=[];if(e.length==0)return[t,i];let n=[];for(let a=0;a<e.length/4;a++){const r=a*4;let o=e[0+r].value;if(e[0+r].type!="Long String")return t.push("blockStateExpectedLongStringAsValue"),[t,i];if(1+r>=e.length)return t.push("expectedColonButNothing"),[t,i];if(!(e[1+r].value==":"&&e[1].type=="Symbol"))return t.push("expectedColon"),[t,i];if(2+r>=e.length)return t.push("expectedValueButNothing"),[t,i];let c=e[2+r];if(this.blockStateData){let d,p=Object.getOwnPropertyNames(this.blockStateData.properties);for(let f=0;f<p.length;f++)if(p[f]==o){d=this.blockStateData.properties[p[f]],d.name=p[f];break}let u=d.enum;for(let f=0;f<u.length;f++)u[f]=u[f].toString();if(!u.includes(c.value))return t.push("invalidBlockStateValue.part1"+c.value+"invalidBlockStateValue.part2"),[t,i]}if(n.includes(c.value))return t.push("repeatOfBlockState"),[t,i];if(3+r<e.length&&e[3+r].value==","&&e[3+r].type=="Symbol")return t.push("expectedComa"),[t,i];n.push(o)}return[t,i]}ValidateCommand(e,t=null){let i=[],n=[];this.blockStateData||n.push(new bt("data.missingData",0,0));let a,r=!1,o=[],c;if(t)o=t,c=o.shift();else{e!=null&&e.startsWith("/")&&(e=e.substring(1)),a=e.split('"');let p=-1;for(let u=0;u<a.length;u++){if(r){let f=0;o.length>0&&(f=o[o.length-1].end+1),o.push(new N(a[u],"Long String",f,f+a[u].length))}else{let f=0;o.length>0&&(f=o[o.length-1].end+1),o.push(new N(a[u],"Dirty",f,f+a[u].length))}r=!r,p=u}if(!r)return i.push(new F("common.unclosedString",o[p].start,o[o.length-1].end)),[i,n];for(let u=0;u<o.length;u++)if(o[u].type=="Dirty"){let f=this.ParseDirty(o[u]);for(let h=0;h<f.length;h++)o.splice(u+h+1,0,f[h]);o.splice(u,1),u+=f.length-1}if(o.length>0){if(o[0].type=="Space")return i.push(new F("common.spaceAtStart",o[p].start,o[p].end)),[i,n];if(o.length==0)return i.push(new F("commands.empty")),[i,n];if(c=o[0],c=o.shift(),!this.validCommands.includes(c.value))return i.push(new F(["command.invalid.part1","$"+c.value,"command.invalid.part2"],c.start,c.end)),[i,n];for(let b=0;b<o.length;b++){const y=o[b];if(y.type=="Symbol"&&y.value==":"){if(b+1>=o.length)return i.push(new F("common.exptectedColon",y.start,y.end)),[i,n];if(b-1<0)return i.push(new F("identifiers.missingNamespace",y.start,y.end)),[i,n];if(o[b-1].type=="Space")return i.push(new F("identifiers.missingNamespace",y.start,y.end)),[i,n];let j=o[b-1],T=o[b+1];j.type=="String"&&T.type=="String"&&(o[b-1]=new N(j.value+":"+T.value,"String"),o.splice(b,2))}}for(let b=0;b<o.length;b++)o[b].type=="Space"&&(o.splice(b,1),b--);for(let b=0;b<o.length;b++){const y=o[b];if(y.type=="Symbol"&&(y.value=="~"||y.value=="^")){if(b+1<o.length){let j=o[b+1];j.type=="Integer"?(o[b]=new N(y.value+j.value,"Position"),o.splice(b+1,1)):o[b]=new N(y.value,"Position")}o[b]=new N(y.value,"Position")}}let u=!1,f=[];for(let b=0;b<o.length;b++){const y=o[b];if(y.type=="Symbol"&&y.value=="{"){if(u)return i.push(new F("common.unexpectedOpenBracket",y.start,y.end)),[i,n];u=!0}else if(y.type=="Symbol"&&y.value=="}")if(u){if(u=!1,this.ValidateJSON(f)[0].length==0){let T=b-f.length-1;o.splice(T,f.length+2,o[T]=new N(o[T].value,"JSON"))}f=[]}else return i.push(new F("common.unexpectedClosedCurlyBracket",y.start,y.end)),[i,n];else u&&f.push(y)}for(let b=0;b<o.length;b++){const y=o[b];if(y.type=="Symbol"&&y.value=="."){if(b+-1<0)return i.push(new F("ranges.missingFirstNumber",y.start,y.end)),[i,n];if(b+1>=o.length)return i.push(new F("ranges.missingDot",o[b-1].start,y.end)),[i,n];if(b+2>=o.length)return i.push(new F("ranges.missingSecondNumber",o[b-1].start,o[b+1].end)),[i,n];let j=o[b-1],T=o[b+2],re=o[b+1];if(j.type!="Integer")return i.push(new F("ranges.missingFirstNumber",y.start,y.end)),[i,n];if(!(re.value=="."&&re.type=="Symbol"))return i.push(new F("ranges.missingDot",o[b-1].start,y.end)),[i,n];if(T.type!="Integer")return i.push(new F("ranges.missingSecondNumber",o[b-1].start,o[b+1].end)),[i,n];o[b-1]=new N(j.value+" "+T.value,"Range"),o.splice(b,3)}}let h=!1,m=[],g=0,w=0;for(let b=0;b<o.length;b++){const y=o[b];if(y.type=="Symbol"&&y.value=="{"){if(h)return i.push(new F("common.unexpectedOpenCurlyBracket",y.start,y.end)),[i,n];h=!0,g=y.start}else if(y.type=="Symbol"&&y.value=="}")if(h){h=!1,w=y.end;let j=this.ValidateScoreData(m,g,w);if(i=i.concat(j[0]),n=n.concat(j[1]),i.length>0)return[i,n];let T=b-m.length-1;o.splice(T,m.length+2,o[T]=new N(o[T].value,"Score Data")),m=[]}else return i.push(new F("common.unexpectedClosedCurlyBracket",y.start,y.end)),[i,n];else h&&m.push(y)}for(let b=0;b<o.length;b++){const y=o[b];if(y.type=="Symbol"&&y.value=="@"){if(b+1>=o.length)return i.push(new F("selectors.expectedLetterAfterAt",y.start,y.end)),[i,n];let j=o[b+1];if(j.type!="String")return i.push(new F("selectors.expectedLetterAfterAt",y.start,y.end)),[i,n];if(!this.selectorTargets.includes(j.value))return i.push(new F(["selectors.invalid.part1","$"+j.value,"iselectors.invalid.part2"],y.start,o[b+1].end)),[i,n];o[b]=new N("@"+j.value,"Selector"),o.splice(b+1,1)}}let v=!1,C=[];for(let b=0;b<o.length;b++){const y=o[b];if(y.type=="Symbol"&&y.value=="["){if(v)return i.push(new F("common.unexpectedOpenSquareBracket",y.start,y.end)),[i,n];v=!0}else if(y.type=="Symbol"&&y.value=="]")if(v){v=!1;let j=this.ValidateBlockState(C);if(n=n.concat(j[1]),j[0].length==0){let T=b-C.length-1;o.splice(T,C.length+2,o[T]=new N(o[T].value,"Block State"))}C=[]}else return i.push(new F("common.unexpectedClosedSquareBracket",y.start,y.end)),[i,n];else v&&C.push(y)}let P=!1,x=[];g=0,w=0;for(let b=0;b<o.length;b++){const y=o[b];if(y.type=="Symbol"&&y.value=="["){if(P)return i.push(new F("common.unexpectedOpenSquareBracket",y.start,y.end)),[i,n];if(b-1<0)return i.push(new F("identifiers.selectorNotBeforeOpenSquareBracket",y.start,y.end)),[i,n];if(o[b-1].type!="Selector")return i.push(new F("identifiers.selectorNotBeforeOpenSquareBracket",y.start,y.end)),[i,n];P=!0,g=y.start}else if(y.type=="Symbol"&&y.value=="]")if(P){P=!1,w=y.end;let j=this.ValidateSelector(x,g,w);if(i=i.concat(j[0]),n=n.concat(j[1]),i.length>0)return[i,n];let T=b-x.length-2;o.splice(T,x.length+3,o[T]=new N(o[T].value,"Complex Selector")),x=[]}else return i.push(new F("common.unexpectedClosedSquareBracket",y.start,y.end)),[i,n];else P&&x.push(y)}}}let d=[];for(let p=0;p<this.generalCommandData.length;p++)this.generalCommandData[p].commandName==c.value&&d.push(this.generalCommandData[p].arguments);Array.from(d);for(let p=0;p<o.length;p++){const u=o[p];for(let f=0;f<d.length;f++){const h=d[f];if(h.length<=p){if(h[h.length-1].type!="command"){d.splice(f,1),f--;continue}}else if(h[p].type=="command"){let m=o.slice(p,o.length);this.ValidateCommand(null,m)[0].length>0&&(d.splice(f,1),f--)}else this.MatchTypes(u.type,h[p].type)||(d.splice(f,1),f--)}if(d.length==0)return i.push(new F(["arguments.noneValid.part1","$"+(p+1),"arguments.noneValid.part2","$"+u.type,"arguments.noneValid.part3"],u.start,u.end)),[i,n];Array.from(d)}for(let p=0;p<d.length;p++){const u=d[p];if(o.length<u.length){u[o.length].isOptional||(d.splice(p,1),p--);continue}}return d.length==0?(i.push(new F(["arguments.noneValidEnd.part1","$"+o.length,"arguments.noneValidEnd.part2"],o[o.length-1].start,o[o.length-1].end)),[i,n]):[i,n]}}const Pf={wordPattern:/[aA-zZ]+/,comments:{lineComment:"#"},brackets:[["(",")"],["[","]"],["{","}"]],autoClosingPairs:[{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"},{open:'"',close:'"'}]},jf={triggerCharacters:[" ","[","{","=",",","!"],async provideCompletionItems(s,e,t,i){const n=await l.getApp().then(h=>h.project);if(!(n instanceof Wt))return;const{Range:a}=await L(),r=n.commandData;await r.fired;const o=s.getLineContent(e.lineNumber),c=o.slice(0,e.column-1),d=Sf(o,e.column-1);if(d){const h=o.slice(d.selectorStart,e.column-1),{tokens:m}=cr(h,d.selectorStart),g=m[m.length-1];return{suggestions:await r.selectorArguments.getNextCompletionItems(m.map(w=>w.word)).then(w=>w.map(({label:v,insertText:C,documentation:P,kind:x,insertTextRules:b})=>{var y,j;return{label:v!=null?v:C,insertText:C,documentation:P,kind:x,range:new a(e.lineNumber,((y=g==null?void 0:g.startColumn)!=null?y:0)+1,e.lineNumber,((j=g==null?void 0:g.endColumn)!=null?j:0)+1),insertTextRules:b}}))}}const{tokens:p}=Xn(c),u=p[p.length-1];return{suggestions:(await r.getNextCompletionItems(p.map(h=>h.word))).map(({label:h,insertText:m,documentation:g,kind:w,insertTextRules:v})=>{var C,P;return{label:h!=null?h:m,insertText:m,documentation:g,kind:w,range:new a(e.lineNumber,((C=u==null?void 0:u.startColumn)!=null?C:0)+1,e.lineNumber,((P=u==null?void 0:u.endColumn)!=null?P:0)+1),insertTextRules:v}})}}},Ut=async s=>{const e=await l.getApp();await e.projectManager.fired;const t=e.project;if(!(t instanceof Wt))return;await t.commandData.fired,await t.compilerReady.fired;const i=await t.commandData.allCommands(void 0,!await t.compilerService.isSetup);Gt.keywords=i.map(a=>a);const n=await t.commandData.allSelectorArguments();Gt.targetSelectorArguments=n,s.updateTokenProvider(Gt)};class Ff extends Vi{constructor(){super({id:"mcfunction",extensions:["mcfunction"],config:Pf,tokenProvider:Gt,completionItemProvider:jf}),this.validator=new xf;let e=null;const t=l.eventSystem.on("projectChanged",async i=>{e=i,Ut(this),await i.compilerReady.fired,await i.compilerService.once(st(()=>{i===e&&Ut(this)}))});l.getApp().then(async i=>{await i.projectManager.projectReady.fired,this.disposables.push(i.projectManager.forEachProject(n=>{this.disposables.push(n.fileSave.any.on(([a])=>{l.fileType.getId(a)==="customCommand"&&Ut(this)}))}),t)})}onModelAdded(e){return super.onModelAdded(e)?(Ut(this),!0):!1}validate(){}}const Tf={comments:{lineComment:"#"},brackets:[["(",")"],["[","]"],["{","}"]],autoClosingPairs:[{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"},{open:"'",close:"'"}]},Af={ignoreCase:!0,brackets:[["(",")","delimiter.parenthesis"],["[","]","delimiter.square"],["{","}","delimiter.curly"]],keywords:["return","loop","for_each","break","continue","this","function"],identifiers:["v","t","c","q","f","a","arg","variable","temp","context","query"],tokenizer:{root:[[/#.*/,"comment"],[/'[^']'/,"string"],[/[0-9]+(\.[0-9]+)?/,"number"],[/true|false/,"number"],[/\=|\,|\!|%=|\*=|\+=|-=|\/=|<|=|>|<>/,"definition"],[/[a-z_$][\w$]*/,{cases:{"@keywords":"keyword","@identifiers":"type.identifier","@default":"identifier"}}]]}};class $f extends Vi{constructor(){super({id:"molang",extensions:["molang"],config:Tf,tokenProvider:Af}),this.molang=new lr({})}async validate(e){const{editor:t,MarkerSeverity:i}=await L();try{this.molang.parse(e.getValue()),t.setModelMarkers(e,this.id,[])}catch(n){let{startColumn:a=0,endColumn:r=1/0,startLineNumber:o=0,endLineNumber:c=1/0}={};t.setModelMarkers(e,this.id,[{startColumn:a+1,endColumn:r+1,startLineNumber:o+1,endLineNumber:c+1,message:n.message,severity:i.Error}])}}}class Df{constructor(){this.mcfunction=new Ff,this.otherLanguages=new Set([new $f,new yo])}}function Ef(s={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:i,onRegistered:n,onRegisterError:a}=s;let r,o;const c=async(d=!0)=>{d&&(r==null||r.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()})),o&&o.waiting&&await pr(o.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){r=new dr("/service-worker.js",{scope:"/",type:"classic"}),r.addEventListener("activated",d=>{d.isUpdate||i==null||i()});{const d=()=>{t==null||t()};r.addEventListener("waiting",d),r.addEventListener("externalwaiting",d)}r.register({immediate:e}).then(d=>{o=d,n==null||n(d)}).catch(d=>{a==null||a(d)})}return c}const Mf=Ef({async onNeedRefresh(){console.log("New content is available; please refresh."),await pe("firstStartAfterUpdate",!0),await pe("savedAllDataInIdb",!1),li({icon:"mdi-update",color:"primary",message:"sidebar.notifications.updateAvailable.message",textColor:"white",onClick:()=>Mf()})},onOfflineReady(){console.log("bridge. is ready to work offline")}}),ia=s=>({"colorCode.darkRed":{color:"#AA0000"},"colorCode.red":{color:"#FF5555"},"colorCode.gold":{color:"#FFAA00"},"colorCode.yellow":{color:"#FFFF55"},"colorCode.darkGreen":{color:"#00AA00"},"colorCode.green":{color:"#55FF55"},"colorCode.aqua":{color:"#55FFFF"},"colorCode.darkAqua":{color:"#00AAAA"},"colorCode.darkBlue":{color:"#0000AA"},"colorCode.blue":{color:"#5555FF"},"colorCode.lightPurple":{color:"#FF55FF"},"colorCode.darkPurple":{color:"#AA00AA"},"colorCode.white":{color:"#FFFFFF"},"colorCode.gray":{color:"#AAAAAA"},"colorCode.darkGray":{color:"#555555"},"colorCode.black":{color:"#000000"},"colorCode.minecoinGold":{color:"#ff0000"},"colorCode.bold":{color:s,textDecoration:"bold"},"colorCode.italic":{color:s,textDecoration:"italic"},"colorCode.underline":{color:s,textDecoration:"underline"}}),If={id:"bridge.default.dark",name:"Default Dark",colorScheme:"dark",colors:{text:"#ffffff",primary:Ae?"#3bb6a3":"#0073FF",secondary:Ae?"#3bb6a3":"#0073FF",accent:Ae?"#3bb6a3":"#0073FF",error:"#ff5252",info:"#2196f3",warning:"#fb8c00",success:"#4caf50",background:"#121212",sidebarNavigation:"#1F1F1F",expandedSidebar:"#1F1F1F",sidebarSelection:"#151515",menu:"#252525",footer:"#111111",tooltip:"#1F1F1F",toolbar:"#000000",tabActive:"#121212",tabInactive:"#1F1F1F",lineHighlightBackground:"#292929",scrollbarThumb:"#000000",behaviorPack:"#ff5252",resourcePack:"#0073FF",skinPack:"#fb8c00",worldTemplate:"#4caf50"},highlighter:{type:{color:"#a6e22e"},keyword:{color:"#f92672"},definition:{color:"#fd971f"},atom:{color:"#ae81ff"},number:{color:"#ae81ff"},string:{color:"#e6db74"},variable:{color:"#6e9eff"},variableStrong:{color:"#6e9eff"},meta:{color:"white"},comment:{color:"#75715e"},...ia("#fff")}},Of={id:"bridge.default.light",name:"Default Light",colorScheme:"light",colors:{text:"#000000",primary:Ae?"#3bb6a3":"#0073FF",secondary:Ae?"#3bb6a3":"#0073FF",accent:Ae?"#3bb6a3":"#0073FF",error:"#ff5252",info:"#2196f3",warning:"#fb8c00",success:"#4caf50",background:"#fafafa",sidebarNavigation:"#e8e8e8",expandedSidebar:"#e8e8e8",sidebarSelection:"#FFFFFF",menu:"#FFFFFF",tooltip:"#424242",toolbar:"#e0e0e0",footer:"#f5f5f5",tabActive:"#fafafa",tabInactive:"#e0e0e0",lineHighlightBackground:"#e0e0e0",scrollbarThumb:"#c8c8c8",behaviorPack:"#ff5252",resourcePack:"#0073FF",skinPack:"#fb8c00",worldTemplate:"#4caf50"},highlighter:{type:{color:"black"},keyword:{color:"#5A5CAD"},definition:{textDecoration:"underline"},atom:{color:"#6C8CD5"},number:{color:"#164"},string:{color:"red"},variable:{color:"black"},variableStrong:{color:"black"},meta:{color:"yellow"},comment:{color:"#0080FF"},...ia("#000")}};class Rf{constructor(e,t){var i;this.themeDefinition=e,this.isGlobal=t,this.id=e.id,this.name=e.name,this.colorScheme=(i=e.colorScheme)!=null?i:"dark",this.colorMap=new Map(Object.entries(e.colors)),this.monacoDef=e.monaco,this.highlighterDef=e.highlighter,this.monacoSubTheme=new Tc(this)}apply(e,t){var i;We.set(t.theme.themes,this.colorScheme,Object.fromEntries(this.colorMap.entries())),We.set(t.theme,"dark",this.colorScheme==="dark"),e.setThemeColor((i=this.colorMap.get("toolbar"))!=null?i:"red"),this.applyMonacoTheme()}async applyMonacoTheme(){await this.monacoSubTheme.apply()}getColor(e){var t;return(t=this.colorMap.get(e))!=null?t:"red"}getHighlighterInfo(e){var t;return(t=this.highlighterDef)==null?void 0:t[e]}getMonacoDefinition(){var e;return(e=this.monacoDef)!=null?e:{}}getHighlighterDefinition(){var e;return(e=this.highlighterDef)!=null?e:{}}getThemeDefinition(){return this.themeDefinition}}class Wf extends H{constructor(e){var a,r;super(),this.vuetify=e,this.themeMap=new Map,this.themeColorTag=null,this.currentTheme="bridge.default.dark",this.colorScheme=new $;const t=window.matchMedia("(prefers-color-scheme: light)");this.mode=t.matches?"light":"dark";const i=o=>{this.colorScheme.dispatch(o.matches?"light":"dark"),this.mode=o.matches?"light":"dark",this.updateTheme()};"addEventListener"in t?t.addEventListener("change",o=>i(o)):t.addListener(o=>i(o));const n=document.querySelectorAll("meta[name='theme-color']");this.themeColorTag=(a=n[0])!=null?a:null,this.themeColorTag.removeAttribute("media"),(r=n[1])==null||r.remove(),this.themeColorTag||(this.themeColorTag=document.createElement("meta"),this.themeColorTag.setAttribute("name","theme-color"),document.head.appendChild(this.themeColorTag)),this.themeColorTag.id="theme-color-tag",this.addTheme(If,!0),this.addTheme(Of,!0),this.applyTheme(this.themeMap.get("bridge.default.dark"))}getCurrentMode(){return this.mode}getCurrentTheme(){return this.themeMap.get(this.currentTheme)}applyTheme(e){e==null||e.apply(this,this.vuetify)}async applyMonacoTheme(){var e;(e=this.themeMap.get(this.currentTheme))==null||e.applyMonacoTheme()}async updateTheme(){var d,p,u,f,h;const e=await l.getApp();let t=(d=S==null?void 0:S.appearance)==null?void 0:d.colorScheme;(!t||t==="auto")&&(t=this.mode),await e.projectManager.projectReady.fired;const i=e.projectConfig.get().bridge,n=(p=t==="light"?i==null?void 0:i.lightTheme:i==null?void 0:i.darkTheme)!=null?p:"bridge.noSelection",a=(f=(u=S==null?void 0:S.appearance)==null?void 0:u[`${t}Theme`])!=null?f:`bridge.default.${t}`,r=n!=="bridge.noSelection"?n:a,o=this.themeMap.get(n!=="bridge.noSelection"?n:a),c=this.themeMap.get(`bridge.default.${t}`);this.currentTheme!==(o?r:`bridge.default.${t}`)&&(this.currentTheme=o?r:`bridge.default.${t}`,this.applyTheme(o!=null?o:c),this.dispatch((h=o==null?void 0:o.colorScheme)!=null?h:"dark"))}async loadDefaultThemes(e){await e.dataLoader.fired,(await e.dataLoader.readJSON("data/packages/common/themes.json")).map(i=>this.addTheme(i,!0)),this.updateTheme()}async loadTheme(e,t=!0,i){const n=await e.getFile();let a;try{a=R.parse(await n.text())}catch{throw new Error(`Failed to load theme "${n.name}"`)}const r=this.addTheme(a,t);i&&i.push(r)}getThemes(e,t){const i=[];for(const[n,a]of this.themeMap)(!e||a.colorScheme===e)&&(a.isGlobal||t===a.isGlobal)&&i.push(a);return i}setThemeColor(e){this.themeColorTag.setAttribute("content",e)}addTheme(e,t){var n,a;const i=this.themeMap.get(`bridge.default.${(n=e.colorScheme)!=null?n:"dark"}`);return this.themeMap.set(e.id,new Rf(si((a=i==null?void 0:i.getThemeDefinition())!=null?a:{},e),t)),this.updateTheme(),{dispose:()=>this.themeMap.delete(e.id)}}getColor(e){const t=this.themeMap.get(this.currentTheme);if(!t)throw new Error("No theme currently loaded");return t.getColor(e)}getHighlighterInfo(e){const t=this.themeMap.get(this.currentTheme);if(!t)throw new Error("No theme currently loaded");return t.getHighlighterInfo(e)}}const na=class{constructor(){this.confirmPermissionWindow=null,this._status="waiting"}get status(){return this._status}setStatus(s){this._status=s}async setupFileSystem(s){var i;let e=await fe("bridgeBaseDir");!A.value&&e&&(e=await this.verifyPermissions(e));let t=!1;if((A.value||await xr("bridgeFolder")&&((i=await Bi("projects"))!=null?i:[]).length>0)&&(A.value||await new W({title:"windows.upgradeFs.title",description:"windows.upgradeFs.description",cancelText:"general.later",onCancel:()=>{A.value=!0},onConfirm:async()=>{t=!0,A.value=!1}}).fired,t||(e=k(new te(null,"bridgeFolder",void 0)),await e.setupDone.fired)),!e){const n=na.state;n.showInitialSetupDialog.value=!0,e=await n.receiveDirectoryHandle.fired,await this.verifyPermissions(e);try{e instanceof te||await pe("bridgeBaseDir",e)}catch{}n.setupDone.dispatch()}if(A.value&&!await fe("confirmedUnsupportedBrowser")&&s.windows.browserUnsupported.open(),t){const n=k(new te(null,"bridgeFolder",void 0));await n.setupDone.fired;const a=new Z(n),r=new Z(e),o=["projects","extensions"];for(const d of o){const p=await a.getDirectoryHandle(d).catch(()=>{});!p||(await r.copyFolderByHandle(p,await r.getDirectoryHandle(d,{create:!0})),await p.removeSelf())}const c=["data/settings.json"];for(const d of c){const p=await a.getFileHandle(d).catch(()=>{});!p||await r.fileExists(d)||(await r.copyFileHandle(p,await r.getFileHandle(d,!0)),await p.removeSelf())}}return this._status="done",e}async verifyPermissions(s,e=!0){if(typeof s.requestPermission!="function"||typeof s.queryPermission!="function")return await s.getDirectoryHandle("data",{create:!0}),s;const t={writable:!0,mode:"readwrite"};try{e&&await s.requestPermission(t)!=="granted"&&await this.verifyPermissions(s,!1)}catch{}await s.queryPermission(t)!=="granted"&&this.confirmPermissionWindow===null&&(this.confirmPermissionWindow=new U({name:"windows.projectFolder.title",description:"windows.projectFolder.content",onClose:async()=>{this._status="userInteracted",this.confirmPermissionWindow=null,await s.requestPermission(t)!=="granted"&&await this.verifyPermissions(s,!1)}}),await this.confirmPermissionWindow.fired);try{await s.getDirectoryHandle("data",{create:!0})}catch{return}return s}};let sa=na;sa.state={showInitialSetupDialog:E(!1),receiveDirectoryHandle:new $,setupDone:new $};async function Ye(s){const e=l.instance;e.windows.loadingWindow.open();const t=new gi(A.value?e.fileSystem.baseDirectory:e.project.baseDirectory),i=`${e.project.projectPath}/builds/${s!=null?s:e.project.name}.brproject`;try{await di(i,await t.package(),e.fileSystem)}catch(n){console.error(n)}e.windows.loadingWindow.close()}class Lf{constructor(e){this.directory=e,this.fileSystem=new Z(e)}createTask(e,t={icon:"mdi-folder-zip",name:"taskManager.tasks.unzipper.name",description:"taskManager.tasks.unzipper.description"}){this.task=e.create(t)}}class $t extends Lf{unzip(e){return new Promise(async(t,i)=>{Ni(e,async(n,a)=>{var c,d,p,u,f;if(n)return i(n);const r=new Z(this.directory);(c=this.task)==null||c.update(0,Object.keys(a).length);let o=0;for(const h in a){if(me(h).startsWith(".")){(d=this.task)==null||d.update(++o),a[h]=void 0;continue}if(h.endsWith("/")){(p=this.task)==null||p.update(++o),a[h]=void 0;continue}await this.fileSystem.write(await r.getFileHandle(h,!0),a[h]),a[h]=void 0,(u=this.task)==null||u.update(++o)}(f=this.task)==null||f.complete(),t()}),e=void 0})}}async function un(s,e=!1,t=!0){const i=await l.getApp(),n=i.fileSystem,a=await n.getDirectoryHandle("import",{create:!0});if(e||await i.projectManager.projectReady.fired,t){const d=new $t(a),p=await s.getFile(),u=new Uint8Array(await p.arrayBuffer());d.createTask(i.taskManager),await d.unzip(u)}let r="import";if(!await n.fileExists("import/config.json")){if(A.value){try{await n.move("import/data","data")}catch{}try{await n.move("import/extensions","extensions")}catch{}await Me.loadSettings(i),await i.extensionLoader.reload(),be.setDefaultLanguage()}try{const[d]=await n.readdir("import/projects");r=`import/projects/${d}`}catch{return}}A.value&&!e&&await new W({description:"windows.projectChooser.openNewProject.saveCurrentProject",cancelText:"general.no",confirmText:"general.yes"}).fired&&await Ye();const o=r==="import"?`projects/${me(s.name,".brproject")}`:r.replace("import/","");await n.move(r,o);let c;e||(c=i.project),await i.projectManager.addProject(await n.getDirectoryHandle(o),!0),A.value&&!e&&await i.projectManager.removeProject(c),await n.unlink("import")}const Nf={name:"SelectedStatus",mixins:[z],props:{selected:{type:Boolean,required:!0}}};var Bf=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex align-center mb-2"},[e.selected?[t("v-icon",{staticClass:"mr-1",attrs:{color:"success",small:""}},[e._v(" mdi-checkbox-marked-circle-outline ")]),t("span",[e._v(" "+e._s(e.t("general.active"))+" ")])]:[t("v-icon",{staticClass:"mr-1",attrs:{small:""}},[e._v(" mdi-checkbox-blank-circle-outline ")]),t("span",[e._v(" "+e._s(e.t("general.inactive"))+" ")])]],2)},Vf=[],Hf=_(Nf,Bf,Vf,!1,null,null,null,null);const yi=Hf.exports;const Uf={name:"PackTypeViewer",mixins:[z],components:{SelectedStatus:yi,BridgeSheet:Ne},props:{packType:Object,selected:Boolean,isSelectable:Boolean}};var zf=function(){var e=this,t=e._self._c;return t("BridgeSheet",{directives:[{name:"ripple",rawName:"v-ripple",value:e.isSelectable,expression:"isSelectable"}],class:{"rounded-lg pa-3 content-area":!0,selected:e.selected},nativeOn:{click:function(i){return i.stopPropagation(),e.$emit("click")}}},[t("div",{staticClass:"d-flex"},[t("v-icon",{staticClass:"mr-2",attrs:{color:e.packType.color}},[e._v(" "+e._s(e.packType.icon)+" ")]),t("h1",{staticClass:"pack-type-header"},[e._v(" "+e._s(e.t(`packType.${e.packType.id}.name`))+" ")])],1),e.isSelectable?t("SelectedStatus",{attrs:{selected:e.selected}}):e._e(),e.packType.version?t("div",{staticClass:"mb-2"},[e._v(" Pack Version: v"+e._s(e.packType.version.join("."))+" ")]):e._e(),t("span",[e._v(e._s(e.t(`packType.${e.packType.id}.description`)))]),e._t("default",null,{selected:e.selected})],2)},qf=[],Jf=_(Uf,zf,qf,!1,null,"e09fc535",null,null);const aa=Jf.exports;const Gf={name:"ToogleSheet",components:{BridgeSheet:Ne},props:{value:Boolean,dark:Boolean,isToggleable:{type:Boolean,default:!0}},data(){return{internalValue:this.value}},methods:{onClick(){!this.isToggleable||(this.internalValue=!this.internalValue,this.$emit("input",this.internalValue))}}};var Kf=function(){var e=this,t=e._self._c;return t("BridgeSheet",{directives:[{name:"ripple",rawName:"v-ripple",value:e.isToggleable,expression:"isToggleable"}],class:{"content-area pa-2":!0,selected:e.internalValue},attrs:{dark:e.dark},nativeOn:{click:function(i){return e.onClick.apply(null,arguments)}}},[e._t("default",null,{value:e.internalValue})],2)},Yf=[],Qf=_(Gf,Kf,Yf,!1,null,"1eed6d78",null,null);const hn=Qf.exports;const Zf={name:"ExperimentalGameplay",mixins:[z],components:{ToggleSheet:hn,SelectedStatus:yi},props:{experiment:{type:Object,required:!0},isToggleable:{type:Boolean,default:!0},value:Boolean,dense:Boolean}};var Xf=function(){var e=this,t=e._self._c;return t("ToggleSheet",{attrs:{value:e.value,dark:!0,isToggleable:e.isToggleable},on:{input:function(i){return e.$emit("input",i)}},scopedSlots:e._u([{key:"default",fn:function({value:i}){return[t("div",{staticClass:"d-flex align-center"},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary"}},[e._v(" "+e._s(e.experiment.icon)+" ")]),t("h1",{staticClass:"experimental-gameplay-header"},[e._v(" "+e._s(e.t(`experimentalGameplay.${e.experiment.id}.name`))+" ")])],1),t("SelectedStatus",{attrs:{selected:i}}),e.dense?e._e():t("p",[e._v(" "+e._s(e.t(`experimentalGameplay.${e.experiment.id}.description`))+" ")])]}}])})},em=[],tm=_(Zf,Xf,em,!1,null,"272f8fd7",null,null);const ra=tm.exports;const im={name:"ExperimentalGameplay",mixins:[z],components:{ToggleSheet:hn,SelectedStatus:yi},props:{file:{type:Object,required:!0},isToggleable:{type:Boolean,default:!0},value:Boolean}};var nm=function(){var e=this,t=e._self._c;return t("ToggleSheet",{attrs:{value:e.value,dark:!0,isToggleable:e.isToggleable},on:{input:function(i){return e.$emit("input",i)}},scopedSlots:e._u([{key:"default",fn:function({value:i}){return[t("div",{staticClass:"d-flex align-center"},[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary"}},[e._v(" "+e._s(e.file.icon)+" ")]),t("h1",{staticClass:"individual-file-header"},[e._v(" "+e._s(e.t(`windows.createProject.individualFiles.file.${e.file.id}.name`))+" ")])],1),t("h2",{staticClass:"text-normal font-weight-light"},[e._v(" "+e._s(e.t(`packType.${e.file.packId}.name`))+" ")]),t("SelectedStatus",{attrs:{selected:i}}),t("p",[e._v(" "+e._s(e.t(`windows.createProject.individualFiles.file.${e.file.id}.description`))+" ")])]}}])})},sm=[],am=_(im,nm,sm,!1,null,"a3f2b927",null,null);const rm=am.exports;function oa(s,e){if(!e||e==="*")return!0;const t=e.split(","),i=s.name||"",n=s.type||"",a=n.replace(/\/.*$/,"");return t.some(r=>{const o=r.trim();return o.charAt(0)==="."?i.toLowerCase().endsWith(o.toLowerCase()):/\/\*$/.test(o)?a===o.replace(/\/.*$/,""):n===o})}const om=X({__name:"CreateProject",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.state,n=K(()=>e.window.projectNameRules.map(d=>p=>{const u=d(p);return u===!0?!0:t(u)}));async function a(){i.isCreatingProject=!0,await e.window.createProject(),i.isCreatingProject=!1,e.window.close()}function r(){e.window.close()}function o(d){const p=i.createOptions.packs,u=p.indexOf(d);u>-1?p.splice(u,1):p.push(d)}function c(d){var u;const p=(u=d.dataTransfer)==null?void 0:u.files[0];!p||!oa(p,"image/png")||(i.createOptions.icon=p)}return{__sfc:!0,t,props:e,state:i,nameRules:n,createProject:a,close:r,togglePack:o,onDropFile:c,BaseWindow:de,PackTypeViewer:aa,ExperimentalGameplay:ra,CreateFile:rm,BridgeSheet:Ne}}});var cm=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"windows.createProject.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,hasCloseButton:!e.window.isFirstProject,isFullscreen:!1,isPersistent:i.state.isCreatingProject||e.window.isFirstProject,percentageWidth:80,percentageHeight:80},on:{closeWindow:i.close},scopedSlots:e._u([{key:"default",fn:function(){return[e.window.isFirstProject?t(i.BridgeSheet,{staticClass:"pa-3 mb-2"},[t("h1",[e._v(" "+e._s(i.t("windows.createProject.welcome"))+" ")]),t("span",[e._v(" "+e._s(i.t("windows.createProject.welcomeDescription"))+" ")])]):e._e(),t("v-row",{staticClass:"mb-6",attrs:{dense:""}},e._l(e.window.availablePackTypes,function(n){return t("v-col",{key:n.id,attrs:{xs:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[t(i.PackTypeViewer,{staticStyle:{height:"100%"},attrs:{packType:n,isSelectable:"",selected:i.state.createOptions.packs.includes(n.id)},on:{click:function(a){return i.togglePack(n.id)}},scopedSlots:e._u([n.id==="behaviorPack"?{key:"default",fn:function({selected:a}){return[t("v-switch",{staticClass:"mt-3",attrs:{inset:"",dense:"",label:i.t("windows.createProject.bpAsRpDependency"),value:i.state.createOptions.rpAsBpDependency||i.state.createOptions.packs.includes("resourcePack"),disabled:!a||!i.state.createOptions.packs.includes("resourcePack")},nativeOn:{click:function(r){r.stopPropagation(),i.state.createOptions.bpAsRpDependency=!i.state.createOptions.bpAsRpDependency}}})]}}:n.id==="resourcePack"?{key:"default",fn:function({selected:a}){return[t("v-switch",{staticClass:"mt-3",attrs:{inset:"",dense:"",label:i.t("windows.createProject.rpAsBpDependency"),value:i.state.createOptions.rpAsBpDependency||i.state.createOptions.packs.includes("behaviorPack"),disabled:!a||!i.state.createOptions.packs.includes("behaviorPack")},nativeOn:{click:function(r){r.stopPropagation(),i.state.createOptions.rpAsBpDependency=!i.state.createOptions.rpAsBpDependency}}})]}}:null],null,!0)})],1)}),1),t("v-expansion-panels",{staticClass:"mb-6"},[t("v-expansion-panel",[t("v-expansion-panel-header",{attrs:{color:"expandedSidebar","expand-icon":"mdi-menu-down"}},[e._v(" "+e._s(i.t("general.experimentalGameplay"))+" ")]),t("v-expansion-panel-content",{attrs:{color:"expandedSidebar"}},[t("v-row",{attrs:{dense:""}},e._l(e.window.experimentalToggles,function(n){return t("v-col",{key:n.id,attrs:{xs:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[t(i.ExperimentalGameplay,{staticStyle:{height:"100%"},attrs:{experiment:n},model:{value:i.state.createOptions.experimentalGameplay[n.id],callback:function(a){e.$set(i.state.createOptions.experimentalGameplay,n.id,a)},expression:`
									state.createOptions
										.experimentalGameplay[experiment.id]
								`}})],1)}),1)],1)],1)],1),e.window.packCreateFiles.length>0?t("v-expansion-panels",{staticClass:"mb-6"},[t("v-expansion-panel",[t("v-expansion-panel-header",{attrs:{color:"expandedSidebar","expand-icon":"mdi-menu-down"}},[e._v(" "+e._s(i.t("windows.createProject.individualFiles.name"))+" ")]),t("v-expansion-panel-content",{attrs:{color:"expandedSidebar"}},[t("v-row",{attrs:{dense:""}},e._l(e.window.packCreateFiles,function(n,a){return t("v-col",{key:`${a}-${n.id}`,attrs:{xs:"12",sm:"6",md:"4",lg:"3",xl:"3"}},[t(i.CreateFile,{staticStyle:{height:"100%"},attrs:{file:n},model:{value:n.isActive,callback:function(r){e.$set(n,"isActive",r)},expression:"file.isActive"}})],1)}),1)],1)],1)],1):e._e(),t("div",{staticClass:"d-flex"},[t("div",{staticStyle:{width:"40%"},on:{drop:function(n){return n.preventDefault(),n.stopPropagation(),i.onDropFile.apply(null,arguments)},dragover:function(n){n.preventDefault(),n.stopPropagation()}}},[t("v-file-input",{staticClass:"mr-2",attrs:{label:i.t("windows.createProject.packIcon"),"prepend-icon":null,"prepend-inner-icon":"mdi-image-outline",accept:"image/png",outlined:"",dense:""},model:{value:i.state.createOptions.icon,callback:function(n){e.$set(i.state.createOptions,"icon",n)},expression:"state.createOptions.icon"}})],1),t("v-text-field",{staticClass:"ml-2",attrs:{label:i.t("windows.createProject.projectName.name"),rules:i.nameRules,autocomplete:"off",outlined:"",dense:""},model:{value:i.state.createOptions.name,callback:function(n){e.$set(i.state.createOptions,"name",n)},expression:"state.createOptions.name"}})],1),t("v-textarea",{attrs:{label:i.t("windows.createProject.projectDescription"),autocomplete:"off","auto-grow":"",rows:"1",counter:"",outlined:"",dense:""},model:{value:i.state.createOptions.description,callback:function(n){e.$set(i.state.createOptions,"description",n)},expression:"state.createOptions.description"}}),t("div",{staticClass:"d-flex"},[t("v-text-field",{staticClass:"mr-2",attrs:{label:i.t("windows.createProject.projectPrefix"),autocomplete:"off",outlined:"",dense:""},model:{value:i.state.createOptions.namespace,callback:function(n){e.$set(i.state.createOptions,"namespace",n)},expression:"state.createOptions.namespace"}}),t("v-text-field",{staticClass:"mx-2",attrs:{label:i.t("windows.createProject.projectAuthor"),autocomplete:"off",outlined:"",dense:""},model:{value:i.state.createOptions.author,callback:function(n){e.$set(i.state.createOptions,"author",n)},expression:"state.createOptions.author"}}),t("v-autocomplete",{staticClass:"ml-2",attrs:{label:i.t("windows.createProject.projectTargetVersion"),autocomplete:"off","menu-props":{maxHeight:220,rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},items:e.window.availableTargetVersions,loading:i.state.availableTargetVersionsLoading,outlined:"",dense:""},model:{value:i.state.createOptions.targetVersion,callback:function(n){e.$set(i.state.createOptions,"targetVersion",n)},expression:"state.createOptions.targetVersion"}})],1),t("div",{staticClass:"d-flex flex-column"},[t("v-switch",{attrs:{inset:"",dense:"",label:i.t("windows.createProject.useLangForManifest")},model:{value:i.state.createOptions.useLangForManifest,callback:function(n){e.$set(i.state.createOptions,"useLangForManifest",n)},expression:"state.createOptions.useLangForManifest"}}),t("v-switch",{attrs:{inset:"",dense:"",label:i.t("windows.createProject.bdsProject")},model:{value:i.state.createOptions.bdsProject,callback:function(n){e.$set(i.state.createOptions,"bdsProject",n)},expression:"state.createOptions.bdsProject"}})],1)]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary",disabled:!e.window.hasRequiredData||i.state.isCreatingProject,loading:i.state.isCreatingProject},on:{click:i.createProject}},[t("v-icon",{staticClass:"pr-2"},[e._v("mdi-plus")]),t("span",[e._v(e._s(i.t("windows.createProject.create")))])],1)]},proxy:!0}],null,!1,3624044562)}):e._e()},lm=[],dm=_(om,cm,lm,!1,null,"1c074f05",null,null);const pm=dm.exports;class wt{async create(e,t){await e.mkdir(this.packPath);for(const i of this.createFiles)!i.isActive||await i.create(e,t)}}class ee{constructor(){this.icon="mdi-file-outline",this.isActive=!0,this.isConfigurable=!0}}class vi extends ee{constructor(e){super(),this.pack=e,this.id="packManifest",this.isConfigurable=!1}get type(){switch(this.pack){case"BP":return"data";case"RP":return"resources";case"SP":return"skin_pack";case"WT":return"world_template"}}async transformTargetVersion(e){var n;return(n=(await(await l.getApp()).dataLoader.readJSON("data/packages/minecraftBedrock/minEngineVersionMap.json"))[e])!=null?n:e}async create(e,t){var n,a,r,o,c,d,p,u,f,h,m;t.packs.includes("behaviorPack")&&((a=(n=t.uuids).data)!=null||(n.data=D())),t.packs.includes("resourcePack")&&((o=(r=t.uuids).resources)!=null||(r.resources=D())),t.packs.includes("skinPack")&&((d=(c=t.uuids).skin_pack)!=null||(c.skin_pack=D())),t.packs.includes("worldTemplate")&&((u=(p=t.uuids).world_template)!=null||(p.world_template=D()));const i={format_version:2,metadata:{authors:Array.isArray(t.author)?t.author:[t.author],generated_with:{bridge:[we],dash:[qt]}},header:{name:t.useLangForManifest?t.name:"pack.name",description:t.useLangForManifest?t.description:"pack.description",min_engine_version:(this.type,(await this.transformTargetVersion(t.targetVersion)).split(".").map(g=>Number(g))),uuid:(h=t.uuids[(f=this.type)!=null?f:"data"])!=null?h:D(),version:[1,0,0]},modules:[{type:this.type,uuid:D(),version:[1,0,0]}]};if(t.rpAsBpDependency&&t.packs.includes("resourcePack")&&this.type==="data"){if(!t.uuids.resources)throw new Error("Trying to register RP uuid before it was defined");i.dependencies=[{uuid:t.uuids.resources,version:[1,0,0]}]}if(t.bpAsRpDependency&&t.packs.includes("behaviorPack")&&this.type==="resources"){if(!t.uuids.data)throw new Error("Trying to register RP uuid before it was defined");i.dependencies=[{uuid:t.uuids.data,version:[1,0,0]}]}this.type==="data"&&t.experimentalGameplay.enableGameTestFramework&&(ne(t.targetVersion,"1.19.0",">=")?i.modules.push({type:"script",language:"javascript",uuid:D(),entry:"scripts/main.js",version:[1,0,0]}):i.modules.push({type:"javascript",uuid:D(),entry:"scripts/main.js",version:[1,0,0]}),(m=i.dependencies)!=null||(i.dependencies=[]),i.dependencies.push({uuid:"b26a4d4c-afdf-4690-88f8-931846312678",version:[0,1,0]},{uuid:"6f4b6893-1bb6-42fd-b458-7fa3d0c89616",version:[0,1,0]}),ne(t.targetVersion,"1.18.20",">=")&&i.dependencies.push({uuid:"2bd50a27-ab5f-4f40-a596-3641627c635e",version:[0,1,0]}),ne(t.targetVersion,"1.19.0",">=")&&t.bdsProject&&i.dependencies.push({uuid:"53d7f2bf-bf9c-49c4-ad1f-7c803d947920",version:[0,1,0]},{uuid:"777b1798-13a6-401c-9cba-0cf17e31a81b",version:[0,1,0]})),this.type==="world_template"&&(i.header.lock_template_options=!0,i.header.base_game_version=t.targetVersion.split(".").map(g=>Number(g))),await e.writeJSON(`${this.pack}/manifest.json`,i,!0)}}class ca extends ee{constructor(e){super(),this.packPath=e,this.id="lang",this.isConfigurable=!1}async create(e,t){this.packPath==="BP"&&t.useLangForManifest||(await e.mkdir(`${this.packPath}/texts`),await e.writeFile(`${this.packPath}/texts/en_US.lang`,t.useLangForManifest?"":`pack.name=${t.name} ${this.packPath}
pack.description=${t.description}`),await e.writeJSON(`${this.packPath}/texts/languages.json`,["en_US"],!0))}}class fn extends ee{constructor(e){super(),this.packPath=e,this.id="packIcon",this.isConfigurable=!1}async create(e,t){let i=t.icon;if(!i){const n=await l.getApp();await n.dataLoader.fired,i=await n.dataLoader.readFile("data/packages/common/packIcon.png")}await e.writeFile(`${this.packPath}/pack_icon.png`,i)}}class um extends ee{constructor(){super(...arguments),this.id="tick"}async create(e,t){await e.writeJSON("BP/functions/tick.json",{values:[]},!0)}}class hm extends ee{constructor(){super(...arguments),this.id="gameTestMain",this.isConfigurable=!1}async create(e,t){t.experimentalGameplay.enableGameTestFramework&&(await e.mkdir("BP/scripts",{recursive:!0}),await e.writeFile("BP/scripts/main.js",""))}}class fm extends ee{constructor(){super(...arguments),this.id="player"}async create(e){const t=await l.getApp();await t.dataLoader.fired;const i=await t.dataLoader.readJSON("data/packages/minecraftBedrock/vanilla/player.json");await e.writeJSON("BP/entities/player.json",i,!0),await e.writeFile("BP/loot_tables/empty.json","{}")}}class la extends wt{constructor(){super(...arguments),this.packPath="BP",this.createFiles=[new vi(this.packPath),new ca(this.packPath),new fn(this.packPath),new um,new hm,new fm]}}class mm extends ee{constructor(){super(...arguments),this.id="blocks"}async create(e,t){await e.writeJSON("RP/blocks.json",{format_version:[1,1,0]},!0)}}class gm extends ee{constructor(){super(...arguments),this.id="itemTexture"}async create(e,t){await e.mkdir("RP/textures",{recursive:!0}),await e.writeJSON("RP/textures/item_texture.json",{resource_pack_name:t.name,texture_name:"atlas.items",texture_data:{}},!0)}}class wm extends ee{constructor(){super(...arguments),this.id="terrainTexture"}async create(e,t){await e.mkdir("RP/textures",{recursive:!0}),await e.writeJSON("RP/textures/terrain_texture.json",{num_mip_levels:4,padding:8,resource_pack_name:t.name,texture_name:"atlas.terrain",texture_data:{}},!0)}}class ym extends ee{constructor(){super(...arguments),this.id="flipbookTextures"}async create(e,t){await e.mkdir("RP/textures",{recursive:!0}),await e.writeJSON("RP/textures/flipbook_textures.json",[],!0)}}class vm extends ee{constructor(){super(...arguments),this.id="biomesClient"}async create(e,t){await e.writeJSON("RP/biomes_client.json",{biomes:{}},!0)}}class bm extends ee{constructor(){super(...arguments),this.id="sounds"}async create(e,t){await e.writeJSON("RP/sounds.json",{},!0)}}class _m extends ee{constructor(){super(...arguments),this.id="soundDefinitions"}async create(e,t){await e.mkdir("RP/sounds",{recursive:!0}),await e.writeJSON("RP/sounds/sound_definitions.json",{format_version:"1.14.0",sound_definitions:{}},!0)}}class da extends wt{constructor(){super(...arguments),this.packPath="RP",this.createFiles=[new vi(this.packPath),new ca(this.packPath),new fn(this.packPath),new mm,new gm,new wm,new ym,new vm,new bm,new _m]}}class Sm extends ee{constructor(e){super(),this.packPath=e,this.id="lang",this.isConfigurable=!1}async create(e,t){await e.mkdir(`${this.packPath}/texts`),await e.writeFile(`${this.packPath}/texts/en_US.lang`,t.useLangForManifest?"":`skinpack.${t.namespace}=${t.name}`),await e.writeJSON(`${this.packPath}/texts/languages.json`,["en_US"],!0)}}class Cm extends ee{constructor(){super(...arguments),this.id="skins"}create(e,t){return e.writeJSON("SP/skins.json",{geometry:"skinpacks/skins.json",skins:[],serialize_name:t.namespace,localization_name:t.namespace},!0)}}class pa extends wt{constructor(){super(...arguments),this.packPath="SP",this.createFiles=[new vi(this.packPath),new Sm(this.packPath),new fn(this.packPath),new Cm]}}class km extends ee{constructor(){super(...arguments),this.id="compilerConfig",this.isConfigurable=!1}async create(e,t){await e.mkdir(".bridge/compiler")}}class xm extends wt{constructor(){super(...arguments),this.packPath=".bridge",this.createFiles=[new km]}}class Pm extends ee{constructor(){super(...arguments),this.id="gitignore"}async create(e,t){await e.writeFile(".gitignore",`Desktop.ini    
.DS_Store 
!.bridge/
.bridge/*
!.bridge/compiler/
!.bridge/extensions
builds`)}}class ua extends wt{constructor(){super(...arguments),this.packPath="WT",this.createFiles=[new vi(this.packPath)]}}class bi extends ee{constructor(){super(...arguments),this.id="bridgeConfig"}async create(e,t){await e.writeJSON("config.json",{type:"minecraftBedrock",name:t.name,namespace:t.namespace,authors:Array.isArray(t.author)?t.author:[t.author],targetVersion:t.targetVersion,description:t.description,experimentalGameplay:t.experimentalGameplay,bdsProject:t.bdsProject,packs:Object.fromEntries(t.packs.filter(i=>i!==".bridge").map(i=>[i,Et[i]])),worlds:["./worlds/*"],compiler:{plugins:["generatorScripts","typeScript","entityIdentifierAlias","customEntityComponents","customItemComponents","customBlockComponents","customCommands","moLang","formatVersionCorrection",["simpleRewrite",{packName:t.name}]]}},!0)}}class jm extends wt{constructor(){super(...arguments),this.packPath="worlds",this.createFiles=[]}}class Fm extends ee{constructor(){super(...arguments),this.id="denoConfig"}async create(e,t){await e.writeJSON("deno.json",{tasks:{setup:"deno install -A --reload -f -n dash_compiler https://raw.githubusercontent.com/bridge-core/deno-dash-compiler/main/mod.ts",watch:"dash_compiler build --mode development && dash_compiler watch",build:"dash_compiler build"}},!0)}}class yt extends Y{constructor(){super(pm,!1),this.isFirstProject=!1,this.availableTargetVersions=[],this.stableVersion="",this.packs={behaviorPack:new la,resourcePack:new da,skinPack:new pa,worldTemplate:new ua,".bridge":new xm,worlds:new jm},this.availablePackTypes=[],this.createFiles=[new Pm,new bi,new Fm],this.experimentalToggles=[],this.projectNameRules=[e=>e.match(/"|\\|\/|:|\||<|>|\*|\?|~/g)===null||"windows.createProject.projectName.invalidLetters",e=>!e.endsWith(".")||"windows.createProject.projectName.endsInPeriod",e=>e.trim()!==""||"windows.createProject.projectName.mustNotBeEmpty"],this.state=G({...super.getState(),isCreatingProject:!1,createOptions:this.getDefaultOptions(),availableTargetVersionsLoading:!0}),this.defineWindow(),l.ready.once(async e=>{await e.dataLoader.fired,this.availableTargetVersions=await Ji(),this.stableVersion=await ys(e.dataLoader),this.createOptions.targetVersion=this.stableVersion,this.state.availableTargetVersionsLoading=!1,this.experimentalToggles=await e.dataLoader.readJSON("data/packages/minecraftBedrock/experimentalGameplay.json"),this.createOptions.experimentalGameplay=Object.fromEntries(this.experimentalToggles.map(t=>[t.id,!1]))}),l.packType.ready.once(()=>{this.availablePackTypes=l.packType.all})}get createOptions(){return this.state.createOptions}get packCreateFiles(){return Object.entries(this.packs).map(([e,t])=>this.createOptions.packs.includes(e)?t.createFiles.map(i=>Object.assign(i,{packId:e})):[]).flat().filter(e=>e.isConfigurable)}get hasRequiredData(){return this.createOptions.packs.length>1&&this.projectNameRules.every(e=>e(this.createOptions.name)===!0)&&this.createOptions.namespace.length>0&&this.createOptions.author.length>0&&this.createOptions.targetVersion.length>0}open(e=!1){this.state.createOptions=this.getDefaultOptions(),this.isFirstProject=e,this.packCreateFiles.forEach(t=>t.isActive=!0),super.open()}async createProject(){const e=await l.getApp(),t=A.value&&!e.hasNoProjects&&!this.isFirstProject;let i;this.isFirstProject||(i=e.isNoProjectSelected?e.projects[0]:e.project),t&&await new W({description:"windows.createProject.saveCurrentProject",cancelText:"general.no",confirmText:"general.yes"}).fired&&await Ye(i==null?void 0:i.name);const a=await e.fileSystem.getDirectoryHandle(`projects/${this.createOptions.name}`,{create:!0}),r=new Z(a);for(const c of this.createFiles)await c.create(r,this.createOptions);const o=this.createOptions.packs.sort((c,d)=>d.localeCompare(c));for(const c of o)await this.packs[c].create(r,this.createOptions);await e.projectManager.addProject(a,!0,e.bridgeFolderSetup.hasFired),await e.extensionLoader.installFilesToCurrentProject(),t&&await e.projectManager.removeProject(i),this.state.createOptions=this.getDefaultOptions()}static getDefaultOptions(){var e,t;return{author:(t=(e=S==null?void 0:S.projects)==null?void 0:e.defaultAuthor)!=null?t:"",description:"",icon:null,name:"",namespace:"bridge",targetVersion:"",packs:[".bridge","behaviorPack","resourcePack"],rpAsBpDependency:!1,bpAsRpDependency:!1,useLangForManifest:!1,experimentalGameplay:{},uuids:{},bdsProject:!1}}getDefaultOptions(){return{...yt.getDefaultOptions(),targetVersion:this.availableTargetVersions?this.stableVersion:"",experimentalGameplay:this.experimentalToggles?Object.fromEntries(this.experimentalToggles.map(e=>[e.id,!1])):{}}}static async loadFromConfig(){var i,n,a,r,o,c,d;const e=await l.getApp();let t;try{return t=await e.project.fileSystem.readJSON("config.json"),{author:(i=t.author)!=null?i:"",description:(n=t.description)!=null?n:"",icon:null,name:(a=t.name)!=null?a:"",namespace:(r=t.namespace)!=null?r:"bridge",targetVersion:(o=t.targetVersion)!=null?o:"",packs:(c=Object.values(t.packs))!=null?c:[".bridge","behaviorPack","resourcePack"],useLangForManifest:!1,rpAsBpDependency:!1,bpAsRpDependency:!1,experimentalGameplay:(d=t.experimentalGameplay)!=null?d:{},uuids:{},bdsProject:!1}}catch{return this.getDefaultOptions()}}}function ha(s){for(const{type:e}of s)switch(e){case"data":return"behaviorPack";case"resources":return"resourcePack";case"skin_pack":return"skinPack";case"world_template":return"worldTemplate"}}async function mn(s,e=!1,t=!0){var u,f,h;const i=await l.getApp(),n=i.fileSystem,a=await n.getDirectoryHandle("import",{create:!0});if(e||await i.projectManager.projectReady.fired,t){const m=new $t(a),g=await s.getFile(),w=new Uint8Array(await g.arrayBuffer());m.createTask(i.taskManager),await m.unzip(w)}const r=s.name.replace(".mcaddon","").replace(".zip","");A.value&&!e&&await new W({description:"windows.projectChooser.openNewProject.saveCurrentProject",cancelText:"general.no",confirmText:"general.yes"}).fired&&await Ye();let o,c;const d=[".bridge"];for await(const m of a.values())if(m.kind==="file"&&m.name.endsWith(".mcpack")){const g=await a.getDirectoryHandle(me(m.name,".mcpack"),{create:!0}),w=new $t(g),v=await m.getFile(),C=new Uint8Array(await v.arrayBuffer());w.createTask(i.taskManager),await w.unzip(C),await a.removeEntry(m.name)}for await(const m of a.values())if(m.kind==="directory"&&await n.fileExists(`import/${m.name}/manifest.json`)){const g=await n.readJSON(`import/${m.name}/manifest.json`),w=(u=g==null?void 0:g.modules)!=null?u:[];o||(o=(f=g==null?void 0:g.metadata)==null?void 0:f.authors),c||(c=(h=g==null?void 0:g.header)==null?void 0:h.description);const v=ha(w);if(!v)return;d.push(v);const C=Et[v];await n.move(`import/${m.name}`,`projects/${r}/${C}`)}d.length===1&&new U({description:"fileDropper.mcaddon.missingManifests"});const p=yt.getDefaultOptions();p.name=r,p.author=o!=null?o:["Unknown"],p.description=c!=null?c:"",p.packs=d,p.targetVersion=await Qe(),await new bi().create(new Z(await n.getDirectoryHandle(`projects/${r}`,{create:!0})),p),await n.mkdir(`projects/${r}/.bridge/extensions`),await n.mkdir(`projects/${r}/.bridge/compiler`),await i.projectManager.addProject(await n.getDirectoryHandle(`projects/${r}`),!0),A.value&&!e&&await i.projectManager.removeProject(i.project),await n.unlink("import")}async function gn(){let s;try{[s]=await window.showOpenFilePicker({multiple:!1,types:[{description:"Choose a Project",accept:{"application/zip":[".brproject",".mcaddon"]}}]})}catch{return}const e=s.name;e.endsWith(".brproject")?await un(s):e.endsWith(".mcaddon")?await mn(s):new U({description:"windows.projectChooser.wrongFileType"})}async function wn(){const e=await new It("windows.projectChooser.title",{isPersistent:!1}).actionManager;e.create({icon:"mdi-plus",name:"windows.projectChooser.newProject.name",description:"windows.projectChooser.newProject.description",onTrigger:async()=>{(await l.getApp()).windows.createProject.open()}}),e.create({icon:"mdi-content-save-outline",name:"windows.projectChooser.saveCurrentProject.name",description:"windows.projectChooser.saveCurrentProject.description",onTrigger:()=>Ye()}),e.create({icon:"mdi-folder-open-outline",name:"windows.projectChooser.openNewProject.name",description:"windows.projectChooser.openNewProject.description",onTrigger:()=>gn()})}const Hn=new Map;function Tm(){let s={projectName:"",lastReadCount:0,currentCount:0},e,t=!1;const i=async o=>{await o.compilerReady.fired,o.compilerService.removeConsoleListeners()},n=async(o,c=!1)=>{c&&await i(o),await o.compilerReady.fired,o.compilerService.onConsoleUpdate(st(async()=>{let d=await o.compilerService.getCompilerLogs();d=d.filter(([p,{type:u}])=>u==="error"||u==="warning"),s.currentCount=d.length,t&&e==="logs"&&(s.lastReadCount=s.currentCount),a()}))},a=()=>{r.attachBadge({count:s.currentCount-s.lastReadCount,color:"error"})},r=nt({id:"compiler",displayName:"sidebar.compiler.name",icon:"mdi-cogs",disabled:()=>l.instance.isNoProjectSelected,onClick:async()=>{const c=(await l.getApp()).windows.compilerWindow,d=c.activeCategoryChanged.on(p=>{e=p,p==="logs"&&(s.lastReadCount=s.currentCount,a())});c.resetSignal(),c.once(async()=>{d.dispose(),t=!1,n(await l.getApp().then(p=>p.project))}),t=!0,await c.open(),e==="logs"&&(s.lastReadCount=s.currentCount,a())}});l.eventSystem.on("projectChanged",async o=>{var c;Hn.set(s.projectName,s),s=(c=Hn.get(o.name))!=null?c:{projectName:o.name,lastReadCount:0,currentCount:0},a(),await n(o,!0)})}async function Am(){nt({id:"projects",group:"projectChooser",displayName:"windows.projectChooser.title",icon:"mdi-view-dashboard-outline",disabled:()=>l.instance.hasNoProjects&&l.instance.bridgeFolderSetup.hasFired,onClick:async()=>{l.instance.hasNoProjects&&!l.instance.bridgeFolderSetup.hasFired&&!await l.instance.setupBridgeFolder()||(A.value?wn():l.instance.windows.projectChooser.open())}});const s=nt({id:"packExplorer",group:"packExplorer",displayName:"packExplorer.name",icon:"mdi-folder-outline"});l.getApp().then(e=>{s.setSidebarContent(e.packExplorer),s.setIsVisible(()=>!e.viewComMojangProject.hasComMojangProjectLoaded),l.sidebar.forcedInitialState.value||s.click()}),nt({id:"fileSearch",displayName:"findAndReplace.name",icon:"mdi-file-search-outline",disabled:()=>l.instance.isNoProjectSelected,onClick:async()=>{var t;const e=await l.getApp();(t=e.project.tabSystem)==null||t.add(new on(e.project.tabSystem),!0)}}),Tm(),nt({id:"extensions",displayName:"sidebar.extensions.name",icon:"mdi-puzzle-outline",onClick:async()=>{await(await l.getApp()).windows.extensionStore.open()}}),Me.loadedSettings.once(e=>{var t,i,n;for(const a of Object.values(l.sidebar.elements))a.isVisibleSetting=(n=(i=(t=e==null?void 0:e.sidebar)==null?void 0:t.sidebarElements)==null?void 0:i[a.uuid])!=null?n:!0})}class $m{constructor(e,t){this.taskManager=e,this.taskDetails=t,this.currentStepCount=0}update(e,t){e!==void 0&&(this.currentStepCount=e),t!==void 0&&(this.taskDetails.totalTaskSteps=t)}createWindow(){this.window=new U({name:this.name,description:this.description})}complete(){this.window&&this.window.dispose(),this.dispose()}dispose(){var e;(e=this.taskManager)==null||e.delete(this)}get name(){return this.taskDetails.name}get description(){return this.taskDetails.description}get totalStepCount(){var e;return(e=this.taskDetails.totalTaskSteps)!=null?e:100}get icon(){return this.taskDetails.icon}get progress(){return Math.round(this.currentStepCount/this.totalStepCount*100)}}const St=E([]);class Dm{create(e){const t=new $m(this,e);return St.value.push(t),t}delete(e){St.value=St.value.filter(t=>t!==e)}get hasRunningTasks(){return St.value.length>0}}const xi=new Set(["INPUT","TEXTAREA"]);function Em(s){const e=new Be("mdi-pencil-outline","toolbar.edit.name");e.addItem(s.actionManager.create({icon:"mdi-undo",name:"actions.undo.name",description:"actions.undo.description",keyBinding:"Ctrl + Z",prevent:t=>t.tagName==="INPUT"||t.tagName==="TEXTAREA",onTrigger:()=>{var i;const t=(i=s.tabSystem)==null?void 0:i.selectedTab;t instanceof Tt?t.treeEditor.undo():t instanceof ot?t.editorInstance.trigger("toolbar","undo",null):document.execCommand("undo")}})),e.addItem(s.actionManager.create({icon:"mdi-redo",name:"actions.redo.name",description:"actions.redo.description",keyBinding:$s,prevent:t=>t.tagName==="INPUT"||t.tagName==="TEXTAREA",onTrigger:()=>{var i;const t=(i=s.tabSystem)==null?void 0:i.selectedTab;t instanceof Tt?t.treeEditor.redo():t instanceof ot?t.editorInstance.trigger("toolbar","redo",null):document.execCommand("redo")}})),e.addItem(new Le),e.addItem(s.actionManager.create({icon:"mdi-content-copy",name:"actions.copy.name",description:"actions.copy.description",keyBinding:"Ctrl + C",prevent:t=>xi.has(t.tagName),onTrigger:()=>{var t,i;return(i=(t=s.tabSystem)==null?void 0:t.selectedTab)==null?void 0:i.copy()}})),e.addItem(s.actionManager.create({icon:"mdi-content-cut",name:"actions.cut.name",description:"actions.cut.description",keyBinding:"Ctrl + X",prevent:t=>xi.has(t.tagName),onTrigger:()=>{var t,i;return(i=(t=s.tabSystem)==null?void 0:t.selectedTab)==null?void 0:i.cut()}})),e.addItem(s.actionManager.create({icon:"mdi-content-paste",name:"actions.paste.name",description:"actions.paste.description",keyBinding:"Ctrl + V",prevent:t=>xi.has(t.tagName),onTrigger:()=>{var t,i;return(i=(t=s.tabSystem)==null?void 0:t.selectedTab)==null?void 0:i.paste()}})),l.toolbar.addCategory(e)}function Mm(s){const e=new Be("mdi-file-outline","toolbar.file.name");e.addItem(s.actionManager.create({id:"bridge.action.newFile",icon:"mdi-file-plus-outline",name:"actions.newFile.name",description:"actions.newFile.description",keyBinding:"Ctrl + N",isDisabled:()=>s.isNoProjectSelected,onTrigger:()=>s.windows.createPreset.open()})),e.addItem(s.actionManager.create({id:"bridge.action.openFile",icon:"mdi-open-in-app",name:"actions.openFile.name",description:"actions.openFile.description",keyBinding:"Ctrl + O",onTrigger:async()=>{let t;try{t=await window.showOpenFilePicker({multiple:!0})}catch{return}for(const i of t)await s.fileDropper.importFile(i)||s.project.openFile(i,{isTemporary:!1})}})),e.addItem(s.actionManager.create({id:"bridge.action.openFolder",icon:"mdi-folder-open-outline",name:"actions.openFolder.name",description:"actions.openFolder.description",keyBinding:"Ctrl + Shift + O",onTrigger:async()=>{const t=await l.getApp();let i;try{i=await window.showDirectoryPicker({multiple:!1,mode:"readwrite"})}catch{return}await t.fileDropper.importFolder(i)}})),e.addItem(s.actionManager.create({id:"bridge.action.searchFile",icon:"mdi-magnify",name:"actions.searchFile.name",description:"actions.searchFile.description",keyBinding:"Ctrl + P",onTrigger:()=>Hi.isWindowOpen=!0})),e.addItem(s.actionManager.create({icon:"mdi-file-cancel-outline",name:"actions.closeFile.name",description:"actions.closeFile.description",keyBinding:"Ctrl + W",onTrigger:()=>l.ready.once(t=>{var i;return(i=t.tabSystem)==null?void 0:i.close()})})),e.addItem(new Le),e.addItem(s.actionManager.create({icon:"mdi-content-save-outline",name:"actions.saveFile.name",description:"actions.saveFile.description",keyBinding:"Ctrl + S",onTrigger:()=>l.ready.once(t=>{var i;return(i=t.tabSystem)==null?void 0:i.save()})})),A.value||ns?e.addItem(s.actionManager.create({icon:"mdi-file-download-outline",name:"actions.downloadFile.name",description:"actions.downloadFile.description",keyBinding:"Ctrl + Shift + S",onTrigger:async()=>{var o;const t=await l.getApp(),i=(o=t.project.tabSystem)==null?void 0:o.selectedTab;if(!(i instanceof O))return;const[n,a]=await t.project.compilerService.compileFile(i.getPath(),await i.getFile().then(async c=>new Uint8Array(await c.arrayBuffer())));let r;typeof a=="string"?r=new TextEncoder().encode(a):a instanceof Blob?r=new Uint8Array(await a.arrayBuffer()):r=new Uint8Array(a),rt(i.name,r)}})):e.addItem(s.actionManager.create({icon:"mdi-content-save-edit-outline",name:"actions.saveAs.name",description:"actions.saveAs.description",keyBinding:"Ctrl + Shift + S",onTrigger:()=>l.ready.once(t=>{var i;return(i=t.tabSystem)==null?void 0:i.saveAs()})})),e.addItem(s.actionManager.create({icon:"mdi-content-save-settings-outline",name:"actions.saveAll.name",description:"actions.saveAll.description",keyBinding:J()==="win32"?"Ctrl + Alt + S":"Ctrl + Meta + S",onTrigger:()=>l.ready.once(t=>{var i;return(i=t.tabSystem)==null?void 0:i.saveAll()})})),l.toolbar.addCategory(e)}function Im(s){const e=new Be("mdi-help","toolbar.help.name");e.addItem(s.actionManager.create({name:"actions.releases.name",icon:"mdi-alert-decagram",description:"actions.releases.description",onTrigger:()=>window.open("https://github.com/bridge-core/editor/releases","_blank")})),e.addItem(s.actionManager.create({name:"actions.bugReports.name",icon:"mdi-bug-outline",description:"actions.bugReports.description",onTrigger:()=>window.open("https://github.com/bridge-core/editor/issues/new/choose","_blank")})),e.addItem(s.actionManager.create({name:"actions.twitter.name",icon:"mdi-twitter",description:"actions.twitter.description",onTrigger:()=>window.open("https://twitter.com/bridgeIDE","_blank")})),e.addItem(new Le),e.addItem(s.actionManager.create({name:"actions.extensionAPI.name",icon:"mdi-puzzle-outline",description:"actions.extensionAPI.description",onTrigger:()=>l.openUrl("https://bridge-core.github.io/extension-docs/","_blank")})),e.addItem(s.actionManager.create({name:"actions.gettingStarted.name",icon:"mdi-help-circle-outline",description:"actions.gettingStarted.description",onTrigger:()=>l.openUrl("https://bridge-core.github.io/editor-docs/getting-started/","_blank")})),e.addItem(s.actionManager.create({name:"actions.faq.name",icon:"mdi-frequently-asked-questions",description:"actions.faq.description",onTrigger:()=>l.openUrl("https://bridge-core.github.io/editor-docs/faq/","_blank")})),l.toolbar.addCategory(e)}function Om(s){const e=new Be("mdi-wrench-outline","toolbar.tools.name");e.addItem(s.actionManager.create({icon:"mdi-book-open-page-variant",name:"actions.docs.name",description:"actions.docs.description",onTrigger:async()=>{const i=(await l.getApp()).tabSystem;if(!i)return;const n=new He(i,{icon:"mdi-book-open-page-variant",name:"bedrock.dev",url:"https://bedrock.dev",iconColor:"primary"});i.add(n)}})),e.addItem(s.actionManager.create({icon:"mdi-minecraft",name:"actions.minecraftDocs.name",description:"actions.minecraftDocs.description",onTrigger:()=>{l.openUrl("https://docs.microsoft.com/en-us/minecraft/creator/")}})),e.addItem(s.actionManager.create({icon:"mdi-cube-outline",name:"[Open Blockbench]",onTrigger:async()=>{const i=(await l.getApp()).tabSystem;if(!i)return;const n=new He(i,{icon:"mdi-cube-outline",name:"Blockbench",url:"https://web.blockbench.net",iconColor:"primary"});i.add(n)}})),e.addItem(s.actionManager.create({icon:"mdi-snowflake",name:"[Open Snowstorm]",onTrigger:async()=>{const i=(await l.getApp()).tabSystem;if(!i)return;const n=new He(i,{icon:"mdi-snowflake",name:"Snowstorm",url:"https://snowstorm.app/",iconColor:"primary"});i.add(n)}})),e.addItem(new Le),e.addItem(s.actionManager.create({id:"bridge.action.refreshProject",icon:"mdi-folder-refresh-outline",name:"packExplorer.refresh.name",description:"packExplorer.refresh.description",keyBinding:J()==="win32"?"Ctrl + Alt + R":"Ctrl + Meta + R",onTrigger:async()=>{await s.projectManager.projectReady.fired,await s.project.refresh()}})),e.addItem(s.actionManager.create({icon:"mdi-reload",name:"actions.reloadAutoCompletions.name",description:"actions.reloadAutoCompletions.description",keyBinding:"Ctrl + Shift + R",onTrigger:async()=>{await s.projectManager.projectReady.fired,s.project.jsonDefaults.reload()}})),e.addItem(s.actionManager.create({icon:"mdi-puzzle-outline",name:"actions.reloadExtensions.name",description:"actions.reloadExtensions.description",onTrigger:async()=>{s.extensionLoader.disposeAll(),s.extensionLoader.loadExtensions(),await s.projectManager.projectReady.fired,s.project.extensionLoader.disposeAll(),s.project.extensionLoader.loadExtensions()}})),e.addItem(new Le),e.addItem(s.actionManager.create({icon:"mdi-cancel",name:"actions.clearAllNotifications.name",description:"actions.clearAllNotifications.description",onTrigger:()=>uo()})),l.toolbar.addCategory(e)}function Rm(s){const e=new Be("mdi-view-dashboard-outline","toolbar.project.name");e.addItem(s.actionManager.create({icon:"mdi-home-outline",name:"actions.goHome.name",description:"actions.goHome.description",isDisabled:()=>s.isNoProjectSelected&&!s.viewComMojangProject.hasComMojangProjectLoaded,onTrigger:async()=>{(await l.getApp()).projectManager.selectProject(Ke),l.sidebar.elements.packExplorer.isSelected||l.sidebar.elements.packExplorer.click()}})),e.addItem(s.actionManager.create({icon:"mdi-folder-open-outline",name:"windows.projectChooser.title",description:"windows.projectChooser.description",isDisabled:()=>s.hasNoProjects,onTrigger:()=>{A.value?wn():l.instance.windows.projectChooser.open()}})),e.addItem(new Le),e.addItem(s.actionManager.create({id:"bridge.action.newProject",icon:"mdi-folder-plus-outline",name:"actions.newProject.name",description:"actions.newProject.description",onTrigger:()=>s.windows.createProject.open()})),e.addItem(s.actionManager.create({icon:"mdi-import",name:"actions.importBrproject.name",description:"actions.importBrproject.description",onTrigger:()=>gn()})),e.addItem(new Le),e.addItem(s.actionManager.create({icon:"mdi-puzzle-outline",name:"actions.extensions.name",description:"actions.extensions.description",onTrigger:()=>s.windows.extensionStore.open()})),e.addItem(s.actionManager.create({id:"bridge.action.openSettings",icon:"mdi-cog-outline",name:"actions.settings.name",description:"actions.settings.description",keyBinding:"Ctrl + ,",onTrigger:()=>s.windows.settings.open()})),l.toolbar.addCategory(e)}const Ii=(s,e=!1,t=!0)=>({icon:"mdi-file-cog-outline",name:`actions.viewCompilerOutput.${t?"view":"name"}`,keyBinding:e?"Ctrl + Shift + D":void 0,onTrigger:async()=>{var d;const i=await l.getApp(),n=i.project;let a=s;if(a===void 0){const p=(d=i.project.tabSystem)==null?void 0:d.selectedTab;if(!(p instanceof O))return;a=p.getPath()}if(!a)return;const r=await n.compilerService.getCompilerOutputPath(a),o=i.comMojang.hasComMojang?i.comMojang.fileSystem:i.fileSystem;if(!r||!await o.fileExists(r)){new U({description:"actions.viewCompilerOutput.fileMissing"});return}const c=await o.getFileHandle(r);await(n==null?void 0:n.openFile(c,{selectTab:!0,readOnlyMode:"forced"}))}});function Wm(s){const e=new Be("mdi-eye-outline","toolbar.view.name");e.addItem(s.actionManager.create({icon:"mdi-folder-outline",name:"toolbar.view.togglePackExplorer.name",description:"toolbar.view.togglePackExplorer.description",keyBinding:"Ctrl + Shift + E",onTrigger:()=>{l.sidebar.elements.packExplorer.click()}})),e.addItem(s.actionManager.create({icon:"mdi-file-search-outline",name:"toolbar.view.openFileSearch.name",description:"toolbar.view.openFileSearch.description",keyBinding:"Ctrl + Shift + F",onTrigger:()=>{l.sidebar.elements.fileSearch.click()}})),e.addItem(new Le),e.addItem(s.actionManager.create(Ii(void 0,!0))),e.addItem(s.actionManager.create({icon:"mdi-pencil-outline",name:"actions.toggleReadOnly.name",description:"actions.toggleReadOnly.description",onTrigger:()=>{var i;const t=(i=s.tabSystem)==null?void 0:i.selectedTab;!(t instanceof O)||t.readOnlyMode==="forced"||t.setReadOnly(t.readOnlyMode==="manual"?"off":"manual")}})),l.toolbar.addCategory(e)}async function Lm(s){Rm(s),Mm(s),Em(s),Wm(s),Om(s),Im(s)}class Nm extends ur{constructor(e){super(e),this.ready=new $}async setup(e){this.packTypes.length>0||(await e.fired,this.packTypes=await e.readJSON("data/packages/minecraftBedrock/packDefinitions.json").catch(()=>[]),this.ready.dispatch())}}const Bm=X({__name:"BrowserUnsupported",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState();function n(){e.window.close()}async function a(){await pe("confirmedUnsupportedBrowser",!0),n()}return{__sfc:!0,t,props:e,state:i,onClose:n,onContinue:a,BaseWindow:de}}});var Vm=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"windows.browserUnsupported.title",isVisible:i.state.isVisible,isPersistent:!0,hasCloseButton:!1,width:420,height:240},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"text-center"},[t("v-icon",{staticStyle:{"font-size":"8em"},attrs:{color:"warning"}},[e._v(" mdi-alert-octagon-outline ")]),t("p",[e._v(e._s(i.t("windows.browserUnsupported.description")))])],1)]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"error"},on:{click:i.onContinue}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-check")]),e._v(" "+e._s(i.t("windows.browserUnsupported.continue"))+" ")],1),t("v-spacer")]},proxy:!0}],null,!1,305660225)}):e._e()},Hm=[],Um=_(Bm,Vm,Hm,!1,null,null,null,null);const zm=Um.exports;class qm extends Y{constructor(){super(zm),this.defineWindow()}}const Jm={name:"ExtensionCard",mixins:[z],props:{extension:Object},computed:{tags(){return[{icon:"mdi-account-outline",color:"primary",text:this.extension.author,type:"search"},{icon:"mdi-code-braces",text:this.extension.onlineVersion,type:"search"}].concat(this.extension.tags)},isMobile(){return this.$vuetify.breakpoint.mobile},compilerPlugins(){return Object.keys(this.extension.connected.compilerPlugins).map(s=>`"${s}"`).join(", ")}},methods:{openUrl(s){l.openUrl(s)}}};var Gm=function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-normal pa-4 mb-2 rounded-lg card"},[t("div",{staticClass:"d-flex align-center mb-2"},[e.extension.icon?t("v-icon",{staticClass:"mr-1",attrs:{color:"accent"}},[e._v(" "+e._s(e.extension.icon)+" ")]):e._e(),t("h3",[e._v(e._s(e.extension.name))]),t("v-spacer"),e.extension.readme?t("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(i){return e.openUrl(e.extension.readme)}}},[t("v-icon",[e._v("mdi-information-outline")])],1):e._e(),e.extension.canShare?t("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(i){return e.extension.share()}}},[t("v-icon",[e._v("mdi-share")])],1):e._e(),e.extension.isInstalled?e.extension.isUpdateAvailable?t("v-btn",{staticClass:"rounded-lg elevation-0",attrs:{loading:e.extension.isLoading,color:"primary",small:""},on:{click:function(i){return e.extension.update()}}},[t("v-icon",{class:{"mr-1":!e.isMobile},attrs:{small:!e.isMobile}},[e._v(" mdi-sync ")]),e.isMobile?e._e():t("span",[e._v("Update")])],1):t("v-tooltip",{attrs:{color:e.extension.isActive?"success":"error",right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[e.extension.isActive?t("v-icon",e._g({attrs:{color:"success"}},i),[e._v(" mdi-check ")]):t("v-icon",e._g({attrs:{color:"error"}},i),[e._v("mdi-close")])]}}])},[t("span",[e._v(" "+e._s(e.extension.isActive?"Extension Active":"Extension Inactive")+" ")])]):t("v-btn",{staticClass:"rounded-lg elevation-0",attrs:{loading:e.extension.isLoading,disabled:!e.extension.isCompatibleVersion(),color:"primary",small:""},on:{click:function(i){return e.extension.download()}}},[t("v-icon",{class:{"mr-1":!e.isMobile},attrs:{small:!e.isMobile}},[e._v(" mdi-download ")]),e.isMobile?e._e():t("span",[e._v("Download")])],1),e.extension.isInstalled?t("v-menu",{attrs:{"offset-y":"","offset-x":"",rounded:"lg"},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:n}){return[t("v-btn",e._g(e._b({attrs:{small:"",icon:""}},"v-btn",n,!1),i),[t("v-icon",[e._v("mdi-dots-vertical")])],1)]}}],null,!1,3448670655),model:{value:e.extension.showMenu,callback:function(i){e.$set(e.extension,"showMenu",i)},expression:"extension.showMenu"}},[t("v-list",{attrs:{color:"menu",dense:""}},e._l(e.extension.actions,function(i,n){return t("v-list-item",{key:n,on:{click:function(a){return a.stopPropagation(),i.trigger()}}},[t("v-list-item-icon",[t("v-icon",{attrs:{color:"primary"}},[e._v(" "+e._s(i.icon))])],1),t("v-list-item-title",[e._v(" "+e._s(e.t(i.name))+" ")])],1)}),1)],1):e._e()],1),t("v-row",{staticClass:"mb-4",attrs:{dense:""}},e._l(e.tags,function(i){return t("v-col",{key:i.text,staticClass:"flex-grow-0"},[t("v-chip",{attrs:{color:i.color,"text-color":i.color?"white":void 0,small:""},on:{click:function(n){i.type==="search"?e.$emit("search",i.text):e.$emit("select",i.text.toLowerCase())}}},[t("v-icon",{staticClass:"mr-1"},[e._v(e._s(i.icon))]),e._v(" "+e._s(i.text)+" ")],1)],1)}),1),t("span",[e._v(e._s(e.extension.description))]),e.extension.connected&&e.extension.connected.contributesCompilerPlugins||!e.extension.isCompatibleVersion()?[t("v-divider",{staticClass:"my-2"}),e.extension.connected&&e.extension.connected.contributesCompilerPlugins?t("div",[t("v-icon",{attrs:{color:"secondary"}},[e._v("mdi-format-list-bulleted")]),t("span",{staticClass:"font-weight-bold"},[e._v(" "+e._s(e.t("windows.extensionStore.compilerPluginDownload.compilerPlugins"))+": ")]),t("span",[e._v(" "+e._s(e.compilerPlugins)+" ")])],1):e._e(),e.extension.isCompatibleVersion()?e._e():t("div",{staticClass:"pt-1"},[t("span",{staticClass:"font-weight-bold"},[t("v-icon",{attrs:{color:"error"}},[e._v("mdi-alert-circle")]),e._v(" "+e._s(e.t("windows.extensionStore.incompatibleVersion")))],1)])]:e._e()],2)},Km=[],Ym=_(Jm,Gm,Km,!1,null,"7984d02b",null,null);const Qm=Ym.exports,Zm=X({__name:"ExtensionStore",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState(),n=e.window.sidebar,a=K(()=>n.currentElement?r.value.length===1?`[${r.value[0].name} - ${t("windows.extensionStore.title")}]`:`[${n.filter||n.currentElement.text} - ${t("windows.extensionStore.title")}]`:"windows.extensionStore.title"),r=K(()=>{if(n.filter!==""){const c=n.filter.toLowerCase();return e.window.extensions.filter(d=>d.name.toLowerCase().includes(c)||d.description.toLowerCase().includes(c)||d.author.toLowerCase().includes(c)||d.version.includes(c)||d.id===n.filter||d.tags.some(p=>p.text.toLowerCase().includes(c)))}return n.currentState});function o(){e.window.close()}return{__sfc:!0,t,props:e,state:i,sidebar:n,title:a,currentExtensions:r,onClose:o,SidebarWindow:gt,ExtensionCard:Qm,pointerDevice:Q}}});var Xm=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.SidebarWindow,{attrs:{windowTitle:i.title,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:i.sidebar.elements},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"sidebar",fn:function(){return[t("v-text-field",{staticClass:"pt-2",attrs:{"prepend-inner-icon":"mdi-magnify",label:i.t("windows.extensionStore.searchExtensions"),autocomplete:"off",autofocus:i.pointerDevice==="mouse",outlined:"",dense:""},model:{value:i.sidebar.filter,callback:function(n){e.$set(i.sidebar,"filter",typeof n=="string"?n.trim():n)},expression:"sidebar.filter"}})]},proxy:!0},{key:"default",fn:function(){return[i.currentExtensions.length===0?t("div",[e._v(" No plugins match your search... ")]):e._l(i.currentExtensions,function(n){return t(i.ExtensionCard,{key:`${n.id}.${n.isInstalled}.${n.isUpdateAvailable}`,attrs:{extension:n},on:{search:a=>i.sidebar.filter=a,select:a=>e.window.selectedSidebar=a}})})]},proxy:!0}]),model:{value:e.window.selectedSidebar,callback:function(n){e.$set(e.window,"selectedSidebar",typeof n=="string"?n.trim():n)},expression:"window.selectedSidebar"}})},eg=[],tg=_(Zm,Xm,eg,!1,null,null,null,null);const ig=tg.exports;let Se;class ng extends Y{constructor(){super(ig),this.baseUrl="https://raw.githubusercontent.com/bridge-core/plugins/master",this.sidebar=new ct([]),this.installedExtensions=[],this.tags={},this.updates=new Set,this.extensions=[],l.eventSystem.on("projectChanged",()=>{Se==null||Se.dispose(),Se=void 0}),this.defineWindow()}async open(e){const t=await l.getApp();t.windows.loadingWindow.open(),this.sidebar.removeElements(),this.installedExtensions=[],await t.dataLoader.fired,this.extensionTags=await t.dataLoader.readJSON("data/packages/common/extensionTags.json");const i=await t.extensionLoader.getInstalledExtensions();let n;try{n=navigator.onLine?await fetch(`${this.baseUrl}/extensions.json`).then(a=>a.json()):[...i.values()].map(a=>a.manifest)}catch{return this.createOfflineWindow()}if(n.length===0&&!navigator.onLine)return this.createOfflineWindow();this.extensions=n.map(a=>new Is(this,a)),this.updates.clear(),i.forEach(a=>{const r=this.extensions.find(o=>o.id===a.id);r?(r.setInstalled(),r.setConnected(a),ne(a.version,r.onlineVersion,"<")&&(r.setIsUpdateAvailable(),this.updates.add(r))):this.extensions.push(a.forStore(this))}),Se==null||Se.dispose(),this.setupSidebar(),e&&this.sidebar.setFilter(e),t.windows.loadingWindow.close(),super.open()}async createOfflineWindow(){(await l.getApp()).windows.loadingWindow.close(),new U({description:"windows.extensionStore.offlineError"})}close(){super.close(),this.updates.size>0&&(Se=new ci({icon:"mdi-sync",color:"primary",message:"sidebar.notifications.updateExtensions",onClick:()=>{this.updates.forEach(e=>e.update(!1)),Se==null||Se.dispose()}}))}updateInstalled(e){this.updates.delete(e)}delete(e){const t=this.installedExtensions.findIndex(i=>i.id===e.id);t!==-1&&(this.installedExtensions.splice(t,1),e.isLocalOnly&&(this.extensions=this.extensions.filter(i=>i.id!==e.id)))}setupSidebar(){this.sidebar.addElement(new Te({id:"all",text:"All",icon:"mdi-format-list-bulleted-square",color:"primary"}),this.getExtensions()),this.sidebar.addElement(new Te({id:"installed",text:"Installed",icon:"mdi-download-circle-outline",color:"primary"}),this.installedExtensions),Object.values(this.tags).forEach(e=>this.sidebar.addElement(e.asSidebarElement(),this.getExtensionsByTag(e))),this.sidebar.setDefaultSelected()}getExtensions(e){return[...new Set([...this.extensions,...this.installedExtensions])].filter(t=>!t.isLocalOnly&&(!e||t.hasTag(e)))}getExtensionsByTag(e){return this.getExtensions(e)}getTagIcon(e){var t;return(t=this.extensionTags[e])==null?void 0:t.icon}getTagColor(e){var t;return(t=this.extensionTags[e])==null?void 0:t.color}getExtensionById(e){return this.getExtensions().find(t=>t.id===e)}get selectedSidebar(){return this.sidebar.selected}set selectedSidebar(e){this.sidebar.clearFilter(),this.sidebar.selected=e}getBaseUrl(){return this.baseUrl}addInstalledExtension(e){this.installedExtensions.push(e)}}const sg=X({__name:"LoadingWindow",props:["window"],setup(s){const e=s,t=e.window.getState();function i(){e.window.close()}return{__sfc:!0,props:e,state:t,onClose:i,BaseWindow:de}}});var ag=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.BaseWindow,{attrs:{windowTitle:e.window.message||"windows.loadingWindow.titles.loading",isVisible:i.state.isVisible,hasMaximizeButton:!1,hasCloseButton:!1,isPersistent:!0,isFullscreen:!1,width:300,height:40,isSmallPopup:!0},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("v-progress-linear",{attrs:{indeterminate:""}})]},proxy:!0}])})},rg=[],og=_(sg,ag,rg,!1,null,null,null,null);const cg=og.exports;class lg extends Y{constructor(){super(cg),this.virtualWindows=0,this.loadingMessages=[],this.defineWindow()}get message(){return this.loadingMessages[this.loadingMessages.length-1]}open(e){this.virtualWindows++,this.loadingMessages.push(e),this.state.isVisible||super.open()}close(){this.virtualWindows--,this.loadingMessages.pop(),this.virtualWindows===0?super.close():this.virtualWindows<0&&(this.virtualWindows=0)}closeAll(){this.virtualWindows=0,this.loadingMessages=[],super.close()}}const dg={alphanumeric:s=>s.match(/^[a-zA-Z0-9_\/]*$/)!==null,noEmptyFolderNames:s=>s.match(/\/\//g)===null},pg={name:"PresetPath",props:{value:String},data:()=>({mode:"view",editedPath:"",validationText:"",rules:Object.fromEntries(Object.entries(dg).map(([s,e])=>[s,t=>e(t)||B(`windows.createPreset.validationRule.${s}`)]))}),mounted(){this.mode="view",this.editedPath=this.value,this.sanitizeEditedPath()},computed:{path(){return this.editedPath.substring(0,this.editedPath.length-1)}},methods:{sanitizeEditedPath(){this.editedPath=this.editedPath.replaceAll("\\","/").replace(/\s+/g,"_"),!this.editedPath.endsWith("/")&&this.editedPath!==""&&(this.editedPath=this.editedPath+"/")},isPathValid(){return Object.values(this.rules).map(s=>s(this.editedPath)).find(s=>typeof s=="string")===void 0},tryToViewMode(){this.isPathValid()&&(this.mode="view")}},watch:{value(){this.editedPath=this.value,this.sanitizeEditedPath()},mode(){this.mode==="view"&&(this.sanitizeEditedPath(),this.$emit("input",this.editedPath))},editedPath(){this.validationText=Object.values(this.rules).map(s=>s(this.editedPath)).find(s=>typeof s=="string")}}};var ug=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mb-6 flex justify-center align-start path-container"},[t("v-icon",{staticClass:"mr-1",attrs:{"x-large":"",color:"primary"}},[e._v("mdi-folder-outline")]),e.mode==="view"?[t("v-btn",{staticClass:"mr-2",attrs:{text:"",small:""},on:{click:function(i){e.mode="edit"}}},[t("v-icon",{staticClass:"mr-1",attrs:{small:""}},[e._v(" "+e._s(e.path.length===0?"mdi-plus":"mdi-pencil-outline")+" ")]),e._v(" "+e._s(e.path.length===0?"Add subfolder":"Edit subfolders")+" ")],1),t("span",{on:{dblclick:function(i){e.mode="edit"}}},e._l(e.path.split("/"),function(i,n){return t("span",{key:n,staticClass:"mr-1"},[e._v(" "+e._s(i)+"/ ")])}),0)]:t("v-text-field",{staticStyle:{display:"inline-block",width:"calc(100% - 44px)","margin-top":"0","padding-top":"0"},attrs:{autofocus:"",rules:Object.values(e.rules),dense:""},on:{keydown:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.tryToViewMode()},blur:function(i){return e.tryToViewMode()}},model:{value:e.editedPath,callback:function(i){e.editedPath=i},expression:"editedPath"}})],2)},hg=[],fg=_(pg,ug,hg,!1,null,"50bd4cc2",null,null);const fa=fg.exports,mg=X({__name:"PresetWindow",props:{window:null},setup(s){const e=s,{t}=I(),i=e.window.getState(),n=K(()=>e.window.sidebar.currentState),a=K(()=>Object.values(n.value.fields||{}).every(([d,p,u={}])=>u.validate&&u.validate.some(f=>e.window.validationRules[f](n.value.models[p])!==!0)?!1:!!n.value.models[p]||u.optional));function r(){e.window.close()}function o(){a.value&&e.window.createPreset(n.value)}function c(d,p,u){var g,w;const{accept:f,multiple:h}=p,m=[...(w=(g=u.dataTransfer)==null?void 0:g.files)!=null?w:[]].filter(v=>oa(v,f));m.length!==0&&(h?n.value.models[d]?n.value.models[d].push(...m):n.value.models[d]=[...m]:n.value.models[d]=m[m.length-1])}return{__sfc:!0,props:e,t,state:i,content:n,fieldsReady:a,onClose:r,onCreatePreset:o,onDropFile:c,SidebarWindow:gt,PresetPath:fa}}});var gg=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.SidebarWindow,{attrs:{windowTitle:"windows.createPreset.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:e.window.sidebar.elements},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"sidebar",fn:function(){return[t("v-text-field",{staticClass:"pt-2",attrs:{"prepend-inner-icon":"mdi-magnify",label:i.t("windows.createPreset.searchPresets"),autocomplete:"off",autofocus:"",outlined:"",dense:"","hide-details":""},model:{value:e.window.sidebar.filter,callback:function(n){e.$set(e.window.sidebar,"filter",typeof n=="string"?n.trim():n)},expression:"window.sidebar.filter"}}),t("v-switch",{attrs:{label:i.t("windows.createPreset.showAllPresets")},model:{value:e.window.sidebar.showDisabled,callback:function(n){e.$set(e.window.sidebar,"showDisabled",n)},expression:"window.sidebar.showDisabled"}})]},proxy:!0},{key:"default",fn:function(){return[t("h1",{staticClass:"mt-2 d-flex align-center",class:{"mb-6":!i.content.description}},[t("v-icon",{staticClass:"mr-1",attrs:{large:""}},[e._v(e._s(i.content.icon))]),e._v(" "+e._s(i.content.name)+" ")],1),i.content.description?t("p",{staticClass:"mt-2 mb-6"},[e._v(" "+e._s(i.content.description)+" ")]):e._e(),typeof i.content.models.PRESET_PATH=="string"?t(i.PresetPath,{model:{value:i.content.models.PRESET_PATH,callback:function(n){e.$set(i.content.models,"PRESET_PATH",n)},expression:"content.models.PRESET_PATH"}}):e._e(),e._l(i.content.fields,function([n,a,r={}],o){return[!r.type||r.type==="textInput"?t("v-text-field",{key:o,staticClass:"mb-1",attrs:{label:n,rules:r.validate?r.validate.map(c=>e.window.validationRules[c]):[],autocomplete:"off",outlined:"",dense:""},on:{keypress:function(c){return!c.type.indexOf("key")&&e._k(c.keyCode,"enter",13,c.key,"Enter")?null:i.onCreatePreset.apply(null,arguments)}},model:{value:i.content.models[a],callback:function(c){e.$set(i.content.models,a,c)},expression:"content.models[id]"}}):r.type==="fileInput"?t("span",{key:o,on:{drop:function(c){return c.preventDefault(),c.stopPropagation(),i.onDropFile(a,r,c)},dragover:function(c){c.preventDefault(),c.stopPropagation()}}},[t("v-file-input",{staticClass:"mb-1",attrs:{accept:r.accept,"prepend-icon":null,"prepend-inner-icon":r.icon||"mdi-paperclip",label:n,multiple:r.multiple||!1,autocomplete:"off",outlined:"",dense:""},model:{value:i.content.models[a],callback:function(c){e.$set(i.content.models,a,c)},expression:"content.models[id]"}})],1):r.type==="selectInput"?t(r.options.length>4?"v-autocomplete":"v-select",{key:o,tag:"component",staticClass:"mb-1",attrs:{loading:r.isLoading,disabled:r.isLoading,items:r.options,"menu-props":{maxHeight:220,rounded:"lg","nudge-top":-8,transition:"slide-y-transition"},label:n,autocomplete:"off",outlined:"",dense:""},model:{value:i.content.models[a],callback:function(c){e.$set(i.content.models,a,c)},expression:"content.models[id]"}}):r.type==="switch"?t("v-switch",{key:o,staticClass:"mb-1",attrs:{label:n},model:{value:i.content.models[a],callback:function(c){e.$set(i.content.models,a,c)},expression:"content.models[id]"}}):r.type==="numberInput"?t("v-slider",{key:o,staticClass:"mb-1",attrs:{min:r.min||0,max:r.max||10,discrete:"",step:r.step||1,"thumb-label":"always",label:n},model:{value:i.content.models[a],callback:function(c){e.$set(i.content.models,a,c)},expression:"content.models[id]"}}):e._e()]})]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary",disabled:!i.fieldsReady},on:{click:i.onCreatePreset}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-plus")]),e._v(" Create ")],1)]},proxy:!0}],null,!1,3021932500),model:{value:e.window.sidebar.selected,callback:function(n){e.$set(e.window.sidebar,"selected",n)},expression:"window.sidebar.selected"}}):e._e()},wg=[],yg=_(mg,gg,wg,!1,null,null,null,null);const vg=yg.exports;function De(s,e,t){return e.forEach(i=>s=s.replaceAll(`{{${i}}}`,t[i])),s}class yn extends Z{constructor(e,t){super(e),this.dataLoader=t}getDirectoryHandle(e,t){return e.startsWith("data/packages/")?this.dataLoader.getDirectoryHandle(e,t):e.startsWith("file:///data/packages/")?this.dataLoader.getDirectoryHandle(e.slice(8),t):super.getDirectoryHandle(e,t)}}async function bg(s,e,t,i){const n=await l.getApp(),a=n.fileSystem,r=new yn(n.fileSystem.baseDirectory,n.dataLoader);let o;e.startsWith("./")?o=e=e.replaceAll("./",s+"/"):o=`data/packages/minecraftBedrock/${e}`,await n.dataLoader.fired;const d=await(await r.readFile(o)).text(),p={exports:void 0};try{qi({script:d,env:{module:p}})}catch(v){throw new Error(`Failed to execute PresetScript "${e}": ${v}`)}if(typeof p.exports!="function")throw new Error(`Failed to execute PresetScript "${e}": module.exports is of type ${typeof p.exports}`);const u=[],f=[],h=(v,C,P={inject:[],openFile:!1,packPath:void 0})=>(typeof C!="string"&&(C=JSON.stringify(C,null,"	")),m(v,C,P)),m=async(v,C,{inject:P=[],openFile:x=!1,packPath:b=void 0}={inject:[],openFile:!1,packPath:void 0})=>{const y=n.projectConfig.resolvePackPath(b,v);if(i.mayOverwriteFiles===void 0&&await a.fileExists(y))if(await new W({description:"windows.createPreset.overwriteFiles",confirmText:"windows.createPreset.overwriteFilesConfirm"}).fired)i.mayOverwriteFiles=!0;else{i.mayOverwriteFiles=!1;return}else if(i.mayOverwriteFiles===!1)return;const j=await a.getFileHandle(y,!0);u.push(j),x&&f.push(j),await a.write(j,typeof C=="string"?De(C,P,t):C)},g=async(v,C,{inject:P=[],openFile:x=!1,packPath:b=void 0}={inject:[],openFile:!1,packPath:void 0})=>{const y=n.projectConfig.resolvePackPath(b,v),j=await a.getFileHandle(y,!0);if(i.mayOverwriteUnsavedChanges===void 0){const re=await n.project.getFileTab(j);if(re!==void 0&&re.isUnsaved)if(await new W({description:"windows.createPreset.overwriteUnsavedChanges",confirmText:"windows.createPreset.overwriteUnsavedChangesConfirm"}).fired)i.mayOverwriteUnsavedChanges=!0,re.close();else{i.mayOverwriteUnsavedChanges=!1;return}}else if(i.mayOverwriteUnsavedChanges===!1)return;let T=null;try{T=await(await a.readFile(y)).text()}catch{}u.push(j),x&&f.push(j),typeof C=="string"?(C=De(C,P,t),await a.writeFile(y,T?`${T}
${C}`:C)):(C=De(R.stringify(C),P,t),await a.writeJSON(y,si(T?R.parse(T):{},R.parse(C)),!0))},w=v=>r.readFile(`${s}/${v}`);return await p.exports({models:t,createFile:m,expandFile:g,loadPresetFile:w,createJSONFile:h}),{createdFiles:u,openFile:f}}async function _g(s,[e,t,i],n){var f;const a=await l.getApp(),r=new yn(a.fileSystem.baseDirectory,a.dataLoader),o=(f=i==null?void 0:i.inject)!=null?f:[],c=`${s}/${e}`,d=De(a.projectConfig.resolvePackPath(i==null?void 0:i.packPath,t),o,n),p=Pe(d);await r.mkdir(ye(d),{recursive:!0});let u;if(p===".json"){const h=await r.readFile(c),m=De(await h.text(),o,n);let g;try{g=await r.readJSON(d)}catch{g={}}u=await r.writeFile(d,JSON.stringify(si(g,JSON.parse(m)),null,"	"))}else{const m=await(await r.readFile(c)).text();let g;try{g=await(await r.readFile(d)).text()}catch{g=""}const w=De(m,o,n);u=await r.writeFile(d,`${g}${g!==""?`
`:""}${w}`)}return u}const Sg=[".mcfunction",".json",".js",".ts",".txt",".molang"];async function Cg(s,[e,t,i],n){var f;const a=await l.getApp(),r=new yn(a.fileSystem.baseDirectory,a.dataLoader),o=(f=i==null?void 0:i.inject)!=null?f:[],c=`${s}/${e}`,d=De(a.projectConfig.resolvePackPath(i==null?void 0:i.packPath,t),o,n),p=Pe(d);await r.mkdir(ye(d),{recursive:!0});let u;if(o.length===0||!Sg.includes(p))u=await r.copyFile(c,d);else{const m=await(await r.readFile(c)).text();u=await r.writeFile(d,De(m,o,n))}return u}class Un extends Te{constructor(e){super(e),this.resetState=e.resetState}}async function kg(s,e){await l.getApp();const t=B(`windows.createPreset.disabledPreset.${s.type}`);let i;switch(s.type){case"experimentalGameplay":e.experimentalGameplay&&(i=e.experimentalGameplay.map(n=>`${n.startsWith("!")?B("general.no"):""} ${B(`experimentalGameplay.${n.replace("!","")}.name`)}`).join(", "));break;case"packTypes":e.packTypes&&(i=e.packTypes.map(n=>`${n.startsWith("!")?B("general.no"):""} ${B(`packType.${n.replace("!","")}.name`)}`).join(", "));break;case"targetVersion":Array.isArray(e.targetVersion)?i=e.targetVersion.join(" "):e.targetVersion&&e.targetVersion.min&&e.targetVersion.max&&(i=`Min: ${e.targetVersion.min} | Max: ${e.targetVersion.max}`);break;case"manifestDependency":e.dependencies&&(i=e.dependencies.join(", "));break}return i?`${t}: ${i}`:void 0}class xg extends Y{constructor(){super(vg),this.loadPresetPaths=new Set,this.sidebar=new ct([]),this.shouldReloadPresets=!0,this.modelResetters=[],this._validationRules={alphanumeric:t=>t.match(/^[a-zA-Z0-9_\.]*$/)!==null,lowercase:t=>t.toLowerCase()===t,required:t=>!!t,numeric:t=>!isNaN(Number(t))},this.requiresMatcher=k(new ei),this.defineWindow(),["presetsChanged","projectChanged"].forEach(t=>l.eventSystem.on(t,()=>this.onPresetsChanged()))}get validationRules(){return Object.fromEntries(Object.entries(this._validationRules).map(([e,t])=>[e,i=>t(i)||B(`windows.createPreset.validationRule.${e}`)]))}onPresetsChanged(){this.shouldReloadPresets=!0}async addPreset(e,t,i){var f,h,m;const n=await l.getApp();if(!i.category)throw new Error(`Error loading ${t}: Missing preset category`);const a=this.requiresMatcher.isValid(i.requires);if(!a&&i.showIfDisabled===!1)return;let r=e.rawElements.find(g=>g.getText()===i.category);r||(r=new pi({isOpen:!1,text:i.category,items:[]}),e.addElement(r));const o=D(),c=()=>{var g,w,v;(g=i.fields)==null||g.forEach(([C,P,x={}])=>{var j;if(x.type!=="selectInput"||Array.isArray(x.options))return;const{fileType:b,cacheKey:y}=(j=x.options)!=null?j:{};!b||!y||(x.options=[],x.isLoading=!0,n.project.packIndexer.once(async()=>{const T=await n.project.packIndexer.service.getCacheDataFor(b,void 0,y);x.options=T!=null?T:[],x.isLoading=!1}))}),e.setState(o,{...i,presetPath:ye(t),models:{PROJECT_PREFIX:(w=n.projectConfig.get().namespace)!=null?w:"bridge",...(v=i.additionalModels)!=null?v:{},...Object.fromEntries(i.fields.map(([C,P,x={}])=>{var b;return[P,(b=x.default)!=null?b:!x.type||x.type==="textInput"?"":null]}))}})},d=(f=i.additionalModels)==null?void 0:f.PRESET_PATH,p=typeof d=="string"&&i.category==="fileType.simpleFile"&&(m=(h=l.packType.get(d+"test.json"))==null?void 0:h.color)!=null?m:"primary";let u;this.requiresMatcher.failures.length>0&&(u=await kg(this.requiresMatcher.failures[0],i.requires)),r.addItem(new Un({id:o,text:i.name,icon:i.icon,color:p,isDisabled:!a,disabledText:u,resetState:c})),c(),this.modelResetters.push(c)}async loadPresets(e,t,i="data/packages/minecraftBedrock/preset"){if(await t.fired,i.endsWith("presets.json")&&await t.fileExists(i)){const r=await t.readJSON(i);await Promise.all(Object.entries(r).map(([o,c])=>this.addPreset(e,`${ye(i)}/${o}`,c)));return}let n=[];try{n=await t.readdir(i,{withFileTypes:!0})}catch{}const a=[];for(const r of n)if(r.kind==="directory")a.push(this.loadPresets(e,t,`${i}/${r.name}`));else if(r.name==="manifest.json"){let o;try{o=R.parse(await r.getFile().then(c=>c.text()))}catch(c){const d=new Error(`Failed to load JSON file "${i}/${r.name}".`);d.cause=c,console.error(d);continue}a.push(await this.addPreset(e,`${i}/${r.name}`,o))}await Promise.all(a)}async loadDefaultPresets(e,t){const i=await t.readJSON("data/packages/minecraftBedrock/presets.json");await Promise.all(Object.entries(i).map(([n,a])=>this.addPreset(e,n,a)))}async open(){const e=await l.getApp(),t=e.fileSystem;if(e.windows.loadingWindow.open(),this.shouldReloadPresets){const i=new ct([]);this.requiresMatcher=k(new ei),await this.requiresMatcher.setup(),await Promise.all([this.loadDefaultPresets(i,e.dataLoader),...[...this.loadPresetPaths].map(n=>this.loadPresets(i,t,n))]),i.setDefaultSelected(),this.sidebar=i,this.shouldReloadPresets=!1}else this.modelResetters.forEach(i=>i());e.windows.loadingWindow.close(),super.open()}addPresets(e){return this.loadPresetPaths.add(e),{dispose:()=>this.loadPresetPaths.delete(e)}}async createPreset({presetPath:e,createFiles:t=[],expandFiles:i=[]}){var u,f,h,m,g,w;if(!e)return;const n=await l.getApp();n.windows.loadingWindow.open();const a=n.project.fileSystem,r=[],o={mayOverwriteFiles:void 0,mayOverwriteUnsavedChanges:void 0};for(const v of t){if(typeof v=="string")continue;const C=De(v[1],(f=(u=v[2])==null?void 0:u.inject)!=null?f:[],this.sidebar.currentState.models);if(await a.fileExists(C))if(await new W({description:"windows.createPreset.overwriteFiles",confirmText:"windows.createPreset.overwriteFilesConfirm"}).fired){o.mayOverwriteFiles=!0;break}else{n.windows.loadingWindow.close();return}}const c=n.project;for(const v of i){if(typeof v=="string")continue;let C=De(v[1],(m=(h=v[2])==null?void 0:h.inject)!=null?m:[],this.sidebar.currentState.models),P=null;try{P=await c.fileSystem.getFileHandle(C)}catch{continue}const x=await c.getFileTab(P);if(x!==void 0&&x.isUnsaved)if(await new W({description:"windows.createPreset.overwriteUnsavedChanges",confirmText:"windows.createPreset.overwriteUnsavedChangesConfirm"}).fired)o.mayOverwriteUnsavedChanges=!0,c.closeFile(P);else{n.windows.loadingWindow.close();return}}const d=[];for(const v of t)if(typeof v=="string"){const C=await bg(e,v,this.sidebar.currentState.models,o);r.push(...C.createdFiles),d.push(...C.openFile)}else{const C=await Cg(e,v,this.sidebar.currentState.models);r.push(C),(g=v[2])!=null&&g.openFile&&d.push(C)}for(const v of i){const C=await _g(e,v,this.sidebar.currentState.models);r.push(C),(w=v[2])!=null&&w.openFile&&d.push(C)}l.eventSystem.dispatch("fileAdded",void 0),o.mayOverwriteFiles!==!1&&this.close();const p=[];for(const v of r){const C=await n.fileSystem.pathTo(v);!C||(p.push(C),d.includes(v)&&await n.project.openFile(v,{selectTab:v===d[d.length-1],isTemporary:!1}))}n.project.updateFiles(p),this.sidebar.currentElement instanceof Un&&this.sidebar.currentElement.resetState(),n.windows.loadingWindow.close()}}async function Pg(){const s=await l.getApp(),e=new It("windows.projectChooser.addPack"),t=await e.actionManager,i=s.project.getPacks();l.packType.all.filter(a=>!i.includes(a.id)).forEach(a=>t.create({icon:a.icon,color:a.color,name:`packType.${a.id}.name`,description:`packType.${a.id}.description`,onTrigger:async()=>{var d;s.windows.loadingWindow.open();const r=s.project.fileSystem,o=await yt.loadFromConfig();switch(a.id){case"behaviorPack":{await new la().create(r,o);break}case"resourcePack":{await new da().create(r,o);break}case"skinPack":{await new pa().create(r,o);break}case"worldTemplate":{await new ua().create(r,o);break}default:throw s.windows.loadingWindow.close(),new Error(`Unable to add pack with id "${a.id}"`)}const c=await r.readJSON("config.json");await r.writeJSON("config.json",{...c,packs:{...(d=c.packs)!=null?d:{},[a.id]:Et[a.id]}},!0),s.project.addPack({...a,packPath:s.project.config.resolvePackPath(a.id),version:[1,0,0]}),s.project.updateChangedFiles(),l.eventSystem.dispatch("projectChanged",s.project),s.windows.loadingWindow.close()}})),e.open()}const jg=X({__name:"ProjectChooser",props:["window"],setup(s){const e=s;let t;"ListFormat"in Intl?t=new Intl.ListFormat("en",{style:"long",type:"conjunction"}):t={format:m=>m.join(", ")};const{t:i}=I(),n=e.window.getState(),a=e.window.sidebar,r=K(()=>a.currentState.isComMojangProject),o=K(()=>{const m=a.currentState.authors||"Unknown";return Array.isArray(m)?t.format(m.map(g=>typeof g=="string"?g:g.name)):m});function c(){e.window.close()}async function d(){const m=await l.getApp();r.value?(await m.projectManager.selectProject(Ke),m.viewComMojangProject.loadComMojangProject(a.currentState.project)):m.projectManager.selectProject(a.selected),e.window.close()}function p(m){new W({description:"windows.deleteProject.description",confirmText:"windows.deleteProject.confirm",cancelText:"general.cancel",onConfirm:async()=>{const g=await l.getApp();await g.projectManager.removeProjectWithName(m),g.hasNoProjects?c():await e.window.loadProjects()}})}function u(){Pg(),e.window.close()}function f(){e.window.loadAllProjects()}async function h(m){const w=(await l.getApp()).projectManager.getProject(a.currentState.name);!w||await w.config.toggleExperiment(w,m.id)}return{__sfc:!0,formatter:t,t:i,props:e,state:n,sidebar:a,isComMojangProject:r,authors:o,onClose:c,onSelectProject:d,onDeleteProject:p,onAddPack:u,onLoadAllProjects:f,onToggleExperiment:h,SidebarWindow:gt,PackTypeViewer:aa,ExperimentalGameplay:ra,BridgeSheet:Ne}}});var Fg=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.SidebarWindow,{attrs:{windowTitle:"windows.projectChooser.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:i.sidebar.elements,actions:i.state.actions},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"sidebar",fn:function(){return[t("v-text-field",{staticClass:"pt-2 mb-2",attrs:{"prepend-inner-icon":"mdi-magnify",label:i.t("windows.projectChooser.searchProjects"),"hide-details":"",autofocus:"",outlined:"",dense:""},model:{value:i.sidebar.filter,callback:function(n){e.$set(i.sidebar,"filter",typeof n=="string"?n.trim():n)},expression:"sidebar.filter"}}),i.state.showLoadAllButton?t("v-btn",{staticClass:"mb-2",attrs:{loading:i.state.showLoadAllButton==="isLoading",block:"",color:"primary"},on:{click:i.onLoadAllProjects}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-folder-open-outline")]),e._v(" "+e._s(i.t("windows.projectChooser.loadAllProjects"))+" ")],1):e._e()]},proxy:!0},{key:"default",fn:function(){return[t("div",{staticClass:"d-flex align-center mb-4 rounded-lg content-area pa-4"},[t("div",{staticClass:"d-flex align-center"},[t("img",{staticClass:"mr-2 project-logo rounded-lg",attrs:{height:"64",src:i.sidebar.currentState.imgSrc,draggable:"false"}}),t("div",[t("h1",{staticStyle:{"overflow-wrap":"anywhere"}},[e._v(" "+e._s(i.sidebar.currentState.name)+" ")]),t("h2",{staticClass:"subheader"},[e._v("by "+e._s(i.authors))])])]),t("v-spacer"),i.sidebar.currentState.isLocalProject?t("v-tooltip",{attrs:{color:"tooltip",bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:n}){return[t(i.BridgeSheet,e._g({staticClass:"d-flex flex-column pa-2",attrs:{dark:""}},n),[t("v-icon",{attrs:{color:"primary"}},[e._v(" mdi-lock-open-outline ")]),e._v(" "+e._s(i.t("windows.projectChooser.localProject.name"))+" ")],1)]}}],null,!1,872088565)},[t("span",[e._v(" "+e._s(i.t("windows.projectChooser.localProject.description"))+" ")])]):e._e(),i.isComMojangProject?t("v-tooltip",{attrs:{color:"tooltip",bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:n}){return[t(i.BridgeSheet,e._g({staticClass:"d-flex flex-column pa-2",attrs:{dark:""}},n),[t("v-icon",{attrs:{color:"primary"}},[e._v("mdi-minecraft")]),e._v(" "+e._s(i.t("windows.projectChooser.comMojangProject.name"))+" ")],1)]}}],null,!1,3649741387)},[t("span",[e._v(" "+e._s(i.t("windows.projectChooser.comMojangProject.description"))+" ")])]):e._e()],1),t("v-row",{staticClass:"mb-6",attrs:{dense:""}},e._l(i.sidebar.currentState.contains,function(n){return t("v-col",{key:n.id},[t(i.PackTypeViewer,{staticStyle:{height:"100%"},attrs:{packType:n}})],1)}),1),i.isComMojangProject?e._e():[t("h2",{staticClass:"subheader"},[e._v(" "+e._s(i.t("general.experimentalGameplay"))+" ")]),t("v-row",{attrs:{dense:""}},e._l(i.sidebar.currentState.experimentalGameplay,function(n){return t("v-col",{key:`${n.id}.${n.isActive}`,attrs:{xs:"12",sm:"6",md:"4",lg:"3",xl:"2"}},[t(i.ExperimentalGameplay,{staticStyle:{height:"100%"},attrs:{experiment:n,isToggleable:!0,value:n.isActive},nativeOn:{click:function(a){return i.onToggleExperiment(n)}}})],1)}),1)],i.isComMojangProject?t(i.BridgeSheet,{staticClass:"d-flex align-center justify-center pa-2"},[t("v-icon",{staticClass:"mr-1",attrs:{color:"error"}},[e._v(" mdi-alert-circle-outline ")]),e._v(" "+e._s(i.t("windows.projectChooser.comMojangProject.uninstallWarning"))+" ")],1):e._e()]},proxy:!0},{key:"actions",fn:function({selectedSidebar:n}){return[i.isComMojangProject?e._e():t("v-btn",{attrs:{color:"primary",disabled:i.state.currentProject!==n},on:{click:i.onAddPack}},[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-plus-box")]),e._v(" "+e._s(i.t("windows.projectChooser.addPack"))+" ")],1),t("v-spacer"),i.isComMojangProject?e._e():t("v-btn",{attrs:{color:"error",disabled:i.state.currentProject===n},on:{click:function(a){return i.onDeleteProject(n)}}},[t("v-icon",[e._v("mdi-delete")]),e._v(" "+e._s(i.t("general.delete"))+" ")],1),t("v-btn",{attrs:{color:"primary",disabled:i.state.currentProject===n},on:{click:i.onSelectProject}},[t("v-icon",[e._v("mdi-check")]),e._v(" "+e._s(i.t("general.select"))+" ")],1)]}}]),model:{value:i.sidebar.selected,callback:function(n){e.$set(i.sidebar,"selected",n)},expression:"sidebar.selected"}})},Tg=[],Ag=_(jg,Fg,Tg,!1,null,"f43fd1d8",null,null);const $g=Ag.exports;class Dg{constructor(e){this.app=e}get comMojang(){return this.app.comMojang}get fileSystem(){return this.app.comMojang.fileSystem}async loadProjects(){var n;if(!this.comMojang.setup.hasFired||!this.comMojang.status.hasComMojang)return[];const e=await this.loadPacks("development_behavior_packs"),t=await this.loadPacks("development_resource_packs"),i=[];for(const a of e){const r=(n=a.manifest)==null?void 0:n.dependencies;if(!r){i.push({name:a.directoryHandle.name,packs:[a]});continue}const o=t.find(({uuid:c})=>r.find(({uuid:d})=>!!d&&d===c));!o||i.push({name:a.directoryHandle.name,packs:[a,o]})}return i}async loadPacks(e){var n;const t=await this.fileSystem.getDirectoryHandle(e).catch(()=>null);if(!t)return[];const i=[];for await(const a of t.values()){if(a.kind==="file")continue;const r=await this.fileSystem.readJSON(`${e}/${a.name}/manifest.json`).catch(()=>null);if(!r)continue;const o=(n=r==null?void 0:r.header)==null?void 0:n.uuid;if(this.isV2Project(r))continue;const c=await Pt(`${e}/${a.name}/pack_icon.png`,this.fileSystem).catch(()=>null);i.push({type:e==="development_behavior_packs"?"behaviorPack":"resourcePack",packPath:`${e}/${a.name}`,uuid:o,manifest:r,packIcon:c,directoryHandle:a})}return i}isV2Project(e){var a,r,o,c,d;const t=(a=e==null?void 0:e.header)==null?void 0:a.uuid,i=(d=(c=(o=(r=e==null?void 0:e.metadata)==null?void 0:r.generated_with)==null?void 0:o.bridge)==null?void 0:c.pop)==null?void 0:d.call(c);return i&&ne(i,"2.0.0",">=")?!0:this.app.projectManager.someProject(p=>!!p.bpUuid&&p.bpUuid===t)}}class Eg extends Y{constructor(){super($g,!1,!0),this.sidebar=new ct([]),this.experimentalToggles=[],this.state=G({...super.getState(),showLoadAllButton:!1,currentProject:void 0}),this.state.actions.push(new M({icon:"mdi-import",name:"actions.importBrproject.name",color:"accent",onTrigger:()=>{this.close(),gn()}}),new M({icon:"mdi-plus",name:"windows.projectChooser.newProject.name",color:"accent",onTrigger:async()=>{const e=await l.getApp();this.close(),e.windows.createProject.open()}})),this.defineWindow()}async loadAllProjects(){this.state.showLoadAllButton="isLoading";const e=await l.getApp(),t=await e.setupBridgeFolder(),i=await e.comMojang.setupComMojang();t||i?(await this.loadProjects(),this.state.showLoadAllButton=!t||!i):this.state.showLoadAllButton=!0}addProject(e,t,i){this.sidebar.addElement(new Te({color:"primary",text:t!=null?t:"Unknown",icon:`mdi-alpha-${t[0].toLowerCase()}-box-outline`,id:e!=null?e:D()}),i),this.sidebar.setDefaultSelected()}async loadProjects(){this.sidebar.removeElements();const e=await l.getApp();this.state.showLoadAllButton=!e.bridgeFolderSetup.hasFired;const t=await e.projectManager.getProjects(),i=await e.dataLoader.readJSON("data/packages/minecraftBedrock/experimentalGameplay.json");return t.forEach(a=>this.addProject(a.projectData.path,a.name,{...a.projectData,isLocalProject:a.isLocal,experimentalGameplay:i.map(r=>{var o,c;return{isActive:(c=(o=a.config.get().experimentalGameplay)==null?void 0:o[r.id])!=null?c:!1,...r}})})),(await new Dg(e).loadProjects()).forEach(a=>{var r,o;return this.addProject(`comMojang/${a.name}`,a.name,{name:a.name,imgSrc:(o=(r=a.packs.find(c=>!!c.packIcon))==null?void 0:r.packIcon)!=null?o:void 0,contains:a.packs.map(c=>{var p,u,f;const d=l.packType.getFromId(c.type);if(!!d)return{...d,version:(f=(u=(p=c.manifest)==null?void 0:p.header)==null?void 0:u.version)!=null?f:[1,0,0],packPath:c.packPath,uuid:c.uuid}}).filter(c=>!!c),isLocalProject:!1,isComMojangProject:!0,project:k(a)})}),this.sidebar.setDefaultSelected(e.isNoProjectSelected?void 0:e.projectManager.selectedProject),e.isNoProjectSelected?void 0:e.projectManager.selectedProject}async open(){this.state.currentProject=await this.loadProjects(),super.open()}}const Mg=X({__name:"Changelog",props:["window"],setup(s){const e=s,t=e.window.getState();function i(){e.window.close()}return{__sfc:!0,props:e,state:t,onClose:i,BaseWindow:de}}});var Ig=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.BaseWindow,{attrs:{windowTitle:"windows.changelogWindow.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,width:600,height:600},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"mt-4 mb-2 d-flex align-center"},[t("v-icon",{staticClass:"mr-2",attrs:{color:"primary",large:""}},[e._v("mdi-update")]),t("h1",[e._v("v"+e._s(e.window.version))])],1),t("v-divider",{staticClass:"mb-4"}),t("div",{staticClass:"changelog",domProps:{innerHTML:e._s(e.window.changelog)}})]},proxy:!0}])})},Og=[],Rg=_(Mg,Ig,Og,!1,null,null,null,null);const Wg=Rg.exports,ma="/";class Lg extends Y{constructor(){super(Wg),this.defineWindow()}async open(){const e=await l.getApp();e.windows.loadingWindow.open(),await fetch(ma+"changelog.html").then(t=>t.text()).then(t=>{this.changelog=t,this.version=we}),e.windows.loadingWindow.close(),super.open()}}const Ng=X({__name:"Main",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState();function n(){e.window.close()}function a(){window.open("https://discord.gg/jj2PmqU","_blank")}function r(){window.open("https://twitter.com/bridgeIDE","_blank")}function o(){window.open("https://github.com/bridge-core","_blank")}return{__sfc:!0,t,props:e,state:i,close:n,openDiscord:a,openTwitter:r,openGithub:o,BaseWindow:de}}});var Bg=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:"windows.socials.title",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,width:420,height:140},on:{closeWindow:i.close},scopedSlots:e._u([{key:"default",fn:function(){return[t("p",[e._v(e._s(i.t("windows.socials.content")))])]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"#7289DA"},on:{click:i.openDiscord}},[t("v-icon",{attrs:{color:"white"}},[e._v("mdi-discord")]),t("span",{staticClass:"white--text"},[e._v(e._s(i.t("windows.socials.discord")))])],1),t("v-btn",{attrs:{color:"#1DA1F2"},on:{click:i.openTwitter}},[t("v-icon",{attrs:{color:"white"}},[e._v("mdi-twitter")]),t("span",{staticClass:"white--text"},[e._v(e._s(i.t("windows.socials.twitter")))])],1),t("v-btn",{attrs:{color:"#333"},on:{click:i.openGithub}},[t("v-icon",{attrs:{color:"white"}},[e._v("mdi-github")]),t("span",{staticClass:"white--text"},[e._v(e._s(i.t("windows.socials.github")))])],1)]},proxy:!0}],null,!1,533919895)}):e._e()},Vg=[],Hg=_(Ng,Bg,Vg,!1,null,null,null,null);const Ug=Hg.exports;class zg extends Y{constructor(){super(Ug),this.defineWindow()}}const qg=X({__name:"Content",props:["window"],setup(s){const e=s,t=e.window.getState(),i=e.window.sidebar,n=e.window.categories;function a(){e.window.close()}return{__sfc:!0,props:e,state:t,sidebar:i,categories:n,onClose:a,SidebarWindow:gt}}});var Jg=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t(i.SidebarWindow,{attrs:{windowTitle:"sidebar.compiler.name",isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,percentageWidth:80,percentageHeight:80,sidebarItems:i.sidebar.elements,actions:i.state.actions},on:{closeWindow:i.onClose},scopedSlots:e._u([{key:"default",fn:function({selectedSidebar:n}){return[i.categories[n]?t(i.categories[n].component,{tag:"component",attrs:{data:i.categories[n].data.value}}):e._e()]}}]),model:{value:i.sidebar.selected,callback:function(n){e.$set(i.sidebar,"selected",n)},expression:"sidebar.selected"}})},Gg=[],Kg=_(qg,Jg,Gg,!1,null,null,null,null);const Yg=Kg.exports,Qg={props:{data:Array},components:{ActionViewer:mt}};var Zg=function(){var e=this,t=e._self._c;return t("div",e._l(e.data,function(i,n){return t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],key:n,staticStyle:{cursor:"pointer"},attrs:{action:i,hideTriggerButton:!0},nativeOn:{click:function(a){return i.trigger()}}})}),1)},Xg=[],ew=_(Qg,Zg,Xg,!1,null,null,null,null);const tw=ew.exports,iw={props:{data:Array},mixins:[z],components:{Sheet:Ne},methods:{getIconData(s){if(!s)return null;switch(s){case"info":return{color:"info",icon:"mdi-information-outline"};case"warning":return{color:"warning",icon:"mdi-alert-outline"};case"error":return{color:"error",icon:"mdi-alert-circle-outline"};default:return null}},getMessageParts(s){return s.split(`
`)}}};var nw=function(){var e=this,t=e._self._c;return e.data.length>0?t("div",e._l(e.data,function([i,{type:n}],a){return t("Sheet",{key:`${n}//${i}//${a}`,staticClass:"pa-2 mb-2 d-flex",staticStyle:{overflow:"auto"}},[e.getIconData(n)?t("v-icon",{staticClass:"mr-2",attrs:{color:e.getIconData(n).color}},[e._v(" "+e._s(e.getIconData(n).icon)+" ")]):e._e(),t("div",[e._l(e.getMessageParts(i),function(r,o){return[t("span",{key:`line-${o}`},[e._v(e._s(r))]),t("br",{key:`break-${o}`})]})],2)],1)}),1):t("Sheet",{staticClass:"pa-2"},[e._v(" "+e._s(e.t("sidebar.compiler.categories.logs.noLogs"))+" ")])},sw=[],aw=_(iw,nw,sw,!1,null,null,null,null);const rw=aw.exports,ow={props:{data:Object},components:{InfoPanel:en}};var cw=function(){var e=this,t=e._self._c;return t("InfoPanel",{attrs:{infoPanel:e.data}})},lw=[],dw=_(ow,cw,lw,!1,null,null,null,null);const pw=dw.exports,ga=(s=!0)=>({icon:"mdi-restart-alert",name:"packExplorer.restartWatchMode.name",description:s?"packExplorer.restartWatchMode.description":void 0,onTrigger:()=>{new W({description:"packExplorer.restartWatchMode.confirmDescription",height:168,onConfirm:async()=>{const e=await l.getApp();await Promise.all([e.project.fileSystem.unlink(".bridge/.lightningCache"),e.project.fileSystem.unlink(".bridge/.compilerFiles")]),await e.project.fileSystem.writeFile(".bridge/.restartWatchMode",""),e.actionManager.trigger("bridge.action.refreshProject")}})}}),wa=new M(ga()),uw={icon:"mdi-cog-outline",name:"actions.recompileChanges.name",description:"actions.recompileChanges.description",onTrigger:async()=>{const e=(await l.getApp()).project;e.packIndexer.deactivate(),await e.packIndexer.activate(!0);const[t,i]=await e.packIndexer.fired;await e.compilerService.start(t,i)}},hw=new M(uw);const fw={components:{ToggleSheet:hn,SelectedStatus:yi},props:{value:Boolean},data(){return{selected:this.value||!1}},methods:{onInput(s){this.selected=s,this.$emit("input",s)}}};var mw=function(){var e=this,t=e._self._c;return t("ToggleSheet",{attrs:{value:e.selected},on:{input:e.onInput}},[e._t("header"),t("SelectedStatus",{attrs:{selected:e.selected}}),e._t("default")],2)},gw=[],ww=_(fw,mw,gw,!1,null,null,null,null);const yw=ww.exports,vw={components:{ActionViewer:mt,SettingSheet:yw},mixins:[z],props:{data:Object},data:()=>({settings:[{id:"watchModeActive",icon:"mdi-eye-outline"},{id:"autoFetchChangedFiles",icon:"mdi-radar"}]}),setup(){return S.compiler||V(S,"compiler",{watchModeActive:!0,autoFetchChangedFiles:!0}),{recompileChangesAction:hw,restartWatchModeAction:wa,settingsState:S}}};var bw=function(){var e=this,t=e._self._c;return t("v-row",{staticClass:"mb-6",attrs:{dense:""}},[t("v-col",[t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],staticStyle:{"margin-bottom":"0 !important",height:"100%"},attrs:{action:e.restartWatchModeAction,hideTriggerButton:!0},nativeOn:{click:function(i){return e.restartWatchModeAction.trigger()}}})],1),t("v-col",[t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],staticStyle:{"margin-bottom":"0 !important",height:"100%"},attrs:{action:e.recompileChangesAction,hideTriggerButton:!0},nativeOn:{click:function(i){return e.recompileChangesAction.trigger()}}})],1),e._l(e.settings,function({id:i,icon:n}){return t("v-col",{key:i},[t("SettingSheet",{staticStyle:{height:"100%"},on:{input:function(a){e.data.shouldSaveSettings=!0}},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"d-flex align-center"},[t("v-icon",{staticClass:"mr-1",attrs:{color:"accent"}},[e._v(" "+e._s(n)+" ")]),t("h3",[e._v(" "+e._s(e.t(`sidebar.compiler.categories.watchMode.settings.${i}.name`))+" ")])],1)]},proxy:!0}],null,!0),model:{value:e.settingsState.compiler[i],callback:function(a){e.$set(e.settingsState.compiler,i,a)},expression:"settingsState.compiler[id]"}},[[e._v(" "+e._s(e.t(`sidebar.compiler.categories.watchMode.settings.${i}.description`))+" ")]],2)],1)})],2)},_w=[],Sw=_(vw,bw,_w,!1,null,null,null,null);const Cw=Sw.exports;class kw extends Y{constructor(){super(Yg,!1,!0),this.sidebar=new ct([],!1),this.categories=k({watchMode:{component:Cw,data:E({shouldSaveSettings:!1})},buildProfiles:{component:tw,data:E(null)},outputFolders:{component:pw,data:E(null)},logs:{component:rw,data:E(null)}}),this.activeCategoryChanged=k(new H),this.lastUsedBuildProfile=null,this.runLastProfileAction=new M({name:"sidebar.compiler.actions.runLastProfile",icon:"mdi-play",color:"accent",onTrigger:()=>{if(!this.lastUsedBuildProfile)throw new Error("Invalid state: Triggered runLastProfileAction without a last used build profile");this.lastUsedBuildProfile.trigger()}}),this.defineWindow();const e=new M({icon:"mdi-refresh",name:"general.reload",color:"accent",onTrigger:()=>{this.reload()}});this.state.actions.push(e);const t=new M({icon:"mdi-close-circle-outline",name:"general.clear",color:"accent",onTrigger:async()=>{(await l.getApp()).project.compilerService.clearCompilerLogs(),this.categories.logs.data.value=[]}});this.sidebar.on(i=>{this.activeCategoryChanged.dispatch(i),i==="logs"?this.state.actions.splice(this.state.actions.indexOf(e),0,t):this.state.actions=this.state.actions.filter(n=>n!==t)}),wa.on(()=>this.close()),l.getApp().then(()=>{this.sidebar.addElement(new Te({id:"watchMode",text:be.translate("sidebar.compiler.categories.watchMode.name"),color:"primary",icon:"mdi-eye-outline"})),this.sidebar.addElement(new Te({id:"buildProfiles",text:be.translate("sidebar.compiler.categories.profiles"),color:"primary",icon:"mdi-motion-play-outline"})),this.sidebar.addElement(new Te({id:"outputFolders",text:be.translate("sidebar.compiler.categories.outputFolders"),color:"primary",icon:"mdi-folder-open-outline"})),this.sidebar.addElement(new Te({id:"logs",text:be.translate("sidebar.compiler.categories.logs.name"),color:"primary",icon:"mdi-format-list-text"})),this.sidebar.setDefaultSelected()})}async reload(){const e=await l.getApp();this.categories.buildProfiles.data.value=await this.loadProfiles(),this.categories.logs.data.value=await e.project.compilerService.getCompilerLogs(),this.categories.outputFolders.data.value=await this.loadOutputFolders()}async open(){const e=await l.getApp();await this.reload(),await e.project.compilerService.onConsoleUpdate(st(async()=>{this.categories.logs.data.value=await e.project.compilerService.getCompilerLogs()})),this.lastUsedBuildProfile&&this.state.actions.unshift(this.runLastProfileAction),super.open()}async close(){await(await l.getApp()).project.compilerService.removeConsoleListeners(),this.state.actions=this.state.actions.filter(t=>t!==this.runLastProfileAction),super.close(),this.categories.watchMode.data.value.shouldSaveSettings&&(this.categories.watchMode.data.value.shouldSaveSettings=!1,await Me.saveSettings())}async loadProfiles(){const t=(await l.getApp()).project,i=await t.fileSystem.getDirectoryHandle(".bridge/compiler",{create:!0}),n=[{icon:"mdi-cog",name:"sidebar.compiler.default.name",description:"sidebar.compiler.default.description",onTrigger:async a=>{this.close(),this.lastUsedBuildProfile=a;const r=await t.createDashService("production");await r.setup(),await r.build()}}];for await(const a of i.values()){if(a.kind!=="file"||a.name===".DS_Store"||a.name==="default.json")continue;const r=await a.getFile();let o;try{o=R.parse(await r.text())}catch{continue}n.push({icon:o.icon,name:o.name,description:o.description,onTrigger:async c=>{this.close(),this.lastUsedBuildProfile=c;const d=await t.createDashService("production",`${t.projectPath}/.bridge/compiler/${a.name}`);await d.setup(),await d.build()}})}return n.map(a=>new M(a))}async loadOutputFolders(){const t=(await l.getApp()).comMojang,{hasComMojang:i,didDenyPermission:n}=t.status;let a;if(A.value)a={text:"comMojang.status.notAvailable",type:"error",isDismissible:!1};else if(!i&&n)a={text:"comMojang.status.deniedPermission",type:"warning",isDismissible:!1};else if(i&&!n)a={text:"comMojang.status.sucess",type:"success",isDismissible:!1};else if(!i)a={text:"comMojang.status.notSetup",type:"error",isDismissible:!1};else throw new Error("Invalid com.mojang status");return new Ms(a)}}class xw{constructor(e){this.app=e,this.socialsWindow=new zg,this.projectChooser=new Eg,this.createProject=new yt,this.loadingWindow=new lg,this.createPreset=new xg,this.extensionStore=new ng,this.browserUnsupported=new qm,this.changelogWindow=new Lg,this.compilerWindow=new kw,this.settings=new Me(e)}}const zn=1088685;function Pw(s){return new Promise(e=>{typeof requestIdleCallback=="function"?requestIdleCallback(async()=>{await s(),e()}):setTimeout(async()=>{await s(),e()},10)})}class jw extends Z{constructor(e=!1){super(),this.isMainLoader=e}get virtualFileSystem(){if(!this._virtualFileSystem)throw new Error("DataLoader: virtualFileSystem is not initialized");return this._virtualFileSystem}async loadData(e=!1){if(this.hasFired){console.warn("This dataLoader instance already loaded data. You called loadData() twice.");return}let t=await fe("savedAllDataInIdb");e&&(t=!1,await pe("savedAllDataInIdb",!1)),this.isMainLoader&&console.log(t?"[APP] Data saved; restoring from cache...":"[APP] Data not saved; fetching now..."),console.time("[App] Data");const i=this.isMainLoader&&!t;if(this._virtualFileSystem=new te(new at("data-fs"),"bridgeFolder",t?void 0:new Map,i),await this._virtualFileSystem.setupDone.fired,t){this.setup(this._virtualFileSystem),console.timeEnd("[App] Data");return}const n=await fetch(ma+"packages.zip").then(c=>c.arrayBuffer());if(n.byteLength!==zn)throw new Error(`Error: Data package was larger than the expected size of ${zn} bytes; got ${n.byteLength} bytes`);const a=await new Promise((c,d)=>Ni(new Uint8Array(n),async(p,u)=>{if(p)return d(p);c(u)})),o={".":await this._virtualFileSystem.getDirectoryHandle("data",{create:!0})};for(const c in a){const d=me(c),p=ye(c);if(c.endsWith("/")){const u=await o[p].getDirectoryHandle(d,{create:!0});o[c.slice(0,-1)]=u}else await o[p].getFileHandle(d,{create:!0,initialData:a[c]})}this.setup(this._virtualFileSystem),console.timeEnd("[App] Data"),this.isMainLoader&&!e&&Pw(async()=>{await this._virtualFileSystem.moveToIdb(),await pe("savedAllDataInIdb",!0)})}}class Fw{constructor(){this.state=G({})}addCategory(e){V(this.state,e.id,e)}disposeCategory(e){Ee(this.state,e.id)}showMobileMenu(e){$e(e,Object.values(this.state).map(t=>[{type:"divider"},t.toNestedMenu()]).flat(1).slice(1))}}class Tw extends H{constructor(){super(),this.state=G({currentHeight:window.innerHeight,currentWidth:window.innerWidth}),window.addEventListener("resize",Ue(()=>this.dispatch(),50,{trailing:!0})),this.on(([e,t])=>{this.state.currentWidth=e,this.state.currentHeight=t}),l.getApp().then(e=>e.projectManager.projectReady.fired.then(()=>this.dispatch()))}dispatch(){super.dispatch([window.innerWidth,window.innerHeight])}}class Aw extends ci{constructor(){super({message:"sidebar.notifications.installApp.message",color:"primary",icon:"mdi-download",textColor:"white",isVisible:!1}),this.isInstallable=new $,this.isInstalled=new $,window.addEventListener("beforeinstallprompt",e=>this.onInstallPrompt(e)),window.addEventListener("appinstalled",()=>this.dispose()),this.addClickHandler(()=>this.prompt())}onInstallPrompt(e){e.preventDefault(),this.installEvent=e,this.show(),this.isInstallable.dispatch()}prompt(){this.installEvent?(this.installEvent.prompt(),this.installEvent.userChoice.then(e=>{e.outcome==="accepted"&&(this.dispose(),this.isInstalled.dispatch())})):this.dispose()}}const $w=Ae?"bridge. Nightly":"bridge. v2";class Dw{constructor(){this.current=E(""),this.appName=$w,this.titleTag=document.head.getElementsByTagName("title")[0]}setProject(e){e===Ke?(this.titleTag.innerText="",this.current.value=""):(this.titleTag.innerText=e,this.current.value=e)}}class Ew extends ${constructor(e){super(),this.app=e,this.addedProject=new H,this.activatedProject=new H,this.state=Dt({}),this.title=k(new Dw),this._selectedProject=void 0,this.projectReady=new $,this.loadProjects()}get currentProject(){return this.selectedProject?this.state[this.selectedProject]:null}get selectedProject(){return this._selectedProject}get totalProjects(){return Object.keys(this.state).length}async getProjects(){return await this.fired,Object.values(this.state).filter(e=>!e.isVirtualProject)}getProject(e){return this.state[e]}async addProject(e,t=!0,i=!1){const n=new Wt(this,this.app,e,{requiresPermissions:i});return await n.loadProject(),V(this.state,n.name,n),t&&(await this.selectProject(n.name),this.addedProject.dispatch(n)),n}async removeProject(e,t=!0){if(!this.state[e.name])throw new Error("Project to delete not found");this._selectedProject=void 0,Ee(this.state,e.name),t&&await this.app.fileSystem.unlink(e.projectPath),await this.storeProjects(e.name)}async removeProjectWithName(e){const t=this.state[e];if(!t)throw new Error(`Project with name "${e}" not found`);await this.removeProject(t)}async loadProjects(e=!1){await this.app.fileSystem.fired,await this.app.dataLoader.fired;const t=await this.app.fileSystem.getDirectoryHandle("projects",{create:!0}),i=await this.app.fileSystem.getDirectoryHandle("~local/projects",{create:!0}),n=this.app.bridgeFolderSetup.hasFired;for await(const a of t.values())a.kind==="directory"&&await this.addProject(a,!1,e);if(n)for await(const a of i.values())a.kind==="directory"&&await this.addProject(a,!1,!1);n?await this.storeProjects(void 0,!0):await this.createVirtualProject(),this.dispatch()}async createVirtualProject(){const e=await this.app.fileSystem.getDirectoryHandle(`projects/${Ke}`,{create:!0}),t=new Z(e),i={name:"bridge",namespace:"bridge",author:[],description:"",bpAsRpDependency:!1,experimentalGameplay:{},icon:null,packs:["behaviorPack",".bridge"],rpAsBpDependency:!1,targetVersion:await ys(this.app.dataLoader),useLangForManifest:!1,bdsProject:!1,uuids:{data:D(),resources:D(),skin_pack:D(),world_template:D()}};await Promise.all(["BP",".bridge"].map(n=>t.mkdir(n))),await new bi().create(t,i),await this.addProject(e,!1)}async selectProject(e,t=!1){var i,n;if(this.app.viewComMojangProject.hasComMojangProjectLoaded&&await this.app.viewComMojangProject.clearComMojangProject(),this._selectedProject===e)return!0;if(this.state[e]===void 0){if(t)return new U({description:"packExplorer.noProjectView.projectNoLongerExists"}),!1;throw new Error(`Cannot select project "${e}" because it no longer exists`)}return this.app.comMojang.hasFired||this.app.comMojang.setupComMojang(),(i=this.currentProject)==null||i.deactivate(),this._selectedProject=e,l.eventSystem.dispatch("disableValidation",null),(n=this.currentProject)==null||n.activate(),await pe("selectedProject",e),this.app.themeManager.updateTheme(),l.eventSystem.dispatch("projectChanged",this.currentProject),await this.storeProjects(),this.projectReady.hasFired||this.projectReady.dispatch(),!0}async selectLastProject(){if(await this.fired,A.value){const e=await fe("selectedProject");let t=!1;if(typeof e=="string"&&(t=await this.selectProject(e,!0)),t)return}await this.selectProject(Ke)}updateAllEditorOptions(e){Object.values(this.state).forEach(t=>t.tabSystems.forEach(i=>i.updateOptions(e)))}forEachProject(e){return Object.values(this.state).forEach(e),this.addedProject.on(e)}onActiveProject(e){return this.projectReady.hasFired&&this.currentProject&&e(this.currentProject),this.activatedProject.on(e)}someProject(e){return Object.values(this.state).some(e)}async recompileAll(e=!0){for(const t of Object.values(this.state))await t.recompile(e)}async loadAvailableProjects(e){return(await this.app.fileSystem.readJSON("~local/data/projects.json").catch(()=>[])).filter(t=>!e||t.name!==e)}async storeProjects(e,t=!1){let i=await this.loadAvailableProjects(e),n=t?[]:i;this.forEachProject(a=>{var o,c;if(a.isVirtualProject)return;const r=i.find(d=>a.name===d.name&&a.requiresPermissions===d.requiresPermissions);!t&&r||n.push({name:a.name,displayName:(o=a.config.get().name)!=null?o:a.name,icon:a.projectData.imgSrc,requiresPermissions:a.requiresPermissions,isFavorite:(c=r==null?void 0:r.isFavorite)!=null?c:!1})}),await this.app.fileSystem.writeJSON("~local/data/projects.json",n),l.eventSystem.dispatch("availableProjectsFileChanged",void 0)}}class Mw{constructor(){this.mayCloseOnClickOutside=!0,this.isVisible=E(!1),this.actionManager=E(),this.position=G({x:0,y:0}),this.menuHeight=0}show(e,t,i=!0){this.position.x=e.clientX,this.position.y=e.clientY,this.actionManager.value=k(t),this.mayCloseOnClickOutside=i,this.menuHeight=this.actionManager.value.getAllElements().reduce((n,a)=>{switch(a.type){case"submenu":return n+40;case"divider":return n+1;case"action":default:return n+40}},0)+16,this.isVisible.value=!0}setMayCloseOnClickOutside(e){setTimeout(()=>{this.mayCloseOnClickOutside=e},100)}}class Iw extends Ks{constructor(e){super(e.fileSystem,"~local/extensions","data/inactiveExtensions.json",!0),this.app=e}async getInstalledExtensions(){return await this.app.projectManager.projectReady.fired,new Set([...(await super.getInstalledExtensions()).values(),...(await this.app.project.extensionLoader.getInstalledExtensions()).values()])}mapActive(e){const t=this.app.project.extensionLoader.mapActive(e);for(const i of this._extensions.values())i.isActive&&t.push(e(i));return t}installFilesToCurrentProject(){return Promise.all([...this.extensions.values()].map(e=>e.installFilesToCurrentProject()))}async reload(){this.disposeAll(),this.loadExtensions()}}class Ow{constructor(e){this.app=e,this.fileHandlers=new Map,window.addEventListener("dragover",t=>{t.preventDefault()}),window.addEventListener("drop",t=>{var i,n;t.preventDefault(),!l.windowState.isAnyWindowVisible.value&&this.onDrop([...(n=(i=t.dataTransfer)==null?void 0:i.items)!=null?n:[]])})}async onDrop(e){for(const t of e){const i=await t.getAsFileSystemHandle();if(!i)return;await this.import(i)}}async import(e){e.kind==="directory"?await this.importFolder(e):e.kind==="file"&&await this.importFile(e)}async importFile(e){var n;await this.app.projectManager.projectReady.fired;const t=Pe(e.name);let i=(n=this.fileHandlers.get(t))!=null?n:this.defaultImporter;if(!i)return!1;try{await i(e)}catch(a){return console.error(a),!1}return!0}async importFolder(e){await this.app.folderImportManager.onImportFolder(e)}addFileImporter(e,t){if(this.fileHandlers.has(e))throw new Error(`Handler for ${e} already exists`);return this.fileHandlers.set(e,t),{dispose:()=>this.fileHandlers.delete(e)}}setDefaultFileImporter(e){return this.defaultImporter=e,{dispose:()=>this.defaultImporter=void 0}}}class vt{constructor(e,t,i=!1){this.disposables=[];for(const n of e)this.disposables.push(t.addFileImporter(n,this.onImport.bind(this)));i&&this.disposables.push(t.setDefaultFileImporter(this.onImport.bind(this)))}dispose(){this.disposables.forEach(e=>e.dispose())}}class Rw extends vt{constructor(e){super([".mcaddon"],e)}async onImport(e){const t=await l.getApp();t.windows.loadingWindow.open();try{await mn(e)}catch(i){console.error(i)}finally{t.windows.loadingWindow.close()}}}const Ww=X({__name:"Window",props:["window"],setup(s){const e=s,{t}=I(),i=e.window.getState();function n(a){e.window.startCloseWindow(a)}return{__sfc:!0,t,props:e,state:i,onClose:n,PresetPath:fa,BaseWindow:de}}});var Lw=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return i.state.shouldRender?t(i.BaseWindow,{attrs:{windowTitle:`[${i.t("windows.filePath.title")}${e.window.hasFilePath?`: ${i.state.fileName}${e.window.fileExt}`:""}]`,isVisible:i.state.isVisible,hasMaximizeButton:!1,isFullscreen:!1,isPersistent:e.window.isPersistent,hasCloseButton:!1,width:440,height:170},on:{closeWindow:function(n){return i.onClose(!0)}},scopedSlots:e._u([{key:"default",fn:function(){return[e.window.hasFilePath?t("span",{staticClass:"d-flex align-center"},[t("v-text-field",{attrs:{dense:"",outlined:"","prepend-icon":"mdi-pencil-outline",rules:[n=>!!n.match(/^[a-zA-Z0-9_\.]*$/)||i.t("windows.createPreset.validationRule.alphanumeric"),n=>!!n||i.t("windows.createPreset.validationRule.required"),n=>n.toLowerCase()===n||i.t("windows.createPreset.validationRule.lowercase")]},model:{value:i.state.fileName,callback:function(n){e.$set(i.state,"fileName",n)},expression:"state.fileName"}}),t("span",{staticClass:"ml-3 mb-6"},[e._v(e._s(e.window.fileExt))])],1):e._e(),t(i.PresetPath,{model:{value:i.state.currentFilePath,callback:function(n){e.$set(i.state,"currentFilePath",n)},expression:"state.currentFilePath"}})]},proxy:!0},{key:"actions",fn:function(){return[t("v-spacer"),t("v-btn",{attrs:{color:"primary"},on:{click:function(n){return i.onClose(!1)}}},[t("v-icon",[e._v("mdi-check")]),t("span",[e._v(" "+e._s(i.t("general.confirm"))+" ")])],1)]},proxy:!0}],null,!1,281310210)}):e._e()},Nw=[],Bw=_(Ww,Lw,Nw,!1,null,null,null,null);const Vw=Bw.exports;class Hw extends Y{constructor({fileName:e,startPath:t="",isPersistent:i=!1}){super(Vw,!0,!1),this.isPersistent=!1,this.hasFilePath=!1,this.state=G({...super.state,fileName:"",currentFilePath:""}),this.state.currentFilePath=t,this.isPersistent=i,e&&(this.hasFilePath=!0,this.fileExt=Pe(e),this.state.fileName=me(e,this.fileExt)),this.defineWindow(),this.open()}startCloseWindow(e){return this.close(e?null:{filePath:this.state.currentFilePath,fileName:this.hasFilePath?`${this.state.fileName}${this.fileExt}`:void 0})}}class Uw extends vt{constructor(e){super([".mcfunction",".mcstructure",".json",".molang",".js",".ts",".lang",".tga",".png",".jpg",".jpeg",".wav",".ogg",".mp3",".fsb"],e,!0)}async onImport(e){const t=await l.getApp(),i=B;if(await t.projectManager.projectReady.fired,t.project.isVirtualProject)return await this.onOpen(e);const n=new It("fileDropper.importMethod.name",{isPersistent:!1}),a=await n.actionManager;a.create({icon:"mdi-content-save-outline",name:"fileDropper.saveToProject.title",description:`[${i("fileDropper.saveToProject.description1")} "${e.name}" ${i("fileDropper.saveToProject.description2")}]`,onTrigger:()=>this.onSave(e)}),a.create({icon:"mdi-share-outline",name:"fileDropper.openFile.title",description:`[${i("fileDropper.openFile.description1")} "${e.name}" ${i("fileDropper.openFile.description2")}]`,onTrigger:()=>this.onOpen(e)}),n.open(),await n.fired}async onSave(e){const t=await l.getApp(),i=await l.fileType.guessFolder(e),n=new Hw({fileName:e.name,startPath:i?t.project.relativePath(i):"",isPersistent:!1});n.open();const a=await n.fired;if(a===null)return;const{filePath:r,fileName:o=e.name}=a,c=Re(r,o);if(await t.project.fileSystem.fileExists(c)){const u=new W({description:"windows.createPreset.overwriteFiles",confirmText:"windows.createPreset.overwriteFilesConfirm"});if(u.open(),!await u.fired)return}t.windows.loadingWindow.open();const p=await t.project.fileSystem.getFileHandle(c,!0);await t.project.fileSystem.copyFileHandle(e,p),l.eventSystem.dispatch("fileAdded",void 0),await t.project.updateFile(t.project.config.resolvePackPath(void 0,c)),await t.project.openFile(p,{isTemporary:!1}),t.windows.loadingWindow.close()}async onOpen(e){await(await l.getApp()).project.openFile(e)}}class zw extends vt{constructor(e){super([".brproject"],e)}async onImport(e){await un(e)}}function qw(s,e,t){return Math.min(Math.max(s,e),t)}class Jw extends vt{constructor(e){super([".bbmodel"],e)}async onImport(e){const t=await l.getApp(),i=await e.getFile(),n=R.parse(await i.text());t.windows.loadingWindow.open(),n.textures&&await this.exportImages(t,n.textures),n.elements&&n.outliner&&await this.exportModel(t,n),n.animations&&await this.exportAnimations(t,n.animations,n.name),t.windows.loadingWindow.close()}async exportImages(e,t){for(let i of t){const n=await fetch(i.source),a=await n.arrayBuffer(),r=n.headers.get("content-type");let o="png";switch(r){case"image/png":o="png";break;case"image/jpeg":case"image/jpg":o="jpg";break;case"image/tga":case"image/x-tga":case"image/x-targa":case"image/target":case"application/x-tga":case"application/x-targa":o="tga";break}const c=await new pt({name:"general.textureLocation",default:"entity",options:["entity","blocks","items"]}).fired,d=Re("RP","textures",c,Pe(i.name)===""?`${i.name}.${o}`:i.name);if(await e.project.fileSystem.fileExists(d)){const f=new W({description:"general.confirmOverwriteFile",confirmText:"windows.createPreset.overwriteFilesConfirm"});if(f.open(),!await f.fired)continue}const u=await e.project.fileSystem.writeFile(d,a);l.eventSystem.dispatch("fileAdded",void 0),await e.project.updateFile(e.project.absolutePath(d)),await e.project.openFile(u,{isTemporary:!1})}}async exportModel(e,t){var u,f,h,m,g,w;const i={description:{identifier:"geometry."+(t.geometry_name||"unknown"),texture_width:t.resolution.width||16,texture_height:t.resolution.height||16,visible_bounds_width:(f=(u=t.visible_box)==null?void 0:u[0])!=null?f:0,visible_bounds_height:(m=(h=t.visible_box)==null?void 0:h[1])!=null?m:0,visible_bounds_offset:[0,(w=(g=t.visible_box)==null?void 0:g[2])!=null?w:0,0]}},n={format_version:"1.12.0","minecraft:geometry":[i]},a=this.extractCubes(t.elements,t.meta.box_uv),r=this.extractLocators(t.elements),o=this.createBones(t,a,r);o.size>0&&(i.bones=[...o.values()]);const c=Re("RP","models","entity",t.name+".json");if(await e.project.fileSystem.fileExists(c)){const v=new W({description:"general.confirmOverwriteFile",confirmText:"windows.createPreset.overwriteFilesConfirm"});if(v.open(),!await v.fired)return}const p=await e.project.fileSystem.getFileHandle(c,!0);await e.project.fileSystem.writeJSON(c,n,!0),l.eventSystem.dispatch("fileAdded",void 0),await e.project.updateFile(e.project.absolutePath(c)),await e.project.openFile(p,{isTemporary:!1})}extractCubes(e,t=!0){const i=new Map;return e.forEach(n=>{if(n.type==="locator")return;const a=Array.isArray(n.rotation)&&n.rotation.every(o=>o!==0),r={origin:n.from?[...n.from]:void 0,size:n.to.map((o,c)=>o-n.from[c]),rotation:a?n.rotation.map((o,c)=>c===2?o:-o):void 0,pivot:a?[n.origin[0]*-1,n.origin[1],n.origin[2]]:void 0,inflate:n.inflate};if(r.origin&&(r.origin[0]=-(r.origin[0]+r.size[0])),t)r.uv=n.uv_offset,n.mirror_uv&&(r.mirror=n.mirror_uv);else{r.uv={};for(const[o,c]of Object.entries(n.faces))c.texture!==null&&(r.uv[o]={uv:[c.uv[0],c.uv[1]],uv_size:[c.uv[2]-c.uv[0],c.uv[3]-c.uv[1]]},c.material_name&&(r.uv[o].material_instance=c.material_name),(o==="up"||o==="down")&&(r.uv[o].uv[0]+=r.uv[o].uv_size[0],r.uv[o].uv[1]+=r.uv[o].uv_size[1],r.uv[o].uv_size[0]*=-1,r.uv[o].uv_size[1]*=-1))}i.set(n.uuid,r)}),i}extractLocators(e){const t=new Map;return e.forEach(i=>{if(i.type!=="locator")return;const n={offset:[...i.from]};n.offset[0]*=-1,(i.rotation[0]!==0||i.rotation[1]!==0||i.rotation[2]!==0)&&(n.rotation=[-i.rotation[0],-i.rotation[0],i.rotation[0]]),t.set(i.name,n)}),t}createBones(e,t,i){const n=new Map;return Array.isArray(e.outliner)&&e.outliner.forEach(a=>this.parseOutlinerElement(a,n,t,i)),n}parseOutlinerElement(e,t,i,n,a){const r={name:e.name,parent:a==null?void 0:a.name,pivot:e.origin?[e.origin[0]*-1,e.origin[1],e.origin[2]]:void 0,rotation:e.rotation?[e.rotation[0]*-1,e.rotation[1]*-1,e.rotation[2]]:void 0,binding:e.bedrock_binding,mirror:e.mirror_uv,material:e.material,reset:e.reset,cubes:e.children.filter(o=>typeof o=="string").map(o=>i.get(o)).filter(o=>o!==void 0),locators:Object.fromEntries(e.children.filter(o=>typeof o=="string").map(o=>[o,n.get(o)]).filter(([o,c])=>c!==void 0))};if(r.cubes.length===0&&(r.cubes=void 0),Object.keys(r.locators).length===0&&(r.locators=void 0),t.set(e.name,r),Array.isArray(e.children))for(let o of e.children)o instanceof Object&&this.parseOutlinerElement(o,t,i,n,r)}async exportAnimations(e,t,i){const n={format_version:"1.8.0",animations:{}};for(let c of t){let d;c.loop==="hold"?d="hold_on_last_frame":(c.loop==="loop"||this.getAnimationLength(c)==0)&&(d=!0);const p={loop:d,animation_length:c.length?c.length:void 0,override_previous_animation:c.override?!0:void 0,anim_time_update:c.anim_time_update?c.anim_time_update.replace(/\n/g,""):void 0,blend_weight:c.blend_weight?c.blend_weight.replace(/\n/g,""):void 0,start_delay:c.start_delay?c.start_delay.replace(/\n/g,""):void 0,loop_delay:c.loop_delay&&d?c.loop_delay.replace(/\n/g,""):void 0,bones:{},sound_effects:{},particle_effects:{},timeline:{}};for(let u in c.animators){let f=c.animators[u];if(!!f.keyframes.length){if(f.type==="effect")f.keyframes.filter(h=>h.channel==="sound").sort((h,m)=>h.time-m.time).forEach(h=>{p.sound_effects[this.getTimecodeString(h.time)]=this.compileBedrockKeyframe(h,f)}),f.keyframes.filter(h=>h.channel==="particle").sort((h,m)=>h.time-m.time).forEach(h=>{p.particle_effects[this.getTimecodeString(h.time)]=this.compileBedrockKeyframe(h,f)}),f.keyframes.filter(h=>h.channel==="timeline").sort((h,m)=>h.time-m.time).forEach(h=>{p.timeline[this.getTimecodeString(h.time)]=this.compileBedrockKeyframe(h,f)});else if(f.type==="bone"){let h=p.bones[f.name]={},m={};f.keyframes.forEach(g=>{m[g.channel]||(m[g.channel]={});let w=this.getTimecodeString(g.time);m[g.channel][w]=this.compileBedrockKeyframe(g,f)});for(let g of["rotation","position","scale","particle","sound","timeline"])if(m[g]){let w=Object.keys(m[g]);w.length===1&&f.keyframes[0].data_points.length==1&&f.keyframes[0].interpolation!="catmullrom"?(h[g]=m[g][w[0]],g==="scale"&&m[g][w[0]]instanceof Array&&m[g][w[0]].every(v=>v!==m[g][w[0]][0])&&(h[g]=m[g][w[0]][0])):w.sort((v,C)=>parseFloat(v)-parseFloat(C)).forEach(v=>{h[g]||(h[g]={}),h[g][v]=m[g][v]})}}}}Object.keys(p.bones).length==0&&delete p.bones,Object.keys(p.sound_effects).length==0&&delete p.sound_effects,Object.keys(p.particle_effects).length==0&&delete p.particle_effects,Object.keys(p.timeline).length==0&&delete p.timeline,n.animations[c.name]=p}const a=Re("RP","animations",i+".animation.json");if(await e.project.fileSystem.fileExists(a)){const c=new W({description:"general.confirmOverwriteFile",confirmText:"windows.createPreset.overwriteFilesConfirm"});if(c.open(),!await c.fired)return}const o=await e.project.fileSystem.getFileHandle(a,!0);await e.project.fileSystem.writeJSON(a,n,!0),l.eventSystem.dispatch("fileAdded",void 0),await e.project.updateFile(e.project.absolutePath(a)),await e.project.openFile(o,{isTemporary:!1})}compileBedrockKeyframe(e,t){if(e.channel==="rotation"||e.channel==="position"||e.channel==="scale")if(e.interpolation!="linear"&&e.interpolation!="step"){let i=this.getPreviousKeyframe(e,t),n=!i&&e.time>0||i&&i.interpolation=="catmullrom";return{pre:n?this.getTransformArray(e,0):void 0,post:this.getTransformArray(e,n?1:0),lerp_mode:e.interpolation}}else if(e.data_points.length==1){let i=this.getPreviousKeyframe(e,t);return i&&i.interpolation=="step"?{pre:this.getTransformArray(i,1),post:this.getTransformArray(e)}:this.getTransformArray(e)}else return{pre:this.getTransformArray(e,0),post:this.getTransformArray(e,1)};else if(e.channel==="timeline"){let i=[];return e.data_points.forEach(n=>{n.script&&i.push(...n.script.split(`
`))}),i=i.filter(n=>!!n.replace(/[\n\s;.]+/g,"")),i.length<=1?i[0]:i}else{let i=[];return e.data_points.forEach(n=>{if(n.effect){let a=n.script||void 0;a&&!a.replace(/[\n\s;.]+/g,"")&&(a=void 0),a&&!a.match(/;$/)&&(a+=";"),i.push({effect:n.effect,locator:n.locator||void 0,pre_effect_script:a})}}),i.length<=1?i[0]:i}}getPreviousKeyframe(e,t){let i=t.keyframes.filter(n=>n.time<e.time&&n.channel==e.channel);return i.sort((n,a)=>a.time-n.time),i[0]}getTransformArray(e,t=0){function i(a,r,o){if(o&&(o=qw(o,0,a.data_points.length-1)),o=a.data_points[o],!o||!o[r])return 0;if(isNaN(o[r]))return o[r];{let c=parseFloat(o[r]);return isNaN(c)?0:c}}let n=[i(e,"x",t),i(e,"y",t),i(e,"z",t)];return n.forEach((a,r)=>{a.replace&&(n[r]=a.replace(/\n/g,""))}),n}getAnimationLength(e){let t=e.length||0;for(let i in e.animators){let a=e.animators[i].keyframes;a.find(r=>r.interpolation==="catmullrom")&&(a=a.slice().sort((r,o)=>r.time-o.time)),a.forEach((r,o)=>{r.interpolation==="catmullrom"&&o==a.length-1||(t=Math.max(t,a[o].time))})}return t}getTimecodeString(e){let t=this.trimFloatNumber(e).toString();return t.includes(".")||(t+=".0"),t}trimFloatNumber(e){if(e==="")return e;let t=e.toFixed(4);return t=t.replace(/0+$/g,"").replace(/\.$/g,""),t==="-0"?0:t}}class Gw extends vt{constructor(e){super([".zip"],e)}async onImport(e){const t=await l.getApp(),i=t.fileSystem,n=await i.getDirectoryHandle("import",{create:!0}),a=new $t(n),r=await e.getFile(),o=new Uint8Array(await r.arrayBuffer());if(a.createTask(t.taskManager),await a.unzip(o),await i.fileExists("import/config.json")||await i.directoryExists("import/data")||await i.directoryExists("import/projects")||await i.directoryExists("import/extensions"))await un(e,!1,!1);else for await(const c of n.values())if(await i.fileExists(`import/${c.name}/manifest.json`)){await mn(e,!1,!1);break}}}async function Kw(s,e=!1,t=!0){var u,f,h;const i=await l.getApp(),n=i.fileSystem,a=await n.getDirectoryHandle("import",{create:!0});if(e||await i.projectManager.projectReady.fired,t){const m=new $t(a),g=await s.getFile(),w=new Uint8Array(await g.arrayBuffer());m.createTask(i.taskManager),await m.unzip(w)}const r=s.name.replace(".mcpack","").replace(".zip","");A.value&&!e&&await new W({description:"windows.projectChooser.openNewProject.saveCurrentProject",cancelText:"general.no",confirmText:"general.yes"}).fired&&await Ye();let o,c;const d=[".bridge"];if(await n.fileExists("import/manifest.json")){const m=await n.readJSON("import/manifest.json"),g=(u=m==null?void 0:m.modules)!=null?u:[];o||(o=(f=m==null?void 0:m.metadata)==null?void 0:f.authors),c||(c=(h=m==null?void 0:m.header)==null?void 0:h.description);const w=ha(g);if(!w)return;d.push(w);const v=Et[w];await n.move("import",`projects/${r}/${v}`)}else new U({description:"fileDropper.mcaddon.missingManifests"});const p=yt.getDefaultOptions();p.name=r,p.author=o!=null?o:["Unknown"],p.description=c!=null?c:"",p.packs=d,p.targetVersion=await Qe(),await new bi().create(new Z(await n.getDirectoryHandle(`projects/${r}`,{create:!0})),p),await n.mkdir(`projects/${r}/.bridge/extensions`),await n.mkdir(`projects/${r}/.bridge/compiler`),await i.projectManager.addProject(await n.getDirectoryHandle(`projects/${r}`),!0),A.value&&!e&&await i.projectManager.removeProject(i.project),await n.unlink("import")}class Yw extends vt{constructor(e){super([".mcpack"],e)}async onImport(e){const t=await l.getApp();t.windows.loadingWindow.open();try{await Kw(e)}catch(i){console.error(i)}finally{t.windows.loadingWindow.close()}}}class Qw{constructor(e){new Rw(e),new Uw(e),new zw(e),new Jw(e),new Gw(e),new Yw(e)}}function Zw(){try{const s=new RegExp('(?<!\\\\)"');return'\\"'.match(s)===null}catch{return!1}}class Xw extends H{constructor(){super(),this.baseKeywords=["minecraft"],this.dynamicKeywords=[],this.typeIdentifiers=[],this.variables=[],this.definitions=[],l.getApp().then(async e=>{await e.projectManager.projectReady.fired,e.projectManager.onActiveProject(t=>{this.updateKeywords(t.config),t.fileSave.on(t.config.resolvePackPath(void 0,"config.json"),()=>this.updateKeywords(t.config))})}),l.eventSystem.on("currentTabSwitched",e=>{this.loadWords(e)}),this.loadWords()}get keywords(){return this.baseKeywords.concat(this.dynamicKeywords)}get knownWords(){return{keywords:this.keywords,typeIdentifiers:this.typeIdentifiers,variables:this.variables,definitions:this.definitions}}async updateKeywords(e){await e.refreshConfig(),this.baseKeywords=[...new Set(["minecraft","bridge",e.get().namespace].filter(t=>t!==void 0))],this.updateHighlighter()}async loadWords(e){var o,c,d,p,u,f;const t=await l.getApp();await t.projectManager.projectReady.fired,await l.fileType.ready.fired;const i=e!=null?e:(o=t.project.tabSystem)==null?void 0:o.selectedTab;if(!(i instanceof ot)&&!(i instanceof Tt))return;const{id:n,highlighterConfiguration:a={},type:r}=(c=l.fileType.get(i.getPath()))!=null?c:{};if(!n)return this.resetWords();n===this.loadedFileType||r!==void 0&&r!=="json"||(this.dynamicKeywords=(d=a.keywords)!=null?d:[],this.typeIdentifiers=(p=a.typeIdentifiers)!=null?p:[],this.variables=(u=a.variables)!=null?u:[],this.definitions=(f=a.definitions)!=null?f:[],this.updateHighlighter(),this.dispatch(this.knownWords),this.loadedFileType=n)}resetWords(){this.dynamicKeywords=[],this.typeIdentifiers=[],this.variables=[],this.definitions=[],this.updateHighlighter(),this.dispatch(this.knownWords),this.loadedFileType="unknown"}async updateHighlighter(){var i;const{languages:e}=await L(),t=e.setMonarchTokensProvider("json",{defaultToken:"invalid",tokenPostfix:".json",atoms:["false","true","null"],keywords:this.keywords,typeIdentifiers:this.typeIdentifiers,variables:this.variables,definitions:this.definitions,symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,tokenizer:{root:[[/[{}]/,"delimiter.bracket"],{include:"common"}],common:[[/[a-z_$][\w$]*/,{cases:{"@atoms":"atom","@default":"identifier"}}],{include:"@whitespace"},[/(@digits)[eE]([\-+]?(@digits))?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?/,"number.float"],[/(@digits)/,"number"],[/[:,]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/"\//,{token:"identifier",next:"@embeddedCommand",nextEmbedded:"mcfunction"}],[/"/,"identifier","@string"]],embeddedCommand:[[/@escapes/,"string.escape"],[Zw()?new RegExp('(?<!\\\\)"'):/"/,{token:"identifier",next:"@pop",nextEmbedded:"@pop"}]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*\*(?!\/)/,"comment.doc","@jsdoc"],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],jsdoc:[[/[^\/*]+/,"comment.doc"],[/\*\//,"comment.doc","@pop"],[/[\/*]/,"comment.doc"]],string:[[/(\\"|[^\"\:])+/,{cases:{"@keywords":"keyword","@variables":"variable","@typeIdentifiers":"type.identifier","@definitions":"definition","@default":"string"}}],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"identifier","@pop"]]}});(i=this.currentLanguage)==null||i.dispose(),this.currentLanguage=t,this.dispatch(this.knownWords)}}class ey{constructor(){this.highlighter=new Xw,this.setModeConfiguration(),_f(),jc()}getHighlighter(){return this.highlighter}async setModeConfiguration(){const{languages:e}=await L();e.json.jsonDefaults.setModeConfiguration({colors:!1,tokens:!1,completionItems:!0,diagnostics:!0,hovers:!0,documentFormattingEdits:!0,documentRangeFormattingEdits:!0,documentSymbols:!0,foldingRanges:!0,selectionRanges:!0})}}class ty{constructor(){this.state=E({}),this.isAnyWindowVisible=E(!0),this.watchStop=new Map}addWindow(e,t){V(this.state.value,e,k(t)),this.watchStop.set(e,Ct(t.getState(),()=>this.onWindowsChanged())),this.onWindowsChanged()}deleteWindow(e){Ee(this.state.value,e);const t=this.watchStop.get(e);t&&t(),this.watchStop.delete(e),this.onWindowsChanged()}onWindowsChanged(){for(const e of Object.values(this.state.value))if(e.getState().isVisible){this.isAnyWindowVisible.value=!0;return}this.isAnyWindowVisible.value=!1}}class iy{constructor(e){this.vuetify=e,this.change=new H,Ct(e.breakpoint,()=>{this.change.dispatch(e.breakpoint.mobile)}),l.getApp().then(()=>{setTimeout(()=>this.change.dispatch(e.breakpoint.mobile),10)})}isCurrentDevice(){return this.vuetify.breakpoint.mobile}}const ny={mixins:[z],props:{color:{default:"background",type:String}},setup(){return{isUsingFileSystemPolyfill:A}},async mounted(){const s=await l.getApp();this.disposables.push(s.windowResize.on(()=>this.calculateAvailableWidth())),this.calculateAvailableWidth()},destroyed(){this.disposables.forEach(s=>s.dispose()),this.disposables=[]},data:()=>({availableWidth:0,disposables:[]}),methods:{async createProject(){(await l.getApp()).windows.createProject.open()},calculateAvailableWidth(){this.$refs.button&&(this.availableWidth=this.$refs.button.$el.getBoundingClientRect().width)}}};var sy=function(){var e=this,t=e._self._c;return t("v-tooltip",{attrs:{disabled:e.availableWidth>220,color:e.color?e.color:"tooltip",right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("v-btn",e._g({ref:"button",staticClass:"mb-2",style:{overflow:"hidden"},attrs:{color:e.color,block:"","max-width":"100%"},on:{click:function(n){return n.stopPropagation(),e.createProject.apply(null,arguments)}}},i),[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-plus")]),e.availableWidth>220?t("span",[e._v(" "+e._s(e.t("packExplorer.noProjectView.createLocalProject"))+" ")]):e._e()],1)]}}])},[t("span",[e._v(" "+e._s(e.t("packExplorer.noProjectView.createLocalProject"))+" ")])])},ay=[],ry=_(ny,sy,ay,!1,null,null,null,null);const ya=ry.exports,oy={mixins:[z],props:{color:{default:"primary",type:String}},setup(){return{isUsingFileSystemPolyfill:A}},async mounted(){const s=await l.getApp();this.hasDirectorySelected=await fe("bridgeBaseDir")!==void 0,this.disposables.push(s.bridgeFolderSetup.once(()=>{this.isBridgeFolderSelected=!0},!0)),this.disposables.push(s.windowResize.on(()=>this.calculateAvailableWidth())),this.calculateAvailableWidth()},destroyed(){this.disposables.forEach(s=>s.dispose()),this.disposable=[]},data(){return{hasDirectorySelected:!1,isBridgeFolderSelected:!1,disposables:[],availableWidth:0}},methods:{async selectBridgeFolder(){await(await l.getApp()).setupBridgeFolder(this.isBridgeFolderSelected)},calculateAvailableWidth(){this.$refs.button&&(this.availableWidth=this.$refs.button.$el.getBoundingClientRect().width)}}};var cy=function(){var e=this,t=e._self._c;return e.isUsingFileSystemPolyfill?e._e():t("v-tooltip",{attrs:{disabled:e.availableWidth>220,color:e.color?e.color:"tooltip",right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("v-btn",e._g({ref:"button",staticClass:"mb-2",style:{overflow:"hidden"},attrs:{color:e.color,block:"","max-width":"100%"},on:{click:e.selectBridgeFolder}},i),[t("v-icon",{staticClass:"mr-1"},[e._v("mdi-folder-outline")]),e.availableWidth>220?t("span",[e._v(" "+e._s(e.t(`packExplorer.noProjectView.${e.hasDirectorySelected&&!e.isBridgeFolderSelected?"accessBridgeFolder":"chooseBridgeFolder"}`))+" ")]):e._e()],1)]}}],null,!1,2208143815)},[t("span",[e._v(" "+e._s(e.t(`packExplorer.noProjectView.${e.hasDirectorySelected&&!e.isBridgeFolderSelected?"accessBridgeFolder":"chooseBridgeFolder"}`))+" ")])])},ly=[],dy=_(oy,cy,ly,!1,null,null,null,null);const va=dy.exports,py={mixins:[z],components:{BridgeSheet:Ne,CreateProjectBtn:ya,BridgeFolderBtn:va,ActionViewer:mt},setup(){return{isUsingFileSystemPolyfill:A}},async mounted(){var e;this.hasComMojangSetup=await fe(Je)!==void 0,this.didChooseEditorType=(e=await fe("didChooseEditorType"))!=null?e:!1,this.setupStepCount=Number(!this.hasComMojangSetup)+Number(!this.didChooseEditorType);const s=await l.getApp();this.disposables.push(s.comMojang.setup.once(()=>{console.log(this.hasComMojangSetup),this.hasComMojangSetup=!0},!0)),this.disposables.push(l.installApp.isInstallable.once(()=>this.showInstallAppButton=!0,!0)),this.disposables.push(l.installApp.isInstalled.once(()=>this.showInstallAppButton=!1,!0))},destroyed(){this.disposables.forEach(s=>s.dispose())},data(){return{hasComMojangSetup:!0,didChooseEditorType:!1,showInstallAppButton:!1,setupStepCount:0,disposables:[],actions:[new M({icon:"mdi-text",name:"initialSetup.step.editorType.rawText.name",description:"initialSetup.step.editorType.rawText.description",onTrigger:async()=>{this.isLoading||(this.isLoading=!0,await this.setJsonEditor("rawText"),this.$emit("next"))}}),new M({icon:"mdi-file-tree",name:"initialSetup.step.editorType.treeEditor.name",description:"initialSetup.step.editorType.treeEditor.description",onTrigger:async()=>{this.isLoading||(this.isLoading=!0,await this.setJsonEditor("treeEditor"),this.$emit("next"))}})]}},methods:{async setJsonEditor(s){await Me.loadSettings(l.instance),S.editor||(S.editor={}),S.editor.jsonEditor=s,await Me.saveSettings(l.instance),this.didChooseEditorType=!0,await pe("didChooseEditorType",!0)},installApp(){l.installApp.prompt()}}};var uy=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{overflow:"hidden"}},[t("BridgeFolderBtn"),t("CreateProjectBtn",{attrs:{color:"success"}}),t("BridgeSheet",{staticClass:"pa-2 mb-2 d-flex flex-column",attrs:{dark:""}},[t("v-icon",{staticClass:"mb-4",staticStyle:{"font-size":"3rem"},attrs:{color:"error"}},[e._v(" mdi-folder-open-outline ")]),e._v(" "+e._s(e.t("packExplorer.noProjectView.noProjectsFound"))+" ")],1),e.showInstallAppButton?t("BridgeSheet",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"pa-2 mb-2 d-flex flex-column clickable",attrs:{dark:""},nativeOn:{click:function(i){return e.installApp.apply(null,arguments)}}},[t("v-icon",{staticClass:"mb-4",staticStyle:{"font-size":"3rem"},attrs:{color:"primary"}},[e._v(" mdi-download ")]),e._v(" "+e._s(e.t("initialSetup.step.installApp.description"))+" ")],1):e._e(),!e.hasComMojangSetup&&!e.isUsingFileSystemPolyfill?t("BridgeSheet",{staticClass:"pa-2 mb-2 d-flex flex-column",attrs:{dark:""}},[t("v-icon",{staticClass:"mb-4",staticStyle:{"font-size":"3rem"},attrs:{color:"success"}},[e._v(" mdi-minecraft ")]),e._v(" "+e._s(e.t("initialSetup.step.comMojang.description"))+" ")],1):e.didChooseEditorType?e._e():t("div",[t("BridgeSheet",{staticClass:"pa-2 mb-2 d-flex flex-column",attrs:{dark:""}},[t("v-icon",{staticClass:"mb-4",staticStyle:{"font-size":"3rem"},attrs:{color:"success"}},[e._v(" mdi-pencil-outline ")]),e._v(" "+e._s(e.t("initialSetup.step.editorType.description"))+" ")],1),e._l(e.actions,function(i,n){return t("ActionViewer",{directives:[{name:"ripple",rawName:"v-ripple"}],key:n,staticClass:"clickable",attrs:{dark:"",action:i,hideTriggerButton:""},nativeOn:{click:function(a){return i.trigger()}}})})],2),!e.isUsingFileSystemPolyfill&&e.setupStepCount===2&&(!e.didChooseEditorType||!e.hasComMojangSetup)?t("div",{staticClass:"d-flex justify-center"},[t("span",[t("v-icon",{staticClass:"mr-1",attrs:{color:"primary",small:""}},[e._v("mdi-cog")]),t("strong",[e._v("Setup Step:")]),e._v(" "+e._s(e.hasComMojangSetup?2:1)+" / 2 ")],1),t("v-spacer"),e.hasComMojangSetup?e._e():t("v-btn",{attrs:{icon:"",small:""},on:{click:function(i){e.hasComMojangSetup=!0}}},[t("v-icon",[e._v("mdi-chevron-right")])],1)],1):e._e()],1)},hy=[],fy=_(py,uy,hy,!1,null,null,null,null);const my=fy.exports,gy={components:{BridgeSheet:Ne},props:{project:Object,isLoading:Boolean},async mounted(){const s=await l.getApp();this.disposables.push(s.windowResize.on(()=>this.calculateAvailableWidth())),this.calculateAvailableWidth()},destroyed(){this.disposables.forEach(s=>s.dispose()),this.disposables=[]},data:()=>({disposables:[],availableWidth:0}),computed:{miniLayout(){return this.availableWidth<100}},methods:{calculateAvailableWidth(){this.$refs.sheet&&(this.availableWidth=this.$refs.sheet.$el.getBoundingClientRect().width)},onClick(){this.$emit("click")}}};var wy=function(){var e=this,t=e._self._c;return t("div",{staticClass:"clickable"},[t("v-tooltip",{attrs:{color:"tooltip",right:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("BridgeSheet",e._g({ref:"sheet",staticClass:"d-flex align-center justify-center mb-2",class:{"flex-column":e.miniLayout},style:{overflow:"hidden",height:e.miniLayout?void 0:"5rem",border:`2px solid ${e.project.isFavorite?"var(--v-primary-base)":"var(--v-background-base)"}`},attrs:{dark:"",isLoading:e.isLoading},on:{click:e.onClick}},i),[e.project.icon?t("img",{staticClass:"rounded-lg",style:{margin:e.miniLayout?"0.5rem":"0 0.5rem",maxWidth:e.miniLayout?"2rem":"4rem",minWidth:e.availableWidth>124?"4rem":"2rem","image-rendering":"pixelated"},attrs:{src:e.project.icon,alt:e.project.displayName}}):t("div",{staticClass:"d-flex justify-center"},[t("v-icon",{style:{"font-size":"4rem"},attrs:{color:"primary",size:"xl"}},[e._v(" mdi-alpha-"+e._s(e.project.displayName[0].toLowerCase())+"-box-outline ")])],1),e.miniLayout&&e.availableWidth>65||e.availableWidth>154?t("span",{staticClass:"px-2",style:{textAlign:"center",width:e.miniLayout?"100%":null,overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[e._v(" "+e._s(e.project.displayName)+" ")]):e._e(),t("v-spacer"),t("BridgeSheet",{staticClass:"px-1 d-flex align-center justify-center",style:{margin:e.miniLayout?"0.5rem":"0 0.5rem 0 0",height:"4rem",width:e.miniLayout?"calc(100% - 1rem)":null}},[e.project.requiresPermissions?e._e():t("v-icon",{attrs:{color:"accent"}},[e._v(" mdi-lock-open-outline ")]),t("v-btn",{attrs:{icon:"",small:"",color:e.project.isFavorite?"primary":null},on:{click:function(n){return n.stopPropagation(),e.$emit("pin")}}},[t("v-icon",[e._v(" mdi-pin"+e._s(e.project.isFavorite?"":"-outline")+" ")])],1)],1)],1)]}}])},[t("span",[e._v(" "+e._s(e.project.displayName)+" ")])])],1)},yy=[],vy=_(gy,wy,yy,!1,null,null,null,null);const by=vy.exports,_y={components:{CreateProjectBtn:ya,BridgeFolderBtn:va,SetupView:my,Project:by},setup(){return{isUsingFileSystemPolyfill:A}},mounted(){this.loadProjects(),this.disposable=l.eventSystem.on("availableProjectsFileChanged",()=>this.loadProjects())},destroyed(){this.disposable&&(this.disposable.dispose(),this.disposable=null)},data(){return{isLoading:!0,projectData:[],disposable:null}},methods:{async loadProjects(){this.isLoading=!0;const s=await l.getApp();this.projectData=await s.fileSystem.readJSON("~local/data/projects.json").catch(()=>[]),this.projectData=this.projectData.map(e=>{var t;return{...e,isFavorite:(t=e.isFavorite)!=null?t:!1,isLoading:!1}}),this.sortProjects(),this.isLoading=!1},sortProjects(){this.projectData=this.projectData.sort((s,e)=>s.isFavorite&&!e.isFavorite?-1:!s.isFavorite&&e.isFavorite?1:s.displayName.localeCompare(e.displayName))},async saveProjects(){await(await l.getApp()).fileSystem.writeJSON("~local/data/projects.json",this.projectData.map(e=>({...e,isLoading:void 0})))},async selectProject(s){s.isLoading=!0;const e=await l.getApp();if(s.requiresPermissions&&!await e.setupBridgeFolder()){s.isLoading=!1;return}await e.projectManager.selectProject(s.name,!0),s.isLoading=!1},async onFavoriteProject(s){s.isFavorite=!s.isFavorite,this.sortProjects(),await this.saveProjects()}}};var Sy=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pa-2"},[e.isLoading?t("v-progress-linear",{attrs:{indeterminate:""}}):e.projectData.length===0?t("SetupView"):[t("BridgeFolderBtn"),t("CreateProjectBtn"),t("v-slide-y-transition",{staticClass:"py-0",attrs:{group:""}},e._l(e.projectData,function(i){return t("Project",{key:`${i.name}//${i.requiresPermissions}`,attrs:{project:i,isLoading:i.isLoading},on:{click:function(n){return e.selectProject(i)},pin:function(n){return e.onFavoriteProject(i)}}})}),1)]],2)},Cy=[],ky=_(_y,Sy,Cy,!1,null,null,null,null);const xy=ky.exports,Py={props:{sidebarContent:Object},components:{HomeView:xy,DirectoryViewer:wi}};var jy=function(){var e=this,t=e._self._c;return e.sidebarContent.showNoProjectView?t("HomeView"):e.sidebarContent.selectedAction?t("DirectoryViewer",{key:e.sidebarContent.selectedAction.config.id,attrs:{directoryHandle:e.sidebarContent.directoryEntries[e.sidebarContent.selectedAction.config.id]}}):e._e()},Fy=[],Ty=_(Py,jy,Fy,!1,null,null,null,null);const Ay=Ty.exports;const $y="/img/icons/android-chrome-192x192.png",Dy={props:{imgSrc:{type:String,default:$y},name:{type:String,default:"Unknown"}},methods:{async onClick(){const s=await l.getApp();A.value?wn():s.windows.projectChooser.open()}}};var Ey=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"d-flex align-center pa-2 clickable",on:{click:e.onClick}},[t("img",{staticClass:"rounded-lg",staticStyle:{"image-rendering":"pixelated"},attrs:{src:e.imgSrc,draggable:"false",height:"44px",alt:`Pack Icon of ${e.name}`}}),t("h1",{staticClass:"project-display-header ml-2",staticStyle:{opacity:"0.7",display:"block",width:"calc(100% - 52px)","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"}},[e._v(" "+e._s(e.name)+" ")])])},My=[],Iy=_(Dy,Ey,My,!1,null,"b02f4382",null,null);const ba=Iy.exports,Oy={components:{ProjectDisplay:ba},data:()=>({imgSrc:void 0,name:void 0}),mounted(){this.onProjectChanged(),l.eventSystem.on("projectChanged",this.onProjectChanged)},destroyed(){l.eventSystem.off("projectChanged",this.onProjectChanged)},methods:{async onProjectChanged(){const s=await l.getApp();await s.projectManager.projectReady.fired;const e=s.project.projectData;this.name=e.name,this.imgSrc=e.imgSrc}}};var Ry=function(){var e=this,t=e._self._c;return t("ProjectDisplay",{attrs:{imgSrc:e.imgSrc,name:e.name}})},Wy=[],Ly=_(Oy,Ry,Wy,!1,null,null,null,null);const Ny=Ly.exports;async function By(){var n,a,r,o,c,d;const s=await l.getApp();if(s.windows.loadingWindow.open(),(a=(n=S==null?void 0:S.projects)==null?void 0:n.incrementVersionOnExport)!=null?a:A.value){const p=s.fileSystem;let u={};for(const h of s.project.getPacks()){const m=s.project.config.resolvePackPath(h,"manifest.json");if(await p.fileExists(m)){let g;try{g=(r=await p.readJSON(m))!=null?r:{}}catch{continue}const[w,v,C]=(c=(o=g.header)==null?void 0:o.version)!=null?c:[0,0,0],P=[w,v,C+1];u[m]={...g,header:{...(d=g.header)!=null?d:{},version:P}}}}const f=Object.values(u);for(const h of f)!Array.isArray(h.dependencies)||h.dependencies.forEach(m=>{const g=f.find(w=>w.header.uuid===m.uuid);!g||(m.version=g.header.version)});for(const[h,m]of Object.entries(u))await p.writeJSON(h,m,!0)}const e=await s.project.createDashService("production");await e.setup(),await e.build();const t=new gi(await s.project.fileSystem.getDirectoryHandle("builds/dist",{create:!0})),i=s.project.config.resolvePackPath(void 0,`builds/${s.project.name}.mcaddon`);try{await di(i,await t.package(),s.fileSystem)}catch(p){console.error(p)}s.windows.loadingWindow.close()}async function qn(s=!1){var u,f,h,m,g;const e=await l.getApp(),t=e.project,i=t.fileSystem;e.windows.loadingWindow.open();const n=await e.project.createDashService("production");await n.setup(),await n.build();let a=[];t.hasPacks(["worldTemplate"])&&a.push("WT"),await i.directoryExists("worlds")&&a.push(...(await i.readdir("worlds")).map(w=>`worlds/${w}`));let r;if(a.length===0){e.windows.loadingWindow.close();return}else a.length===1?r=a[0]:r=await new pt({default:a[0],name:"packExplorer.exportAsMctemplate.chooseWorld",options:a}).fired;await i.mkdir("builds/mctemplate/behavior_packs",{recursive:!0}),await i.mkdir("builds/mctemplate/resource_packs",{recursive:!0});const o=await i.readdir("builds/dist"),c=Object.fromEntries(Object.entries({BP:o.find(w=>w.endsWith("BP")),RP:o.find(w=>w.endsWith("RP")),WT:o.find(w=>w.endsWith("WT"))}).map(([w,v])=>[w,`builds/dist/${v}`]));if(r==="WT"?await i.move(c.WT,"builds/mctemplate"):await i.copyFolder(r,"builds/mctemplate"),c.BP){const w=await i.readJSON(`${c.BP}/manifest.json`).catch(()=>null);w!==null&&((u=w==null?void 0:w.header)==null?void 0:u.uuid)&&((f=w==null?void 0:w.header)==null?void 0:f.version)&&await i.writeJSON("builds/mctemplate/world_behavior_packs.json",[{pack_id:w.header.uuid,version:w.header.version}])}if(c.RP){const w=await i.readJSON(`${c.RP}/manifest.json`).catch(()=>null);w!==null&&((h=w==null?void 0:w.header)==null?void 0:h.uuid)&&((m=w==null?void 0:w.header)==null?void 0:m.version)&&await i.writeJSON("builds/mctemplate/world_resource_packs.json",[{pack_id:w.header.uuid,version:w.header.version}])}c.BP&&await i.move(c.BP,`builds/mctemplate/behavior_packs/BP_${e.project.name}`),c.RP&&await i.move(c.RP,`builds/mctemplate/resource_packs/RP_${e.project.name}`),!await i.fileExists("builds/mctemplate/manifest.json")&&!s?await i.writeJSON("builds/mctemplate/manifest.json",{format_version:2,header:{name:"pack.name",description:"pack.description",version:[1,0,0],uuid:D(),lock_template_options:!0,base_game_version:((g=e.project.config.get().targetVersion)!=null?g:await Qe()).split(".").map(w=>Number(w))},modules:[{type:"world_template",version:[1,0,0],uuid:D()}]}):s&&r==="WT"&&await i.unlink("builds/mctemplate/manifest.json");const d=new gi(await e.project.fileSystem.getDirectoryHandle("builds/mctemplate",{create:!0})),p=`${e.project.projectPath}/builds/${e.project.name}.${s?"mcworld":"mctemplate"}`;try{await di(p,await d.package(),e.fileSystem)}catch(w){console.error(w)}await i.unlink("builds/mctemplate"),t.app.windows.loadingWindow.close()}async function Jn(){const s=await l.getApp();return s.project.hasPacks(["worldTemplate"])||await s.project.fileSystem.directoryExists("worlds")&&(await s.project.fileSystem.readdir("worlds")).length>0}const Vy=async s=>{if(!s.path)return null;const e=await l.getApp(),t=e.project.packIndexer,i=Gn(t.hasFired?await t.service.getConnectedFiles(s.path):[]),n=e.project.compilerReady.hasFired?await e.project.compilerService.getFileDependencies(s.path):[],a=[Ii(s.path,!1,!1)].concat(Gn(n));return i.length===0&&a.length===1?Ii(s.path):{type:"submenu",icon:"mdi-spider-web",name:"actions.viewConnectedFiles.name",description:"actions.viewConnectedFiles.description",actions:[...a,i.length>0?{type:"divider"}:null,...i]}};function Gn(s){return s.map(e=>{var n;const t=l.fileType.get(e),i=l.packType.get(e);return{icon:(n=t==null?void 0:t.icon)!=null?n:"mdi-file-outline",color:i==null?void 0:i.color,name:`[${me(e)}]`,description:t?`fileType.${t.id}`:void 0,onTrigger:async()=>{const a=await l.getApp();await a.project.openFile(await a.fileSystem.getFileHandle(e))}}})}const Hy=s=>({name:"packExplorer.move.toLocal",icon:"mdi-lock-open-outline",onTrigger:async()=>{s.switchProjectType()}}),Uy=s=>({name:"packExplorer.move.toBridgeFolder",icon:"mdi-folder-sync-outline",onTrigger:async()=>{let e=s.app.bridgeFolderSetup.hasFired;e||(e=await s.app.setupBridgeFolder()),e&&s.switchProjectType()}});class zy extends Ot{constructor(){super(),this.component=k(Ay),this.actions=[],this.directoryEntries={},this.topPanel=void 0,this.showNoProjectView=!1,this.headerHeight="60px",l.eventSystem.on("projectChanged",()=>this.setup()),l.eventSystem.on("fileAdded",()=>this.refresh());const e=async()=>{const t=await l.getApp();await t.projectManager.projectReady.fired,t.mobile.isCurrentDevice()||t.isNoProjectSelected?this.headerSlot=void 0:this.headerSlot=Ny};l.getApp().then(t=>{e(),t.mobile.change.on(()=>e())}),l.eventSystem.on("projectChanged",()=>{e()})}async setup(){var t;const e=await l.getApp();if(await e.projectManager.projectReady.fired,this.actions=[],e.isNoProjectSelected){this.showNoProjectView=!0;return}else this.showNoProjectView=!1;this.unselectAllActions(),this.actions=[];for(const i of(t=e.project.projectData.contains)!=null?t:[]){const n=await e.fileSystem.getDirectoryHandle(i.packPath).catch(()=>null);if(!n)continue;const a=k(new xe(null,n,{startPath:i.packPath,provideFileContextMenu:async r=>[await Vy(r)],provideFileDiagnostics:async r=>{const o=e.project.packIndexer;await o.fired;const c=r.path;return c?o.service.getFileDiagnostics(c):[]},onHandleMoved:r=>this.onHandleMoved(r)}));await a.open(),V(this.directoryEntries,i.packPath,a),this.actions.push(new dt(this,{id:i.packPath,name:`packType.${i.id}.name`,icon:i.icon,color:i.color}))}A.value&&this.actions.push(new lt({icon:"mdi-content-save-outline",name:"general.save",onTrigger:()=>Ye()})),this.actions.push(new lt({icon:"mdi-dots-vertical",name:"general.more",onTrigger:i=>{this.showMoreMenu(i)}}))}async onHandleMoved({fromPath:e,toPath:t}){await(await l.getApp()).project.onMovedFile(e,t)}onContentRightClick(e){var i;const t=(i=this.selectedAction)==null?void 0:i.getConfig().id;!t||cn(e,this.directoryEntries[t],{hideDelete:!0,hideRename:!0,hideDuplicate:!0})}async refresh(){await Promise.all(Object.values(this.directoryEntries).map(e=>e.refresh()))}async getContextMenu(e,t){if(e==="virtualFolder")return[];const n=(await l.getApp()).project;return[{icon:"mdi-file-search-outline",name:"actions.findInFolder.name",description:"actions.findInFolder.description",onTrigger:()=>{var a;(a=n.tabSystem)==null||a.add(new on(n.tabSystem,void 0,{searchType:At.matchCase}))}}]}async showMoreMenu(e){const t=await l.getApp(),i=t.project.isLocal?Uy(t.project):Hy(t.project);$e(e,[{icon:"mdi-plus",name:"packExplorer.createPreset",onTrigger:async()=>{await t.windows.createPreset.open()}},A.value?null:i,{type:"divider"},{icon:"mdi-refresh",name:"packExplorer.refresh.name",onTrigger:async()=>{t.actionManager.trigger("bridge.action.refreshProject")}},ga(!1),{type:"divider"},{type:"submenu",icon:"mdi-export",name:"packExplorer.exportAs.name",actions:[{icon:"mdi-folder-zip-outline",name:"packExplorer.exportAs.brproject",onTrigger:()=>Ye()},{icon:"mdi-minecraft",name:"packExplorer.exportAs.mcaddon",onTrigger:()=>By()},{icon:"mdi-earth-box",name:"packExplorer.exportAs.mcworld",isDisabled:!await Jn(),onTrigger:()=>qn(!0)},{icon:"mdi-earth-box-plus",name:"packExplorer.exportAs.mctemplate",isDisabled:!await Jn(),onTrigger:()=>qn()},...await t.project.exportProvider.getExporters()]},{type:"divider"},{icon:"mdi-cog-outline",name:"packExplorer.projectConfig.name",onTrigger:async()=>{var a;const n=t.project;if(!await n.fileSystem.fileExists("config.json")){new U({description:"packExplorer.projectConfig.missing"});return}await((a=n.tabSystem)==null?void 0:a.openPath(`${n.projectPath}/config.json`))}},{icon:"mdi-folder-open-outline",name:"packExplorer.openProjectFolder.name",onTrigger:async()=>{t.viewFolders.addDirectoryHandle({directoryHandle:t.project.baseDirectory,startPath:t.project.projectPath,onHandleMoved:n=>this.onHandleMoved(n)})}}])}}class qy{constructor(){this.folderHandler=new Set,this.addImporter({icon:"mdi-minecraft",name:"fileDropper.importMethod.folder.output.name",description:"fileDropper.importMethod.folder.output.description",onSelect:async e=>{await(await l.getApp()).comMojang.handleComMojangDrop(e)}}),this.addImporter({icon:"mdi-folder-open-outline",name:"fileDropper.importMethod.folder.open.name",description:"fileDropper.importMethod.folder.open.description",onSelect:async e=>{const t=await l.getApp();try{await e.requestPermission({mode:"readwrite"})}catch{return}t.viewFolders.addDirectoryHandle({directoryHandle:e})}})}addImporter(e){return this.folderHandler.add(e),{dispose:()=>{this.folderHandler.delete(e)}}}async onImportFolder(e){const t=new It("fileDropper.importMethod.name",{isPersistent:!1}),i=await t.actionManager;this.folderHandler.forEach(({onSelect:n,...a})=>i.create({...a,onTrigger:()=>n(e)})),t.open(),await t.fired}}const Jy={type:"raw",name:"openFileUrl",onTrigger:async s=>{const e=await fetch(s).catch(()=>null);if(!e)return;const t=new se(null,me(s),new Uint8Array(await e.arrayBuffer()),!0),i=await l.getApp();await i.projectManager.projectReady.fired,await i.fileDropper.importFile(t)}},Gy={type:"raw",name:"setSidebarState",onTrigger:async s=>{s==="hidden"&&(l.sidebar.toggleSidebarContent(null),l.sidebar.forcedInitialState.value=!0)}},Ky={type:"encoded",name:"viewExtension",onTrigger:async s=>{(await l.getApp()).windows.extensionStore.open(s)}};class Yy{constructor(e=[]){this.startActions=new Map,e.forEach(t=>this.addStartAction(t)),this.addStartAction(Xo),this.addStartAction(Jy),this.addStartAction(Gy),this.addStartAction(Ky),this.parseRaw(window.location.search)}async parse(e){const t=e.split("?")[1];!t||await this.parseRaw(t)}async parseRaw(e){const t=new URLSearchParams(e);[...t.keys()].length!==0&&t.forEach(async(i,n)=>{const a=this.startActions.get(n);if(!a)return;let r;if(a.type==="compressed"){const o=atob(i);if(!o.startsWith("x\xDA")){const{decompressFromEncodedURIComponent:c}=await ue(()=>import("./lz-string.c3c0ce2d.js").then(p=>p.l),[]),d=c(i);if(!d)return;r=d}r=Ri(hr(Qn(o,!0)))}else if(a.type==="encoded")r=decodeURIComponent(i);else if(a.type==="raw")r=i;else throw new Error(`Unknown start action type: "${a.type}"`);a.onTrigger(r)})}addStartAction(e){return this.startActions.set(e.name,e),{dispose:()=>this.startActions.delete(e.name)}}}async function _a(s,e=s.name){e===""&&(e="~local");const t=[];for await(const i of s.values())i.kind==="file"&&i.name!==".DS_Store"?t.push({handle:i,path:`${e}/${i.name}`}):i.kind==="directory"&&t.push(...await _a(i,`${e}/${i.name}`));return t}async function Sa(s,e){const t=await _a(s);let i=[];for(const n of t){const a=new M({icon:"mdi-file-outline",color:e,name:`[${n.path}]`,description:"actions.openFile.name",onTrigger:async()=>{(await l.getApp()).project.openFile(n.handle)}});i.push(No(a))}return{dispose:()=>{i.forEach(n=>n.dispose()),i=[]}}}const Qy={props:{sidebarContent:Object},components:{DirectoryViewer:wi}};var Zy=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-1"},e._l(e.sidebarContent.directoryHandles,function({directoryHandle:i,...n},a){return t("DirectoryViewer",{key:a,staticClass:"mb-2",attrs:{directoryHandle:i,renderTopLevelDirectory:!0,options:n}})}),1)},Xy=[],ev=_(Qy,Zy,Xy,!1,null,null,null,null);const tv=ev.exports;class iv extends Ot{constructor(){super(),this.component=tv,this.actions=[],this.topPanel=void 0,this.directoryHandles=[],this.closeAction=new lt({icon:"mdi-close",name:"general.close",color:"error",onTrigger:async()=>{this.directoryHandles.forEach(e=>{var t;return(t=e.onDispose)==null?void 0:t.call(e)}),this.directoryHandles=[],this.updateVisibility()}}),this.actions=[this.closeAction],this.sidebarElement=k(new tn({id:"viewOpenedFolders",group:"packExplorer",sidebarContent:this,displayName:"sidebar.openedFolders.name",icon:"mdi-folder-open-outline",isVisible:()=>this.directoryHandles.length>0}))}async updateVisibility(){if(this.directoryHandles.length>0)return;(await l.getApp()).viewComMojangProject.hasComMojangProjectLoaded?l.sidebar.elements.viewComMojangProject.select():l.sidebar.elements.packExplorer.select()}async addDirectoryHandle({directoryHandle:e,...t}){if(await this.hasDirectoryHandle(e))return;const i={directoryHandle:e,...t,provideDirectoryContextMenu:n=>[n.getParent()===null?{name:"sidebar.openedFolders.removeFolder",icon:"mdi-eye-off-outline",onTrigger:async()=>{await this.removeDirectoryHandle(n.handle),await this.updateVisibility()}}:null],isDisposed:!1,disposable:null,onDispose(){var n;(n=this.disposable)==null||n.dispose(),this.isDisposed=!0}};Sa(i.directoryHandle).then(n=>{i.isDisposed?n.dispose():i.disposable=n}),this.directoryHandles.push(i),this.sidebarElement.isSelected||this.sidebarElement.select()}async removeDirectoryHandle(e){var t;for(let i=0;i<this.directoryHandles.length;i++){const n=this.directoryHandles[i];if(await n.directoryHandle.isSameEntry(e)){this.directoryHandles.splice(i,1),(t=n.onDispose)==null||t.call(n);return}}throw new Error("directoryHandle to remove not found")}async hasDirectoryHandle(e){for(const{directoryHandle:t}of this.directoryHandles)if(await an(t,e))return!0;return!1}}class nv{constructor(){this.elements=G({}),this.isNavigationVisible=E(!0),this.currentState=E(null),this.isContentVisible=K(()=>this.currentState.value!==null),this.forcedInitialState=E(!1),this.groupOrder=["projectChooser","packExplorer"],this.sortedElements=E([])}updateSortedElements(){this.sortedElements.value=Object.values(this.elements).sort((e,t)=>!e.group&&!t.group?0:e.group?t.group?this.groupOrder.indexOf(e.group)-this.groupOrder.indexOf(t.group):-1:1)}addSidebarElement(e,t){return V(this.elements,e,t),this.updateSortedElements(),{dispose:()=>{Ee(this.elements,e),this.updateSortedElements()}}}toggleSidebarContent(e){if(e===null){this.hideSidebarContent();return}e===this.currentState.value?this.hideSidebarContent(!1):(this.currentState.value=e,this.isNavigationVisible.value||(this.isNavigationVisible.value=!0)),l.getApp().then(t=>t.windowResize.dispatch())}async hideSidebarContent(e=!0){(await l.getApp()).mobile.isCurrentDevice()?e&&(this.isNavigationVisible.value=!1):this.currentState.value=null}selectSidebarContent(e){this.currentState.value=e,l.getApp().then(t=>t.windowResize.dispatch())}hide(){this.isNavigationVisible.value=!1,l.getApp().then(e=>e.windowResize.dispatch())}}const sv={props:{sidebarContent:Object},components:{DirectoryViewer:wi}};var av=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my-1"},[e.sidebarContent.selectedAction?t("DirectoryViewer",{key:e.sidebarContent.selectedAction.config.id,staticClass:"mb-2",attrs:{directoryHandle:e.sidebarContent.directoryEntries[e.sidebarContent.selectedAction.config.id],options:{defaultIconColor:e.sidebarContent.selectedAction.config.color}}}):e._e()],1)},rv=[],ov=_(sv,av,rv,!1,null,null,null,null);const cv=ov.exports,lv={components:{ProjectDisplay:ba},data:()=>({imgSrc:void 0,name:void 0}),async mounted(){const s=await l.getApp(),{projectIcon:e,projectName:t}=s.viewComMojangProject;this.name=t,this.imgSrc=e}};var dv=function(){var e=this,t=e._self._c;return t("ProjectDisplay",{attrs:{imgSrc:e.imgSrc,name:e.name}})},pv=[],uv=_(lv,dv,pv,!1,null,null,null,null);const hv=uv.exports;class fv extends Ot{constructor(){super(),this.component=cv,this.actions=[],this.topPanel=void 0,this.headerHeight="60px",this.hasComMojangProjectLoaded=!1,this.projectIcon=void 0,this.projectName=void 0,this.disposables=[],this.directoryEntries={},this.closeAction=new lt({icon:"mdi-close",name:"general.close",color:"error",onTrigger:()=>{this.clearComMojangProject()}}),this.actions=[this.closeAction],this.sidebarElement=k(new tn({id:"viewComMojangProject",group:"packExplorer",sidebarContent:this,displayName:"packExplorer.name",icon:"mdi-folder-outline",isVisible:()=>this.hasComMojangProjectLoaded}))}async loadComMojangProject(e){var i,n;const t=await l.getApp();this.hasComMojangProjectLoaded=!0,this.actions=[this.closeAction];for(const a of e.packs.reverse()){const r=l.packType.getFromId(a.type);if(!r)continue;const o=new dt(this,{icon:r.icon,name:`packType.${a.type}.name`,color:r.color,id:a.type});this.actions.unshift(o);const c=new xe(null,a.directoryHandle,{startPath:a.packPath,defaultIconColor:r.color});await c.open(),Sa(c.handle,r.color).then(d=>{this.hasComMojangProjectLoaded?this.disposables.push(d):d.dispose()}),this.directoryEntries[a.type]=k(c),a.type==="behaviorPack"&&o.select()}this.projectName=e.name,this.projectIcon=(n=(i=e.packs.find(a=>a.type==="behaviorPack"))==null?void 0:i.packIcon)!=null?n:void 0,t.projectManager.title.setProject(this.projectName),this.headerSlot=hv,this.sidebarElement.select()}async clearComMojangProject(){const e=await l.getApp();this.headerSlot=void 0,this.hasComMojangProjectLoaded=!1,this.actions=[this.closeAction],this.directoryEntries={},e.projectManager.title.setProject(""),l.sidebar.elements.packExplorer.select(),this.disposables.forEach(t=>t.dispose()),this.disposables=[]}onContentRightClick(e){var i;const t=(i=this.selectedAction)==null?void 0:i.getConfig().id;!t||cn(e,this.directoryEntries[t],{hideDelete:!0,hideRename:!0,hideDuplicate:!0})}}const tt=class{constructor(s){this.viewFolders=new iv,this.viewComMojangProject=new fv,this.packExplorer=new zy,this.keyBindingManager=new Ps,this.actionManager=new Mt(this.keyBindingManager),this.taskManager=new Dm,this.dataLoader=k(new jw(!0)),this.fileSystem=new Z,this.projectManager=new Ew(this),this.extensionLoader=new Iw(this),this.windowResize=new Tw,this.contextMenu=k(new Mw),this.fileDropper=new Ow(this),this.fileImportManager=new Qw(this.fileDropper),this.folderImportManager=new qy,this.comMojang=new Wo(this),this.configuredJsonLanguage=k(new ey),this.languageManager=k(new Df),this.startParams=new Yy,this.bridgeFolderSetup=new $,this.dataLoader.loadData(),this.themeManager=new Wf(s.$vuetify),this._windows=new xw(this),this.mobile=new iy(s.$vuetify);const e="Are you sure that you want to close bridge.? Unsaved progress will be lost.";window.addEventListener("beforeunload",t=>{var i;if(((i=this.tabSystem)==null?void 0:i.hasUnsavedTabs)||this.taskManager.hasRunningTasks||A.value)return t.preventDefault(),t.returnValue=e,e})}get windows(){return this._windows}get tabSystem(){var s;return(s=this.projectManager.currentProject)==null?void 0:s.tabSystem}get selectedProject(){return this.projectManager.selectedProject}get isNoProjectSelected(){return this.projectManager.currentProject===null||this.projectManager.currentProject.isVirtualProject}get hasNoProjects(){return this.isNoProjectSelected&&this.projectManager.totalProjects<=1}get project(){if(!this.projectManager.currentProject)throw new Error("Trying to access project before it is defined. Make sure to await app.projectManager.projectReady.fired");return this.projectManager.currentProject}get projects(){return Object.values(this.projectManager.state).filter(s=>!s.isVirtualProject)}get projectConfig(){try{return this.project.config}catch{throw new Error("Trying to access projectConfig before project is defined. Make sure to await app.projectManager.projectReady.fired")}}static get instance(){return this._instance}static getApp(){return new Promise(s=>tt.ready.once(e=>s(e)))}static openUrl(s,e,t=!1){var i;return((i=S==null?void 0:S.general)==null?void 0:i.openLinksInBrowser)||t?window.open(s,"_blank"):window.open(s,e,"toolbar=no,menubar=no,status=no")}static async main(s){console.time("[APP] Ready"),this._instance=k(new tt(s)),this.instance.windows.loadingWindow.open(),await this.instance.beforeStartUp(),this.instance.fileSystem.setup(await Fi()),await this.instance.fileSystem.unlink(`projects/${Ke}`),await fe("firstStartAfterUpdate")&&(await pe("firstStartAfterUpdate",!1),this.instance.windows.changelogWindow.open());const e=Me.loadSettings(this.instance);await e,e.then(async()=>{await this.instance.dataLoader.fired,this.instance.themeManager.loadDefaultThemes(this.instance)}),await this.instance.startUp(),this.ready.dispatch(this.instance),await this.instance.projectManager.selectLastProject(),this.instance.windows.loadingWindow.close(),console.timeEnd("[APP] Ready")}async beforeStartUp(){console.log(`--- Running bridge. ${we} on a "${J()}" machine ---`),console.time("[APP] beforeStartUp()"),navigator.clearAppBadge&&navigator.clearAppBadge(),Am(),Lm(this);{const s=new zt({id:"bridge-social-links",icon:"mdi-link-variant",message:"sidebar.notifications.socials.message",color:"#1DA1F2",textColor:"white",onClick:()=>{this.windows.socialsWindow.open(),s.dispose()}}),e=new zt({id:"bridge-getting-started",icon:"mdi-help-circle-outline",message:"sidebar.notifications.gettingStarted.message",onClick:()=>{tt.openUrl("https://bridge-core.github.io/editor-docs/getting-started/"),e.dispose()}})}if(A.value){const s=new zt({id:"bridge-save-warning",icon:"mdi-alert-circle-outline",message:"general.fileSystemPolyfill.name",color:"warning",textColor:"white",onClick:()=>{new U({title:"general.fileSystemPolyfill.name",description:"general.fileSystemPolyfill.description"}),s.dispose()}})}console.timeEnd("[APP] beforeStartUp()")}async startUp(){console.time("[APP] startUp()"),await Promise.all([this.fileSystem.mkdir("projects"),this.fileSystem.mkdir("extensions"),this.fileSystem.mkdir("data"),tt.fileType.setup(this.dataLoader),tt.packType.setup(this.dataLoader)]),this.projectManager.projectReady.fired.then(async()=>{this.extensionLoader.loadExtensions()}),console.timeEnd("[APP] startUp()")}async setupBridgeFolder(s=!1){let e=await fe("bridgeBaseDir");if(e&&!s){if(await e.requestPermission({mode:"readwrite"})!=="granted")return!1}else{try{e=await window.showDirectoryPicker({mode:"readwrite"})}catch{return!1}await pe("bridgeBaseDir",e)}return this.fileSystem.setup(e),await this.fileSystem.fileExists("data/settings.json")&&(await this.fileSystem.copyFile("data/settings.json","~local/data/settings.json"),await this.fileSystem.unlink("data/settings.json"),await Me.loadSettings(this).then(async()=>{this.themeManager.loadDefaultThemes(this)})),this.bridgeFolderSetup.dispatch(),await this.projectManager.loadProjects(!0),!0}};let l=tt;l.windowState=new ty;l.installApp=new Aw;l.fileSystemSetup=new sa;l.toolbar=new Fw;l.eventSystem=new Ys(["projectChanged","currentTabSwitched","refreshCurrentContext","disableValidation","fileAdded","fileChange","fileSave","fileUnlinked","presetsChanged","availableProjectsFileChanged"]);l.ready=new $;l.fileType=k(new Qs);l.packType=k(new Nm);l.sidebar=new nv;const mv={name:"SidebarButton",props:{displayName:String,icon:String,iconColor:String,color:String,disabled:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},alwaysAllowClick:{type:Boolean,default:!1},opacity:{type:Number,default:1},badge:Object},setup(){const{t:s}=I();return{t:s}},data:()=>({settingsState:S,hasClicked:!1}),computed:{isSidebarRight(){return this.settingsState&&this.settingsState.sidebar&&this.settingsState.sidebar.isSidebarRight},smallerSidebarElements(){return this.settingsState&&this.settingsState.sidebar&&this.settingsState.sidebar.smallerSidebarElements},computedColor(){return this.color?this.color.startsWith("#")?this.color:`var(--v-${this.color}-base)`:this.isLoading||this.isSelected?"var(--v-primary-base)":"var(--v-sidebarSelection-base)"},canInteractWith(){return!this.disabled&&(this.alwaysAllowClick||!this.isLoading)}},methods:{onClick(){this.disabled||(this.alwaysAllowClick||!this.isLoading)&&(this.$emit("click"),this.hasClicked=!0,this.$nextTick(()=>this.hasClicked=!1))},onMiddleClick(){(this.alwaysAllowClick||!this.isLoading)&&(this.$emit("middleClick"),this.hasClicked=!0,this.$nextTick(()=>this.hasClicked=!1))}}};var gv=function(){var e=this,t=e._self._c;return t("v-tooltip",{attrs:{color:e.color?e.color:"tooltip",disabled:e.hasClicked||e.isSelected,right:!e.isSidebarRight,left:e.isSidebarRight},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("div",e._g({directives:[{name:"ripple",rawName:"v-ripple",value:e.canInteractWith,expression:"canInteractWith"}],staticClass:"rounded-lg ma-2 d-flex justify-center sidebar-button",class:{loading:e.isLoading,"pa-1":e.smallerSidebarElements,"pa-2":!e.smallerSidebarElements,"elevation-4":e.isSelected},style:{"background-color":e.computedColor,position:"relative",transform:e.isSelected?"scale(1.1)":void 0,cursor:e.canInteractWith?"pointer":void 0,height:e.smallerSidebarElements?"34px":"40px"},on:{click:e.onClick,mouseup:function(n){return"button"in n&&n.button!==1?null:e.onMiddleClick.apply(null,arguments)}}},i),[t("v-badge",{style:{position:e.isLoading?"absolute":"relative",marginTop:e.isLoading?"3px":0,marginLeft:e.isLoading?"1px":0},attrs:{value:e.badge&&!e.isLoading?e.badge.count:0,content:e.badge&&!e.badge.icon?e.badge.count:0,color:e.badge?e.badge.color:null,icon:e.badge?e.badge.icon:null,dot:e.badge&&e.badge.dot,overlap:"",bordered:""}},[t("v-icon",{style:{opacity:e.disabled?.4:void 0},attrs:{color:e.isLoading||e.isSelected?"white":e.iconColor,small:e.isLoading}},[e._v(" "+e._s(e.icon)+" ")])],1),e.isLoading?e._t("default",function(){return[t("v-progress-circular",{attrs:{size:"24",width:"2",color:"white",indeterminate:""}})]}):e._e()],2)]}}],null,!0)},[t("span",[e._v(e._s(e.t(e.displayName)))])])},wv=[],yv=_(mv,gv,wv,!1,null,"18eccd51",null,null);const vv=yv.exports,Ca={data:()=>({windowControlsOverlay:navigator.windowControlsOverlay&&navigator.windowControlsOverlay.visible}),created(){navigator.windowControlsOverlay&&navigator.windowControlsOverlay.addEventListener("geometrychange",s=>{this.windowControlsOverlay=s.visible})}},Lt={mixins:[Ca],computed:{appToolbarHeight(){return`env(titlebar-area-height, ${this.$vuetify.breakpoint.mobile?32:24}px)`},appToolbarHeightNumber(){return this.windowControlsOverlay?33:this.$vuetify.breakpoint.mobile?32:24}}},bv={name:"Sidebar",mixins:[Lt],props:{app:Boolean},components:{SidebarButton:vv},setup(){return{rawSidebarElements:l.sidebar.sortedElements,rawIsNavigationVisible:l.sidebar.isNavigationVisible}},data(){return{settingsState:S,tasks:St,NotificationStore:ze}},computed:{isMobile(){return this.$vuetify.breakpoint.mobile},isNavigationVisible:{get(){return!this.isMobile||l.sidebar.isNavigationVisible.value},set(s){l.sidebar.isNavigationVisible.value=s}},sidebarElements(){return this.rawSidebarElements.filter(s=>s.isVisible)},hasVisibleNotifications(){return Object.values(this.NotificationStore).some(({isVisible:s})=>s)},isSidebarRight(){return this.settingsState&&this.settingsState.sidebar&&this.settingsState.sidebar.isSidebarRight}},methods:{closeSidebar(){l.sidebar.isNavigationVisible.value=!1}}};var _v=function(){var e=this,t=e._self._c;return t("v-navigation-drawer",{staticClass:"my-2",class:{"rounded-r-lg":!e.isSidebarRight,"rounded-l-lg":e.isSidebarRight},style:{maxHeight:`calc(100% - ${e.appToolbarHeight} - 16px)`,top:e.appToolbarHeight},attrs:{"mini-variant":"","mini-variant-width":"60",stateless:"",app:e.app,absolute:"",floating:"",right:e.isSidebarRight,color:"sidebarNavigation",height:`calc(100% - ${e.appToolbarHeight})`},model:{value:e.isNavigationVisible,callback:function(i){e.isNavigationVisible=i},expression:"isNavigationVisible"}},[e.isMobile?t("SidebarButton",{attrs:{displayName:"general.close",icon:"mdi-close",color:"error"},on:{click:e.closeSidebar}}):e._e(),t("v-list",e._l(e.sidebarElements,function(i,n){return t("SidebarButton",{key:`${i.uuid}//${n}`,attrs:{displayName:i.displayName,icon:i.icon,isLoading:i.isLoading,isSelected:i.isSelected,badge:i.badge,disabled:i.isDisabled},on:{click:function(a){return i.click()}}})}),1),e.hasVisibleNotifications?t("v-list",[t("v-divider",{staticClass:"mx-3 mb-6"}),e._l(e.NotificationStore,function(i){return[i.isVisible?t("SidebarButton",{key:i.id,attrs:{displayName:i.message,icon:i.icon,color:i.color,iconColor:i.textColor},on:{click:function(n){return i.onClick()},middleClick:function(n){return i.onMiddleClick()}}}):e._e()]})],2):e._e(),e.tasks.length>0?t("v-list",[t("v-divider",{staticClass:"mx-3 mb-6"}),e._l(e.tasks,function(i,n){return t("SidebarButton",{key:`${n}`,attrs:{displayName:i.name,icon:i.icon,color:"primary",isLoading:"",alwaysAllowClick:""},on:{click:function(a){return i.createWindow()}}},[t("v-progress-circular",{attrs:{rotate:"-90",size:"24",width:"2",color:"white",value:i.progress}})],1)})],2):e._e()],1)},Sv=[],Cv=_(bv,_v,Sv,!1,null,null,null,null);const kv=Cv.exports;const xv={name:"WindowAction",components:{},props:{action:Function,icon:String,color:String}};var Pv=function(){var e=this,t=e._self._c;return t("v-btn",{staticClass:"toolbar-btn",attrs:{small:"",icon:"",color:e.color},on:{click:function(i){return i.stopPropagation(),e.action.apply(null,arguments)}}},[t("v-icon",{attrs:{small:""}},[e._v(e._s(e.icon))])],1)},jv=[],Fv=_(xv,Pv,jv,!1,null,"c20b0033",null,null);const Tv=Fv.exports,Av={__name:"MenuList",props:{elements:Object},setup(s){const{t:e}=I();function t(i){i.trigger()}return{__sfc:!0,t:e,onClick:t,useTranslations:I}}};var $v=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-list",{staticClass:"app-menu",staticStyle:{"border-radius":"0"},attrs:{color:"menu"}},[e._l(e.elements,function(n,a,r){return[n.type==="divider"?t("v-divider",{key:`menu.${r}.${Math.random()}`}):t("v-menu",{key:`menu.${r}.${Math.random()}`,attrs:{"open-on-hover":"","offset-x":"","z-index":"11","nudge-top":-8,rounded:"lg"},scopedSlots:e._u([{key:"activator",fn:function({on:o}){return[t("v-list-item",e._g({attrs:{dense:"",disabled:n.isDisabled},on:{click:function(c){return i.onClick(n)}}},n.type==="category"?o:void 0),[n.icon?t("v-list-item-icon",[t("v-icon",{attrs:{color:"accent",small:""}},[e._v(e._s(n.icon))])],1):e._e(),t("v-list-item-content",[t("v-list-item-title",[e._v(" "+e._s(i.t(n.name))+" ")])],1),t("v-list-item-action",[t("v-list-item-action-text",[n.type!=="category"&&n.keyBinding?t("span",[e._v(" "+e._s(n.keyBinding.toStrKeyCode())+" ")]):e._e(),n.type==="category"?t("v-icon",{attrs:{small:""}},[e._v(" mdi-chevron-right ")]):e._e()],1)],1)],1)]}}],null,!0)},[t("MenuList",{attrs:{elements:n.state}})],1)]})],2)},Dv=[],Ev=_(Av,$v,Dv,!1,null,null,null,null);const Mv=Ev.exports;const Iv={__name:"Button",props:{displayName:String,displayIcon:String,disabled:{type:Boolean}},setup(s){const{t:e}=I();return{__sfc:!0,t:e,useTranslations:I}}};var Ov=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-btn",{staticClass:"toolbar-btn",class:{"btn-enabled":!e.disabled,"btn-disabled":e.disabled,"px-1":e.$vuetify.breakpoint.mobile},attrs:{small:"",text:"",disabled:e.disabled},on:{click:function(n){return e.$emit("click",n)}}},[e.displayIcon?t("v-icon",{staticClass:"pr-1",attrs:{color:"accent"}},[e._v(" "+e._s(e.displayIcon)+" ")]):e._e(),t("span",[e._v(" "+e._s(i.t(e.displayName))+" ")])],1)},Rv=[],Wv=_(Iv,Ov,Rv,!1,null,"8f4edb45",null,null);const ka=Wv.exports,Lv={name:"MenuActivator",components:{MenuList:Mv,MenuButton:ka},props:{item:Object,disabled:Boolean}};var Nv=function(){var e=this,t=e._self._c;return t("v-menu",{attrs:{"min-width":"260px","offset-y":"","z-index":"11","nudge-top":-8,rounded:"lg"},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("MenuButton",e._g({attrs:{disabled:e.disabled||e.item.isDisabled,displayIcon:e.item.icon,displayName:e.item.name}},i))]}}]),model:{value:e.item.isVisible,callback:function(i){e.$set(e.item,"isVisible",i)},expression:"item.isVisible"}},[e.item.isVisible?t("MenuList",{attrs:{elements:e.item.state}}):e._e()],1)},Bv=[],Vv=_(Lv,Nv,Bv,!1,null,null,null,null);const Hv=Vv.exports;const Uv={name:"Toolbar",mixins:[Ca,Lt],components:{WindowAction:Tv,MenuActivator:Hv,MenuButton:ka,Logo:os},setup(){const s=G({title:"",appName:"",isAnyWindowVisible:l.windowState.isAnyWindowVisible});return l.getApp().then(e=>{s.title=e.projectManager.title.current,s.appName=e.projectManager.title.appName}),s},data:()=>({toolbar:l.toolbar.state,settingsState:S,isMacOS:J()==="darwin",appVersion:we}),computed:{isMobile(){return this.$vuetify.breakpoint.mobile},hideToolbarItemsSetting(){var s;return this.settingsState.appearance&&(s=this.settingsState.appearance.hideToolbarItems)!=null?s:!1},hideToolbarItems(){return this.hideToolbarItemsSetting&&this.windowControlsOverlay},composedTitle(){return this.title?`${this.appName} - ${this.title}`:this.appName}},methods:{async openChangelogWindow(){if(this.isAnyWindowVisible)return;await(await l.getApp()).windows.changelogWindow.open()},async openCommandBar(){this.isAnyWindowVisible||(Hi.isWindowOpen=!0)},showMobileMenu(s){l.toolbar.showMobileMenu(s)}}};var zv=function(){var e=this,t=e._self._c;return t("v-system-bar",{class:{"d-flex align-center justify-center":e.hideToolbarItems},style:{"padding-left":0,"margin-left":e.hideToolbarItems?0:"env(titlebar-area-x, 0)",width:e.hideToolbarItems?"100%":"env(titlebar-area-width, 100%)","z-index":e.windowControlsOverlay?1e3:void 0},attrs:{color:"toolbar",fixed:"",app:"",clipped:"",padless:"",height:e.appToolbarHeight}},[e.hideToolbarItems?[t("Logo",{staticStyle:{"padding-right":"8px"},attrs:{height:"22px",width:"22px",alt:"Logo of bridge. v2",draggable:"false"}}),t("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"toolbar-clickable outlined rounded-lg d-flex align-center justify-center",staticStyle:{height:"20px"},on:{click:e.openCommandBar}},[t("v-icon",{staticClass:"ml-1"},[e._v("mdi-magnify")]),t("span",{staticClass:"mr-1"},[e._v(" "+e._s(e.composedTitle)+" ")])],1)]:[!e.isMacOS||!e.windowControlsOverlay?t("Logo",{staticStyle:{"padding-right":"4px","padding-left":"calc(env(safe-area-inset-left) + 4px)"},attrs:{height:"24px",width:"24px",alt:"Logo of bridge. v2",draggable:"false"}}):e._e(),t("v-divider",{attrs:{vertical:""}}),t("v-toolbar-items",{staticClass:"px14-font"},[e.isMobile?t("MenuButton",{attrs:{displayName:"actions.name",displayIcon:"mdi-menu"},on:{click:e.showMobileMenu}}):e._e(),e._l(e.toolbar,function(i,n,a){return[i.type!=="category"?t("MenuButton",{key:`button.${n}`,attrs:{displayName:i.name,displayIcon:i.icon,disabled:e.isAnyWindowVisible||i.isDisabled},on:{click:()=>i.trigger()}}):i.shouldRender?t("MenuActivator",{key:`activator.${n}`,attrs:{item:i,disabled:e.isAnyWindowVisible||i.isDisabled}}):e._e(),i.shouldRender&&(e.windowControlsOverlay||a+1<Object.keys(e.toolbar).length)?t("v-divider",{key:`divider.${n}`,attrs:{vertical:""}}):e._e()]})],2),e.windowControlsOverlay?t("span",{staticClass:"pl-3"},[e._v(" "+e._s(e.composedTitle)+" ")]):e._e(),t("v-spacer"),t("div",{directives:[{name:"ripple",rawName:"v-ripple",value:!e.isAnyWindowVisible,expression:"!isAnyWindowVisible"}],staticClass:"px-1 mx-1 rounded-lg app-version-display",style:{opacity:e.isAnyWindowVisible?.4:null,"margin-right":"env(safe-area-inset-right, 0)"},on:{click:e.openChangelogWindow}},[e._v(" v"+e._s(e.appVersion)+" ")])]],2)},qv=[],Jv=_(Uv,zv,qv,!1,null,"b79c042b",null,null);const Gv=Jv.exports,Kv={components:{CommandBar:ls},data:()=>Hi,watch:{isWindowOpen(){this.isWindowOpen?(this.shouldRender=!0,this.closeDelay&&clearTimeout(this.closeDelay)):this.closeDelay=setTimeout(()=>{this.shouldRender=!1,this.closeDelay=null},300)}}};var Yv=function(){var e=this,t=e._self._c;return e.shouldRender?t("v-dialog",{attrs:{"content-class":"elevation-0 d-flex pt-2 flex-column justify-center align-center",transition:"slide-y-reverse-transition",width:"60vw","max-width":"600px","hide-overlay":""},on:{keydown:function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"esc",27,i.key,["Esc","Escape"]))return null;e.isWindowOpen=!1}},model:{value:e.isWindowOpen,callback:function(i){e.isWindowOpen=i},expression:"isWindowOpen"}},[t("CommandBar",{attrs:{autofocus:""},on:{actionSelected:function(i){e.isWindowOpen=!1},blur:function(i){e.isWindowOpen=!1}}}),t("div",{style:{height:"80vh"},on:{click:function(i){e.isWindowOpen=!1}}})],1):e._e()},Qv=[],Zv=_(Kv,Yv,Qv,!1,null,null,null,null);const Xv=Zv.exports,eb={name:"CollectedWindows",components:{CommandBarWindow:Xv},data:()=>({windows:l.windowState.state})};var tb=function(){var e=this,t=e._self._c;return t("div",[t("CommandBarWindow"),e._l(e.windows,function(i,n){return t(i.component,{key:n,tag:"component",attrs:{currentWindow:i,window:i}})})],2)},ib=[],nb=_(eb,tb,ib,!1,null,null,null,null);const sb=nb.exports,ab={__name:"List",props:{actions:{type:Object,required:!0}},emits:["click"],setup(s,{emit:e}){const t=s,{t:i}=I(),n=E(null);function a(c){e("click"),c.trigger()}function r(c){n.value===c?n.value=null:n.value=c}const o=K(()=>{const c=[];for(const[d,p]of Object.entries(t.actions)){if(p.type!=="submenu"||Q.value!=="touch"){c.push([d,p]);continue}c.push([d,{type:"section",icon:p.icon,name:p.name}]),this.openSection===d&&c.push(...Object.entries(p.submenu.state).map(([u,f])=>[u,f.type==="action"?f.withPadding():f]))}return Object.fromEntries(c)});return{__sfc:!0,t:i,props:t,emit:e,openSection:n,onClick:a,toggleSection:r,renderActions:o,computed:K,ref:E,useTranslations:I,pointerDevice:Q}}};var rb=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-list",{attrs:{color:"menu",dense:""}},[e._l(i.renderActions,function(n,a){return[n.type==="divider"?t("v-divider",{key:a}):n.type==="submenu"?t("v-menu",{key:a,attrs:{"open-on-hover":"","offset-x":"","nudge-right":"8px",rounded:"lg","close-delay":"200",transition:"context-menu-transition","close-on-click":""},scopedSlots:e._u([{key:"activator",fn:function({on:r,attrs:o}){return[Object.keys(n.submenu.state).length>0?t("v-list-item",e._g(e._b({attrs:{disabled:n.isDisabled}},"v-list-item",o,!1),r),[t("v-list-item-icon",{staticClass:"mr-2",style:{opacity:n.isDisabled?"38%":null}},[t("v-icon",{attrs:{color:n.color||"accent"}},[e._v(" "+e._s(n.icon)+" ")])],1),t("v-list-item-action",{staticClass:"ma-0",style:{alignItems:"flex-start"}},[t("v-list-item-title",{style:{alignSelf:"flex-start"},domProps:{textContent:e._s(i.t(n.name))}}),n.description?t("v-list-item-subtitle",{domProps:{textContent:e._s(i.t(n.description))}}):e._e()],1),t("v-spacer"),t("v-icon",{attrs:{small:""}},[e._v("mdi-chevron-right")])],1):e._e()]}}],null,!0)},[t("List",{attrs:{actions:n.submenu.state},on:{click:function(r){return e.$emit("click")}}})],1):n.type==="section"?t("v-list-item",{key:a,on:{click:function(r){return i.toggleSection(a)}}},[t("v-list-item-icon",{staticClass:"mr-2",style:{opacity:n.isDisabled?"38%":null}},[t("v-icon",{attrs:{color:n.color||"accent"}},[e._v(" "+e._s(n.icon)+" ")])],1),t("v-list-item-title",{domProps:{textContent:e._s(i.t(n.name))}}),t("v-spacer"),t("v-icon",{attrs:{small:""}},[e._v(" "+e._s(a===i.openSection?"mdi-chevron-down":"mdi-chevron-right")+" ")])],1):t("v-list-item",{key:a,class:{"pl-6":n.addPadding},attrs:{disabled:n.isDisabled},on:{click:function(r){return i.onClick(n)}}},[t("v-list-item-icon",{staticClass:"mr-2",style:{opacity:n.isDisabled?"38%":null}},[t("v-icon",{attrs:{color:n.color||"accent"}},[e._v(" "+e._s(n.icon)+" ")])],1),t("v-list-item-action",{staticClass:"ma-0",style:{alignItems:"flex-start"}},[t("v-list-item-title",{style:{alignSelf:"flex-start"},domProps:{textContent:e._s(i.t(n.name))}}),n.description?t("v-list-item-subtitle",{domProps:{textContent:e._s(i.t(n.description))}}):e._e()],1)],1)]})],2)},ob=[],cb=_(ab,rb,ob,!1,null,null,null,null);const lb=cb.exports;const db=fr("context-menu-transition");We.component("context-menu-transition",db);const pb={components:{ContextMenuList:lb},name:"ContextMenu",props:{contextMenu:Object,windowHeight:Number},data:()=>({shouldRender:!1,timeoutId:null}),computed:{x(){return this.contextMenu.position.x},y(){const s=this.contextMenu.position.y+this.contextMenu.menuHeight;if(s>this.windowHeight){const e=this.windowHeight-s;return this.contextMenu.position.y-e}return this.contextMenu.position.y},isVisible:{set(s){this.contextMenu.isVisible.value=s},get(){return this.contextMenu.isVisible.value}},actions(){return!this.contextMenu||!this.contextMenu.actionManager.value?{}:this.contextMenu.actionManager.value.state}},watch:{isVisible(){this.isVisible?(this.shouldRender=!0,this.timeoutId&&clearTimeout(this.timeoutId)):this.timeoutId=setTimeout(()=>{this.shouldRender=!1,this.timeoutId=null},500)}}};var ub=function(){var e=this,t=e._self._c;return t("v-menu",{ref:"menu",attrs:{"position-x":e.x,"position-y":e.y,rounded:"lg",absolute:"","offset-y":"",transition:"context-menu-transition","offset-overflow":!1,"close-on-click":e.contextMenu.mayCloseOnClickOutside,"close-on-content-click":!1,"min-width":"200px"},model:{value:e.isVisible,callback:function(i){e.isVisible=i},expression:"isVisible"}},[t("ContextMenuList",{attrs:{actions:e.actions},on:{click:function(i){e.isVisible=!1}}})],1)},hb=[],fb=_(pb,ub,hb,!1,null,null,null,null);const mb=fb.exports;const gb={name:"TabSystemTab",props:{tab:ht,isActive:Boolean,isFirstTab:Boolean},data:()=>({hoveringBtn:!1}),setup(){return{pointerDevice:Q}},mounted(){this.isSelected&&this.$refs.tabElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},computed:{isMobile(){return this.$vuetify.breakpoint.mobile},compactDesign(){return!S.editor||S.editor.compactTabDesign===void 0?!0:S.editor.compactTabDesign},floatingTabDesign(){return!this.tab.isSelected&&!this.isMobile},isSelected(){return this.tab.isSelected},tabName(){if(!this.compactDesign||this.isSelected)return this.tab.name;let s=this.tab.name.split(".");return s.pop(),s=s.join("."),s.length>5?s.slice(0,5)+"...":this.tab.name}},watch:{isSelected(){this.isSelected&&this.$refs.tabElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}};var wb=function(){var e=this,t=e._self._c;return t("div",{ref:"tabElement",staticClass:"cursor-pointer",class:{selected:e.tab.isSelected,"default-tab-style":!0,"d-flex":!0,"align-center":!0,inactive:!e.isActive,"px-3 py-2":!e.floatingTabDesign,"px-2 pb-1 mx-1 mt-2 my-1 rounded-lg":e.floatingTabDesign,"ml-0 pl-3":e.isFirstTab},staticStyle:{position:"relative"},on:{mousedown:[function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&i.button!==0)return null;e.hoveringBtn||e.tab.select()},function(i){if("button"in i&&i.button!==1)return null;i.preventDefault()}],mouseup:function(i){return"button"in i&&i.button!==1?null:e.tab.close()},contextmenu:function(i){return i.preventDefault(),e.tab.onContextMenu(i)},dblclick:function(i){e.tab.isTemporary=!1}}},[e.tab.isSelected&&e.pointerDevice==="touch"?t("v-btn",{attrs:{text:"",icon:"",small:""},on:{click:function(i){return e.tab.onContextMenu(i)},mouseenter:function(i){e.hoveringBtn=!0},mouseleave:function(i){e.hoveringBtn=!1}}},[t("v-icon",[e._v("mdi-dots-vertical")])],1):e._e(),t("v-badge",{class:{"mr-3":e.tab.isReadOnly,"mr-1":e.tab.isUnsaved},attrs:{value:e.tab.isReadOnly||e.tab.isUnsaved,color:e.tab.iconColor,icon:e.tab.isReadOnly?"mdi-lock-outline":null,bordered:"",overlap:"",depressed:"",dot:e.tab.isUnsaved&&!e.tab.isReadOnly}},[e.tab.isLoading?t("v-progress-circular",{staticClass:"mr-1",attrs:{indeterminate:"",color:e.tab.iconColor,size:"16",width:"2"}}):t("v-icon",{staticClass:"mr-1",attrs:{color:e.tab.iconColor,small:""}},[e._v(" "+e._s(e.tab.icon)+" ")])],1),t("v-tooltip",{attrs:{color:"tooltip","open-delay":"1500",disabled:e.pointerDevice==="touch"||!e.tab.path,bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("span",e._g({},i),[t("span",{style:{"font-style":e.tab.isTemporary?"italic":null,position:e.tab.folderName?"relative":null,top:e.tab.folderName?"-4px":null}},[e._v(" "+e._s(e.tabName)+" ")]),e.tab.folderName?t("span",{staticStyle:{position:"absolute",left:"32px","font-size":"12px",overflow:"hidden","text-overflow":"ellipsis"},style:{top:e.floatingTabDesign?"14px":"22px",left:e.tab.isSelected&&e.pointerDevice==="touch"?"60px":!e.floatingTabDesign||e.isFirstTab?"32px":"28px",width:e.tab.isSelected&&e.pointerDevice==="touch"?"calc(100% - 76px)":"calc(100% - 48px)"}},[e._v(" "+e._s(e.tab.folderName)+"/ ")]):e._e()])]}}])},[t("span",[e._v(e._s(e.tab.path))])]),t("v-btn",{attrs:{text:"",icon:"",small:""},on:{click:function(i){return i.stopPropagation(),e.tab.close()},mouseenter:function(i){e.hoveringBtn=!0},mouseleave:function(i){e.hoveringBtn=!1}}},[t("v-icon",{attrs:{small:""}},[e._v("mdi-close")])],1)],1)},yb=[],vb=_(gb,wb,yb,!1,null,"6d460e4c",null,null);const bb=vb.exports;const _b={__name:"Action",props:{action:{type:M,required:!0}},emits:["click"],setup(s,{emit:e}){const t=s,{t:i}=I();function n(){e("click"),t.action.trigger()}return{__sfc:!0,t:i,props:t,emit:e,onClick:n,useTranslations:I,SimpleAction:M}}};var Sb=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("div",{directives:[{name:"ripple",rawName:"v-ripple",value:!e.action.isDisabled,expression:"!action.isDisabled"}],staticClass:"d-flex px-1 mx-1 align-center action",style:{opacity:e.action.isDisabled?.2:1,cursor:e.action.isDisabled?null:"pointer"},on:{click:i.onClick}},[t("v-icon",{staticClass:"mr-1",attrs:{color:e.action.color||"primary",small:""}},[e._v(" "+e._s(e.action.icon)+" ")]),t("span",{staticClass:"action-name"},[e._v(e._s(i.t(e.action.name)))])],1)},Cb=[],kb=_(_b,Sb,Cb,!1,null,"b3a5a453",null,null);const xb=kb.exports,Pb={components:{Action:xb},props:{actions:Array}};var jb=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-inline-flex mb-1",staticStyle:{height:"21px",width:"100%","overflow-x":"auto","overflow-y":"hidden"}},e._l(e.actions,function(i){return t("Action",{key:i.id,attrs:{action:i},on:{click:function(n){return e.$emit("click")}}})}),1)},Fb=[],Tb=_(Pb,jb,Fb,!1,null,null,null,null);const Ab=Tb.exports;function $b(){const s=E(null);let e=null;return l.getApp().then(async t=>{await t.projectManager.projectReady.fired,s.value=t.project,e=l.eventSystem.on("projectChanged",i=>{s.value=i})}),mr(()=>{e==null||e.dispose(),e=null}),{project:s}}function vn(s=E(0)){const{project:e}=$b(),t=K(()=>{var r;return(r=e.value)==null?void 0:r.tabSystems[s.value]}),i=K(()=>{var r;return(r=e.value)==null?void 0:r.tabSystem}),n=K(()=>{var r;return(r=e.value)==null?void 0:r.tabSystems}),a=K(()=>{var r,o;return n.value&&(((r=n.value)==null?void 0:r[0].shouldRender.value)||((o=n.value)==null?void 0:o[1].shouldRender.value))});return{tabSystem:t,activeTabSystem:i,tabSystems:n,shouldRenderWelcomeScreen:a}}const Db={components:{TabSystemTab:bb,ActionBar:Ab,Draggable:Wi},props:{id:Number},setup(s){const{id:e}=es(s),{tabSystem:t}=vn(e);return{tabSystem:t,pointerDevice:Q}},methods:{updateTab({added:s}){!s||s.element.toOtherTabSystem(!1)}}};var Eb=function(){var e=this,t=e._self._c;return t("div",[e.tabSystem&&e.tabSystem.shouldRender?t("Draggable",{style:"display: flex; overflow-x: scroll; white-space: nowrap; width: 100%; height: 48px;",attrs:{group:{name:"tabSystemTabRow"},disabled:e.pointerDevice==="touch"},on:{change:e.updateTab},nativeOn:{mousedown:function(i){return i.target!==i.currentTarget?null:e.tabSystem.setActive(!0)}},model:{value:e.tabSystem.tabs.value,callback:function(i){e.$set(e.tabSystem.tabs,"value",i)},expression:"tabSystem.tabs.value"}},e._l(e.tabSystem.tabs.value,function(i,n){return t("TabSystemTab",{key:i.uuid,attrs:{tab:i,isActive:e.tabSystem.isActive,isFirstTab:n===0}})}),1):e._e(),e.tabSystem&&e.tabSystem.selectedTab&&e.tabSystem.selectedTab.actions.length>0?t("ActionBar",{class:{"inactive-action-bar":!e.tabSystem.isActive},attrs:{actions:e.tabSystem.selectedTab.actions},on:{click:function(i){return e.tabSystem.setActive(!0)}}}):e._e()],1)},Mb=[],Ib=_(Db,Eb,Mb,!1,null,"d7f74d33",null,null);const Ob=Ib.exports,Rb={name:"TabSystem",mixins:[Lt],props:{id:{type:Number,default:0}},setup(s){const{id:e}=es(s),{tabSystem:t}=vn(e);return Ct(t,()=>{!t.value||Ct(t.value.shouldRender,()=>{l.getApp().then(i=>i.windowResize.dispatch())})}),{tabSystem:t}},components:{TabBar:Ob},data:()=>({windowHeight:window.innerHeight}),async mounted(){(await l.getApp()).windowResize.on(this.updateWindowHeight)},async destroyed(){const s=await l.getApp();s.windowResize.off(this.updateWindowHeight),s.windowResize.dispatch()},computed:{tabBarHeight(){return this.tabSystem.selectedTab&&this.tabSystem.selectedTab.actions.length>0?48+25:48},tabHeight(){return(this.windowHeight-this.appToolbarHeightNumber)/(this.tabSystem.isSharingScreen.value&&this.isMobile?2:1)-this.tabBarHeight},isMobile(){return this.$vuetify.breakpoint.mobile}},methods:{updateWindowHeight(){this.windowHeight=window.innerHeight}}};var Wb=function(){var e=this,t=e._self._c;return e.tabSystem&&e.tabSystem.shouldRender.value?t("div",{style:{"margin-right":"1px",width:e.isMobile?"100%":"calc(50% - 100px)",height:e.isMobile?"50%":"100%"}},[t("TabBar",{attrs:{id:e.id}}),t("keep-alive",[t(e.tabSystem.currentComponent,{key:`${e.tabSystem.uuid}.${e.tabSystem.currentComponent.name||e.tabSystem.selectedTab.type||e.tabSystem.selectedTab.name}`,tag:"component",style:`height: ${e.tabHeight}px; width: 100%;`,attrs:{height:e.tabHeight,tab:e.tabSystem.selectedTab,id:e.id}})],1)],1):e._e()},Lb=[],Nb=_(Rb,Wb,Lb,!1,null,null,null,null);const Bb=Nb.exports;const Vb={__name:"Action",props:{color:String,icon:String,name:String,isSelected:Boolean},setup(s){const{t:e}=I();return{__sfc:!0,t:e,useTranslations:I}}};var Hb=function(){var e=this,t=e._self._c,i=e._self._setupProxy;return t("v-tooltip",{attrs:{color:e.color||"tooltip",disabled:e.$vuetify.breakpoint.mobile,"open-delay":500,bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:n,attrs:a}){return[t("div",e._g(e._b({directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"rounded-lg ma-1 d-flex justify-center sidebar-actions pa-2",class:{"elevation-4":e.isSelected},style:{background:e.isSelected?`var(--v-${e.color}-base)`:null,transform:e.isSelected?"scale(1.05)":null},on:{click:function(r){return e.$emit("click",r)}}},"div",a,!1),n),[t("v-icon",{attrs:{color:e.isSelected?"white":e.color}},[e._v(" "+e._s(e.icon)+" ")])],1)]}}])},[t("span",[e._v(e._s(i.t(e.name)))])])},Ub=[],zb=_(Vb,Hb,Ub,!1,null,"972e91ba",null,null);const qb=zb.exports;const Jb={props:{actions:Array},components:{Action:qb},methods:{onClick(s,e){e instanceof dt?e.select():e.trigger(s)}}};var Gb=function(){var e=this,t=e._self._c;return t("v-row",{staticClass:"action-bar pa-1",attrs:{cols:"5","no-gutters":""}},e._l(e.actions,function(i,n){return t("v-col",{key:n},[t("Action",{attrs:{color:i.config.color,icon:i.config.icon,name:i.config.name,isSelected:i.isSelected},on:{click:function(a){return e.onClick(a,i)}}})],1)}),1)},Kb=[],Yb=_(Jb,Gb,Kb,!1,null,"146b8da3",null,null);const Qb=Yb.exports,Zb={mixins:[Lt],components:{BridgeSheet:Ne,ActionBar:Qb,InfoPanel:en},mounted(){l.getApp().then(s=>{this.windowDimensions=s.windowResize.state})},data:()=>({windowDimensions:{currentHeight:window.innerHeight}}),computed:{content(){return l.sidebar.currentState.value}}};var Xb=function(){var e=this,t=e._self._c;return e.content?t("div",{staticClass:"pa-2",style:{height:`calc(${e.windowDimensions.currentHeight}px - ${e.appToolbarHeight})`}},[e.content.headerSlot?t("BridgeSheet",{staticClass:"mb-2",style:{height:e.content.headerHeight,overflow:"auto"}},[t(e.content.headerSlot,{tag:"component"})],1):e._e(),t("BridgeSheet",{style:{height:e.content.headerSlot?`calc(100% - ${e.content.headerHeight} - 8px)`:"100%",overflow:"auto"},nativeOn:{contextmenu:function(i){return e.content.onContentRightClick(i)}}},[e.content.topPanel?t("InfoPanel",{staticClass:"ma-2",attrs:{infoPanel:e.content.topPanel}}):e._e(),e.content.actions&&e.content.actions.length>0?t("ActionBar",{attrs:{actions:e.content.actions}}):e._e(),t(e.content.component,{tag:"component",attrs:{sidebarContent:e.content}})],1)],1):e._e()},e_=[],t_=_(Zb,Xb,e_,!1,null,null,null,null);const i_=t_.exports;const n_={name:"App",mixins:[Lt],setup(){const{tabSystem:s,tabSystems:e,shouldRenderWelcomeScreen:t}=vn();return{tabSystem:s,tabSystems:e,shouldRenderWelcomeScreen:t}},mounted(){l.getApp().then(s=>{this.contextMenu=s.contextMenu,this.windowSize=s.windowResize.state})},components:{Sidebar:kv,Toolbar:Gv,WindowRenderer:sb,ContextMenu:mb,TabSystem:Bb,WelcomeScreen:ds,SidebarContent:i_},data:()=>({isMacOs:J()==="darwin",contextMenu:null,settingsState:S,windowSize:{currentWidth:window.innerWidth,currentHeight:window.innerHeight}}),computed:{isSidebarContentVisible(){return this.sidebarNavigationVisible&&l.sidebar.isContentVisible.value},sidebarNavigationVisible(){return l.sidebar.isNavigationVisible.value},isSidebarRight(){return this.settingsState&&this.settingsState.sidebar&&this.settingsState.sidebar.isSidebarRight},sidebarSize(){let s=this.settingsState&&this.settingsState.sidebar?this.settingsState.sidebar.sidebarSize:void 0;if(s||(s="normal"),this.$vuetify.breakpoint.mobile)return 9;switch(s){case"tiny":return-2;case"small":return-1;case"normal":return 0;case"large":return 1}},fontFamily(){return this.settingsState&&this.settingsState.appearance&&this.settingsState.appearance.font?`${this.settingsState.appearance.font} !important`:"Roboto !important"}},methods:{openSidebar(){l.sidebar.isNavigationVisible.value=!0}},watch:{"$vuetify.breakpoint.mobile"(){this.$nextTick(()=>{l.getApp().then(s=>s.windowResize.dispatch())})}}};var s_=function(){var e=this,t=e._self._c;return t("v-app",{style:{fontFamily:e.fontFamily},nativeOn:{contextmenu:function(i){return i.preventDefault()}}},[t("Toolbar"),t("Sidebar",{attrs:{app:""}}),e.sidebarNavigationVisible?e._e():t("v-btn",{staticStyle:{bottom:"calc(env(safe-area-inset-bottom, 0) + 16px)"},attrs:{small:"",fab:"",fixed:"",left:!e.isSidebarRight,right:e.isSidebarRight,color:"primary"},on:{click:e.openSidebar}},[t("v-icon",[e._v("mdi-table-column")])],1),t("v-main",{style:{"padding-top":e.appToolbarHeight}},[t("WindowRenderer"),t("v-row",{staticClass:"d-flex fill-area",class:{"ml-2":!e.isSidebarContentVisible&&e.isSidebarRight,"mr-2":!e.isSidebarContentVisible&&!e.isSidebarRight,"flex-row-reverse":e.isSidebarRight},attrs:{"no-gutters":""}},[e.isSidebarContentVisible?t("v-col",{attrs:{cols:e.isSidebarContentVisible?3+e.sidebarSize:0}},[t("SidebarContent",{attrs:{isSidebarRight:e.isSidebarRight}})],1):e._e(),t("v-col",{staticClass:"flex-grow-1",attrs:{cols:e.isSidebarContentVisible?9-e.sidebarSize:12}},[e.shouldRenderWelcomeScreen?t("div",{staticClass:"d-flex",class:{"flex-column":e.$vuetify.breakpoint.mobile},style:{height:`calc(${e.windowSize.currentHeight}px - ${e.appToolbarHeight})`}},[t("TabSystem",{staticClass:"flex-grow-1",attrs:{showWelcomeScreen:""}}),e.tabSystems[0].shouldRender.value&&e.tabSystems[1].shouldRender.value?t("v-divider",{staticStyle:{"z-index":"1"},attrs:{vertical:!e.$vuetify.breakpoint.mobile}}):e._e(),t("TabSystem",{staticClass:"flex-grow-1",attrs:{id:1}})],1):t("WelcomeScreen",{attrs:{containerPadding:e.isSidebarContentVisible?e.isSidebarRight?"pl-2":"pr-2":"px-2"}})],1)],1)],1),e.contextMenu?t("ContextMenu",{attrs:{contextMenu:e.contextMenu,windowHeight:e.windowSize.currentHeight}}):e._e()],1)},a_=[],r_=_(n_,s_,a_,!1,null,null,null,null);const o_=r_.exports;We.use(Kn);We.config.productionTip=!1;const xa=new We({vuetify:Kt,render:s=>s(o_)});be.setDefaultLanguage().then(()=>{xa.$mount("#app")});self.MonacoEnvironment={getWorker(s,e){return e==="json"?new gr:e==="css"||e==="scss"||e==="less"?new wr:e==="html"||e==="handlebars"||e==="razor"?new yr:e==="typescript"||e==="javascript"?new vr:new br}};_r(Sr);l.main(xa);"launchQueue"in window&&window.launchQueue.setConsumer(async s=>{const e=await l.getApp();if(s.targetURL&&await e.startParams.parse(s.targetURL),!!s.files.length)for(const t of s.files)await e.fileDropper.importFile(t)});export{ue as _};
