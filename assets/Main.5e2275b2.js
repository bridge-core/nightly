(function(){"use strict";const au=Symbol("Comlink.proxy"),fr=Symbol("Comlink.endpoint"),Dr=Symbol("Comlink.releaseProxy"),yt=Symbol("Comlink.thrown"),ou=u=>typeof u=="object"&&u!==null||typeof u=="function",hr={canHandle:u=>ou(u)&&u[au],serialize(u){const{port1:e,port2:t}=new MessageChannel;return mt(u,e),[t,[t]]},deserialize(u){return u.start(),Ar(u)}},dr={canHandle:u=>ou(u)&&yt in u,serialize({value:u}){let e;return u instanceof Error?e={isError:!0,value:{message:u.message,name:u.name,stack:u.stack}}:e={isError:!1,value:u},[e,[]]},deserialize(u){throw u.isError?Object.assign(new Error(u.value.message),u.value):u.value}},Le=new Map([["proxy",hr],["throw",dr]]);function mt(u,e=self){e.addEventListener("message",function t(r){if(!r||!r.data)return;const{id:i,type:s,path:n}=Object.assign({path:[]},r.data),a=(r.data.argumentList||[]).map(xe);let o;try{const l=n.slice(0,-1).reduce((D,B)=>D[B],u),f=n.reduce((D,B)=>D[B],u);switch(s){case 0:o=f;break;case 1:l[n.slice(-1)[0]]=xe(r.data.value),o=!0;break;case 2:o=f.apply(l,a);break;case 3:{const D=new f(...a);o=Fr(D)}break;case 4:{const{port1:D,port2:B}=new MessageChannel;mt(u,B),o=gr(D,[D])}break;case 5:o=void 0;break}}catch(l){o={value:l,[yt]:0}}Promise.resolve(o).catch(l=>({value:l,[yt]:0})).then(l=>{const[f,D]=vt(l);e.postMessage(Object.assign(Object.assign({},f),{id:i}),D),s===5&&(e.removeEventListener("message",t),lu(e))})}),e.start&&e.start()}function pr(u){return u.constructor.name==="MessagePort"}function lu(u){pr(u)&&u.close()}function Ar(u,e){return wt(u,[],e)}function tt(u){if(u)throw new Error("Proxy has been released and is not useable")}function wt(u,e=[],t=function(){}){let r=!1;const i=new Proxy(t,{get(s,n){if(tt(r),n===Dr)return()=>Ie(u,{type:5,path:e.map(a=>a.toString())}).then(()=>{lu(u),r=!0});if(n==="then"){if(e.length===0)return{then:()=>i};const a=Ie(u,{type:0,path:e.map(o=>o.toString())}).then(xe);return a.then.bind(a)}return wt(u,[...e,n])},set(s,n,a){tt(r);const[o,l]=vt(a);return Ie(u,{type:1,path:[...e,n].map(f=>f.toString()),value:o},l).then(xe)},apply(s,n,a){tt(r);const o=e[e.length-1];if(o===fr)return Ie(u,{type:4}).then(xe);if(o==="bind")return wt(u,e.slice(0,-1));const[l,f]=cu(a);return Ie(u,{type:2,path:e.map(D=>D.toString()),argumentList:l},f).then(xe)},construct(s,n){tt(r);const[a,o]=cu(n);return Ie(u,{type:3,path:e.map(l=>l.toString()),argumentList:a},o).then(xe)}});return i}function Cr(u){return Array.prototype.concat.apply([],u)}function cu(u){const e=u.map(vt);return[e.map(t=>t[0]),Cr(e.map(t=>t[1]))]}const fu=new WeakMap;function gr(u,e){return fu.set(u,e),u}function Fr(u){return Object.assign(u,{[au]:!0})}function vt(u){for(const[e,t]of Le)if(t.canHandle(u)){const[r,i]=t.serialize(u);return[{type:3,name:e,value:r},i]}return[{type:0,value:u},fu.get(u)||[]]}function xe(u){switch(u.type){case 3:return Le.get(u.name).deserialize(u.value);case 0:return u.value}}function Ie(u,e,t){return new Promise(r=>{const i=Er();u.addEventListener("message",function s(n){!n.data||!n.data.id||n.data.id!==i||(u.removeEventListener("message",s),r(n.data))}),u.start&&u.start(),u.postMessage(Object.assign({id:i},e),t)})}function Er(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var ut,yr=new Uint8Array(16);function mr(){if(!ut&&(ut=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!ut))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ut(yr)}var wr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function vr(u){return typeof u=="string"&&wr.test(u)}for(var Q=[],Bt=0;Bt<256;++Bt)Q.push((Bt+256).toString(16).substr(1));function Br(u){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Q[u[e+0]]+Q[u[e+1]]+Q[u[e+2]]+Q[u[e+3]]+"-"+Q[u[e+4]]+Q[u[e+5]]+"-"+Q[u[e+6]]+Q[u[e+7]]+"-"+Q[u[e+8]]+Q[u[e+9]]+"-"+Q[u[e+10]]+Q[u[e+11]]+Q[u[e+12]]+Q[u[e+13]]+Q[u[e+14]]+Q[u[e+15]]).toLowerCase();if(!vr(t))throw TypeError("Stringified UUID is invalid");return t}function Sr(u,e,t){u=u||{};var r=u.random||(u.rng||mr)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return Br(r)}class Du{constructor(){this.listeners=new Set}get hasListeners(){return this.listeners.size>0}dispatch(e){this.listeners.forEach(t=>t(e))}on(e,t=!0){if(this.listeners.add(e),t)return{dispose:()=>{this.off(e)}}}off(e){this.listeners.delete(e)}once(e,t=!1){const r=i=>{e(i),this.off(r)};return this.on(r,t)}disposeListeners(){this.listeners=new Set}}class Ne extends Du{constructor(e=1){super(),this.needsToFireAmount=e,this.firedTimes=0}get fired(){return new Promise(e=>this.once(e,!1))}get hasFired(){return this.firedTimes>=this.needsToFireAmount}setFiredTimes(e){this.firedTimes=e}resetSignal(){this.data=void 0,this.firedTimes=0}dispatch(e){if(this.firedTimes<this.needsToFireAmount&&this.firedTimes++,this.data=e,this.hasFired)return super.dispatch(e)}on(e,t=!0){return this.hasFired&&e(this.data),super.on(e,t)}}function br(){if(!(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent))||!indexedDB.databases)return Promise.resolve();let e;return new Promise(t=>{const r=()=>indexedDB.databases().finally(t);e=setInterval(r,100),r()}).finally(()=>clearInterval(e))}function we(u){return new Promise((e,t)=>{u.oncomplete=u.onsuccess=()=>e(u.result),u.onabort=u.onerror=()=>t(u.error)})}function St(u,e){const t=br().then(()=>{const r=indexedDB.open(u);return r.onupgradeneeded=()=>r.result.createObjectStore(e),we(r)});return(r,i)=>t.then(s=>i(s.transaction(e,r).objectStore(e)))}let bt;function ke(){return bt||(bt=St("keyval-store","keyval")),bt}function _t(u,e=ke()){return e("readonly",t=>we(t.get(u)))}function xt(u,e,t=ke()){return t("readwrite",r=>(r.put(e,u),we(r.transaction)))}function _r(u,e=ke()){return e("readwrite",t=>(u.forEach(r=>t.put(r[1],r[0])),we(t.transaction)))}function xr(u,e=ke()){return e("readonly",t=>Promise.all(u.map(r=>we(t.get(r)))))}function kr(u,e=ke()){return e("readwrite",t=>(t.delete(u),we(t.transaction)))}function Tr(u=ke()){return u("readwrite",e=>(e.clear(),we(e.transaction)))}function Rr(u,e){return u("readonly",t=>(t.openCursor().onsuccess=function(){!this.result||(e(this.result),this.result.continue())},we(t.transaction)))}function Pr(u=ke()){const e=[];return Rr(u,t=>e.push(t.key)).then(()=>e)}const $r=St("virtual-fs","virtual-fs-store"),Or=u=>_t(u,$r);class Je{constructor(e="virtual-fs"){this.storeName=e,this.store=St(e,`${e}-store`)}set(e,t){return xt(e,t,this.store)}get(e){return _t(e,this.store)}del(e){return kr(e,this.store)}setMany(e){return _r(e,this.store)}getMany(e){return xr(e,this.store)}clear(){return Tr(this.store)}async has(e){return await Or(e)!==void 0}keys(){return Pr(this.store)}}class hu{constructor(e,t,r=[],i=Sr()){this._name=t,this.basePath=r,this.uuid=i,this._idbWrapper=null,this.parent=null,this.isVirtual=!0,this.setupDone=new Ne,e===null?this._idbWrapper=new Je:e instanceof Je?this._idbWrapper=e:this.parent=e}get path(){return this.parent?this.parent.path.concat(this.name):this.basePath}get hasParentContext(){return this.path.length>1}get idbKey(){return this.path.length===0?this._name:this.path.join("/")}get idbWrapper(){return this._idbWrapper===null?this.parent.idbWrapper:this._idbWrapper}get name(){return this._name}getParent(){return this.parent}async isSameEntry(e){return e.idbKey===this.idbKey}async queryPermission(e){return"granted"}async requestPermission(e){return"granted"}}const Hr=new TextEncoder,du=Symbol("writeMethod");class Lr{constructor(e){this.fileHandle=e,this.tmpData=new Uint8Array,this.cursorOffset=0,this.locked=!1}async write(e){let t;if(typeof e=="string")t=Hr.encode(e);else if(e instanceof Blob)t=await e.arrayBuffer().then(r=>new Uint8Array(r));else if("type"in e){if(e.type==="seek")return await this.seek(e.position);if(e.type==="truncate")return await this.truncate(e.size);if(e.type==="write")return e.position&&await this.seek(e.position),await this.write(e.data);throw new Error(`Unknown data type: ${e.type}`)}else ArrayBuffer.isView(e)?t=new Uint8Array(e.buffer):t=new Uint8Array(e);this.tmpData=new Uint8Array([...this.tmpData.slice(0,this.cursorOffset),...t]),this.cursorOffset=this.tmpData.length}async seek(e){this.cursorOffset=Math.floor(e)}async truncate(e){this.tmpData=this.tmpData.slice(0,e),this.cursorOffset>e&&(this.cursorOffset=e)}async close(){await this.fileHandle[du](this.tmpData)}async abort(){throw new Error("WriteStream was aborted")}getWriter(){}}class fe extends hu{constructor(e,t,r,i=!1,s){super(e,t,s),this.inMemory=i,this.kind="file",this.isFile=!0,this.isDirectory=!1,r?this.setup(r):this.setupDone.dispatch()}get isFileStoredInMemory(){return this.fileData!==void 0}moveData(){if(!this.fileData)throw new Error(`No file data to move to IDB for file "${this.name}"`);const e=this.fileData;return this.fileData=void 0,this.inMemory=!1,e}async setup(e){this.fileData=e;const t=this.path.join("/").startsWith("data/packages");if(this.inMemory||t&&e.length<5e4)return this.inMemory=!0,this.setupDone.dispatch();(!t||globalThis.document)&&await this.updateIdb(e),this.setupDone.dispatch()}async updateIdb(e){await this.idbWrapper.set(this.idbKey,e),this.fileData=void 0}async loadFromIdb(){if(this.fileData)return this.fileData;let e=await this.idbWrapper.get(this.idbKey);if(e===void 0)throw console.log(this.parent),new Error(`File not found: "${this.path.join("/")}"`);return e}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"file",name:this.name,path:this.path,fileData:this.fileData}}static deserialize(e){return new fe(e.idbWrapper?new Je(e.idbWrapper):null,e.name,e.fileData,e.fileData!==void 0,e.path)}async isSameEntry(e){return this.parent===null?!1:super.isSameEntry(e)}async removeSelf(e=!0){await this.idbWrapper.del(this.idbKey),this.parent&&e&&this.parent.deleteChild(this.name)}async getFile(){const e=await this.loadFromIdb();return new File([e],this.name)}async createWritable(){return new Lr(this)}async[du](e){this.inMemory?this.fileData=e:await this.updateIdb(e)}}class ne extends hu{constructor(e,t,r,i=!1,s=[]){super(e,t,s),this.children=r,this.kind="directory",this.isDirectory=!0,this.isFile=!1,this.updateIdb(i)}get isDirectoryInMemory(){return this.children!==void 0}async moveToIdb(){const e=this.allInMemoryChildren();this.idbWrapper.setMany(e.map(t=>[t.idbKey,t.moveData()]))}moveData(){if(!this.children)throw new Error(`No directory data to move to IDB for directory "${this.name}"`);const e=[...this.children.values()].map(t=>t.name);return this.children=void 0,e}allInMemoryChildren(){if(!this.children)return[];const e=[this];for(const t of this.children.values())t instanceof ne?t.isDirectoryInMemory&&e.push(...t.allInMemoryChildren()):t.isFileStoredInMemory&&e.push(t);return e}async updateIdb(e=!1){e&&await this.idbWrapper.clear(),!this.children&&!await this.hasChildren()&&await this.idbWrapper.set(this.idbKey,[]),this.setupDone.dispatch()}async addChild(e){await this.has(e.name)||(this.children?this.children.set(e.name,e):await this.idbWrapper.set(this.idbKey,[...await this.fromIdb(),e.name]))}async fromIdb(){var e;return(e=await this.idbWrapper.get(this.idbKey))!=null?e:[]}async getChildren(){return this.children?[...this.children.values()]:await Promise.all((await this.fromIdb()).map(e=>this.getChild(e)).filter(e=>e!==void 0))}getChildPath(e){return this.path.concat(e).join("/")}async getChild(e){if(this.children)return this.children.get(e);if(await this.has(e)){const t=await this.idbWrapper.get(this.getChildPath(e));if(t instanceof Uint8Array)return new fe(this,e);if(Array.isArray(t))return new ne(this,e)}}async deleteChild(e){this.children?this.children.delete(e):await this.idbWrapper.set(this.idbKey,(await this.fromIdb()).filter(t=>t!==e))}async hasChildren(){return this.children?this.children.size>0:(await this.fromIdb()).length>0}async has(e){return this.children?this.children.has(e):(await this.fromIdb()).includes(e)}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"directory",name:this.name,path:this.path,children:this.children?[...this.children.values()].map(e=>e.serialize()):void 0}}static deserialize(e,t=null){var i;const r=new ne(t||new Je(e.idbWrapper),e.name,void 0,!1,e.path);for(const s of(i=e.children)!=null?i:[])s.kind==="directory"?r.addChild(ne.deserialize(s,r)):r.addChild(new fe(r,s.name,s.fileData));return r}async getDirectoryHandle(e,{create:t}={}){let r=await this.getChild(e);if(r&&r.kind==="file")throw new Error(`TypeMismatch: Expected directory with name "${e}", found file`);if(!r)if(t)r=new ne(this,e,this.children?new Map:void 0),await r.setupDone.fired,await this.addChild(r);else throw new Error(`No file with the name ${e} exists in this folder`);return r}async getFileHandle(e,{create:t,initialData:r}={}){let i=await this.getChild(e);if(i&&i.kind==="directory")throw new Error(`TypeMismatch: Expected file with name "${e}", found directory`);if(!i)if(t)i=new fe(this,e,r!=null?r:new Uint8Array),await i.setupDone.fired,await this.addChild(i);else throw new Error(`No file with the name ${e} exists in this folder`);return i}async removeEntry(e,{recursive:t}={}){const r=await this.getChild(e);if(r){if(r.kind==="directory"&&!t&&await r.hasChildren())throw new Error('Cannot remove directory with children without "recursive" option being set to true')}else throw new Error(`No entry with the name ${e} exists in this folder`);await r.removeSelf(),await this.deleteChild(e)}async resolve(e){const t=[e.name];let r=e.getParent();for(;r!==null&&!await r.isSameEntry(this);)t.unshift(r.name),r=r.getParent();return r===null?null:t}async removeSelf(e=!0){const t=await this.getChildren();for(const r of t)await r.removeSelf(!1);this.children||await this.idbWrapper.del(this.idbKey),this.parent&&e&&this.parent.deleteChild(this.name)}[Symbol.asyncIterator](){return this.entries()}keys(){return this.children?this.children.keys():{childNamesPromise:this.fromIdb(),[Symbol.asyncIterator](){return{i:0,childNamesPromise:this.childNamesPromise,async next(){const e=await this.childNamesPromise;return this.i<e.length?{done:!1,value:e[this.i++]}:{done:!0}}}}}}entries(){return this.children?this.children.entries():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const e=await this.childrenPromise;return this.i<e.length?{done:!1,value:[e[this.i].name,e[this.i++]]}:{done:!0}}}}}}values(){return this.children?this.children.values():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const e=await this.childrenPromise;return this.i<e.length?{done:!1,value:e[this.i++]}:{done:!0}}}}}}getEntries(){return this.values()}getDirectory(e,t={}){return this.getDirectoryHandle(e,t)}getFile(e,t={}){return this.getFileHandle(e,t)}}Le.set("VirtualFileHandle",{canHandle:u=>u instanceof fe,serialize:u=>[u.serialize(),[]],deserialize:u=>new fe(null,u.name,u.fileData)}),Le.set("VirtualDirectoryHandle",{canHandle:u=>u instanceof ne,serialize:u=>[u.serialize(),[]],deserialize:u=>ne.deserialize(u)}),Le.set("VirtualDirectoryHandleArray",{canHandle:u=>Array.isArray(u)&&u.every(({directory:e})=>e instanceof ne),serialize:u=>[u.map(({directory:e,...t})=>({directory:e.serialize(),...t})),[]],deserialize:u=>u.map(({directory:e,...t})=>({directory:ne.deserialize(e),...t}))}),Le.set("VirtualFileHandleArray",{canHandle:u=>Array.isArray(u)&&u.every(({fileHandle:e})=>e instanceof fe),serialize:u=>[u.map(({fileHandle:e,...t})=>({fileHandle:e.serialize(),...t})),[]],deserialize:u=>u.map(({fileHandle:e,...t})=>({fileHandle:fe.deserialize(e),...t}))});var Ir=Object.defineProperty,Nr=Object.defineProperties,Mr=Object.getOwnPropertyDescriptors,pu=Object.getOwnPropertySymbols,jr=Object.prototype.hasOwnProperty,Wr=Object.prototype.propertyIsEnumerable,Au=(u,e,t)=>e in u?Ir(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t,Me=(u,e)=>{for(var t in e||(e={}))jr.call(e,t)&&Au(u,t,e[t]);if(pu)for(var t of pu(e))Wr.call(e,t)&&Au(u,t,e[t]);return u},rt=(u,e)=>Nr(u,Mr(e));function Cu(u,e){for(var t=0,r=u.length-1;r>=0;r--){var i=u[r];i==="."?u.splice(r,1):i===".."?(u.splice(r,1),t++):t&&(u.splice(r,1),t--)}if(e)for(;t--;t)u.unshift("..");return u}var zr=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,kt=function(u){return zr.exec(u).slice(1)};function it(){for(var u="",e=!1,t=arguments.length-1;t>=-1&&!e;t--){var r=t>=0?arguments[t]:"/";if(typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)continue;u=r+"/"+u,e=r.charAt(0)==="/"}return u=Cu(Pt(u.split("/"),function(i){return!!i}),!e).join("/"),(e?"/":"")+u||"."}function Tt(u){var e=Rt(u),t=Ur(u,-1)==="/";return u=Cu(Pt(u.split("/"),function(r){return!!r}),!e).join("/"),!u&&!e&&(u="."),u&&t&&(u+="/"),(e?"/":"")+u}function Rt(u){return u.charAt(0)==="/"}function gu(){var u=Array.prototype.slice.call(arguments,0);return Tt(Pt(u,function(e,t){if(typeof e!="string")throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function Fu(u,e){u=it(u).substr(1),e=it(e).substr(1);function t(l){for(var f=0;f<l.length&&l[f]==="";f++);for(var D=l.length-1;D>=0&&l[D]==="";D--);return f>D?[]:l.slice(f,D-f+1)}for(var r=t(u.split("/")),i=t(e.split("/")),s=Math.min(r.length,i.length),n=s,a=0;a<s;a++)if(r[a]!==i[a]){n=a;break}for(var o=[],a=n;a<r.length;a++)o.push("..");return o=o.concat(i.slice(n)),o.join("/")}var Eu="/",yu=":";function mu(u){var e=kt(u),t=e[0],r=e[1];return!t&&!r?".":(r&&(r=r.substr(0,r.length-1)),t+r)}function wu(u,e){var t=kt(u)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t}function vu(u){return kt(u)[3]}var Gr={extname:vu,basename:wu,dirname:mu,sep:Eu,delimiter:yu,relative:Fu,join:gu,isAbsolute:Rt,normalize:Tt,resolve:it};function Pt(u,e){if(u.filter)return u.filter(e);for(var t=[],r=0;r<u.length;r++)e(u[r],r,u)&&t.push(u[r]);return t}var Ur="ab".substr(-1)==="b"?function(u,e,t){return u.substr(e,t)}:function(u,e,t){return e<0&&(e=u.length+e),u.substr(e,t)},$t=Object.freeze({__proto__:null,resolve:it,normalize:Tt,isAbsolute:Rt,join:gu,relative:Fu,sep:Eu,delimiter:yu,dirname:mu,basename:wu,extname:vu,default:Gr});function Bu(){throw new Error("setTimeout has not been defined")}function Su(){throw new Error("clearTimeout has not been defined")}var ve=Bu,Be=Su,je;typeof window<"u"?je=window:typeof self<"u"?je=self:je={},typeof je.setTimeout=="function"&&(ve=setTimeout),typeof je.clearTimeout=="function"&&(Be=clearTimeout);function bu(u){if(ve===setTimeout)return setTimeout(u,0);if((ve===Bu||!ve)&&setTimeout)return ve=setTimeout,setTimeout(u,0);try{return ve(u,0)}catch{try{return ve.call(null,u,0)}catch{return ve.call(this,u,0)}}}function Kr(u){if(Be===clearTimeout)return clearTimeout(u);if((Be===Su||!Be)&&clearTimeout)return Be=clearTimeout,clearTimeout(u);try{return Be(u)}catch{try{return Be.call(null,u)}catch{return Be.call(this,u)}}}var ge=[],We=!1,Te,nt=-1;function Vr(){!We||!Te||(We=!1,Te.length?ge=Te.concat(ge):nt=-1,ge.length&&_u())}function _u(){if(!We){var u=bu(Vr);We=!0;for(var e=ge.length;e;){for(Te=ge,ge=[];++nt<e;)Te&&Te[nt].run();nt=-1,e=ge.length}Te=null,We=!1,Kr(u)}}function Jr(u){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];ge.push(new xu(u,e)),ge.length===1&&!We&&bu(_u)}function xu(u,e){this.fun=u,this.array=e}xu.prototype.run=function(){this.fun.apply(null,this.array)};var Xr="browser",qr="browser",Qr=!0,Zr=[],Yr="",ei={},ti={},ui={};function Re(){}var ri=Re,ii=Re,ni=Re,si=Re,ai=Re,oi=Re,li=Re;function ci(u){throw new Error("process.binding is not supported")}function fi(){return"/"}function Di(u){throw new Error("process.chdir is not supported")}function hi(){return 0}var ze=je.performance||{},di=ze.now||ze.mozNow||ze.msNow||ze.oNow||ze.webkitNow||function(){return new Date().getTime()};function pi(u){var e=di.call(ze)*.001,t=Math.floor(e),r=Math.floor(e%1*1e9);return u&&(t=t-u[0],r=r-u[1],r<0&&(t--,r+=1e9)),[t,r]}var Ai=new Date;function Ci(){var u=new Date,e=u-Ai;return e/1e3}var gi={nextTick:Jr,title:Xr,browser:Qr,env:{NODE_ENV:"production"},argv:Zr,version:Yr,versions:ei,on:ri,addListener:ii,once:ni,off:si,removeListener:ai,removeAllListeners:oi,emit:li,binding:ci,cwd:fi,chdir:Di,umask:hi,hrtime:pi,platform:qr,release:ti,config:ui,uptime:Ci};function Fi(u,e,t){return t={path:e,exports:{},require:function(r,i){return Ei(r,i==null?t.path:i)}},u(t,t.exports),t.exports}function Ei(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}const De="\\\\/",ku=`[^${De}]`,Fe="\\.",yi="\\+",mi="\\?",st="\\/",wi="(?=.)",Tu="[^/]",Ot=`(?:${st}|$)`,Ru=`(?:^|${st})`,Ht=`${Fe}{1,2}${Ot}`,vi=`(?!${Fe})`,Bi=`(?!${Ru}${Ht})`,Si=`(?!${Fe}{0,1}${Ot})`,bi=`(?!${Ht})`,_i=`[^.${st}]`,xi=`${Tu}*?`,Pu={DOT_LITERAL:Fe,PLUS_LITERAL:yi,QMARK_LITERAL:mi,SLASH_LITERAL:st,ONE_CHAR:wi,QMARK:Tu,END_ANCHOR:Ot,DOTS_SLASH:Ht,NO_DOT:vi,NO_DOTS:Bi,NO_DOT_SLASH:Si,NO_DOTS_SLASH:bi,QMARK_NO_DOT:_i,STAR:xi,START_ANCHOR:Ru},ki=rt(Me({},Pu),{SLASH_LITERAL:`[${De}]`,QMARK:ku,STAR:`${ku}*?`,DOTS_SLASH:`${Fe}{1,2}(?:[${De}]|$)`,NO_DOT:`(?!${Fe})`,NO_DOTS:`(?!(?:^|[${De}])${Fe}{1,2}(?:[${De}]|$))`,NO_DOT_SLASH:`(?!${Fe}{0,1}(?:[${De}]|$))`,NO_DOTS_SLASH:`(?!${Fe}{1,2}(?:[${De}]|$))`,QMARK_NO_DOT:`[^.${De}]`,START_ANCHOR:`(?:^|[${De}])`,END_ANCHOR:`(?:[${De}]|$)`}),Ti={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};var Pe={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:Ti,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:$t.sep,extglobChars(u){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${u.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(u){return u===!0?ki:Pu}},X=Fi(function(u,e){const{REGEX_BACKSLASH:t,REGEX_REMOVE_BACKSLASH:r,REGEX_SPECIAL_CHARS:i,REGEX_SPECIAL_CHARS_GLOBAL:s}=Pe;e.isObject=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),e.hasRegexChars=n=>i.test(n),e.isRegexChar=n=>n.length===1&&e.hasRegexChars(n),e.escapeRegex=n=>n.replace(s,"\\$1"),e.toPosixSlashes=n=>n.replace(t,"/"),e.removeBackslashes=n=>n.replace(r,a=>a==="\\"?"":a),e.supportsLookbehinds=()=>{const n=gi.version.slice(1).split(".").map(Number);return n.length===3&&n[0]>=9||n[0]===8&&n[1]>=10},e.isWindows=n=>n&&typeof n.windows=="boolean"?n.windows:$t.sep==="\\",e.escapeLast=(n,a,o)=>{const l=n.lastIndexOf(a,o);return l===-1?n:n[l-1]==="\\"?e.escapeLast(n,a,l-1):`${n.slice(0,l)}\\${n.slice(l)}`},e.removePrefix=(n,a={})=>{let o=n;return o.startsWith("./")&&(o=o.slice(2),a.prefix="./"),o},e.wrapOutput=(n,a={},o={})=>{const l=o.contains?"":"^",f=o.contains?"":"$";let D=`${l}(?:${n})${f}`;return a.negated===!0&&(D=`(?:^(?!${D}).*$)`),D}});const{CHAR_ASTERISK:Lt,CHAR_AT:Ri,CHAR_BACKWARD_SLASH:Xe,CHAR_COMMA:Pi,CHAR_DOT:It,CHAR_EXCLAMATION_MARK:Nt,CHAR_FORWARD_SLASH:$u,CHAR_LEFT_CURLY_BRACE:Mt,CHAR_LEFT_PARENTHESES:jt,CHAR_LEFT_SQUARE_BRACKET:$i,CHAR_PLUS:Oi,CHAR_QUESTION_MARK:Ou,CHAR_RIGHT_CURLY_BRACE:Hi,CHAR_RIGHT_PARENTHESES:Hu,CHAR_RIGHT_SQUARE_BRACKET:Li}=Pe,Lu=u=>u===$u||u===Xe,Iu=u=>{u.isPrefix!==!0&&(u.depth=u.isGlobstar?1/0:1)};var Ii=(u,e)=>{const t=e||{},r=u.length-1,i=t.parts===!0||t.scanToEnd===!0,s=[],n=[],a=[];let o=u,l=-1,f=0,D=0,B=!1,m=!1,y=!1,A=!1,E=!1,C=!1,w=!1,S=!1,x=!1,b=!1,I=0,N,v,$={value:"",depth:0,isGlob:!1};const K=()=>l>=r,d=()=>o.charCodeAt(l+1),L=()=>(N=v,o.charCodeAt(++l));for(;l<r;){v=L();let Z;if(v===Xe){w=$.backslashes=!0,v=L(),v===Mt&&(C=!0);continue}if(C===!0||v===Mt){for(I++;K()!==!0&&(v=L());){if(v===Xe){w=$.backslashes=!0,L();continue}if(v===Mt){I++;continue}if(C!==!0&&v===It&&(v=L())===It){if(B=$.isBrace=!0,y=$.isGlob=!0,b=!0,i===!0)continue;break}if(C!==!0&&v===Pi){if(B=$.isBrace=!0,y=$.isGlob=!0,b=!0,i===!0)continue;break}if(v===Hi&&(I--,I===0)){C=!1,B=$.isBrace=!0,b=!0;break}}if(i===!0)continue;break}if(v===$u){if(s.push(l),n.push($),$={value:"",depth:0,isGlob:!1},b===!0)continue;if(N===It&&l===f+1){f+=2;continue}D=l+1;continue}if(t.noext!==!0&&(v===Oi||v===Ri||v===Lt||v===Ou||v===Nt)===!0&&d()===jt){if(y=$.isGlob=!0,A=$.isExtglob=!0,b=!0,v===Nt&&l===f&&(x=!0),i===!0){for(;K()!==!0&&(v=L());){if(v===Xe){w=$.backslashes=!0,v=L();continue}if(v===Hu){y=$.isGlob=!0,b=!0;break}}continue}break}if(v===Lt){if(N===Lt&&(E=$.isGlobstar=!0),y=$.isGlob=!0,b=!0,i===!0)continue;break}if(v===Ou){if(y=$.isGlob=!0,b=!0,i===!0)continue;break}if(v===$i){for(;K()!==!0&&(Z=L());){if(Z===Xe){w=$.backslashes=!0,L();continue}if(Z===Li){m=$.isBracket=!0,y=$.isGlob=!0,b=!0;break}}if(i===!0)continue;break}if(t.nonegate!==!0&&v===Nt&&l===f){S=$.negated=!0,f++;continue}if(t.noparen!==!0&&v===jt){if(y=$.isGlob=!0,i===!0){for(;K()!==!0&&(v=L());){if(v===jt){w=$.backslashes=!0,v=L();continue}if(v===Hu){b=!0;break}}continue}break}if(y===!0){if(b=!0,i===!0)continue;break}}t.noext===!0&&(A=!1,y=!1);let H=o,se="",h="";f>0&&(se=o.slice(0,f),o=o.slice(f),D-=f),H&&y===!0&&D>0?(H=o.slice(0,D),h=o.slice(D)):y===!0?(H="",h=o):H=o,H&&H!==""&&H!=="/"&&H!==o&&Lu(H.charCodeAt(H.length-1))&&(H=H.slice(0,-1)),t.unescape===!0&&(h&&(h=X.removeBackslashes(h)),H&&w===!0&&(H=X.removeBackslashes(H)));const c={prefix:se,input:u,start:f,base:H,glob:h,isBrace:B,isBracket:m,isGlob:y,isExtglob:A,isGlobstar:E,negated:S,negatedExtglob:x};if(t.tokens===!0&&(c.maxDepth=0,Lu(v)||n.push($),c.tokens=n),t.parts===!0||t.tokens===!0){let Z;for(let O=0;O<s.length;O++){const ie=Z?Z+1:f,Y=s[O],te=u.slice(ie,Y);t.tokens&&(O===0&&f!==0?(n[O].isPrefix=!0,n[O].value=se):n[O].value=te,Iu(n[O]),c.maxDepth+=n[O].depth),(O!==0||te!=="")&&a.push(te),Z=Y}if(Z&&Z+1<u.length){const O=u.slice(Z+1);a.push(O),t.tokens&&(n[n.length-1].value=O,Iu(n[n.length-1]),c.maxDepth+=n[n.length-1].depth)}c.slashes=s,c.parts=a}return c};const{MAX_LENGTH:at,POSIX_REGEX_SOURCE:Ni,REGEX_NON_SPECIAL_CHARS:Mi,REGEX_SPECIAL_CHARS_BACKREF:ji,REPLACEMENTS:Nu}=Pe,Wi=(u,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...u,e);u.sort();const t=`[${u.join("-")}]`;try{new RegExp(t)}catch{return u.map(i=>X.escapeRegex(i)).join("..")}return t},Ge=(u,e)=>`Missing ${u}: "${e}" - use "\\\\${e}" to match literal characters`,Mu=(u,e)=>{if(typeof u!="string")throw new TypeError("Expected a string");u=Nu[u]||u;const t=Me({},e),r=typeof t.maxLength=="number"?Math.min(at,t.maxLength):at;let i=u.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);const s={type:"bos",value:"",output:t.prepend||""},n=[s],a=t.capture?"":"?:",o=X.isWindows(e),l=Pe.globChars(o),f=Pe.extglobChars(l),{DOT_LITERAL:D,PLUS_LITERAL:B,SLASH_LITERAL:m,ONE_CHAR:y,DOTS_SLASH:A,NO_DOT:E,NO_DOT_SLASH:C,NO_DOTS_SLASH:w,QMARK:S,QMARK_NO_DOT:x,STAR:b,START_ANCHOR:I}=l,N=F=>`(${a}(?:(?!${I}${F.dot?A:D}).)*?)`,v=t.dot?"":E,$=t.dot?S:x;let K=t.bash===!0?N(t):b;t.capture&&(K=`(${K})`),typeof t.noext=="boolean"&&(t.noextglob=t.noext);const d={input:u,index:-1,start:0,dot:t.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:n};u=X.removePrefix(u,d),i=u.length;const L=[],H=[],se=[];let h=s,c;const Z=()=>d.index===i-1,O=d.peek=(F=1)=>u[d.index+F],ie=d.advance=()=>u[++d.index]||"",Y=()=>u.slice(d.index+1),te=(F="",z=0)=>{d.consumed+=F,d.index+=z},Ae=F=>{d.output+=F.output!=null?F.output:F.value,te(F.value)},et=()=>{let F=1;for(;O()==="!"&&(O(2)!=="("||O(3)==="?");)ie(),d.start++,F++;return F%2===0?!1:(d.negated=!0,d.start++,!0)},_e=F=>{d[F]++,se.push(F)},Ce=F=>{d[F]--,se.pop()},T=F=>{if(h.type==="globstar"){const z=d.braces>0&&(F.type==="comma"||F.type==="brace"),g=F.extglob===!0||L.length&&(F.type==="pipe"||F.type==="paren");F.type!=="slash"&&F.type!=="paren"&&!z&&!g&&(d.output=d.output.slice(0,-h.output.length),h.type="star",h.value="*",h.output=K,d.output+=h.output)}if(L.length&&F.type!=="paren"&&(L[L.length-1].inner+=F.value),(F.value||F.output)&&Ae(F),h&&h.type==="text"&&F.type==="text"){h.value+=F.value,h.output=(h.output||"")+F.value;return}F.prev=h,n.push(F),h=F},He=(F,z)=>{const g=rt(Me({},f[z]),{conditions:1,inner:""});g.prev=h,g.parens=d.parens,g.output=d.output;const R=(t.capture?"(":"")+g.open;_e("parens"),T({type:F,value:z,output:d.output?"":y}),T({type:"paren",extglob:!0,value:ie(),output:R}),L.push(g)},Ft=F=>{let z=F.close+(t.capture?")":""),g;if(F.type==="negate"){let R=K;F.inner&&F.inner.length>1&&F.inner.includes("/")&&(R=N(t)),(R!==K||Z()||/^\)+$/.test(Y()))&&(z=F.close=`)$))${R}`),F.inner.includes("*")&&(g=Y())&&/^\.[^\\/.]+$/.test(g)&&(z=F.close=`)${g})${R})`),F.prev.type==="bos"&&(d.negatedExtglob=!0)}T({type:"paren",extglob:!0,value:c,output:z}),Ce("parens")};if(t.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(u)){let F=!1,z=u.replace(ji,(g,R,V,re,J,su)=>re==="\\"?(F=!0,g):re==="?"?R?R+re+(J?S.repeat(J.length):""):su===0?$+(J?S.repeat(J.length):""):S.repeat(V.length):re==="."?D.repeat(V.length):re==="*"?R?R+re+(J?K:""):K:R?g:`\\${g}`);return F===!0&&(t.unescape===!0?z=z.replace(/\\/g,""):z=z.replace(/\\+/g,g=>g.length%2===0?"\\\\":g?"\\":"")),z===u&&t.contains===!0?(d.output=u,d):(d.output=X.wrapOutput(z,d,e),d)}for(;!Z();){if(c=ie(),c==="\0")continue;if(c==="\\"){const g=O();if(g==="/"&&t.bash!==!0||g==="."||g===";")continue;if(!g){c+="\\",T({type:"text",value:c});continue}const R=/^\\+/.exec(Y());let V=0;if(R&&R[0].length>2&&(V=R[0].length,d.index+=V,V%2!==0&&(c+="\\")),t.unescape===!0?c=ie():c+=ie(),d.brackets===0){T({type:"text",value:c});continue}}if(d.brackets>0&&(c!=="]"||h.value==="["||h.value==="[^")){if(t.posix!==!1&&c===":"){const g=h.value.slice(1);if(g.includes("[")&&(h.posix=!0,g.includes(":"))){const R=h.value.lastIndexOf("["),V=h.value.slice(0,R),re=h.value.slice(R+2),J=Ni[re];if(J){h.value=V+J,d.backtrack=!0,ie(),!s.output&&n.indexOf(h)===1&&(s.output=y);continue}}}(c==="["&&O()!==":"||c==="-"&&O()==="]")&&(c=`\\${c}`),c==="]"&&(h.value==="["||h.value==="[^")&&(c=`\\${c}`),t.posix===!0&&c==="!"&&h.value==="["&&(c="^"),h.value+=c,Ae({value:c});continue}if(d.quotes===1&&c!=='"'){c=X.escapeRegex(c),h.value+=c,Ae({value:c});continue}if(c==='"'){d.quotes=d.quotes===1?0:1,t.keepQuotes===!0&&T({type:"text",value:c});continue}if(c==="("){_e("parens"),T({type:"paren",value:c});continue}if(c===")"){if(d.parens===0&&t.strictBrackets===!0)throw new SyntaxError(Ge("opening","("));const g=L[L.length-1];if(g&&d.parens===g.parens+1){Ft(L.pop());continue}T({type:"paren",value:c,output:d.parens?")":"\\)"}),Ce("parens");continue}if(c==="["){if(t.nobracket===!0||!Y().includes("]")){if(t.nobracket!==!0&&t.strictBrackets===!0)throw new SyntaxError(Ge("closing","]"));c=`\\${c}`}else _e("brackets");T({type:"bracket",value:c});continue}if(c==="]"){if(t.nobracket===!0||h&&h.type==="bracket"&&h.value.length===1){T({type:"text",value:c,output:`\\${c}`});continue}if(d.brackets===0){if(t.strictBrackets===!0)throw new SyntaxError(Ge("opening","["));T({type:"text",value:c,output:`\\${c}`});continue}Ce("brackets");const g=h.value.slice(1);if(h.posix!==!0&&g[0]==="^"&&!g.includes("/")&&(c=`/${c}`),h.value+=c,Ae({value:c}),t.literalBrackets===!1||X.hasRegexChars(g))continue;const R=X.escapeRegex(h.value);if(d.output=d.output.slice(0,-h.value.length),t.literalBrackets===!0){d.output+=R,h.value=R;continue}h.value=`(${a}${R}|${h.value})`,d.output+=h.value;continue}if(c==="{"&&t.nobrace!==!0){_e("braces");const g={type:"brace",value:c,output:"(",outputIndex:d.output.length,tokensIndex:d.tokens.length};H.push(g),T(g);continue}if(c==="}"){const g=H[H.length-1];if(t.nobrace===!0||!g){T({type:"text",value:c,output:c});continue}let R=")";if(g.dots===!0){const V=n.slice(),re=[];for(let J=V.length-1;J>=0&&(n.pop(),V[J].type!=="brace");J--)V[J].type!=="dots"&&re.unshift(V[J].value);R=Wi(re,t),d.backtrack=!0}if(g.comma!==!0&&g.dots!==!0){const V=d.output.slice(0,g.outputIndex),re=d.tokens.slice(g.tokensIndex);g.value=g.output="\\{",c=R="\\}",d.output=V;for(const J of re)d.output+=J.output||J.value}T({type:"brace",value:c,output:R}),Ce("braces"),H.pop();continue}if(c==="|"){L.length>0&&L[L.length-1].conditions++,T({type:"text",value:c});continue}if(c===","){let g=c;const R=H[H.length-1];R&&se[se.length-1]==="braces"&&(R.comma=!0,g="|"),T({type:"comma",value:c,output:g});continue}if(c==="/"){if(h.type==="dot"&&d.index===d.start+1){d.start=d.index+1,d.consumed="",d.output="",n.pop(),h=s;continue}T({type:"slash",value:c,output:m});continue}if(c==="."){if(d.braces>0&&h.type==="dot"){h.value==="."&&(h.output=D);const g=H[H.length-1];h.type="dots",h.output+=c,h.value+=c,g.dots=!0;continue}if(d.braces+d.parens===0&&h.type!=="bos"&&h.type!=="slash"){T({type:"text",value:c,output:D});continue}T({type:"dot",value:c,output:D});continue}if(c==="?"){if(!(h&&h.value==="(")&&t.noextglob!==!0&&O()==="("&&O(2)!=="?"){He("qmark",c);continue}if(h&&h.type==="paren"){const R=O();let V=c;if(R==="<"&&!X.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(h.value==="("&&!/[!=<:]/.test(R)||R==="<"&&!/<([!=]|\w+>)/.test(Y()))&&(V=`\\${c}`),T({type:"text",value:c,output:V});continue}if(t.dot!==!0&&(h.type==="slash"||h.type==="bos")){T({type:"qmark",value:c,output:x});continue}T({type:"qmark",value:c,output:S});continue}if(c==="!"){if(t.noextglob!==!0&&O()==="("&&(O(2)!=="?"||!/[!=<:]/.test(O(3)))){He("negate",c);continue}if(t.nonegate!==!0&&d.index===0){et();continue}}if(c==="+"){if(t.noextglob!==!0&&O()==="("&&O(2)!=="?"){He("plus",c);continue}if(h&&h.value==="("||t.regex===!1){T({type:"plus",value:c,output:B});continue}if(h&&(h.type==="bracket"||h.type==="paren"||h.type==="brace")||d.parens>0){T({type:"plus",value:c});continue}T({type:"plus",value:B});continue}if(c==="@"){if(t.noextglob!==!0&&O()==="("&&O(2)!=="?"){T({type:"at",extglob:!0,value:c,output:""});continue}T({type:"text",value:c});continue}if(c!=="*"){(c==="$"||c==="^")&&(c=`\\${c}`);const g=Mi.exec(Y());g&&(c+=g[0],d.index+=g[0].length),T({type:"text",value:c});continue}if(h&&(h.type==="globstar"||h.star===!0)){h.type="star",h.star=!0,h.value+=c,h.output=K,d.backtrack=!0,d.globstar=!0,te(c);continue}let F=Y();if(t.noextglob!==!0&&/^\([^?]/.test(F)){He("star",c);continue}if(h.type==="star"){if(t.noglobstar===!0){te(c);continue}const g=h.prev,R=g.prev,V=g.type==="slash"||g.type==="bos",re=R&&(R.type==="star"||R.type==="globstar");if(t.bash===!0&&(!V||F[0]&&F[0]!=="/")){T({type:"star",value:c,output:""});continue}const J=d.braces>0&&(g.type==="comma"||g.type==="brace"),su=L.length&&(g.type==="pipe"||g.type==="paren");if(!V&&g.type!=="paren"&&!J&&!su){T({type:"star",value:c,output:""});continue}for(;F.slice(0,3)==="/**";){const Et=u[d.index+4];if(Et&&Et!=="/")break;F=F.slice(3),te("/**",3)}if(g.type==="bos"&&Z()){h.type="globstar",h.value+=c,h.output=N(t),d.output=h.output,d.globstar=!0,te(c);continue}if(g.type==="slash"&&g.prev.type!=="bos"&&!re&&Z()){d.output=d.output.slice(0,-(g.output+h.output).length),g.output=`(?:${g.output}`,h.type="globstar",h.output=N(t)+(t.strictSlashes?")":"|$)"),h.value+=c,d.globstar=!0,d.output+=g.output+h.output,te(c);continue}if(g.type==="slash"&&g.prev.type!=="bos"&&F[0]==="/"){const Et=F[1]!==void 0?"|$":"";d.output=d.output.slice(0,-(g.output+h.output).length),g.output=`(?:${g.output}`,h.type="globstar",h.output=`${N(t)}${m}|${m}${Et})`,h.value+=c,d.output+=g.output+h.output,d.globstar=!0,te(c+ie()),T({type:"slash",value:"/",output:""});continue}if(g.type==="bos"&&F[0]==="/"){h.type="globstar",h.value+=c,h.output=`(?:^|${m}|${N(t)}${m})`,d.output=h.output,d.globstar=!0,te(c+ie()),T({type:"slash",value:"/",output:""});continue}d.output=d.output.slice(0,-h.output.length),h.type="globstar",h.output=N(t),h.value+=c,d.output+=h.output,d.globstar=!0,te(c);continue}const z={type:"star",value:c,output:K};if(t.bash===!0){z.output=".*?",(h.type==="bos"||h.type==="slash")&&(z.output=v+z.output),T(z);continue}if(h&&(h.type==="bracket"||h.type==="paren")&&t.regex===!0){z.output=c,T(z);continue}(d.index===d.start||h.type==="slash"||h.type==="dot")&&(h.type==="dot"?(d.output+=C,h.output+=C):t.dot===!0?(d.output+=w,h.output+=w):(d.output+=v,h.output+=v),O()!=="*"&&(d.output+=y,h.output+=y)),T(z)}for(;d.brackets>0;){if(t.strictBrackets===!0)throw new SyntaxError(Ge("closing","]"));d.output=X.escapeLast(d.output,"["),Ce("brackets")}for(;d.parens>0;){if(t.strictBrackets===!0)throw new SyntaxError(Ge("closing",")"));d.output=X.escapeLast(d.output,"("),Ce("parens")}for(;d.braces>0;){if(t.strictBrackets===!0)throw new SyntaxError(Ge("closing","}"));d.output=X.escapeLast(d.output,"{"),Ce("braces")}if(t.strictSlashes!==!0&&(h.type==="star"||h.type==="bracket")&&T({type:"maybe_slash",value:"",output:`${m}?`}),d.backtrack===!0){d.output="";for(const F of d.tokens)d.output+=F.output!=null?F.output:F.value,F.suffix&&(d.output+=F.suffix)}return d};Mu.fastpaths=(u,e)=>{const t=Me({},e),r=typeof t.maxLength=="number"?Math.min(at,t.maxLength):at,i=u.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);u=Nu[u]||u;const s=X.isWindows(e),{DOT_LITERAL:n,SLASH_LITERAL:a,ONE_CHAR:o,DOTS_SLASH:l,NO_DOT:f,NO_DOTS:D,NO_DOTS_SLASH:B,STAR:m,START_ANCHOR:y}=Pe.globChars(s),A=t.dot?D:f,E=t.dot?B:f,C=t.capture?"":"?:",w={negated:!1,prefix:""};let S=t.bash===!0?".*?":m;t.capture&&(S=`(${S})`);const x=v=>v.noglobstar===!0?S:`(${C}(?:(?!${y}${v.dot?l:n}).)*?)`,b=v=>{switch(v){case"*":return`${A}${o}${S}`;case".*":return`${n}${o}${S}`;case"*.*":return`${A}${S}${n}${o}${S}`;case"*/*":return`${A}${S}${a}${o}${E}${S}`;case"**":return A+x(t);case"**/*":return`(?:${A}${x(t)}${a})?${E}${o}${S}`;case"**/*.*":return`(?:${A}${x(t)}${a})?${E}${S}${n}${o}${S}`;case"**/.*":return`(?:${A}${x(t)}${a})?${n}${o}${S}`;default:{const $=/^(.*?)\.(\w+)$/.exec(v);if(!$)return;const K=b($[1]);return K?K+n+$[2]:void 0}}},I=X.removePrefix(u,w);let N=b(I);return N&&t.strictSlashes!==!0&&(N+=`${a}?`),N};var Wt=Mu;const zi=u=>u&&typeof u=="object"&&!Array.isArray(u),G=(u,e,t=!1)=>{if(Array.isArray(u)){const f=u.map(B=>G(B,e,t));return B=>{for(const m of f){const y=m(B);if(y)return y}return!1}}const r=zi(u)&&u.tokens&&u.input;if(u===""||typeof u!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");const i=e||{},s=X.isWindows(e),n=r?G.compileRe(u,e):G.makeRe(u,e,!1,!0),a=n.state;delete n.state;let o=()=>!1;if(i.ignore){const f=rt(Me({},e),{ignore:null,onMatch:null,onResult:null});o=G(i.ignore,f,t)}const l=(f,D=!1)=>{const{isMatch:B,match:m,output:y}=G.test(f,n,e,{glob:u,posix:s}),A={glob:u,state:a,regex:n,posix:s,input:f,output:y,match:m,isMatch:B};return typeof i.onResult=="function"&&i.onResult(A),B===!1?(A.isMatch=!1,D?A:!1):o(f)?(typeof i.onIgnore=="function"&&i.onIgnore(A),A.isMatch=!1,D?A:!1):(typeof i.onMatch=="function"&&i.onMatch(A),D?A:!0)};return t&&(l.state=a),l};G.test=(u,e,t,{glob:r,posix:i}={})=>{if(typeof u!="string")throw new TypeError("Expected input to be a string");if(u==="")return{isMatch:!1,output:""};const s=t||{},n=s.format||(i?X.toPosixSlashes:null);let a=u===r,o=a&&n?n(u):u;return a===!1&&(o=n?n(u):u,a=o===r),(a===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?a=G.matchBase(u,e,t,i):a=e.exec(o)),{isMatch:Boolean(a),match:a,output:o}},G.matchBase=(u,e,t,r=X.isWindows(t))=>(e instanceof RegExp?e:G.makeRe(e,t)).test($t.basename(u)),G.isMatch=(u,e,t)=>G(e,t)(u),G.parse=(u,e)=>Array.isArray(u)?u.map(t=>G.parse(t,e)):Wt(u,rt(Me({},e),{fastpaths:!1})),G.scan=(u,e)=>Ii(u,e),G.compileRe=(u,e,t=!1,r=!1)=>{if(t===!0)return u.output;const i=e||{},s=i.contains?"":"^",n=i.contains?"":"$";let a=`${s}(?:${u.output})${n}`;u&&u.negated===!0&&(a=`^(?!${a}).*$`);const o=G.toRegex(a,e);return r===!0&&(o.state=u),o},G.makeRe=(u,e={},t=!1,r=!1)=>{if(!u||typeof u!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(u[0]==="."||u[0]==="*")&&(i.output=Wt.fastpaths(u,e)),i.output||(i=Wt(u,e)),G.compileRe(i,e,t,r)},G.toRegex=(u,e)=>{try{const t=e||{};return new RegExp(u,t.flags||(t.nocase?"i":""))}catch(t){if(e&&e.debug===!0)throw t;return/$^/}},G.constants=Pe;var Gi=G,Ui=Gi;function zt(u,e){return Array.isArray(e)?e.some(t=>zt(u,t)):Ui(e)(u)}function ot(u,e,t){var r,i;if(e===void 0)return;if(u.length===0)return t(e);if(typeof e!="object"||e===null)return;const s=u.shift();if(s==="**"){for(;u.length>0&&u[0]==="*";)u.shift();const n=["**",...u].join("/"),a=new Set;ju("",e,a);for(const o of a)zt(o,n)&&ot(o.split("/"),e,t)}else if(s.startsWith("*")){let n;s.length>=1&&(n=new RegExp((i=(r=s.match(/(\*{)(.+)(})/))==null?void 0:r[2])!=null?i:".*"));for(const a in e)n&&a.match(n)!==null&&ot([...u],e[a],t)}else ot(u,e[s],t)}function ju(u,e,t){for(const r in e)t.add(`${u}${r}`),typeof e[r]=="object"&&ju(`${u}${r}/`,e[r],t)}function Wu(u,e,t){const r=u.length===0||u==="/"?[]:u.split("/");return ot(r,e,t)}function Ki(u,e){let t=!1;for(const r of e)if(Wu(r,u,()=>t=!0),t)return!0;return!1}new TextEncoder;function he(u){if(typeof u!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(u))}function zu(u,e){for(var t="",r=0,i=-1,s=0,n,a=0;a<=u.length;++a){if(a<u.length)n=u.charCodeAt(a);else{if(n===47)break;n=47}if(n===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var o=t.lastIndexOf("/");if(o!==t.length-1){o===-1?(t="",r=0):(t=t.slice(0,o),r=t.length-1-t.lastIndexOf("/")),i=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+u.slice(i+1,a):t=u.slice(i+1,a),r=a-i-1;i=a,s=0}else n===46&&s!==-1?++s:s=-1}return t}function Vi(u,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+u+r:r}var Ue={resolve:function(){for(var e="",t=!1,r,i=arguments.length-1;i>=-1&&!t;i--){var s;i>=0?s=arguments[i]:(r===void 0&&(r=process.cwd()),s=r),he(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=zu(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(he(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=zu(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return he(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];he(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":Ue.normalize(e)},relative:function(e,t){if(he(e),he(t),e===t||(e=Ue.resolve(e),t=Ue.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var i=e.length,s=i-r,n=1;n<t.length&&t.charCodeAt(n)===47;++n);for(var a=t.length,o=a-n,l=s<o?s:o,f=-1,D=0;D<=l;++D){if(D===l){if(o>l){if(t.charCodeAt(n+D)===47)return t.slice(n+D+1);if(D===0)return t.slice(n+D)}else s>l&&(e.charCodeAt(r+D)===47?f=D:D===0&&(f=0));break}var B=e.charCodeAt(r+D),m=t.charCodeAt(n+D);if(B!==m)break;B===47&&(f=D)}var y="";for(D=r+f+1;D<=i;++D)(D===i||e.charCodeAt(D)===47)&&(y.length===0?y+="..":y+="/..");return y.length>0?y+t.slice(n+f):(n+=f,t.charCodeAt(n)===47&&++n,t.slice(n))},_makeLong:function(e){return e},dirname:function(e){if(he(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,i=-1,s=!0,n=e.length-1;n>=1;--n)if(t=e.charCodeAt(n),t===47){if(!s){i=n;break}}else s=!1;return i===-1?r?"/":".":r&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');he(e);var r=0,i=-1,s=!0,n;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,o=-1;for(n=e.length-1;n>=0;--n){var l=e.charCodeAt(n);if(l===47){if(!s){r=n+1;break}}else o===-1&&(s=!1,o=n+1),a>=0&&(l===t.charCodeAt(a)?--a===-1&&(i=n):(a=-1,i=o))}return r===i?i=o:i===-1&&(i=e.length),e.slice(r,i)}else{for(n=e.length-1;n>=0;--n)if(e.charCodeAt(n)===47){if(!s){r=n+1;break}}else i===-1&&(s=!1,i=n+1);return i===-1?"":e.slice(r,i)}},extname:function(e){he(e);for(var t=-1,r=0,i=-1,s=!0,n=0,a=e.length-1;a>=0;--a){var o=e.charCodeAt(a);if(o===47){if(!s){r=a+1;break}continue}i===-1&&(s=!1,i=a+1),o===46?t===-1?t=a:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Vi("/",e)},parse:function(e){he(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),i=r===47,s;i?(t.root="/",s=1):s=0;for(var n=-1,a=0,o=-1,l=!0,f=e.length-1,D=0;f>=s;--f){if(r=e.charCodeAt(f),r===47){if(!l){a=f+1;break}continue}o===-1&&(l=!1,o=f+1),r===46?n===-1?n=f:D!==1&&(D=1):n!==-1&&(D=-1)}return n===-1||o===-1||D===0||D===1&&n===o-1&&n===a+1?o!==-1&&(a===0&&i?t.base=t.name=e.slice(1,o):t.base=t.name=e.slice(a,o)):(a===0&&i?(t.name=e.slice(1,n),t.base=e.slice(1,o)):(t.name=e.slice(a,n),t.base=e.slice(a,o)),t.ext=e.slice(n,o)),a>0?t.dir=e.slice(0,a-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Ue.posix=Ue;var oe=Ue,Ji=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,Xi=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,qi=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Gt={Space_Separator:Ji,ID_Start:Xi,ID_Continue:qi},U={isSpaceSeparator(u){return typeof u=="string"&&Gt.Space_Separator.test(u)},isIdStartChar(u){return typeof u=="string"&&(u>="a"&&u<="z"||u>="A"&&u<="Z"||u==="$"||u==="_"||Gt.ID_Start.test(u))},isIdContinueChar(u){return typeof u=="string"&&(u>="a"&&u<="z"||u>="A"&&u<="Z"||u>="0"&&u<="9"||u==="$"||u==="_"||u==="\u200C"||u==="\u200D"||Gt.ID_Continue.test(u))},isDigit(u){return typeof u=="string"&&/[0-9]/.test(u)},isHexDigit(u){return typeof u=="string"&&/[0-9A-Fa-f]/.test(u)}};let Ut,ue,Ee,lt,Se,le,q,Kt,qe;var Qi=function(e,t){Ut=String(e),ue="start",Ee=[],lt=0,Se=1,le=0,q=void 0,Kt=void 0,qe=void 0;do q=Zi(),tn[ue]();while(q.type!=="eof");return typeof t=="function"?Gu({"":qe},"",t):qe};function Gu(u,e,t){const r=u[e];if(r!=null&&typeof r=="object")for(const i in r){const s=Gu(r,i,t);s===void 0?delete r[i]:r[i]=s}return t.call(u,e,r)}let k,_,Qe,ye,P;function Zi(){for(k="default",_="",Qe=!1,ye=1;;){P=me();const u=Uu[k]();if(u)return u}}function me(){if(Ut[lt])return String.fromCodePoint(Ut.codePointAt(lt))}function p(){const u=me();return u===`
`?(Se++,le=0):u?le+=u.length:le++,u&&(lt+=u.length),u}const Uu={default(){switch(P){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":p();return;case"/":p(),k="comment";return;case void 0:return p(),M("eof")}if(U.isSpaceSeparator(P)){p();return}return Uu[ue]()},comment(){switch(P){case"*":p(),k="multiLineComment";return;case"/":p(),k="singleLineComment";return}throw j(p())},multiLineComment(){switch(P){case"*":p(),k="multiLineCommentAsterisk";return;case void 0:throw j(p())}p()},multiLineCommentAsterisk(){switch(P){case"*":p();return;case"/":p(),k="default";return;case void 0:throw j(p())}p(),k="multiLineComment"},singleLineComment(){switch(P){case`
`:case"\r":case"\u2028":case"\u2029":p(),k="default";return;case void 0:return p(),M("eof")}p()},value(){switch(P){case"{":case"[":return M("punctuator",p());case"n":return p(),$e("ull"),M("null",null);case"t":return p(),$e("rue"),M("boolean",!0);case"f":return p(),$e("alse"),M("boolean",!1);case"-":case"+":p()==="-"&&(ye=-1),k="sign";return;case".":_=p(),k="decimalPointLeading";return;case"0":_=p(),k="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":_=p(),k="decimalInteger";return;case"I":return p(),$e("nfinity"),M("numeric",1/0);case"N":return p(),$e("aN"),M("numeric",NaN);case'"':case"'":Qe=p()==='"',_="",k="string";return}throw j(p())},identifierNameStartEscape(){if(P!=="u")throw j(p());p();const u=Vt();switch(u){case"$":case"_":break;default:if(!U.isIdStartChar(u))throw Ku();break}_+=u,k="identifierName"},identifierName(){switch(P){case"$":case"_":case"\u200C":case"\u200D":_+=p();return;case"\\":p(),k="identifierNameEscape";return}if(U.isIdContinueChar(P)){_+=p();return}return M("identifier",_)},identifierNameEscape(){if(P!=="u")throw j(p());p();const u=Vt();switch(u){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!U.isIdContinueChar(u))throw Ku();break}_+=u,k="identifierName"},sign(){switch(P){case".":_=p(),k="decimalPointLeading";return;case"0":_=p(),k="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":_=p(),k="decimalInteger";return;case"I":return p(),$e("nfinity"),M("numeric",ye*(1/0));case"N":return p(),$e("aN"),M("numeric",NaN)}throw j(p())},zero(){switch(P){case".":_+=p(),k="decimalPoint";return;case"e":case"E":_+=p(),k="decimalExponent";return;case"x":case"X":_+=p(),k="hexadecimal";return}return M("numeric",ye*0)},decimalInteger(){switch(P){case".":_+=p(),k="decimalPoint";return;case"e":case"E":_+=p(),k="decimalExponent";return}if(U.isDigit(P)){_+=p();return}return M("numeric",ye*Number(_))},decimalPointLeading(){if(U.isDigit(P)){_+=p(),k="decimalFraction";return}throw j(p())},decimalPoint(){switch(P){case"e":case"E":_+=p(),k="decimalExponent";return}if(U.isDigit(P)){_+=p(),k="decimalFraction";return}return M("numeric",ye*Number(_))},decimalFraction(){switch(P){case"e":case"E":_+=p(),k="decimalExponent";return}if(U.isDigit(P)){_+=p();return}return M("numeric",ye*Number(_))},decimalExponent(){switch(P){case"+":case"-":_+=p(),k="decimalExponentSign";return}if(U.isDigit(P)){_+=p(),k="decimalExponentInteger";return}throw j(p())},decimalExponentSign(){if(U.isDigit(P)){_+=p(),k="decimalExponentInteger";return}throw j(p())},decimalExponentInteger(){if(U.isDigit(P)){_+=p();return}return M("numeric",ye*Number(_))},hexadecimal(){if(U.isHexDigit(P)){_+=p(),k="hexadecimalInteger";return}throw j(p())},hexadecimalInteger(){if(U.isHexDigit(P)){_+=p();return}return M("numeric",ye*Number(_))},string(){switch(P){case"\\":p(),_+=Yi();return;case'"':if(Qe)return p(),M("string",_);_+=p();return;case"'":if(!Qe)return p(),M("string",_);_+=p();return;case`
`:case"\r":throw j(p());case"\u2028":case"\u2029":un(P);break;case void 0:throw j(p())}_+=p()},start(){switch(P){case"{":case"[":return M("punctuator",p())}k="value"},beforePropertyName(){switch(P){case"$":case"_":_=p(),k="identifierName";return;case"\\":p(),k="identifierNameStartEscape";return;case"}":return M("punctuator",p());case'"':case"'":Qe=p()==='"',k="string";return}if(U.isIdStartChar(P)){_+=p(),k="identifierName";return}throw j(p())},afterPropertyName(){if(P===":")return M("punctuator",p());throw j(p())},beforePropertyValue(){k="value"},afterPropertyValue(){switch(P){case",":case"}":return M("punctuator",p())}throw j(p())},beforeArrayValue(){if(P==="]")return M("punctuator",p());k="value"},afterArrayValue(){switch(P){case",":case"]":return M("punctuator",p())}throw j(p())},end(){throw j(p())}};function M(u,e){return{type:u,value:e,line:Se,column:le}}function $e(u){for(const e of u){if(me()!==e)throw j(p());p()}}function Yi(){switch(me()){case"b":return p(),"\b";case"f":return p(),"\f";case"n":return p(),`
`;case"r":return p(),"\r";case"t":return p(),"	";case"v":return p(),"\v";case"0":if(p(),U.isDigit(me()))throw j(p());return"\0";case"x":return p(),en();case"u":return p(),Vt();case`
`:case"\u2028":case"\u2029":return p(),"";case"\r":return p(),me()===`
`&&p(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw j(p());case void 0:throw j(p())}return p()}function en(){let u="",e=me();if(!U.isHexDigit(e)||(u+=p(),e=me(),!U.isHexDigit(e)))throw j(p());return u+=p(),String.fromCodePoint(parseInt(u,16))}function Vt(){let u="",e=4;for(;e-- >0;){const t=me();if(!U.isHexDigit(t))throw j(p());u+=p()}return String.fromCodePoint(parseInt(u,16))}const tn={start(){if(q.type==="eof")throw Oe();Jt()},beforePropertyName(){switch(q.type){case"identifier":case"string":Kt=q.value,ue="afterPropertyName";return;case"punctuator":ct();return;case"eof":throw Oe()}},afterPropertyName(){if(q.type==="eof")throw Oe();ue="beforePropertyValue"},beforePropertyValue(){if(q.type==="eof")throw Oe();Jt()},beforeArrayValue(){if(q.type==="eof")throw Oe();if(q.type==="punctuator"&&q.value==="]"){ct();return}Jt()},afterPropertyValue(){if(q.type==="eof")throw Oe();switch(q.value){case",":ue="beforePropertyName";return;case"}":ct()}},afterArrayValue(){if(q.type==="eof")throw Oe();switch(q.value){case",":ue="beforeArrayValue";return;case"]":ct()}},end(){}};function Jt(){let u;switch(q.type){case"punctuator":switch(q.value){case"{":u={};break;case"[":u=[];break}break;case"null":case"boolean":case"numeric":case"string":u=q.value;break}if(qe===void 0)qe=u;else{const e=Ee[Ee.length-1];Array.isArray(e)?e.push(u):e[Kt]=u}if(u!==null&&typeof u=="object")Ee.push(u),Array.isArray(u)?ue="beforeArrayValue":ue="beforePropertyName";else{const e=Ee[Ee.length-1];e==null?ue="end":Array.isArray(e)?ue="afterArrayValue":ue="afterPropertyValue"}}function ct(){Ee.pop();const u=Ee[Ee.length-1];u==null?ue="end":Array.isArray(u)?ue="afterArrayValue":ue="afterPropertyValue"}function j(u){return ft(u===void 0?`JSON5: invalid end of input at ${Se}:${le}`:`JSON5: invalid character '${Vu(u)}' at ${Se}:${le}`)}function Oe(){return ft(`JSON5: invalid end of input at ${Se}:${le}`)}function Ku(){return le-=5,ft(`JSON5: invalid identifier character at ${Se}:${le}`)}function un(u){console.warn(`JSON5: '${Vu(u)}' in strings is not valid ECMAScript; consider escaping`)}function Vu(u){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[u])return e[u];if(u<" "){const t=u.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return u}function ft(u){const e=new SyntaxError(u);return e.lineNumber=Se,e.columnNumber=le,e}var rn=function(e,t,r){const i=[];let s="",n,a,o="",l;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(r=t.space,l=t.quote,t=t.replacer),typeof t=="function")a=t;else if(Array.isArray(t)){n=[];for(const A of t){let E;typeof A=="string"?E=A:(typeof A=="number"||A instanceof String||A instanceof Number)&&(E=String(A)),E!==void 0&&n.indexOf(E)<0&&n.push(E)}}return r instanceof Number?r=Number(r):r instanceof String&&(r=String(r)),typeof r=="number"?r>0&&(r=Math.min(10,Math.floor(r)),o="          ".substr(0,r)):typeof r=="string"&&(o=r.substr(0,10)),f("",{"":e});function f(A,E){let C=E[A];switch(C!=null&&(typeof C.toJSON5=="function"?C=C.toJSON5(A):typeof C.toJSON=="function"&&(C=C.toJSON(A))),a&&(C=a.call(E,A,C)),C instanceof Number?C=Number(C):C instanceof String?C=String(C):C instanceof Boolean&&(C=C.valueOf()),C){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof C=="string")return D(C);if(typeof C=="number")return String(C);if(typeof C=="object")return Array.isArray(C)?y(C):B(C)}function D(A){const E={"'":.1,'"':.2},C={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let w="";for(let x=0;x<A.length;x++){const b=A[x];switch(b){case"'":case'"':E[b]++,w+=b;continue;case"\0":if(U.isDigit(A[x+1])){w+="\\x00";continue}}if(C[b]){w+=C[b];continue}if(b<" "){let I=b.charCodeAt(0).toString(16);w+="\\x"+("00"+I).substring(I.length);continue}w+=b}const S=l||Object.keys(E).reduce((x,b)=>E[x]<E[b]?x:b);return w=w.replace(new RegExp(S,"g"),C[S]),S+w+S}function B(A){if(i.indexOf(A)>=0)throw TypeError("Converting circular structure to JSON5");i.push(A);let E=s;s=s+o;let C=n||Object.keys(A),w=[];for(const x of C){const b=f(x,A);if(b!==void 0){let I=m(x)+":";o!==""&&(I+=" "),I+=b,w.push(I)}}let S;if(w.length===0)S="{}";else{let x;if(o==="")x=w.join(","),S="{"+x+"}";else{let b=`,
`+s;x=w.join(b),S=`{
`+s+x+`,
`+E+"}"}}return i.pop(),s=E,S}function m(A){if(A.length===0)return D(A);const E=String.fromCodePoint(A.codePointAt(0));if(!U.isIdStartChar(E))return D(A);for(let C=E.length;C<A.length;C++)if(!U.isIdContinueChar(String.fromCodePoint(A.codePointAt(C))))return D(A);return A}function y(A){if(i.indexOf(A)>=0)throw TypeError("Converting circular structure to JSON5");i.push(A);let E=s;s=s+o;let C=[];for(let S=0;S<A.length;S++){const x=f(String(S),A);C.push(x!==void 0?x:"null")}let w;if(C.length===0)w="[]";else if(o===""){let S=C.join(",");w="["+S+"]"}else{let S=`,
`+s,x=C.join(S);w=`[
`+s+x+`,
`+E+"]"}return i.pop(),s=E,w}},Dt={parse:Qi,stringify:rn};const Xt={behaviorPack:"./BP",resourcePack:"./RP",skinPack:"./SP",worldTemplate:"./WT"};class nn{constructor(e){this.basePath=e,this.data={}}async refreshConfig(){this.data=await this.readConfig()}async setup(){await this.refreshConfig()}get(){return this.data}getRelativePackRoot(e){var t,r;return(r=(t=this.data.packs)==null?void 0:t[e])!=null?r:Xt[e]}getAbsolutePackRoot(e){return this.resolvePackPath(e)}resolvePackPath(e,t){return!t&&!e?this.basePath:!e&&t?oe.join(this.basePath,t):!t&&e?oe.join(this.basePath,this.getRelativePackRoot(e)):oe.join(this.basePath,`${this.getRelativePackRoot(e)}/${t}`)}getAvailablePackPaths(){var e;const t=[];for(const r of Object.keys((e=this.data.packs)!=null?e:{}))t.push(this.resolvePackPath(r));return t}getAvailablePacks(){var e;const t={};for(const r in(e=this.data.packs)!=null?e:{})t[r]=this.resolvePackPath(r);return t}async save(){await this.writeConfig(this.data)}}class sn{constructor(e){this.projectConfig=e,this.packTypes=[],this.extensionPackTypes=new Set}setProjectConfig(e){this.projectConfig=e}get all(){return this.packTypes.concat(...Array.from(this.extensionPackTypes.values()))}getFromId(e){return this.all.find(t=>t.id===e)}get(e){var t,r;const i=(r=(t=this.projectConfig)==null?void 0:t.getAvailablePacks())!=null?r:Xt;for(const s in i)if(e.startsWith(i[s]))return this.getFromId(s)}getId(e){var t,r;return(r=(t=this.get(e))==null?void 0:t.id)!=null?r:"unknown"}addExtensionPackType(e){return this.extensionPackTypes.add(e),{dispose:()=>this.extensionPackTypes.delete(e)}}}class an{constructor(e,t){this.projectConfig=e,this.isMatch=t,this.pluginFileTypes=new Set,this._fileTypes=[]}get fileTypes(){return this._fileTypes}set fileTypes(e){this._fileTypes=e.sort((t,r)=>t.add==="post"&&r.add!=="post"?1:t.add!=="post"&&r.add==="post"||t.add==="pre"&&r.add!=="pre"?-1:t.add!=="pre"&&r.add==="pre"?1:0)}get all(){return this.fileTypes.concat([...this.pluginFileTypes.values()])}setProjectConfig(e){this.projectConfig=e}addPluginFileType(e){return this.pluginFileTypes.add(e),{dispose:()=>this.pluginFileTypes.delete(e)}}getPluginFileTypes(){return[...this.pluginFileTypes.values()]}setPluginFileTypes(e=[]){this.pluginFileTypes.clear(),e.forEach(t=>this.pluginFileTypes.add(t))}get(e,t,r=!0){var i,s,n,a,o,l,f,D,B,m,y,A,E;const C=e?oe.extname(e):null;if(!!C)for(const w of this.all){if(t!==void 0&&t===w.id)return w;if(!e)continue;const S=((i=w.detect)==null?void 0:i.packType)===void 0?[]:Array.isArray((s=w.detect)==null?void 0:s.packType)?(n=w.detect)==null?void 0:n.packType:[(a=w.detect)==null?void 0:a.packType],x=(o=w.detect)==null?void 0:o.fileExtensions,b=!!((l=w.detect)!=null&&l.scope),I=Array.isArray((f=w.detect)==null?void 0:f.scope)?(D=w.detect)==null?void 0:D.scope:[(B=w.detect)==null?void 0:B.scope],N=!!((m=w.detect)!=null&&m.matcher),v=Array.isArray((y=w.detect)==null?void 0:y.matcher)?(A=w.detect)==null?void 0:A.matcher:[(E=w.detect)==null?void 0:E.matcher];if(!(r&&x&&!x.includes(C)))if(b){if(this.prefixMatchers(S,I).some($=>e.startsWith($)))return w}else if(N){const $=this.prefixMatchers(S,v.filter(d=>!d.startsWith("!"))),K=this.prefixMatchers(S,v.filter(d=>d.startsWith("!")).map(d=>d.slice(1)));if(this.isMatch(e,$)&&!this.isMatch(e,K))return w}else throw console.log(w),new Error('Invalid file definition, no "detect" properties')}}prefixMatchers(e,t){if(!this.projectConfig)return[];if(e.length===0)return t.map(i=>this.projectConfig.resolvePackPath(void 0,i));const r=[];for(const i of e)for(const s of t)r.push(this.projectConfig.resolvePackPath(i,s));return r}getIds(){const e=[];for(const t of this.all)e.push(t.id);return e}async guessFolder(e){var t;const r=(f,D)=>{var B,m;let y=Array.isArray(f)?f[0]:f;y.endsWith("/")||(y+="/");const A=(m=(B=this.projectConfig)==null?void 0:B.getAbsolutePackRoot(D))!=null?m:"./unknown";return oe.join(A,y)},i=`.${e.name.split(".").pop()}`,s=this.all.filter(({detect:f})=>{var D;return!f||!f.scope?!1:(D=f.fileExtensions)==null?void 0:D.includes(i)}),n=s.length===1,a=i!==".json"&&s.length>0;if(n||a){const{detect:f}=s[0];return r(f.scope,Array.isArray(f.packType)?f.packType[0]:(t=f.packType)!=null?t:"behaviorPack")}if(i!==".json")return null;const o=await e.getFile();let l;try{l=Dt.parse(await o.text())}catch{return null}for(const{type:f,detect:D}of s){if(typeof f=="string"&&f!=="json")continue;const{scope:B,fileContent:m,packType:y="behaviorPack"}=D!=null?D:{};if(!(!B||!m)&&!!Ki(l,m))return r(B,Array.isArray(y)?y[0]:y)}return null}getId(e){var t,r;return(r=(t=this.get(e))==null?void 0:t.id)!=null?r:"unknown"}isJsonFile(e){var t,r;const i=(r=(t=this.get(e))==null?void 0:t.meta)==null?void 0:r.language;return i?i==="json":e.endsWith(".json")}}class on extends an{constructor(e){super(e,zt),this.ready=new Ne,this.lCacheFiles={},this.lCacheFilesLoaded=new Ne,this.packSpiderFiles={},this.packSpiderFilesLoaded=new Ne}setProjectConfig(e){this.projectConfig=e}async setup(e){this.fileTypes.length>0||(await e.fired,this.fileTypes=await e.readJSON("data/packages/minecraftBedrock/fileDefinitions.json"),this.loadLightningCache(e),this.loadPackSpider(e),this.ready.dispatch())}getMonacoSchemaEntries(){return this.fileTypes.map(({detect:e={},schema:t})=>{if(!e.matcher)return null;const r=(e==null?void 0:e.packType)===void 0?[]:Array.isArray(e==null?void 0:e.packType)?e==null?void 0:e.packType:[e==null?void 0:e.packType];return{fileMatch:this.prefixMatchers(r,Array.isArray(e.matcher)?[...e.matcher]:[e.matcher]).map(i=>encodeURI(i).replaceAll(/;|,|@|&|=|\+|\$|\.|!|'|\(|\)|#/g,"*")),uri:t}}).filter(e=>e!==null).flat()}async loadLightningCache(e){var i;const t=await e.readJSON("data/packages/minecraftBedrock/lightningCaches.json"),r=s=>Object.entries(t).find(([n])=>n.endsWith(s));for(const s of this.fileTypes){if(!s.lightningCache)continue;const[n,a]=(i=r(s.lightningCache))!=null?i:[];if(!n)throw new Error(`Lightning cache file "${s.lightningCache}" for file type "${s.id}" not found`);this.lCacheFiles[s.lightningCache]=a}this.lCacheFilesLoaded.dispatch()}async getLightningCache(e){var r,i;const{lightningCache:t}=(r=this.get(e))!=null?r:{};return t?(await this.lCacheFilesLoaded.fired,(i=this.lCacheFiles[t])!=null?i:[]):[]}async loadPackSpider(e){const t=await e.readJSON("data/packages/minecraftBedrock/packSpiders.json");this.packSpiderFiles=Object.fromEntries(this.fileTypes.map(({id:r,packSpider:i})=>{if(!!i)return[r,t[`file:///data/packages/minecraftBedrock/packSpider/${i}`]]}).filter(r=>r!==void 0)),this.packSpiderFilesLoaded.dispatch()}async getPackSpiderData(){return await this.packSpiderFilesLoaded.fired,this.packSpiderFiles}}class ln{constructor(e,t,r){this.taskService=e,this.current=t,this.total=r}addToCurrent(e){this.current+=e!=null?e:1,this.taskService.dispatch([this.getCurrent(),this.getTotal()])}addToTotal(e){this.total+=e!=null?e:1,this.taskService.dispatch([this.getCurrent(),this.getTotal()])}getTotal(){return this.total}getCurrent(){return this.current}setTotal(e){this.total=e}}class cn extends Du{constructor(){super(...arguments),this.lastDispatch=0}async start(e){this.progress=new ln(this,0,0);const t=await this.onStart(e);return this.dispatch([this.progress.getCurrent(),this.progress.getCurrent()]),t}dispatch(e){this.lastDispatch+200>Date.now()||(super.dispatch(e),this.lastDispatch=Date.now())}}const Ju=oe.dirname,qt=oe.join,fn=oe.extname,Qt=oe.basename;oe.resolve,oe.relative;class Dn{constructor(e,t,r){this.fileType=t,this.projectPath=r,this._visitedFiles=0,this._totalFiles=0,this.fs=e}get visitedFiles(){return this._visitedFiles}get totalFiles(){return this._totalFiles}reset(){this.store={}}async setup(){var s,n;let e=[];try{e=(await this.fs.readFile(".bridge/.lightningCache").then(a=>a.text())).split(`
`)}catch{}if(this.store={},this._visitedFiles=0,this._totalFiles=0,e.length===0)return;let t=0;e[0].startsWith("$formatVersion: ")&&(t=Number((n=(s=e[0].match(/\d+/))==null?void 0:s[0])!=null?n:0),e.shift());const r=this.projectPath;let i="unknown";for(const a of e){if(a==="")continue;if(a[0]==="#"){i=a.slice(1),this.store[i]={};continue}let[o,l,f]=a.split("|");t===0&&(o=qt(r,o)),this._totalFiles++,this.store[i][o]={lastModified:Number(l),data:f?JSON.parse(f):void 0}}}async saveStore(e=!0){let t=`$formatVersion: 1
`;const r=[];for(const i in this.store){t+=`#${i}
`;for(const s in this.store[i]){const n=this.store[i][s];if(!n.isForeignFile){if(e&&!n.visited){r.push(s),delete this.store[i][s];continue}t+=`${s}|${n.lastModified}`,n.data?t+=`|${JSON.stringify(n.data)}
`:t+=`
`}}}return await this.fs.writeFile(".bridge/.lightningCache",t),r}add(e,{lastModified:t,data:r,isForeignFile:i},s=this.fileType.getId(e)){var n,a;this.store[s]||(this.store[s]={}),this._visitedFiles++,this.store[s][e]||this._totalFiles++,this.store[s][e]={visited:!0,lastModified:t,isForeignFile:i,data:r!=null?r:(a=(n=this.store[s])==null?void 0:n[e])==null?void 0:a.data}}remove(e,t=this.fileType.getId(e)){!this.store[t]||delete this.store[t][e]}rename(e,t){const r=/\.\w+$/.test(e);for(const i in this.store)for(const s in this.store[i])if(r&&s===e||!r&&s.startsWith(e)){const n=s.replace(e,t),a=this.fileType.getId(n);this.store[a][n]=this.store[i][s],delete this.store[i][s]}}setVisited(e,t,r=this.fileType.getId(e)){var i,s;this._visitedFiles++,(s=(i=this.store)==null?void 0:i[r])!=null&&s[e]&&(this.store[r][e].visited=t)}getLastModified(e,t=this.fileType.getId(e)){var r,i;return(i=(r=this.store[t])==null?void 0:r[e])==null?void 0:i.lastModified}find(e,t,r,i=!1){var a,o;if(!r||r.length===0)return[];const s=this.store[e],n=[];for(const l in s)if(((o=(a=s[l].data)==null?void 0:a[t])!=null?o:[]).find(D=>r.includes(D)))if(i)n.push(l);else return[l];return n}findMultiple(e,t,r,i=!1){const s=[];for(const n of e){const a=this.find(n,t,r,i);if(a.length>0&&!i)return a;s.push(...a)}return s}async forEach(e,t){const r=this.store[e],i=[];for(const s in r)i.push(t(s,r[s]));await Promise.all(i)}get(e,t=this.fileType.getId(e)){var r,i;return(i=(r=this.store[t])==null?void 0:r[e])!=null?i:{}}has(e,t=this.fileType.getId(e)){var r;return!!((r=this.store[t])!=null&&r[e])}allFiles(e){const t=[];if(e&&this.store)for(const r in this.store[e])this.store[e][r].isForeignFile||t.push(r);else for(const r in this.store)for(const i in this.store[r])this.store[r][i].isForeignFile||t.push(i);return t}getAllFrom(e,t){var i,s,n;const r={};for(const a in(i=this.store[e])!=null?i:{}){if(t&&t!==a)continue;const o=(n=((s=this.store[e][a])!=null?s:{}).data)!=null?n:{};for(const l in o)r[l]?r[l].push(...o[l]):r[l]=[...o[l]]}for(const a in r)r[a]=[...new Set(r[a])];return r}async getSchemasFor(e,t){const r=await this.getAllFrom(e,t),i=`file:///data/packages/minecraftBedrock/schema/${e}/dynamic`,s=[];for(const n in r)s.push({uri:`${i}/${t?"currentContext/":""}${n}Enum.json`,schema:{type:"string",enum:r[n]}}),s.push({uri:`${i}/${t?"currentContext/":""}${n}Property.json`,schema:{properties:Object.fromEntries(r[n].map(a=>[a,{}]))}});return s}getCacheDataFor(e,t,r){const i=this.getAllFrom(e,t);return typeof r=="string"?i[r]:i}}class hn{constructor(e,t){this.packIndexer=e,this.lightningStore=t,this.packSpiderFiles=new Map}get fileType(){return this.packIndexer.fileType}async setup(e){const t=await this.fileType.getPackSpiderData();for(const r in t){const i=t[r],s=this.lightningStore.allFiles(r);for(const n of s){const a=new dn({lightningStore:this.lightningStore,filePath:n,fileType:r,instructions:i});this.packSpiderFiles.set(n,a)}}}getDiagnostics(e){const t=this.packSpiderFiles.get(e);return t?t.provideDiagnostics():[]}getConnectedFiles(e){const t=this.packSpiderFiles.get(e);return t?[...t.loadAllConnected()]:[]}async updateFile(e){}}class dn{constructor({lightningStore:e,filePath:t,fileType:r,instructions:i}){this.dependencies=new Map,this.lightningStore=e,this.filePath=t,this.fileType=r,this.instructions=i}get cacheData(){var e;return(e=this.lightningStore.get(this.filePath).data)!=null?e:{}}loadAllConnected(){return new Set([...this.loadConnected(),...this.loadDirectReferences()])}loadDirectReferences(){var e,t;return new Set((t=(e=this.instructions.includeFiles)==null?void 0:e.map(r=>{var i;if(r)return(i=this.cacheData[r])!=null?i:[]}).flat())!=null?t:[])}loadConnected(e=this.instructions.connect){var r;const t=new Set;for(let{find:i,where:s,matches:n,shouldFindMultiple:a}of e!=null?e:[]){Array.isArray(i)||(i=[i]);const o=(r=this.cacheData[n])!=null?r:[],l=this.lightningStore.findMultiple(i,s,o,a!=null?a:!0);for(const f of l)f!==this.filePath&&t.add(f)}return t}provideDiagnostics(){var t;const e=[];for(let{if:r,...i}of(t=this.instructions.provideDiagnostics)!=null?t:[]){const s=this.loadConnected([r]);if(r.not){if(s.size>0)continue;e.push(i)}else{if(s.size===0)continue;e.push(i)}}return e}addDependency(e,t){this.dependencies.has(e)?this.dependencies.get(e).add(t):this.dependencies.set(e,new Set(t))}}function Zt(u){return pn(u)(...Object.values(u.env))}function pn({script:u,env:e,language:t,modules:r,async:i=!1}){if(t==="typeScript")throw new Error(`bridge.'s legacy script runner no longer supports TypeScript. Use "bridge-js-runner" instead.`);let s=An(u);if(r){const n=e.require;e.require=async a=>{if(r[a])return r[a];if(typeof n=="function")return await(n==null?void 0:n(a))}}try{return i?new Function(...Object.keys(e),`return (async () => {
${s}
})()`):new Function(...Object.keys(e),s)}catch(n){throw console.error(u),new Error(`Error within script: ${n}`)}}function An(u){return u.replace(/export default([ \(])/g,(e,t)=>`module.exports =${t}`).replace(/import\s+(\* as [a-z][a-z0-9]*|[a-z][a-z0-9]+|{[a-z\s][a-z0-9,\s]*})\s+from\s+["'](.+)["']/gi,(e,t,r)=>(t.startsWith("* as ")&&(t=t.replace("* as ","")),`const ${t} = await require('${r}')`))}function Cn(u){const e={exports:void 0};return Zt({script:u,env:{module:e}}),e.exports}async function gn(u,e,t){for(const r of t){const i=`${e}${r}`;if(await u.fileExists(i))return i}}function Fn(u,e){return{Bridge:{value:u,withExtension:(t,r)=>gn(e.fileSystem,t,r),resolvePackPath:(t,r)=>e.config.resolvePackPath(t,r)}}}const En=new Set([".js",".ts",".lang",".mcfunction",".txt",".molang",".html"]),Xu=[".bridge","builds",".git","worlds"];class yn{constructor(e,t){this.service=e,this.lightningStore=t,this.folderIgnoreList=new Set,this.totalTime=0}get fileType(){return this.service.fileType}async loadIgnoreFolders(){try{(await(await this.service.projectFileSystem.readFile(".bridge/.ignoreFolders")).text()).split(`
`).concat(Xu).forEach(t=>this.folderIgnoreList.add(t))}catch{Xu.forEach(e=>this.folderIgnoreList.add(e))}}async start(e){if(await this.lightningStore.setup(),this.folderIgnoreList.size===0&&await this.loadIgnoreFolders(),!e&&this.service.getOptions().noFullLightningCacheRefresh){const o=this.lightningStore.allFiles();if(o.length>0)return[o,[],[]]}let t=!1;const r=[],i=[],s=this.service.config.getAvailablePackPaths(),n=await Promise.all(s.map(async o=>[o,await this.service.fileSystem.getDirectoryHandle(o).catch(()=>{})]));for(const[o,l]of n){if(!l){console.warn(`Cannot index pack "${o}" because it does not exist`);continue}await this.iterateDir(l,async(f,D)=>{D=qt(o,D),await this.processFile(D,f)&&(t||(t=!0),i.push(D)),r.push(D),this.service.progress.addToCurrent()})}let a=[];return(t||this.lightningStore.visitedFiles!==this.lightningStore.totalFiles)&&(a=await this.lightningStore.saveStore()),[r,i,a]}async unlinkFile(e,t=!0){this.lightningStore.remove(e),t&&await this.lightningStore.saveStore(!1)}async iterateDir(e,t,r=""){for await(const[i,s]of e.entries()){const n=r.length===0?i:`${r}/${i}`;if(s.kind==="directory"){if(this.folderIgnoreList.has(n))continue;await this.iterateDir(s,t,n)}else i[0]!=="."&&(this.service.progress.addToTotal(2),await t(s,n))}}async processFile(e,t,r=!1){const i=typeof t=="string",s=i?new File([t],Qt(e)):await t.getFile(),n=this.fileType.getId(e);if(!s)throw new Error('Invalid call to "processFile": Either fileContent or fileHandle needs to be defined!');if(!i&&s.lastModified===this.lightningStore.getLastModified(e,n))return this.lightningStore.setVisited(e,!0,n),!1;const a=fn(e);return this.fileType.isJsonFile(e)?await this.processJSON(e,n,s,i?t:void 0,r):En.has(a)?await this.processText(e,n,s,r):this.lightningStore.add(e,{lastModified:s.lastModified,isForeignFile:r},n),!0}async processText(e,t,r,i){const s=await this.fileType.getLightningCache(e);if(typeof s=="string"){const n=Cn(s);if(typeof n=="function"){const a=n(await r.text(),{resolvePackPath:(o,l)=>this.service.config.resolvePackPath(o,l)});this.lightningStore.add(e,{lastModified:r.lastModified,isForeignFile:i,data:Object.keys(a).length>0?a:void 0},t)}}this.lightningStore.add(e,{lastModified:r.lastModified,isForeignFile:i},t)}async processJSON(e,t,r,i,s){const n=await this.fileType.getLightningCache(e);if(n.length===0||typeof n=="string"){this.lightningStore.add(e,{lastModified:r.lastModified,isForeignFile:s},t);return}const a=i!==void 0;i===void 0&&(i=await r.text()),i===""&&(i="{}");let o;try{o=Dt.parse(i)}catch(m){a||(console.error(`[${e}] ${m.message}`),this.lightningStore.add(e,{lastModified:r.lastModified,isForeignFile:s},t));return}const l={},f=(m,y,A)=>async E=>{let C;if(Array.isArray(E)?C=E:typeof E=="object"?C=Object.keys(E!=null?E:{}):C=[E],y&&(C=C.filter(w=>!y.includes(w))),A){const w={config:this.service.config,fileSystem:this.service.fileSystem};C=(await Promise.all(C.map(S=>Zt({async:!0,script:A,env:{...Fn(S,w)}})))).filter(S=>S!==void 0)}l[m]?l[m]=[...new Set(l[m].concat(C))]:l[m]=C},D=[],B=(m,y,A)=>E=>{D.push(f(m,y,A)(E))};for(const m of n){const y=m.cacheKey;if(!y)continue;let A=Array.isArray(m.path)?m.path:[m.path];const E=m.pathScript;if(E&&(A=Zt({script:E,env:{Bridge:{paths:A}}}),!Array.isArray(A)||A.length===0))return;for(const C of A)Wu(C,o,B(y,m.filter,m.script))}await Promise.all(D),this.lightningStore.add(e,{lastModified:r.lastModified,isForeignFile:s,data:Object.keys(l).length>0?l:void 0},t)}}async function Yt(u,e,t=new Set,r=""){for await(const i of u.values()){const s=r.length===0?i.name:`${r}/${i.name}`;if(i.kind==="file"){if(i.name[0]===".")continue;await e(i,s,u)}else i.kind==="directory"&&!t.has(s)&&await Yt(i,e,t,s)}}async function mn(){return typeof(await(await navigator.storage.getDirectory()).getFileHandle("bridge-supports-writable-test",{create:!0})).createWritable=="function"}async function qu(){var u;return typeof((u=navigator.storage)==null?void 0:u.getDirectory)!="function"||!await mn()?new ne(null,"bridgeFolder",void 0):await navigator.storage.getDirectory()}class Ke extends Ne{constructor(e){super(),e&&this.setup(e)}get baseDirectory(){return this._baseDirectory}setup(e){this._baseDirectory=e,this.hasFired||this.dispatch()}async getDirectoryHandle(e,{create:t,createOnce:r}={}){if(e===""||e===".")return this.baseDirectory;let i=this.baseDirectory;const s=e.split(/\\|\//g);s[0]==="."&&s.shift(),s[0]==="extensions"&&(s[0]="~local",s.splice(1,0,"extensions")),s[0]==="~local"&&(i=await qu(),s.shift());for(const n of s){try{i=await i.getDirectoryHandle(n,{create:r||t})}catch{throw new Error(`Failed to access "${e}": Directory does not exist`)}r&&(r=!1,t=!1)}return i}async getFileHandle(e,t=!1){if(e.length===0)throw new Error("Error: filePath is empty");const r=await this.getDirectoryHandle(Ju(e),{create:t});try{return await r.getFileHandle(Qt(e),{create:t})}catch{throw new Error(`File does not exist: "${e}"`)}}async pathTo(e){const t=await qu();if(e instanceof fe&&!(t instanceof ne))return;let r=await t.resolve(e).then(i=>i==null?void 0:i.join("/"));return r?r="~local/"+r:r=await this.baseDirectory.resolve(e).then(i=>i==null?void 0:i.join("/")),r}async mkdir(e,{recursive:t}={}){await this.getDirectoryHandle(e,{create:!0})}async readdir(e,{withFileTypes:t}={}){const r=await this.getDirectoryHandle(e),i=[];for await(const s of r.values())s.kind==="file"&&s.name===".DS_Store"||(t?i.push(s):i.push(s.name));return i}async readFilesFromDir(e,t=this.getDirectoryHandle(e)){t=await t;const r=[];for await(const i of t.values())i.kind==="file"&&i.name===".DS_Store"||(i.kind==="file"?r.push({name:i.name,kind:i.kind,path:`${e}/${i.name}`}):i.kind==="directory"&&r.push(...await this.readFilesFromDir(`${e}/${i.name}`,i)));return r}readFile(e){return this.getFileHandle(e).then(t=>t.getFile())}async unlink(e){if(e.length===0)throw new Error("Error: filePath is empty");const t=e.split(/\\|\//g),r=t.pop();let i;try{i=await this.getDirectoryHandle(t.join("/"))}catch{return}try{await i.removeEntry(r,{recursive:!0})}catch{}}async writeFile(e,t){const r=await this.getFileHandle(e,!0);return await this.write(r,t),r}async write(e,t){const r=await e.createWritable({keepExistingData:!1});await r.write(t),await r.close()}async readJSON(e){const t=await this.readFile(e);try{return await Dt.parse(await t.text())}catch{throw new Error(`Invalid JSON: ${e}`)}}async readJsonHandle(e){const t=await e.getFile();try{return await Dt.parse(await t.text())}catch{throw new Error(`Invalid JSON: ${e.name}`)}}writeJSON(e,t,r=!1){return this.writeFile(e,JSON.stringify(t,null,r?"	":void 0))}async move(e,t){if(await this.fileExists(e))await this.copyFile(e,t);else if(await this.directoryExists(e))await this.copyFolder(e,t);else throw new Error(`File or folder does not exist: ${e}`);await this.unlink(e)}async copyFile(e,t){const r=await this.getFileHandle(e,!1),i=await this.getFileHandle(t,!0);return await this.copyFileHandle(r,i)}async copyFileHandle(e,t){return await this.write(t,await e.getFile()),t}async copyFolder(e,t){const r=await this.getDirectoryHandle(e,{create:!1});await Yt(r,async(i,s)=>{await this.copyFileHandle(i,await this.getFileHandle(qt(t,s),!0))})}async copyFolderByHandle(e,t){const r=new Ke(t);await Yt(e,async(i,s)=>{await this.copyFileHandle(i,await r.getFileHandle(s,!0))})}loadFileHandleAsDataUrl(e){return new Promise(async(t,r)=>{const i=new FileReader;try{const s=await e.getFile();i.addEventListener("load",()=>{t(i.result)}),i.addEventListener("error",r),i.readAsDataURL(s)}catch{r(`File does not exist: "${e.name}"`)}})}async fileExists(e){try{return await this.getFileHandle(e),!0}catch{return!1}}async directoryExists(e){try{return await this.getDirectoryHandle(e),!0}catch{return!1}}async getDirectoryHandlesFromGlob(e,t="."){const r=e.split(/\/|\\/g),i=new Set([await this.getDirectoryHandle(t)]);for(const s of r){if(s==="*")for(const n of[...i.values()]){i.delete(n);for await(const a of n.values())a.kind==="directory"&&i.add(a)}else{if(s==="**")return console.warn('"**" is not supported yet'),[];for(const n of[...i.values()]){i.delete(n);try{i.add(await n.getDirectoryHandle(s))}catch{}}}if(i.size===0)return[]}return[...i.values()]}}class wn extends sn{constructor(e){super(e),this.ready=new Ne}async setup(e){this.packTypes.length>0||(await e.fired,this.packTypes=await e.readJSON("data/packages/minecraftBedrock/packDefinitions.json").catch(()=>[]),this.ready.dispatch())}}const vn="/";var Qu={},Bn=function(u,e,t,r,i){var s=Qu[e]||(Qu[e]=URL.createObjectURL(new Blob([u],{type:"text/javascript"}))),n=new Worker(s);return n.onerror=function(a){return i(a.error,null)},n.onmessage=function(a){return i(null,a.data)},n.postMessage(t,r),n},ee=Uint8Array,de=Uint16Array,Ze=Uint32Array,eu=new ee([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tu=new ee([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Zu=new ee([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yu=function(u,e){for(var t=new de(31),r=0;r<31;++r)t[r]=e+=1<<u[r-1];for(var i=new Ze(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return[t,i]},er=Yu(eu,2),uu=er[0],Sn=er[1];uu[28]=258,Sn[258]=28;for(var bn=Yu(tu,0),tr=bn[0],ht=new de(32768),W=0;W<32768;++W){var be=(W&43690)>>>1|(W&21845)<<1;be=(be&52428)>>>2|(be&13107)<<2,be=(be&61680)>>>4|(be&3855)<<4,ht[W]=((be&65280)>>>8|(be&255)<<8)>>>1}for(var Ve=function(u,e,t){for(var r=u.length,i=0,s=new de(e);i<r;++i)++s[u[i]-1];var n=new de(e);for(i=0;i<e;++i)n[i]=n[i-1]+s[i-1]<<1;var a;if(t){a=new de(1<<e);var o=15-e;for(i=0;i<r;++i)if(u[i])for(var l=i<<4|u[i],f=e-u[i],D=n[u[i]-1]++<<f,B=D|(1<<f)-1;D<=B;++D)a[ht[D]>>>o]=l}else for(a=new de(r),i=0;i<r;++i)u[i]&&(a[i]=ht[n[u[i]-1]++]>>>15-u[i]);return a},Ye=new ee(288),W=0;W<144;++W)Ye[W]=8;for(var W=144;W<256;++W)Ye[W]=9;for(var W=256;W<280;++W)Ye[W]=7;for(var W=280;W<288;++W)Ye[W]=8;for(var ur=new ee(32),W=0;W<32;++W)ur[W]=5;var rr=Ve(Ye,9,1),ir=Ve(ur,5,1),dt=function(u){for(var e=u[0],t=1;t<u.length;++t)u[t]>e&&(e=u[t]);return e},ae=function(u,e,t){var r=e/8|0;return(u[r]|u[r+1]<<8)>>(e&7)&t},pt=function(u,e){var t=e/8|0;return(u[t]|u[t+1]<<8|u[t+2]<<16)>>(e&7)},nr=function(u){return(u/8|0)+(u&7&&1)},At=function(u,e,t){(e==null||e<0)&&(e=0),(t==null||t>u.length)&&(t=u.length);var r=new(u instanceof de?de:u instanceof Ze?Ze:ee)(t-e);return r.set(u.subarray(e,t)),r},sr=function(u,e,t){var r=u.length;if(!r||t&&!t.l&&r<5)return e||new ee(0);var i=!e||t,s=!t||t.i;t||(t={}),e||(e=new ee(r*3));var n=function(T){var He=e.length;if(T>He){var Ft=new ee(Math.max(He*2,T));Ft.set(e),e=Ft}},a=t.f||0,o=t.p||0,l=t.b||0,f=t.l,D=t.d,B=t.m,m=t.n,y=r*8;do{if(!f){t.f=a=ae(u,o,1);var A=ae(u,o+1,3);if(o+=3,A)if(A==1)f=rr,D=ir,B=9,m=5;else if(A==2){var S=ae(u,o,31)+257,x=ae(u,o+10,15)+4,b=S+ae(u,o+5,31)+1;o+=14;for(var I=new ee(b),N=new ee(19),v=0;v<x;++v)N[Zu[v]]=ae(u,o+v*3,7);o+=x*3;for(var $=dt(N),K=(1<<$)-1,d=Ve(N,$,1),v=0;v<b;){var L=d[ae(u,o,K)];o+=L&15;var E=L>>>4;if(E<16)I[v++]=E;else{var H=0,se=0;for(E==16?(se=3+ae(u,o,3),o+=2,H=I[v-1]):E==17?(se=3+ae(u,o,7),o+=3):E==18&&(se=11+ae(u,o,127),o+=7);se--;)I[v++]=H}}var h=I.subarray(0,S),c=I.subarray(S);B=dt(h),m=dt(c),f=Ve(h,B,1),D=Ve(c,m,1)}else throw"invalid block type";else{var E=nr(o)+4,C=u[E-4]|u[E-3]<<8,w=E+C;if(w>r){if(s)throw"unexpected EOF";break}i&&n(l+C),e.set(u.subarray(E,w),l),t.b=l+=C,t.p=o=w*8;continue}if(o>y){if(s)throw"unexpected EOF";break}}i&&n(l+131072);for(var Z=(1<<B)-1,O=(1<<m)-1,ie=o;;ie=o){var H=f[pt(u,o)&Z],Y=H>>>4;if(o+=H&15,o>y){if(s)throw"unexpected EOF";break}if(!H)throw"invalid length/literal";if(Y<256)e[l++]=Y;else if(Y==256){ie=o,f=null;break}else{var te=Y-254;if(Y>264){var v=Y-257,Ae=eu[v];te=ae(u,o,(1<<Ae)-1)+uu[v],o+=Ae}var et=D[pt(u,o)&O],_e=et>>>4;if(!et)throw"invalid distance";o+=et&15;var c=tr[_e];if(_e>3){var Ae=tu[_e];c+=pt(u,o)&(1<<Ae)-1,o+=Ae}if(o>y){if(s)throw"unexpected EOF";break}i&&n(l+131072);for(var Ce=l+te;l<Ce;l+=4)e[l]=e[l-c],e[l+1]=e[l+1-c],e[l+2]=e[l+2-c],e[l+3]=e[l+3-c];l=Ce}}t.l=f,t.p=ie,t.b=l,f&&(a=1,t.m=B,t.d=D,t.n=m)}while(!a);return l==e.length?e:At(e,0,l)},_n=new ee(0),xn=function(u,e){var t={};for(var r in u)t[r]=u[r];for(var r in e)t[r]=e[r];return t},ar=function(u,e,t){for(var r=u(),i=u.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),n=0;n<r.length;++n){var a=r[n],o=s[n];if(typeof a=="function"){e+=";"+o+"=";var l=a.toString();if(a.prototype)if(l.indexOf("[native code]")!=-1){var f=l.indexOf(" ",8)+1;e+=l.slice(f,l.indexOf("(",f))}else{e+=l;for(var D in a.prototype)e+=";"+o+".prototype."+D+"="+a.prototype[D].toString()}else e+=l}else t[o]=a}return[e,t]},Ct=[],kn=function(u){var e=[];for(var t in u)(u[t]instanceof ee||u[t]instanceof de||u[t]instanceof Ze)&&e.push((u[t]=new u[t].constructor(u[t])).buffer);return e},Tn=function(u,e,t,r){var i;if(!Ct[t]){for(var s="",n={},a=u.length-1,o=0;o<a;++o)i=ar(u[o],s,n),s=i[0],n=i[1];Ct[t]=ar(u[a],s,n)}var l=xn({},Ct[t][1]);return Bn(Ct[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,l,kn(l),r)},Rn=function(){return[ee,de,Ze,eu,tu,Zu,uu,tr,rr,ir,ht,Ve,dt,ae,pt,nr,At,sr,iu,or,lr]},or=function(u){return postMessage(u,[u.buffer])},lr=function(u){return u&&u.size&&new ee(u.size)},Pn=function(u,e,t,r,i,s){var n=Tn(t,r,i,function(a,o){n.terminate(),s(a,o)});return n.postMessage([u,e],e.consume?[u.buffer]:[]),function(){n.terminate()}},pe=function(u,e){return u[e]|u[e+1]<<8},ce=function(u,e){return(u[e]|u[e+1]<<8|u[e+2]<<16|u[e+3]<<24)>>>0},ru=function(u,e){return ce(u,e)+ce(u,e+4)*4294967296};function $n(u,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Pn(u,e,[Rn],function(r){return or(iu(r.data[0],lr(r.data[1])))},1,t)}function iu(u,e){return sr(u,e)}var nu=typeof TextDecoder<"u"&&new TextDecoder,On=0;try{nu.decode(_n,{stream:!0}),On=1}catch{}var Hn=function(u){for(var e="",t=0;;){var r=u[t++],i=(r>127)+(r>223)+(r>239);if(t+i>u.length)return[e,At(u,t-1)];i?i==3?(r=((r&15)<<18|(u[t++]&63)<<12|(u[t++]&63)<<6|u[t++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?e+=String.fromCharCode((r&31)<<6|u[t++]&63):e+=String.fromCharCode((r&15)<<12|(u[t++]&63)<<6|u[t++]&63):e+=String.fromCharCode(r)}};function Ln(u,e){if(e){for(var t="",r=0;r<u.length;r+=16384)t+=String.fromCharCode.apply(null,u.subarray(r,r+16384));return t}else{if(nu)return nu.decode(u);var i=Hn(u),s=i[0],n=i[1];if(n.length)throw"invalid utf-8 data";return s}}var In=function(u,e){return e+30+pe(u,e+26)+pe(u,e+28)},Nn=function(u,e,t){var r=pe(u,e+28),i=Ln(u.subarray(e+46,e+46+r),!(pe(u,e+8)&2048)),s=e+46+r,n=ce(u,e+20),a=t&&n==4294967295?Mn(u,s):[n,ce(u,e+24),ce(u,e+42)],o=a[0],l=a[1],f=a[2];return[pe(u,e+10),o,l,i,s+pe(u,e+30)+pe(u,e+32),f]},Mn=function(u,e){for(;pe(u,e)!=1;e+=4+pe(u,e+2));return[ru(u,e+12),ru(u,e+4),ru(u,e+20)]};function jn(u,e){if(typeof e!="function")throw"no callback";for(var t=[],r=function(){for(var B=0;B<t.length;++B)t[B]()},i={},s=u.length-22;ce(u,s)!=101010256;--s)if(!s||u.length-s>65558){e("invalid zip file",null);return}var n=pe(u,s+8);n||e(null,{});var a=n,o=ce(u,s+16),l=o==4294967295;if(l){if(s=ce(u,s-12),ce(u,s)!=101075792){e("invalid zip file",null);return}a=n=ce(u,s+32),o=ce(u,s+48)}for(var f=function(B){var m=Nn(u,o,l),y=m[0],A=m[1],E=m[2],C=m[3],w=m[4],S=m[5],x=In(u,S);o=w;var b=function(N,v){N?(r(),e(N,null)):(i[C]=v,--n||e(null,i))};if(!y)b(null,At(u,x,x+A));else if(y==8){var I=u.subarray(x,x+A);if(A<32e4)try{b(null,iu(I,new ee(E)))}catch(N){b(N,null)}else t.push($n(I,{size:E},b))}else b("unknown compression type "+y,null)},D=0;D<a;++D)f();return r}const cr=1179771;function Wn(u){return new Promise(e=>{typeof requestIdleCallback=="function"?requestIdleCallback(async()=>{await u(),e()}):setTimeout(async()=>{await u(),e()},10)})}class zn extends Ke{constructor(e=!1){super(),this.isMainLoader=e}get virtualFileSystem(){if(!this._virtualFileSystem)throw new Error("DataLoader: virtualFileSystem is not initialized");return this._virtualFileSystem}async loadData(e=!1){if(this.hasFired){console.warn("This dataLoader instance already loaded data. You called loadData() twice.");return}let t=await _t("savedAllDataInIdb");e&&(t=!1,await xt("savedAllDataInIdb",!1)),this.isMainLoader&&console.log(t?"[APP] Data saved; restoring from cache...":"[APP] Data not saved; fetching now..."),console.time("[App] Data");const r=this.isMainLoader&&!t;if(this._virtualFileSystem=new ne(new Je("data-fs"),"bridgeFolder",t?void 0:new Map,r),await this._virtualFileSystem.setupDone.fired,t){this.setup(this._virtualFileSystem),console.timeEnd("[App] Data");return}const i=await fetch(vn+"packages.zip").then(o=>o.arrayBuffer());if(i.byteLength!==cr)throw new Error(`Error: Data package was larger than the expected size of ${cr} bytes; got ${i.byteLength} bytes`);const s=await new Promise((o,l)=>jn(new Uint8Array(i),async(f,D)=>{if(f)return l(f);o(D)})),a={".":await this._virtualFileSystem.getDirectoryHandle("data",{create:!0})};for(const o in s){const l=Qt(o),f=Ju(o);if(o.endsWith("/")){const D=await a[f].getDirectoryHandle(l,{create:!0});a[o.slice(0,-1)]=D}else await a[f].getFileHandle(l,{create:!0,initialData:s[o]})}this.setup(this._virtualFileSystem),console.timeEnd("[App] Data"),this.isMainLoader&&!e&&Wn(async()=>{await this._virtualFileSystem.moveToIdb(),await xt("savedAllDataInIdb",!0)})}}class Gn extends nn{constructor(e,t,r){super(t),this.fileSystem=e,this.project=r,r&&r.fileSave.on(this.resolvePackPath(void 0,"config.json"),()=>{this.refreshConfig(),this.project.app.windows.createPreset.onPresetsChanged(),this.project.compilerService.reloadPlugins()})}readConfig(){return this.fileSystem.readJSON("config.json").catch(()=>({}))}async writeConfig(e){await this.fileSystem.writeJSON("config.json",e,!0)}async setup(e=!0){var i,s,n,a,o,l,f;if(e&&await this.fileSystem.fileExists(".bridge/config.json")){const{darkTheme:D,lightTheme:B,gameTestAPI:m,scriptingAPI:y,prefix:A,...E}=await this.fileSystem.readJSON(".bridge/config.json");await this.fileSystem.unlink(".bridge/config.json");const C={};m&&(C.enableGameTestFramework=!0),y&&(C.additionalModdingCapabilities=!0);const w={type:"minecraftBedrock",name:this.fileSystem.baseDirectory.name,namespace:A,experimentalGameplay:C,...E,authors:E.author?[E.author]:["Unknown"],packs:Xt,bridge:{darkTheme:D,lightTheme:B}};await this.fileSystem.writeJSON("config.json",w,!0),this.data=w;return}await super.setup();const t=(s=(i=this.data.bridge)==null?void 0:i.formatVersion)!=null?s:0;this.data.bridge||(this.data.bridge={});let r=!1;if(e&&this.project&&this.data.capabilities){const D=await this.project.app.dataLoader.readJSON("data/packages/minecraftBedrock/experimentalGameplay.json"),B=(n=this.data.experimentalGameplay)!=null?n:{},m=(a=this.data.capabilities)!=null?a:[];B.enableGameTestFramework=m.includes("gameTestAPI"),B.additionalModdingCapabilities=m.includes("scriptingAPI");for(const y of D)(l=B[o=y.id])!=null||(B[o]=!0);this.data.experimentalGameplay=B,this.data.capabilities=void 0,r=!0}if(e&&this.data.author&&!this.data.authors&&(this.data.authors=typeof this.data.author=="string"?[this.data.author]:this.data.author,this.data.author=void 0,r=!0),e&&await this.fileSystem.fileExists(".bridge/compiler/default.json")){const D=await this.fileSystem.readJSON(".bridge/compiler/default.json");this.data.compiler={plugins:D.plugins},await this.fileSystem.unlink(".bridge/compiler/default.json"),r=!0}e&&t===0&&((f=this.data.compiler)==null?void 0:f.plugins)&&!this.data.compiler.plugins.includes("formatVersionCorrection")&&(this.data.bridge.formatVersion=1,this.data.compiler.plugins.push("formatVersionCorrection"),r=!0),r&&await this.writeConfig(this.data)}async getWorldHandles(){var r;if(!this.project)throw new Error("Cannot use getWorldHandles() within web workers yet");const e=this.project.app,t=((r=this.get().worlds)!=null?r:["./worlds/*"]).map(i=>this.resolvePackPath(void 0,i));return(await Promise.all(t.map(i=>e.fileSystem.getDirectoryHandlesFromGlob(i)))).flat()}getAuthorImage(){var t;const e=(t=this.get().authors)==null?void 0:t.find(r=>typeof r!="string"&&r.logo);if(!!e)return this.resolvePackPath(void 0,e.logo)}async toggleExperiment(e,t){var i,s;e.app.windows.loadingWindow.open();const r=(s=(i=this.get())==null?void 0:i.experimentalGameplay)!=null?s:{};r[t]=!r[t],await this.save(),e.isActiveProject&&await e.refresh(),this.project.app.windows.createPreset.onPresetsChanged(),e.app.windows.loadingWindow.close()}}globalThis.process={cwd:()=>"",env:{}};const gt=new zn;class Un extends cn{constructor(e,t,r){super(),this.projectDirectory=e,this.options=r,this.fileSystem=new Ke(t),this.projectFileSystem=new Ke(e),this.config=new Gn(this.projectFileSystem,r.projectPath),this.fileType=new on(this.config),this.packType=new wn(this.config),this.globalFileSystem=new Ke(t),this.lightningStore=new Dn(this.projectFileSystem,this.fileType,r.projectPath),this.packSpider=new hn(this,this.lightningStore),this.lightningCache=new yn(this,this.lightningStore),this.fileType.setPluginFileTypes(r.pluginFileTypes)}getOptions(){return{projectDirectory:this.projectDirectory,baseDirectory:this.fileSystem.baseDirectory,...this.options}}async onStart(e){console.time("[WORKER] SETUP"),this.lightningStore.reset(),gt.hasFired||await gt.loadData(),await Promise.all([this.fileType.setup(gt),this.packType.setup(gt),this.config.setup(!1)]),console.timeEnd("[WORKER] SETUP"),console.time("[WORKER] LightningCache");const[t,r,i]=await this.lightningCache.start(e);return console.timeEnd("[WORKER] LightningCache"),console.time("[WORKER] PackSpider"),await this.packSpider.setup(t),console.timeEnd("[WORKER] PackSpider"),[r,i]}async updateFile(e,t,r=!1,i=!1){const s=await this.lightningCache.processFile(e,t!=null?t:await this.fileSystem.getFileHandle(e),r);return s&&(i||await this.lightningStore.saveStore(!1),await this.packSpider.updateFile(e)),s}async updateFiles(e,t=!1){let r=!1;for(let i=0;i<e.length;i++)await this.updateFile(e[i],void 0,!1,!1)&&(r=!0);return!t&&r&&await this.lightningStore.saveStore(!1),r}hasFile(e){return this.lightningStore.has(e)}async rename(e,t,r=!0){this.lightningStore.rename(e,t),r&&await this.lightningStore.saveStore(!1)}unlinkFile(e,t=!0){return this.lightningCache.unlinkFile(e,t)}saveCache(){return this.lightningStore.saveStore(!1)}updatePlugins(e){this.fileType.setPluginFileTypes(e)}find(e,t,r,i=!1){return this.lightningStore.find(e,t,r,i)}findMultiple(e,t,r,i=!1){return this.lightningStore.findMultiple(e,t,r,i)}getAllFiles(e,t=!1){return t?this.lightningStore.allFiles(e).sort((r,i)=>r.localeCompare(i)):this.lightningStore.allFiles(e)}getFileDiagnostics(e){return this.packSpider.getDiagnostics(e)}getConnectedFiles(e){return this.packSpider.getConnectedFiles(e)}getSchemasFor(e,t){return this.lightningStore.getSchemasFor(e,t)}getCacheDataFor(e,t,r){return this.lightningStore.getCacheDataFor(e,t,r)}}mt(Un,self)})();
