(function(){"use strict";const Xr=Symbol("Comlink.proxy"),In=Symbol("Comlink.endpoint"),Ln=Symbol("Comlink.releaseProxy"),tr=Symbol("Comlink.thrown"),Qr=r=>typeof r=="object"&&r!==null||typeof r=="function",Mn={canHandle:r=>Qr(r)&&r[Xr],serialize(r){const{port1:e,port2:t}=new MessageChannel;return rr(r,e),[t,[t]]},deserialize(r){return r.start(),Un(r)}},Hn={canHandle:r=>Qr(r)&&tr in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},Ye=new Map([["proxy",Mn],["throw",Hn]]);function rr(r,e=self){e.addEventListener("message",function t(i){if(!i||!i.data)return;const{id:n,type:s,path:u}=Object.assign({path:[]},i.data),a=(i.data.argumentList||[]).map(Me);let o;try{const l=u.slice(0,-1).reduce((c,f)=>c[f],r),h=u.reduce((c,f)=>c[f],r);switch(s){case 0:o=h;break;case 1:l[u.slice(-1)[0]]=Me(i.data.value),o=!0;break;case 2:o=h.apply(l,a);break;case 3:{const c=new h(...a);o=Gn(c)}break;case 4:{const{port1:c,port2:f}=new MessageChannel;rr(r,f),o=Wn(c,[c])}break;case 5:o=void 0;break}}catch(l){o={value:l,[tr]:0}}Promise.resolve(o).catch(l=>({value:l,[tr]:0})).then(l=>{const[h,c]=nr(l);e.postMessage(Object.assign(Object.assign({},h),{id:n}),c),s===5&&(e.removeEventListener("message",t),Yr(e))})}),e.start&&e.start()}function jn(r){return r.constructor.name==="MessagePort"}function Yr(r){jn(r)&&r.close()}function Un(r,e){return ir(r,[],e)}function _t(r){if(r)throw new Error("Proxy has been released and is not useable")}function ir(r,e=[],t=function(){}){let i=!1;const n=new Proxy(t,{get(s,u){if(_t(i),u===Ln)return()=>Ze(r,{type:5,path:e.map(a=>a.toString())}).then(()=>{Yr(r),i=!0});if(u==="then"){if(e.length===0)return{then:()=>n};const a=Ze(r,{type:0,path:e.map(o=>o.toString())}).then(Me);return a.then.bind(a)}return ir(r,[...e,u])},set(s,u,a){_t(i);const[o,l]=nr(a);return Ze(r,{type:1,path:[...e,u].map(h=>h.toString()),value:o},l).then(Me)},apply(s,u,a){_t(i);const o=e[e.length-1];if(o===In)return Ze(r,{type:4}).then(Me);if(o==="bind")return ir(r,e.slice(0,-1));const[l,h]=Zr(a);return Ze(r,{type:2,path:e.map(c=>c.toString()),argumentList:l},h).then(Me)},construct(s,u){_t(i);const[a,o]=Zr(u);return Ze(r,{type:3,path:e.map(l=>l.toString()),argumentList:a},o).then(Me)}});return n}function zn(r){return Array.prototype.concat.apply([],r)}function Zr(r){const e=r.map(nr);return[e.map(t=>t[0]),zn(e.map(t=>t[1]))]}const ei=new WeakMap;function Wn(r,e){return ei.set(r,e),r}function Gn(r){return Object.assign(r,{[Xr]:!0})}function nr(r){for(const[e,t]of Ye)if(t.canHandle(r)){const[i,n]=t.serialize(r);return[{type:3,name:e,value:i},n]}return[{type:0,value:r},ei.get(r)||[]]}function Me(r){switch(r.type){case 3:return Ye.get(r.name).deserialize(r.value);case 0:return r.value}}function Ze(r,e,t){return new Promise(i=>{const n=qn();r.addEventListener("message",function s(u){!u.data||!u.data.id||u.data.id!==n||(r.removeEventListener("message",s),i(u.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:n},e),t)})}function qn(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var St,Jn=new Uint8Array(16);function Vn(){if(!St&&(St=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!St))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return St(Jn)}var Kn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Xn(r){return typeof r=="string"&&Kn.test(r)}for(var te=[],sr=0;sr<256;++sr)te.push((sr+256).toString(16).substr(1));function Qn(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(te[r[e+0]]+te[r[e+1]]+te[r[e+2]]+te[r[e+3]]+"-"+te[r[e+4]]+te[r[e+5]]+"-"+te[r[e+6]]+te[r[e+7]]+"-"+te[r[e+8]]+te[r[e+9]]+"-"+te[r[e+10]]+te[r[e+11]]+te[r[e+12]]+te[r[e+13]]+te[r[e+14]]+te[r[e+15]]).toLowerCase();if(!Xn(t))throw TypeError("Stringified UUID is invalid");return t}function Yn(r,e,t){r=r||{};var i=r.random||(r.rng||Vn)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){t=t||0;for(var n=0;n<16;++n)e[t+n]=i[n];return e}return Qn(i)}class ti{constructor(){this.listeners=new Set}get hasListeners(){return this.listeners.size>0}dispatch(e){this.listeners.forEach(t=>t(e))}on(e,t=!0){if(this.listeners.add(e),t)return{dispose:()=>{this.off(e)}}}off(e){this.listeners.delete(e)}once(e,t=!1){const i=n=>{e(n),this.off(i)};return this.on(i,t)}disposeListeners(){this.listeners=new Set}}class He extends ti{constructor(e=1){super(),this.needsToFireAmount=e,this.firedTimes=0}get fired(){return new Promise(e=>this.once(e,!1))}get hasFired(){return this.firedTimes>=this.needsToFireAmount}setFiredTimes(e){this.firedTimes=e}resetSignal(){this.data=void 0,this.firedTimes=0}dispatch(e){if(this.firedTimes<this.needsToFireAmount&&this.firedTimes++,this.data=e,this.hasFired)return super.dispatch(e)}on(e,t=!0){return this.hasFired&&e(this.data),super.on(e,t)}}function Zn(){if(!(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent))||!indexedDB.databases)return Promise.resolve();let e;return new Promise(t=>{const i=()=>indexedDB.databases().finally(t);e=setInterval(i,100),i()}).finally(()=>clearInterval(e))}function Te(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function ur(r,e){const t=Zn().then(()=>{const i=indexedDB.open(r);return i.onupgradeneeded=()=>i.result.createObjectStore(e),Te(i)});return(i,n)=>t.then(s=>n(s.transaction(e,i).objectStore(e)))}let ar;function je(){return ar||(ar=ur("keyval-store","keyval")),ar}function or(r,e=je()){return e("readonly",t=>Te(t.get(r)))}function lr(r,e,t=je()){return t("readwrite",i=>(i.put(e,r),Te(i.transaction)))}function es(r,e=je()){return e("readwrite",t=>(r.forEach(i=>t.put(i[1],i[0])),Te(t.transaction)))}function ts(r,e=je()){return e("readonly",t=>Promise.all(r.map(i=>Te(t.get(i)))))}function rs(r,e=je()){return e("readwrite",t=>(t.delete(r),Te(t.transaction)))}function is(r=je()){return r("readwrite",e=>(e.clear(),Te(e.transaction)))}function ns(r,e){return r("readonly",t=>(t.openCursor().onsuccess=function(){!this.result||(e(this.result),this.result.continue())},Te(t.transaction)))}function ss(r=je()){const e=[];return ns(r,t=>e.push(t.key)).then(()=>e)}const us=ur("virtual-fs","virtual-fs-store"),as=r=>or(r,us);class lt{constructor(e="virtual-fs"){this.storeName=e,this.store=ur(e,`${e}-store`)}set(e,t){return lr(e,t,this.store)}get(e){return or(e,this.store)}del(e){return rs(e,this.store)}setMany(e){return es(e,this.store)}getMany(e){return ts(e,this.store)}clear(){return is(this.store)}async has(e){return await as(e)!==void 0}keys(){return ss(this.store)}}class ri{constructor(e,t,i=[],n=Yn()){this._name=t,this.basePath=i,this.uuid=n,this._idbWrapper=null,this.parent=null,this.isVirtual=!0,this.setupDone=new He,e===null?this._idbWrapper=new lt:e instanceof lt?this._idbWrapper=e:this.parent=e}get path(){return this.parent?this.parent.path.concat(this.name):this.basePath}get hasParentContext(){return this.path.length>1}get idbKey(){return this.path.length===0?this._name:this.path.join("/")}get idbWrapper(){return this._idbWrapper===null?this.parent.idbWrapper:this._idbWrapper}get name(){return this._name}getParent(){return this.parent}async isSameEntry(e){return e.idbKey===this.idbKey}async queryPermission(e){return"granted"}async requestPermission(e){return"granted"}}const os=new TextEncoder,ii=Symbol("writeMethod");class ls{constructor(e){this.fileHandle=e,this.tmpData=new Uint8Array,this.cursorOffset=0,this.locked=!1}async write(e){let t;if(typeof e=="string")t=os.encode(e);else if(e instanceof Blob)t=await e.arrayBuffer().then(i=>new Uint8Array(i));else if("type"in e){if(e.type==="seek")return await this.seek(e.position);if(e.type==="truncate")return await this.truncate(e.size);if(e.type==="write")return e.position&&await this.seek(e.position),await this.write(e.data);throw new Error(`Unknown data type: ${e.type}`)}else ArrayBuffer.isView(e)?t=new Uint8Array(e.buffer):t=new Uint8Array(e);this.tmpData=new Uint8Array([...this.tmpData.slice(0,this.cursorOffset),...t]),this.cursorOffset=this.tmpData.length}async seek(e){this.cursorOffset=Math.floor(e)}async truncate(e){this.tmpData=this.tmpData.slice(0,e),this.cursorOffset>e&&(this.cursorOffset=e)}async close(){await this.fileHandle[ii](this.tmpData)}async abort(){throw new Error("WriteStream was aborted")}getWriter(){}}class me extends ri{constructor(e,t,i,n=!1,s){super(e,t,s),this.inMemory=n,this.kind="file",this.isFile=!0,this.isDirectory=!1,i?this.setup(i):this.setupDone.dispatch()}get isFileStoredInMemory(){return this.fileData!==void 0}moveData(){if(!this.fileData)throw new Error(`No file data to move to IDB for file "${this.name}"`);const e=this.fileData;return this.fileData=void 0,this.inMemory=!1,e}async setup(e){this.fileData=e;const t=this.path.join("/").startsWith("data/packages");if(this.inMemory||t&&e.length<5e4)return this.inMemory=!0,this.setupDone.dispatch();(!t||globalThis.document)&&await this.updateIdb(e),this.setupDone.dispatch()}async updateIdb(e){await this.idbWrapper.set(this.idbKey,e),this.fileData=void 0}async loadFromIdb(){if(this.fileData)return this.fileData;let e=await this.idbWrapper.get(this.idbKey);if(e===void 0)throw console.log(this.parent),new Error(`File not found: "${this.path.join("/")}"`);return e}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"file",name:this.name,path:this.path,fileData:this.fileData}}static deserialize(e){return new me(e.idbWrapper?new lt(e.idbWrapper):null,e.name,e.fileData,e.fileData!==void 0,e.path)}async isSameEntry(e){return this.parent===null?!1:super.isSameEntry(e)}async removeSelf(e=!0){await this.idbWrapper.del(this.idbKey),this.parent&&e&&this.parent.deleteChild(this.name)}async getFile(){const e=await this.loadFromIdb();return new File([e],this.name)}async createWritable(){return new ls(this)}async[ii](e){this.inMemory?this.fileData=e:await this.updateIdb(e)}}class ce extends ri{constructor(e,t,i,n=!1,s=[]){super(e,t,s),this.children=i,this.kind="directory",this.isDirectory=!0,this.isFile=!1,this.updateIdb(n)}get isDirectoryInMemory(){return this.children!==void 0}async moveToIdb(){const e=this.allInMemoryChildren();this.idbWrapper.setMany(e.map(t=>[t.idbKey,t.moveData()]))}moveData(){if(!this.children)throw new Error(`No directory data to move to IDB for directory "${this.name}"`);const e=[...this.children.values()].map(t=>t.name);return this.children=void 0,e}allInMemoryChildren(){if(!this.children)return[];const e=[this];for(const t of this.children.values())t instanceof ce?t.isDirectoryInMemory&&e.push(...t.allInMemoryChildren()):t.isFileStoredInMemory&&e.push(t);return e}async updateIdb(e=!1){e&&await this.idbWrapper.clear(),!this.children&&!await this.hasChildren()&&await this.idbWrapper.set(this.idbKey,[]),this.setupDone.dispatch()}async addChild(e){await this.has(e.name)||(this.children?this.children.set(e.name,e):await this.idbWrapper.set(this.idbKey,[...await this.fromIdb(),e.name]))}async fromIdb(){var e;return(e=await this.idbWrapper.get(this.idbKey))!=null?e:[]}async getChildren(){return this.children?[...this.children.values()]:await Promise.all((await this.fromIdb()).map(e=>this.getChild(e)).filter(e=>e!==void 0))}getChildPath(e){return this.path.concat(e).join("/")}async getChild(e){if(this.children)return this.children.get(e);if(await this.has(e)){const t=await this.idbWrapper.get(this.getChildPath(e));if(t instanceof Uint8Array)return new me(this,e);if(Array.isArray(t))return new ce(this,e)}}async deleteChild(e){this.children?this.children.delete(e):await this.idbWrapper.set(this.idbKey,(await this.fromIdb()).filter(t=>t!==e))}async hasChildren(){return this.children?this.children.size>0:(await this.fromIdb()).length>0}async has(e){return this.children?this.children.has(e):(await this.fromIdb()).includes(e)}serialize(){return{idbWrapper:this.idbWrapper.storeName,kind:"directory",name:this.name,path:this.path,children:this.children?[...this.children.values()].map(e=>e.serialize()):void 0}}static deserialize(e,t=null){var n;const i=new ce(t||new lt(e.idbWrapper),e.name,void 0,!1,e.path);for(const s of(n=e.children)!=null?n:[])s.kind==="directory"?i.addChild(ce.deserialize(s,i)):i.addChild(new me(i,s.name,s.fileData));return i}async getDirectoryHandle(e,{create:t}={}){let i=await this.getChild(e);if(i&&i.kind==="file")throw new Error(`TypeMismatch: Expected directory with name "${e}", found file`);if(!i)if(t)i=new ce(this,e,this.children?new Map:void 0),await i.setupDone.fired,await this.addChild(i);else throw new Error(`No file with the name ${e} exists in this folder`);return i}async getFileHandle(e,{create:t,initialData:i}={}){let n=await this.getChild(e);if(n&&n.kind==="directory")throw new Error(`TypeMismatch: Expected file with name "${e}", found directory`);if(!n)if(t)n=new me(this,e,i!=null?i:new Uint8Array),await n.setupDone.fired,await this.addChild(n);else throw new Error(`No file with the name ${e} exists in this folder`);return n}async removeEntry(e,{recursive:t}={}){const i=await this.getChild(e);if(i){if(i.kind==="directory"&&!t&&await i.hasChildren())throw new Error('Cannot remove directory with children without "recursive" option being set to true')}else throw new Error(`No entry with the name ${e} exists in this folder`);await i.removeSelf(),await this.deleteChild(e)}async resolve(e){const t=[e.name];let i=e.getParent();for(;i!==null&&!await i.isSameEntry(this);)t.unshift(i.name),i=i.getParent();return i===null?null:t}async removeSelf(e=!0){const t=await this.getChildren();for(const i of t)await i.removeSelf(!1);this.children||await this.idbWrapper.del(this.idbKey),this.parent&&e&&this.parent.deleteChild(this.name)}[Symbol.asyncIterator](){return this.entries()}keys(){return this.children?this.children.keys():{childNamesPromise:this.fromIdb(),[Symbol.asyncIterator](){return{i:0,childNamesPromise:this.childNamesPromise,async next(){const e=await this.childNamesPromise;return this.i<e.length?{done:!1,value:e[this.i++]}:{done:!0}}}}}}entries(){return this.children?this.children.entries():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const e=await this.childrenPromise;return this.i<e.length?{done:!1,value:[e[this.i].name,e[this.i++]]}:{done:!0}}}}}}values(){return this.children?this.children.values():{childrenPromise:this.getChildren(),[Symbol.asyncIterator](){return{i:0,childrenPromise:this.childrenPromise,async next(){const e=await this.childrenPromise;return this.i<e.length?{done:!1,value:e[this.i++]}:{done:!0}}}}}}getEntries(){return this.values()}getDirectory(e,t={}){return this.getDirectoryHandle(e,t)}getFile(e,t={}){return this.getFileHandle(e,t)}}Ye.set("VirtualFileHandle",{canHandle:r=>r instanceof me,serialize:r=>[r.serialize(),[]],deserialize:r=>new me(null,r.name,r.fileData)}),Ye.set("VirtualDirectoryHandle",{canHandle:r=>r instanceof ce,serialize:r=>[r.serialize(),[]],deserialize:r=>ce.deserialize(r)}),Ye.set("VirtualDirectoryHandleArray",{canHandle:r=>Array.isArray(r)&&r.every(({directory:e})=>e instanceof ce),serialize:r=>[r.map(({directory:e,...t})=>({directory:e.serialize(),...t})),[]],deserialize:r=>r.map(({directory:e,...t})=>({directory:ce.deserialize(e),...t}))}),Ye.set("VirtualFileHandleArray",{canHandle:r=>Array.isArray(r)&&r.every(({fileHandle:e})=>e instanceof me),serialize:r=>[r.map(({fileHandle:e,...t})=>({fileHandle:e.serialize(),...t})),[]],deserialize:r=>r.map(({fileHandle:e,...t})=>({fileHandle:me.deserialize(e),...t}))});var cs=Object.defineProperty,hs=Object.defineProperties,fs=Object.getOwnPropertyDescriptors,ni=Object.getOwnPropertySymbols,ds=Object.prototype.hasOwnProperty,ps=Object.prototype.propertyIsEnumerable,si=(r,e,t)=>e in r?cs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,et=(r,e)=>{for(var t in e||(e={}))ds.call(e,t)&&si(r,t,e[t]);if(ni)for(var t of ni(e))ps.call(e,t)&&si(r,t,e[t]);return r},kt=(r,e)=>hs(r,fs(e));function ui(r,e){for(var t=0,i=r.length-1;i>=0;i--){var n=r[i];n==="."?r.splice(i,1):n===".."?(r.splice(i,1),t++):t&&(r.splice(i,1),t--)}if(e)for(;t--;t)r.unshift("..");return r}var gs=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,cr=function(r){return gs.exec(r).slice(1)};function Bt(){for(var r="",e=!1,t=arguments.length-1;t>=-1&&!e;t--){var i=t>=0?arguments[t]:"/";if(typeof i!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!i)continue;r=i+"/"+r,e=i.charAt(0)==="/"}return r=ui(dr(r.split("/"),function(n){return!!n}),!e).join("/"),(e?"/":"")+r||"."}function hr(r){var e=fr(r),t=ms(r,-1)==="/";return r=ui(dr(r.split("/"),function(i){return!!i}),!e).join("/"),!r&&!e&&(r="."),r&&t&&(r+="/"),(e?"/":"")+r}function fr(r){return r.charAt(0)==="/"}function ai(){var r=Array.prototype.slice.call(arguments,0);return hr(dr(r,function(e,t){if(typeof e!="string")throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function oi(r,e){r=Bt(r).substr(1),e=Bt(e).substr(1);function t(l){for(var h=0;h<l.length&&l[h]==="";h++);for(var c=l.length-1;c>=0&&l[c]==="";c--);return h>c?[]:l.slice(h,c-h+1)}for(var i=t(r.split("/")),n=t(e.split("/")),s=Math.min(i.length,n.length),u=s,a=0;a<s;a++)if(i[a]!==n[a]){u=a;break}for(var o=[],a=u;a<i.length;a++)o.push("..");return o=o.concat(n.slice(u)),o.join("/")}var li="/",ci=":";function hi(r){var e=cr(r),t=e[0],i=e[1];return!t&&!i?".":(i&&(i=i.substr(0,i.length-1)),t+i)}function fi(r,e){var t=cr(r)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t}function di(r){return cr(r)[3]}var Ds={extname:di,basename:fi,dirname:hi,sep:li,delimiter:ci,relative:oi,join:ai,isAbsolute:fr,normalize:hr,resolve:Bt};function dr(r,e){if(r.filter)return r.filter(e);for(var t=[],i=0;i<r.length;i++)e(r[i],i,r)&&t.push(r[i]);return t}var ms="ab".substr(-1)==="b"?function(r,e,t){return r.substr(e,t)}:function(r,e,t){return e<0&&(e=r.length+e),r.substr(e,t)},pr=Object.freeze({__proto__:null,resolve:Bt,normalize:hr,isAbsolute:fr,join:ai,relative:oi,sep:li,delimiter:ci,dirname:hi,basename:fi,extname:di,default:Ds});function pi(){throw new Error("setTimeout has not been defined")}function gi(){throw new Error("clearTimeout has not been defined")}var $e=pi,Oe=gi,tt;typeof window<"u"?tt=window:typeof self<"u"?tt=self:tt={},typeof tt.setTimeout=="function"&&($e=setTimeout),typeof tt.clearTimeout=="function"&&(Oe=clearTimeout);function Di(r){if($e===setTimeout)return setTimeout(r,0);if(($e===pi||!$e)&&setTimeout)return $e=setTimeout,setTimeout(r,0);try{return $e(r,0)}catch{try{return $e.call(null,r,0)}catch{return $e.call(this,r,0)}}}function Es(r){if(Oe===clearTimeout)return clearTimeout(r);if((Oe===gi||!Oe)&&clearTimeout)return Oe=clearTimeout,clearTimeout(r);try{return Oe(r)}catch{try{return Oe.call(null,r)}catch{return Oe.call(this,r)}}}var be=[],rt=!1,Ue,Rt=-1;function Cs(){!rt||!Ue||(rt=!1,Ue.length?be=Ue.concat(be):Rt=-1,be.length&&mi())}function mi(){if(!rt){var r=Di(Cs);rt=!0;for(var e=be.length;e;){for(Ue=be,be=[];++Rt<e;)Ue&&Ue[Rt].run();Rt=-1,e=be.length}Ue=null,rt=!1,Es(r)}}function ws(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];be.push(new Ei(r,e)),be.length===1&&!rt&&Di(mi)}function Ei(r,e){this.fun=r,this.array=e}Ei.prototype.run=function(){this.fun.apply(null,this.array)};var ys="browser",As="browser",Fs=!0,vs=[],bs="",xs={},_s={},Ss={};function ze(){}var ks=ze,Bs=ze,Rs=ze,Ts=ze,$s=ze,Os=ze,Ps=ze;function Ns(r){throw new Error("process.binding is not supported")}function Is(){return"/"}function Ls(r){throw new Error("process.chdir is not supported")}function Ms(){return 0}var it=tt.performance||{},Hs=it.now||it.mozNow||it.msNow||it.oNow||it.webkitNow||function(){return new Date().getTime()};function js(r){var e=Hs.call(it)*.001,t=Math.floor(e),i=Math.floor(e%1*1e9);return r&&(t=t-r[0],i=i-r[1],i<0&&(t--,i+=1e9)),[t,i]}var Us=new Date;function zs(){var r=new Date,e=r-Us;return e/1e3}var Ws={nextTick:ws,title:ys,browser:Fs,env:{NODE_ENV:"production"},argv:vs,version:bs,versions:xs,on:ks,addListener:Bs,once:Rs,off:Ts,removeListener:$s,removeAllListeners:Os,emit:Ps,binding:Ns,cwd:Is,chdir:Ls,umask:Ms,hrtime:js,platform:As,release:_s,config:Ss,uptime:zs};function Gs(r,e,t){return t={path:e,exports:{},require:function(i,n){return qs(i,n==null?t.path:n)}},r(t,t.exports),t.exports}function qs(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}const Ee="\\\\/",Ci=`[^${Ee}]`,xe="\\.",Js="\\+",Vs="\\?",Tt="\\/",Ks="(?=.)",wi="[^/]",gr=`(?:${Tt}|$)`,yi=`(?:^|${Tt})`,Dr=`${xe}{1,2}${gr}`,Xs=`(?!${xe})`,Qs=`(?!${yi}${Dr})`,Ys=`(?!${xe}{0,1}${gr})`,Zs=`(?!${Dr})`,eu=`[^.${Tt}]`,tu=`${wi}*?`,Ai={DOT_LITERAL:xe,PLUS_LITERAL:Js,QMARK_LITERAL:Vs,SLASH_LITERAL:Tt,ONE_CHAR:Ks,QMARK:wi,END_ANCHOR:gr,DOTS_SLASH:Dr,NO_DOT:Xs,NO_DOTS:Qs,NO_DOT_SLASH:Ys,NO_DOTS_SLASH:Zs,QMARK_NO_DOT:eu,STAR:tu,START_ANCHOR:yi},ru=kt(et({},Ai),{SLASH_LITERAL:`[${Ee}]`,QMARK:Ci,STAR:`${Ci}*?`,DOTS_SLASH:`${xe}{1,2}(?:[${Ee}]|$)`,NO_DOT:`(?!${xe})`,NO_DOTS:`(?!(?:^|[${Ee}])${xe}{1,2}(?:[${Ee}]|$))`,NO_DOT_SLASH:`(?!${xe}{0,1}(?:[${Ee}]|$))`,NO_DOTS_SLASH:`(?!${xe}{1,2}(?:[${Ee}]|$))`,QMARK_NO_DOT:`[^.${Ee}]`,START_ANCHOR:`(?:^|[${Ee}])`,END_ANCHOR:`(?:[${Ee}]|$)`}),iu={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};var We={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:iu,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:pr.sep,extglobChars(r){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${r.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(r){return r===!0?ru:Ai}},Z=Gs(function(r,e){const{REGEX_BACKSLASH:t,REGEX_REMOVE_BACKSLASH:i,REGEX_SPECIAL_CHARS:n,REGEX_SPECIAL_CHARS_GLOBAL:s}=We;e.isObject=u=>u!==null&&typeof u=="object"&&!Array.isArray(u),e.hasRegexChars=u=>n.test(u),e.isRegexChar=u=>u.length===1&&e.hasRegexChars(u),e.escapeRegex=u=>u.replace(s,"\\$1"),e.toPosixSlashes=u=>u.replace(t,"/"),e.removeBackslashes=u=>u.replace(i,a=>a==="\\"?"":a),e.supportsLookbehinds=()=>{const u=Ws.version.slice(1).split(".").map(Number);return u.length===3&&u[0]>=9||u[0]===8&&u[1]>=10},e.isWindows=u=>u&&typeof u.windows=="boolean"?u.windows:pr.sep==="\\",e.escapeLast=(u,a,o)=>{const l=u.lastIndexOf(a,o);return l===-1?u:u[l-1]==="\\"?e.escapeLast(u,a,l-1):`${u.slice(0,l)}\\${u.slice(l)}`},e.removePrefix=(u,a={})=>{let o=u;return o.startsWith("./")&&(o=o.slice(2),a.prefix="./"),o},e.wrapOutput=(u,a={},o={})=>{const l=o.contains?"":"^",h=o.contains?"":"$";let c=`${l}(?:${u})${h}`;return a.negated===!0&&(c=`(?:^(?!${c}).*$)`),c}});const{CHAR_ASTERISK:mr,CHAR_AT:nu,CHAR_BACKWARD_SLASH:ct,CHAR_COMMA:su,CHAR_DOT:Er,CHAR_EXCLAMATION_MARK:Cr,CHAR_FORWARD_SLASH:Fi,CHAR_LEFT_CURLY_BRACE:wr,CHAR_LEFT_PARENTHESES:yr,CHAR_LEFT_SQUARE_BRACKET:uu,CHAR_PLUS:au,CHAR_QUESTION_MARK:vi,CHAR_RIGHT_CURLY_BRACE:ou,CHAR_RIGHT_PARENTHESES:bi,CHAR_RIGHT_SQUARE_BRACKET:lu}=We,xi=r=>r===Fi||r===ct,_i=r=>{r.isPrefix!==!0&&(r.depth=r.isGlobstar?1/0:1)};var cu=(r,e)=>{const t=e||{},i=r.length-1,n=t.parts===!0||t.scanToEnd===!0,s=[],u=[],a=[];let o=r,l=-1,h=0,c=0,f=!1,D=!1,F=!1,y=!1,d=!1,p=!1,w=!1,v=!1,A=!1,b=!1,x=0,B,_,R={value:"",depth:0,isGlob:!1};const q=()=>l>=i,E=()=>o.charCodeAt(l+1),H=()=>(B=_,o.charCodeAt(++l));for(;l<i;){_=H();let ie;if(_===ct){w=R.backslashes=!0,_=H(),_===wr&&(p=!0);continue}if(p===!0||_===wr){for(x++;q()!==!0&&(_=H());){if(_===ct){w=R.backslashes=!0,H();continue}if(_===wr){x++;continue}if(p!==!0&&_===Er&&(_=H())===Er){if(f=R.isBrace=!0,F=R.isGlob=!0,b=!0,n===!0)continue;break}if(p!==!0&&_===su){if(f=R.isBrace=!0,F=R.isGlob=!0,b=!0,n===!0)continue;break}if(_===ou&&(x--,x===0)){p=!1,f=R.isBrace=!0,b=!0;break}}if(n===!0)continue;break}if(_===Fi){if(s.push(l),u.push(R),R={value:"",depth:0,isGlob:!1},b===!0)continue;if(B===Er&&l===h+1){h+=2;continue}c=l+1;continue}if(t.noext!==!0&&(_===au||_===nu||_===mr||_===vi||_===Cr)===!0&&E()===yr){if(F=R.isGlob=!0,y=R.isExtglob=!0,b=!0,_===Cr&&l===h&&(A=!0),n===!0){for(;q()!==!0&&(_=H());){if(_===ct){w=R.backslashes=!0,_=H();continue}if(_===bi){F=R.isGlob=!0,b=!0;break}}continue}break}if(_===mr){if(B===mr&&(d=R.isGlobstar=!0),F=R.isGlob=!0,b=!0,n===!0)continue;break}if(_===vi){if(F=R.isGlob=!0,b=!0,n===!0)continue;break}if(_===uu){for(;q()!==!0&&(ie=H());){if(ie===ct){w=R.backslashes=!0,H();continue}if(ie===lu){D=R.isBracket=!0,F=R.isGlob=!0,b=!0;break}}if(n===!0)continue;break}if(t.nonegate!==!0&&_===Cr&&l===h){v=R.negated=!0,h++;continue}if(t.noparen!==!0&&_===yr){if(F=R.isGlob=!0,n===!0){for(;q()!==!0&&(_=H());){if(_===yr){w=R.backslashes=!0,_=H();continue}if(_===bi){b=!0;break}}continue}break}if(F===!0){if(b=!0,n===!0)continue;break}}t.noext===!0&&(y=!1,F=!1);let N=o,fe="",m="";h>0&&(fe=o.slice(0,h),o=o.slice(h),c-=h),N&&F===!0&&c>0?(N=o.slice(0,c),m=o.slice(c)):F===!0?(N="",m=o):N=o,N&&N!==""&&N!=="/"&&N!==o&&xi(N.charCodeAt(N.length-1))&&(N=N.slice(0,-1)),t.unescape===!0&&(m&&(m=Z.removeBackslashes(m)),N&&w===!0&&(N=Z.removeBackslashes(N)));const g={prefix:fe,input:r,start:h,base:N,glob:m,isBrace:f,isBracket:D,isGlob:F,isExtglob:y,isGlobstar:d,negated:v,negatedExtglob:A};if(t.tokens===!0&&(g.maxDepth=0,xi(_)||u.push(R),g.tokens=u),t.parts===!0||t.tokens===!0){let ie;for(let M=0;M<s.length;M++){const le=ie?ie+1:h,ne=s[M],ue=r.slice(le,ne);t.tokens&&(M===0&&h!==0?(u[M].isPrefix=!0,u[M].value=fe):u[M].value=ue,_i(u[M]),g.maxDepth+=u[M].depth),(M!==0||ue!=="")&&a.push(ue),ie=ne}if(ie&&ie+1<r.length){const M=r.slice(ie+1);a.push(M),t.tokens&&(u[u.length-1].value=M,_i(u[u.length-1]),g.maxDepth+=u[u.length-1].depth)}g.slashes=s,g.parts=a}return g};const{MAX_LENGTH:$t,POSIX_REGEX_SOURCE:hu,REGEX_NON_SPECIAL_CHARS:fu,REGEX_SPECIAL_CHARS_BACKREF:du,REPLACEMENTS:Si}=We,pu=(r,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...r,e);r.sort();const t=`[${r.join("-")}]`;try{new RegExp(t)}catch{return r.map(n=>Z.escapeRegex(n)).join("..")}return t},nt=(r,e)=>`Missing ${r}: "${e}" - use "\\\\${e}" to match literal characters`,ki=(r,e)=>{if(typeof r!="string")throw new TypeError("Expected a string");r=Si[r]||r;const t=et({},e),i=typeof t.maxLength=="number"?Math.min($t,t.maxLength):$t;let n=r.length;if(n>i)throw new SyntaxError(`Input length: ${n}, exceeds maximum allowed length: ${i}`);const s={type:"bos",value:"",output:t.prepend||""},u=[s],a=t.capture?"":"?:",o=Z.isWindows(e),l=We.globChars(o),h=We.extglobChars(l),{DOT_LITERAL:c,PLUS_LITERAL:f,SLASH_LITERAL:D,ONE_CHAR:F,DOTS_SLASH:y,NO_DOT:d,NO_DOT_SLASH:p,NO_DOTS_SLASH:w,QMARK:v,QMARK_NO_DOT:A,STAR:b,START_ANCHOR:x}=l,B=k=>`(${a}(?:(?!${x}${k.dot?y:c}).)*?)`,_=t.dot?"":d,R=t.dot?v:A;let q=t.bash===!0?B(t):b;t.capture&&(q=`(${q})`),typeof t.noext=="boolean"&&(t.noextglob=t.noext);const E={input:r,index:-1,start:0,dot:t.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:u};r=Z.removePrefix(r,E),n=r.length;const H=[],N=[],fe=[];let m=s,g;const ie=()=>E.index===n-1,M=E.peek=(k=1)=>r[E.index+k],le=E.advance=()=>r[++E.index]||"",ne=()=>r.slice(E.index+1),ue=(k="",J=0)=>{E.consumed+=k,E.index+=J},Fe=k=>{E.output+=k.output!=null?k.output:k.value,ue(k.value)},xt=()=>{let k=1;for(;M()==="!"&&(M(2)!=="("||M(3)==="?");)le(),E.start++,k++;return k%2===0?!1:(E.negated=!0,E.start++,!0)},Le=k=>{E[k]++,fe.push(k)},ve=k=>{E[k]--,fe.pop()},P=k=>{if(m.type==="globstar"){const J=E.braces>0&&(k.type==="comma"||k.type==="brace"),S=k.extglob===!0||H.length&&(k.type==="pipe"||k.type==="paren");k.type!=="slash"&&k.type!=="paren"&&!J&&!S&&(E.output=E.output.slice(0,-m.output.length),m.type="star",m.value="*",m.output=q,E.output+=m.output)}if(H.length&&k.type!=="paren"&&(H[H.length-1].inner+=k.value),(k.value||k.output)&&Fe(k),m&&m.type==="text"&&k.type==="text"){m.value+=k.value,m.output=(m.output||"")+k.value;return}k.prev=m,u.push(k),m=k},Qe=(k,J)=>{const S=kt(et({},h[J]),{conditions:1,inner:""});S.prev=m,S.parens=E.parens,S.output=E.output;const I=(t.capture?"(":"")+S.open;Le("parens"),P({type:k,value:J,output:E.output?"":F}),P({type:"paren",extglob:!0,value:le(),output:I}),H.push(S)},Zt=k=>{let J=k.close+(t.capture?")":""),S;if(k.type==="negate"){let I=q;k.inner&&k.inner.length>1&&k.inner.includes("/")&&(I=B(t)),(I!==q||ie()||/^\)+$/.test(ne()))&&(J=k.close=`)$))${I}`),k.inner.includes("*")&&(S=ne())&&/^\.[^\\/.]+$/.test(S)&&(J=k.close=`)${S})${I})`),k.prev.type==="bos"&&(E.negatedExtglob=!0)}P({type:"paren",extglob:!0,value:g,output:J}),ve("parens")};if(t.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(r)){let k=!1,J=r.replace(du,(S,I,Q,oe,Y,Kr)=>oe==="\\"?(k=!0,S):oe==="?"?I?I+oe+(Y?v.repeat(Y.length):""):Kr===0?R+(Y?v.repeat(Y.length):""):v.repeat(Q.length):oe==="."?c.repeat(Q.length):oe==="*"?I?I+oe+(Y?q:""):q:I?S:`\\${S}`);return k===!0&&(t.unescape===!0?J=J.replace(/\\/g,""):J=J.replace(/\\+/g,S=>S.length%2===0?"\\\\":S?"\\":"")),J===r&&t.contains===!0?(E.output=r,E):(E.output=Z.wrapOutput(J,E,e),E)}for(;!ie();){if(g=le(),g==="\0")continue;if(g==="\\"){const S=M();if(S==="/"&&t.bash!==!0||S==="."||S===";")continue;if(!S){g+="\\",P({type:"text",value:g});continue}const I=/^\\+/.exec(ne());let Q=0;if(I&&I[0].length>2&&(Q=I[0].length,E.index+=Q,Q%2!==0&&(g+="\\")),t.unescape===!0?g=le():g+=le(),E.brackets===0){P({type:"text",value:g});continue}}if(E.brackets>0&&(g!=="]"||m.value==="["||m.value==="[^")){if(t.posix!==!1&&g===":"){const S=m.value.slice(1);if(S.includes("[")&&(m.posix=!0,S.includes(":"))){const I=m.value.lastIndexOf("["),Q=m.value.slice(0,I),oe=m.value.slice(I+2),Y=hu[oe];if(Y){m.value=Q+Y,E.backtrack=!0,le(),!s.output&&u.indexOf(m)===1&&(s.output=F);continue}}}(g==="["&&M()!==":"||g==="-"&&M()==="]")&&(g=`\\${g}`),g==="]"&&(m.value==="["||m.value==="[^")&&(g=`\\${g}`),t.posix===!0&&g==="!"&&m.value==="["&&(g="^"),m.value+=g,Fe({value:g});continue}if(E.quotes===1&&g!=='"'){g=Z.escapeRegex(g),m.value+=g,Fe({value:g});continue}if(g==='"'){E.quotes=E.quotes===1?0:1,t.keepQuotes===!0&&P({type:"text",value:g});continue}if(g==="("){Le("parens"),P({type:"paren",value:g});continue}if(g===")"){if(E.parens===0&&t.strictBrackets===!0)throw new SyntaxError(nt("opening","("));const S=H[H.length-1];if(S&&E.parens===S.parens+1){Zt(H.pop());continue}P({type:"paren",value:g,output:E.parens?")":"\\)"}),ve("parens");continue}if(g==="["){if(t.nobracket===!0||!ne().includes("]")){if(t.nobracket!==!0&&t.strictBrackets===!0)throw new SyntaxError(nt("closing","]"));g=`\\${g}`}else Le("brackets");P({type:"bracket",value:g});continue}if(g==="]"){if(t.nobracket===!0||m&&m.type==="bracket"&&m.value.length===1){P({type:"text",value:g,output:`\\${g}`});continue}if(E.brackets===0){if(t.strictBrackets===!0)throw new SyntaxError(nt("opening","["));P({type:"text",value:g,output:`\\${g}`});continue}ve("brackets");const S=m.value.slice(1);if(m.posix!==!0&&S[0]==="^"&&!S.includes("/")&&(g=`/${g}`),m.value+=g,Fe({value:g}),t.literalBrackets===!1||Z.hasRegexChars(S))continue;const I=Z.escapeRegex(m.value);if(E.output=E.output.slice(0,-m.value.length),t.literalBrackets===!0){E.output+=I,m.value=I;continue}m.value=`(${a}${I}|${m.value})`,E.output+=m.value;continue}if(g==="{"&&t.nobrace!==!0){Le("braces");const S={type:"brace",value:g,output:"(",outputIndex:E.output.length,tokensIndex:E.tokens.length};N.push(S),P(S);continue}if(g==="}"){const S=N[N.length-1];if(t.nobrace===!0||!S){P({type:"text",value:g,output:g});continue}let I=")";if(S.dots===!0){const Q=u.slice(),oe=[];for(let Y=Q.length-1;Y>=0&&(u.pop(),Q[Y].type!=="brace");Y--)Q[Y].type!=="dots"&&oe.unshift(Q[Y].value);I=pu(oe,t),E.backtrack=!0}if(S.comma!==!0&&S.dots!==!0){const Q=E.output.slice(0,S.outputIndex),oe=E.tokens.slice(S.tokensIndex);S.value=S.output="\\{",g=I="\\}",E.output=Q;for(const Y of oe)E.output+=Y.output||Y.value}P({type:"brace",value:g,output:I}),ve("braces"),N.pop();continue}if(g==="|"){H.length>0&&H[H.length-1].conditions++,P({type:"text",value:g});continue}if(g===","){let S=g;const I=N[N.length-1];I&&fe[fe.length-1]==="braces"&&(I.comma=!0,S="|"),P({type:"comma",value:g,output:S});continue}if(g==="/"){if(m.type==="dot"&&E.index===E.start+1){E.start=E.index+1,E.consumed="",E.output="",u.pop(),m=s;continue}P({type:"slash",value:g,output:D});continue}if(g==="."){if(E.braces>0&&m.type==="dot"){m.value==="."&&(m.output=c);const S=N[N.length-1];m.type="dots",m.output+=g,m.value+=g,S.dots=!0;continue}if(E.braces+E.parens===0&&m.type!=="bos"&&m.type!=="slash"){P({type:"text",value:g,output:c});continue}P({type:"dot",value:g,output:c});continue}if(g==="?"){if(!(m&&m.value==="(")&&t.noextglob!==!0&&M()==="("&&M(2)!=="?"){Qe("qmark",g);continue}if(m&&m.type==="paren"){const I=M();let Q=g;if(I==="<"&&!Z.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(m.value==="("&&!/[!=<:]/.test(I)||I==="<"&&!/<([!=]|\w+>)/.test(ne()))&&(Q=`\\${g}`),P({type:"text",value:g,output:Q});continue}if(t.dot!==!0&&(m.type==="slash"||m.type==="bos")){P({type:"qmark",value:g,output:A});continue}P({type:"qmark",value:g,output:v});continue}if(g==="!"){if(t.noextglob!==!0&&M()==="("&&(M(2)!=="?"||!/[!=<:]/.test(M(3)))){Qe("negate",g);continue}if(t.nonegate!==!0&&E.index===0){xt();continue}}if(g==="+"){if(t.noextglob!==!0&&M()==="("&&M(2)!=="?"){Qe("plus",g);continue}if(m&&m.value==="("||t.regex===!1){P({type:"plus",value:g,output:f});continue}if(m&&(m.type==="bracket"||m.type==="paren"||m.type==="brace")||E.parens>0){P({type:"plus",value:g});continue}P({type:"plus",value:f});continue}if(g==="@"){if(t.noextglob!==!0&&M()==="("&&M(2)!=="?"){P({type:"at",extglob:!0,value:g,output:""});continue}P({type:"text",value:g});continue}if(g!=="*"){(g==="$"||g==="^")&&(g=`\\${g}`);const S=fu.exec(ne());S&&(g+=S[0],E.index+=S[0].length),P({type:"text",value:g});continue}if(m&&(m.type==="globstar"||m.star===!0)){m.type="star",m.star=!0,m.value+=g,m.output=q,E.backtrack=!0,E.globstar=!0,ue(g);continue}let k=ne();if(t.noextglob!==!0&&/^\([^?]/.test(k)){Qe("star",g);continue}if(m.type==="star"){if(t.noglobstar===!0){ue(g);continue}const S=m.prev,I=S.prev,Q=S.type==="slash"||S.type==="bos",oe=I&&(I.type==="star"||I.type==="globstar");if(t.bash===!0&&(!Q||k[0]&&k[0]!=="/")){P({type:"star",value:g,output:""});continue}const Y=E.braces>0&&(S.type==="comma"||S.type==="brace"),Kr=H.length&&(S.type==="pipe"||S.type==="paren");if(!Q&&S.type!=="paren"&&!Y&&!Kr){P({type:"star",value:g,output:""});continue}for(;k.slice(0,3)==="/**";){const er=r[E.index+4];if(er&&er!=="/")break;k=k.slice(3),ue("/**",3)}if(S.type==="bos"&&ie()){m.type="globstar",m.value+=g,m.output=B(t),E.output=m.output,E.globstar=!0,ue(g);continue}if(S.type==="slash"&&S.prev.type!=="bos"&&!oe&&ie()){E.output=E.output.slice(0,-(S.output+m.output).length),S.output=`(?:${S.output}`,m.type="globstar",m.output=B(t)+(t.strictSlashes?")":"|$)"),m.value+=g,E.globstar=!0,E.output+=S.output+m.output,ue(g);continue}if(S.type==="slash"&&S.prev.type!=="bos"&&k[0]==="/"){const er=k[1]!==void 0?"|$":"";E.output=E.output.slice(0,-(S.output+m.output).length),S.output=`(?:${S.output}`,m.type="globstar",m.output=`${B(t)}${D}|${D}${er})`,m.value+=g,E.output+=S.output+m.output,E.globstar=!0,ue(g+le()),P({type:"slash",value:"/",output:""});continue}if(S.type==="bos"&&k[0]==="/"){m.type="globstar",m.value+=g,m.output=`(?:^|${D}|${B(t)}${D})`,E.output=m.output,E.globstar=!0,ue(g+le()),P({type:"slash",value:"/",output:""});continue}E.output=E.output.slice(0,-m.output.length),m.type="globstar",m.output=B(t),m.value+=g,E.output+=m.output,E.globstar=!0,ue(g);continue}const J={type:"star",value:g,output:q};if(t.bash===!0){J.output=".*?",(m.type==="bos"||m.type==="slash")&&(J.output=_+J.output),P(J);continue}if(m&&(m.type==="bracket"||m.type==="paren")&&t.regex===!0){J.output=g,P(J);continue}(E.index===E.start||m.type==="slash"||m.type==="dot")&&(m.type==="dot"?(E.output+=p,m.output+=p):t.dot===!0?(E.output+=w,m.output+=w):(E.output+=_,m.output+=_),M()!=="*"&&(E.output+=F,m.output+=F)),P(J)}for(;E.brackets>0;){if(t.strictBrackets===!0)throw new SyntaxError(nt("closing","]"));E.output=Z.escapeLast(E.output,"["),ve("brackets")}for(;E.parens>0;){if(t.strictBrackets===!0)throw new SyntaxError(nt("closing",")"));E.output=Z.escapeLast(E.output,"("),ve("parens")}for(;E.braces>0;){if(t.strictBrackets===!0)throw new SyntaxError(nt("closing","}"));E.output=Z.escapeLast(E.output,"{"),ve("braces")}if(t.strictSlashes!==!0&&(m.type==="star"||m.type==="bracket")&&P({type:"maybe_slash",value:"",output:`${D}?`}),E.backtrack===!0){E.output="";for(const k of E.tokens)E.output+=k.output!=null?k.output:k.value,k.suffix&&(E.output+=k.suffix)}return E};ki.fastpaths=(r,e)=>{const t=et({},e),i=typeof t.maxLength=="number"?Math.min($t,t.maxLength):$t,n=r.length;if(n>i)throw new SyntaxError(`Input length: ${n}, exceeds maximum allowed length: ${i}`);r=Si[r]||r;const s=Z.isWindows(e),{DOT_LITERAL:u,SLASH_LITERAL:a,ONE_CHAR:o,DOTS_SLASH:l,NO_DOT:h,NO_DOTS:c,NO_DOTS_SLASH:f,STAR:D,START_ANCHOR:F}=We.globChars(s),y=t.dot?c:h,d=t.dot?f:h,p=t.capture?"":"?:",w={negated:!1,prefix:""};let v=t.bash===!0?".*?":D;t.capture&&(v=`(${v})`);const A=_=>_.noglobstar===!0?v:`(${p}(?:(?!${F}${_.dot?l:u}).)*?)`,b=_=>{switch(_){case"*":return`${y}${o}${v}`;case".*":return`${u}${o}${v}`;case"*.*":return`${y}${v}${u}${o}${v}`;case"*/*":return`${y}${v}${a}${o}${d}${v}`;case"**":return y+A(t);case"**/*":return`(?:${y}${A(t)}${a})?${d}${o}${v}`;case"**/*.*":return`(?:${y}${A(t)}${a})?${d}${v}${u}${o}${v}`;case"**/.*":return`(?:${y}${A(t)}${a})?${u}${o}${v}`;default:{const R=/^(.*?)\.(\w+)$/.exec(_);if(!R)return;const q=b(R[1]);return q?q+u+R[2]:void 0}}},x=Z.removePrefix(r,w);let B=b(x);return B&&t.strictSlashes!==!0&&(B+=`${a}?`),B};var Ar=ki;const gu=r=>r&&typeof r=="object"&&!Array.isArray(r),V=(r,e,t=!1)=>{if(Array.isArray(r)){const h=r.map(f=>V(f,e,t));return f=>{for(const D of h){const F=D(f);if(F)return F}return!1}}const i=gu(r)&&r.tokens&&r.input;if(r===""||typeof r!="string"&&!i)throw new TypeError("Expected pattern to be a non-empty string");const n=e||{},s=Z.isWindows(e),u=i?V.compileRe(r,e):V.makeRe(r,e,!1,!0),a=u.state;delete u.state;let o=()=>!1;if(n.ignore){const h=kt(et({},e),{ignore:null,onMatch:null,onResult:null});o=V(n.ignore,h,t)}const l=(h,c=!1)=>{const{isMatch:f,match:D,output:F}=V.test(h,u,e,{glob:r,posix:s}),y={glob:r,state:a,regex:u,posix:s,input:h,output:F,match:D,isMatch:f};return typeof n.onResult=="function"&&n.onResult(y),f===!1?(y.isMatch=!1,c?y:!1):o(h)?(typeof n.onIgnore=="function"&&n.onIgnore(y),y.isMatch=!1,c?y:!1):(typeof n.onMatch=="function"&&n.onMatch(y),c?y:!0)};return t&&(l.state=a),l};V.test=(r,e,t,{glob:i,posix:n}={})=>{if(typeof r!="string")throw new TypeError("Expected input to be a string");if(r==="")return{isMatch:!1,output:""};const s=t||{},u=s.format||(n?Z.toPosixSlashes:null);let a=r===i,o=a&&u?u(r):r;return a===!1&&(o=u?u(r):r,a=o===i),(a===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?a=V.matchBase(r,e,t,n):a=e.exec(o)),{isMatch:Boolean(a),match:a,output:o}},V.matchBase=(r,e,t,i=Z.isWindows(t))=>(e instanceof RegExp?e:V.makeRe(e,t)).test(pr.basename(r)),V.isMatch=(r,e,t)=>V(e,t)(r),V.parse=(r,e)=>Array.isArray(r)?r.map(t=>V.parse(t,e)):Ar(r,kt(et({},e),{fastpaths:!1})),V.scan=(r,e)=>cu(r,e),V.compileRe=(r,e,t=!1,i=!1)=>{if(t===!0)return r.output;const n=e||{},s=n.contains?"":"^",u=n.contains?"":"$";let a=`${s}(?:${r.output})${u}`;r&&r.negated===!0&&(a=`^(?!${a}).*$`);const o=V.toRegex(a,e);return i===!0&&(o.state=r),o},V.makeRe=(r,e={},t=!1,i=!1)=>{if(!r||typeof r!="string")throw new TypeError("Expected a non-empty string");let n={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(r[0]==="."||r[0]==="*")&&(n.output=Ar.fastpaths(r,e)),n.output||(n=Ar(r,e)),V.compileRe(n,e,t,i)},V.toRegex=(r,e)=>{try{const t=e||{};return new RegExp(r,t.flags||(t.nocase?"i":""))}catch(t){if(e&&e.debug===!0)throw t;return/$^/}},V.constants=We;var Du=V,mu=Du;function Ot(r,e){return Array.isArray(e)?e.some(t=>Ot(r,t)):mu(e)(r)}function ht(r,e,t){var i,n;if(e===void 0)return;if(r.length===0)return t(e);if(typeof e!="object"||e===null)return;const s=r.shift();if(s==="**"){for(;r.length>0&&r[0]==="*";)r.shift();const u=["**",...r].join("/"),a=new Set;Bi("",e,a);for(const o of a)Ot(o,u)&&ht(o.split("/"),e,t)}else if(s.startsWith("*")){let u;s.length>=1&&(u=new RegExp((n=(i=s.match(/(\*{)(.+)(})/))==null?void 0:i[2])!=null?n:".*"));for(const a in e)u&&a.match(u)!==null&&ht([...r],e[a],t)}else ht(r,e[s],t)}function Bi(r,e,t){for(const i in e)t.add(`${r}${i}`),typeof e[i]=="object"&&Bi(`${r}${i}/`,e[i],t)}function Eu(r,e,t){const i=r.length===0||r==="/"?[]:r.split("/");return ht(i,e,t)}function Ri(r,e,t){const i=r.length===0||r==="/"?[]:r.split("/");if(i.length===0)return;const n=i.pop();ht(i,e,s=>{if(typeof s=="object")if(n==="*")for(const u in s)s[u]=t(s[u]);else s[n]!==void 0&&(s[n]=t(s[n]))})}function Cu(r,e){let t=!1;for(const i of e)if(Eu(i,r,()=>t=!0),t)return!0;return!1}function ft(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(Array.isArray(r))return r.concat([e]);if(Array.isArray(e))return e.concat([r]);if(typeof e!="object")return e;let t={};for(const i in r)e[i]===void 0?t[i]=r[i]:t[i]=ft(r[i],e[i]);for(const i in e)r[i]===void 0&&(t[i]=e[i]);return t}function wu(r,e,t){if(e.length===0)return r;let i=r;for(let n=0;n<e.length;n++){if(i===void 0)return t;i=i[e[n]]}return i}function yu(r){return Array.from(r).map(e=>("00"+e.toString(16)).slice(-2)).join("")}async function Au(r){return new Uint8Array(await crypto.subtle.digest("sha-1",r))}const Fu=new TextEncoder;async function Fr(r){const e=Fu.encode(r);if(!e)return"";const t=await Au(e);return yu(t)}function vu(r){return r==="true"?!0:r==="false"?!1:r==="null"?null:r==="undefined"?void 0:bu(r)?Number(r):typeof r=="string"&&r.startsWith('"')&&r.endsWith('"')?r.slice(1,-1):r}function bu(r){return!isNaN(Number(r))}function Ti(r){let e=0,t=0,i=!1,n=0,s=0,u="",a=[];for(;n<r.length;){if(r[n]==="^"&&u[0]==="^"||r[n]==="~"&&u[0]==="~")a.push({startColumn:s,endColumn:n,word:u}),s=n+1,u=r[n];else if(r[n]==='"')u+=r[n],i&&(a.push({startColumn:s,endColumn:n,word:u}),s=n+1,u=""),i=!i;else if(r[n]===" "||r[n]==="	"){if(i){u+=r[n],n++;continue}e===0&&t===0&&u!==""&&(a.push({startColumn:s,endColumn:n,word:u}),s=n+1,u="")}else r[n]==="{"?e++:r[n]==="}"?e--:r[n]==="["?t++:r[n]==="]"&&t--,r[n].trim()!==""&&(u+=r[n]);n++}return a.push({startColumn:s,endColumn:n,word:u}),{tokens:a}}function Ce(r){if(typeof r!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(r))}function $i(r,e){for(var t="",i=0,n=-1,s=0,u,a=0;a<=r.length;++a){if(a<r.length)u=r.charCodeAt(a);else{if(u===47)break;u=47}if(u===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(t.length<2||i!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var o=t.lastIndexOf("/");if(o!==t.length-1){o===-1?(t="",i=0):(t=t.slice(0,o),i=t.length-1-t.lastIndexOf("/")),n=a,s=0;continue}}else if(t.length===2||t.length===1){t="",i=0,n=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",i=2)}else t.length>0?t+="/"+r.slice(n+1,a):t=r.slice(n+1,a),i=a-n-1;n=a,s=0}else u===46&&s!==-1?++s:s=-1}return t}function xu(r,e){var t=e.dir||e.root,i=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+i:t+r+i:i}var st={resolve:function(){for(var e="",t=!1,i,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(i===void 0&&(i=process.cwd()),s=i),Ce(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=$i(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(Ce(e),e.length===0)return".";var t=e.charCodeAt(0)===47,i=e.charCodeAt(e.length-1)===47;return e=$i(e,!t),e.length===0&&!t&&(e="."),e.length>0&&i&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return Ce(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var i=arguments[t];Ce(i),i.length>0&&(e===void 0?e=i:e+="/"+i)}return e===void 0?".":st.normalize(e)},relative:function(e,t){if(Ce(e),Ce(t),e===t||(e=st.resolve(e),t=st.resolve(t),e===t))return"";for(var i=1;i<e.length&&e.charCodeAt(i)===47;++i);for(var n=e.length,s=n-i,u=1;u<t.length&&t.charCodeAt(u)===47;++u);for(var a=t.length,o=a-u,l=s<o?s:o,h=-1,c=0;c<=l;++c){if(c===l){if(o>l){if(t.charCodeAt(u+c)===47)return t.slice(u+c+1);if(c===0)return t.slice(u+c)}else s>l&&(e.charCodeAt(i+c)===47?h=c:c===0&&(h=0));break}var f=e.charCodeAt(i+c),D=t.charCodeAt(u+c);if(f!==D)break;f===47&&(h=c)}var F="";for(c=i+h+1;c<=n;++c)(c===n||e.charCodeAt(c)===47)&&(F.length===0?F+="..":F+="/..");return F.length>0?F+t.slice(u+h):(u+=h,t.charCodeAt(u)===47&&++u,t.slice(u))},_makeLong:function(e){return e},dirname:function(e){if(Ce(e),e.length===0)return".";for(var t=e.charCodeAt(0),i=t===47,n=-1,s=!0,u=e.length-1;u>=1;--u)if(t=e.charCodeAt(u),t===47){if(!s){n=u;break}}else s=!1;return n===-1?i?"/":".":i&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');Ce(e);var i=0,n=-1,s=!0,u;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,o=-1;for(u=e.length-1;u>=0;--u){var l=e.charCodeAt(u);if(l===47){if(!s){i=u+1;break}}else o===-1&&(s=!1,o=u+1),a>=0&&(l===t.charCodeAt(a)?--a===-1&&(n=u):(a=-1,n=o))}return i===n?n=o:n===-1&&(n=e.length),e.slice(i,n)}else{for(u=e.length-1;u>=0;--u)if(e.charCodeAt(u)===47){if(!s){i=u+1;break}}else n===-1&&(s=!1,n=u+1);return n===-1?"":e.slice(i,n)}},extname:function(e){Ce(e);for(var t=-1,i=0,n=-1,s=!0,u=0,a=e.length-1;a>=0;--a){var o=e.charCodeAt(a);if(o===47){if(!s){i=a+1;break}continue}n===-1&&(s=!1,n=a+1),o===46?t===-1?t=a:u!==1&&(u=1):t!==-1&&(u=-1)}return t===-1||n===-1||u===0||u===1&&t===n-1&&t===i+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return xu("/",e)},parse:function(e){Ce(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var i=e.charCodeAt(0),n=i===47,s;n?(t.root="/",s=1):s=0;for(var u=-1,a=0,o=-1,l=!0,h=e.length-1,c=0;h>=s;--h){if(i=e.charCodeAt(h),i===47){if(!l){a=h+1;break}continue}o===-1&&(l=!1,o=h+1),i===46?u===-1?u=h:c!==1&&(c=1):u!==-1&&(c=-1)}return u===-1||o===-1||c===0||c===1&&u===o-1&&u===a+1?o!==-1&&(a===0&&n?t.base=t.name=e.slice(1,o):t.base=t.name=e.slice(a,o)):(a===0&&n?(t.name=e.slice(1,u),t.base=e.slice(1,o)):(t.name=e.slice(a,u),t.base=e.slice(a,o)),t.ext=e.slice(u,o)),a>0?t.dir=e.slice(0,a-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};st.posix=st;var $=st,_u=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,Su=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,ku=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,vr={Space_Separator:_u,ID_Start:Su,ID_Continue:ku},K={isSpaceSeparator(r){return typeof r=="string"&&vr.Space_Separator.test(r)},isIdStartChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r==="$"||r==="_"||vr.ID_Start.test(r))},isIdContinueChar(r){return typeof r=="string"&&(r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"||r==="$"||r==="_"||r==="\u200C"||r==="\u200D"||vr.ID_Continue.test(r))},isDigit(r){return typeof r=="string"&&/[0-9]/.test(r)},isHexDigit(r){return typeof r=="string"&&/[0-9A-Fa-f]/.test(r)}};let br,ae,_e,Pt,Pe,ge,ee,xr,dt;var Bu=function(e,t){br=String(e),ae="start",_e=[],Pt=0,Pe=1,ge=0,ee=void 0,xr=void 0,dt=void 0;do ee=Ru(),Ou[ae]();while(ee.type!=="eof");return typeof t=="function"?Oi({"":dt},"",t):dt};function Oi(r,e,t){const i=r[e];if(i!=null&&typeof i=="object")for(const n in i){const s=Oi(i,n,t);s===void 0?delete i[n]:i[n]=s}return t.call(r,e,i)}let O,T,pt,Se,L;function Ru(){for(O="default",T="",pt=!1,Se=1;;){L=ke();const r=Pi[O]();if(r)return r}}function ke(){if(br[Pt])return String.fromCodePoint(br.codePointAt(Pt))}function C(){const r=ke();return r===`
`?(Pe++,ge=0):r?ge+=r.length:ge++,r&&(Pt+=r.length),r}const Pi={default(){switch(L){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":C();return;case"/":C(),O="comment";return;case void 0:return C(),U("eof")}if(K.isSpaceSeparator(L)){C();return}return Pi[ae]()},comment(){switch(L){case"*":C(),O="multiLineComment";return;case"/":C(),O="singleLineComment";return}throw z(C())},multiLineComment(){switch(L){case"*":C(),O="multiLineCommentAsterisk";return;case void 0:throw z(C())}C()},multiLineCommentAsterisk(){switch(L){case"*":C();return;case"/":C(),O="default";return;case void 0:throw z(C())}C(),O="multiLineComment"},singleLineComment(){switch(L){case`
`:case"\r":case"\u2028":case"\u2029":C(),O="default";return;case void 0:return C(),U("eof")}C()},value(){switch(L){case"{":case"[":return U("punctuator",C());case"n":return C(),Ge("ull"),U("null",null);case"t":return C(),Ge("rue"),U("boolean",!0);case"f":return C(),Ge("alse"),U("boolean",!1);case"-":case"+":C()==="-"&&(Se=-1),O="sign";return;case".":T=C(),O="decimalPointLeading";return;case"0":T=C(),O="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":T=C(),O="decimalInteger";return;case"I":return C(),Ge("nfinity"),U("numeric",1/0);case"N":return C(),Ge("aN"),U("numeric",NaN);case'"':case"'":pt=C()==='"',T="",O="string";return}throw z(C())},identifierNameStartEscape(){if(L!=="u")throw z(C());C();const r=_r();switch(r){case"$":case"_":break;default:if(!K.isIdStartChar(r))throw Ni();break}T+=r,O="identifierName"},identifierName(){switch(L){case"$":case"_":case"\u200C":case"\u200D":T+=C();return;case"\\":C(),O="identifierNameEscape";return}if(K.isIdContinueChar(L)){T+=C();return}return U("identifier",T)},identifierNameEscape(){if(L!=="u")throw z(C());C();const r=_r();switch(r){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!K.isIdContinueChar(r))throw Ni();break}T+=r,O="identifierName"},sign(){switch(L){case".":T=C(),O="decimalPointLeading";return;case"0":T=C(),O="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":T=C(),O="decimalInteger";return;case"I":return C(),Ge("nfinity"),U("numeric",Se*(1/0));case"N":return C(),Ge("aN"),U("numeric",NaN)}throw z(C())},zero(){switch(L){case".":T+=C(),O="decimalPoint";return;case"e":case"E":T+=C(),O="decimalExponent";return;case"x":case"X":T+=C(),O="hexadecimal";return}return U("numeric",Se*0)},decimalInteger(){switch(L){case".":T+=C(),O="decimalPoint";return;case"e":case"E":T+=C(),O="decimalExponent";return}if(K.isDigit(L)){T+=C();return}return U("numeric",Se*Number(T))},decimalPointLeading(){if(K.isDigit(L)){T+=C(),O="decimalFraction";return}throw z(C())},decimalPoint(){switch(L){case"e":case"E":T+=C(),O="decimalExponent";return}if(K.isDigit(L)){T+=C(),O="decimalFraction";return}return U("numeric",Se*Number(T))},decimalFraction(){switch(L){case"e":case"E":T+=C(),O="decimalExponent";return}if(K.isDigit(L)){T+=C();return}return U("numeric",Se*Number(T))},decimalExponent(){switch(L){case"+":case"-":T+=C(),O="decimalExponentSign";return}if(K.isDigit(L)){T+=C(),O="decimalExponentInteger";return}throw z(C())},decimalExponentSign(){if(K.isDigit(L)){T+=C(),O="decimalExponentInteger";return}throw z(C())},decimalExponentInteger(){if(K.isDigit(L)){T+=C();return}return U("numeric",Se*Number(T))},hexadecimal(){if(K.isHexDigit(L)){T+=C(),O="hexadecimalInteger";return}throw z(C())},hexadecimalInteger(){if(K.isHexDigit(L)){T+=C();return}return U("numeric",Se*Number(T))},string(){switch(L){case"\\":C(),T+=Tu();return;case'"':if(pt)return C(),U("string",T);T+=C();return;case"'":if(!pt)return C(),U("string",T);T+=C();return;case`
`:case"\r":throw z(C());case"\u2028":case"\u2029":Pu(L);break;case void 0:throw z(C())}T+=C()},start(){switch(L){case"{":case"[":return U("punctuator",C())}O="value"},beforePropertyName(){switch(L){case"$":case"_":T=C(),O="identifierName";return;case"\\":C(),O="identifierNameStartEscape";return;case"}":return U("punctuator",C());case'"':case"'":pt=C()==='"',O="string";return}if(K.isIdStartChar(L)){T+=C(),O="identifierName";return}throw z(C())},afterPropertyName(){if(L===":")return U("punctuator",C());throw z(C())},beforePropertyValue(){O="value"},afterPropertyValue(){switch(L){case",":case"}":return U("punctuator",C())}throw z(C())},beforeArrayValue(){if(L==="]")return U("punctuator",C());O="value"},afterArrayValue(){switch(L){case",":case"]":return U("punctuator",C())}throw z(C())},end(){throw z(C())}};function U(r,e){return{type:r,value:e,line:Pe,column:ge}}function Ge(r){for(const e of r){if(ke()!==e)throw z(C());C()}}function Tu(){switch(ke()){case"b":return C(),"\b";case"f":return C(),"\f";case"n":return C(),`
`;case"r":return C(),"\r";case"t":return C(),"	";case"v":return C(),"\v";case"0":if(C(),K.isDigit(ke()))throw z(C());return"\0";case"x":return C(),$u();case"u":return C(),_r();case`
`:case"\u2028":case"\u2029":return C(),"";case"\r":return C(),ke()===`
`&&C(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw z(C());case void 0:throw z(C())}return C()}function $u(){let r="",e=ke();if(!K.isHexDigit(e)||(r+=C(),e=ke(),!K.isHexDigit(e)))throw z(C());return r+=C(),String.fromCodePoint(parseInt(r,16))}function _r(){let r="",e=4;for(;e-- >0;){const t=ke();if(!K.isHexDigit(t))throw z(C());r+=C()}return String.fromCodePoint(parseInt(r,16))}const Ou={start(){if(ee.type==="eof")throw qe();Sr()},beforePropertyName(){switch(ee.type){case"identifier":case"string":xr=ee.value,ae="afterPropertyName";return;case"punctuator":Nt();return;case"eof":throw qe()}},afterPropertyName(){if(ee.type==="eof")throw qe();ae="beforePropertyValue"},beforePropertyValue(){if(ee.type==="eof")throw qe();Sr()},beforeArrayValue(){if(ee.type==="eof")throw qe();if(ee.type==="punctuator"&&ee.value==="]"){Nt();return}Sr()},afterPropertyValue(){if(ee.type==="eof")throw qe();switch(ee.value){case",":ae="beforePropertyName";return;case"}":Nt()}},afterArrayValue(){if(ee.type==="eof")throw qe();switch(ee.value){case",":ae="beforeArrayValue";return;case"]":Nt()}},end(){}};function Sr(){let r;switch(ee.type){case"punctuator":switch(ee.value){case"{":r={};break;case"[":r=[];break}break;case"null":case"boolean":case"numeric":case"string":r=ee.value;break}if(dt===void 0)dt=r;else{const e=_e[_e.length-1];Array.isArray(e)?e.push(r):e[xr]=r}if(r!==null&&typeof r=="object")_e.push(r),Array.isArray(r)?ae="beforeArrayValue":ae="beforePropertyName";else{const e=_e[_e.length-1];e==null?ae="end":Array.isArray(e)?ae="afterArrayValue":ae="afterPropertyValue"}}function Nt(){_e.pop();const r=_e[_e.length-1];r==null?ae="end":Array.isArray(r)?ae="afterArrayValue":ae="afterPropertyValue"}function z(r){return It(r===void 0?`JSON5: invalid end of input at ${Pe}:${ge}`:`JSON5: invalid character '${Ii(r)}' at ${Pe}:${ge}`)}function qe(){return It(`JSON5: invalid end of input at ${Pe}:${ge}`)}function Ni(){return ge-=5,It(`JSON5: invalid identifier character at ${Pe}:${ge}`)}function Pu(r){console.warn(`JSON5: '${Ii(r)}' in strings is not valid ECMAScript; consider escaping`)}function Ii(r){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[r])return e[r];if(r<" "){const t=r.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return r}function It(r){const e=new SyntaxError(r);return e.lineNumber=Pe,e.columnNumber=ge,e}var Nu=function(e,t,i){const n=[];let s="",u,a,o="",l;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(i=t.space,l=t.quote,t=t.replacer),typeof t=="function")a=t;else if(Array.isArray(t)){u=[];for(const y of t){let d;typeof y=="string"?d=y:(typeof y=="number"||y instanceof String||y instanceof Number)&&(d=String(y)),d!==void 0&&u.indexOf(d)<0&&u.push(d)}}return i instanceof Number?i=Number(i):i instanceof String&&(i=String(i)),typeof i=="number"?i>0&&(i=Math.min(10,Math.floor(i)),o="          ".substr(0,i)):typeof i=="string"&&(o=i.substr(0,10)),h("",{"":e});function h(y,d){let p=d[y];switch(p!=null&&(typeof p.toJSON5=="function"?p=p.toJSON5(y):typeof p.toJSON=="function"&&(p=p.toJSON(y))),a&&(p=a.call(d,y,p)),p instanceof Number?p=Number(p):p instanceof String?p=String(p):p instanceof Boolean&&(p=p.valueOf()),p){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof p=="string")return c(p);if(typeof p=="number")return String(p);if(typeof p=="object")return Array.isArray(p)?F(p):f(p)}function c(y){const d={"'":.1,'"':.2},p={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let w="";for(let A=0;A<y.length;A++){const b=y[A];switch(b){case"'":case'"':d[b]++,w+=b;continue;case"\0":if(K.isDigit(y[A+1])){w+="\\x00";continue}}if(p[b]){w+=p[b];continue}if(b<" "){let x=b.charCodeAt(0).toString(16);w+="\\x"+("00"+x).substring(x.length);continue}w+=b}const v=l||Object.keys(d).reduce((A,b)=>d[A]<d[b]?A:b);return w=w.replace(new RegExp(v,"g"),p[v]),v+w+v}function f(y){if(n.indexOf(y)>=0)throw TypeError("Converting circular structure to JSON5");n.push(y);let d=s;s=s+o;let p=u||Object.keys(y),w=[];for(const A of p){const b=h(A,y);if(b!==void 0){let x=D(A)+":";o!==""&&(x+=" "),x+=b,w.push(x)}}let v;if(w.length===0)v="{}";else{let A;if(o==="")A=w.join(","),v="{"+A+"}";else{let b=`,
`+s;A=w.join(b),v=`{
`+s+A+`,
`+d+"}"}}return n.pop(),s=d,v}function D(y){if(y.length===0)return c(y);const d=String.fromCodePoint(y.codePointAt(0));if(!K.isIdStartChar(d))return c(y);for(let p=d.length;p<y.length;p++)if(!K.isIdContinueChar(String.fromCodePoint(y.codePointAt(p))))return c(y);return y}function F(y){if(n.indexOf(y)>=0)throw TypeError("Converting circular structure to JSON5");n.push(y);let d=s;s=s+o;let p=[];for(let v=0;v<y.length;v++){const A=h(String(v),y);p.push(A!==void 0?A:"null")}let w;if(p.length===0)w="[]";else if(o===""){let v=p.join(",");w="["+v+"]"}else{let v=`,
`+s,A=p.join(v);w=`[
`+s+A+`,
`+d+"]"}return n.pop(),s=d,w}},we={parse:Bu,stringify:Nu};const Li={behaviorPack:"./BP",resourcePack:"./RP",skinPack:"./SP",worldTemplate:"./WT"};class Iu{constructor(e){this.basePath=e,this.data={}}async refreshConfig(){this.data=await this.readConfig()}async setup(){await this.refreshConfig()}get(){return this.data}getRelativePackRoot(e){var t,i;return(i=(t=this.data.packs)==null?void 0:t[e])!=null?i:Li[e]}getAbsolutePackRoot(e){return this.resolvePackPath(e)}resolvePackPath(e,t){return!t&&!e?this.basePath:!e&&t?$.join(this.basePath,t):!t&&e?$.join(this.basePath,this.getRelativePackRoot(e)):$.join(this.basePath,`${this.getRelativePackRoot(e)}/${t}`)}getAvailablePackPaths(){var e;const t=[];for(const i of Object.keys((e=this.data.packs)!=null?e:{}))t.push(this.resolvePackPath(i));return t}getAvailablePacks(){var e;const t={};for(const i in(e=this.data.packs)!=null?e:{})t[i]=this.resolvePackPath(i);return t}async save(){await this.writeConfig(this.data)}}class Lu{constructor(e){this.projectConfig=e,this.packTypes=[],this.extensionPackTypes=new Set}setProjectConfig(e){this.projectConfig=e}get all(){return this.packTypes.concat(...Array.from(this.extensionPackTypes.values()))}getFromId(e){return this.all.find(t=>t.id===e)}get(e){var t,i;const n=(i=(t=this.projectConfig)==null?void 0:t.getAvailablePacks())!=null?i:Li;for(const s in n)if(e.startsWith(n[s]))return this.getFromId(s)}getId(e){var t,i;return(i=(t=this.get(e))==null?void 0:t.id)!=null?i:"unknown"}addExtensionPackType(e){return this.extensionPackTypes.add(e),{dispose:()=>this.extensionPackTypes.delete(e)}}}class Mu{constructor(e,t){this.projectConfig=e,this.isMatch=t,this.pluginFileTypes=new Set,this._fileTypes=[]}get fileTypes(){return this._fileTypes}set fileTypes(e){this._fileTypes=e.sort((t,i)=>t.add==="post"&&i.add!=="post"?1:t.add!=="post"&&i.add==="post"||t.add==="pre"&&i.add!=="pre"?-1:t.add!=="pre"&&i.add==="pre"?1:0)}get all(){return this.fileTypes.concat([...this.pluginFileTypes.values()])}setProjectConfig(e){this.projectConfig=e}addPluginFileType(e){return this.pluginFileTypes.add(e),{dispose:()=>this.pluginFileTypes.delete(e)}}getPluginFileTypes(){return[...this.pluginFileTypes.values()]}setPluginFileTypes(e=[]){this.pluginFileTypes.clear(),e.forEach(t=>this.pluginFileTypes.add(t))}get(e,t,i=!0){var n,s,u,a,o,l,h,c,f,D,F,y,d;const p=e?$.extname(e):null;if(!!p)for(const w of this.all){if(t!==void 0&&t===w.id)return w;if(!e)continue;const v=((n=w.detect)==null?void 0:n.packType)===void 0?[]:Array.isArray((s=w.detect)==null?void 0:s.packType)?(u=w.detect)==null?void 0:u.packType:[(a=w.detect)==null?void 0:a.packType],A=(o=w.detect)==null?void 0:o.fileExtensions,b=!!((l=w.detect)!=null&&l.scope),x=Array.isArray((h=w.detect)==null?void 0:h.scope)?(c=w.detect)==null?void 0:c.scope:[(f=w.detect)==null?void 0:f.scope],B=!!((D=w.detect)!=null&&D.matcher),_=Array.isArray((F=w.detect)==null?void 0:F.matcher)?(y=w.detect)==null?void 0:y.matcher:[(d=w.detect)==null?void 0:d.matcher];if(!(i&&A&&!A.includes(p)))if(b){if(this.prefixMatchers(v,x).some(R=>e.startsWith(R)))return w}else if(B){const R=this.prefixMatchers(v,_.filter(E=>!E.startsWith("!"))),q=this.prefixMatchers(v,_.filter(E=>E.startsWith("!")).map(E=>E.slice(1)));if(this.isMatch(e,R)&&!this.isMatch(e,q))return w}else throw console.log(w),new Error('Invalid file definition, no "detect" properties')}}prefixMatchers(e,t){if(!this.projectConfig)return[];if(e.length===0)return t.map(n=>this.projectConfig.resolvePackPath(void 0,n));const i=[];for(const n of e)for(const s of t)i.push(this.projectConfig.resolvePackPath(n,s));return i}getIds(){const e=[];for(const t of this.all)e.push(t.id);return e}async guessFolder(e){var t;const i=(h,c)=>{var f,D;let F=Array.isArray(h)?h[0]:h;F.endsWith("/")||(F+="/");const y=(D=(f=this.projectConfig)==null?void 0:f.getAbsolutePackRoot(c))!=null?D:"./unknown";return $.join(y,F)},n=`.${e.name.split(".").pop()}`,s=this.all.filter(({detect:h})=>{var c;return!h||!h.scope?!1:(c=h.fileExtensions)==null?void 0:c.includes(n)}),u=s.length===1,a=n!==".json"&&s.length>0;if(u||a){const{detect:h}=s[0];return i(h.scope,Array.isArray(h.packType)?h.packType[0]:(t=h.packType)!=null?t:"behaviorPack")}if(n!==".json")return null;const o=await e.getFile();let l;try{l=we.parse(await o.text())}catch{return null}for(const{type:h,detect:c}of s){if(typeof h=="string"&&h!=="json")continue;const{scope:f,fileContent:D,packType:F="behaviorPack"}=c!=null?c:{};if(!(!f||!D)&&!!Cu(l,D))return i(f,Array.isArray(F)?F[0]:F)}return null}getId(e){var t,i;return(i=(t=this.get(e))==null?void 0:t.id)!=null?i:"unknown"}isJsonFile(e){var t,i;const n=(i=(t=this.get(e))==null?void 0:t.meta)==null?void 0:i.language;return n?n==="json":e.endsWith(".json")}}class Hu extends Mu{constructor(e){super(e,Ot),this.ready=new He,this.lCacheFiles={},this.lCacheFilesLoaded=new He,this.packSpiderFiles={},this.packSpiderFilesLoaded=new He}setProjectConfig(e){this.projectConfig=e}async setup(e){this.fileTypes.length>0||(await e.fired,this.fileTypes=await e.readJSON("data/packages/minecraftBedrock/fileDefinitions.json"),this.loadLightningCache(e),this.loadPackSpider(e),this.ready.dispatch())}getMonacoSchemaEntries(){return this.fileTypes.map(({detect:e={},schema:t})=>{if(!e.matcher)return null;const i=(e==null?void 0:e.packType)===void 0?[]:Array.isArray(e==null?void 0:e.packType)?e==null?void 0:e.packType:[e==null?void 0:e.packType];return{fileMatch:this.prefixMatchers(i,Array.isArray(e.matcher)?[...e.matcher]:[e.matcher]).map(n=>encodeURI(n).replaceAll(/;|,|@|&|=|\+|\$|\.|!|'|\(|\)|#/g,"*")),uri:t}}).filter(e=>e!==null).flat()}async loadLightningCache(e){var n;const t=await e.readJSON("data/packages/minecraftBedrock/lightningCaches.json"),i=s=>Object.entries(t).find(([u])=>u.endsWith(s));for(const s of this.fileTypes){if(!s.lightningCache)continue;const[u,a]=(n=i(s.lightningCache))!=null?n:[];if(!u)throw new Error(`Lightning cache file "${s.lightningCache}" for file type "${s.id}" not found`);this.lCacheFiles[s.lightningCache]=a}this.lCacheFilesLoaded.dispatch()}async getLightningCache(e){var i,n;const{lightningCache:t}=(i=this.get(e))!=null?i:{};return t?(await this.lCacheFilesLoaded.fired,(n=this.lCacheFiles[t])!=null?n:[]):[]}async loadPackSpider(e){const t=await e.readJSON("data/packages/minecraftBedrock/packSpiders.json");this.packSpiderFiles=Object.fromEntries(this.fileTypes.map(({id:i,packSpider:n})=>{if(!!n)return[i,t[`file:///data/packages/minecraftBedrock/packSpider/${n}`]]}).filter(i=>i!==void 0)),this.packSpiderFilesLoaded.dispatch()}async getPackSpiderData(){return await this.packSpiderFilesLoaded.fired,this.packSpiderFiles}}const ju="/";var Mi={},Uu=function(r,e,t,i,n){var s=Mi[e]||(Mi[e]=URL.createObjectURL(new Blob([r],{type:"text/javascript"}))),u=new Worker(s);return u.onerror=function(a){return n(a.error,null)},u.onmessage=function(a){return n(null,a.data)},u.postMessage(t,i),u},se=Uint8Array,ye=Uint16Array,gt=Uint32Array,kr=new se([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Br=new se([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Hi=new se([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ji=function(r,e){for(var t=new ye(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var n=new gt(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)n[s]=s-t[i]<<5|i;return[t,n]},Ui=ji(kr,2),Rr=Ui[0],zu=Ui[1];Rr[28]=258,zu[258]=28;for(var Wu=ji(Br,0),zi=Wu[0],Lt=new ye(32768),W=0;W<32768;++W){var Ne=(W&43690)>>>1|(W&21845)<<1;Ne=(Ne&52428)>>>2|(Ne&13107)<<2,Ne=(Ne&61680)>>>4|(Ne&3855)<<4,Lt[W]=((Ne&65280)>>>8|(Ne&255)<<8)>>>1}for(var ut=function(r,e,t){for(var i=r.length,n=0,s=new ye(e);n<i;++n)++s[r[n]-1];var u=new ye(e);for(n=0;n<e;++n)u[n]=u[n-1]+s[n-1]<<1;var a;if(t){a=new ye(1<<e);var o=15-e;for(n=0;n<i;++n)if(r[n])for(var l=n<<4|r[n],h=e-r[n],c=u[r[n]-1]++<<h,f=c|(1<<h)-1;c<=f;++c)a[Lt[c]>>>o]=l}else for(a=new ye(i),n=0;n<i;++n)r[n]&&(a[n]=Lt[u[r[n]-1]++]>>>15-r[n]);return a},Dt=new se(288),W=0;W<144;++W)Dt[W]=8;for(var W=144;W<256;++W)Dt[W]=9;for(var W=256;W<280;++W)Dt[W]=7;for(var W=280;W<288;++W)Dt[W]=8;for(var Wi=new se(32),W=0;W<32;++W)Wi[W]=5;var Gi=ut(Dt,9,1),qi=ut(Wi,5,1),Mt=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},de=function(r,e,t){var i=e/8|0;return(r[i]|r[i+1]<<8)>>(e&7)&t},Ht=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Ji=function(r){return(r/8|0)+(r&7&&1)},jt=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var i=new(r instanceof ye?ye:r instanceof gt?gt:se)(t-e);return i.set(r.subarray(e,t)),i},Vi=function(r,e,t){var i=r.length;if(!i||t&&!t.l&&i<5)return e||new se(0);var n=!e||t,s=!t||t.i;t||(t={}),e||(e=new se(i*3));var u=function(P){var Qe=e.length;if(P>Qe){var Zt=new se(Math.max(Qe*2,P));Zt.set(e),e=Zt}},a=t.f||0,o=t.p||0,l=t.b||0,h=t.l,c=t.d,f=t.m,D=t.n,F=i*8;do{if(!h){t.f=a=de(r,o,1);var y=de(r,o+1,3);if(o+=3,y)if(y==1)h=Gi,c=qi,f=9,D=5;else if(y==2){var v=de(r,o,31)+257,A=de(r,o+10,15)+4,b=v+de(r,o+5,31)+1;o+=14;for(var x=new se(b),B=new se(19),_=0;_<A;++_)B[Hi[_]]=de(r,o+_*3,7);o+=A*3;for(var R=Mt(B),q=(1<<R)-1,E=ut(B,R,1),_=0;_<b;){var H=E[de(r,o,q)];o+=H&15;var d=H>>>4;if(d<16)x[_++]=d;else{var N=0,fe=0;for(d==16?(fe=3+de(r,o,3),o+=2,N=x[_-1]):d==17?(fe=3+de(r,o,7),o+=3):d==18&&(fe=11+de(r,o,127),o+=7);fe--;)x[_++]=N}}var m=x.subarray(0,v),g=x.subarray(v);f=Mt(m),D=Mt(g),h=ut(m,f,1),c=ut(g,D,1)}else throw"invalid block type";else{var d=Ji(o)+4,p=r[d-4]|r[d-3]<<8,w=d+p;if(w>i){if(s)throw"unexpected EOF";break}n&&u(l+p),e.set(r.subarray(d,w),l),t.b=l+=p,t.p=o=w*8;continue}if(o>F){if(s)throw"unexpected EOF";break}}n&&u(l+131072);for(var ie=(1<<f)-1,M=(1<<D)-1,le=o;;le=o){var N=h[Ht(r,o)&ie],ne=N>>>4;if(o+=N&15,o>F){if(s)throw"unexpected EOF";break}if(!N)throw"invalid length/literal";if(ne<256)e[l++]=ne;else if(ne==256){le=o,h=null;break}else{var ue=ne-254;if(ne>264){var _=ne-257,Fe=kr[_];ue=de(r,o,(1<<Fe)-1)+Rr[_],o+=Fe}var xt=c[Ht(r,o)&M],Le=xt>>>4;if(!xt)throw"invalid distance";o+=xt&15;var g=zi[Le];if(Le>3){var Fe=Br[Le];g+=Ht(r,o)&(1<<Fe)-1,o+=Fe}if(o>F){if(s)throw"unexpected EOF";break}n&&u(l+131072);for(var ve=l+ue;l<ve;l+=4)e[l]=e[l-g],e[l+1]=e[l+1-g],e[l+2]=e[l+2-g],e[l+3]=e[l+3-g];l=ve}}t.l=h,t.p=le,t.b=l,h&&(a=1,t.m=f,t.d=c,t.n=D)}while(!a);return l==e.length?e:jt(e,0,l)},Gu=new se(0),qu=function(r,e){var t={};for(var i in r)t[i]=r[i];for(var i in e)t[i]=e[i];return t},Ki=function(r,e,t){for(var i=r(),n=r.toString(),s=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/ /g,"").split(","),u=0;u<i.length;++u){var a=i[u],o=s[u];if(typeof a=="function"){e+=";"+o+"=";var l=a.toString();if(a.prototype)if(l.indexOf("[native code]")!=-1){var h=l.indexOf(" ",8)+1;e+=l.slice(h,l.indexOf("(",h))}else{e+=l;for(var c in a.prototype)e+=";"+o+".prototype."+c+"="+a.prototype[c].toString()}else e+=l}else t[o]=a}return[e,t]},Ut=[],Ju=function(r){var e=[];for(var t in r)(r[t]instanceof se||r[t]instanceof ye||r[t]instanceof gt)&&e.push((r[t]=new r[t].constructor(r[t])).buffer);return e},Vu=function(r,e,t,i){var n;if(!Ut[t]){for(var s="",u={},a=r.length-1,o=0;o<a;++o)n=Ki(r[o],s,u),s=n[0],u=n[1];Ut[t]=Ki(r[a],s,u)}var l=qu({},Ut[t][1]);return Uu(Ut[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,l,Ju(l),i)},Ku=function(){return[se,ye,gt,kr,Br,Hi,Rr,zi,Gi,qi,Lt,ut,Mt,de,Ht,Ji,jt,Vi,$r,Xi,Qi]},Xi=function(r){return postMessage(r,[r.buffer])},Qi=function(r){return r&&r.size&&new se(r.size)},Xu=function(r,e,t,i,n,s){var u=Vu(t,i,n,function(a,o){u.terminate(),s(a,o)});return u.postMessage([r,e],e.consume?[r.buffer]:[]),function(){u.terminate()}},Ae=function(r,e){return r[e]|r[e+1]<<8},De=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},Tr=function(r,e){return De(r,e)+De(r,e+4)*4294967296};function Qu(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Xu(r,e,[Ku],function(i){return Xi($r(i.data[0],Qi(i.data[1])))},1,t)}function $r(r,e){return Vi(r,e)}var Or=typeof TextDecoder<"u"&&new TextDecoder,Yu=0;try{Or.decode(Gu,{stream:!0}),Yu=1}catch{}var Zu=function(r){for(var e="",t=0;;){var i=r[t++],n=(i>127)+(i>223)+(i>239);if(t+n>r.length)return[e,jt(r,t-1)];n?n==3?(i=((i&15)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,e+=String.fromCharCode(55296|i>>10,56320|i&1023)):n&1?e+=String.fromCharCode((i&31)<<6|r[t++]&63):e+=String.fromCharCode((i&15)<<12|(r[t++]&63)<<6|r[t++]&63):e+=String.fromCharCode(i)}};function ea(r,e){if(e){for(var t="",i=0;i<r.length;i+=16384)t+=String.fromCharCode.apply(null,r.subarray(i,i+16384));return t}else{if(Or)return Or.decode(r);var n=Zu(r),s=n[0],u=n[1];if(u.length)throw"invalid utf-8 data";return s}}var ta=function(r,e){return e+30+Ae(r,e+26)+Ae(r,e+28)},ra=function(r,e,t){var i=Ae(r,e+28),n=ea(r.subarray(e+46,e+46+i),!(Ae(r,e+8)&2048)),s=e+46+i,u=De(r,e+20),a=t&&u==4294967295?ia(r,s):[u,De(r,e+24),De(r,e+42)],o=a[0],l=a[1],h=a[2];return[Ae(r,e+10),o,l,n,s+Ae(r,e+30)+Ae(r,e+32),h]},ia=function(r,e){for(;Ae(r,e)!=1;e+=4+Ae(r,e+2));return[Tr(r,e+12),Tr(r,e+4),Tr(r,e+20)]};function na(r,e){if(typeof e!="function")throw"no callback";for(var t=[],i=function(){for(var f=0;f<t.length;++f)t[f]()},n={},s=r.length-22;De(r,s)!=101010256;--s)if(!s||r.length-s>65558){e("invalid zip file",null);return}var u=Ae(r,s+8);u||e(null,{});var a=u,o=De(r,s+16),l=o==4294967295;if(l){if(s=De(r,s-12),De(r,s)!=101075792){e("invalid zip file",null);return}a=u=De(r,s+32),o=De(r,s+48)}for(var h=function(f){var D=ra(r,o,l),F=D[0],y=D[1],d=D[2],p=D[3],w=D[4],v=D[5],A=ta(r,v);o=w;var b=function(B,_){B?(i(),e(B,null)):(n[p]=_,--u||e(null,n))};if(!F)b(null,jt(r,A,A+y));else if(F==8){var x=r.subarray(A,A+y);if(y<32e4)try{b(null,$r(x,new se(d)))}catch(B){b(B,null)}else t.push(Qu(x,{size:d},b))}else b("unknown compression type "+F,null)},c=0;c<a;++c)h();return i}const Pr=$.dirname,sa=$.join;$.extname;const Yi=$.basename;$.resolve,$.relative;async function Nr(r,e,t=new Set,i=""){for await(const n of r.values()){const s=i.length===0?n.name:`${i}/${n.name}`;if(n.kind==="file"){if(n.name[0]===".")continue;await e(n,s,r)}else n.kind==="directory"&&!t.has(s)&&await Nr(n,e,t,s)}}async function ua(){return typeof(await(await navigator.storage.getDirectory()).getFileHandle("bridge-supports-writable-test",{create:!0})).createWritable=="function"}async function Zi(){var r;return typeof((r=navigator.storage)==null?void 0:r.getDirectory)!="function"||!await ua()?new ce(null,"bridgeFolder",void 0):await navigator.storage.getDirectory()}class zt extends He{constructor(e){super(),e&&this.setup(e)}get baseDirectory(){return this._baseDirectory}setup(e){this._baseDirectory=e,this.hasFired||this.dispatch()}async getDirectoryHandle(e,{create:t,createOnce:i}={}){if(e===""||e===".")return this.baseDirectory;let n=this.baseDirectory;const s=e.split(/\\|\//g);s[0]==="."&&s.shift(),s[0]==="extensions"&&(s[0]="~local",s.splice(1,0,"extensions")),s[0]==="~local"&&(n=await Zi(),s.shift());for(const u of s){try{n=await n.getDirectoryHandle(u,{create:i||t})}catch{throw new Error(`Failed to access "${e}": Directory does not exist`)}i&&(i=!1,t=!1)}return n}async getFileHandle(e,t=!1){if(e.length===0)throw new Error("Error: filePath is empty");const i=await this.getDirectoryHandle(Pr(e),{create:t});try{return await i.getFileHandle(Yi(e),{create:t})}catch{throw new Error(`File does not exist: "${e}"`)}}async pathTo(e){const t=await Zi();if(e instanceof me&&!(t instanceof ce))return;let i=await t.resolve(e).then(n=>n==null?void 0:n.join("/"));return i?i="~local/"+i:i=await this.baseDirectory.resolve(e).then(n=>n==null?void 0:n.join("/")),i}async mkdir(e,{recursive:t}={}){await this.getDirectoryHandle(e,{create:!0})}async readdir(e,{withFileTypes:t}={}){const i=await this.getDirectoryHandle(e),n=[];for await(const s of i.values())s.kind==="file"&&s.name===".DS_Store"||(t?n.push(s):n.push(s.name));return n}async readFilesFromDir(e,t=this.getDirectoryHandle(e)){t=await t;const i=[];for await(const n of t.values())n.kind==="file"&&n.name===".DS_Store"||(n.kind==="file"?i.push({name:n.name,kind:n.kind,path:`${e}/${n.name}`}):n.kind==="directory"&&i.push(...await this.readFilesFromDir(`${e}/${n.name}`,n)));return i}readFile(e){return this.getFileHandle(e).then(t=>t.getFile())}async unlink(e){if(e.length===0)throw new Error("Error: filePath is empty");const t=e.split(/\\|\//g),i=t.pop();let n;try{n=await this.getDirectoryHandle(t.join("/"))}catch{return}try{await n.removeEntry(i,{recursive:!0})}catch{}}async writeFile(e,t){const i=await this.getFileHandle(e,!0);return await this.write(i,t),i}async write(e,t){const i=await e.createWritable({keepExistingData:!1});await i.write(t),await i.close()}async readJSON(e){const t=await this.readFile(e);try{return await we.parse(await t.text())}catch{throw new Error(`Invalid JSON: ${e}`)}}async readJsonHandle(e){const t=await e.getFile();try{return await we.parse(await t.text())}catch{throw new Error(`Invalid JSON: ${e.name}`)}}writeJSON(e,t,i=!1){return this.writeFile(e,JSON.stringify(t,null,i?"	":void 0))}async move(e,t){if(await this.fileExists(e))await this.copyFile(e,t);else if(await this.directoryExists(e))await this.copyFolder(e,t);else throw new Error(`File or folder does not exist: ${e}`);await this.unlink(e)}async copyFile(e,t){const i=await this.getFileHandle(e,!1),n=await this.getFileHandle(t,!0);return await this.copyFileHandle(i,n)}async copyFileHandle(e,t){return await this.write(t,await e.getFile()),t}async copyFolder(e,t){const i=await this.getDirectoryHandle(e,{create:!1});await Nr(i,async(n,s)=>{await this.copyFileHandle(n,await this.getFileHandle(sa(t,s),!0))})}async copyFolderByHandle(e,t){const i=new zt(t);await Nr(e,async(n,s)=>{await this.copyFileHandle(n,await i.getFileHandle(s,!0))})}loadFileHandleAsDataUrl(e){return new Promise(async(t,i)=>{const n=new FileReader;try{const s=await e.getFile();n.addEventListener("load",()=>{t(n.result)}),n.addEventListener("error",i),n.readAsDataURL(s)}catch{i(`File does not exist: "${e.name}"`)}})}async fileExists(e){try{return await this.getFileHandle(e),!0}catch{return!1}}async directoryExists(e){try{return await this.getDirectoryHandle(e),!0}catch{return!1}}async getDirectoryHandlesFromGlob(e,t="."){const i=e.split(/\/|\\/g),n=new Set([await this.getDirectoryHandle(t)]);for(const s of i){if(s==="*")for(const u of[...n.values()]){n.delete(u);for await(const a of u.values())a.kind==="directory"&&n.add(a)}else{if(s==="**")return console.warn('"**" is not supported yet'),[];for(const u of[...n.values()]){n.delete(u);try{n.add(await u.getDirectoryHandle(s))}catch{}}}if(n.size===0)return[]}return[...n.values()]}}const en=1179771;function aa(r){return new Promise(e=>{typeof requestIdleCallback=="function"?requestIdleCallback(async()=>{await r(),e()}):setTimeout(async()=>{await r(),e()},10)})}class oa extends zt{constructor(e=!1){super(),this.isMainLoader=e}get virtualFileSystem(){if(!this._virtualFileSystem)throw new Error("DataLoader: virtualFileSystem is not initialized");return this._virtualFileSystem}async loadData(e=!1){if(this.hasFired){console.warn("This dataLoader instance already loaded data. You called loadData() twice.");return}let t=await or("savedAllDataInIdb");e&&(t=!1,await lr("savedAllDataInIdb",!1)),this.isMainLoader&&console.log(t?"[APP] Data saved; restoring from cache...":"[APP] Data not saved; fetching now..."),console.time("[App] Data");const i=this.isMainLoader&&!t;if(this._virtualFileSystem=new ce(new lt("data-fs"),"bridgeFolder",t?void 0:new Map,i),await this._virtualFileSystem.setupDone.fired,t){this.setup(this._virtualFileSystem),console.timeEnd("[App] Data");return}const n=await fetch(ju+"packages.zip").then(o=>o.arrayBuffer());if(n.byteLength!==en)throw new Error(`Error: Data package was larger than the expected size of ${en} bytes; got ${n.byteLength} bytes`);const s=await new Promise((o,l)=>na(new Uint8Array(n),async(h,c)=>{if(h)return l(h);o(c)})),a={".":await this._virtualFileSystem.getDirectoryHandle("data",{create:!0})};for(const o in s){const l=Yi(o),h=Pr(o);if(o.endsWith("/")){const c=await a[h].getDirectoryHandle(l,{create:!0});a[o.slice(0,-1)]=c}else await a[h].getFileHandle(l,{create:!0,initialData:s[o]})}this.setup(this._virtualFileSystem),console.timeEnd("[App] Data"),this.isMainLoader&&!e&&aa(async()=>{await this._virtualFileSystem.moveToIdb(),await lr("savedAllDataInIdb",!0)})}}const la={"!":"BANG","&":"AND","(":"LEFT_PARENT",")":"RIGHT_PARENT","*":"ASTERISK","+":"PLUS",",":"COMMA","-":"MINUS","/":"SLASH",":":"COLON",";":"SEMICOLON","<":"SMALLER","=":"EQUALS",">":"GREATER","?":"QUESTION","[":"ARRAY_LEFT","]":"ARRAY_RIGHT","{":"CURLY_LEFT","|":"OR","}":"CURLY_RIGHT"},tn=new Set(["return","continue","break","for_each","loop","false","true"]);class mt{constructor(e,t,i,n){this.type=e,this.text=t,this.startColumn=i,this.startLine=n}getType(){return this.type}getText(){return this.text}getPosition(){return{startColumn:this.startColumn,startLineNumber:this.startLine,endColumn:this.startColumn+this.text.length,endLineNumber:this.startLine}}}class rn{constructor(e){this.i=0,this.currentColumn=0,this.currentLine=0,this.lastColumns=0,this.keywordTokens=e?new Set([...tn,...e]):tn}init(e){this.currentLine=0,this.currentColumn=0,this.lastColumns=0,this.i=0,this.expression=e}next(){for(this.currentColumn=this.i-this.lastColumns;this.i<this.expression.length&&(this.expression[this.i]===" "||this.expression[this.i]==="	"||this.expression[this.i]===`
`);)this.expression[this.i]===`
`&&(this.currentLine++,this.currentColumn=0,this.lastColumns=this.i+1),this.i++;if(this.expression[this.i]==="#"){const t=this.expression.indexOf(`
`,this.i+1);return this.i=t===-1?this.expression.length:t,this.currentLine++,this.lastColumns=this.i+1,this.currentColumn=0,this.next()}let e=la[this.expression[this.i]];if(e)return new mt(e,this.expression[this.i++],this.currentColumn,this.currentLine);if(this.isLetter(this.expression[this.i])||this.expression[this.i]==="_"){let t=this.i+1;for(;t<this.expression.length&&(this.isLetter(this.expression[t])||this.isNumber(this.expression[t])||this.expression[t]==="_"||this.expression[t]===".");)t++;const i=this.expression.substring(this.i,t).toLowerCase();return this.i=t,new mt(this.keywordTokens.has(i)?i.toUpperCase():"NAME",i,this.currentColumn,this.currentLine)}if(this.isNumber(this.expression[this.i])||this.expression[this.i]==="."){let t=this.i+1,i=this.expression[this.i]===".";for(;t<this.expression.length&&(this.isNumber(this.expression[t])||this.expression[t]==="."&&!i);)this.expression[t]==="."&&(i=!0),t++;const n=new mt("NUMBER",this.expression.substring(this.i,t),this.currentColumn,this.currentLine),s=i&&this.expression[t]==="f";return this.i=s?t+1:t,n}if(this.expression[this.i]==="'"){let t=this.i+1;for(;t<this.expression.length&&this.expression[t]!=="'";)t++;t++;const i=new mt("STRING",this.expression.substring(this.i,t),this.currentColumn,this.currentLine);return this.i=t,i}return this.hasNext()?(this.i++,this.next()):new mt("EOF","",this.currentColumn,this.currentLine)}hasNext(){return this.i<this.expression.length}isLetter(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumber(e){return e>="0"&&e<="9"}}const ca=(r,e,t)=>typeof r!="number"||Number.isNaN(r)?e:r>t?t:r<e?e:r,ha=(r,e,t)=>{let i=0;for(;0<r;)i+=nn(e,t);return i},fa=(r,e,t)=>{let i=0;for(;0<r;)i+=sn(e,t);return i},da=r=>3*r**2-2*r**3,pa=(r,e,t)=>(t<0?t=0:t>1&&(t=1),r+(e-r)*t),ga=(r,e,t)=>{const i=n=>((n+180)%360+180)%360;if((r=i(r))>(e=i(e))){let n=r;r=e,e=n}return e-r>180?i(e+t*(360-(e-r))):r+t*(e-r)},Da=(r,e)=>r%e,nn=(r,e)=>r+Math.random()*(e-r),sn=(r,e)=>Math.round(r+Math.random()*(e-r)),ma=r=>((r=((r%=360)+360)%360)>179&&(r-=360),r),Ea=r=>{const e=r?1:Math.PI/180;return{"math.abs":Math.abs,"math.acos":t=>Math.acos(t)/e,"math.asin":t=>Math.asin(t)/e,"math.atan":t=>Math.atan(t)/e,"math.atan2":(t,i)=>Math.atan2(t,i)/e,"math.ceil":Math.ceil,"math.clamp":ca,"math.cos":t=>Math.cos(t*e),"math.die_roll":ha,"math.die_roll_integer":fa,"math.exp":Math.exp,"math.floor":Math.floor,"math.hermite_blend":da,"math.lerp":pa,"math.lerp_rotate":ga,"math.ln":Math.log,"math.max":Math.max,"math.min":Math.min,"math.min_angle":ma,"math.mod":Da,"math.pi":Math.PI,"math.pow":Math.pow,"math.random":nn,"math.random_integer":sn,"math.round":Math.round,"math.sin":t=>Math.sin(t*e),"math.sqrt":Math.sqrt,"math.trunc":Math.trunc}},Ca={"query.in_range":(r,e,t)=>typeof r!="number"||typeof e!="number"||typeof t!="number"?(console.error('"query.in_range": value, min and max must be numbers'),!1):r>=e&&r<=t,"query.all":(r,...e)=>e.every(t=>t===r),"query.any":(r,...e)=>e.some(t=>t===r),"query.count":r=>Array.isArray(r)?r.length:1},un=r=>({...Ea(r),...Ca});class Ir{constructor(e,t){var i;if(this.config=t,!e)throw new Error("Provided environment must be an object");this.env={...un((i=t.useRadians)!=null?i:!1),"query.self":()=>this.env,...t.isFlat?e:this.flattenEnv(e)}}updateConfig({variableHandler:e,convertUndefined:t,useRadians:i}){t!==void 0&&(this.config.convertUndefined=t),typeof e=="function"&&(this.config.variableHandler=e),!!this.config.useRadians!=!!i&&(this.env=Object.assign(this.env,un(!!i)))}get(){return this.env}flattenEnv(e,t="",i={}){for(let n in e){let s=n;if(n[1]===".")switch(n[0]){case"q":s="query"+n.substring(1,n.length);break;case"t":s="temp"+n.substring(1,n.length);break;case"v":s="variable"+n.substring(1,n.length);break;case"c":s="context"+n.substring(1,n.length);break;case"f":s="function"+n.substring(1,n.length)}e[n].__isContext?i[`${t}${s}`]=e[n].env:typeof e[n]!="object"||Array.isArray(e[n])?i[`${t}${s}`]=e[n]:this.flattenEnv(e[n],`${t}${n}.`,i)}return i}setAt(e,t){if(e[1]===".")switch(e[0]){case"q":e="query"+e.substring(1,e.length);break;case"t":e="temp"+e.substring(1,e.length);break;case"v":e="variable"+e.substring(1,e.length);break;case"c":e="context"+e.substring(1,e.length);break;case"f":e="function"+e.substring(1,e.length)}return this.env[e]=t}getFrom(e){var i,n,s;if(e[1]===".")switch(e[0]){case"q":e="query"+e.substring(1,e.length);break;case"t":e="temp"+e.substring(1,e.length);break;case"v":e="variable"+e.substring(1,e.length);break;case"c":e="context"+e.substring(1,e.length);break;case"f":e="function"+e.substring(1,e.length)}const t=(s=this.env[e])!=null?s:(n=(i=this.config).variableHandler)==null?void 0:n.call(i,e,this.env);return t===void 0&&this.config.convertUndefined?0:t}}class X{toString(){return""+this.eval()}walk(e,t=new Set){var n;let i=(n=e(this))!=null?n:this;return i.iterate(e,t),i}iterate(e,t){var i;for(let n=0;n<this.allExpressions.length;n++){const s=this.allExpressions[n];if(t.has(s))continue;t.add(s);const u=(i=e(s))!=null?i:s;u!==s&&t.has(u)||(t.add(u),this.setExpressionAt(n,u),u.iterate(e,t))}}some(e){return this.allExpressions.some(t=>e(t)||t.some(e))}}class at extends X{constructor(){super(...arguments),this.type="VoidExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return 0}toString(){return""}}class re extends X{constructor(e,t,i,n){super(),this.left=e,this.right=t,this.operator=i,this.evalHelper=n,this.type="GenericOperatorExpression"}get allExpressions(){return[this.left,this.right]}setExpressionAt(e,t){e===0?this.left=t:e===1&&(this.right=t)}isStatic(){return this.left.isStatic()&&this.right.isStatic()}eval(){return this.evalHelper(this.left,this.right)}toString(){return`${this.left.toString()}${this.operator}${this.right.toString()}`}}const wa=(r,e)=>{const t=r.eval(),i=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof i!="number"&&typeof i!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} + ${i}"`);return t+i},ya=(r,e)=>{const t=r.eval(),i=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof i!="number"&&typeof i!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} - ${i}"`);return t-i},Aa=(r,e)=>{const t=r.eval(),i=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof i!="number"&&typeof i!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} / ${i}"`);return t/i},Fa=(r,e)=>{const t=r.eval(),i=e.eval();if(typeof t!="number"&&typeof t!="boolean"||typeof i!="number"&&typeof i!="boolean")throw new Error(`Cannot use numeric operators for expression "${t} * ${i}"`);return t*i},va=(r,e)=>{if(r.setPointer)return r.setPointer(e.eval()),0;throw Error("Cannot assign to "+r.type)};class Et{constructor(e=0){this.precedence=e}parse(e,t,i){const n=e.parseExpression(this.precedence),s=i.getText();switch(s){case"+":return new re(t,n,s,wa);case"-":return new re(t,n,s,ya);case"*":return new re(t,n,s,Fa);case"/":return new re(t,n,s,Aa);case"=":return new re(t,n,"=",va);default:throw new Error("Operator not implemented")}}}var G;(function(r){r[r.SCOPE=1]="SCOPE",r[r.STATEMENT=2]="STATEMENT",r[r.ASSIGNMENT=3]="ASSIGNMENT",r[r.CONDITIONAL=4]="CONDITIONAL",r[r.ARRAY_ACCESS=5]="ARRAY_ACCESS",r[r.NULLISH_COALESCING=6]="NULLISH_COALESCING",r[r.AND=7]="AND",r[r.OR=8]="OR",r[r.EQUALS_COMPARE=9]="EQUALS_COMPARE",r[r.COMPARE=10]="COMPARE",r[r.SUM=11]="SUM",r[r.PRODUCT=12]="PRODUCT",r[r.EXPONENT=13]="EXPONENT",r[r.PREFIX=14]="PREFIX",r[r.POSTFIX=15]="POSTFIX",r[r.FUNCTION=16]="FUNCTION"})(G||(G={}));class an extends X{constructor(e,t){super(),this.tokenType=e,this.expression=t,this.type="PrefixExpression"}get allExpressions(){return[this.expression]}setExpressionAt(e,t){this.expression=t}isStatic(){return this.expression.isStatic()}eval(){const e=this.expression.eval();if(typeof e!="number")throw new Error(`Cannot use "${this.tokenType}" operator in front of ${typeof e} "${e}"`);switch(this.tokenType){case"MINUS":return-e;case"BANG":return!e}}toString(){switch(this.tokenType){case"MINUS":return"-"+this.expression.toString();case"BANG":return"!"+this.expression.toString()}throw new Error(`Unknown prefix operator: "${this.tokenType}"`)}}class on{constructor(e=0){this.precedence=e}parse(e,t){return new an(t.getType(),e.parseExpression(this.precedence))}}class Lr extends X{constructor(e){super(),this.value=e,this.type="NumberExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.value}toString(){const e=""+this.value;return e.startsWith("0.")?e.slice(1):e}}class ba{constructor(e=0){this.precedence=e}parse(e,t){return new Lr(Number(t.getText()))}}class Ct extends X{constructor(e,t,i=!1){super(),this.executionEnv=e,this.name=t,this.isFunctionCall=i,this.type="NameExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!1}setPointer(e){this.executionEnv.setAt(this.name,e)}setFunctionCall(e=!0){this.isFunctionCall=e}setName(e){this.name=e}setExecutionEnv(e){this.executionEnv=e}eval(){const e=this.executionEnv.getFrom(this.name);return this.isFunctionCall||typeof e!="function"?e:e()}toString(){return this.name}}class xa extends X{constructor(e,t){super(),this.leftExpr=e,this.rightExpr=t,this.type="NameExpression"}get allExpressions(){return[this.leftExpr,this.rightExpr]}setExpressionAt(e,t){if(!(t instanceof Ct))throw new Error('Cannot use context switch operator "->" on '+t.type);e===0?this.leftExpr=t:e===1&&(this.rightExpr=t)}isStatic(){return!1}eval(){const e=this.leftExpr.eval();return typeof e!="object"?0:(this.rightExpr.setExecutionEnv(new Ir(e,this.rightExpr.executionEnv.config)),this.rightExpr.eval())}toString(){return`${this.leftExpr.toString()}->${this.rightExpr.toString()}`}}class _a{constructor(e=0){this.precedence=e}parse(e,t){const i=new Ct(e.executionEnv,t.getText()),n=[e.lookAhead(0),e.lookAhead(1)];if(n[0].getType()==="MINUS"&&n[1].getType()==="GREATER"){e.consume("MINUS"),e.consume("GREATER");const s=e.parseExpression(G.FUNCTION-1);if(s.type!=="NameExpression"&&s.type!=="FunctionExpression")throw new Error('Cannot use context switch operator "->" on '+s.type);return new xa(i,s)}return i}}class Be extends X{constructor(e,t){super(),this.expression=e,this.brackets=t,this.type="GroupExpression"}get allExpressions(){return[this.expression]}setExpressionAt(e,t){this.expression=t}isStatic(){return this.expression.isStatic()}get isReturn(){return this.expression.isReturn}get isBreak(){return this.expression.isBreak}get isContinue(){return this.expression.isContinue}eval(){return this.expression.eval()}toString(){return`${this.brackets[0]}${this.expression.toString()}${this.brackets[1]}`}}class Sa{constructor(e=0){this.precedence=e}parse(e,t){const i=e.parseExpression(this.precedence);return e.consume("RIGHT_PARENT"),e.config.keepGroups?new Be(i,"()"):i}}class Je extends X{constructor(e){super(),this.expression=e,this.type="ReturnExpression",this.isReturn=!0}get allExpressions(){return[this.expression]}setExpressionAt(e,t){this.expression=t}isStatic(){return!1}eval(){return this.expression.eval()}toString(){return"return "+this.expression.toString()}}class ka{constructor(e=0){this.precedence=e}parse(e,t){const i=e.parseExpression(G.STATEMENT+1);return new Je(e.match("SEMICOLON",!1)?i:new Lr(0))}}class Ve extends X{constructor(e,t=!1){super(),this.value=e,this.isReturn=t,this.type="StaticExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.value}toString(){let e=this.value;return typeof e=="string"&&(e=`'${e}'`),this.isReturn?"return "+e:""+e}}class pe extends X{constructor(e){super(),this.expressions=e,this.type="StatementExpression",this.didReturn=void 0,this.wasLoopBroken=!1,this.wasLoopContinued=!1}get allExpressions(){return this.expressions}setExpressionAt(e,t){this.expressions[e]=t}get isReturn(){if(this.didReturn!==void 0)return this.didReturn;let e=0;for(;e<this.expressions.length;){const t=this.expressions[e];if(t.isBreak||t.isContinue)return!1;if(t.isReturn)return this.didReturn=!0,!0;e++}return this.didReturn=!1,!1}get isBreak(){return!!this.wasLoopBroken&&(this.wasLoopBroken=!1,!0)}get isContinue(){return!!this.wasLoopContinued&&(this.wasLoopContinued=!1,!0)}isStatic(){let e=0;for(;e<this.expressions.length;){if(!this.expressions[e].isStatic())return!1;e++}return!0}eval(){this.didReturn=!1,this.wasLoopBroken=!1,this.wasLoopContinued=!1;let e=0;for(;e<this.expressions.length;){let t=this.expressions[e].eval();if(this.expressions[e].isReturn)return this.didReturn=!0,t;if(this.expressions[e].isContinue)return void(this.wasLoopContinued=!0);if(this.expressions[e].isBreak)return void(this.wasLoopBroken=!0);e++}return 0}toString(){let e="";for(const t of this.expressions){if(t instanceof at||t instanceof Ve&&!t.isReturn)continue;const i=t.toString();i&&(e+=i+";")}return e}}class Ba{constructor(e=0){this.precedence=e}findReEntryPoint(e){let t=1,i=e.lookAhead(0).getType();for(;i!=="EOF"&&(i=="CURLY_RIGHT"?t--:i==="CURLY_LEFT"&&t++,t!==0);)e.consume(),i=e.lookAhead(0).getType()}parse(e,t,i){if(e.config.useOptimizer&&(t.isStatic()&&(t=new Ve(t.eval(),t.isReturn)),e.config.earlyReturnsSkipParsing&&t.isReturn))return e.config.earlyReturnsSkipTokenization||this.findReEntryPoint(e),new pe([t]);const n=[t];if(!e.match("CURLY_RIGHT",!1))do{let s=e.parseExpression(this.precedence);if(e.config.useOptimizer){if(s.isStatic()){if(e.config.useAgressiveStaticOptimizer&&!s.isReturn)continue;s=new Ve(s.eval(),s.isReturn)}if(e.config.earlyReturnsSkipParsing&&(s.isBreak||s.isContinue||s.isReturn))return n.push(s),e.config.earlyReturnsSkipTokenization||this.findReEntryPoint(e),new pe(n)}n.push(s)}while(e.match("SEMICOLON")&&!e.match("EOF")&&!e.match("CURLY_RIGHT",!1));return e.match("SEMICOLON"),new pe(n)}}class Wt extends X{constructor(e){super(),this.name=e,this.type="StringExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.name.substring(1,this.name.length-1)}toString(){return this.name}}class Ra{constructor(e=0){this.precedence=e}parse(e,t){return new Wt(t.getText())}}class ln extends X{constructor(e,t){super(),this.name=e,this.args=t,this.type="FunctionExpression"}get allExpressions(){return[this.name,...this.args]}setExpressionAt(e,t){e===0?this.name=t:e>0&&(this.args[e-1]=t)}setExecutionEnv(e){this.name.setExecutionEnv(e)}get executionEnv(){return this.name.executionEnv}isStatic(){return!1}eval(){const e=[];let t=0;for(;t<this.args.length;)e.push(this.args[t++].eval());const i=this.name.eval();if(typeof i!="function")throw new Error(this.name.toString()+" is not callable!");return i(...e)}toString(){let e=this.name.toString()+"(";for(let t=0;t<this.args.length;t++)e+=`${this.args[t].toString()}${t+1<this.args.length?",":""}`;return e+")"}}class Ta{constructor(e=0){this.precedence=e}parse(e,t,i){const n=[];if(!t.setFunctionCall)throw new Error(t.type+" is not callable!");if(t.setFunctionCall(!0),!e.match("RIGHT_PARENT")){do n.push(e.parseExpression());while(e.match("COMMA"));e.consume("RIGHT_PARENT")}return new ln(t,n)}}class cn extends X{constructor(e,t){super(),this.name=e,this.lookup=t,this.type="ArrayAccessExpression"}get allExpressions(){return[this.name,this.lookup]}setExpressionAt(e,t){e===0?this.name=t:e===1&&(this.lookup=t)}isStatic(){return!1}setPointer(e){this.name.eval()[this.lookup.eval()]=e}eval(){return this.name.eval()[this.lookup.eval()]}toString(){return`${this.name.toString()}[${this.lookup.toString()}]`}}class $a{constructor(e=0){this.precedence=e}parse(e,t,i){const n=e.parseExpression(this.precedence-1);if(!t.setPointer)throw new Error(`"${t.type}" is not an array`);if(!e.match("ARRAY_RIGHT"))throw new Error(`No closing bracket for opening bracket "[${n.eval()}"`);return new cn(t,n)}}class Oa{constructor(e=0){this.precedence=e}parse(e,t){let i=e.parseExpression(this.precedence);return e.config.useOptimizer&&e.config.earlyReturnsSkipTokenization&&i.isReturn?e.match("CURLY_RIGHT"):e.consume("CURLY_RIGHT"),e.config.keepGroups?new Be(i,"{}"):i}}class hn extends X{constructor(e,t){super(),this.count=e,this.expression=t,this.type="LoopExpression"}get allExpressions(){return[this.count,this.expression]}get isNoopLoop(){return this.count.isStatic()&&this.count.eval()===0}setExpressionAt(e,t){e===0?this.count=t:e===1&&(this.expression=t)}get isReturn(){return!this.isNoopLoop&&this.expression.isReturn}isStatic(){return this.count.isStatic()&&this.expression.isStatic()}eval(){const e=Number(this.count.eval());if(e===0)return 0;if(Number.isNaN(e))throw new Error(`First loop() argument must be of type number, received "${typeof this.count.eval()}"`);if(e>1024)throw new Error(`Cannot loop more than 1024x times, received "${e}"`);let t=0;for(;t<e;){t++;const i=this.expression.eval();if(this.expression.isBreak)break;if(!this.expression.isContinue&&this.expression.isReturn)return i}return 0}toString(){return this.isNoopLoop?"":`loop(${this.count.toString()},${this.expression.toString()})`}}class Pa{constructor(e=0){this.precedence=e}parse(e,t){e.consume("LEFT_PARENT");const i=[];if(e.match("RIGHT_PARENT"))throw new Error("loop() called without arguments");do i.push(e.parseExpression());while(e.match("COMMA"));if(e.consume("RIGHT_PARENT"),i.length!==2)throw new Error("There must be exactly two loop() arguments; found "+i.length);return new hn(i[0],i[1])}}class fn extends X{constructor(e,t,i){if(super(),this.variable=e,this.arrayExpression=t,this.expression=i,this.type="ForEachExpression",!this.variable.setPointer)throw new Error(`First for_each() argument must be a variable, received "${typeof this.variable.eval()}"`)}get isReturn(){return this.expression.isReturn}get allExpressions(){return[this.variable,this.arrayExpression,this.expression]}setExpressionAt(e,t){e===0?this.variable=t:e===1?this.arrayExpression=t:e===2&&(this.expression=t)}isStatic(){return this.variable.isStatic()&&this.arrayExpression.isStatic()&&this.expression.isStatic()}eval(){var i,n;const e=this.arrayExpression.eval();if(!Array.isArray(e))throw new Error(`Second for_each() argument must be an array, received "${typeof e}"`);let t=0;for(;t<e.length;){(n=(i=this.variable).setPointer)==null||n.call(i,e[t++]);const s=this.expression.eval();if(this.expression.isBreak)break;if(!this.expression.isContinue&&this.expression.isReturn)return s}return 0}toString(){return`for_each(${this.variable.toString()},${this.arrayExpression.toString()},${this.expression.toString()})`}}class Na{constructor(e=0){this.precedence=e}parse(e,t){e.consume("LEFT_PARENT");const i=[];if(e.match("RIGHT_PARENT"))throw new Error("for_each() called without arguments");do i.push(e.parseExpression());while(e.match("COMMA"));if(e.consume("RIGHT_PARENT"),i.length!==3)throw new Error("There must be exactly three for_each() arguments; found "+i.length);return new fn(i[0],i[1],i[2])}}class dn extends X{constructor(){super(),this.type="ContinueExpression",this.isContinue=!0}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!1}eval(){return 0}toString(){return"continue"}}class Ia{constructor(e=0){this.precedence=e}parse(e,t){return new dn}}class pn extends X{constructor(){super(),this.type="BreakExpression",this.isBreak=!0}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!1}eval(){return 0}isString(){return"break"}}class La{constructor(e=0){this.precedence=e}parse(e,t){return new pn}}class gn extends X{constructor(e){super(),this.value=e,this.type="BooleanExpression"}get allExpressions(){return[]}setExpressionAt(){}isStatic(){return!0}eval(){return this.value}}class Dn{constructor(e=0){this.precedence=e}parse(e,t){return new gn(t.getText()==="true")}}class Ma{constructor(e=0){this.precedence=e}parse(e,t,i){return new re(t,e.parseExpression(this.precedence),"==",(n,s)=>n.eval()===s.eval())}}class Ha{constructor(e=0){this.precedence=e}parse(e,t,i){if(e.match("EQUALS"))return new re(t,e.parseExpression(this.precedence),"!=",(n,s)=>n.eval()!==s.eval());throw new Error("! was used as a binary operator")}}class ja{constructor(e=0){this.precedence=e}parse(e,t,i){if(e.match("AND"))return new re(t,e.parseExpression(this.precedence),"&&",(n,s)=>n.eval()&&s.eval());throw new Error('"&" not followed by another "&"')}}class Ua{constructor(e=0){this.precedence=e}parse(e,t,i){if(e.match("OR"))return new re(t,e.parseExpression(this.precedence),"||",(n,s)=>n.eval()||s.eval());throw new Error('"|" not followed by another "|"')}}class za{constructor(e=0){this.precedence=e}parse(e,t,i){return e.match("EQUALS")?new re(t,e.parseExpression(this.precedence),"<=",(n,s)=>n.eval()<=s.eval()):new re(t,e.parseExpression(this.precedence),"<",(n,s)=>n.eval()<s.eval())}}class Wa{constructor(e=0){this.precedence=e}parse(e,t,i){return e.match("EQUALS")?new re(t,e.parseExpression(this.precedence),">=",(n,s)=>n.eval()>=s.eval()):new re(t,e.parseExpression(this.precedence),">",(n,s)=>n.eval()>s.eval())}}class Mr extends X{constructor(e,t,i){super(),this.leftExpression=e,this.thenExpression=t,this.elseExpression=i,this.type="TernaryExpression"}get allExpressions(){return this.leftExpression.isStatic()?[this.leftExpression,this.leftExpression.eval()?this.thenExpression:this.elseExpression]:[this.leftExpression,this.thenExpression,this.elseExpression]}setExpressionAt(e,t){e===0?this.leftExpression=t:e===1?this.thenExpression=t:e===2&&(this.elseExpression=t)}get isReturn(){return this.leftResult===void 0?this.thenExpression.isReturn&&this.elseExpression.isReturn:this.leftResult?this.thenExpression.isReturn:this.elseExpression.isReturn}get hasReturn(){return this.thenExpression.isReturn||this.elseExpression.isReturn}get isContinue(){return this.leftResult===void 0?this.thenExpression.isContinue&&this.elseExpression.isContinue:this.leftResult?this.thenExpression.isContinue:this.elseExpression.isContinue}get isBreak(){return this.leftResult===void 0?this.thenExpression.isBreak&&this.elseExpression.isBreak:this.leftResult?this.thenExpression.isBreak:this.elseExpression.isBreak}isStatic(){return this.leftExpression.isStatic()&&this.thenExpression.isStatic()&&this.elseExpression.isStatic()}eval(){return this.leftResult=this.leftExpression.eval(),this.leftResult?this.thenExpression.eval():this.elseExpression.eval()}toString(){return this.elseExpression instanceof at?`${this.leftExpression.toString()}?${this.thenExpression.toString()}`:`${this.leftExpression.toString()}?${this.thenExpression.toString()}:${this.elseExpression.toString()}`}}const Ga=new class{constructor(r=0){this.precedence=r,this.exprName="Ternary"}parse(r,e,t){let i,n=r.parseExpression(this.precedence-1);return i=r.match("COLON")?r.parseExpression(this.precedence-1):new at,r.config.useOptimizer&&e.isStatic()?e.eval()?n:i:new Mr(e,n,i)}}(G.CONDITIONAL);class qa{constructor(e=0){this.precedence=e}parse(e,t,i){return e.match("QUESTION")?new re(t,e.parseExpression(this.precedence),"??",(n,s)=>{var u;return(u=n.eval())!=null?u:s.eval()}):Ga.parse(e,t,i)}}class mn extends class{constructor(e){this.config=e,this.prefixParselets=new Map,this.infixParselets=new Map,this.readTokens=[],this.tokenIterator=new rn}updateConfig(e){this.config=e}init(e){this.tokenIterator.init(e),this.readTokens=[]}setTokenizer(e){this.tokenIterator=e}setExecutionEnvironment(e){this.executionEnv=e}parseExpression(e=0){let t=this.consume();if(t.getType()==="EOF")return new at;const i=this.prefixParselets.get(t.getType());if(!i)throw new Error(`Cannot parse ${t.getType()} expression "${t.getType()}"`);let n=i.parse(this,t);return this.parseInfixExpression(n,e)}parseInfixExpression(e,t=0){let i;for(;this.getPrecedence()>t;){i=this.consume();let n=i.getType();n!=="EQUALS"||this.match("EQUALS")||(n="ASSIGN");const s=this.infixParselets.get(n);if(!s)throw new Error(`Unknown infix parselet: "${n}"`);e=s.parse(this,e,i)}return e}getPrecedence(){var t;const e=this.infixParselets.get(this.lookAhead(0).getType());return(t=e==null?void 0:e.precedence)!=null?t:0}consume(e){const t=this.lookAhead(0);if(e&&t.getType()!==e)throw new Error(`Expected token "${e}" and found "${t.getType()}"`);return this.readTokens.shift(),t}match(e,t=!0){return this.lookAhead(0).getType()===e&&(t&&this.consume(),!0)}lookAhead(e){for(;e>=this.readTokens.length;)this.readTokens.push(this.tokenIterator.next());return this.readTokens[e]}registerInfix(e,t){this.infixParselets.set(e,t)}registerPrefix(e,t){this.prefixParselets.set(e,t)}getInfix(e){return this.infixParselets.get(e)}getPrefix(e){return this.prefixParselets.get(e)}}{constructor(e){super(e),this.registerPrefix("NAME",new _a),this.registerPrefix("STRING",new Ra),this.registerPrefix("NUMBER",new ba),this.registerPrefix("TRUE",new Dn(G.PREFIX)),this.registerPrefix("FALSE",new Dn(G.PREFIX)),this.registerPrefix("RETURN",new ka),this.registerPrefix("CONTINUE",new Ia),this.registerPrefix("BREAK",new La),this.registerPrefix("LOOP",new Pa),this.registerPrefix("FOR_EACH",new Na),this.registerInfix("QUESTION",new qa(G.CONDITIONAL)),this.registerPrefix("LEFT_PARENT",new Sa),this.registerInfix("LEFT_PARENT",new Ta(G.FUNCTION)),this.registerInfix("ARRAY_LEFT",new $a(G.ARRAY_ACCESS)),this.registerPrefix("CURLY_LEFT",new Oa(G.SCOPE)),this.registerInfix("SEMICOLON",new Ba(G.STATEMENT)),this.registerPrefix("MINUS",new on(G.PREFIX)),this.registerPrefix("BANG",new on(G.PREFIX)),this.registerInfix("PLUS",new Et(G.SUM)),this.registerInfix("MINUS",new Et(G.SUM)),this.registerInfix("ASTERISK",new Et(G.PRODUCT)),this.registerInfix("SLASH",new Et(G.PRODUCT)),this.registerInfix("EQUALS",new Ma(G.EQUALS_COMPARE)),this.registerInfix("BANG",new Ha(G.EQUALS_COMPARE)),this.registerInfix("GREATER",new Wa(G.COMPARE)),this.registerInfix("SMALLER",new za(G.COMPARE)),this.registerInfix("AND",new ja(G.AND)),this.registerInfix("OR",new Ua(G.OR)),this.registerInfix("ASSIGN",new Et(G.ASSIGNMENT))}}class Ja{constructor(e=0){this.precedence=e}parse(e,t){if(e.consume("LEFT_PARENT"),e.match("RIGHT_PARENT"))throw new Error("function() called without arguments");let i,n,s=[];do{const u=e.parseExpression();if(u instanceof Wt)n?s.push(u.eval()):n=u.eval();else{if(!(u instanceof pe||u instanceof Be))throw new Error(`Unexpected expresion: found "${u.constructor.name}"`);i=u}}while(e.match("COMMA"));if(e.consume("RIGHT_PARENT"),!n)throw new Error(`Missing function() name (argument 1); found "${n}"`);if(!i)throw new Error(`Missing function() body (argument ${s.length+2})`);if(e.lookAhead(0).getType()!=="SEMICOLON")throw new Error("Missing semicolon after function expression");return new Va(e.functions,n,s,i)}}class Va extends X{constructor(e,t,i,n){super(),this.functionBody=n,this.type="CustomFunctionExpression",e.set(t.toLowerCase(),[i,n instanceof Be?n.allExpressions[0].toString():n.toString()])}get allExpressions(){return[this.functionBody]}setExpressionAt(e,t){this.functionBody=t}get isReturn(){return!1}isStatic(){return!0}eval(){return 0}}class Hr{constructor(e={},t={}){this.config=t,this.expressionCache={},this.totalCacheEntries=0,t.useOptimizer===void 0&&(this.config.useOptimizer=!0),t.useCache===void 0&&(this.config.useCache=!0),t.earlyReturnsSkipParsing===void 0&&(this.config.earlyReturnsSkipParsing=!0),t.earlyReturnsSkipTokenization===void 0&&(this.config.earlyReturnsSkipTokenization=!0),t.convertUndefined===void 0&&(this.config.convertUndefined=!1),this.parser=new mn({...this.config,tokenizer:void 0}),this.updateExecutionEnv(e,t.assumeFlatEnvironment)}updateConfig(e){(e=Object.assign(this.config,e)).tokenizer&&this.parser.setTokenizer(e.tokenizer),this.parser.updateConfig({...this.config,tokenizer:void 0}),this.executionEnvironment.updateConfig(e)}updateExecutionEnv(e,t=!1){this.executionEnvironment=new Ir(e,{useRadians:this.config.useRadians,convertUndefined:this.config.convertUndefined,isFlat:t,variableHandler:this.config.variableHandler}),this.parser.setExecutionEnvironment(this.executionEnvironment)}clearCache(){this.expressionCache={},this.totalCacheEntries=0}execute(e){this.parser.setExecutionEnvironment(this.executionEnvironment);const t=this.parse(e).eval();return t===void 0?0:typeof t=="boolean"?Number(t):t}executeAndCatch(e){try{return this.execute(e)}catch{return 0}}parse(e){var i,n,s;if((i=this.config.useCache)==null||i){const u=this.expressionCache[e];if(u)return u}this.parser.init(e);let t=this.parser.parseExpression();return((n=this.config.useOptimizer)!=null?n:1)&&t.isStatic()&&(t=new Ve(t.eval())),((s=this.config.useCache)==null||s)&&(this.totalCacheEntries>(this.config.maxCacheSize||256)&&this.clearCache(),this.expressionCache[e]=t,this.totalCacheEntries++),t}resolveStatic(e){return e=(e=e.walk(t=>{if(!(t instanceof Wt))return t.isStatic()?new Ve(t.eval()):void 0})).walk(t=>{if(t instanceof re)switch(t.operator){case"+":case"-":{const i=t.allExpressions.find(n=>n.isStatic()&&n.eval()===0);if(i)return t.allExpressions.find(n=>n!==i);break}case"*":if(t.allExpressions.find(i=>i.isStatic()&&i.eval()===0))return new Ve(0);case"*":case"/":{const i=t.allExpressions.find(n=>n.isStatic()&&n.eval()===1);if(i)return t.allExpressions.find(n=>n!==i);break}}})}getParser(){return this.parser}}class Ka extends mn{constructor(e){super(e),this.functions=new Map,this.classes=new Map,this.registerPrefix("FUNCTION",new Ja)}reset(){this.functions.clear()}}class Xa{constructor(e){this.parser=new Ka({useCache:!1,useOptimizer:!0,useAgressiveStaticOptimizer:!0,keepGroups:!0,earlyReturnsSkipParsing:!1,earlyReturnsSkipTokenization:!1}),this.parser.setExecutionEnvironment(new Ir(this.parser,e)),this.parser.setTokenizer(new rn(new Set(["function"])))}get functions(){return this.parser.functions}parse(e){return this.parser.init(e.replace(/\"/g,"'")),this.parser.parseExpression()}transform(e){const t=new Hr({},{useCache:!1,keepGroups:!0,useOptimizer:!0,useAgressiveStaticOptimizer:!0,earlyReturnsSkipParsing:!0,earlyReturnsSkipTokenization:!1});let i=0,n=t.parse(e),s=!1;n instanceof pe&&(s=!0);let u=!1;n=n.walk(o=>{var y;if(o.type!=="FunctionExpression")return;const l=o.name.name.replace(/(f|function)\./g,""),h=o.args;let[c,f]=(y=this.functions.get(l))!=null?y:[];if(!f||!c)return;f=f.replace(/(a|arg)\.(\w+)/g,(d,p,w)=>{var v,A;return((A=(v=h[c.indexOf(w)])==null?void 0:v.toString())!=null?A:"0").replace(/(t|temp)\./,"outer_temp.")});let D=function(d){if(d instanceof Je)return new Be(d.allExpressions[0],"()");if(!(d instanceof pe)||d.allExpressions.length>1)return d;const p=d.allExpressions[0];return p instanceof Je?new Be(p.allExpressions[0],"()"):d}(t.parse(f));if(D instanceof pe){const d=D.allExpressions.some(w=>w instanceof Je),p=d||D.some(w=>w instanceof Je);D=t.parse(`({${f}}+${p?d?"t.return_value":"(t.return_value??0)":"0"})`),u=!0}const F=new Map;return D=D.walk(d=>{if(d instanceof Ct){let p=d.toString().split(".");const w=p.shift(),[v,...A]=p,b=A.length>0?"."+A.join("."):"";if(w==="t"||w==="temp"){let x=F.get(v);x||(x="t.__scvar"+i++,F.set(v,x)),d.setName(`${x}${b}`)}else w==="outer_temp"&&d.setName(`t.${v}${b}`)}else{if(d instanceof Je){const p=new Ct(t.getParser().executionEnv,"t.return_value"),w=d.allExpressions[0];return new re(p,w,"=",()=>{p.setPointer(w.eval())})}if(d instanceof pe){const p=[];for(let w=0;w<d.allExpressions.length;w++){const v=d.allExpressions[w];if(v instanceof Mr&&v.hasReturn){Qa(v,d.allExpressions.slice(w+1)),p.push(v);break}if(v.isReturn){p.push(v);break}p.push(v)}return new pe(p)}}}),D});const a=t.parse(n.toString());return t.resolveStatic(a),!s&&u?`return ${a.toString()};`:a.toString()}reset(){this.functions.clear()}}function Qa(r,e){if(r.isReturn)return;const t=r.allExpressions[2].isReturn?1:2,i=r.allExpressions[t];i instanceof at||(i instanceof Be&&i.allExpressions[0]instanceof pe?e.unshift(...i.allExpressions):e.unshift(i)),e.length>0&&r.setExpressionAt(t,new Be(new pe(e),"{}"))}var En=Object.freeze({__proto__:null,ArrayAccessExpression:cn,BooleanExpression:gn,BreakExpression:pn,ContinueExpression:dn,ForEachExpression:fn,FunctionExpression:ln,GenericOperatorExpression:re,GroupExpression:Be,LoopExpression:hn,NameExpression:Ct,NumberExpression:Lr,PostfixExpression:class extends X{constructor(r,e){super(),this.expression=r,this.tokenType=e,this.type="PostfixExpression"}get allExpressions(){return[this.expression]}setExpressionAt(r,e){this.expression=e}isStatic(){return this.expression.isStatic()}eval(){this.tokenType}},PrefixExpression:an,ReturnExpression:Je,StatementExpression:pe,StaticExpression:Ve,StringExpression:Wt,TernaryExpression:Mr,VoidExpression:at});let j,Cn=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Cn.decode();let Gt=null;function qt(){return(Gt===null||Gt.buffer!==j.memory.buffer)&&(Gt=new Uint8Array(j.memory.buffer)),Gt}function Jt(r,e){return Cn.decode(qt().subarray(r,r+e))}const Re=new Array(32).fill(void 0);Re.push(void 0,null,!0,!1);let wt=Re.length;function Ie(r){wt===Re.length&&Re.push(Re.length+1);const e=wt;return wt=Re[e],Re[e]=r,e}function yt(r){return Re[r]}let Ke=0,Vt=new TextEncoder("utf-8");const Ya=typeof Vt.encodeInto=="function"?function(r,e){return Vt.encodeInto(r,e)}:function(r,e){const t=Vt.encode(r);return e.set(t),{read:r.length,written:t.length}};function At(r,e,t){if(t===void 0){const a=Vt.encode(r),o=e(a.length);return qt().subarray(o,o+a.length).set(a),Ke=a.length,o}let i=r.length,n=e(i);const s=qt();let u=0;for(;u<i;u++){const a=r.charCodeAt(u);if(a>127)break;s[n+u]=a}if(u!==i){u!==0&&(r=r.slice(u)),n=t(n,i,i=u+r.length*3);const a=qt().subarray(n+u,n+i);u+=Ya(r,a).written}return Ke=u,n}let Kt=null;function he(){return(Kt===null||Kt.buffer!==j.memory.buffer)&&(Kt=new Int32Array(j.memory.buffer)),Kt}function Za(r){r<36||(Re[r]=wt,wt=r)}function Xe(r){const e=yt(r);return Za(r),e}function eo(r,e){try{const a=j.__wbindgen_add_to_stack_pointer(-16);var t=At(r,j.__wbindgen_malloc,j.__wbindgen_realloc),i=Ke;j.minifySync(a,t,i,Ie(e));var n=he()[a/4+0],s=he()[a/4+1],u=he()[a/4+2];if(u)throw Xe(s);return Xe(n)}finally{j.__wbindgen_add_to_stack_pointer(16)}}function to(r,e){try{const a=j.__wbindgen_add_to_stack_pointer(-16);var t=At(r,j.__wbindgen_malloc,j.__wbindgen_realloc),i=Ke;j.parseSync(a,t,i,Ie(e));var n=he()[a/4+0],s=he()[a/4+1],u=he()[a/4+2];if(u)throw Xe(s);return Xe(n)}finally{j.__wbindgen_add_to_stack_pointer(16)}}function wn(r,e,t){try{const o=j.__wbindgen_add_to_stack_pointer(-16);var i=At(r,j.__wbindgen_malloc,j.__wbindgen_realloc),n=Ke;j.transformSync(o,i,n,Ie(e),Ie(t));var s=he()[o/4+0],u=he()[o/4+1],a=he()[o/4+2];if(a)throw Xe(u);return Xe(s)}finally{j.__wbindgen_add_to_stack_pointer(16)}}async function ro(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(i){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}async function yn(r){typeof r>"u"&&(r=new URL("/assets/wasm-web_bg.533586ee.wasm",self.location));const e={};e.wbg={},e.wbg.__wbindgen_json_parse=function(n,s){var u=JSON.parse(Jt(n,s));return Ie(u)},e.wbg.__wbindgen_json_serialize=function(n,s){const u=yt(s);var a=JSON.stringify(u===void 0?null:u),o=At(a,j.__wbindgen_malloc,j.__wbindgen_realloc),l=Ke;he()[n/4+1]=l,he()[n/4+0]=o},e.wbg.__wbindgen_object_drop_ref=function(n){Xe(n)},e.wbg.__wbindgen_string_new=function(n,s){var u=Jt(n,s);return Ie(u)},e.wbg.__wbg_new0_57a6a2c2aaed3fc5=function(){var n=new Date;return Ie(n)},e.wbg.__wbg_getTime_f8ce0ff902444efb=function(n){var s=yt(n).getTime();return s},e.wbg.__wbg_getTimezoneOffset_41211a984662508b=function(n){var s=yt(n).getTimezoneOffset();return s},e.wbg.__wbg_new_693216e109162396=function(){var n=new Error;return Ie(n)},e.wbg.__wbg_stack_0ddaca5d1abfb52f=function(n,s){var u=yt(s).stack,a=At(u,j.__wbindgen_malloc,j.__wbindgen_realloc),o=Ke;he()[n/4+1]=o,he()[n/4+0]=a},e.wbg.__wbg_error_09919627ac0992f5=function(n,s){try{console.error(Jt(n,s))}finally{j.__wbindgen_free(n,s)}},e.wbg.__wbindgen_throw=function(n,s){throw new Error(Jt(n,s))},(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:i}=await ro(await r,e);return j=t.exports,yn.__wbindgen_wasm_module=i,j}var io="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function no(r){for(var e=0,t=0,i=0,n=0,s="",u=0;u<r.length;u++){var a=r[u];if(u>0&&(s+=";"),a.length!==0){for(var o=0,l=[],h=0,c=a;h<c.length;h++){var f=c[h],D=Ft(f[0]-o);o=f[0],f.length>1&&(D+=Ft(f[1]-e)+Ft(f[2]-t)+Ft(f[3]-i),e=f[1],t=f[2],i=f[3]),f.length===5&&(D+=Ft(f[4]-n),n=f[4]),l.push(D)}s+=l.join(",")}}return s}function Ft(r){var e="";r=r<0?-r<<1|1:r<<1;do{var t=r&31;r>>>=5,r>0&&(t|=32),e+=io[t]}while(r>0);return e}class Xt{constructor(e){this.bits=e instanceof Xt?e.bits.slice():[]}add(e){this.bits[e>>5]|=1<<(e&31)}has(e){return!!(this.bits[e>>5]&1<<(e&31))}}class vt{constructor(e,t,i){this.start=e,this.end=t,this.original=i,this.intro="",this.outro="",this.content=i,this.storeName=!1,this.edited=!1,Object.defineProperties(this,{previous:{writable:!0,value:null},next:{writable:!0,value:null}})}appendLeft(e){this.outro+=e}appendRight(e){this.intro=this.intro+e}clone(){const e=new vt(this.start,this.end,this.original);return e.intro=this.intro,e.outro=this.outro,e.content=this.content,e.storeName=this.storeName,e.edited=this.edited,e}contains(e){return this.start<e&&e<this.end}eachNext(e){let t=this;for(;t;)e(t),t=t.next}eachPrevious(e){let t=this;for(;t;)e(t),t=t.previous}edit(e,t,i){return this.content=e,i||(this.intro="",this.outro=""),this.storeName=t,this.edited=!0,this}prependLeft(e){this.outro=e+this.outro}prependRight(e){this.intro=e+this.intro}split(e){const t=e-this.start,i=this.original.slice(0,t),n=this.original.slice(t);this.original=i;const s=new vt(e,this.end,n);return s.outro=this.outro,this.outro="",this.end=e,this.edited?(s.edit("",!1),this.content=""):this.content=i,s.next=this.next,s.next&&(s.next.previous=s),s.previous=this,this.next=s,s}toString(){return this.intro+this.content+this.outro}trimEnd(e){if(this.outro=this.outro.replace(e,""),this.outro.length)return!0;const t=this.content.replace(e,"");if(t.length)return t!==this.content&&this.split(this.start+t.length).edit("",void 0,!0),!0;if(this.edit("",void 0,!0),this.intro=this.intro.replace(e,""),this.intro.length)return!0}trimStart(e){if(this.intro=this.intro.replace(e,""),this.intro.length)return!0;const t=this.content.replace(e,"");if(t.length)return t!==this.content&&(this.split(this.end-t.length),this.edit("",void 0,!0)),!0;if(this.edit("",void 0,!0),this.outro=this.outro.replace(e,""),this.outro.length)return!0}}let jr=()=>{throw new Error("Unsupported environment: `window.btoa` or `Buffer` should be supported.")};typeof window<"u"&&typeof window.btoa=="function"?jr=r=>window.btoa(unescape(encodeURIComponent(r))):typeof Buffer=="function"&&(jr=r=>Buffer.from(r,"utf-8").toString("base64"));class so{constructor(e){this.version=3,this.file=e.file,this.sources=e.sources,this.sourcesContent=e.sourcesContent,this.names=e.names,this.mappings=no(e.mappings)}toString(){return JSON.stringify(this)}toUrl(){return"data:application/json;charset=utf-8;base64,"+jr(this.toString())}}function uo(r){const e=r.split(`
`),t=e.filter(s=>/^\t+/.test(s)),i=e.filter(s=>/^ {2,}/.test(s));if(t.length===0&&i.length===0)return null;if(t.length>=i.length)return"	";const n=i.reduce((s,u)=>{const a=/^ +/.exec(u)[0].length;return Math.min(a,s)},1/0);return new Array(n+1).join(" ")}function ao(r,e){const t=r.split(/[/\\]/),i=e.split(/[/\\]/);for(t.pop();t[0]===i[0];)t.shift(),i.shift();if(t.length){let n=t.length;for(;n--;)t[n]=".."}return t.concat(i).join("/")}const oo=Object.prototype.toString;function lo(r){return oo.call(r)==="[object Object]"}function An(r){const e=r.split(`
`),t=[];for(let i=0,n=0;i<e.length;i++)t.push(n),n+=e[i].length+1;return function(n){let s=0,u=t.length;for(;s<u;){const l=s+u>>1;n<t[l]?u=l:s=l+1}const a=s-1,o=n-t[a];return{line:a,column:o}}}class co{constructor(e){this.hires=e,this.generatedCodeLine=0,this.generatedCodeColumn=0,this.raw=[],this.rawSegments=this.raw[this.generatedCodeLine]=[],this.pending=null}addEdit(e,t,i,n){if(t.length){const s=[this.generatedCodeColumn,e,i.line,i.column];n>=0&&s.push(n),this.rawSegments.push(s)}else this.pending&&this.rawSegments.push(this.pending);this.advance(t),this.pending=null}addUneditedChunk(e,t,i,n,s){let u=t.start,a=!0;for(;u<t.end;)(this.hires||a||s.has(u))&&this.rawSegments.push([this.generatedCodeColumn,e,n.line,n.column]),i[u]===`
`?(n.line+=1,n.column=0,this.generatedCodeLine+=1,this.raw[this.generatedCodeLine]=this.rawSegments=[],this.generatedCodeColumn=0,a=!0):(n.column+=1,this.generatedCodeColumn+=1,a=!1),u+=1;this.pending=null}advance(e){if(!e)return;const t=e.split(`
`);if(t.length>1){for(let i=0;i<t.length-1;i++)this.generatedCodeLine++,this.raw[this.generatedCodeLine]=this.rawSegments=[];this.generatedCodeColumn=0}this.generatedCodeColumn+=t[t.length-1].length}}const bt=`
`,ot={insertLeft:!1,insertRight:!1,storeName:!1};class Ur{constructor(e,t={}){const i=new vt(0,e.length,e);Object.defineProperties(this,{original:{writable:!0,value:e},outro:{writable:!0,value:""},intro:{writable:!0,value:""},firstChunk:{writable:!0,value:i},lastChunk:{writable:!0,value:i},lastSearchedChunk:{writable:!0,value:i},byStart:{writable:!0,value:{}},byEnd:{writable:!0,value:{}},filename:{writable:!0,value:t.filename},indentExclusionRanges:{writable:!0,value:t.indentExclusionRanges},sourcemapLocations:{writable:!0,value:new Xt},storedNames:{writable:!0,value:{}},indentStr:{writable:!0,value:uo(e)}}),this.byStart[0]=i,this.byEnd[e.length]=i}addSourcemapLocation(e){this.sourcemapLocations.add(e)}append(e){if(typeof e!="string")throw new TypeError("outro content must be a string");return this.outro+=e,this}appendLeft(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const i=this.byEnd[e];return i?i.appendLeft(t):this.intro+=t,this}appendRight(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const i=this.byStart[e];return i?i.appendRight(t):this.outro+=t,this}clone(){const e=new Ur(this.original,{filename:this.filename});let t=this.firstChunk,i=e.firstChunk=e.lastSearchedChunk=t.clone();for(;t;){e.byStart[i.start]=i,e.byEnd[i.end]=i;const n=t.next,s=n&&n.clone();s&&(i.next=s,s.previous=i,i=s),t=n}return e.lastChunk=i,this.indentExclusionRanges&&(e.indentExclusionRanges=this.indentExclusionRanges.slice()),e.sourcemapLocations=new Xt(this.sourcemapLocations),e.intro=this.intro,e.outro=this.outro,e}generateDecodedMap(e){e=e||{};const t=0,i=Object.keys(this.storedNames),n=new co(e.hires),s=An(this.original);return this.intro&&n.advance(this.intro),this.firstChunk.eachNext(u=>{const a=s(u.start);u.intro.length&&n.advance(u.intro),u.edited?n.addEdit(t,u.content,a,u.storeName?i.indexOf(u.original):-1):n.addUneditedChunk(t,u,this.original,a,this.sourcemapLocations),u.outro.length&&n.advance(u.outro)}),{file:e.file?e.file.split(/[/\\]/).pop():null,sources:[e.source?ao(e.file||"",e.source):null],sourcesContent:e.includeContent?[this.original]:[null],names:i,mappings:n.raw}}generateMap(e){return new so(this.generateDecodedMap(e))}getIndentString(){return this.indentStr===null?"	":this.indentStr}indent(e,t){const i=/^[^\r\n]/gm;if(lo(e)&&(t=e,e=void 0),e=e!==void 0?e:this.indentStr||"	",e==="")return this;t=t||{};const n={};t.exclude&&(typeof t.exclude[0]=="number"?[t.exclude]:t.exclude).forEach(h=>{for(let c=h[0];c<h[1];c+=1)n[c]=!0});let s=t.indentStart!==!1;const u=l=>s?`${e}${l}`:(s=!0,l);this.intro=this.intro.replace(i,u);let a=0,o=this.firstChunk;for(;o;){const l=o.end;if(o.edited)n[a]||(o.content=o.content.replace(i,u),o.content.length&&(s=o.content[o.content.length-1]===`
`));else for(a=o.start;a<l;){if(!n[a]){const h=this.original[a];h===`
`?s=!0:h!=="\r"&&s&&(s=!1,a===o.start||(this._splitChunk(o,a),o=o.next),o.prependRight(e))}a+=1}a=o.end,o=o.next}return this.outro=this.outro.replace(i,u),this}insert(){throw new Error("magicString.insert(...) is deprecated. Use prependRight(...) or appendLeft(...)")}insertLeft(e,t){return ot.insertLeft||(console.warn("magicString.insertLeft(...) is deprecated. Use magicString.appendLeft(...) instead"),ot.insertLeft=!0),this.appendLeft(e,t)}insertRight(e,t){return ot.insertRight||(console.warn("magicString.insertRight(...) is deprecated. Use magicString.prependRight(...) instead"),ot.insertRight=!0),this.prependRight(e,t)}move(e,t,i){if(i>=e&&i<=t)throw new Error("Cannot move a selection inside itself");this._split(e),this._split(t),this._split(i);const n=this.byStart[e],s=this.byEnd[t],u=n.previous,a=s.next,o=this.byStart[i];if(!o&&s===this.lastChunk)return this;const l=o?o.previous:this.lastChunk;return u&&(u.next=a),a&&(a.previous=u),l&&(l.next=n),o&&(o.previous=s),n.previous||(this.firstChunk=s.next),s.next||(this.lastChunk=n.previous,this.lastChunk.next=null),n.previous=l,s.next=o||null,l||(this.firstChunk=n),o||(this.lastChunk=s),this}overwrite(e,t,i,n){if(typeof i!="string")throw new TypeError("replacement content must be a string");for(;e<0;)e+=this.original.length;for(;t<0;)t+=this.original.length;if(t>this.original.length)throw new Error("end is out of bounds");if(e===t)throw new Error("Cannot overwrite a zero-length range \u2013 use appendLeft or prependRight instead");this._split(e),this._split(t),n===!0&&(ot.storeName||(console.warn("The final argument to magicString.overwrite(...) should be an options object. See https://github.com/rich-harris/magic-string"),ot.storeName=!0),n={storeName:!0});const s=n!==void 0?n.storeName:!1,u=n!==void 0?n.contentOnly:!1;if(s){const l=this.original.slice(e,t);Object.defineProperty(this.storedNames,l,{writable:!0,value:!0,enumerable:!0})}const a=this.byStart[e],o=this.byEnd[t];if(a){let l=a;for(;l!==o;){if(l.next!==this.byStart[l.end])throw new Error("Cannot overwrite across a split point");l=l.next,l.edit("",!1)}a.edit(i,s,u)}else{const l=new vt(e,t,"").edit(i,s);o.next=l,l.previous=o}return this}prepend(e){if(typeof e!="string")throw new TypeError("outro content must be a string");return this.intro=e+this.intro,this}prependLeft(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const i=this.byEnd[e];return i?i.prependLeft(t):this.intro=t+this.intro,this}prependRight(e,t){if(typeof t!="string")throw new TypeError("inserted content must be a string");this._split(e);const i=this.byStart[e];return i?i.prependRight(t):this.outro=t+this.outro,this}remove(e,t){for(;e<0;)e+=this.original.length;for(;t<0;)t+=this.original.length;if(e===t)return this;if(e<0||t>this.original.length)throw new Error("Character is out of bounds");if(e>t)throw new Error("end must be greater than start");this._split(e),this._split(t);let i=this.byStart[e];for(;i;)i.intro="",i.outro="",i.edit(""),i=t>i.end?this.byStart[i.end]:null;return this}lastChar(){if(this.outro.length)return this.outro[this.outro.length-1];let e=this.lastChunk;do{if(e.outro.length)return e.outro[e.outro.length-1];if(e.content.length)return e.content[e.content.length-1];if(e.intro.length)return e.intro[e.intro.length-1]}while(e=e.previous);return this.intro.length?this.intro[this.intro.length-1]:""}lastLine(){let e=this.outro.lastIndexOf(bt);if(e!==-1)return this.outro.substr(e+1);let t=this.outro,i=this.lastChunk;do{if(i.outro.length>0){if(e=i.outro.lastIndexOf(bt),e!==-1)return i.outro.substr(e+1)+t;t=i.outro+t}if(i.content.length>0){if(e=i.content.lastIndexOf(bt),e!==-1)return i.content.substr(e+1)+t;t=i.content+t}if(i.intro.length>0){if(e=i.intro.lastIndexOf(bt),e!==-1)return i.intro.substr(e+1)+t;t=i.intro+t}}while(i=i.previous);return e=this.intro.lastIndexOf(bt),e!==-1?this.intro.substr(e+1)+t:this.intro+t}slice(e=0,t=this.original.length){for(;e<0;)e+=this.original.length;for(;t<0;)t+=this.original.length;let i="",n=this.firstChunk;for(;n&&(n.start>e||n.end<=e);){if(n.start<t&&n.end>=t)return i;n=n.next}if(n&&n.edited&&n.start!==e)throw new Error(`Cannot use replaced character ${e} as slice start anchor.`);const s=n;for(;n;){n.intro&&(s!==n||n.start===e)&&(i+=n.intro);const u=n.start<t&&n.end>=t;if(u&&n.edited&&n.end!==t)throw new Error(`Cannot use replaced character ${t} as slice end anchor.`);const a=s===n?e-n.start:0,o=u?n.content.length+t-n.end:n.content.length;if(i+=n.content.slice(a,o),n.outro&&(!u||n.end===t)&&(i+=n.outro),u)break;n=n.next}return i}snip(e,t){const i=this.clone();return i.remove(0,e),i.remove(t,i.original.length),i}_split(e){if(this.byStart[e]||this.byEnd[e])return;let t=this.lastSearchedChunk;const i=e>t.end;for(;t;){if(t.contains(e))return this._splitChunk(t,e);t=i?this.byStart[t.end]:this.byEnd[t.start]}}_splitChunk(e,t){if(e.edited&&e.content.length){const n=An(this.original)(t);throw new Error(`Cannot split a chunk that has already been edited (${n.line}:${n.column} \u2013 "${e.original}")`)}const i=e.split(t);return this.byEnd[t]=e,this.byStart[t]=i,this.byEnd[i.end]=i,e===this.lastChunk&&(this.lastChunk=i),this.lastSearchedChunk=e,!0}toString(){let e=this.intro,t=this.firstChunk;for(;t;)e+=t.toString(),t=t.next;return e+this.outro}isEmpty(){let e=this.firstChunk;do if(e.intro.length&&e.intro.trim()||e.content.length&&e.content.trim()||e.outro.length&&e.outro.trim())return!1;while(e=e.next);return!0}length(){let e=this.firstChunk,t=0;do t+=e.intro.length+e.content.length+e.outro.length;while(e=e.next);return t}trimLines(){return this.trim("[\\r\\n]")}trim(e){return this.trimStart(e).trimEnd(e)}trimEndAborted(e){const t=new RegExp((e||"\\s")+"+$");if(this.outro=this.outro.replace(t,""),this.outro.length)return!0;let i=this.lastChunk;do{const n=i.end,s=i.trimEnd(t);if(i.end!==n&&(this.lastChunk===i&&(this.lastChunk=i.next),this.byEnd[i.end]=i,this.byStart[i.next.start]=i.next,this.byEnd[i.next.end]=i.next),s)return!0;i=i.previous}while(i);return!1}trimEnd(e){return this.trimEndAborted(e),this}trimStartAborted(e){const t=new RegExp("^"+(e||"\\s")+"+");if(this.intro=this.intro.replace(t,""),this.intro.length)return!0;let i=this.firstChunk;do{const n=i.end,s=i.trimStart(t);if(i.end!==n&&(i===this.lastChunk&&(this.lastChunk=i.next),this.byEnd[i.end]=i,this.byStart[i.next.start]=i.next,this.byEnd[i.next.end]=i.next),s)return!0;i=i.next}while(i);return!1}trimStart(e){return this.trimStartAborted(e),this}hasChanged(){return this.original!==this.toString()}replace(e,t){function i(s,u){return typeof t=="string"?t.replace(/\$(\$|&|\d+)/g,(a,o)=>o==="$"?"$":o==="&"?s[0]:+o<s.length?s[+o]:`$${o}`):t(...s,s.index,u,s.groups)}function n(s,u){let a;const o=[];for(;a=s.exec(u);)o.push(a);return o}if(typeof e!="string"&&e.global)n(e,this.original).forEach(u=>{u.index!=null&&this.overwrite(u.index,u.index+u[0].length,i(u,this.original))});else{const s=this.original.match(e);s&&s.index!=null&&this.overwrite(s.index,s.index+s[0].length,i(s,this.original))}return this}}function ho(r,e,t=0){const i=new Ur(r),n=(a,o,l)=>i.overwrite(a-t,o-t,l),s=(a,o)=>i.slice(a-t,o-t);let u="";return e.forEach(a=>{if(a.type==="ExportDefaultDeclaration")n(a.span.start,a.span.end,`
___module.__default__ = ${s(a.decl.span.start,a.decl.span.end)};`);else if(a.type==="ExportDefaultExpression")n(a.span.start,a.span.end,`
___module.__default__ = ${s(a.expression.span.start,a.expression.span.end)};`);else if(a.type==="ExportDeclaration")n(a.span.start,a.span.end,s(a.declaration.span.start,a.declaration.span.end)),a.declaration.type==="ClassDeclaration"||a.declaration.type==="FunctionDeclaration"?u+=`
___module.${a.declaration.identifier.value} = ${a.declaration.identifier.value};`:a.declaration.type==="VariableDeclaration"&&a.declaration.declarations.forEach(o=>{u+=`
___module.${o.id.value} = ${o.id.value};`});else if(a.type==="ExportNamedDeclaration"){let o="";for(const{orig:l,exported:h}of a.specifiers)h.value==="default"?o+=`
___module.__default__ = ${l.value};`:o+=`
___module.${h.value} = ${l.value};`;n(a.span.start,a.span.end,o)}else if(a.type==="ImportDeclaration")if(a.specifiers.length===1&&a.specifiers[0].type==="ImportNamespaceSpecifier")n(a.span.start,a.span.end,`
const ${a.specifiers[0].local.value} = await ___require(${a.source.raw});`);else{const o=[];a.specifiers.forEach(h=>{h.type==="ImportDefaultSpecifier"?o.push(`__default__: ${h.local.value}`):h.type==="ImportSpecifier"&&(h.imported||(h.imported=h.local),o.push(`${h.imported.value}: ${h.local.value}`))});const l=o.length===0?`
await ___require(${a.source.raw});`:`
const {${o.join(", ")}} = await ___require(${a.source.raw});`;n(a.span.start,a.span.end,l)}}),i.toString()+u}class fo{constructor(e){if(this.evaluatedModules=new Map,this.baseModules=new Map,this.env={},e)for(const[t,i]of e)this.registerModule(t,i)}async run(e,t={},i){return this.env=t,await this.eval(e,i)}clearCache(){this.evaluatedModules.clear()}registerModule(e,t){this.baseModules.set(e,t)}async eval(e,t){const i=this.evaluatedModules.get(e);if(i)return i;const n=$.dirname(e),s=e.endsWith(".js")?"ecmascript":"typescript";if(t||(t=await this.readFile(e).catch(()=>{})),!t)throw new Error(`File "${e}" not found`);if(Qt===null)throw new Error("You must call initRuntimes() before using the runtime");await Qt;let u=eo(wn(t,{filename:$.basename(e),jsc:{parser:{syntax:s,preserveAllComments:!1,topLevelAwait:!0},target:"es2020"}}).code,{compress:!1,mangle:!1,format:{beautify:!0}}).code;const{type:a,body:o}=to(u,{syntax:s,target:"es2022"}),l=o[0].span.start,h=ho(u,o,l),c={};try{await this.runSrc(h,Object.assign({},this.env,{___module:c,___require:f=>this.require(f,n)}))}catch(f){throw new Error(`Error in ${e}: ${f}`)}return this.evaluatedModules.set(e,c),c}async require(e,t){const i=this.baseModules.get(e);if(i)return typeof i=="function"?await i():i;if(e.startsWith("https://")){const u=await(await fetch(e)).text();return await this.eval(e,u)}if(e.startsWith(".")&&(e=$.join(t,e)),e.endsWith(".json")){const s=await this.readFile(e).catch(()=>{});if(s){let u={};try{u=we.parse(s)}catch{throw new Error(`File "${e}" contains invalid JSON`)}return{__default__:u,...u}}}const n=[".ts",".js"];for(const s of n){const u=`${e}${s}`;let a=await this.readFile(u).catch(()=>{});if(!!a)return await this.eval(u,a)}throw new Error(`Module "${e}" not found`)}async runSrc(e,t){return new Function(...Object.keys(t),`return (async () => {
${e}
})()`)(...Object.values(t))}}let Qt=null;function po(r){Qt=yn(r).then(()=>null)}/*!
 * is-extglob <https://github.com/jonschlinkert/is-extglob>
 *
 * Copyright (c) 2014-2016, Jon Schlinkert.
 * Licensed under the MIT License.
 */var go=function(e){if(typeof e!="string"||e==="")return!1;for(var t;t=/(\\).|([@?!+*]\(.*\))/g.exec(e);){if(t[2])return!0;e=e.slice(t.index+t[0].length)}return!1};/*!
 * is-glob <https://github.com/jonschlinkert/is-glob>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Do=go,Fn={"{":"}","(":")","[":"]"},mo=function(r){if(r[0]==="!")return!0;for(var e=0,t=-2,i=-2,n=-2,s=-2,u=-2;e<r.length;){if(r[e]==="*"||r[e+1]==="?"&&/[\].+)]/.test(r[e])||i!==-1&&r[e]==="["&&r[e+1]!=="]"&&(i<e&&(i=r.indexOf("]",e)),i>e&&(u===-1||u>i||(u=r.indexOf("\\",e),u===-1||u>i)))||n!==-1&&r[e]==="{"&&r[e+1]!=="}"&&(n=r.indexOf("}",e),n>e&&(u=r.indexOf("\\",e),u===-1||u>n))||s!==-1&&r[e]==="("&&r[e+1]==="?"&&/[:!=]/.test(r[e+2])&&r[e+3]!==")"&&(s=r.indexOf(")",e),s>e&&(u=r.indexOf("\\",e),u===-1||u>s))||t!==-1&&r[e]==="("&&r[e+1]!=="|"&&(t<e&&(t=r.indexOf("|",e)),t!==-1&&r[t+1]!==")"&&(s=r.indexOf(")",t),s>t&&(u=r.indexOf("\\",t),u===-1||u>s))))return!0;if(r[e]==="\\"){var a=r[e+1];e+=2;var o=Fn[a];if(o){var l=r.indexOf(o,e);l!==-1&&(e=l+1)}if(r[e]==="!")return!0}else e++}return!1},Eo=function(r){if(r[0]==="!")return!0;for(var e=0;e<r.length;){if(/[*?{}()[\]]/.test(r[e]))return!0;if(r[e]==="\\"){var t=r[e+1];e+=2;var i=Fn[t];if(i){var n=r.indexOf(i,e);n!==-1&&(e=n+1)}if(r[e]==="!")return!0}else e++}return!1},Co=function(e,t){if(typeof e!="string"||e==="")return!1;if(Do(e))return!0;var i=mo;return t&&t.strict===!1&&(i=Eo),i(e)};class wo extends Iu{constructor(e,t){super($.dirname(t)),this.fileSystem=e,this.configPath=t}readConfig(){return this.fileSystem.readJson(this.configPath)}writeConfig(e){return this.fileSystem.writeJson(this.configPath,e)}}class vn{constructor(e,t,i){this.dash=e,this.pluginId=t,this.plugin=i}async runBuildStartHook(){var e,t;try{return await((t=(e=this.plugin).buildStart)==null?void 0:t.call(e))}catch(i){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "buildStart" hook:`,i)}}async runIncludeHook(){var e,t;try{return await((t=(e=this.plugin).include)==null?void 0:t.call(e))}catch(i){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "include" hook:`,i)}}async runTransformPathHook(e){var t,i;try{return await((i=(t=this.plugin).transformPath)==null?void 0:i.call(t,e))}catch(n){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "transformPath" hook for "${e}":`,n)}}async runReadHook(e,t){var i,n;try{return await((n=(i=this.plugin).read)==null?void 0:n.call(i,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "read" hook for "${e}":`,s)}}async runLoadHook(e,t){var i,n;try{return await((n=(i=this.plugin).load)==null?void 0:n.call(i,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "load" hook for "${e}":`,s)}}async runRegisterAliasesHook(e,t){var i,n;try{return await((n=(i=this.plugin).registerAliases)==null?void 0:n.call(i,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "registerAliases" hook for "${e}":`,s)}}async runRequireHook(e,t){var i,n;try{return await((n=(i=this.plugin).require)==null?void 0:n.call(i,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "require" hook for "${e}":`,s)}}async runTransformHook(e,t,i){var n,s;try{return await((s=(n=this.plugin).transform)==null?void 0:s.call(n,e,t,i))}catch(u){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "transform" hook for "${e}":`,u)}}async runFinalizeBuildHook(e,t){var i,n;try{return await((n=(i=this.plugin).finalizeBuild)==null?void 0:n.call(i,e,t))}catch(s){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "finalizeBuild" hook for "${e}":`,s)}}async runBuildEndHook(){var e,t;try{return await((t=(e=this.plugin).buildEnd)==null?void 0:t.call(e))}catch(i){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "buildEnd" hook:`,i)}}async runBeforeFileUnlinked(e){var t,i;try{return await((i=(t=this.plugin).beforeFileUnlinked)==null?void 0:i.call(t,e))}catch(n){this.dash.console.error(`The plugin "${this.pluginId}" threw an error while running the "beforeFileUnlinked" hook for "${e}":`,n)}}}const yo=({options:r,outputFileSystem:e,hasComMojangDirectory:t,projectConfig:i,projectRoot:n,packType:s})=>{var u;r.buildName||(r.buildName=r.mode==="development"?"dev":"dist"),r.packName||(r.packName="Bridge"),(u=r.rewriteToComMojang)==null||u||(t=!1);const a={behaviorPack:"development_behavior_packs",resourcePack:"development_resource_packs",skinPack:"skin_packs",worldTemplate:"minecraftWorlds"},o=h=>t&&r.mode==="development"?`${a[h]}`:`${n}/builds/${r.buildName}`,l=(h,c)=>`${o(h)}/${r.packName} ${c}`;return{async buildStart(){if(r.mode==="production"||r.buildType==="fullBuild")if(t)for(const h in a){const c=s.getFromId(h);!c||await e.unlink(l(h,c.defaultPackPath)).catch(()=>{})}else await e.unlink(o("BP")).catch(()=>{})},transformPath(h){var c,f;if(!h||h.includes("BP/scripts/gametests/")&&r.mode==="production")return;const D=s==null?void 0:s.get(h);if(!D)return;const F=i.getAbsolutePackRoot(D.id),y=$.relative(F,h);if(["behaviorPack","resourcePack","skinPack","worldTemplate"].includes(D.id))return $.join(l(D.id,(f=(c=r.packNameSuffix)==null?void 0:c[D.id])!=null?f:D.defaultPackPath),y)}}},bn=({fileType:r,projectConfig:e,requestJsonData:t,options:i,console:n,jsRuntime:s})=>{const u=(f,D)=>e.resolvePackPath(f,D),a=new Xa({}),o=f=>f==null?void 0:f.endsWith(".molang"),l=f=>f==null?void 0:f.startsWith(e.resolvePackPath("behaviorPack","scripts/molang/")),h=f=>{var D;return(D=Object.entries(i.include).find(([F])=>(r==null?void 0:r.getId(f))===F))==null?void 0:D[1]};let c=[];return{async buildStart(){i.include=Object.assign(await t("data/packages/minecraftBedrock/location/validMoLang.json"),i.include)},transformPath(f){if(o(f)||l(f))return null},async read(f,D){if((o(f)||l(f))&&D){const F=await D.getFile();return await(F==null?void 0:F.text())}else if(h(f)&&f.endsWith(".json")&&D){const F=await D.getFile();if(!F)return;try{return we.parse(await F.text())}catch(y){return i.buildType!=="fileRequest"&&n.error(`Error within file "${f}": ${y}`),{__error__:`Failed to load original file: ${y}`}}}},async load(f,D){if(o(f)&&D)a.parse(D);else if(l(f)){const F=await s.run(f,{console:n},D).catch(y=>(n.error(`Failed to execute Molang AST script "${f}": ${y}`),null));if(!F)return null;typeof F.__default__=="function"&&c.push(F.__default__)}},async require(f){if(h(f))return[u("behaviorPack","scripts/molang/**/*.[jt]s"),u("behaviorPack","molang/**/*.molang"),u("resourcePack","molang/**/*.molang")]},async transform(f,D){const F=h(f);F&&F.length>0&&F.forEach(y=>Ri(y,D,d=>{if(typeof d!="string"||d[0]==="/"||d[0]==="@")return d;if(c.length>0){let p=null;try{p=a.parse(d)}catch(w){i.buildType!=="fileRequest"&&n.error(`Error within file "${f}"; script "${d}": ${w}`)}if(p){for(const w of c)p=p.walk(w);d=p.toString()}}try{return a.transform(d)}catch(p){return i.buildType!=="fileRequest"&&n.error(`Error within file "${f}"; script "${d}": ${p}`),d}}))},finalizeBuild(f,D){if(h(f)&&typeof D!="string")return JSON.stringify(D,null,"	")},buildEnd(){c=[]}}},Ao=({fileType:r})=>({registerAliases(e,t){var i,n,s,u;if((r==null?void 0:r.getId(e))==="entity"&&((n=(i=t==null?void 0:t["minecraft:entity"])==null?void 0:i.description)==null?void 0:n.identifier))return[(u=(s=t==null?void 0:t["minecraft:entity"])==null?void 0:s.description)==null?void 0:u.identifier]}});function Fo(r,e){const t=xn(r),i=xn(e),n=t.pop(),s=i.pop(),u=kn(t,i);return u!==0?u:n&&s?kn(n.split("."),s.split(".")):n||s?n?-1:1:0}const vo=(r,e,t)=>{So(t);const i=Fo(r,e);return Bn[t].includes(i)},bo=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,xn=r=>{if(typeof r!="string")throw new TypeError("Invalid argument expected string");const e=r.match(bo);if(!e)throw new Error(`Invalid argument not valid semver ('${r}' received)`);return e.shift(),e},_n=r=>r==="*"||r==="x"||r==="X",Sn=r=>{const e=parseInt(r,10);return isNaN(e)?r:e},xo=(r,e)=>typeof r!=typeof e?[String(r),String(e)]:[r,e],_o=(r,e)=>{if(_n(r)||_n(e))return 0;const[t,i]=xo(Sn(r),Sn(e));return t>i?1:t<i?-1:0},kn=(r,e)=>{for(let t=0;t<Math.max(r.length,e.length);t++){const i=_o(r[t]||0,e[t]||0);if(i!==0)return i}return 0},Bn={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]},Rn=Object.keys(Bn),So=r=>{if(typeof r!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof r}`);if(Rn.indexOf(r)===-1)throw new Error(`Invalid operator, expected one of ${Rn.join("|")}`)},ko=(r,e)=>({register:t=>{var i;((i=t.type)!=null?i:"entity")===e&&(r.component=({name:n,schema:s,template:u})=>{const a=new t;n(t.component_name),s(zr(Object.values(a.onPropose())[0])),u((o,{create:l})=>{l(a.onApply(o,"components")[`minecraft:${e}`])})})}});function zr(r){const e={},t=Object.keys(r);if(t.length===1&&t[0].startsWith("$dynamic.list."))return{type:"array",items:zr(Object.values(r)[0])};for(const[i,n]of Object.entries(r))i.startsWith("$")||(typeof n=="string"?e[i]=Bo(n):Array.isArray(n)?e[i]={enum:n}:n==="object"&&(e[i]=zr(n)));return{type:"object",properties:e}}function Bo(r){switch(r){case"$general.boolean":return{type:"boolean"};case"$general.number":return{type:"integer"};case"$general.decimal":return{type:"number"};default:return{type:["number","integer","string","boolean","object","array"]}}}class Ro{constructor(e,t,i,n,s,u){this.console=e,this.fileType=t,this.componentSrc=i,this.mode=n,this.v1Compat=s,this.targetVersion=u,this.animations=[],this.animationControllers=[],this.createOnPlayer=[],this.dialogueScenes={},this.serverFiles=[],this.clientFiles={},this.lifecycleHookCount={activated:0,deactivated:0}}setProjectConfig(e){this.projectConfig=e}get name(){return this._name}async load(e,t,i){let n={component:null};const s=await e.run(t,{defineComponent:l=>l,console:this.console,Bridge:this.v1Compat?ko(n,this.fileType):void 0}).catch(()=>(this.console.error(`Failed to execute component ${t}`),null));if(!s)return!1;if(typeof s.__default__!="function")if(n.component)s.__default__=n.component;else return this.console.error(`Component ${t} is not a valid component. Expected a function as the default export.`),!1;const u=l=>this._name=l;let a=l=>this.schema=l,o=()=>{};return(!i||i==="server")&&(a=()=>{},o=l=>{this.template=(h,c)=>{try{l(h,c)}catch(f){this.console.log(l.toString()),this.console.error(f)}}}),await s.__default__({name:u,schema:a,template:o}),!0}reset(){this.animations=[],this.animationControllers=[],this.clientFiles={},this.serverFiles=[]}getSchema(){return this.schema}toString(){return this.componentSrc}create(e,t,i=`minecraft:${this.fileType}`,n){var s;const u=i.split("/"),a=u.pop(),o=this.getObjAtLocation(e,[...u]);o[a]=(n?(l,h)=>n(ft,l,h):ft)((s=o[a])!=null?s:{},t!=null?t:{})}getObjAtLocation(e,t){let i=e;for(;t.length>0;){const n=t.shift();i[n]===void 0?i[Number(n)]!==void 0?i=i[Number(n)]:(i[n]={},i=i[n]):i=i[n]}return i}async processTemplates(e,t,i){var n,s,u,a,o,l;if(typeof this.template!="function")return;const h=(u=(s=(n=e[`minecraft:${this.fileType}`])==null?void 0:n.description)==null?void 0:s.identifier)!=null?u:"bridge:no_identifier",c=await Fr(`${this.name}/${h}`),f=(l=(o=(a=this.projectConfig)==null?void 0:a.get())==null?void 0:o.namespace)!=null?l:"bridge",D=(x,B)=>(this.animations.push([x,B]),this.getShortAnimName("a",c,this.animations.length-1)),F=(x,B)=>(this.animationControllers.push([x,B]),this.getShortAnimName("ac",c,this.animationControllers.length-1)),y=x=>{const B=`loot_tables/bridge/${this.getShortAnimName("lt",c,this.serverFiles.length)}.json`;return this.serverFiles.push([B,x]),B},d=x=>{const B=`trading/bridge/${this.getShortAnimName("tt",c,this.serverFiles.length)}.json`;return this.serverFiles.push([B,x]),B},p=x=>{this.serverFiles.push([`recipes/bridge/${this.getShortAnimName("recipe",c,this.serverFiles.length)}.json`,x])},w=x=>{this.serverFiles.push([`spawn_rules/bridge/${this.getShortAnimName("sr",c,this.serverFiles.length)}.json`,x])},v=(await Fr(`${this.name}/${i}`)).slice(0,16),A=x=>this.registerLifecycleHook(e,i,x,v,"activated"),b=x=>this.registerLifecycleHook(e,i,x,v,"deactivated");this.fileType==="entity"?this.template(t!=null?t:{},{mode:this.mode,compilerMode:this.mode,sourceEntity:()=>JSON.parse(JSON.stringify(e)),create:(x,B,_)=>this.create(e,x,B,_),location:i,identifier:h,projectNamespace:f,animationController:F,animation:D,lootTable:y,tradeTable:d,spawnRule:w,dialogueScene:!this.targetVersion||vo(this.targetVersion,"1.17.10",">=")?(x,B=!0)=>{this.dialogueScenes[c]||(this.dialogueScenes[c]=[]),this.dialogueScenes[c].push(x),x.scene_tag&&B&&A({run_command:{command:[`/dialogue open @s @p ${x.scene_tag}`]}})}:void 0,onActivated:A,onDeactivated:b,client:{create:(x,B="1.10.0")=>{this.clientFiles[`entity/bridge/${c}.json`]={format_version:B,"minecraft:client_entity":Object.assign({description:{identifier:h}},x)}}}}):this.fileType==="item"?this.template(t!=null?t:{},{mode:this.mode,compilerMode:this.mode,sourceItem:()=>JSON.parse(JSON.stringify(e)),create:(x,B,_)=>this.create(e,x,B,_),location:i,identifier:h,projectNamespace:f,lootTable:y,recipe:p,player:{animationController:F,animation:D,create:(x,B,_)=>this.createOnPlayer.push([B!=null?B:"minecraft:entity",x,_])}}):this.fileType==="block"&&this.template(t!=null?t:{},{mode:this.mode,compilerMode:this.mode,sourceBlock:()=>JSON.parse(JSON.stringify(e)),create:(x,B,_)=>this.create(e,x,B,_),lootTable:y,recipe:p,location:i,identifier:h,projectNamespace:f})}async processAdditionalFiles(e,t){var i,n,s,u,a,o;const l=(n=(i=this.projectConfig)==null?void 0:i.getRelativePackRoot("behaviorPack"))!=null?n:"BP",h=(s=this.projectConfig)==null?void 0:s.getRelativePackRoot("resourcePack"),c=(o=(a=(u=t[`minecraft:${this.fileType}`])==null?void 0:u.description)==null?void 0:a.identifier)!=null?o:"bridge:no_identifier",f=await Fr(`${this.name}/${c}`),D=`${l}/animations/bridge/${f}.json`,F=`${l}/animation_controllers/bridge/${f}.json`;return c==="minecraft:player"&&this.createOnPlayer.forEach(([y,d,p])=>{this.create(t,d,y,p)}),h||(this.clientFiles={},this.console.error(`[${this.name}] Dash was unable to load the root of your resource pack and therefore cannot generate client files for this component.`)),{[D]:{baseFile:e,fileContent:this.createAnimations(f,t)},[F]:{baseFile:e,fileContent:this.createAnimationControllers(f,t)},[$.join(l,`dialogue/bridge/${f}.json`)]:this.dialogueScenes[f]&&this.dialogueScenes[f].length>0?{baseFile:e,fileContent:JSON.stringify({format_version:this.targetVersion,"minecraft:npc_dialogue":{scenes:this.dialogueScenes[f]}},null,"	")}:void 0,...Object.fromEntries(this.serverFiles.map(([y,d])=>[$.join(l,y),{baseFile:e,fileContent:JSON.stringify(d,null,"	")}])),...Object.fromEntries(Object.entries(this.clientFiles).map(([y,d])=>[$.join(h,y),{baseFile:e,fileContent:JSON.stringify(d,null,"	")}]))}}createAnimations(e,t){if(this.animations.length===0)return;let i=0;const n={format_version:"1.10.0",animations:{}};for(const[s,u]of this.animations){if(!s){i++;continue}const a=this.getAnimName("animation",e,i),o=this.getShortAnimName("a",e,i);n.animations[a]=s,this.create(t,{animations:{[o]:a}},"minecraft:entity/description"),u!==!1&&this.create(t,{scripts:{animate:[u?{[o]:u}:o]}},"minecraft:entity/description"),i++}return JSON.stringify(n,null,"	")}createAnimationControllers(e,t){if(this.animationControllers.length===0)return;let i=0;const n={format_version:"1.10.0",animation_controllers:{}};for(const[s,u]of this.animationControllers){if(!s){i++;continue}const a=this.getAnimName("controller.animation",e,i),o=this.getShortAnimName("ac",e,i);n.animation_controllers[a]=s,this.create(t,{animations:{[o]:a}},"minecraft:entity/description"),u!==!1&&this.create(t,{scripts:{animate:[u?{[o]:u}:o]}},"minecraft:entity/description"),i++}return JSON.stringify(n,null,"	")}getAnimName(e,t,i){return`${e}.${t}_${i}`}getShortAnimName(e,t,i){var n;return`${(n=t.slice(0,16))!=null?n:"bridge_auto"}_${e}_${i}`}registerLifecycleHook(e,t,i,n,s){e[`minecraft:${this.fileType}`].events||(e[`minecraft:${this.fileType}`].events={});const u=e[`minecraft:${this.fileType}`].events;if(s==="activated"&&t===`minecraft:${this.fileType}/components`)u["minecraft:entity_spawned"]||(u["minecraft:entity_spawned"]={}),this.addEventReponse(u["minecraft:entity_spawned"],i);else if(this.fileType==="entity"&&t.startsWith(`minecraft:${this.fileType}/component_groups/`)){const a=t.split("/").pop();this.findComponentGroupReferences(u,s==="activated"?"add":"remove",a).forEach(l=>this.addEventReponse(l,i))}else if(t.startsWith(`minecraft:${this.fileType}/permutations/`)){const a=t.split("/");if(a.pop()!=="components")throw new Error("Invalid component location inside of permutation");const o=this.getObjAtLocation(e,[...a]),l=`bridge:${n}_${s}_${s==="activated"?this.lifecycleHookCount.activated++:this.lifecycleHookCount.deactivated++}`;o.condition&&this.animationControllers.push([{states:{default:{on_entry:[`@s ${l}`]}}},s==="activated"?o.condition:`!(${o.condition})`]),u[l]=i}}addEventReponse(e,t){if(Array.isArray(e.sequence))e.sequence.push(t);else if(Object.keys(e).length===0)Object.assign(e,t);else{let i=Object.assign({},e,{filters:void 0});for(const n in e)n!=="filters"&&(e[n]=void 0);e.sequence=[i,t]}}findComponentGroupReferences(e,t,i){var n,s;let u=[];for(const a in e){const o=e[a];Array.isArray(o.sequence)?u.push(...this.findComponentGroupReferences(o.sequence,t,i)):Array.isArray(o.randomize)?u.push(...this.findComponentGroupReferences(o.randomize,t,i)):((s=(n=o[t])==null?void 0:n.component_groups)!=null?s:[]).includes(i)&&u.push(o)}return u}}function To(r){const e=[];for(const[t,i]of r)e.push(...$o(i,t));return e}function $o(r,e){const t=[];for(const i in r)i.startsWith("minecraft:")||i.startsWith("tag:")||t.push([i,e]);return t}function Wr({fileType:r,getComponentObjects:e}){const t=new Map;let i={};return({console:n,projectConfig:s,projectRoot:u,compileFiles:a,getAliases:o,options:l,jsRuntime:h,targetVersion:c,fileType:f})=>{const D=(d,p)=>d&&r==="item"&&(f==null?void 0:f.getId(d))==="entity"&&p(d).includes("minecraft:player"),F=d=>l.v1CompatMode?d==null?void 0:d.includes("/components/"):d&&(f==null?void 0:f.getId(d))==="customComponent"&&d.includes(`/${r}/`),y=d=>d&&(f==null?void 0:f.getId(d))===r;return{buildStart(){t.clear(),i={}},transformPath(d){if(F(d)&&l.buildType!=="fileRequest")return null},async read(d,p){if(!p)return i[d]?we.parse(i[d].fileContent):void 0;if(F(d)&&d.endsWith(".js")){const w=await p.getFile();return await(w==null?void 0:w.text())}else if(y(d)||D(d,o)){const w=await p.getFile();if(!w)return;try{return we.parse(await w.text())}catch(v){return l.buildType!=="fileRequest"&&n.error(`Error within file "${d}": ${v}`),{__error__:`Failed to load original file: ${v}`}}}},async load(d,p){if(F(d)&&typeof p=="string"){const w=new Ro(n,r,p,l.mode,!!l.v1CompatMode,c);return w.setProjectConfig(s),await w.load(h,d)?w:p}},async registerAliases(d,p){if(F(d))return[`${r}Component#${p.name}`]},async require(d,p){if(D(d,o))return[`.${s.getRelativePackRoot("behaviorPack")}/components/item/**/*.[jt]s`,`.${s.getRelativePackRoot("behaviorPack")}/items/**/*.json`];if(y(d)){const w=To(e(p));return t.set(d,w),w.map(v=>`${r}Component#${v[0]}`)}else if(i[d])return[i[d].baseFile]},async transform(d,p,w={}){var v;if(D(d,o)){const A=Object.entries(w).filter(([b])=>b.startsWith("itemComponent#")).map(([b,x])=>x);for(const b of A){if(!b)return;i=ft(i,await b.processAdditionalFiles(d,p))}}else if(y(d)){const A=new Set;for(const[b,x]of(v=t.get(d))!=null?v:[]){const B=w[`${r}Component#${b}`];if(!B)continue;const _=wu(p,x.split("/"),{}),R=_[b];delete _[b],await B.processTemplates(p,R,x),A.add(B)}for(const b of A)i=ft(i,await b.processAdditionalFiles(d,p));for(const b of A)b.reset()}},finalizeBuild(d,p){if(F(d)&&p)return p.toString();if(y(d)||i[d])return JSON.stringify(p,null,"	")},async buildEnd(){if(l.buildType==="fileRequest")return;i=Object.fromEntries(Object.entries(i).filter(([p,w])=>(w==null?void 0:w.fileContent)!==void 0).map(([p,w])=>[$.join(u,p),w]));const d=Object.keys(i);d.length>0&&await a(d),i={}}}}}const Oo=Wr({fileType:"entity",getComponentObjects:r=>{var e,t,i,n,s,u;return[["minecraft:entity/components",(t=(e=r==null?void 0:r["minecraft:entity"])==null?void 0:e.components)!=null?t:{}],...Object.entries((n=(i=r==null?void 0:r["minecraft:entity"])==null?void 0:i.component_groups)!=null?n:{}).map(([a,o])=>[`minecraft:entity/component_groups/${a}`,o]),...((u=(s=r==null?void 0:r["minecraft:entity"])==null?void 0:s.permutations)!=null?u:[]).map((a,o)=>{var l;return[`minecraft:entity/permutations/${o}/components`,(l=a==null?void 0:a.components)!=null?l:{}]})]}}),Po=Wr({fileType:"item",getComponentObjects:r=>{var e,t;return[["minecraft:item/components",(t=(e=r==null?void 0:r["minecraft:item"])==null?void 0:e.components)!=null?t:{}]]}}),No=Wr({fileType:"block",getComponentObjects:r=>{var e,t,i,n;return[["minecraft:block/components",(t=(e=r==null?void 0:r["minecraft:block"])==null?void 0:e.components)!=null?t:{}],...((n=(i=r==null?void 0:r["minecraft:block"])==null?void 0:i.permutations)!=null?n:[]).map((s,u)=>{var a;return[`minecraft:block/permutations/${u}/components`,(a=s.components)!=null?a:{}]})]}});function Gr(r,e,t,i=0){const n=[];for(const s of r){if(!s.startsWith("/")){n.push(s);continue}const[u,...a]=Ti(s.slice(1)).tokens.map(({word:l})=>l),o=e[`command#${u}`];if(u==="execute"){let l=4;if(a[l]==="detect"&&(l+=6),a[l]===void 0){n.push(s);continue}const[h,...c]=a.slice(l),f=e[`command#${h}`];if(!(f instanceof qr)){n.push(s);continue}n.push(...f.process(`${h} ${c.join(" ")}`,e,i+1).map(D=>D.startsWith("/")?`/execute ${a.slice(0,l).join(" ")} ${D.slice(1)}`:D));continue}else if(!(o instanceof qr)){n.push(s);continue}n.push(...o.process(s,e,i))}return n.filter(s=>t||!s.startsWith("#")).map(s=>s.trim())}const Io=r=>({register:e=>{r.command=({name:t,schema:i,template:n})=>{t(e.command_name),i([]),n(s=>new e().onApply(s))}}});class qr{constructor(e,t,i,n){this.console=e,this.commandSrc=t,this.mode=i,this.v1Compat=n}get name(){var e;return(e=this._name)!=null?e:"unknown"}async load(e,t,i){const n={command:null},s=await e.run(t,{console:this.console,defineCommand:l=>l,Bridge:this.v1Compat?Io(n):void 0}).catch(l=>(this.console.error(`Failed to execute command ${this.name}: ${l}`),null));if(!s)return null;if(typeof s.__default__!="function")if(n.command)s.__default__=n.command;else return this.console.error(`Component ${t} is not a valid component. Expected a function as the default export.`),!1;const u=l=>this._name=l;let a=l=>this.schema=l,o=()=>{};(!i||i==="server")&&(a=()=>{},o=l=>{this.template=(h,c)=>{try{return l(h,c)}catch(f){return this.console.error(f),[]}}}),await s.__default__({name:u,schema:a,template:o})}process(e,t,i){var n;e.startsWith("/")&&(e=e.slice(1));const[s,...u]=Ti(e).tokens.map(({word:l})=>l),a=(n=this.template)==null?void 0:n.call(this,u.map(l=>vu(l)),{compilerMode:this.mode,commandNestingDepth:i,compileCommands:l=>Gr(l.map(h=>h.startsWith("/")?h:`/${h}`),t,!1,i+1).map(h=>h.startsWith("/")?h.slice(1):h)});let o=[];if(typeof a=="string")o=a.split(`
`);else if(Array.isArray(a))o=a.filter(l=>typeof l=="string");else{const l=`Failed to process command ${this._name}; Invalid command template return type: Expected string[] or string, received ${typeof a}`;this.console.error(l),o.push(`# ${l}`)}return o.map(l=>l.startsWith("/")||l.startsWith("#")?l:`/${l}`)}getSchema(){if(this.schema){if(Array.isArray(this.schema))return this.schema.length===0?[{commandName:this.name}]:this.schema.map(e=>({commandName:this.name,...e}))}else return[{commandName:this.name}];return this.schema.commandName||(this.schema.commandName=this.name),[this.schema]}toString(){return this.commandSrc}}const Lo=({projectConfig:r,jsRuntime:e,console:t,fileType:i,requestJsonData:n,options:s})=>{const u=(c,f)=>r.resolvePackPath(c,f),a=c=>c&&i.getId(c)==="customCommand",o=c=>c&&i.getId(c)==="function",l=c=>{var f;return(f=Object.entries(s.include).find(([D])=>i.getId(c)===D))==null?void 0:f[1]},h=c=>{var f,D,F;return(F=(D=(f=i.get(c))==null?void 0:f.meta)==null?void 0:D.commandsUseSlash)!=null?F:!1};return{async buildStart(){s.include=Object.assign(await n("data/packages/minecraftBedrock/location/validCommand.json"),s.include)},transformPath(c){if(a(c)&&s.buildType!=="fileRequest")return null},async read(c,f){if(!!f){if(a(c)&&c.endsWith(".js")){const D=await f.getFile();return await(D==null?void 0:D.text())}else if(o(c)){const D=await f.getFile();return await(D==null?void 0:D.text())}else if(l(c)&&f){const D=await f.getFile();if(!D)return;try{return we.parse(await D.text())}catch(F){t.error(F)}}}},async load(c,f){var D;if(a(c)){const F=new qr(t,f,s.mode,(D=s.v1CompatMode)!=null?D:!1);return await F.load(e,c),F}},async registerAliases(c,f){if(a(c))return[`command#${f.name}`]},async require(c){if(l(c)||o(c))return[u("behaviorPack","commands/**/*.[jt]s"),u("behaviorPack","commands/*.[jt]s")]},async transform(c,f,D={}){const F=l(c);if(F&&F.length>0){const y=h(c);F.forEach(d=>Ri(d,f,p=>{if(!p)return p;p=Array.isArray(p)?p:[p];const w=[];for(const v of p){if(typeof v=="string"){w.push(v);continue}t.error(`The file "${c}" contains invalid commands. Expected type "string" within array but got type "${typeof v}"`)}return Gr(w.map(v=>!y&&!v.startsWith("/")?`/${v}`:v),D,!1).map(v=>y?v:v.slice(1))}))}else if(o(c)){const y=f.split(`
`).map(d=>d.trim()).filter(d=>d!==""&&!d.startsWith("#")).map(d=>`/${d}`);return Gr(y,D,!0).map(d=>d.startsWith("/")?d.slice(1):d).join(`
`)}},finalizeBuild(c,f){if(a(c)&&f)return f.toString();if(l(c)&&typeof f!="string")return JSON.stringify(f,null,"	")}}},Mo=({options:r})=>({async transformPath(e){if(!!(e!=null&&e.endsWith(".ts")))return`${e.slice(0,-3)}.js`},async read(e,t){if(!e.endsWith(".ts")||!t)return;const i=await t.getFile();return await(i==null?void 0:i.text())},async load(e,t){if(!!e.endsWith(".ts"))return await Qt,wn(t,{filename:$.basename(e),sourceMaps:r!=null&&r.inlineSourceMap?"inline":void 0,jsc:{parser:{syntax:"typescript",preserveAllComments:!1,topLevelAwait:!0},target:"es2020"}}).code},finalizeBuild(e,t){if(e.endsWith(".ts")&&typeof t=="string")return t}}),Ho=({options:r,outputFileSystem:e,projectRoot:t,packType:i,fileType:n,console:s})=>{r.packName||(r.packName="bridge project");const u=h=>h.split(/\\|\//g).filter(c=>c!==".."&&c!==".").slice(1).join("/"),a=h=>{const c=i.getId(h),f=$.relative(t,h);if(c==="behaviorPack"||c==="resourcePack"||c==="skinPack")return $.join(t,"builds/dist",c,u(f))},o=h=>{const c=i.getId(h),f=$.relative(t,h);if(c==="worldTemplate")return $.join(t,"builds/dist",u(f));if(c==="behaviorPack"||c==="resourcePack")return $.join(t,"builds/dist",c==="behaviorPack"?"behavior_packs":"resource_packs",r.packName,u(f))},l=h=>n.getId(h)==="worldManifest"?null:o(h);return{async buildStart(){await e.unlink(`${t}/builds/dist`).catch(()=>{})},transformPath(h){if(!!h)switch(r.format){case"mcaddon":return a(h);case"mcworld":return l(h);case"mctemplate":return o(h);default:s.error(`Unknown packaging format: ${r.format}`)}}}},jo=({projectConfig:r,packType:e,options:t})=>{const i=Object.keys(r.getAvailablePacks()),n=Object.fromEntries(i.map(u=>[u,[]])),s=u=>{const a=e.getId(u);if(a!=="unknown")return[a,r.resolvePackPath(a,"contents.json")]};return t.buildType!=="fullBuild"?{}:{include(){return i.map(u=>[r.resolvePackPath(u,"contents.json"),{isVirtual:!0}])},read(u){const a=s(u);if(!a)return;const[o,l]=a;if(u!==l)return n[o]},transformPath(u){if(!u)return;const a=e.getId(u);a!=="unknown"&&n[a].push(u)},finalizeBuild(u){const a=s(u);if(!a)return;const[o,l]=a;if(u!==l)return JSON.stringify(n[o])}}},Uo=({fileType:r})=>{const e=[];for(const i of r.all)i.formatVersionMap&&e.push(i.id);const t=i=>i&&e.includes(r.getId(i));return{async read(i,n){if(!!n&&t(i)){const s=await n.getFile();if(!s)return;try{return we.parse(await s.text())}catch(u){console.error(u)}}},load(i,n){if(t(i))return n},transform(i,n){if(t(i)){const s=r.get(i),u=s==null?void 0:s.formatVersionMap;if(!u)return;const a=n==null?void 0:n.format_version;return a&&u[a]&&(n.format_version=u[a]),n}},finalizeBuild(i,n){if(t(i))return JSON.stringify(n)}}};class Jr{constructor(e,t){this.console=e,this.baseDir=t,this.files=new Map}get hasFiles(){return this.files.size>0}getAll(){return[...this.files.entries()]}get(e){return this.files.get(e)}clear(){this.files.clear()}add(e,t){const i=this.baseDir?$.join(this.baseDir,e):e;if(this.files.has(i)){this.console.warn(`Omitting file "${i}" from collection because it would overwrite a previously generated file!`);return}this.files.set(i,t)}has(e){return this.files.has(e)}addFrom(e){for(const[t,i]of e.getAll())this.add(t,i)}}function zo({generatorPath:r,omitUsedTemplates:e,fileSystem:t,console:i}){return{useTemplate:(n,{omitTemplate:s=!0}={})=>{const u=$.join($.dirname(r),n);return s&&e.add(u),n.endsWith(".json")?t.readJson(u):t.readFile(u).then(a=>a.text())},createCollection:()=>new Jr(i,$.dirname(r))}}const Wo=({options:r,fileType:e,console:t,jsRuntime:i,fileSystem:n,compileFiles:s,getFileMetadata:u,unlinkOutputFiles:a,addFileDependencies:o})=>{var l;const h=new Set(["gameTest","customCommand","customComponent","molangAstScript",...(l=r.ignoredFileTypes)!=null?l:[]]),c=A=>e.getId(A),f=A=>{var b;const x=e.get(A,void 0,!1);return x?(b=x.type)!=null?b:"json":"raw"},D=A=>!h.has(c(A))&&(A.endsWith(".js")||A.endsWith(".ts")),F=A=>{var b,x,B,_;return f(A)==="json"?".json":(_=(B=(x=(b=e.get(A,void 0,!1))==null?void 0:b.detect)==null?void 0:x.fileExtensions)==null?void 0:B[0])!=null?_:".txt"},y=A=>A.replace(/\.(js|ts)$/,F(A)),d=new Set,p=new Jr(t),w=new Set,v=new Map;return{buildStart(){p.clear(),d.clear(),w.clear(),v.clear()},transformPath(A){if(A&&D(A))return y(A)},async read(A,b){if(D(A)&&b){const B=await b.getFile();return B?B.text():void 0}const x=p.get(A);if(x)return x},async load(A,b){var x,B;const _=new Set;if(i.registerModule("@bridge/generate",zo({generatorPath:A,fileSystem:n,omitUsedTemplates:_,console:t})),D(A)){if(!b)return null;const R=await i.run(A,{console:t},b).catch(N=>(t.error(`Failed to execute generator script "${A}": ${N}`),null));if(!R)return null;if(!R.__default__)return t.error(`Expected generator script "${A}" to provide file content as default export!`),null;const q=u(A);((x=q.get("unlinkedFiles"))!=null?x:[]).filter(N=>!_.has(N)).forEach(N=>w.add(N)),q.set("unlinkedFiles",[..._]);const H=(B=q.get("generatedFiles"))!=null?B:[];return await a([...H,..._]).catch(()=>{}),v.set(A,_),R.__default__}},require(A){const b=v.get(A);if(b)return[...b]},finalizeBuild(A,b){if(p.get(A))return A.endsWith(".json")&&typeof b!="string"?JSON.stringify(b,null,"	"):b;if(d.has(A))return null;if(D(A)){if(b===null)return null;const x=u(A);return b instanceof Jr?(p.addFrom(b),x.set("generatedFiles",b.getAll().map(([B])=>B)),null):(x.set("generatedFiles",[y(A)]),typeof b=="object"?JSON.stringify(b):b)}},async buildEnd(){i.deleteModule("@bridge/generate"),w.size>0&&await s([...w].filter(A=>!p.has(A)),!1),p.hasFiles&&await s(p.getAll().map(([A])=>A))},async beforeFileUnlinked(A){var b,x;if(D(A)){const B=u(A),_=(b=B.get("unlinkedFiles"))!=null?b:[],R=(x=B.get("generatedFiles"))!=null?x:[];await a(R),await s(_)}}}};class Tn extends fo{constructor(e,t){super(t),this.fs=e}readFile(e){return this.fs.readFile(e).then(t=>t.text())}deleteModule(e){this.baseModules.delete(e)}}const $n={simpleRewrite:yo,rewriteForPackaging:Ho,moLang:bn,molang:bn,entityIdentifierAlias:Ao,customEntityComponents:Oo,customItemComponents:Po,customBlockComponents:No,customCommands:Lo,typeScript:Mo,contentsFile:jo,formatVersionCorrection:Uo,generatorScripts:Wo};class Go{constructor(e){this.dash=e,this.plugins=[],this.pluginRuntime=new Tn(this.dash.fileSystem)}async loadPlugins(e={}){var t,i;this.plugins=[],this.pluginRuntime.clearCache();const n=[...(await this.dash.fileSystem.readdir($.join(this.dash.projectRoot,".bridge/extensions")).catch(()=>[])).map(a=>a.kind==="directory"?$.join(this.dash.projectRoot,".bridge/extensions",a.name):void 0),...(await this.dash.fileSystem.readdir("extensions").catch(()=>[])).map(a=>a.kind==="directory"?$.join("extensions",a.name):void 0)],s={};for(const a of n){if(!a)continue;let o;try{o=await this.dash.fileSystem.readJson($.join(a,"manifest.json"))}catch{continue}if(!!((t=o==null?void 0:o.compiler)!=null&&t.plugins))for(const l in o.compiler.plugins)s[l]=$.join(a,o.compiler.plugins[l])}const u=(i=(await this.getCompilerOptions()).plugins)!=null?i:[];for(const a of u){const o=typeof a=="string"?a:a[0],l=typeof a=="string"?{}:a[1];if(s[o]){const h=await this.pluginRuntime.run(s[o],{console:this.dash.console,...e}).catch(c=>(this.dash.console.error(`Failed to execute plugin ${o}: ${c}`),null));if(!h)continue;typeof h.__default__=="function"?this.plugins.push(new vn(this.dash,o,h.__default__(await this.getPluginContext(o,l)))):this.dash.console.error(`Plugin ${o} is invalid: It does not provide a function as a default export.`)}else $n[o]?this.plugins.push(new vn(this.dash,o,$n[o](await this.getPluginContext(o,l)))):this.dash.console.error(`Unknown compiler plugin: ${o}`)}}async getCompilerOptions(){var e;const t=await this.dash.getCompilerConfigPath();return t?await this.dash.fileSystem.readJson(t):(e=this.dash.projectConfig.get().compiler)!=null?e:{}}async getPluginContext(e,t={}){const i=this.dash;return{options:{get mode(){return i.getMode()},get buildType(){return i.buildType},...t},jsRuntime:this.dash.jsRuntime,console:this.dash.console,fileSystem:this.dash.fileSystem,outputFileSystem:this.dash.outputFileSystem,projectConfig:this.dash.projectConfig,projectRoot:this.dash.projectRoot,packType:this.dash.packType,fileType:this.dash.fileType,targetVersion:this.dash.projectConfig.get().targetVersion,requestJsonData:this.dash.requestJsonData,getAliases:n=>{var s,u;return[...(u=(s=this.dash.includedFiles.get(n))==null?void 0:s.aliases)!=null?u:[]]},getFileMetadata:n=>{const s=this.dash.includedFiles.get(n);if(!s)throw new Error(`File ${n} to add metadata to not found`);return{get(u){return s.getMetadata(u)},set(u,a){s.addMetadata(u,a)},delete(u){s.deleteMetadata(u)}}},addFileDependencies:(n,s,u=!1)=>{const a=this.dash.includedFiles.get(n);if(!a)throw new Error(`File ${n} to add dependency to not found`);u?a.setRequiredFiles(new Set(s)):s.forEach(o=>a.addRequiredFile(o))},getOutputPath:n=>this.dash.getCompilerOutputPath(n),unlinkOutputFiles:n=>this.dash.unlinkMultiple(n,!1,!0),hasComMojangDirectory:this.dash.fileSystem!==this.dash.outputFileSystem,compileFiles:(n,s=!0)=>this.dash.compileAdditionalFiles(n,s)}}async runBuildStartHooks(){for(const e of this.plugins)await e.runBuildStartHook()}async runIncludeHooks(){let e=[];for(const t of this.plugins){const i=await t.runIncludeHook();Array.isArray(i)&&e.push(...i)}return e}async runTransformPathHooks(e){let t=e;for(const i of this.plugins){const n=await i.runTransformPathHook(t);if(n===null)return null;n!==void 0&&(t=n)}return t}async runReadHooks(e,t){for(const i of this.plugins){const n=await i.runReadHook(e,t);if(n!=null)return n}}async runLoadHooks(e,t){let i=t;for(const n of this.plugins){const s=await n.runLoadHook(e,i);s!==void 0&&(i=s)}return i}async runRegisterAliasesHooks(e,t){const i=new Set;for(const n of this.plugins){const s=await n.runRegisterAliasesHook(e,t);s!=null&&(Array.isArray(s)?s.forEach(u=>i.add(u)):i.add(s))}return i}async runRequireHooks(e,t){const i=new Set;for(const n of this.plugins){const s=await n.runRequireHook(e,t);s!=null&&(Array.isArray(s)?s.forEach(u=>i.add(u)):i.add(s))}return i}async runTransformHooks(e){const t=Object.fromEntries([...e.requiredFiles].map(n=>this.dash.includedFiles.query(n)).flat().map(n=>[[n.filePath,n.data],...[...n.aliases].map(s=>[s,n.data])]).flat());let i=e.data;for(const n of this.plugins){const s=await n.runTransformHook(e.filePath,i,t);s!==void 0&&(i=s)}return i}async runFinalizeBuildHooks(e){for(const t of this.plugins){const i=await t.runFinalizeBuildHook(e.filePath,e.data);if(i!==void 0)return i}}async runBuildEndHooks(){for(const e of this.plugins)await e.runBuildEndHook()}async runBeforeFileUnlinked(e){for(const t of this.plugins)await t.runBeforeFileUnlinked(e)}}class Vr{constructor(e,t,i=!1){this.dash=e,this.filePath=t,this.isVirtual=i,this.isDone=!1,this.requiredFiles=new Set,this.aliases=new Set,this.updateFiles=new Set,this.metadata=new Map,this.outputPath=t,this.isVirtual||this.setDefaultFileHandle()}setFileHandle(e){this.fileHandle=e}setDefaultFileHandle(){this.setFileHandle({getFile:()=>this.dash.fileSystem.readFile(this.filePath).catch(()=>null)})}setOutputPath(e){this.outputPath=e}setReadData(e){this.data=e}setAliases(e){for(const t of e)this.dash.includedFiles.addAlias(t,this);this.aliases=e}setRequiredFiles(e){this.requiredFiles=e}addRequiredFile(e){this.requiredFiles.add(e)}setUpdateFiles(e){this.updateFiles=new Set(e.map(t=>this.dash.includedFiles.get(t)).filter(t=>t!==void 0))}addUpdateFile(e){this.updateFiles.add(e)}removeUpdateFile(e){this.updateFiles.delete(e)}setMetadata(e){typeof e=="object"&&(this.metadata=new Map(Object.entries(e)))}addMetadata(e,t){this.metadata.set(e,t)}deleteMetadata(e){this.metadata.delete(e)}getMetadata(e){return this.metadata.get(e)}getAllMetadata(){return Object.fromEntries(this.metadata.entries())}getHotUpdateChain(){const e=new Set([this]);for(const t of this.updateFiles)t.getHotUpdateChain().forEach(i=>{e.add(i)});return e}filesToLoadForHotUpdate(e=new Set,t=!0){const i=new Set;if(e.has(this))return i;e.add(this);for(const n of this.requiredFiles){const s=this.dash.includedFiles.query(n);for(const u of s)u.filesToLoadForHotUpdate(e,!1).forEach(a=>{i.add(a)})}if(i.add(this),t)for(const n of this.updateFiles)n.filesToLoadForHotUpdate(e,!0).forEach(s=>{i.add(s)});return i}async processAfterLoad(e){if((this.data===null||this.data===void 0)&&(this.isDone=!0,this.filePath!==this.outputPath&&this.outputPath!==null&&!this.isVirtual&&e)){const t=await this.dash.fileSystem.readFile(this.filePath);await this.dash.outputFileSystem.writeFile(this.outputPath,new Uint8Array(await t.arrayBuffer()))}}serialize(){return{isVirtual:this.isVirtual,filePath:this.filePath,aliases:[...this.aliases],requiredFiles:[...this.requiredFiles],updateFiles:[...this.updateFiles].map(e=>e.filePath),metadata:this.metadata.size>0?Object.fromEntries(this.metadata.entries()):void 0}}reset(){this.isDone=!1,this.data=null,this.isVirtual||this.setDefaultFileHandle()}}class qo{constructor(e){this.dash=e,this.files=new Map,this.aliases=new Map,this.queryCache=new Map}all(){return[...this.files.values()]}filtered(e){return this.all().filter(t=>e(t))}get(e){var t;return(t=this.aliases.get(e))!=null?t:this.files.get(e)}query(e){if(Co(e))return this.queryGlob(e);const t=this.aliases.get(e);if(t)return[t];const i=this.files.get(e);return i?[i]:[]}addAlias(e,t){this.aliases.set(e,t)}queryGlob(e){if(this.queryCache.has(e))return this.queryCache.get(e);const t=this.filtered(i=>Ot(i.filePath,e));return this.queryCache.set(e,t),t}async loadAll(){this.queryCache=new Map;const e=new Set,t=this.dash.projectConfig.getAvailablePackPaths();for(const n of t){const s=await this.dash.fileSystem.allFiles(n).catch(u=>(this.dash.console.warn(u),[]));for(const u of s)e.add(u)}const i=await this.dash.plugins.runIncludeHooks();for(const n of i)typeof n=="string"?e.add(n):this.addOne(n[0],n[1].isVirtual);this.add([...e])}addOne(e,t=!1){const i=new Vr(this.dash,e,t);return this.files.set(e,i),i}add(e,t=!1){let i=[];for(const n of e){const s=this.files.get(n);if(s){i.push(s);continue}i.push(new Vr(this.dash,n,t)),this.files.set(n,i[i.length-1])}return i}remove(e){const t=this.files.get(e);if(!!t){this.files.delete(e);for(const i of t.aliases)this.aliases.delete(i)}}async save(e){await this.dash.fileSystem.writeJson(e,this.all().map(t=>t.serialize()))}async load(e){this.removeAll();const t=await this.dash.fileSystem.readJson(e).catch(()=>null),i=[];if(!!t){for(const n of t){const s=new Vr(this.dash,n.filePath,n.isVirtual);s.setAliases(new Set(n.aliases)),s.setRequiredFiles(new Set(n.requiredFiles)),s.setMetadata(n.metadata),i.push(s);for(const u of n.aliases)this.aliases.set(u,s)}this.files=new Map(i.map(n=>[n.filePath,n]));for(let n=0;n<i.length;n++)i[n].setUpdateFiles(t[n].updateFiles)}}resetAll(){for(const e of this.all())e.reset()}removeAll(){this.files=new Map,this.aliases=new Map,this.queryCache=new Map}}class Jo{constructor(e){this.dash=e}async run(e,t=!0){for(const i of e)i.isDone||await this.loadFile(i,t);for(const i of e)i.isDone||await this.loadRequiredFiles(i)}async loadFile(e,t=!0){var i;const[n,s]=await Promise.all([this.dash.plugins.runTransformPathHooks(e.filePath),this.dash.plugins.runReadHooks(e.filePath,e.fileHandle)]);if(e.setOutputPath(n),e.setReadData(s),await e.processAfterLoad(t),e.isDone)return;e.setReadData((i=await this.dash.plugins.runLoadHooks(e.filePath,e.data))!=null?i:e.data);const u=await this.dash.plugins.runRegisterAliasesHooks(e.filePath,e.data);e.setAliases(u)}async loadRequiredFiles(e){const t=await this.dash.plugins.runRequireHooks(e.filePath,e.data);e.setRequiredFiles(t)}}class Vo{constructor(e){this.dash=e}run(e){const t=new Set;for(const i of e)i.isDone||t.has(i)||this.resolveSingle(i,t);return t}resolveSingle(e,t,i=new Set){const n=this.dash.includedFiles;i.add(e);for(const s of e.requiredFiles){const u=n.query(s);for(const a of u){if(!a){this.dash.console.error(`Undefined file dependency: "${e.filePath}" requires "${s}"`);continue}if(a.addUpdateFile(e),!t.has(a)){if(i.has(a)){this.dash.console.error(`Circular dependency detected: ${a.filePath} is required by ${e.filePath} but also depends on this file.`);continue}this.resolveSingle(a,t,i)}}}t.add(e),i.delete(e)}}function Ko(r){return typeof r=="string"||r instanceof Blob||r instanceof File||r instanceof ArrayBuffer||(r==null?void 0:r.buffer)instanceof ArrayBuffer}class Xo{constructor(e){this.dash=e}async run(e,t=!1){for(const i of e){if(i.isDone)continue;let n=await this.transformFile(i,!0,t);n!=null&&i.outputPath&&await this.dash.outputFileSystem.writeFile(i.outputPath,n)}}async transformFile(e,t=!1,i=!1){var n;if(i||(e.data=(n=await this.dash.plugins.runTransformHooks(e))!=null?n:e.data),!t)return e.data;let s=await this.dash.plugins.runFinalizeBuildHooks(e);return s===void 0&&(s=e.data),s!=null&&(Ko(s)||(this.dash.console.warn(`File "${e.filePath}" was not in a writable format: "${typeof s}". Trying to JSON.stringify(...) it...`,s),s=JSON.stringify(s))),e.isDone=!0,s}}class Qo{constructor(e=1){this.total=e,this.current=0,this.onChangeCbs=new Set}get percentage(){return this.current/this.total}onChange(e){return this.onChangeCbs.add(e),{dispose:()=>this.onChangeCbs.delete(e)}}setTotal(e){this.total=e,this.current=0,this.onChangeCbs.forEach(t=>t(this))}updateCurrent(e){this.current=e,this.onChangeCbs.forEach(t=>t(this))}advance(){this.current++,this.onChangeCbs.forEach(e=>e(this))}addToTotal(e){this.total+=e,this.onChangeCbs.forEach(t=>t(this))}}class On{constructor(){this._timers=new Map}time(e){if(this._timers.has(e)){this.warn(`Timer "${e}" already exists.`);return}else this._timers.set(e,Date.now())}timeEnd(e){const t=this._timers.get(e);if(t)this._timers.delete(e),this.log(`${e}: ${Date.now()-t}ms`);else{this.warn(`Timer "${e}" does not exist.`);return}}}class Yo extends On{log(...e){console.log(...e)}error(...e){console.error(...e)}warn(...e){console.warn(...e)}info(...e){console.info(...e)}}class Zo{constructor(e,t,i){var n;this.fileSystem=e,this.options=i,this.progress=new Qo,this.plugins=new Go(this),this.includedFiles=new qo(this),this.loadFiles=new Jo(this),this.fileOrderResolver=new Vo(this),this.fileTransformer=new Xo(this),this.buildType="fullBuild",this.outputFileSystem=t!=null?t:e,this.projectRoot=$.dirname(i.config),this.projectConfig=new wo(e,i.config),this.console=(n=i.console)!=null?n:new Yo,this.jsRuntime=new Tn(this.fileSystem,[["@molang/expressions",En],["@molang/core",{MoLang:Hr}],["molang",{MoLang:Hr,...En}],["@bridge/compiler",{mode:i.mode}]]),this.packType=i.packType,this.fileType=i.fileType}getMode(){var e;return(e=this.options.mode)!=null?e:"development"}getCompilerConfigPath(){return this.options.compilerConfig}get requestJsonData(){return this.options.requestJsonData}get dashFilePath(){return $.join(this.projectRoot,`.bridge/.dash.${this.getMode()}.json`)}async setup(e){var t,i,n,s;try{await this.projectConfig.setup()}catch(u){this.console.error("Failed to load project config: "+u)}(t=this.fileType)==null||t.setProjectConfig(this.projectConfig),(i=this.packType)==null||i.setProjectConfig(this.projectConfig),await((n=this.fileType)==null?void 0:n.setup(e)),await((s=this.packType)==null?void 0:s.setup(e)),await this.plugins.loadPlugins(this.options.pluginEnvironment)}async reload(){try{await this.projectConfig.refreshConfig()}catch{}await this.plugins.loadPlugins(this.options.pluginEnvironment)}get isCompilerActivated(){const e=this.projectConfig.get();return e.compiler!==void 0&&Array.isArray(e.compiler.plugins)}async build(){if(this.console.log("Starting compilation..."),!this.isCompilerActivated)return;this.jsRuntime.clearCache(),this.buildType="fullBuild",this.includedFiles.removeAll();const e=Date.now();this.progress.setTotal(7),await this.plugins.runBuildStartHooks(),this.progress.advance(),await this.includedFiles.loadAll(),this.progress.advance(),await this.compileIncludedFiles(),await this.plugins.runBuildEndHooks(),this.progress.advance(),this.getMode()==="development"&&await this.saveDashFile(),this.includedFiles.resetAll(),this.progress.advance(),this.console.log(`Dash compiled ${this.includedFiles.all().length} files in ${Date.now()-e}ms!`)}async updateFiles(e,t=!0){var i;if(!this.isCompilerActivated||e.length===0)return;this.buildType="hotUpdate",this.jsRuntime.clearCache(),this.progress.setTotal(8),this.console.log(`Dash is starting to update ${e.length} files...`),await this.includedFiles.load(this.dashFilePath),await this.plugins.runBuildStartHooks();const n=[];for(const o of e){let l=this.includedFiles.get(o);l||([l]=this.includedFiles.add([o])),n.push(l)}this.progress.advance();const s=[];for(const o of n)s.push(new Set([...o.requiredFiles]));this.progress.advance(),await this.loadFiles.run(n),this.progress.advance();for(let o=0;o<n.length;o++){const l=n[o];[...l.requiredFiles].filter(f=>!s[o].has(f)).forEach(f=>this.includedFiles.query(f).forEach(D=>D.addUpdateFile(l))),[...s[o]].filter(f=>!l.requiredFiles.has(f)).forEach(f=>this.includedFiles.query(f).forEach(D=>D.removeUpdateFile(l)))}this.progress.advance();const u=new Set(n.map(o=>[...o.filesToLoadForHotUpdate()]).flat());this.console.log(`Dash is loading ${u.size} files...`),await this.loadFiles.run([...u.values()].filter(o=>!n.includes(o))),this.progress.advance();const a=new Set(n.map(o=>[...o.getHotUpdateChain()]).flat());for(const o of u)o.isDone||(o.data=(i=await this.plugins.runTransformHooks(o))!=null?i:o.data,a.has(o)||(o.isDone=!0));this.progress.advance(),this.console.log(`Dash is compiling ${a.size} files...`),await this.fileTransformer.run(a,!0),this.progress.advance(),await this.plugins.runBuildEndHooks(),t&&await this.saveDashFile(),this.includedFiles.resetAll(),this.console.log(`Dash finished updating ${a.size} files!`),this.progress.advance()}async compileFile(e,t){var i;if(!this.isCompilerActivated)return[[],t];this.buildType="fileRequest",this.jsRuntime.clearCache(),this.progress.setTotal(7),await this.plugins.runBuildStartHooks(),await this.includedFiles.load(this.dashFilePath);let n=this.includedFiles.get(e);n||([n]=this.includedFiles.add([e])),n.setFileHandle({getFile:async()=>new File([t],$.basename(e))}),await this.loadFiles.loadFile(n,!1),await this.loadFiles.loadRequiredFiles(n),this.progress.advance();const s=n.filesToLoadForHotUpdate();await this.loadFiles.run([...s.values()].filter(a=>n!==a),!1),this.progress.advance();for(const a of s)a.isDone||(a.data=(i=await this.plugins.runTransformHooks(a))!=null?i:a.data);this.progress.advance();const u=await this.fileTransformer.transformFile(n,!0,!0);return this.progress.advance(),await this.includedFiles.load(this.dashFilePath),this.progress.advance(),await this.plugins.runBuildEndHooks(),[[...s].map(a=>a.filePath),u]}async unlinkMultiple(e,t=!0,i=!1){if(!this.isCompilerActivated||e.length===0)return;const n=[];for(const s of e)await this.unlink(s,!1,i).catch(u=>n.push(u));if(n.length>0)throw n[0];t&&await this.saveDashFile()}async unlink(e,t=!0,i=!1){if(!this.isCompilerActivated)return;const n=await this.getCompilerOutputPath(e);!n||n===e||(i||(await this.plugins.runBeforeFileUnlinked(e),this.includedFiles.remove(e)),await this.outputFileSystem.unlink(n),t&&await this.saveDashFile())}async rename(e,t){!this.isCompilerActivated||(await this.unlink(e,!1),await this.updateFiles([t],!1),await this.saveDashFile())}async getCompilerOutputPath(e){var t;if(!this.isCompilerActivated)return;const i=this.includedFiles.get(e);if(i&&i.outputPath!==e)return(t=i.outputPath)!=null?t:void 0;const n=await this.plugins.runTransformPathHooks(e);if(!!n)return n}async getFileMetadata(e){if(!this.isCompilerActivated)return;const t=this.includedFiles.get(e);return t?t.getAllMetadata():null}async getFileDependencies(e){if(!this.isCompilerActivated)return[];await this.includedFiles.load(this.dashFilePath);const t=this.includedFiles.get(e);return t?[...t.filesToLoadForHotUpdate()].map(i=>i.isVirtual?i.outputPath:i.filePath).filter(i=>i!==null&&i!==e):[]}async saveDashFile(){await this.includedFiles.save(this.dashFilePath)}async compileIncludedFiles(e=this.includedFiles.all()){await this.loadFiles.run(e),this.progress.advance();const t=this.fileOrderResolver.run(e);this.progress.advance(),await this.fileTransformer.run(t),this.progress.advance()}async compileAdditionalFiles(e,t=!0){const i=this.includedFiles.add(e,t);this.progress.addToTotal(3),i.forEach(n=>n.reset()),await this.compileIncludedFiles(i)}}class el{async allFiles(e){const t=[],i=await this.readdir(e);for(const{name:n,kind:s}of i)s==="directory"?t.push(...await this.allFiles($.join(e,n))):s==="file"&&t.push($.join(e,n));return t}async writeJson(e,t,i=!0){await this.writeFile(e,JSON.stringify(t,null,i?"	":0))}async readJson(e){const t=await this.readFile(e);try{return await we.parse(await t.text())}catch{throw new Error(`Invalid JSON: ${e}`)}}watchDirectory(e,t){console.warn("Watching a directory for changes is not supported on this platform!")}}class tl extends Lu{constructor(e){super(e),this.ready=new He}async setup(e){this.packTypes.length>0||(await e.fired,this.packTypes=await e.readJSON("data/packages/minecraftBedrock/packDefinitions.json").catch(()=>[]),this.ready.dispatch())}}class Pn extends el{constructor(e){super(),this.internalFs=new zt(e)}get internal(){return this.internalFs}readJson(e){return this.internalFs.readJSON(e)}async writeJson(e,t,i){await this.internalFs.writeJSON(e,t,i)}readFile(e){return this.internalFs.readFile(e)}async writeFile(e,t){await this.internalFs.writeFile(e,t)}mkdir(e){return this.internalFs.mkdir(e)}unlink(e){return this.internalFs.unlink(e)}async allFiles(e){return(await this.internalFs.readFilesFromDir(e)).map(t=>t.path)}readdir(e){return this.internalFs.readdir(e,{withFileTypes:!0})}async lastModified(e){return 0}}class rl extends On{constructor(){super(...arguments),this.logs=[],this.changeListeners=[]}getLogs(){return this.logs}basicLog(e,{type:t}={}){switch(t){case"warning":console.warn(e);break;case"error":console.error(e);break;case"info":console.info(e);break;default:console.log(e);break}e instanceof Error&&(e=e.message),this.logs.unshift([typeof e=="string"?e:JSON.stringify(e),{type:t}]),this.logsChanged()}addChangeListener(e){this.changeListeners.push(e)}removeChangeListeners(){this.changeListeners=[]}logsChanged(){this.changeListeners.forEach(e=>e())}clear(){this.logs=[],this.logsChanged()}log(...e){e.forEach(t=>this.basicLog(t))}info(...e){e.forEach(t=>this.basicLog(t,{type:"info"}))}warn(...e){e.forEach(t=>this.basicLog(t,{type:"warning"}))}error(...e){e.forEach(t=>this.basicLog(t,{type:"error"}))}}class il{constructor(){this.listeners=[],this.isLocked=!1}lock(){return new Promise(async(e,t)=>{this.isLocked?this.listeners.push(()=>{this.isLocked=!0,e()}):(this.isLocked=!0,e())})}unlock(){if(!this.isLocked)throw new Error("Trying to unlock a mutex that is not locked");this.isLocked=!1,this.listeners.length>0&&this.listeners.shift()()}}var nl="/assets/wasm-web_bg.533586ee.wasm";globalThis.process={cwd:()=>"",env:{}},po(nl);const Yt=new oa,Nn=new Map;class sl extends ti{constructor(e,t,i){super(),this.isDashFree=new il,this.isSetup=!1,this.completedStartUp=new He,this.fileSystem=new Pn(e);const n=t&&i.mode==="development"?new Pn(t):void 0;this.fileType=new Hu,this.fileType.setPluginFileTypes(i.pluginFileTypes);let s=Nn.get(i.projectName);s||(s=new rl,Nn.set(i.projectName,s)),this.console=s,this.dash=new Zo(this.fileSystem,n,{config:i.config,compilerConfig:i.compilerConfig,console:s,mode:i.mode,fileType:this.fileType,packType:new tl,requestJsonData:u=>Yt.readJSON(u)}),this.projectDir=Pr(i.config)}getCompilerLogs(){return this.console.getLogs()}clearCompilerLogs(){this.console.clear()}onConsoleUpdate(e){this.console.addChangeListener(e)}removeConsoleListeners(){this.console.removeChangeListeners()}async compileFile(e,t){await this.isDashFree.lock();const[i,n]=await this.dash.compileFile(e,t);return this.isDashFree.unlock(),[i,n!=null?n:t]}async start(e,t){await this.isDashFree.lock();const i=this.fileSystem.internal;await i.fileExists(`${this.projectDir}/.bridge/.restartWatchMode`)||!await i.fileExists(`${this.projectDir}/.bridge/.dash.${this.dash.getMode()}.json`)?await Promise.all([this.build(!1).catch(n=>console.error(n)),i.unlink(`${this.projectDir}/.bridge/.restartWatchMode`).catch(n=>console.error(n))]):(t.length>0&&await this.unlinkMultiple(t,!1),e.length>0&&await this.updateFiles(e,!1)),this.completedStartUp.dispatch(),this.isDashFree.unlock()}async build(e=!0){e&&await this.isDashFree.lock(),this.dispatch(),await this.dash.build(),e&&this.isDashFree.unlock()}async updateFiles(e,t=!0){t&&await this.isDashFree.lock(),this.dispatch(),await this.dash.updateFiles(e),t&&this.isDashFree.unlock()}async unlink(e,t=!0){await this.isDashFree.lock(),await this.dash.unlink(e,t),this.isDashFree.unlock()}async unlinkMultiple(e,t=!0){t&&await this.isDashFree.lock(),await this.dash.unlinkMultiple(e),t&&this.isDashFree.unlock()}async rename(e,t){await this.isDashFree.lock(),this.dispatch(),await this.dash.rename(e,t),this.isDashFree.unlock()}async renameMultiple(e){for(const[t,i]of e)await this.dash.rename(t,i)}getCompilerOutputPath(e){return this.dash.getCompilerOutputPath(e)}getFileDependencies(e){return this.dash.getFileDependencies(e)}async setup(){await this.isDashFree.lock(),Yt.hasFired||await Yt.loadData(),await this.dash.setup(Yt),this.isDashFree.unlock(),this.isSetup=!0}async reloadPlugins(){await this.isDashFree.lock(),await this.dash.reload(),this.isDashFree.unlock()}onProgress(e){const t=this.dash.progress.onChange(i=>{i.percentage===1?(t.dispose(),e(1)):e(i.percentage)})}}rr(sl,self)})();
